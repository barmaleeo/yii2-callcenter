!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=13)}([function(e,t,n){"use strict";e.exports=n(4)},function(e,t,n){"use strict";!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=n(5)},function(e,t,n){"use strict";
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var i=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(e){i[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,o,a=function(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),u=1;u<arguments.length;u++){for(var l in n=Object(arguments[u]))r.call(n,l)&&(a[l]=n[l]);if(i){o=i(n);for(var c=0;c<o.length;c++)s.call(n,o[c])&&(a[o[c]]=n[o[c]])}}return a}},function(e,t,n){
/*!
 * 
 *  SIP version 0.11.6
 *  Copyright (c) 2014-2018 Junction Networks, Inc <http://www.onsip.com>
 *  Homepage: https://sipjs.com
 *  License: https://sipjs.com/license/
 * 
 * 
 *  ~~~SIP.js contains substantial portions of JsSIP under the following license~~~
 *  Homepage: http://jssip.net
 *  Copyright (c) 2012-2013 José Luis Millán - Versatica <http://www.versatica.com>
 * 
 *  Permission is hereby granted, free of charge, to any person obtaining
 *  a copy of this software and associated documentation files (the
 *  "Software"), to deal in the Software without restriction, including
 *  without limitation the rights to use, copy, modify, merge, publish,
 *  distribute, sublicense, and/or sell copies of the Software, and to
 *  permit persons to whom the Software is furnished to do so, subject to
 *  the following conditions:
 * 
 *  The above copyright notice and this permission notice shall be
 *  included in all copies or substantial portions of the Software.
 * 
 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 *  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 *  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 *  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 *  LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 *  OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 *  WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * 
 *  ~~~ end JsSIP license ~~~
 * 
 * 
 * 
 * 
 */
!function(t,n){e.exports=n()}(0,function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";e.exports=n(1)(n(40))},function(e,t,n){"use strict";e.exports=function(e){var t=n(2),i=t.version,r=t.title,s=Object.defineProperties({},{version:{get:function(){return i}},name:{get:function(){return r}}});return n(3)(s,e),s.LoggerFactory=n(4)(e.console),s.EventEmitter=n(5)(),s.C=n(7)(s.name,s.version),s.Exceptions=n(8),s.Timers=n(9)(e.timers),s.Transport=n(10)(s),n(11)(s),n(12)(s),n(13)(s),n(14)(s),n(15)(s),n(16)(s),n(18)(s),n(19)(s),s.SessionDescriptionHandler=n(20)(s.EventEmitter),n(21)(s),n(22)(s),n(23)(s),n(25)(s),n(26)(s),n(27)(s,e),n(32)(s),s.DigestAuthentication=n(33)(s.Utils),s.Grammar=n(36)(s),s.Web={Modifiers:n(38)(s),Simple:n(39)(s)},s}},function(e){e.exports={name:"sip.js",title:"SIP.js",description:"A simple, intuitive, and powerful JavaScript signaling library",version:"0.11.6",main:"dist/sip.js",browser:{"./src/environment.js":"./src/environment_browser.js"},homepage:"https://sipjs.com",author:"OnSIP <developer@onsip.com> (https://sipjs.com/aboutus/)",contributors:[{url:"https://github.com/onsip/SIP.js/blob/master/THANKS.md"}],repository:{type:"git",url:"https://github.com/onsip/SIP.js.git"},keywords:["sip","websocket","webrtc","library","javascript"],devDependencies:{"awesome-typescript-loader":"^5.2.1",eslint:"^5.4.0","jasmine-core":"^3.2.1",karma:"^3.0.0","karma-chrome-launcher":"^2.2.0","karma-cli":"^1.0.1","karma-jasmine":"^1.1.0","karma-jasmine-html-reporter":"^1.3.1","karma-mocha-reporter":"^2.2.5","karma-webpack":"^3.0.0",pegjs:"^0.10.0","pegjs-loader":"^0.5.4",typescript:"^3.0.3",webpack:"^4.19.0","webpack-cli":"^3.0.8"},engines:{node:">=6.0"},license:"MIT",scripts:{prebuild:"eslint src/*.js src/**/*.js","build-dev":"webpack --progress --env.buildType dev","build-prod":"webpack --progress --env.buildType prod","copy-dist-files":"cp dist/sip.js dist/sip-$npm_package_version.js && cp dist/sip.min.js  dist/sip-$npm_package_version.min.js",build:"npm run build-dev && npm run build-prod && npm run copy-dist-files",browserTest:"sleep 2 && open http://0.0.0.0:9876/debug.html & karma start --reporters kjhtml --no-single-run",commandLineTest:"karma start --reporters mocha --browsers ChromeHeadless --single-run",buildAndTest:"npm run build && npm run commandLineTest",buildAndBrowserTest:"npm run build && npm run browserTest"},dependencies:{"crypto-js":"^3.1.9-1"},optionalDependencies:{promiscuous:"^0.6.0"}}},function(e,t,n){"use strict";e.exports=function(e,t){var n;n={Promise:t.Promise,defer:function(){var e={};return e.promise=new n.Promise(function(t,n){e.resolve=t,e.reject=n}),e},reducePromises:function(t,n){return t.reduce(function(e,t){return e=e.then(t)},e.Utils.Promise.resolve(n))},augment:function(e,t,n,i){var r,s;for(r in s=t.prototype)(i||void 0===e[r])&&(e[r]=s[r]);t.apply(e,n)},defaultOptions:function(e,t){return e=e||{},t=t||{},Object.assign({},e,t)},optionsOverride:function(e,t,n,i,r,s){i&&e[n]&&r.warn(n+" is deprecated, please use "+t+" instead"),e[t]&&e[n]&&r.warn(t+" overriding "+n),e[t]=e[t]||e[n]||s},str_utf8_length:function(e){return encodeURIComponent(e).replace(/%[A-F\d]{2}/g,"U").length},generateFakeSDP:function(e){if(e){var t=e.indexOf("o="),n=e.indexOf("\r\n",t);return"v=0\r\n"+e.slice(t,n)+"\r\ns=-\r\nt=0 0\r\nc=IN IP4 0.0.0.0"}},isFunction:function(e){return void 0!==e&&"[object Function]"===Object.prototype.toString.call(e)},isDecimal:function(e){return!isNaN(e)&&parseFloat(e)===parseInt(e,10)},createRandomToken:function(e,t){var n,i="";for(t=t||32,n=0;n<e;n++)i+=(Math.random()*t|0).toString(t);return i},newTag:function(){return e.Utils.createRandomToken(e.UA.C.TAG_LENGTH)},newUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},hostType:function(t){if(t)return-1!==(t=e.Grammar.parse(t,"host"))?t.host_type:void 0},normalizeTarget:function(t,n){var i,r,s;if(t){if(t instanceof e.URI)return t;if("string"==typeof t){switch((i=t.split("@")).length){case 1:if(!n)return;r=t,s=n;break;case 2:r=i[0],s=i[1];break;default:r=i.slice(0,i.length-1).join("@"),s=i[i.length-1]}return r=r.replace(/^(sips?|tel):/i,""),/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(r)&&(r=r.replace(/[\-\.\(\)]/g,"")),t=e.C.SIP+":"+e.Utils.escapeUser(r)+"@"+s,e.URI.parse(t)}}else;},escapeUser:function(e){return encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},headerize:function(e){var t,n={"Call-Id":"Call-ID",Cseq:"CSeq","Min-Se":"Min-SE",Rack:"RAck",Rseq:"RSeq","Www-Authenticate":"WWW-Authenticate"},i=e.toLowerCase().replace(/_/g,"-").split("-"),r="",s=i.length;for(t=0;t<s;t++)0!==t&&(r+="-"),r+=i[t].charAt(0).toUpperCase()+i[t].substring(1);return n[r]&&(r=n[r]),r},sipErrorCause:function(t){var n;for(n in e.C.SIP_ERROR_CAUSES)if(-1!==e.C.SIP_ERROR_CAUSES[n].indexOf(t))return e.C.causes[n];return e.C.causes.SIP_FAILURE_CODE},getReasonPhrase:function(t,n){return n||e.C.REASON_PHRASE[t]||""},getReasonHeaderValue:function(t,n){return"SIP;cause="+t+';text="'+(n=e.Utils.getReasonPhrase(t,n))+'"'},getCancelReason:function(t,n){if(t&&t<200||t>699)throw new TypeError("Invalid status_code: "+t);if(t)return e.Utils.getReasonHeaderValue(t,n)},buildStatusLine:function(e,t){if(e=e||null,t=t||null,!e||e<100||e>699)throw new TypeError("Invalid status_code: "+e);if(t&&"string"!=typeof t&&!(t instanceof String))throw new TypeError("Invalid reason_phrase: "+t);return"SIP/2.0 "+e+" "+(t=n.getReasonPhrase(e,t))+"\r\n"},getRandomTestNetIP:function(){return"192.0.2."+function(e,t){return Math.floor(Math.random()*(t-e+1)+e)}(1,254)}},e.Utils=n}},function(e,t,n){"use strict";var i={error:0,warn:1,log:2,debug:3};e.exports=function(e){var t=function(){var e,t=2,n=!0,r=null;this.loggers={},e=this.getLogger("sip.loggerfactory"),Object.defineProperties(this,{builtinEnabled:{get:function(){return n},set:function(t){"boolean"==typeof t?n=t:e.error('invalid "builtinEnabled" parameter value: '+JSON.stringify(t))}},level:{get:function(){return t},set:function(n){n>=0&&n<=3?t=n:n>3?t=3:i.hasOwnProperty(n)?t=i[n]:e.error('invalid "level" parameter value: '+JSON.stringify(n))}},connector:{get:function(){return r},set:function(t){null===t||""===t||void 0===t?r=null:"function"==typeof t?r=t:e.error('invalid "connector" parameter value: '+JSON.stringify(t))}}})};function n(e,t,n){this.logger=e,this.category=t,this.label=n}return t.prototype.print=function(t,n,i,r){if("string"==typeof r){var s=[new Date,n];i&&s.push(i),r=s.concat(r).join(" | ")}t.call(e,r)},Object.keys(i).forEach(function(r){n.prototype[r]=function(e){this.logger[r](this.category,this.label,e)},t.prototype[r]=function(t,n,s){this.level>=i[r]&&(this.builtinEnabled&&this.print(e[r],t,n,s),this.connector&&this.connector(r,t,n,s))}}),t.prototype.getLogger=function(e,t){var i;return t&&3===this.level?new n(this,e,t):this.loggers[e]?this.loggers[e]:(i=new n(this,e),this.loggers[e]=i,i)},t}},function(e,t,n){"use strict";var i=n(6).EventEmitter;e.exports=function(){function e(){i.call(this)}return e.prototype=Object.create(i.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),e}},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function r(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!function(e){return"number"==typeof e}(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,o,a,u,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(s(n=this._events[e]))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(r(n))for(a=Array.prototype.slice.call(arguments,1),o=(l=n.slice()).length,u=0;u<o;u++)l[u].apply(this,a);return!0},n.prototype.addListener=function(e,t){var o;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?r(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,r(this._events[e])&&!this._events[e].warned&&(o=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&o>0&&this._events[e].length>o&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){if(!i(t))throw TypeError("listener must be a function");var n=!1;function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}return r.listener=t,this.on(e,r),this},n.prototype.removeListener=function(e,t){var n,s,o,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(n=this._events[e]).length,s=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(r(n)){for(a=o;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){s=a;break}if(s<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(s,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,n){"use strict";e.exports=function(e,t){return{USER_AGENT:e+"/"+t,SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",AUTHENTICATION_ERROR:"Authentication Error",DIALOG_ERROR:"Dialog Error",WEBRTC_NOT_SUPPORTED:"WebRTC Not Supported",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",NO_PRACK:"No PRACK",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},supported:{UNSUPPORTED:"none",SUPPORTED:"supported",REQUIRED:"required"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",PUBLISH:"PUBLISH",REFER:"REFER",PRACK:"PRACK",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},OPTION_TAGS:{"100rel":!0,199:!0,answermode:!0,"early-session":!0,eventlist:!0,explicitsub:!0,"from-change":!0,"geolocation-http":!0,"geolocation-sip":!0,gin:!0,gruu:!0,histinfo:!0,ice:!0,join:!0,"multiple-refer":!0,norefersub:!0,nosub:!0,outbound:!0,path:!0,policy:!0,precondition:!0,pref:!0,privacy:!0,"recipient-list-invite":!0,"recipient-list-message":!0,"recipient-list-subscribe":!0,replaces:!0,"resource-priority":!0,"sdp-anat":!0,"sec-agree":!0,tdialog:!0,timer:!0,uui:!0},dtmfType:{INFO:"info",RTP:"rtp"}}}},function(e,t,n){"use strict";e.exports={ConfigurationError:function(){var e=function(e,t){this.code=1,this.name="CONFIGURATION_ERROR",this.parameter=e,this.value=t,this.message=this.value?"Invalid value "+JSON.stringify(this.value)+' for parameter "'+this.parameter+'"':"Missing parameter: "+this.parameter};return e.prototype=new Error,e}(),InvalidStateError:function(){var e=function(e){this.code=2,this.name="INVALID_STATE_ERROR",this.status=e,this.message="Invalid status: "+e};return e.prototype=new Error,e}(),NotSupportedError:function(){var e=function(e){this.code=3,this.name="NOT_SUPPORTED_ERROR",this.message=e};return e.prototype=new Error,e}(),GetDescriptionError:function(){var e=function(e){this.code=4,this.name="GET_DESCRIPTION_ERROR",this.message=e};return e.prototype=new Error,e}(),RenegotiationError:function(){var e=function(e){this.code=5,this.name="RENEGOTIATION_ERROR",this.message=e};return e.prototype=new Error,e}(),MethodParameterError:function(){var e=function(e,t,n){this.code=6,this.name="METHOD_PARAMETER_ERROR",this.method=e,this.parameter=t,this.value=n,this.message=this.value?"Invalid value "+JSON.stringify(this.value)+' for parameter "'+this.parameter+'"':"Missing parameter: "+this.parameter};return e.prototype=new Error,e}(),TransportError:function(){var e=function(e){this.code=7,this.name="TRANSPORT_ERROR",this.message=e};return e.prototype=new Error,e}(),SessionDescriptionHandlerError:function(){var e=function(e,t,n){this.code=8,this.name="SESSION_DESCRIPTION_HANDLER_ERROR",this.method=e,this.error=t,this.message=n||"Error with Session Description Handler"};return e.prototype=new Error,e}()}},function(e,t,n){"use strict";var i=500;e.exports=function(e){var t={T1:i,T2:4e3,T4:5e3,TIMER_B:32e3,TIMER_D:0,TIMER_F:32e3,TIMER_H:32e3,TIMER_I:0,TIMER_J:0,TIMER_K:0,TIMER_L:32e3,TIMER_M:32e3,TIMER_N:32e3,PROVISIONAL_RESPONSE_INTERVAL:6e4};return["setTimeout","clearTimeout","setInterval","clearInterval"].forEach(function(n){t[n]=function(){return e[n].apply(e,arguments)}}),t}},function(e,t,n){"use strict";e.exports=function(e){var t=function(e,t){};return t.prototype=Object.create(e.EventEmitter.prototype,{connect:{writable:!0,value:function(e){return e=e||{},this.connectPromise(e).then(function(e){!e.overrideEvent&&this.emit("connected")}.bind(this))}},connectPromise:{writable:!0,value:function(e){}},isConnected:{writable:!0,value:function(){}},send:{writable:!0,value:function(e,t){return t=t||{},this.sendPromise(e).then(function(e){!e.overrideEvent&&this.emit("messageSent",e.msg)}.bind(this))}},sendPromise:{writable:!0,value:function(e,t){}},onMessage:{writable:!0,value:function(e){}},disconnect:{writable:!0,value:function(e){return e=e||{},this.disconnectPromise(e).then(function(e){!e.overrideEvent&&this.emit("disconnected")}.bind(this))}},disconnectPromise:{writable:!0,value:function(e){}},afterConnected:{writable:!0,value:function(e){this.isConnected()?e():this.once("connected",e)}},waitForConnected:{writable:!0,value:function(){return console.warn("DEPRECATION WARNING Transport.waitForConnected(): use afterConnected() instead"),new e.Utils.Promise(function(e){this.afterConnected(e)}.bind(this))}}}),t}},function(e,t,n){"use strict";e.exports=function(e){var t;function n(e,t){var n=t,i=0,r=0;if(e.substring(n,n+2).match(/(^\r\n)/))return-2;for(;0===i;){if(-1===(r=e.indexOf("\r\n",n)))return r;!e.substring(r+2,r+4).match(/(^\r\n)/)&&e.charAt(r+2).match(/(^\s+)/)?n=r+2:i=r}return i}function i(t,n,i,r){var s,o,a,u,l=n.indexOf(":",i),c=n.substring(i,l).trim(),d=n.substring(l+1,r).trim();switch(c.toLowerCase()){case"via":case"v":t.addHeader("via",d),1===t.getHeaders("via").length?(u=t.parseHeader("Via"))&&(t.via=u,t.via_branch=u.branch):u=0;break;case"from":case"f":t.setHeader("from",d),(u=t.parseHeader("from"))&&(t.from=u,t.from_tag=u.getParam("tag"));break;case"to":case"t":t.setHeader("to",d),(u=t.parseHeader("to"))&&(t.to=u,t.to_tag=u.getParam("tag"));break;case"record-route":if(-1===(u=e.Grammar.parse(d,"Record_Route"))){u=void 0;break}for(a=u.length,o=0;o<a;o++)s=u[o],t.addHeader("record-route",d.substring(s.position,s.offset)),t.headers["Record-Route"][t.getHeaders("record-route").length-1].parsed=s.parsed;break;case"call-id":case"i":t.setHeader("call-id",d),(u=t.parseHeader("call-id"))&&(t.call_id=d);break;case"contact":case"m":if(-1===(u=e.Grammar.parse(d,"Contact"))){u=void 0;break}for(a=u.length,o=0;o<a;o++)s=u[o],t.addHeader("contact",d.substring(s.position,s.offset)),t.headers.Contact[t.getHeaders("contact").length-1].parsed=s.parsed;break;case"content-length":case"l":t.setHeader("content-length",d),u=t.parseHeader("content-length");break;case"content-type":case"c":t.setHeader("content-type",d),u=t.parseHeader("content-type");break;case"cseq":t.setHeader("cseq",d),(u=t.parseHeader("cseq"))&&(t.cseq=u.value),t instanceof e.IncomingResponse&&(t.method=u.method);break;case"max-forwards":t.setHeader("max-forwards",d),u=t.parseHeader("max-forwards");break;case"www-authenticate":t.setHeader("www-authenticate",d),u=t.parseHeader("www-authenticate");break;case"proxy-authenticate":t.setHeader("proxy-authenticate",d),u=t.parseHeader("proxy-authenticate");break;case"refer-to":case"r":t.setHeader("refer-to",d),(u=t.parseHeader("refer-to"))&&(t.refer_to=u);break;default:t.setHeader(c,d),u=0}return void 0!==u||{error:'error parsing header "'+c+'"'}}(t={}).parseMessage=function(t,r){var s,o,a,u,l,c=0,d=t.indexOf("\r\n"),h=r.getLogger("sip.parser");if(-1!==d){if(o=t.substring(0,d),-1!==(l=e.Grammar.parse(o,"Request_Response"))){for(l.status_code?((s=new e.IncomingResponse(r)).status_code=l.status_code,s.reason_phrase=l.reason_phrase):((s=new e.IncomingRequest(r)).method=l.method,s.ruri=l.uri),s.data=t,c=d+2;;){if(-2===(d=n(t,c))){u=c+2;break}if(-1===d)return void h.error("malformed message");if(!0!==(l=i(s,t,c,d)))return void h.error(l.error);c=d+2}return s.hasHeader("content-length")?(a=s.getHeader("content-length"),s.body=t.substr(u,a)):s.body=t.substring(u),s}h.warn('error parsing first line of SIP message: "'+o+'"')}else h.warn("no CRLF found, not a SIP message, discarded")},e.Parser=t}},function(e,t,n){"use strict";e.exports=function(e){var t,n,i,r;function s(t){var n=t.ua.configuration.hackAllowUnregisteredOptionTags,i=[],r={};return t.method===e.C.REGISTER?i.push("path","gruu"):t.method===e.C.INVITE&&(t.ua.contact.pub_gruu||t.ua.contact.temp_gruu)&&i.push("gruu"),t.ua.configuration.rel100===e.C.supported.SUPPORTED&&i.push("100rel"),t.ua.configuration.replaces===e.C.supported.SUPPORTED&&i.push("replaces"),i.push("outbound"),"Supported: "+(i=(i=i.concat(t.ua.configuration.extraSupported)).filter(function(t){var i=e.C.OPTION_TAGS[t],s=!r[t];return r[t]=!0,(i||n)&&s})).join(", ")+"\r\n"}(t=function(t,n,i,r,s,o){var a,u,l,c,d,h;if(r=r||{},!t||!n||!i)return null;this.logger=i.getLogger("sip.sipmessage"),this.ua=i,this.headers={},this.method=t,this.ruri=n,this.body=o,this.extraHeaders=(s||[]).slice(),this.statusCode=r.status_code,this.reasonPhrase=r.reason_phrase,r.route_set?this.setHeader("route",r.route_set):i.configuration.usePreloadedRoute&&this.setHeader("route",i.transport.server.sip_uri),this.setHeader("via",""),this.setHeader("max-forwards",e.UA.C.MAX_FORWARDS),d=r.to_uri||n,a=r.to_displayName||0===r.to_displayName?'"'+r.to_displayName+'" ':"",a+="<"+(d&&d.toRaw?d.toRaw():d)+">",a+=r.to_tag?";tag="+r.to_tag:"",this.to=new e.NameAddrHeader.parse(a),this.setHeader("to",a),h=r.from_uri||i.configuration.uri,u=r.from_displayName||0===r.from_displayName?'"'+r.from_displayName+'" ':i.configuration.displayName?'"'+i.configuration.displayName+'" ':"",u+="<"+(h&&h.toRaw?h.toRaw():h)+">;tag=",u+=r.from_tag||e.Utils.newTag(),this.from=new e.NameAddrHeader.parse(u),this.setHeader("from",u),l=r.call_id||i.configuration.sipjsId+e.Utils.createRandomToken(15),this.call_id=l,this.setHeader("call-id",l),c=r.cseq||Math.floor(1e4*Math.random()),this.cseq=c,this.setHeader("cseq",c+" "+t)}).prototype={setHeader:function(t,n){this.headers[e.Utils.headerize(t)]=n instanceof Array?n:[n]},getHeader:function(t){var n,i,r=this.extraHeaders.length,s=this.headers[e.Utils.headerize(t)];if(s){if(s[0])return s[0]}else for(n=new RegExp("^\\s*"+t+"\\s*:","i"),i=0;i<r;i++)if(s=this.extraHeaders[i],n.test(s))return s.substring(s.indexOf(":")+1).trim()},getHeaders:function(t){var n,i,r,s=this.headers[e.Utils.headerize(t)],o=[];if(s){for(i=s.length,n=0;n<i;n++)o.push(s[n]);return o}for(i=this.extraHeaders.length,r=new RegExp("^\\s*"+t+"\\s*:","i"),n=0;n<i;n++)s=this.extraHeaders[n],r.test(s)&&o.push(s.substring(s.indexOf(":")+1).trim());return o},hasHeader:function(t){var n,i,r=this.extraHeaders.length;if(this.headers[e.Utils.headerize(t)])return!0;for(n=new RegExp("^\\s*"+t+"\\s*:","i"),i=0;i<r;i++)if(n.test(this.extraHeaders[i]))return!0;return!1},toString:function(){var t,n,i,r="";for(t in r+=this.method+" "+(this.ruri.toRaw?this.ruri.toRaw():this.ruri)+" SIP/2.0\r\n",this.headers)for(n=this.headers[t].length,i=0;i<n;i++)r+=t+": "+this.headers[t][i]+"\r\n";for(n=this.extraHeaders.length,i=0;i<n;i++)r+=this.extraHeaders[i].trim()+"\r\n";return r+=s(this),r+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",this.body?"string"==typeof this.body?(r+="Content-Length: "+(n=e.Utils.str_utf8_length(this.body))+"\r\n\r\n",r+=this.body):this.body.body&&this.body.contentType?(n=e.Utils.str_utf8_length(this.body.body),r+="Content-Type: "+this.body.contentType+"\r\n",r+="Content-Length: "+n+"\r\n\r\n",r+=this.body.body):r+="Content-Length: 0\r\n\r\n":r+="Content-Length: 0\r\n\r\n",r}},(n=function(){this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null}).prototype={addHeader:function(t,n){var i={raw:n};t=e.Utils.headerize(t),this.headers[t]?this.headers[t].push(i):this.headers[t]=[i]},getHeader:function(t){var n=this.headers[e.Utils.headerize(t)];if(n)return n[0]?n[0].raw:void 0},getHeaders:function(t){var n,i,r=this.headers[e.Utils.headerize(t)],s=[];if(!r)return[];for(i=r.length,n=0;n<i;n++)s.push(r[n].raw);return s},hasHeader:function(t){return!!this.headers[e.Utils.headerize(t)]},parseHeader:function(t,n){var i,r,s;if(t=e.Utils.headerize(t),n=n||0,this.headers[t]){if(!(n>=this.headers[t].length))return r=(i=this.headers[t][n]).raw,i.parsed?i.parsed:-1===(s=e.Grammar.parse(r,t.replace(/-/g,"_")))?(this.headers[t].splice(n,1),void this.logger.warn('error parsing "'+t+'" header field with value "'+r+'"')):(i.parsed=s,s);this.logger.log('not so many "'+t+'" headers present')}else this.logger.log('header "'+t+'" not present')},s:function(e,t){return this.parseHeader(e,t)},setHeader:function(t,n){var i={raw:n};this.headers[e.Utils.headerize(t)]=[i]},toString:function(){return this.data}},((i=function(e){this.logger=e.getLogger("sip.sipmessage"),this.ua=e,this.headers={},this.ruri=null,this.transport=null,this.server_transaction=null}).prototype=new n).reply=function(t,n,i,r,o,a){var u,l,c,d,h,p=this.getHeader("To"),f=0,m=0;if(h=e.Utils.buildStatusLine(t,n),i=(i||[]).slice(),this.method===e.C.INVITE&&t>100&&t<=200)for(c=(u=this.getHeaders("record-route")).length;f<c;f++)h+="Record-Route: "+u[f]+"\r\n";for(c=(l=this.getHeaders("via")).length;m<c;m++)h+="Via: "+l[m]+"\r\n";for(!this.to_tag&&t>100?p+=";tag="+e.Utils.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(p+=";tag="+this.to_tag),h+="To: "+p+"\r\n",h+="From: "+this.getHeader("From")+"\r\n",h+="Call-ID: "+this.call_id+"\r\n",h+="CSeq: "+this.cseq+" "+this.method+"\r\n",c=i.length,d=0;d<c;d++)h+=i[d].trim()+"\r\n";return h+=s(this),h+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",r?"string"==typeof r?(h+="Content-Type: application/sdp\r\n",h+="Content-Length: "+(c=e.Utils.str_utf8_length(r))+"\r\n\r\n",h+=r):r.body&&r.contentType?(c=e.Utils.str_utf8_length(r.body),h+="Content-Type: "+r.contentType+"\r\n",h+="Content-Length: "+c+"\r\n\r\n",h+=r.body):h+="Content-Length: 0\r\n\r\n":h+="Content-Length: 0\r\n\r\n",this.server_transaction.receiveResponse(t,h).then(o,a),h},i.prototype.reply_sl=function(t,n){var i,r,s=0,o=this.getHeaders("via"),a=o.length;for(r=e.Utils.buildStatusLine(t,n);s<a;s++)r+="Via: "+o[s]+"\r\n";i=this.getHeader("To"),!this.to_tag&&t>100?i+=";tag="+e.Utils.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(i+=";tag="+this.to_tag),r+="To: "+i+"\r\n",r+="From: "+this.getHeader("From")+"\r\n",r+="Call-ID: "+this.call_id+"\r\n",r+="CSeq: "+this.cseq+" "+this.method+"\r\n",r+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",r+="Content-Length: 0\r\n\r\n",this.transport.send(r)},(r=function(e){this.logger=e.getLogger("sip.sipmessage"),this.headers={},this.status_code=null,this.reason_phrase=null}).prototype=new n,e.OutgoingRequest=t,e.IncomingRequest=i,e.IncomingResponse=r}},function(e,t,n){"use strict";e.exports=function(e){var t;(t=function(t,n,i,r,s,o){var a,u,l,c;if(!i)throw new TypeError('missing or invalid "host" parameter');for(a in t=t||e.C.SIP,this.parameters={},this.headers={},s)this.setParam(a,s[a]);for(u in o)this.setHeader(u,o[u]);l={scheme:t,user:n,host:i,port:r},c={scheme:t.toLowerCase(),user:n,host:i.toLowerCase(),port:r},Object.defineProperties(this,{_normal:{get:function(){return c}},_raw:{get:function(){return l}},scheme:{get:function(){return c.scheme},set:function(e){l.scheme=e,c.scheme=e.toLowerCase()}},user:{get:function(){return c.user},set:function(e){c.user=l.user=e}},host:{get:function(){return c.host},set:function(e){l.host=e,c.host=e.toLowerCase()}},aor:{get:function(){return c.user+"@"+c.host}},port:{get:function(){return c.port},set:function(e){c.port=l.port=0===e?e:parseInt(e,10)||null}}})}).prototype={setParam:function(e,t){e&&(this.parameters[e.toLowerCase()]=void 0===t||null===t?null:t.toString())},getParam:function(e){if(e)return this.parameters[e.toLowerCase()]},hasParam:function(e){if(e)return!!this.parameters.hasOwnProperty(e.toLowerCase())},deleteParam:function(e){var t;if(e=e.toLowerCase(),this.parameters.hasOwnProperty(e))return t=this.parameters[e],delete this.parameters[e],t},clearParams:function(){this.parameters={}},setHeader:function(t,n){this.headers[e.Utils.headerize(t)]=n instanceof Array?n:[n]},getHeader:function(t){if(t)return this.headers[e.Utils.headerize(t)]},hasHeader:function(t){if(t)return!!this.headers.hasOwnProperty(e.Utils.headerize(t))},deleteHeader:function(t){var n;if(t=e.Utils.headerize(t),this.headers.hasOwnProperty(t))return n=this.headers[t],delete this.headers[t],n},clearHeaders:function(){this.headers={}},clone:function(){return new t(this._raw.scheme,this._raw.user,this._raw.host,this._raw.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))},toRaw:function(){return this._toString(this._raw)},toString:function(){return this._toString(this._normal)},_toString:function(t){var n,i,r,s,o=[];for(i in s=t.scheme+":",t.scheme.toLowerCase().match("^sips?$")||(s+="//"),t.user&&(s+=e.Utils.escapeUser(t.user)+"@"),s+=t.host,(t.port||0===t.port)&&(s+=":"+t.port),this.parameters)s+=";"+i,null!==this.parameters[i]&&(s+="="+this.parameters[i]);for(n in this.headers)for(r in this.headers[n])o.push(n+"="+this.headers[n][r]);return o.length>0&&(s+="?"+o.join("&")),s}},t.parse=function(t){return-1!==(t=e.Grammar.parse(t,"SIP_URI"))?t:void 0},e.URI=t}},function(e,t,n){"use strict";e.exports=function(e){var t;(t=function(t,n,i){var r;if(!(t&&t instanceof e.URI))throw new TypeError('missing or invalid "uri" parameter');for(r in this.uri=t,this.parameters={},i)this.setParam(r,i[r]);Object.defineProperties(this,{friendlyName:{get:function(){return this.displayName||t.aor}},displayName:{get:function(){return n},set:function(e){n=0===e?"0":e}}})}).prototype={setParam:function(e,t){e&&(this.parameters[e.toLowerCase()]=void 0===t||null===t?null:t.toString())},getParam:e.URI.prototype.getParam,hasParam:e.URI.prototype.hasParam,deleteParam:e.URI.prototype.deleteParam,clearParams:e.URI.prototype.clearParams,clone:function(){return new t(this.uri.clone(),this.displayName,JSON.parse(JSON.stringify(this.parameters)))},toString:function(){var e,t;for(t in e=this.displayName||0===this.displayName?'"'+this.displayName+'" ':"",e+="<"+this.uri.toString()+">",this.parameters)e+=";"+t,null!==this.parameters[t]&&(e+="="+this.parameters[t]);return e}},t.parse=function(t){return-1!==(t=e.Grammar.parse(t,"Name_Addr_Header"))?t:void 0},e.NameAddrHeader=t}},function(e,t,n){"use strict";e.exports=function(e){var t={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"};function n(e,t,n){var i;return i="SIP/2.0/"+(e.ua.configuration.hackViaTcp?"TCP":t.server.scheme),i+=" "+e.ua.configuration.viaHost+";branch="+n,e.ua.configuration.forceRport&&(i+=";rport"),i}var i=function(e,i,r){var s;this.type=t.NON_INVITE_CLIENT,this.transport=r,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=i,this.logger=e.ua.getLogger("sip.transaction.nict",this.id),s=n(e,r,this.id),this.request.setHeader("via",s),this.request_sender.ua.newTransaction(this)};(i.prototype=Object.create(e.EventEmitter.prototype)).stateChanged=function(e){this.state=e,this.emit("stateChanged")},i.prototype.send=function(){this.stateChanged(t.STATUS_TRYING),this.F=e.Timers.setTimeout(this.timer_F.bind(this),e.Timers.TIMER_F),this.transport.send(this.request).catch(function(){this.onTransportError()}.bind(this))},i.prototype.onTransportError=function(){this.logger.log("transport error occurred, deleting non-INVITE client transaction "+this.id),e.Timers.clearTimeout(this.F),e.Timers.clearTimeout(this.K),this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onTransportError()},i.prototype.timer_F=function(){this.logger.debug("Timer F expired for non-INVITE client transaction "+this.id),this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout()},i.prototype.timer_K=function(){this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},i.prototype.receiveResponse=function(n){var i=n.status_code;if(i<200)switch(this.state){case t.STATUS_TRYING:case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_PROCEEDING),this.request_sender.receiveResponse(n)}else switch(this.state){case t.STATUS_TRYING:case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_COMPLETED),e.Timers.clearTimeout(this.F),408===i?this.request_sender.onRequestTimeout():this.request_sender.receiveResponse(n),this.K=e.Timers.setTimeout(this.timer_K.bind(this),e.Timers.TIMER_K)}};var r=function(e,i,r){var s,o=this;this.type=t.INVITE_CLIENT,this.transport=r,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=i,this.logger=e.ua.getLogger("sip.transaction.ict",this.id),s=n(e,r,this.id),this.request.setHeader("via",s),this.request_sender.ua.newTransaction(this),this.request.cancel=function(e,t){for(var n=(t=(t||[]).slice()).length,i=null,r=0;r<n;r++)i=(i||"")+t[r].trim()+"\r\n";o.cancel_request(o,e,i)}};(r.prototype=Object.create(e.EventEmitter.prototype)).stateChanged=function(e){this.state=e,this.emit("stateChanged")},r.prototype.send=function(){this.stateChanged(t.STATUS_CALLING),this.B=e.Timers.setTimeout(this.timer_B.bind(this),e.Timers.TIMER_B),this.transport.send(this.request).catch(function(){this.onTransportError()}.bind(this))},r.prototype.onTransportError=function(){this.logger.log("transport error occurred, deleting INVITE client transaction "+this.id),e.Timers.clearTimeout(this.B),e.Timers.clearTimeout(this.D),e.Timers.clearTimeout(this.M),this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.state!==t.STATUS_ACCEPTED&&this.request_sender.onTransportError()},r.prototype.timer_M=function(){this.logger.debug("Timer M expired for INVITE client transaction "+this.id),this.state===t.STATUS_ACCEPTED&&(e.Timers.clearTimeout(this.B),this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this))},r.prototype.timer_B=function(){this.logger.debug("Timer B expired for INVITE client transaction "+this.id),this.state===t.STATUS_CALLING&&(this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout())},r.prototype.timer_D=function(){this.logger.debug("Timer D expired for INVITE client transaction "+this.id),e.Timers.clearTimeout(this.B),this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},r.prototype.sendACK=function(t){var n,i=this;t=t||{},n=this.response.getHeader("contact")?this.response.parseHeader("contact").uri:this.request.ruri;var r=new e.OutgoingRequest("ACK",n,this.request.ua,{cseq:this.response.cseq,call_id:this.response.call_id,from_uri:this.response.from.uri,from_tag:this.response.from_tag,to_uri:this.response.to.uri,to_tag:this.response.to_tag,route_set:this.response.getHeaders("record-route").reverse()},t.extraHeaders||[],t.body);return this.ackSender=new e.RequestSender({request:r,onRequestTimeout:this.request_sender.applicant.applicant?this.request_sender.applicant.applicant.onRequestTimeout:function(){i.logger.warn("ACK Request timed out")},onTransportError:this.request_sender.applicant.applicant?this.request_sender.applicant.applicant.onRequestTransportError:function(){i.logger.warn("ACK Request had a transport error")},receiveResponse:t.receiveResponse||function(){i.logger.warn("Received a response to an ACK which was unexpected. Dropping Response.")}},this.request.ua).send(),r},r.prototype.cancel_request=function(n,i,r){var s=n.request;this.cancel=e.C.CANCEL+" "+s.ruri+" SIP/2.0\r\n",this.cancel+="Via: "+s.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.cancel+="Route: "+s.headers.Route.toString()+"\r\n"),this.cancel+="To: "+s.headers.To.toString()+"\r\n",this.cancel+="From: "+s.headers.From.toString()+"\r\n",this.cancel+="Call-ID: "+s.headers["Call-ID"].toString()+"\r\n",this.cancel+="Max-Forwards: "+e.UA.C.MAX_FORWARDS+"\r\n",this.cancel+="CSeq: "+s.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n",i&&(this.cancel+="Reason: "+i+"\r\n"),r&&(this.cancel+=r),this.cancel+="Content-Length: 0\r\n\r\n",this.state===t.STATUS_PROCEEDING&&this.transport.send(this.cancel)},r.prototype.receiveResponse=function(n){var i=n.status_code;if(n.transaction=this,this.response&&this.response.status_code===n.status_code&&this.response.cseq===n.cseq)return this.logger.debug("ICT Received a retransmission for cseq: "+n.cseq),void(this.ackSender&&this.ackSender.send());if(this.response=n,i>=100&&i<=199)switch(this.state){case t.STATUS_CALLING:this.stateChanged(t.STATUS_PROCEEDING),this.request_sender.receiveResponse(n),this.cancel&&this.transport.send(this.cancel);break;case t.STATUS_PROCEEDING:this.request_sender.receiveResponse(n)}else if(i>=200&&i<=299)switch(this.state){case t.STATUS_CALLING:case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_ACCEPTED),this.M=e.Timers.setTimeout(this.timer_M.bind(this),e.Timers.TIMER_M),this.request_sender.receiveResponse(n);break;case t.STATUS_ACCEPTED:this.request_sender.receiveResponse(n)}else if(i>=300&&i<=699)switch(this.state){case t.STATUS_CALLING:case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_COMPLETED),this.sendACK(),this.request_sender.receiveResponse(n);break;case t.STATUS_COMPLETED:this.sendACK()}};var s=function(e,t,i){var r;this.transport=i,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=t,this.logger=e.ua.getLogger("sip.transaction.nict",this.id),r=n(e,i,this.id),this.request.setHeader("via",r)};(s.prototype=Object.create(e.EventEmitter.prototype)).send=function(){this.transport.send(this.request).catch(function(){this.onTransportError()}.bind(this))},s.prototype.onTransportError=function(){this.logger.log("transport error occurred, for an ACK client transaction "+this.id),this.request_sender.onTransportError()};var o=function(e,n){this.type=t.NON_INVITE_SERVER,this.id=e.via_branch,this.request=e,this.transport=n.transport,this.ua=n,this.last_response="",e.server_transaction=this,this.logger=n.getLogger("sip.transaction.nist",this.id),this.state=t.STATUS_TRYING,n.newTransaction(this)};(o.prototype=Object.create(e.EventEmitter.prototype)).stateChanged=function(e){this.state=e,this.emit("stateChanged")},o.prototype.timer_J=function(){this.logger.debug("Timer J expired for non-INVITE server transaction "+this.id),this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this)},o.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,this.logger.log("transport error occurred, deleting non-INVITE server transaction "+this.id),e.Timers.clearTimeout(this.J),this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this))},o.prototype.receiveResponse=function(n,i){var r=e.Utils.defer();if(100===n)switch(this.state){case t.STATUS_TRYING:this.stateChanged(t.STATUS_PROCEEDING),this.transport.send(i).catch(function(){this.onTransportError()}.bind(this));break;case t.STATUS_PROCEEDING:this.last_response=i,this.transport.send(i).then(function(){r.resolve()}).catch(function(){this.onTransportError(),r.reject()}.bind(this))}else if(n>=200&&n<=699)switch(this.state){case t.STATUS_TRYING:case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_COMPLETED),this.last_response=i,this.J=e.Timers.setTimeout(this.timer_J.bind(this),e.Timers.TIMER_J),this.transport.send(i).then(function(){r.resolve()}).catch(function(){this.onTransportError(),r.reject()}.bind(this))}return r.promise};var a=function(e,n){this.type=t.INVITE_SERVER,this.id=e.via_branch,this.request=e,this.transport=n.transport,this.ua=n,this.last_response="",e.server_transaction=this,this.logger=n.getLogger("sip.transaction.ist",this.id),this.state=t.STATUS_PROCEEDING,n.newTransaction(this),this.resendProvisionalTimer=null,e.reply(100)};(a.prototype=Object.create(e.EventEmitter.prototype)).stateChanged=function(e){this.state=e,this.emit("stateChanged")},a.prototype.timer_H=function(){this.logger.debug("Timer H expired for INVITE server transaction "+this.id),this.state===t.STATUS_COMPLETED&&this.logger.warn("transactions","ACK for INVITE server transaction was never received, call will be terminated"),this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this)},a.prototype.timer_I=function(){this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this)},a.prototype.timer_L=function(){this.logger.debug("Timer L expired for INVITE server transaction "+this.id),this.state===t.STATUS_ACCEPTED&&(this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this))},a.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,this.logger.log("transport error occurred, deleting INVITE server transaction "+this.id),null!==this.resendProvisionalTimer&&(e.Timers.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),e.Timers.clearTimeout(this.L),e.Timers.clearTimeout(this.H),e.Timers.clearTimeout(this.I),this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this))},a.prototype.resend_provisional=function(){this.transport.send(this.request).catch(function(){this.onTransportError()}.bind(this))},a.prototype.receiveResponse=function(n,i){var r=this,s=e.Utils.defer();if(n>=100&&n<=199)switch(this.state){case t.STATUS_PROCEEDING:this.transport.send(i).catch(function(){this.onTransportError()}.bind(this)),this.last_response=i}if(n>100&&n<=199&&this.state===t.STATUS_PROCEEDING)null===this.resendProvisionalTimer&&(this.resendProvisionalTimer=e.Timers.setInterval(r.resend_provisional.bind(r),e.Timers.PROVISIONAL_RESPONSE_INTERVAL));else if(n>=200&&n<=299)switch(this.state){case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_ACCEPTED),this.last_response=i,this.L=e.Timers.setTimeout(r.timer_L.bind(r),e.Timers.TIMER_L),null!==this.resendProvisionalTimer&&(e.Timers.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case t.STATUS_ACCEPTED:this.transport.send(i).then(function(){s.resolve()}).catch(function(e){this.logger.error(e),this.onTransportError(),s.reject()}.bind(this))}else if(n>=300&&n<=699)switch(this.state){case t.STATUS_PROCEEDING:null!==this.resendProvisionalTimer&&(e.Timers.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(i).then(function(){this.stateChanged(t.STATUS_COMPLETED),this.H=e.Timers.setTimeout(r.timer_H.bind(r),e.Timers.TIMER_H),s.resolve()}.bind(this)).catch(function(e){this.logger.error(e),this.onTransportError(),s.reject()}.bind(this))}return s.promise};e.Transactions={C:t,checkTransaction:function(n,i){var r;switch(i.method){case e.C.INVITE:if(r=n.transactions.ist[i.via_branch]){switch(r.state){case t.STATUS_PROCEEDING:r.transport.send(r.last_response)}return!0}break;case e.C.ACK:if(!(r=n.transactions.ist[i.via_branch]))return!1;if(r.state===t.STATUS_ACCEPTED)return!1;if(r.state===t.STATUS_COMPLETED)return r.stateChanged(t.STATUS_CONFIRMED),r.I=e.Timers.setTimeout(r.timer_I.bind(r),e.Timers.TIMER_I),!0;break;case e.C.CANCEL:return(r=n.transactions.ist[i.via_branch])?(i.reply_sl(200),r.state!==t.STATUS_PROCEEDING):(i.reply_sl(481),!0);default:if(r=n.transactions.nist[i.via_branch]){switch(r.state){case t.STATUS_TRYING:break;case t.STATUS_PROCEEDING:case t.STATUS_COMPLETED:r.transport.send(r.last_response)}return!0}}},NonInviteClientTransaction:i,InviteClientTransaction:r,AckClientTransaction:s,NonInviteServerTransaction:o,InviteServerTransaction:a}}},function(e,t,n){"use strict";e.exports=function(e){var t,i=n(17)(e),r={STATUS_EARLY:1,STATUS_CONFIRMED:2};(t=function(t,n,i,s){var o;if(this.uac_pending_reply=!1,this.uas_pending_reply=!1,!n.hasHeader("contact"))return{error:"unable to create a Dialog without Contact header field"};s=n instanceof e.IncomingResponse?n.status_code<200?r.STATUS_EARLY:r.STATUS_CONFIRMED:s||r.STATUS_CONFIRMED,o=n.parseHeader("contact"),"UAS"===i?(this.id={call_id:n.call_id,local_tag:n.to_tag,remote_tag:n.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=s,this.remote_seqnum=n.cseq,this.local_uri=n.parseHeader("to").uri,this.remote_uri=n.parseHeader("from").uri,this.remote_target=o.uri,this.route_set=n.getHeaders("record-route"),this.invite_seqnum=n.cseq,this.local_seqnum=n.cseq):"UAC"===i&&(this.id={call_id:n.call_id,local_tag:n.from_tag,remote_tag:n.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=s,this.invite_seqnum=n.cseq,this.local_seqnum=n.cseq,this.local_uri=n.parseHeader("from").uri,this.pracked=[],this.remote_uri=n.parseHeader("to").uri,this.remote_target=o.uri,this.route_set=n.getHeaders("record-route").reverse()),this.logger=t.ua.getLogger("sip.dialog",this.id.toString()),this.owner=t,t.ua.dialogs[this.id.toString()]=this,this.logger.log("new "+i+" dialog created with status "+(this.state===r.STATUS_EARLY?"EARLY":"CONFIRMED")),t.emit("dialog",this)}).prototype={update:function(e,t){this.state=r.STATUS_CONFIRMED,this.logger.log("dialog "+this.id.toString()+"  changed to CONFIRMED state"),"UAC"===t&&(this.route_set=e.getHeaders("record-route").reverse())},terminate:function(){this.logger.log("dialog "+this.id.toString()+" deleted"),this.sessionDescriptionHandler&&this.state!==r.STATUS_CONFIRMED&&this.sessionDescriptionHandler.close(),delete this.owner.ua.dialogs[this.id.toString()]},createRequest:function(t,n,i){var r,s;return n=(n||[]).slice(),this.local_seqnum||(this.local_seqnum=Math.floor(1e4*Math.random())),r=t===e.C.CANCEL||t===e.C.ACK?this.invite_seqnum:this.local_seqnum+=1,(s=new e.OutgoingRequest(t,this.remote_target,this.owner.ua,{cseq:r,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set},n,i)).dialog=this,s},checkInDialogRequest:function(t){var n=this;if(this.remote_seqnum){if(t.cseq<this.remote_seqnum)return t.method!==e.C.ACK&&t.reply(500),t.cseq===this.invite_seqnum}else this.remote_seqnum=t.cseq;switch(t.method){case e.C.INVITE:if(!0===this.uac_pending_reply)t.reply(491);else{if(!0===this.uas_pending_reply&&t.cseq>this.remote_seqnum){var i=1+(10*Math.random()|0);return t.reply(500,null,["Retry-After:"+i]),this.remote_seqnum=t.cseq,!1}this.uas_pending_reply=!0,t.server_transaction.on("stateChanged",function t(){this.state!==e.Transactions.C.STATUS_ACCEPTED&&this.state!==e.Transactions.C.STATUS_COMPLETED&&this.state!==e.Transactions.C.STATUS_TERMINATED||(this.removeListener("stateChanged",t),n.uas_pending_reply=!1)})}t.hasHeader("contact")&&t.server_transaction.on("stateChanged",function(){this.state===e.Transactions.C.STATUS_ACCEPTED&&(n.remote_target=t.parseHeader("contact").uri)});break;case e.C.NOTIFY:t.hasHeader("contact")&&t.server_transaction.on("stateChanged",function(){this.state===e.Transactions.C.STATUS_COMPLETED&&(n.remote_target=t.parseHeader("contact").uri)})}return t.cseq>this.remote_seqnum&&(this.remote_seqnum=t.cseq),!0},sendRequest:function(e,t,n){var r=((n=n||{}).extraHeaders||[]).slice(),s=null;n.body&&(n.body.body?s=n.body:((s={}).body=n.body,n.contentType&&(s.contentType=n.contentType)));var o=this.createRequest(t,r,s);return new i(this,e,o).send(),o},receiveRequest:function(e){this.checkInDialogRequest(e)&&this.owner.receiveRequest(e)}},t.C=r,e.Dialog=t}},function(e,t,n){"use strict";e.exports=function(e){var t;return(t=function(e,t,n){this.dialog=e,this.applicant=t,this.request=n,this.reattempt=!1,this.reattemptTimer=null}).prototype={send:function(){var t=this,n=new e.RequestSender(this,this.dialog.owner.ua);n.send(),this.request.method===e.C.INVITE&&n.clientTransaction.state!==e.Transactions.C.STATUS_TERMINATED&&(this.dialog.uac_pending_reply=!0,n.clientTransaction.on("stateChanged",function n(){this.state!==e.Transactions.C.STATUS_ACCEPTED&&this.state!==e.Transactions.C.STATUS_COMPLETED&&this.state!==e.Transactions.C.STATUS_TERMINATED||(this.removeListener("stateChanged",n),t.dialog.uac_pending_reply=!1)}))},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(t){var n=this;408===t.status_code||481===t.status_code?this.applicant.onDialogError(t):t.method===e.C.INVITE&&491===t.status_code?this.reattempt?this.applicant.receiveResponse(t):(this.request.cseq.value=this.dialog.local_seqnum+=1,this.reattemptTimer=e.Timers.setTimeout(function(){n.applicant.owner.status!==e.Session.C.STATUS_TERMINATED&&(n.reattempt=!0,n.request_sender.send())},this.getReattemptTimeout())):this.applicant.receiveResponse(t)}},t}},function(e,t,n){"use strict";e.exports=function(e){var t;(t=function(t,n){this.logger=n.getLogger("sip.requestsender"),this.ua=n,this.applicant=t,this.method=t.request.method,this.request=t.request,this.credentials=null,this.challenged=!1,this.staled=!1,n.status!==e.UA.C.STATUS_USER_CLOSED||this.method===e.C.BYE&&this.method===e.C.ACK||this.onTransportError()}).prototype={send:function(){switch(this.method){case"INVITE":this.clientTransaction=new e.Transactions.InviteClientTransaction(this,this.request,this.ua.transport);break;case"ACK":this.clientTransaction=new e.Transactions.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new e.Transactions.NonInviteClientTransaction(this,this.request,this.ua.transport)}return this.clientTransaction.send(),this.clientTransaction},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(t){var n,i,r,s=t.status_code;if(401===s||407===s){if(401===t.status_code?(i=t.parseHeader("www-authenticate"),r="authorization"):(i=t.parseHeader("proxy-authenticate"),r="proxy-authorization"),!i)return this.logger.warn(t.status_code+" with wrong or missing challenge, cannot authenticate"),void this.applicant.receiveResponse(t);if(!this.challenged||!this.staled&&!0===i.stale){if(this.credentials||(this.credentials=this.ua.configuration.authenticationFactory(this.ua)),!this.credentials.authenticate(this.request,i))return void this.applicant.receiveResponse(t);this.challenged=!0,i.stale&&(this.staled=!0),t.method===e.C.REGISTER?n=this.applicant.cseq+=1:this.request.dialog?n=this.request.dialog.local_seqnum+=1:(n=this.request.cseq+1,this.request.cseq=n),this.request.setHeader("cseq",n+" "+this.method),this.request.setHeader(r,this.credentials.toString()),this.send()}else this.applicant.receiveResponse(t)}else this.applicant.receiveResponse(t)}},e.RequestSender=t}},function(e,t,n){"use strict";e.exports=function(e){var t;(t=function(t){var n={};this.registrar=t.configuration.registrarServer,this.expires=t.configuration.registerExpires,this.contact=t.contact.toString(),this.contact+=";reg-id=1",this.contact+=';+sip.instance="<urn:uuid:'+t.configuration.instanceId+'>"',this.call_id=e.Utils.createRandomToken(22),this.cseq=Math.floor(1e4*Math.random()),this.to_uri=t.configuration.uri,n.to_uri=this.to_uri,n.to_displayName=t.configuration.displayName,n.call_id=this.call_id,n.cseq=this.cseq,e.Utils.augment(this,e.ClientContext,[t,"REGISTER",this.registrar,{params:n}]),this.registrationTimer=null,this.registrationExpiredTimer=null,this.registered=!1,this.logger=t.getLogger("sip.registercontext"),t.on("transportCreated",function(e){e.on("disconnected",this.onTransportDisconnected.bind(this))}.bind(this))}).prototype=Object.create({},{register:{writable:!0,value:function(t){var n,i=this;this.options=t||{},(n=(this.options.extraHeaders||[]).slice()).push("Contact: "+this.contact+";expires="+this.expires),n.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.closeHeaders=this.options.closeWithHeaders?(this.options.extraHeaders||[]).slice():[],this.receiveResponse=function(t){var n,r,s,o=t.getHeaders("contact").length;if(t.cseq===this.cseq)switch(null!==this.registrationTimer&&(e.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null),!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",t);break;case/^2[0-9]{2}$/.test(t.status_code):if(this.emit("accepted",t),t.hasHeader("expires")&&(r=t.getHeader("expires")),null!==this.registrationExpiredTimer&&(e.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null),!o){this.logger.warn("no Contact header in response to REGISTER, response ignored");break}for(;o--;){if((n=t.parseHeader("contact",o)).uri.user===this.ua.contact.uri.user){r=n.getParam("expires");break}n=null}if(!n){this.logger.warn("no Contact header pointing to us, response ignored");break}r||(r=this.expires),this.registrationTimer=e.Timers.setTimeout(function(){i.registrationTimer=null,i.register(i.options)},1e3*r-3e3),this.registrationExpiredTimer=e.Timers.setTimeout(function(){i.logger.warn("registration expired"),i.registered&&i.unregistered(null,e.C.causes.EXPIRES)},1e3*r),n.hasParam("temp-gruu")&&(this.ua.contact.temp_gruu=e.URI.parse(n.getParam("temp-gruu").replace(/"/g,""))),n.hasParam("pub-gruu")&&(this.ua.contact.pub_gruu=e.URI.parse(n.getParam("pub-gruu").replace(/"/g,""))),this.registered=!0,this.emit("registered",t||null);break;case/^423$/.test(t.status_code):t.hasHeader("min-expires")?(this.expires=t.getHeader("min-expires"),this.register(this.options)):(this.logger.warn("423 response received for REGISTER without Min-Expires"),this.registrationFailure(t,e.C.causes.SIP_FAILURE_CODE));break;default:s=e.Utils.sipErrorCause(t.status_code),this.registrationFailure(t,s)}},this.onRequestTimeout=function(){this.registrationFailure(null,e.C.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.registrationFailure(null,e.C.causes.CONNECTION_ERROR)},this.cseq++,this.request.cseq=this.cseq,this.request.setHeader("cseq",this.cseq+" REGISTER"),this.request.extraHeaders=n,this.send()}},registrationFailure:{writable:!0,value:function(e,t){this.emit("failed",e||null,t||null)}},onTransportDisconnected:{writable:!0,value:function(){this.registered_before=this.registered,null!==this.registrationTimer&&(e.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null),null!==this.registrationExpiredTimer&&(e.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null),this.registered&&this.unregistered(null,e.C.causes.CONNECTION_ERROR)}},onTransportConnected:{writable:!0,value:function(){this.register(this.options)}},close:{writable:!0,value:function(){var e={all:!1,extraHeaders:this.closeHeaders};this.registered_before=this.registered,this.registered&&this.unregister(e)}},unregister:{writable:!0,value:function(t){var n;t=t||{},this.registered||t.all||this.logger.warn("Already unregistered, but sending an unregister anyways."),n=(t.extraHeaders||[]).slice(),this.registered=!1,null!==this.registrationTimer&&(e.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null),t.all?(n.push("Contact: *"),n.push("Expires: 0")):n.push("Contact: "+this.contact+";expires=0"),this.receiveResponse=function(t){var n;switch(!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",t);break;case/^2[0-9]{2}$/.test(t.status_code):this.emit("accepted",t),null!==this.registrationExpiredTimer&&(e.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null),this.unregistered(t);break;default:n=e.Utils.sipErrorCause(t.status_code),this.unregistered(t,n)}},this.onRequestTimeout=function(){},this.cseq++,this.request.cseq=this.cseq,this.request.setHeader("cseq",this.cseq+" REGISTER"),this.request.extraHeaders=n,this.send()}},unregistered:{writable:!0,value:function(e,t){this.registered=!1,this.emit("unregistered",e||null,t||null)}}}),e.RegisterContext=t}},function(e,t,n){"use strict";e.exports=function(e){var t=function(){};return t.prototype=Object.create(e.prototype,{close:{value:function(){}},getDescription:{value:function(e,t){}},hasDescription:{value:function(e){}},holdModifier:{value:function(e){}},setDescription:{value:function(e,t,n){}},sendDtmf:{value:function(e,t){}},getDirection:{value:function(){}}}),t}},function(e,t,n){"use strict";e.exports=function(e){var t;((t=function(t,n,i,r){var s=i;if(void 0===i)throw new TypeError("Not enough arguments");if(this.ua=t,this.logger=t.getLogger("sip.clientcontext"),this.method=n,!(i=t.normalizeTarget(i)))throw new TypeError("Invalid target: "+s);(r=Object.create(r||Object.prototype)).extraHeaders=(r.extraHeaders||[]).slice(),this.request=new e.OutgoingRequest(this.method,i,this.ua,r.params,r.extraHeaders),r.body&&(this.body={},this.body.body=r.body,r.contentType&&(this.body.contentType=r.contentType),this.request.body=this.body),this.localIdentity=this.request.from,this.remoteIdentity=this.request.to,this.data={}}).prototype=Object.create(e.EventEmitter.prototype)).send=function(){return new e.RequestSender(this,this.ua).send(),this},t.prototype.cancel=function(t){(t=t||{}).extraHeaders=(t.extraHeaders||[]).slice();var n=e.Utils.getCancelReason(t.status_code,t.reason_phrase);this.request.cancel(n,t.extraHeaders),this.emit("cancel")},t.prototype.receiveResponse=function(t){var n=e.Utils.getReasonPhrase(t.status_code);switch(!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",t,n);break;case/^2[0-9]{2}$/.test(t.status_code):this.ua.applicants[this]&&delete this.ua.applicants[this],this.emit("accepted",t,n);break;default:this.ua.applicants[this]&&delete this.ua.applicants[this],this.emit("rejected",t,n),this.emit("failed",t,n)}},t.prototype.onRequestTimeout=function(){this.emit("failed",null,e.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){this.emit("failed",null,e.C.causes.CONNECTION_ERROR)},e.ClientContext=t}},function(e,t,n){"use strict";e.exports=function(e){var t;((t=function(t,n){this.ua=t,this.logger=t.getLogger("sip.servercontext"),this.request=n,n.method===e.C.INVITE?this.transaction=new e.Transactions.InviteServerTransaction(n,t):this.transaction=new e.Transactions.NonInviteServerTransaction(n,t),n.body&&(this.body=n.body),n.hasHeader("Content-Type")&&(this.contentType=n.getHeader("Content-Type")),this.method=n.method,this.data={},this.localIdentity=n.to,this.remoteIdentity=n.from,n.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=new e.NameAddrHeader.parse(n.getHeader("P-Asserted-Identity")))}).prototype=Object.create(e.EventEmitter.prototype)).progress=function(e){return(e=Object.create(e||Object.prototype)).statusCode||(e.statusCode=180),e.minCode=100,e.maxCode=199,e.events=["progress"],this.reply(e)},t.prototype.accept=function(e){return(e=Object.create(e||Object.prototype)).statusCode||(e.statusCode=200),e.minCode=200,e.maxCode=299,e.events=["accepted"],this.reply(e)},t.prototype.reject=function(e){return(e=Object.create(e||Object.prototype)).statusCode||(e.statusCode=480),e.minCode=300,e.maxCode=699,e.events=["rejected","failed"],this.reply(e)},t.prototype.reply=function(t){var n,i=(t=t||{}).statusCode||100,r=t.minCode||100,s=t.maxCode||699,o=e.Utils.getReasonPhrase(i,t.reasonPhrase),a=t.extraHeaders||[],u=t.body,l=t.events||[];if(i<r||i>s)throw new TypeError("Invalid statusCode: "+i);return n=this.request.reply(i,o,a,u),l.forEach(function(e){this.emit(e,n,o)},this),this},t.prototype.onRequestTimeout=function(){this.emit("failed",null,e.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){this.emit("failed",null,e.C.causes.CONNECTION_ERROR)},e.ServerContext=t}},function(e,t,n){"use strict";e.exports=function(e){var t,i,r,s,o,a=n(24)(e),u={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_PRACK:6,STATUS_WAITING_FOR_ACK:7,STATUS_CANCELED:8,STATUS_TERMINATED:9,STATUS_ANSWERED_WAITING_FOR_PRACK:10,STATUS_EARLY_MEDIA:11,STATUS_CONFIRMED:12};(t=function(t){if(this.status=u.STATUS_NULL,this.dialog=null,this.pendingReinvite=!1,this.earlyDialogs={},!t)throw new e.Exceptions.SessionDescriptionHandlerMissing("A session description handler is required for the session to function");this.sessionDescriptionHandlerFactory=t,this.hasOffer=!1,this.hasAnswer=!1,this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null,rel1xxTimer:null,prackTimer:null},this.startTime=null,this.endTime=null,this.tones=null,this.local_hold=!1,this.early_sdp=null,this.rel100=e.C.supported.UNSUPPORTED}).prototype={dtmf:function(t,n){var i=[],r=this,s=this.ua.configuration.dtmfType;if(n=n||{},void 0===t)throw new TypeError("Not enough arguments");if(this.status!==u.STATUS_CONFIRMED&&this.status!==u.STATUS_WAITING_FOR_ACK)throw new e.Exceptions.InvalidStateError(this.status);if("string"!=typeof t&&"number"!=typeof t||!t.toString().match(/^[0-9A-D#*,]+$/i))throw new TypeError("Invalid tones: "+t);var o=function(){var t,i;if(r.status===u.STATUS_TERMINATED||!r.tones||0===r.tones.length)return r.tones=null,this;(t=r.tones.shift()).on("failed",function(){r.tones=null}),t.send(n),i=t.duration+t.interToneGap,e.Timers.setTimeout(o,i)};(t=t.toString(),s===e.C.dtmfType.RTP)&&(this.sessionDescriptionHandler.sendDtmf(t,n)||(this.logger.warn("Attempt to use dtmfType 'RTP' has failed, falling back to INFO packet method"),s=e.C.dtmfType.INFO));if(s===e.C.dtmfType.INFO){for(t=t.split("");t.length>0;)i.push(new a(this,t.shift(),n));if(this.tones)return this.tones=this.tones.concat(i),this;this.tones=i,o()}return this},bye:function(t){var n=(t=Object.create(t||Object.prototype)).statusCode;if(this.status===u.STATUS_TERMINATED)return this.logger.error("Error: Attempted to send BYE in a terminated session."),this;if(this.logger.log("terminating Session"),n&&(n<200||n>=700))throw new TypeError("Invalid statusCode: "+n);return t.receiveResponse=function(){},this.sendRequest(e.C.BYE,t).terminated()},refer:function(t,n){if(n=n||{},this.status!==u.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);this.referContext=new e.ReferClientContext(this.ua,this,t,n),this.emit("referRequested",this.referContext),this.referContext.refer(n)},sendRequest:function(t,n){n=n||{};var i=this,r=new e.OutgoingRequest(t,this.dialog.remote_target,this.ua,{cseq:n.cseq||(this.dialog.local_seqnum+=1),call_id:this.dialog.id.call_id,from_uri:this.dialog.local_uri,from_tag:this.dialog.id.local_tag,to_uri:this.dialog.remote_uri,to_tag:this.dialog.id.remote_tag,route_set:this.dialog.route_set,statusCode:n.statusCode,reasonPhrase:n.reasonPhrase},n.extraHeaders||[],n.body);return new e.RequestSender({request:r,onRequestTimeout:function(){i.onRequestTimeout()},onTransportError:function(){i.onTransportError()},receiveResponse:n.receiveResponse||function(e){i.receiveNonInviteResponse(e)}},this.ua).send(),this.emit(t.toLowerCase(),r),this},close:function(){var t;if(this.status===u.STATUS_TERMINATED)return this;for(t in this.logger.log("closing INVITE session "+this.id),this.sessionDescriptionHandler&&this.sessionDescriptionHandler.close(),this.timers)e.Timers.clearTimeout(this.timers[t]);for(t in this.dialog&&(this.dialog.terminate(),delete this.dialog),this.earlyDialogs)this.earlyDialogs[t].terminate(),delete this.earlyDialogs[t];return this.status=u.STATUS_TERMINATED,this.ua.transport.removeListener("transportError",this.errorListener),delete this.ua.sessions[this.id],this},createDialog:function(t,n,i){var r,s,o=t["UAS"===n?"to_tag":"from_tag"],a=t["UAS"===n?"from_tag":"to_tag"],u=t.call_id+o+a;if(s=this.earlyDialogs[u],i)return!!s||((s=new e.Dialog(this,t,n,e.Dialog.C.STATUS_EARLY)).error?(this.logger.error(s.error),this.failed(t,e.C.causes.INTERNAL_ERROR),!1):(this.earlyDialogs[u]=s,!0));if(s){for(var l in s.update(t,n),this.dialog=s,delete this.earlyDialogs[u],this.earlyDialogs)this.earlyDialogs[l].terminate(),delete this.earlyDialogs[l];return!0}return(r=new e.Dialog(this,t,n)).error?(this.logger.error(r.error),this.failed(t,e.C.causes.INTERNAL_ERROR),!1):(this.to_tag=t.to_tag,this.dialog=r,!0)},hold:function(t,n){if(this.status!==u.STATUS_WAITING_FOR_ACK&&this.status!==u.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);this.local_hold?this.logger.log("Session is already on hold, cannot put it on hold again"):((t=t||{}).modifiers=n||[],t.modifiers.push(this.sessionDescriptionHandler.holdModifier),this.local_hold=!0,this.sendReinvite(t))},unhold:function(t,n){if(this.status!==u.STATUS_WAITING_FOR_ACK&&this.status!==u.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);this.local_hold?(t=t||{},n&&(t.modifiers=n),this.local_hold=!1,this.sendReinvite(t)):this.logger.log("Session is not on hold, cannot unhold it")},reinvite:function(e,t){return e=e||{},t&&(e.modifiers=t),this.sendReinvite(e)},receiveReinvite:function(t){var n,i=this;if(i.emit("reinvite",this),t.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=new e.NameAddrHeader.parse(t.getHeader("P-Asserted-Identity"))),"0"!==t.getHeader("Content-Length")||t.getHeader("Content-Type")){if(!this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type")))return t.reply(415),void this.emit("reinviteFailed",i);n=this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(this.sessionDescriptionHandler.getDescription.bind(this.sessionDescriptionHandler,this.sessionDescriptionHandlerOptions,this.modifiers))}else n=this.sessionDescriptionHandler.getDescription(this.sessionDescriptionHandlerOptions,this.modifiers);this.receiveRequest=function(t){t.method===e.C.ACK&&this.status===u.STATUS_WAITING_FOR_ACK?this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type"))?(this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){e.Timers.clearTimeout(this.timers.ackTimer),e.Timers.clearTimeout(this.timers.invite2xxTimer),this.status=u.STATUS_CONFIRMED,this.emit("confirmed",t)}.bind(this))):(e.Timers.clearTimeout(this.timers.ackTimer),e.Timers.clearTimeout(this.timers.invite2xxTimer),this.status=u.STATUS_CONFIRMED,this.emit("confirmed",t)):e.Session.prototype.receiveRequest.apply(this,[t])}.bind(this),n.catch(function(n){var r;throw n instanceof e.Exceptions.SessionDescriptionHandlerError?r=500:n instanceof e.Exceptions.RenegotiationError?(i.emit("renegotiationError",n),i.logger.warn(n),r=488):(i.logger.error(n),r=488),t.reply(r),i.emit("reinviteFailed",i),n}).then(function(e){var n=["Contact: "+i.contact];t.reply(200,null,n,e,function(){i.status=u.STATUS_WAITING_FOR_ACK,i.setACKTimer(),i.emit("reinviteAccepted",i)})})},sendReinvite:function(t){if(this.pendingReinvite)this.logger.warn("Reinvite in progress. Please wait until complete, then try again.");else{this.pendingReinvite=!0,(t=t||{}).modifiers=t.modifiers||[];var n=this,i=(t.extraHeaders||[]).slice();i.push("Contact: "+this.contact),i.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.sessionDescriptionHandler.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers).then(function(t){n.sendRequest(e.C.INVITE,{extraHeaders:i,body:t,receiveResponse:n.receiveReinviteResponse.bind(n)})}).catch(function(t){if(t instanceof e.Exceptions.RenegotiationError)return n.pendingReinvite=!1,n.emit("renegotiationError",t),n.logger.warn("Renegotiation Error"),void n.logger.warn(t);n.logger.error("sessionDescriptionHandler error"),n.logger.error(t)})}},receiveRequest:function(t){switch(t.method){case e.C.BYE:t.reply(200),this.status===u.STATUS_CONFIRMED&&(this.emit("bye",t),this.terminated(t,e.C.causes.BYE));break;case e.C.INVITE:this.status===u.STATUS_CONFIRMED&&(this.logger.log("re-INVITE received"),this.receiveReinvite(t));break;case e.C.INFO:if(this.status===u.STATUS_CONFIRMED||this.status===u.STATUS_WAITING_FOR_ACK){if(this.onInfo)return this.onInfo(t);var n,i,r,s=t.getHeader("content-type"),o=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,l=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;s&&(s.match(/^application\/dtmf-relay/i)?(t.body&&2===(n=t.body.split("\r\n",2)).length&&(o.test(n[0])&&(i=n[0].replace(o,"$2")),l.test(n[1])&&(r=parseInt(n[1].replace(l,"$2"),10))),new a(this,i,{duration:r}).init_incoming(t)):t.reply(415,null,["Accept: application/dtmf-relay"]))}break;case e.C.REFER:if(this.status===u.STATUS_CONFIRMED)if(this.logger.log("REFER received"),this.referContext=new e.ReferServerContext(this.ua,t),this.listeners("referRequested").length)this.emit("referRequested",this.referContext);else{this.logger.log("No referRequested listeners, automatically accepting and following the refer");var c={followRefer:!0};this.passedOptions&&(c.inviteOptions=this.passedOptions),this.referContext.accept(c,this.modifiers)}break;case e.C.NOTIFY:if(this.referContext&&this.referContext instanceof e.ReferClientContext&&t.hasHeader("event")&&/^refer(;.*)?$/.test(t.getHeader("event")))return void this.referContext.receiveNotify(t);t.reply(200,"OK"),this.emit("notify",t)}},receiveReinviteResponse:function(t){var n=this;if(this.status!==u.STATUS_TERMINATED)if(this.pendingReinvite)switch(!0){case/^1[0-9]{2}$/.test(t.status_code):break;case/^2[0-9]{2}$/.test(t.status_code):if(this.status=u.STATUS_CONFIRMED,this.emit("ack",t.transaction.sendACK()),this.pendingReinvite=!1,e.Timers.clearTimeout(n.timers.invite2xxTimer),!this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type"))){this.logger.error("2XX response received to re-invite but did not have a description"),this.emit("reinviteFailed",n),this.emit("renegotiationError",new e.Exceptions.RenegotiationError("2XX response received to re-invite but did not have a description"));break}this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).catch(function(t){n.logger.error("Could not set the description in 2XX response"),n.logger.error(t),n.emit("reinviteFailed",n),n.emit("renegotiationError",t),n.sendRequest(e.C.BYE,{extraHeaders:["Reason: "+e.Utils.getReasonHeaderValue(488,"Not Acceptable Here")]}),n.terminated(null,e.C.causes.INCOMPATIBLE_SDP)}).then(function(){n.emit("reinviteAccepted",n)});break;default:this.pendingReinvite=!1,this.logger.log("Received a non 1XX or 2XX response to a re-invite"),this.emit("reinviteFailed",n),this.emit("renegotiationError",new e.Exceptions.RenegotiationError("Invalid response to a re-invite"))}else this.logger.error("Received reinvite response, but have no pending reinvite");else this.logger.error("Received reinvite response, but in STATUS_TERMINATED")},acceptAndTerminate:function(t,n,i){var r=[];return n&&r.push("Reason: "+e.Utils.getReasonHeaderValue(n,i)),(this.dialog||this.createDialog(t,"UAC"))&&(this.emit("ack",t.transaction.sendACK()),this.sendRequest(e.C.BYE,{extraHeaders:r})),this},setInvite2xxTimer:function(t,n){var i=this,r=e.Timers.T1;this.timers.invite2xxTimer=e.Timers.setTimeout(function s(){if(i.status===u.STATUS_WAITING_FOR_ACK){i.logger.log("no ACK received, attempting to retransmit OK");var o=["Contact: "+i.contact];t.reply(200,null,o,n),r=Math.min(2*r,e.Timers.T2),i.timers.invite2xxTimer=e.Timers.setTimeout(s,r)}},r)},setACKTimer:function(){var t=this;this.timers.ackTimer=e.Timers.setTimeout(function(){t.status===u.STATUS_WAITING_FOR_ACK&&(t.logger.log("no ACK received for an extended period of time, terminating the call"),e.Timers.clearTimeout(t.timers.invite2xxTimer),t.sendRequest(e.C.BYE),t.terminated(null,e.C.causes.NO_ACK))},e.Timers.TIMER_H)},onTransportError:function(){this.status!==u.STATUS_CONFIRMED&&this.status!==u.STATUS_TERMINATED&&this.failed(null,e.C.causes.CONNECTION_ERROR)},onRequestTimeout:function(){this.status===u.STATUS_CONFIRMED?this.terminated(null,e.C.causes.REQUEST_TIMEOUT):this.status!==u.STATUS_TERMINATED&&(this.failed(null,e.C.causes.REQUEST_TIMEOUT),this.terminated(null,e.C.causes.REQUEST_TIMEOUT))},onDialogError:function(t){this.status===u.STATUS_CONFIRMED?this.terminated(t,e.C.causes.DIALOG_ERROR):this.status!==u.STATUS_TERMINATED&&(this.failed(t,e.C.causes.DIALOG_ERROR),this.terminated(t,e.C.causes.DIALOG_ERROR))},failed:function(e,t){return this.status===u.STATUS_TERMINATED?this:(this.emit("failed",e||null,t||null),this)},rejected:function(e,t){return this.emit("rejected",e||null,t||null),this},canceled:function(){return this.sessionDescriptionHandler&&this.sessionDescriptionHandler.close(),this.emit("cancel"),this},accepted:function(t,n){return n=e.Utils.getReasonPhrase(t&&t.status_code,n),this.startTime=new Date,this.replacee&&(this.replacee.emit("replaced",this),this.replacee.terminate()),this.emit("accepted",t,n),this},terminated:function(e,t){return this.status===u.STATUS_TERMINATED?this:(this.endTime=new Date,this.close(),this.emit("terminated",e||null,t||null),this)},connecting:function(e){return this.emit("connecting",{request:e}),this}},t.C=u,e.Session=t,(i=function(t,n){var i,r=this,s=n.getHeader("Content-Type"),o=n.parseHeader("Content-Disposition");function a(e,t){n.hasHeader(e)&&n.getHeader(e).toLowerCase().indexOf("100rel")>=0&&(r.rel100=t)}if(e.Utils.augment(this,e.ServerContext,[t,n]),e.Utils.augment(this,e.Session,[t.configuration.sessionDescriptionHandlerFactory]),o&&"render"===o.type&&(this.renderbody=n.body,this.rendertype=s),this.status=u.STATUS_INVITE_RECEIVED,this.from_tag=n.from_tag,this.id=n.call_id+this.from_tag,this.request=n,this.contact=this.ua.contact.toString(),this.receiveNonInviteResponse=function(){},this.logger=t.getLogger("sip.inviteservercontext",this.id),this.ua.sessions[this.id]=this,n.hasHeader("expires")&&(i=1e3*n.getHeader("expires")),a("require",e.C.supported.REQUIRED),a("supported",e.C.supported.SUPPORTED),n.to_tag=e.Utils.newTag(),this.createDialog(n,"UAS",!0)){var l={extraHeaders:["Contact: "+r.contact]};r.rel100!==e.C.supported.REQUIRED&&r.progress(l),r.status=u.STATUS_WAITING_FOR_ANSWER,r.timers.userNoAnswerTimer=e.Timers.setTimeout(function(){n.reply(408),r.failed(n,e.C.causes.NO_ANSWER),r.terminated(n,e.C.causes.NO_ANSWER)},r.ua.configuration.noAnswerTimeout),i&&(r.timers.expiresTimer=e.Timers.setTimeout(function(){r.status===u.STATUS_WAITING_FOR_ANSWER&&(n.reply(487),r.failed(n,e.C.causes.EXPIRES),r.terminated(n,e.C.causes.EXPIRES))},i)),this.errorListener=this.onTransportError.bind(this),t.transport.on("transportError",this.errorListener)}else n.reply(500,"Missing Contact header field")}).prototype=Object.create({},{reject:{writable:!0,value:function(t){if(this.status===u.STATUS_TERMINATED)throw new e.Exceptions.InvalidStateError(this.status);return this.logger.log("rejecting RTCSession"),e.ServerContext.prototype.reject.call(this,t),this.terminated()}},terminate:{writable:!0,value:function(t){var n,i=((t=t||{}).extraHeaders||[]).slice(),r=t.body,s=this;return this.status===u.STATUS_WAITING_FOR_ACK&&this.request.server_transaction.state!==e.Transactions.C.STATUS_TERMINATED?(n=this.dialog,this.receiveRequest=function(t){t.method===e.C.ACK&&(this.sendRequest(e.C.BYE,{extraHeaders:i,body:r}),n.terminate())},this.request.server_transaction.on("stateChanged",function(){this.state===e.Transactions.C.STATUS_TERMINATED&&this.dialog&&(this.request=new e.OutgoingRequest(e.C.BYE,this.dialog.remote_target,this.ua,{cseq:this.dialog.local_seqnum+=1,call_id:this.dialog.id.call_id,from_uri:this.dialog.local_uri,from_tag:this.dialog.id.local_tag,to_uri:this.dialog.remote_uri,to_tag:this.dialog.id.remote_tag,route_set:this.dialog.route_set},i,r),new e.RequestSender({request:this.request,onRequestTimeout:function(){s.onRequestTimeout()},onTransportError:function(){s.onTransportError()},receiveResponse:function(){}},this.ua).send(),n.terminate())}),this.emit("bye",this.request),this.terminated(),this.dialog=n,this.ua.dialogs[n.id.toString()]=n):this.status===u.STATUS_CONFIRMED?this.bye(t):this.reject(t),this}},progress:{writable:!0,value:function(t){var n,i=(t=t||{}).statusCode||180,r=t.reasonPhrase,s=(t.extraHeaders||[]).slice(),o=t.body;if(i<100||i>199)throw new TypeError("Invalid statusCode: "+i);if(this.isCanceled||this.status===u.STATUS_TERMINATED)return this;function a(){i=t.statusCode||183,this.status=u.STATUS_WAITING_FOR_PRACK,s.push("Contact: "+this.contact),s.push("Require: 100rel"),s.push("RSeq: "+Math.floor(1e4*Math.random())),this.sessionDescriptionHandler.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers).then(function(t){if(!this.isCanceled&&this.status!==u.STATUS_TERMINATED){this.early_sdp=t.body,this[this.hasOffer?"hasAnswer":"hasOffer"]=!0;var o=e.Timers.T1;this.timers.rel1xxTimer=e.Timers.setTimeout(function n(){this.request.reply(i,null,s,t),o*=2,this.timers.rel1xxTimer=e.Timers.setTimeout(n.bind(this),o)}.bind(this),o),this.timers.prackTimer=e.Timers.setTimeout(function(){this.status===u.STATUS_WAITING_FOR_PRACK&&(this.logger.log("no PRACK received, rejecting the call"),e.Timers.clearTimeout(this.timers.rel1xxTimer),this.request.reply(504),this.terminated(null,e.C.causes.NO_PRACK))}.bind(this),64*e.Timers.T1),n=this.request.reply(i,r,s,t),this.emit("progress",n,r)}}.bind(this),function(){this.request.reply(480),this.failed(null,e.C.causes.WEBRTC_ERROR),this.terminated(null,e.C.causes.WEBRTC_ERROR)}.bind(this))}return 100!==t.statusCode&&(this.rel100===e.C.supported.REQUIRED||this.rel100===e.C.supported.SUPPORTED&&t.rel100||this.rel100===e.C.supported.SUPPORTED&&this.ua.configuration.rel100===e.C.supported.REQUIRED)?(this.sessionDescriptionHandler=this.setupSessionDescriptionHandler(),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),this.sessionDescriptionHandler.hasDescription(this.request.getHeader("Content-Type"))?(this.hasOffer=!0,this.sessionDescriptionHandler.setDescription(this.request.body,t.sessionDescriptionHandlerOptions,t.modifiers).then(a.apply(this)).catch(function(t){this.logger.warn("invalid description"),this.logger.warn(t),this.failed(null,e.C.causes.WEBRTC_ERROR),this.terminated(null,e.C.causes.WEBRTC_ERROR)}.bind(this))):a.apply(this)):function(){n=this.request.reply(i,r,s,o),this.emit("progress",n,r)}.apply(this),this}},accept:{writable:!0,value:function(t){t=t||{},this.onInfo=t.onInfo;var n=this,i=this.request,r=(t.extraHeaders||[]).slice(),s=function(t){var s;r.push("Contact: "+n.contact),r.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),n.hasOffer?n.hasAnswer=!0:n.hasOffer=!0,s=i.reply(200,null,r,t,function(){n.status=u.STATUS_WAITING_FOR_ACK,n.setInvite2xxTimer(i,t),n.setACKTimer()},function(){n.failed(null,e.C.causes.CONNECTION_ERROR),n.terminated(null,e.C.causes.CONNECTION_ERROR)}),n.status!==u.STATUS_TERMINATED&&n.accepted(s,e.Utils.getReasonPhrase(200))},o=function(t){t instanceof e.Exceptions.SessionDescriptionHandlerError&&(n.logger.log(t.message),n.logger.log(t.error)),n.status!==u.STATUS_TERMINATED&&(n.request.reply(480),n.failed(null,e.C.causes.WEBRTC_ERROR),n.terminated(null,e.C.causes.WEBRTC_ERROR))};if(this.status===u.STATUS_WAITING_FOR_PRACK)return this.status=u.STATUS_ANSWERED_WAITING_FOR_PRACK,this;if(this.status===u.STATUS_WAITING_FOR_ANSWER)this.status=u.STATUS_ANSWERED;else if(this.status!==u.STATUS_EARLY_MEDIA)throw new e.Exceptions.InvalidStateError(this.status);if(!this.createDialog(i,"UAS"))return i.reply(500,"Missing Contact header field"),this;if(e.Timers.clearTimeout(this.timers.userNoAnswerTimer),this.status===u.STATUS_EARLY_MEDIA)s({});else if(this.sessionDescriptionHandler=this.setupSessionDescriptionHandler(),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),"0"!==this.request.getHeader("Content-Length")||this.request.getHeader("Content-Type")){if(!this.sessionDescriptionHandler.hasDescription(this.request.getHeader("Content-Type")))return void this.request.reply(415);this.hasOffer=!0,this.sessionDescriptionHandler.setDescription(this.request.body,t.sessionDescriptionHandlerOptions,t.modifiers).then(function(){return this.sessionDescriptionHandler.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers)}.bind(this)).catch(o).then(s)}else this.sessionDescriptionHandler.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers).catch(o).then(s);return this}},receiveRequest:{writable:!0,value:function(n){function i(){var t,i;e.Timers.clearTimeout(this.timers.ackTimer),e.Timers.clearTimeout(this.timers.invite2xxTimer),this.status=u.STATUS_CONFIRMED,t=n.getHeader("Content-Type"),(i=n.getHeader("Content-Disposition"))&&"render"===i.type&&(this.renderbody=n.body,this.rendertype=t),this.emit("confirmed",n)}switch(n.method){case e.C.CANCEL:this.status!==u.STATUS_WAITING_FOR_ANSWER&&this.status!==u.STATUS_WAITING_FOR_PRACK&&this.status!==u.STATUS_ANSWERED_WAITING_FOR_PRACK&&this.status!==u.STATUS_EARLY_MEDIA&&this.status!==u.STATUS_ANSWERED||(this.status=u.STATUS_CANCELED,this.request.reply(487),this.canceled(n),this.rejected(n,e.C.causes.CANCELED),this.failed(n,e.C.causes.CANCELED),this.terminated(n,e.C.causes.CANCELED));break;case e.C.ACK:this.status===u.STATUS_WAITING_FOR_ACK&&(this.sessionDescriptionHandler.hasDescription(n.getHeader("Content-Type"))?(this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(n.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(i.bind(this),function(t){this.logger.warn(t),this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(n,e.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(n,e.C.causes.BAD_MEDIA_DESCRIPTION)}.bind(this))):i.apply(this));break;case e.C.PRACK:this.status===u.STATUS_WAITING_FOR_PRACK||this.status===u.STATUS_ANSWERED_WAITING_FOR_PRACK?this.hasAnswer?(e.Timers.clearTimeout(this.timers.rel1xxTimer),e.Timers.clearTimeout(this.timers.prackTimer),n.reply(200),this.status===u.STATUS_ANSWERED_WAITING_FOR_PRACK&&(this.status=u.STATUS_EARLY_MEDIA,this.accept()),this.status=u.STATUS_EARLY_MEDIA):(this.sessionDescriptionHandler=this.setupSessionDescriptionHandler(),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),this.sessionDescriptionHandler.hasDescription(n.getHeader("Content-Type"))?(this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(n.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){e.Timers.clearTimeout(this.timers.rel1xxTimer),e.Timers.clearTimeout(this.timers.prackTimer),n.reply(200),this.status===u.STATUS_ANSWERED_WAITING_FOR_PRACK&&(this.status=u.STATUS_EARLY_MEDIA,this.accept()),this.status=u.STATUS_EARLY_MEDIA}.bind(this),function(t){this.logger.warn(t),this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(n,e.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(n,e.C.causes.BAD_MEDIA_DESCRIPTION)}.bind(this))):(this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(n,e.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(n,e.C.causes.BAD_MEDIA_DESCRIPTION))):this.status===u.STATUS_EARLY_MEDIA&&n.reply(200);break;default:t.prototype.receiveRequest.apply(this,[n])}}},setupSessionDescriptionHandler:{writable:!0,value:function(){return this.sessionDescriptionHandler?this.sessionDescriptionHandler:this.sessionDescriptionHandlerFactory(this,this.ua.configuration.sessionDescriptionHandlerFactoryOptions)}},onTransportError:{writable:!0,value:function(){this.status!==u.STATUS_CONFIRMED&&this.status!==u.STATUS_TERMINATED&&this.failed(null,e.C.causes.CONNECTION_ERROR)}},onRequestTimeout:{writable:!0,value:function(){this.status===u.STATUS_CONFIRMED?this.terminated(null,e.C.causes.REQUEST_TIMEOUT):this.status!==u.STATUS_TERMINATED&&(this.failed(null,e.C.causes.REQUEST_TIMEOUT),this.terminated(null,e.C.causes.REQUEST_TIMEOUT))}}}),e.InviteServerContext=i,(r=function(t,n,i,r){i=i||{},this.passedOptions=i,i.params=Object.create(i.params||Object.prototype);var s=(i.extraHeaders||[]).slice(),o=t.configuration.sessionDescriptionHandlerFactory;if(this.sessionDescriptionHandlerFactoryOptions=t.configuration.sessionDescriptionHandlerFactoryOptions||{},this.sessionDescriptionHandlerOptions=i.sessionDescriptionHandlerOptions||{},this.modifiers=r,this.inviteWithoutSdp=i.inviteWithoutSdp||!1,this.anonymous=i.anonymous||!1,this.renderbody=i.renderbody||null,this.rendertype=i.rendertype||"text/plain",this.from_tag=e.Utils.newTag(),i.params.from_tag=this.from_tag,this.contact=t.contact.toString({anonymous:this.anonymous,outbound:this.anonymous?!t.contact.temp_gruu:!t.contact.pub_gruu}),this.anonymous&&(i.params.from_displayName="Anonymous",i.params.from_uri="sip:anonymous@anonymous.invalid",s.push("P-Preferred-Identity: "+t.configuration.uri.toString()),s.push("Privacy: id")),s.push("Contact: "+this.contact),s.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.inviteWithoutSdp&&this.renderbody&&(s.push("Content-Type: "+this.rendertype),s.push("Content-Disposition: render;handling=optional")),t.configuration.rel100===e.C.supported.REQUIRED&&s.push("Require: 100rel"),t.configuration.replaces===e.C.supported.REQUIRED&&s.push("Require: replaces"),i.extraHeaders=s,e.Utils.augment(this,e.ClientContext,[t,e.C.INVITE,n,i]),e.Utils.augment(this,e.Session,[o]),this.status!==u.STATUS_NULL)throw new e.Exceptions.InvalidStateError(this.status);this.isCanceled=!1,this.received_100=!1,this.method=e.C.INVITE,this.receiveNonInviteResponse=this.receiveResponse,this.receiveResponse=this.receiveInviteResponse,this.logger=t.getLogger("sip.inviteclientcontext"),t.applicants[this]=this,this.id=this.request.call_id+this.from_tag,this.onInfo=i.onInfo,this.errorListener=this.onTransportError.bind(this),t.transport.on("transportError",this.errorListener)}).prototype=Object.create({},{invite:{writable:!0,value:function(){var t=this;return this.ua.sessions[this.id]=this,e.Utils.Promise.resolve().then(function(){this.inviteWithoutSdp?(this.request.body=t.renderbody,this.status=u.STATUS_INVITE_SENT,this.send()):(this.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.sessionDescriptionHandlerFactoryOptions),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),this.sessionDescriptionHandler.getDescription(this.sessionDescriptionHandlerOptions,this.modifiers).then(function(e){t.isCanceled||t.status===u.STATUS_TERMINATED||(t.hasOffer=!0,t.request.body=e,t.status=u.STATUS_INVITE_SENT,t.send())},function(n){n instanceof e.Exceptions.SessionDescriptionHandlerError&&(t.logger.log(n.message),t.logger.log(n.error)),t.status!==u.STATUS_TERMINATED&&(t.failed(null,e.C.causes.WEBRTC_ERROR),t.terminated(null,e.C.causes.WEBRTC_ERROR))}))}.bind(this)),this}},receiveInviteResponse:{writable:!0,value:function(t){var n,i=this,r=t.call_id+t.from_tag+t.to_tag,s=[],o={};if(this.status!==u.STATUS_TERMINATED&&t.method===e.C.INVITE){if(this.dialog&&t.status_code>=200&&t.status_code<=299){if(r!==this.dialog.id.toString()){if(!this.createDialog(t,"UAC",!0))return;return this.emit("ack",t.transaction.sendACK({body:e.Utils.generateFakeSDP(t.body)})),this.earlyDialogs[r].sendRequest(this,e.C.BYE),void(this.status!==u.STATUS_CONFIRMED&&(this.failed(t,e.C.causes.WEBRTC_ERROR),this.terminated(t,e.C.causes.WEBRTC_ERROR)))}if(this.status===u.STATUS_CONFIRMED)return void this.emit("ack",t.transaction.sendACK());if(!this.hasAnswer)return}if(this.dialog&&t.status_code<200){if(-1!==this.dialog.pracked.indexOf(t.getHeader("rseq"))||this.dialog.pracked[this.dialog.pracked.length-1]>=t.getHeader("rseq")&&this.dialog.pracked.length>0)return;if(!this.earlyDialogs[r]&&!this.createDialog(t,"UAC",!0))return;if(-1!==this.earlyDialogs[r].pracked.indexOf(t.getHeader("rseq"))||this.earlyDialogs[r].pracked[this.earlyDialogs[r].pracked.length-1]>=t.getHeader("rseq")&&this.earlyDialogs[r].pracked.length>0)return;return s.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq")),this.earlyDialogs[r].pracked.push(t.getHeader("rseq")),void this.earlyDialogs[r].sendRequest(this,e.C.PRACK,{extraHeaders:s,body:e.Utils.generateFakeSDP(t.body)})}if(this.isCanceled)t.status_code>=100&&t.status_code<200?(this.request.cancel(this.cancelReason,s),this.canceled(null)):t.status_code>=200&&t.status_code<299?(this.acceptAndTerminate(t),this.emit("bye",this.request)):t.status_code>=300&&(n=e.C.REASON_PHRASE[t.status_code]||e.C.causes.CANCELED,this.rejected(t,n),this.failed(t,n),this.terminated(t,n));else switch(!0){case/^100$/.test(t.status_code):this.received_100=!0,this.emit("progress",t);break;case/^1[0-9]{2}$/.test(t.status_code):if(!t.to_tag){this.logger.warn("1xx response received without to tag");break}if(t.hasHeader("contact")&&!this.createDialog(t,"UAC",!0))break;if(this.status=u.STATUS_1XX_RECEIVED,t.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=new e.NameAddrHeader.parse(t.getHeader("P-Asserted-Identity"))),t.hasHeader("require")&&-1!==t.getHeader("require").indexOf("100rel")){if(this.dialog||!this.earlyDialogs[r])break;if(-1!==this.earlyDialogs[r].pracked.indexOf(t.getHeader("rseq"))||this.earlyDialogs[r].pracked[this.earlyDialogs[r].pracked.length-1]>=t.getHeader("rseq")&&this.earlyDialogs[r].pracked.length>0)return;if(this.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.sessionDescriptionHandlerFactoryOptions),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type")))if(this.hasOffer){if(!this.createDialog(t,"UAC"))break;this.hasAnswer=!0,this.dialog.pracked.push(t.getHeader("rseq")),this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){s.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq")),i.sendRequest(e.C.PRACK,{extraHeaders:s,receiveResponse:function(){}}),i.status=u.STATUS_EARLY_MEDIA,i.emit("progress",t)},function(n){i.logger.warn(n),i.acceptAndTerminate(t,488,"Not Acceptable Here"),i.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION)})}else{var a=this.earlyDialogs[r],l=a.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.sessionDescriptionHandlerFactoryOptions);this.emit("SessionDescriptionHandler-created",l),a.pracked.push(t.getHeader("rseq")),l.setDescription(t.body,i.sessionDescriptionHandlerOptions,i.modifers).then(l.getDescription.bind(l,i.sessionDescriptionHandlerOptions,i.modifiers)).then(function(n){s.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq")),a.sendRequest(i,e.C.PRACK,{extraHeaders:s,body:n}),i.status=u.STATUS_EARLY_MEDIA,i.emit("progress",t)}).catch(function(n){if(n instanceof e.Exceptions.SessionDescriptionHandlerError){if(a.pracked.push(t.getHeader("rseq")),i.status===u.STATUS_TERMINATED)return;i.failed(null,e.C.causes.WEBRTC_ERROR),i.terminated(null,e.C.causes.WEBRTC_ERROR)}else a.pracked.splice(a.pracked.indexOf(t.getHeader("rseq")),1),i.logger.warn("invalid description"),i.logger.warn(n)})}else s.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq")),this.earlyDialogs[r].pracked.push(t.getHeader("rseq")),this.earlyDialogs[r].sendRequest(this,e.C.PRACK,{extraHeaders:s}),this.emit("progress",t)}else this.emit("progress",t);break;case/^2[0-9]{2}$/.test(t.status_code):if(this.request.cseq+" "+this.request.method!==t.getHeader("cseq"))break;if(t.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=new e.NameAddrHeader.parse(t.getHeader("P-Asserted-Identity"))),this.status===u.STATUS_EARLY_MEDIA&&this.dialog){this.status=u.STATUS_CONFIRMED,o={},this.renderbody&&(s.push("Content-Type: "+this.rendertype),o.extraHeaders=s,o.body=this.renderbody),this.emit("ack",t.transaction.sendACK(o)),this.accepted(t);break}if(this.dialog)break;if(this.hasOffer)if(this.hasAnswer)this.renderbody&&(s.push("Content-Type: "+i.rendertype),o.extraHeaders=s,o.body=this.renderbody),this.emit("ack",t.transaction.sendACK(o));else{if(!this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type"))){this.acceptAndTerminate(t,400,"Missing session description"),this.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(t,"UAC"))break;this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){var e={};i.status=u.STATUS_CONFIRMED,i.renderbody&&(s.push("Content-Type: "+i.rendertype),e.extraHeaders=s,e.body=i.renderbody),i.emit("ack",t.transaction.sendACK(e)),i.accepted(t)},function(n){i.logger.warn(n),i.acceptAndTerminate(t,488,"Not Acceptable Here"),i.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION)})}else if(this.earlyDialogs[r]&&this.earlyDialogs[r].sessionDescriptionHandler){if(this.hasOffer=!0,this.hasAnswer=!0,this.sessionDescriptionHandler=this.earlyDialogs[r].sessionDescriptionHandler,!this.createDialog(t,"UAC"))break;this.status=u.STATUS_CONFIRMED,this.emit("ack",t.transaction.sendACK()),this.accepted(t)}else{if(this.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.sessionDescriptionHandlerFactoryOptions),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),!this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type"))){this.acceptAndTerminate(t,400,"Missing session description"),this.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(t,"UAC"))break;this.hasOffer=!0,this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(this.sessionDescriptionHandler.getDescription.bind(this.sessionDescriptionHandler,this.sessionDescriptionHandlerOptions,this.modifiers)).then(function(e){i.isCanceled||i.status===u.STATUS_TERMINATED||(i.status=u.STATUS_CONFIRMED,i.hasAnswer=!0,i.emit("ack",t.transaction.sendACK({body:e})),i.accepted(t))}).catch(function(n){n instanceof e.Exceptions.SessionDescriptionHandlerError&&(i.logger.warn("invalid description"),i.logger.warn(n),i.acceptAndTerminate(t,488,"Invalid session description"),i.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION))})}break;default:n=e.Utils.sipErrorCause(t.status_code),this.rejected(t,n),this.failed(t,n),this.terminated(t,n)}}}},cancel:{writable:!0,value:function(t){if((t=t||{}).extraHeaders=(t.extraHeaders||[]).slice(),this.isCanceled)throw new e.Exceptions.InvalidStateError("CANCELED");if(this.status===u.STATUS_TERMINATED||this.status===u.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);this.logger.log("canceling RTCSession"),this.isCanceled=!0;var n=e.Utils.getCancelReason(t.status_code,t.reason_phrase);return this.status===u.STATUS_NULL||this.status===u.STATUS_INVITE_SENT&&!this.received_100?this.cancelReason=n:this.status!==u.STATUS_INVITE_SENT&&this.status!==u.STATUS_1XX_RECEIVED&&this.status!==u.STATUS_EARLY_MEDIA||this.request.cancel(n,t.extraHeaders),this.canceled()}},terminate:{writable:!0,value:function(e){return this.status===u.STATUS_TERMINATED?this:(this.status===u.STATUS_WAITING_FOR_ACK||this.status===u.STATUS_CONFIRMED?this.bye(e):this.cancel(e),this)}},receiveRequest:{writable:!0,value:function(n){return n.method,e.C.CANCEL,n.method===e.C.ACK&&this.status===u.STATUS_WAITING_FOR_ACK&&(e.Timers.clearTimeout(this.timers.ackTimer),e.Timers.clearTimeout(this.timers.invite2xxTimer),this.status=u.STATUS_CONFIRMED,this.accepted()),t.prototype.receiveRequest.apply(this,[n])}},onTransportError:{writable:!0,value:function(){this.status!==u.STATUS_CONFIRMED&&this.status!==u.STATUS_TERMINATED&&this.failed(null,e.C.causes.CONNECTION_ERROR)}},onRequestTimeout:{writable:!0,value:function(){this.status===u.STATUS_CONFIRMED?this.terminated(null,e.C.causes.REQUEST_TIMEOUT):this.status!==u.STATUS_TERMINATED&&(this.failed(null,e.C.causes.REQUEST_TIMEOUT),this.terminated(null,e.C.causes.REQUEST_TIMEOUT))}}}),e.InviteClientContext=r,(o=function(t,n,i,r){if(this.options=r||{},this.extraHeaders=(this.options.extraHeaders||[]).slice(),void 0===t||void 0===n||void 0===i)throw new TypeError("Not enough arguments");if(e.Utils.augment(this,e.ClientContext,[t,e.C.REFER,n.remoteIdentity.uri.toString(),r]),this.applicant=n,i instanceof e.InviteServerContext||i instanceof e.InviteClientContext)this.target='"'+i.remoteIdentity.friendlyName+'" <'+i.dialog.remote_target.toString()+"?Replaces="+i.dialog.id.call_id+"%3Bto-tag%3D"+i.dialog.id.remote_tag+"%3Bfrom-tag%3D"+i.dialog.id.local_tag+">";else{try{this.target=e.Grammar.parse(i,"Refer_To").uri||i}catch(e){this.logger.debug(".refer() cannot parse Refer_To from",i),this.logger.debug("...falling through to normalizeTarget()")}if(this.target=this.ua.normalizeTarget(this.target),!this.target)throw new TypeError("Invalid target: "+i)}this.ua&&this.extraHeaders.push("Referred-By: <"+this.ua.configuration.uri+">"),this.extraHeaders.push("Contact: "+n.contact),this.extraHeaders.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.extraHeaders.push("Refer-To: "+this.target),this.errorListener=this.onTransportError.bind(this),t.transport.on("transportError",this.errorListener)}).prototype=Object.create({},{refer:{writable:!0,value:function(t){t=t||{};var n=(this.extraHeaders||[]).slice();return t.extraHeaders&&n.concat(t.extraHeaders),this.applicant.sendRequest(e.C.REFER,{extraHeaders:this.extraHeaders,receiveResponse:function(e){/^1[0-9]{2}$/.test(e.status_code)?this.emit("referRequestProgress",this):/^2[0-9]{2}$/.test(e.status_code)?this.emit("referRequestAccepted",this):/^[4-6][0-9]{2}$/.test(e.status_code)&&this.emit("referRequestRejected",this),t.receiveResponse&&t.receiveResponse(e)}.bind(this)}),this}},receiveNotify:{writable:!0,value:function(t){if(t.hasHeader("Content-Type")&&-1!==t.getHeader("Content-Type").search(/^message\/sipfrag/)){var n=e.Grammar.parse(t.body,"sipfrag");if(-1===n)return void t.reply(489,"Bad Event");switch(!0){case/^1[0-9]{2}$/.test(n.status_code):this.emit("referProgress",this);break;case/^2[0-9]{2}$/.test(n.status_code):this.emit("referAccepted",this),!this.options.activeAfterTransfer&&this.applicant.terminate&&this.applicant.terminate();break;default:this.emit("referRejected",this)}return t.reply(200),void this.emit("notify",t)}t.reply(489,"Bad Event")}}}),e.ReferClientContext=o,(s=function(t,n){if(e.Utils.augment(this,e.ServerContext,[t,n]),this.ua=t,this.status=u.STATUS_INVITE_RECEIVED,this.from_tag=n.from_tag,this.id=n.call_id+this.from_tag,this.request=n,this.contact=this.ua.contact.toString(),this.logger=t.getLogger("sip.referservercontext",this.id),!this.request.hasHeader("refer-to"))return this.logger.warn("Invalid REFER packet. A refer-to header is required. Rejecting refer."),void this.reject();this.referTo=this.request.parseHeader("refer-to"),this.referredSession=this.ua.findSession(n),this.cseq=Math.floor(1e4*Math.random()),this.call_id=this.request.call_id,this.from_uri=this.request.to.uri,this.from_tag=this.request.to.parameters.tag,this.remote_target=this.request.headers.Contact[0].parsed.uri,this.to_uri=this.request.from.uri,this.to_tag=this.request.from_tag,this.route_set=this.request.getHeaders("record-route"),this.receiveNonInviteResponse=function(){},this.request.hasHeader("referred-by")&&(this.referredBy=this.request.getHeader("referred-by")),this.referTo.uri.hasHeader("replaces")&&(this.replaces=this.referTo.uri.getHeader("replaces")),this.errorListener=this.onTransportError.bind(this),t.transport.on("transportError",this.errorListener),this.status=u.STATUS_WAITING_FOR_ANSWER}).prototype=Object.create({},{progress:{writable:!0,value:function(){if(this.status!==u.STATUS_WAITING_FOR_ANSWER)throw new e.Exceptions.InvalidStateError(this.status);this.request.reply(100)}},reject:{writable:!0,value:function(t){if(this.status===u.STATUS_TERMINATED)throw new e.Exceptions.InvalidStateError(this.status);this.logger.log("Rejecting refer"),this.status=u.STATUS_TERMINATED,e.ServerContext.prototype.reject.call(this,t),this.emit("referRequestRejected",this)}},accept:{writable:!0,value:function(t,n){if(t=t||{},this.status!==u.STATUS_WAITING_FOR_ANSWER)throw new e.Exceptions.InvalidStateError(this.status);if(this.status=u.STATUS_ANSWERED,this.request.reply(202,"Accepted"),this.emit("referRequestAccepted",this),t.followRefer){this.logger.log("Accepted refer, attempting to automatically follow it");var i=this.referTo.uri;if(!i.scheme.match("^sips?$"))return this.logger.error("SIP.js can only automatically follow SIP refer target"),void this.reject();var r=t.inviteOptions||{},s=(r.extraHeaders||[]).slice();this.replaces&&s.push("Replaces: "+decodeURIComponent(this.replaces)),this.referredBy&&s.push("Referred-By: "+this.referredBy),r.extraHeaders=s,i.clearHeaders(),this.targetSession=this.ua.invite(i,r,n),this.emit("referInviteSent",this),this.targetSession.once("progress",function(){this.sendNotify("SIP/2.0 100 Trying"),this.emit("referProgress",this),this.referredSession&&this.referredSession.emit("referProgress",this)}.bind(this)),this.targetSession.once("accepted",function(){this.logger.log("Successfully followed the refer"),this.sendNotify("SIP/2.0 200 OK"),this.emit("referAccepted",this),this.referredSession&&this.referredSession.emit("referAccepted",this)}.bind(this));var o=function(e){if(this.status!==u.STATUS_TERMINATED){if(this.logger.log("Refer was not successful. Resuming session"),e&&429===e.status_code)return this.logger.log("Alerting referrer that identity is required."),void this.sendNotify("SIP/2.0 429 Provide Referrer Identity");this.sendNotify("SIP/2.0 603 Declined"),this.status=u.STATUS_TERMINATED,this.emit("referRejected",this),this.referredSession&&this.referredSession.emit("referRejected")}};this.targetSession.once("rejected",o.bind(this)),this.targetSession.once("failed",o.bind(this))}else this.logger.log("Accepted refer, but did not automatically follow it"),this.sendNotify("SIP/2.0 200 OK"),this.emit("referAccepted",this),this.referredSession&&this.referredSession.emit("referAccepted",this)}},sendNotify:{writable:!0,value:function(t){if(this.status!==u.STATUS_ANSWERED)throw new e.Exceptions.InvalidStateError(this.status);if(-1===e.Grammar.parse(t,"sipfrag"))throw new Error("sipfrag body is required to send notify for refer");var n=new e.OutgoingRequest(e.C.NOTIFY,this.remote_target,this.ua,{cseq:this.cseq+=1,call_id:this.call_id,from_uri:this.from_uri,from_tag:this.from_tag,to_uri:this.to_uri,to_tag:this.to_tag,route_set:this.route_set},["Event: refer","Subscription-State: terminated","Content-Type: message/sipfrag"],t);new e.RequestSender({request:n,onRequestTimeout:function(){},onTransportError:function(){},receiveResponse:function(){}},this.ua).send()}}}),e.ReferServerContext=s}},function(e,t,n){"use strict";e.exports=function(e){var t;return(t=function(n,i,r){var s,o;if(void 0===i)throw new TypeError("Not enough arguments");if(this.logger=n.ua.getLogger("sip.invitecontext.dtmf",n.id),this.owner=n,this.direction=null,s=(r=r||{}).duration||null,o=r.interToneGap||null,"string"==typeof i)i=i.toUpperCase();else{if("number"!=typeof i)throw new TypeError("Invalid tone: "+i);i=i.toString()}if(!i.match(/^[0-9A-D#*]$/))throw new TypeError("Invalid tone: "+i);if(this.tone=i,s&&!e.Utils.isDecimal(s))throw new TypeError("Invalid tone duration: "+s);if(s?s<t.C.MIN_DURATION?(this.logger.warn('"duration" value is lower than the minimum allowed, setting it to '+t.C.MIN_DURATION+" milliseconds"),s=t.C.MIN_DURATION):s>t.C.MAX_DURATION?(this.logger.warn('"duration" value is greater than the maximum allowed, setting it to '+t.C.MAX_DURATION+" milliseconds"),s=t.C.MAX_DURATION):s=Math.abs(s):s=t.C.DEFAULT_DURATION,this.duration=s,o&&!e.Utils.isDecimal(o))throw new TypeError("Invalid interToneGap: "+o);o?o<t.C.MIN_INTER_TONE_GAP?(this.logger.warn('"interToneGap" value is lower than the minimum allowed, setting it to '+t.C.MIN_INTER_TONE_GAP+" milliseconds"),o=t.C.MIN_INTER_TONE_GAP):o=Math.abs(o):o=t.C.DEFAULT_INTER_TONE_GAP,this.interToneGap=o}).prototype=Object.create(e.EventEmitter.prototype),t.prototype.send=function(t){var n,i={};if(this.direction="outgoing",this.owner.status!==e.Session.C.STATUS_CONFIRMED&&this.owner.status!==e.Session.C.STATUS_WAITING_FOR_ACK)throw new e.Exceptions.InvalidStateError(this.owner.status);n=(t=t||{}).extraHeaders?t.extraHeaders.slice():[],i.contentType="application/dtmf-relay",i.body="Signal= "+this.tone+"\r\n",i.body+="Duration= "+this.duration,this.request=this.owner.dialog.sendRequest(this,e.C.INFO,{extraHeaders:n,body:i}),this.owner.emit("dtmf",this.request,this)},t.prototype.receiveResponse=function(t){var n;switch(!0){case/^1[0-9]{2}$/.test(t.status_code):break;case/^2[0-9]{2}$/.test(t.status_code):this.emit("succeeded",{originator:"remote",response:t});break;default:n=e.Utils.sipErrorCause(t.status_code),this.emit("failed",t,n)}},t.prototype.onRequestTimeout=function(){this.emit("failed",null,e.C.causes.REQUEST_TIMEOUT),this.owner.onRequestTimeout()},t.prototype.onTransportError=function(){this.emit("failed",null,e.C.causes.CONNECTION_ERROR),this.owner.onTransportError()},t.prototype.onDialogError=function(t){this.emit("failed",t,e.C.causes.DIALOG_ERROR),this.owner.onDialogError(t)},t.prototype.init_incoming=function(e){this.direction="incoming",this.request=e,e.reply(200),this.tone&&this.duration?this.owner.emit("dtmf",e,this):this.logger.warn("invalid INFO DTMF received, discarded")},t.C={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500},t}},function(e,t,n){"use strict";e.exports=function(e){e.Subscription=function(t,n,i,r){if(r=Object.create(r||Object.prototype),this.extraHeaders=r.extraHeaders=(r.extraHeaders||[]).slice(),this.id=null,this.state="init",!i)throw new TypeError("Event necessary to create a subscription.");this.event=i,"number"!=typeof r.expires?(t.logger.warn("expires must be a number. Using default of 3600."),this.expires=3600):this.expires=r.expires,this.requestedExpires=this.expires,r.extraHeaders.push("Event: "+this.event),r.extraHeaders.push("Expires: "+this.expires),r.body&&(this.body=r.body),this.contact=t.contact.toString(),r.extraHeaders.push("Contact: "+this.contact),r.extraHeaders.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),e.Utils.augment(this,e.ClientContext,[t,e.C.SUBSCRIBE,n,r]),this.logger=t.getLogger("sip.subscription"),this.dialog=null,this.timers={N:null,sub_duration:null},this.errorCodes=[404,405,410,416,480,481,482,483,484,485,489,501,604]},e.Subscription.prototype={subscribe:function(){return"active"===this.state?(this.refresh(),this):"notify_wait"===this.state?this:(e.Timers.clearTimeout(this.timers.sub_duration),e.Timers.clearTimeout(this.timers.N),this.timers.N=e.Timers.setTimeout(this.timer_fire.bind(this),e.Timers.TIMER_N),this.ua.earlySubscriptions[this.request.call_id+this.request.from.parameters.tag+this.event]=this,this.send(),this.state="notify_wait",this)},refresh:function(){"terminated"!==this.state&&"pending"!==this.state&&"notify_wait"!==this.state&&this.dialog.sendRequest(this,e.C.SUBSCRIBE,{extraHeaders:this.extraHeaders,body:this.body})},receiveResponse:function(t){var n,i=e.Utils.getReasonPhrase(t.status_code);"notify_wait"===this.state&&t.status_code>=300||"notify_wait"!==this.state&&-1!==this.errorCodes.indexOf(t.status_code)?this.failed(t,null):/^2[0-9]{2}$/.test(t.status_code)?(this.emit("accepted",t,i),(n=t.getHeader("Expires"))&&n<=this.requestedExpires?(this.expires=n,this.timers.sub_duration=e.Timers.setTimeout(this.refresh.bind(this),900*n)):n?(this.logger.warn("Expires header in a 200-class response to SUBSCRIBE with a higher value than the one in the request"),this.failed(t,e.C.INVALID_EXPIRES_HEADER)):(this.logger.warn("Expires header missing in a 200-class response to SUBSCRIBE"),this.failed(t,e.C.EXPIRES_HEADER_MISSING))):t.statusCode>300&&(this.emit("failed",t,i),this.emit("rejected",t,i))},unsubscribe:function(){var t=[];this.state="terminated",t.push("Event: "+this.event),t.push("Expires: 0"),t.push("Contact: "+this.contact),t.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.receiveResponse=function(){},this.dialog.sendRequest(this,this.method,{extraHeaders:t,body:this.body}),e.Timers.clearTimeout(this.timers.sub_duration),e.Timers.clearTimeout(this.timers.N),this.timers.N=e.Timers.setTimeout(this.timer_fire.bind(this),e.Timers.TIMER_N)},timer_fire:function(){"terminated"===this.state?(this.terminateDialog(),e.Timers.clearTimeout(this.timers.N),e.Timers.clearTimeout(this.timers.sub_duration),delete this.ua.subscriptions[this.id]):"notify_wait"===this.state||"pending"===this.state?this.close():this.refresh()},close:function(){"notify_wait"===this.state?(this.state="terminated",e.Timers.clearTimeout(this.timers.N),e.Timers.clearTimeout(this.timers.sub_duration),this.receiveResponse=function(){},delete this.ua.earlySubscriptions[this.request.call_id+this.request.from.parameters.tag+this.event]):"terminated"!==this.state&&this.unsubscribe()},createConfirmedDialog:function(t,n){var i;return this.terminateDialog(),(i=new e.Dialog(this,t,n)).invite_seqnum=this.request.cseq,i.local_seqnum=this.request.cseq,!i.error&&(this.dialog=i,!0)},terminateDialog:function(){this.dialog&&(delete this.ua.subscriptions[this.id],this.dialog.terminate(),delete this.dialog)},receiveRequest:function(t){var n,i=this;function r(){n.expires&&(e.Timers.clearTimeout(i.timers.sub_duration),n.expires=Math.min(i.expires,Math.max(n.expires,0)),i.timers.sub_duration=e.Timers.setTimeout(i.refresh.bind(i),900*n.expires))}if(this.matchEvent(t))if(this.dialog||this.createConfirmedDialog(t,"UAS")&&(this.id=this.dialog.id.toString(),delete this.ua.earlySubscriptions[this.request.call_id+this.request.from.parameters.tag+this.event],this.ua.subscriptions[this.id]=this),n=t.parseHeader("Subscription-State"),t.reply(200,e.C.REASON_200),e.Timers.clearTimeout(this.timers.N),this.emit("notify",{request:t}),"terminated"!==this.state)switch(n.state){case"active":this.state="active",r();break;case"pending":"notify_wait"===this.state&&r(),this.state="pending";break;case"terminated":if(e.Timers.clearTimeout(this.timers.sub_duration),n.reason)switch(this.logger.log("terminating subscription with reason "+n.reason),n.reason){case"deactivated":case"timeout":return void this.subscribe();case"probation":case"giveup":return void(n.params&&n.params["retry-after"]?this.timers.sub_duration=e.Timers.setTimeout(i.subscribe.bind(i),n.params["retry-after"]):this.subscribe())}this.close()}else"terminated"===n.state&&(this.terminateDialog(),e.Timers.clearTimeout(this.timers.N),e.Timers.clearTimeout(this.timers.sub_duration),delete this.ua.subscriptions[this.id]);else t.reply(489)},failed:function(e,t){return this.close(),this.emit("failed",e,t),this.emit("rejected",e,t),this},onDialogError:function(t){this.failed(t,e.C.causes.DIALOG_ERROR)},matchEvent:function(e){var t;return e.hasHeader("Event")?e.hasHeader("Subscription-State")?(t=e.parseHeader("event").event,this.event===t||(this.logger.warn("event match failed"),e.reply(481,"Event Match Failed"),!1)):(this.logger.warn("missing Subscription-State header"),!1):(this.logger.warn("missing Event header"),!1)}}}},function(e,t,n){"use strict";e.exports=function(e){var t;((t=function(t,n,i,r){if(this.options=r=r||{},this.options.extraHeaders=(r.extraHeaders||[]).slice(),this.options.contentType=r.contentType||"text/plain","number"!=typeof r.expires||r.expires%1!=0?this.options.expires=3600:this.options.expires=Number(r.expires),"boolean"!=typeof r.unpublishOnClose?this.options.unpublishOnClose=!0:this.options.unpublishOnClose=r.unpublishOnClose,void 0===n||null===n||""===n)throw new e.Exceptions.MethodParameterError("Publish","Target",n);if(this.target=t.normalizeTarget(n),void 0===i||null===i||""===i)throw new e.Exceptions.MethodParameterError("Publish","Event",i);this.event=i,e.ClientContext.call(this,t,e.C.PUBLISH,this.target,this.options),this.logger=this.ua.getLogger("sip.publish"),this.pubRequestBody=null,this.pubRequestExpires=this.options.expires,this.pubRequestEtag=null,this.publish_refresh_timer=null,t.on("transportCreated",function(e){e.on("transportError",this.onTransportError.bind(this))}.bind(this))}).prototype=Object.create(e.ClientContext.prototype)).constructor=t,t.prototype.publish=function(t){if(this.request=null,e.Timers.clearTimeout(this.publish_refresh_timer),void 0!==t&&null!==t&&""!==t)this.options.body=t,this.pubRequestBody=this.options.body,0===this.pubRequestExpires&&(this.pubRequestExpires=this.options.expires,this.pubRequestEtag=null),this.ua.publishers[this.target.toString()+":"+this.event]||(this.ua.publishers[this.target.toString()+":"+this.event]=this);else{if(this.pubRequestBody=null,null===this.pubRequestEtag)throw new e.Exceptions.MethodParameterError("Publish","Body",t);if(0===this.pubRequestExpires)throw new e.Exceptions.MethodParameterError("Publish","Expire",this.pubRequestExpires)}this.sendPublishRequest()},t.prototype.unpublish=function(){this.request=null,e.Timers.clearTimeout(this.publish_refresh_timer),this.pubRequestBody=null,this.pubRequestExpires=0,null!==this.pubRequestEtag&&this.sendPublishRequest()},t.prototype.close=function(){this.options.unpublishOnClose?this.unpublish():(this.request=null,e.Timers.clearTimeout(this.publish_refresh_timer),this.pubRequestBody=null,this.pubRequestExpires=0,this.pubRequestEtag=null),this.ua.publishers[this.target.toString()+":"+this.event]&&delete this.ua.publishers[this.target.toString()+":"+this.event]},t.prototype.sendPublishRequest=function(){var t;(t=Object.create(this.options||Object.prototype)).extraHeaders=(this.options.extraHeaders||[]).slice(),t.extraHeaders.push("Event: "+this.event),t.extraHeaders.push("Expires: "+this.pubRequestExpires),null!==this.pubRequestEtag&&t.extraHeaders.push("SIP-If-Match: "+this.pubRequestEtag),this.request=new e.OutgoingRequest(e.C.PUBLISH,this.target,this.ua,this.options.params,t.extraHeaders),null!==this.pubRequestBody&&(this.request.body={},this.request.body.body=this.pubRequestBody,this.request.body.contentType=this.options.contentType),this.send()},t.prototype.receiveResponse=function(t){var n,i,r=e.Utils.getReasonPhrase(t.status_code);switch(!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",t,r);break;case/^2[0-9]{2}$/.test(t.status_code):t.hasHeader("SIP-ETag")?this.pubRequestEtag=t.getHeader("SIP-ETag"):this.logger.warn("SIP-ETag header missing in a 200-class response to PUBLISH"),t.hasHeader("Expires")?"number"==typeof(n=Number(t.getHeader("Expires")))&&n>=0&&n<=this.pubRequestExpires?this.pubRequestExpires=n:this.logger.warn("Bad Expires header in a 200-class response to PUBLISH"):this.logger.warn("Expires header missing in a 200-class response to PUBLISH"),0!==this.pubRequestExpires?(this.publish_refresh_timer=e.Timers.setTimeout(this.publish.bind(this),900*this.pubRequestExpires),this.emit("published",t,r)):this.emit("unpublished",t,r);break;case/^412$/.test(t.status_code):null!==this.pubRequestEtag&&0!==this.pubRequestExpires?(this.logger.warn("412 response to PUBLISH, recovering"),this.pubRequestEtag=null,this.emit("progress",t,r),this.publish(this.options.body)):(this.logger.warn("412 response to PUBLISH, recovery failed"),this.pubRequestExpires=0,this.emit("failed",t,r),this.emit("unpublished",t,r));break;case/^423$/.test(t.status_code):0!==this.pubRequestExpires&&t.hasHeader("Min-Expires")?"number"==typeof(i=Number(t.getHeader("Min-Expires")))||i>this.pubRequestExpires?(this.logger.warn("423 code in response to PUBLISH, adjusting the Expires value and trying to recover"),this.pubRequestExpires=i,this.emit("progress",t,r),this.publish(this.options.body)):(this.logger.warn("Bad 423 response Min-Expires header received for PUBLISH"),this.pubRequestExpires=0,this.emit("failed",t,r),this.emit("unpublished",t,r)):(this.logger.warn("423 response to PUBLISH, recovery failed"),this.pubRequestExpires=0,this.emit("failed",t,r),this.emit("unpublished",t,r));break;default:this.pubRequestExpires=0,this.emit("failed",t,r),this.emit("unpublished",t,r)}0===this.pubRequestExpires&&(e.Timers.clearTimeout(this.publish_refresh_timer),this.pubRequestBody=null,this.pubRequestEtag=null)},t.prototype.onRequestTimeout=function(){e.ClientContext.prototype.onRequestTimeout.call(this),this.emit("unpublished",null,e.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){e.ClientContext.prototype.onTransportError.call(this),this.emit("unpublished",null,e.C.causes.CONNECTION_ERROR)},e.PublishContext=t}},function(e,t,n){"use strict";(function(t){e.exports=function(e,i){var r,s={STATUS_INIT:0,STATUS_STARTING:1,STATUS_READY:2,STATUS_USER_CLOSED:3,STATUS_NOT_READY:4,CONFIGURATION_ERROR:1,NETWORK_ERROR:2,ALLOWED_METHODS:["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"],ACCEPTED_BODY_TYPES:["application/sdp","application/dtmf-relay"],MAX_FORWARDS:70,TAG_LENGTH:10};function o(t){if(t instanceof Function)return t.initialize||(t.initialize=function(){return e.Utils.Promise.resolve()}),t}((r=function(t){var n=this;function i(e){return n.emit.bind(n,e)}s.ACCEPTED_BODY_TYPES=s.ACCEPTED_BODY_TYPES.toString(),this.log=new e.LoggerFactory,this.logger=this.getLogger("sip.ua"),this.cache={credentials:{}},this.configuration={},this.dialogs={},this.applicants={},this.data={},this.sessions={},this.subscriptions={},this.earlySubscriptions={},this.publishers={},this.transport=null,this.contact=null,this.status=s.STATUS_INIT,this.error=null,this.transactions={nist:{},nict:{},ist:{},ict:{}},Object.defineProperties(this,{transactionsCount:{get:function(){var e,t=["nist","nict","ist","ict"],n=0;for(e in t)n+=Object.keys(this.transactions[t[e]]).length;return n}},nictTransactionsCount:{get:function(){return Object.keys(this.transactions.nict).length}},nistTransactionsCount:{get:function(){return Object.keys(this.transactions.nist).length}},ictTransactionsCount:{get:function(){return Object.keys(this.transactions.ict).length}},istTransactionsCount:{get:function(){return Object.keys(this.transactions.ist).length}}}),void 0===t?t={}:("string"==typeof t||t instanceof String)&&(t={uri:t}),t.log&&(t.log.hasOwnProperty("builtinEnabled")&&(this.log.builtinEnabled=t.log.builtinEnabled),t.log.hasOwnProperty("level")&&(this.log.level=t.log.level),t.log.hasOwnProperty("connector")&&(this.log.connector=t.log.connector));try{this.loadConfig(t)}catch(e){throw this.status=s.STATUS_NOT_READY,this.error=s.CONFIGURATION_ERROR,e}this.registerContext=new e.RegisterContext(this),this.registerContext.on("failed",i("registrationFailed")),this.registerContext.on("registered",i("registered")),this.registerContext.on("unregistered",i("unregistered")),this.configuration.autostart&&this.start()}).prototype=Object.create(e.EventEmitter.prototype)).register=function(e){return this.configuration.register=!0,this.registerContext.register(e),this},r.prototype.unregister=function(e){this.configuration.register=!1;var t=this.registerContext;return this.transport.afterConnected(t.unregister.bind(t,e)),this},r.prototype.isRegistered=function(){return this.registerContext.registered},r.prototype.invite=function(t,n,i){var r=new e.InviteClientContext(this,t,n,i);return this.transport.afterConnected(function(){r.invite(),this.emit("inviteSent",r)}.bind(this)),r},r.prototype.subscribe=function(t,n,i){var r=new e.Subscription(this,t,n,i);return this.transport.afterConnected(r.subscribe.bind(r)),r},r.prototype.publish=function(t,n,i,r){var s=new e.PublishContext(this,t,n,r);return this.transport.afterConnected(s.publish.bind(s,i)),s},r.prototype.message=function(t,n,i){if(void 0===n)throw new TypeError("Not enough arguments");return(i=Object.create(i||Object.prototype)).contentType||(i.contentType="text/plain"),i.body=n,this.request(e.C.MESSAGE,t,i)},r.prototype.request=function(t,n,i){var r=new e.ClientContext(this,t,n,i);return this.transport.afterConnected(r.send.bind(r)),r},r.prototype.stop=function(){var e,n,r,o,a=this;if(this.logger.log("user requested closure..."),this.status===s.STATUS_USER_CLOSED)return this.logger.warn("UA already closed"),this;for(e in this.logger.log("closing registerContext"),this.registerContext.close(),this.sessions)this.logger.log("closing session "+e),this.sessions[e].terminate();for(n in this.subscriptions)this.logger.log("unsubscribing from subscription "+n),this.subscriptions[n].close();for(n in this.earlySubscriptions)this.logger.log("unsubscribing from early subscription "+n),this.earlySubscriptions[n].close();for(o in this.publishers)this.logger.log("unpublish "+o),this.publishers[o].close();for(r in this.applicants)this.applicants[r].close();return this.status=s.STATUS_USER_CLOSED,0===this.nistTransactionsCount&&0===this.nictTransactionsCount?this.transport.disconnect():this.on("transactionDestroyed",function e(){0===a.nistTransactionsCount&&0===a.nictTransactionsCount&&(a.removeListener("transactionDestroyed",e),a.transport.disconnect())}),"function"==typeof i.removeEventListener&&(t.chrome&&t.chrome.app&&t.chrome.app.runtime||i.removeEventListener("unload",this.environListener)),this},r.prototype.start=function(){if(this.logger.log("user requested startup..."),this.status===s.STATUS_INIT){if(this.status=s.STATUS_STARTING,!this.configuration.transportConstructor)throw new e.Exceptions.TransportError("Transport constructor not set");this.transport=new this.configuration.transportConstructor(this.getLogger("sip.transport"),this.configuration.transportOptions),this.setTransportListeners(),this.emit("transportCreated",this.transport),this.transport.connect()}else this.status===s.STATUS_USER_CLOSED?(this.logger.log("resuming"),this.status=s.STATUS_READY,this.transport.connect()):this.status===s.STATUS_STARTING?this.logger.log("UA is in STARTING status, not opening new connection"):this.status===s.STATUS_READY?this.logger.log("UA is in READY status, not resuming"):this.logger.error("Connection is down. Auto-Recovery system is trying to connect");return this.configuration.autostop&&"function"==typeof i.addEventListener&&(t.chrome&&t.chrome.app&&t.chrome.app.runtime||(this.environListener=this.stop.bind(this),i.addEventListener("unload",this.environListener))),this},r.prototype.normalizeTarget=function(t){return e.Utils.normalizeTarget(t,this.configuration.hostportParams)},r.prototype.saveCredentials=function(e){return this.cache.credentials[e.realm]=this.cache.credentials[e.realm]||{},this.cache.credentials[e.realm][e.uri]=e,this},r.prototype.getCredentials=function(e){var t,n;return t=e.ruri.host,this.cache.credentials[t]&&this.cache.credentials[t][e.ruri]&&((n=this.cache.credentials[t][e.ruri]).method=e.method),n},r.prototype.getLogger=function(e,t){return this.log.getLogger(e,t)},r.prototype.onTransportError=function(){this.status!==s.STATUS_USER_CLOSED&&(this.error&&this.error===s.NETWORK_ERROR||(this.status=s.STATUS_NOT_READY,this.error=s.NETWORK_ERROR))},r.prototype.setTransportListeners=function(){this.transport.on("connected",this.onTransportConnected.bind(this)),this.transport.on("message",this.onTransportReceiveMsg.bind(this)),this.transport.on("transportError",this.onTransportError.bind(this))},r.prototype.onTransportConnected=function(){this.configuration.register&&this.configuration.authenticationFactory.initialize().then(function(){this.registerContext.onTransportConnected()}.bind(this))},r.prototype.onTransportReceiveMsg=function(t){var n;if(t=e.Parser.parseMessage(t,this),this.status===e.UA.C.STATUS_USER_CLOSED&&t instanceof e.IncomingRequest)this.logger.warn("UA received message when status = USER_CLOSED - aborting");else if(e.sanityCheck(t,this,this.transport))if(t instanceof e.IncomingRequest)t.transport=this.transport,this.receiveRequest(t);else if(t instanceof e.IncomingResponse)switch(t.method){case e.C.INVITE:(n=this.transactions.ict[t.via_branch])&&n.receiveResponse(t);break;case e.C.ACK:break;default:(n=this.transactions.nict[t.via_branch])&&n.receiveResponse(t)}},r.prototype.newTransaction=function(e){this.transactions[e.type][e.id]=e,this.emit("newTransaction",{transaction:e})},r.prototype.destroyTransaction=function(e){delete this.transactions[e.type][e.id],this.emit("transactionDestroyed",{transaction:e})},r.prototype.receiveRequest=function(t){var n,i,r,o,a,u,l=t.method;function c(e){return e&&e.user===t.ruri.user}if(!(c(this.configuration.uri)||c(this.contact.uri)||c(this.contact.pub_gruu)||c(this.contact.temp_gruu)))return this.logger.warn("Request-URI does not point to us"),void(t.method!==e.C.ACK&&t.reply_sl(404));if(t.ruri.scheme!==e.C.SIPS){if(!e.Transactions.checkTransaction(this,t))if(l===e.C.OPTIONS?(new e.Transactions.NonInviteServerTransaction(t,this),t.reply(200,null,["Allow: "+e.UA.C.ALLOWED_METHODS.toString(),"Accept: "+s.ACCEPTED_BODY_TYPES])):l===e.C.MESSAGE?((r=new e.ServerContext(this,t)).body=t.body,r.content_type=t.getHeader("Content-Type")||"text/plain",t.reply(200,null),this.emit("message",r)):l!==e.C.INVITE&&l!==e.C.ACK&&new e.ServerContext(this,t),t.to_tag)(n=this.findDialog(t))?(l===e.C.INVITE&&new e.Transactions.InviteServerTransaction(t,this),n.receiveRequest(t)):l===e.C.NOTIFY?(i=this.findSession(t),o=this.findEarlySubscription(t),i?i.receiveRequest(t):o?o.receiveRequest(t):(this.logger.warn("received NOTIFY request for a non existent session or subscription"),t.reply(481,"Subscription does not exist"))):l!==e.C.ACK&&t.reply(481);else switch(l){case e.C.INVITE:if(a=this.configuration.replaces!==e.C.supported.UNSUPPORTED&&t.parseHeader("replaces")){if(!(u=this.dialogs[a.call_id+a.replaces_to_tag+a.replaces_from_tag]))return void t.reply_sl(481,null);if(u.owner.status===e.Session.C.STATUS_TERMINATED)return void t.reply_sl(603,null);if(u.state===e.Dialog.C.STATUS_CONFIRMED&&a.early_only)return void t.reply_sl(486,null)}(i=new e.InviteServerContext(this,t)).replacee=u&&u.owner,this.emit("invite",i);break;case e.C.BYE:t.reply(481);break;case e.C.CANCEL:(i=this.findSession(t))?i.receiveRequest(t):this.logger.warn("received CANCEL request for a non existent session");break;case e.C.ACK:break;case e.C.NOTIFY:this.configuration.allowLegacyNotifications&&this.listeners("notify").length>0?(t.reply(200,null),this.emit("notify",{request:t})):t.reply(481,"Subscription does not exist");break;case e.C.REFER:if(this.logger.log("Received an out of dialog refer"),this.configuration.allowOutOfDialogRefers){this.logger.log("Allow out of dialog refers is enabled on the UA");var d=new e.ReferServerContext(this,t);this.listeners("outOfDialogReferRequested").length?this.emit("outOfDialogReferRequested",d):(this.logger.log("No outOfDialogReferRequest listeners, automatically accepting and following the out of dialog refer"),d.accept({followRefer:!0}));break}t.reply(405);break;default:t.reply(405)}}else t.reply_sl(416)},r.prototype.findSession=function(e){return this.sessions[e.call_id+e.from_tag]||this.sessions[e.call_id+e.to_tag]||null},r.prototype.findDialog=function(e){return this.dialogs[e.call_id+e.from_tag+e.to_tag]||this.dialogs[e.call_id+e.to_tag+e.from_tag]||null},r.prototype.findEarlySubscription=function(e){return this.earlySubscriptions[e.call_id+e.to_tag+e.getHeader("event")]||null},r.prototype.loadConfig=function(t){var i,r,s,a,u,l={viaHost:e.Utils.createRandomToken(12)+".invalid",uri:new e.URI("sip","anonymous."+e.Utils.createRandomToken(6),"anonymous.invalid",null,null),custom:{},displayName:"",password:null,registerExpires:600,register:!0,registrarServer:null,transportConstructor:n(29)(e),transportOptions:{},userAgentString:e.C.USER_AGENT,noAnswerTimeout:60,hackViaTcp:!1,hackIpInContact:!1,hackWssInTransport:!1,hackAllowUnregisteredOptionTags:!1,sessionDescriptionHandlerFactoryOptions:{constraints:{},peerConnectionOptions:{}},contactName:e.Utils.createRandomToken(8),contactTransport:"ws",forceRport:!1,autostart:!0,autostop:!0,rel100:e.C.supported.UNSUPPORTED,dtmfType:e.C.dtmfType.INFO,replaces:e.C.supported.UNSUPPORTED,sessionDescriptionHandlerFactory:n(30)(e).defaultFactory,authenticationFactory:o(function(t){return new e.DigestAuthentication(t)}),allowLegacyNotifications:!1,allowOutOfDialogRefers:!1};function c(e,n){var i=e.replace(/([a-z][A-Z])/g,function(e){return e[0]+"_"+e[1].toLowerCase()});if(e!==i){var r=t.hasOwnProperty(e);t.hasOwnProperty(i)&&(n.warn(i+" is deprecated, please use "+e),r&&n.warn(e+" overriding "+i)),t[e]=r?t[e]:t[i]}}var d=this.getConfigurationCheck();for(i in d.mandatory){if(c(i,this.logger),!t.hasOwnProperty(i))throw new e.Exceptions.ConfigurationError(i);if(r=t[i],void 0===(s=d.mandatory[i](r)))throw new e.Exceptions.ConfigurationError(i,r);l[i]=s}for(i in d.optional)if(c(i,this.logger),t.hasOwnProperty(i)){if((r=t[i])instanceof Array&&0===r.length)continue;if(null===r||""===r||void 0===r)continue;if("number"==typeof r&&isNaN(r))continue;if(void 0===(s=d.optional[i](r)))throw new e.Exceptions.ConfigurationError(i,r);l[i]=s}0===l.displayName&&(l.displayName="0"),l.instanceId||(l.instanceId=e.Utils.newUUID()),l.sipjsId=e.Utils.createRandomToken(5),(a=l.uri.clone()).user=null,l.hostportParams=a.toRaw().replace(/^sip:/i,""),l.authorizationUser||(l.authorizationUser=l.uri.user),l.registrarServer||((u=l.uri.clone()).user=null,l.registrarServer=u),l.noAnswerTimeout=1e3*l.noAnswerTimeout,l.hackIpInContact&&("boolean"==typeof l.hackIpInContact?l.viaHost=e.Utils.getRandomTestNetIP():"string"==typeof l.hackIpInContact&&(l.viaHost=l.hackIpInContact)),l.hackWssInTransport&&(l.contactTransport="wss"),this.contact={pub_gruu:null,temp_gruu:null,uri:new e.URI("sip",l.contactName,l.viaHost,null,{transport:l.contactTransport}),toString:function(e){var t=(e=e||{}).anonymous||null,n=e.outbound||null,i="<";return i+=t?(this.temp_gruu||"sip:anonymous@anonymous.invalid;transport="+l.contactTransport).toString():(this.pub_gruu||this.uri).toString(),n&&(i+=";ob"),i+=">"}};var h={};for(i in l)h[i]=l[i];for(i in Object.assign(this.configuration,h),this.logger.log("configuration parameters after validation:"),l)switch(i){case"uri":case"registrarServer":case"sessionDescriptionHandlerFactory":this.logger.log("· "+i+": "+l[i]);break;case"password":this.logger.log("· "+i+": NOT SHOWN");break;case"transportConstructor":this.logger.log("· "+i+": "+l[i].name);break;default:this.logger.log("· "+i+": "+JSON.stringify(l[i]))}},r.prototype.getConfigurationCheck=function(){return{mandatory:{},optional:{uri:function(t){var n;return/^sip:/i.test(t)||(t=e.C.SIP+":"+t),(n=e.URI.parse(t))&&n.user?n:void 0},transportConstructor:function(e){if(e instanceof Function)return e},transportOptions:function(e){if("object"==typeof e)return e},authorizationUser:function(t){return-1===e.Grammar.parse('"'+t+'"',"quoted_string")?void 0:t},displayName:function(t){return-1===e.Grammar.parse('"'+t+'"',"displayName")?void 0:t},dtmfType:function(t){switch(t){case e.C.dtmfType.RTP:return e.C.dtmfType.RTP;case e.C.dtmfType.INFO:default:return e.C.dtmfType.INFO}},hackViaTcp:function(e){if("boolean"==typeof e)return e},hackIpInContact:function(t){return"boolean"==typeof t?t:"string"==typeof t&&-1!==e.Grammar.parse(t,"host")?t:void 0},hackWssInTransport:function(e){if("boolean"==typeof e)return e},hackAllowUnregisteredOptionTags:function(e){if("boolean"==typeof e)return e},contactTransport:function(e){if("string"==typeof e)return e},forceRport:function(e){if("boolean"==typeof e)return e},instanceId:function(t){if("string"==typeof t)return/^uuid:/i.test(t)&&(t=t.substr(5)),-1===e.Grammar.parse(t,"uuid")?void 0:t},noAnswerTimeout:function(t){var n;if(e.Utils.isDecimal(t)&&(n=Number(t))>0)return n},password:function(e){return String(e)},rel100:function(t){return t===e.C.supported.REQUIRED?e.C.supported.REQUIRED:t===e.C.supported.SUPPORTED?e.C.supported.SUPPORTED:e.C.supported.UNSUPPORTED},replaces:function(t){return t===e.C.supported.REQUIRED?e.C.supported.REQUIRED:t===e.C.supported.SUPPORTED?e.C.supported.SUPPORTED:e.C.supported.UNSUPPORTED},register:function(e){if("boolean"==typeof e)return e},registerExpires:function(t){var n;if(e.Utils.isDecimal(t)&&(n=Number(t))>0)return n},registrarServer:function(t){var n;if("string"==typeof t)return/^sip:/i.test(t)||(t=e.C.SIP+":"+t),(n=e.URI.parse(t))?n.user?void 0:n:void 0},userAgentString:function(e){if("string"==typeof e)return e},autostart:function(e){if("boolean"==typeof e)return e},autostop:function(e){if("boolean"==typeof e)return e},sessionDescriptionHandlerFactory:function(e){if(e instanceof Function)return e},sessionDescriptionHandlerFactoryOptions:function(e){if("object"==typeof e)return e},authenticationFactory:o,allowLegacyNotifications:function(e){if("boolean"==typeof e)return e},custom:function(e){if("object"==typeof e)return e},contactName:function(e){if("string"==typeof e)return e}}}},r.C=s,e.UA=r}}).call(this,n(28))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";(function(t){e.exports=function(e){var n,i={STATUS_CONNECTING:0,STATUS_OPEN:1,STATUS_CLOSING:2,STATUS_CLOSED:3},r=(t.window||t).WebSocket;return(n=function(t,n){n=e.Utils.defaultOptions({},n),this.logger=t,this.ws=null,this.server=null,this.connectionPromise=null,this.connectDeferredResolve=null,this.connectionTimeout=null,this.disconnectionPromise=null,this.disconnectDeferredResolve=null,this.boundOnOpen=null,this.boundOnMessage=null,this.boundOnClose=null,this.boundOnError=null,this.reconnectionAttempts=0,this.reconnectTimer=null,this.keepAliveInterval=null,this.keepAliveDebounceTimeout=null,this.status=i.STATUS_CONNECTING,this.configuration={},this.loadConfig(n)}).prototype=Object.create(e.Transport.prototype,{isConnected:{writable:!0,value:function(){return this.status===i.STATUS_OPEN}},sendPromise:{writable:!0,value:function(t,n){if(n=n||{},!this.statusAssert(i.STATUS_OPEN,n.force))return this.onError("unable to send message - WebSocket not open"),e.Utils.Promise.reject();var r=t.toString();return this.ws?(!0===this.configuration.traceSip&&this.logger.log("sending WebSocket message:\n\n"+r+"\n"),this.ws.send(r),e.Utils.Promise.resolve({msg:r})):(this.onError("unable to send message - WebSocket does not exist"),e.Utils.Promise.reject())}},disconnectPromise:{writable:!0,value:function(t){return this.disconnectionPromise?this.disconnectionPromise:(t=t||{},this.statusTransition(i.STATUS_CLOSING,t.force)?(this.disconnectionPromise=new e.Utils.Promise(function(n,i){this.disconnectDeferredResolve=n,this.reconnectTimer&&(e.Timers.clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.ws?(this.stopSendingKeepAlives(),this.logger.log("closing WebSocket "+this.server.ws_uri),this.ws.close(t.code,t.reason)):i("Attempted to disconnect but the websocket doesn't exist")}.bind(this)),this.disconnectionPromise):e.Utils.Promise.reject("Failed status transition - attempted to disconnect a socket that was not open"))}},connectPromise:{writable:!0,value:function(t){return this.connectionPromise?this.connectionPromise:(t=t||{},this.server=this.server||this.getNextWsServer(t.force),this.connectionPromise=new e.Utils.Promise(function(n,s){if((this.status===i.STATUS_OPEN||this.status===i.STATUS_CLOSING)&&!t.force)return this.logger.warn("WebSocket "+this.server.ws_uri+" is already connected"),void s("Failed status check - attempted to open a connection but already open/closing");this.connectDeferredResolve=n,this.status=i.STATUS_CONNECTING,this.logger.log("connecting to WebSocket "+this.server.ws_uri),this.disposeWs();try{this.ws=new r(this.server.ws_uri,"sip")}catch(e){return this.ws=null,this.status=i.STATUS_CLOSED,this.onError("error connecting to WebSocket "+this.server.ws_uri+":"+e),void s("Failed to create a websocket")}this.ws?(this.connectionTimeout=e.Timers.setTimeout(function(){this.onError("took too long to connect - exceeded time set in configuration.connectionTimeout: "+this.configuration.connectionTimeout+"s")}.bind(this),1e3*this.configuration.connectionTimeout),this.boundOnOpen=this.onOpen.bind(this),this.boundOnMessage=this.onMessage.bind(this),this.boundOnClose=this.onClose.bind(this),this.boundOnError=this.onError.bind(this),this.ws.addEventListener("open",this.boundOnOpen),this.ws.addEventListener("message",this.boundOnMessage),this.ws.addEventListener("close",this.boundOnClose),this.ws.addEventListener("error",this.boundOnError)):s("Unexpected instance websocket not set")}.bind(this)),this.connectionPromise)}},onOpen:{writable:!0,value:function(){this.status=i.STATUS_OPEN,this.emit("connected"),e.Timers.clearTimeout(this.connectionTimeout),this.logger.log("WebSocket "+this.server.ws_uri+" connected"),null!==this.reconnectTimer&&(e.Timers.clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.reconnectionAttempts=0,this.disconnectionPromise=null,this.disconnectDeferredResolve=null,this.startSendingKeepAlives(),this.connectDeferredResolve?this.connectDeferredResolve({overrideEvent:!0}):this.logger.warn("Unexpected websocket.onOpen with no connectDeferredResolve")}},onClose:{writable:!0,value:function(t){if(this.logger.log("WebSocket disconnected (code: "+t.code+(t.reason?"| reason: "+t.reason:"")+")"),this.emit("disconnected",{code:t.code,reason:t.reason}),this.status!==i.STATUS_CLOSING&&(this.logger.warn("WebSocket abrupt disconnection"),this.emit("transportError")),this.stopSendingKeepAlives(),e.Timers.clearTimeout(this.connectionTimeout),this.connectionTimeout=null,this.connectionPromise=null,this.connectDeferredResolve=null,this.disconnectDeferredResolve)return this.disconnectDeferredResolve({overrideEvent:!0}),this.statusTransition(i.STATUS_CLOSED),void(this.disconnectDeferredResolve=null);this.status=i.STATUS_CLOSED,this.reconnect()}},disposeWs:{writable:!0,value:function(){this.ws&&(this.ws.removeEventListener("open",this.boundOnOpen),this.ws.removeEventListener("message",this.boundOnMessage),this.ws.removeEventListener("close",this.boundOnClose),this.ws.removeEventListener("error",this.boundOnError),this.boundOnOpen=null,this.boundOnMessage=null,this.boundOnClose=null,this.boundOnError=null,this.ws=null)}},onMessage:{writable:!0,value:function(e){var t=e.data;if(/^(\r\n)+$/.test(t))return this.clearKeepAliveTimeout(),void(!0===this.configuration.traceSip&&this.logger.log("received WebSocket message with CRLF Keep Alive response"));if(t){if("string"!=typeof t){try{t=String.fromCharCode.apply(null,new Uint8Array(t))}catch(e){return void this.logger.warn("received WebSocket binary message failed to be converted into string, message discarded")}!0===this.configuration.traceSip&&this.logger.log("received WebSocket binary message:\n\n"+t+"\n")}else!0===this.configuration.traceSip&&this.logger.log("received WebSocket text message:\n\n"+t+"\n");this.emit("message",t)}else this.logger.warn("received empty message, message discarded")}},onError:{writable:!0,value:function(e){this.logger.warn("Transport error: "+e),this.emit("transportError")}},reconnect:{writable:!0,value:function(){if(this.reconnectionAttempts>0&&this.logger.log("Reconnection attempt "+this.reconnectionAttempts+" failed"),this.noAvailableServers())return this.logger.warn("no available ws servers left - going to closed state"),this.status=i.STATUS_CLOSED,this.emit("closed"),void this.resetServerErrorStatus();this.isConnected()&&(this.logger.warn("attempted to reconnect while connected - forcing disconnect"),this.disconnect({force:!0})),this.reconnectionAttempts+=1,this.reconnectionAttempts>this.configuration.maxReconnectionAttempts?(this.logger.warn("maximum reconnection attempts for WebSocket "+this.server.ws_uri),this.logger.log("transport "+this.server.ws_uri+" failed | connection state set to 'error'"),this.server.isError=!0,this.emit("transportError"),this.server=this.getNextWsServer(),this.reconnectionAttempts=0,this.reconnect()):(this.logger.log("trying to reconnect to WebSocket "+this.server.ws_uri+" (reconnection attempt "+this.reconnectionAttempts+")"),this.reconnectTimer=e.Timers.setTimeout(function(){this.connect(),this.reconnectTimer=null}.bind(this),1===this.reconnectionAttempts?0:1e3*this.configuration.reconnectionTimeout))}},resetServerErrorStatus:{writable:!0,value:function(){var e,t=this.configuration.wsServers.length;for(e=0;e<t;e++)this.configuration.wsServers[e].isError=!1}},getNextWsServer:{writable:!0,value:function(e){if(!this.noAvailableServers()){var t,n,i,r=[];for(n=this.configuration.wsServers.length,t=0;t<n;t++)(i=this.configuration.wsServers[t]).isError&&!e||(0===r.length?r.push(i):i.weight>r[0].weight?r=[i]:i.weight===r[0].weight&&r.push(i));return r[t=Math.floor(Math.random()*r.length)]}this.logger.warn("attempted to get next ws server but there are no available ws servers left")}},noAvailableServers:{writable:!0,value:function(){var e;for(e in this.configuration.wsServers)if(!this.configuration.wsServers[e].isError)return!1;return!0}},sendKeepAlive:{writable:!0,value:function(){if(!this.keepAliveDebounceTimeout)return this.keepAliveDebounceTimeout=e.Timers.setTimeout(function(){this.emit("keepAliveDebounceTimeout"),this.clearKeepAliveTimeout()}.bind(this),1e3*this.configuration.keepAliveDebounce),this.send("\r\n\r\n")}},clearKeepAliveTimeout:{writable:!0,value:function(){e.Timers.clearTimeout(this.keepAliveDebounceTimeout),this.keepAliveDebounceTimeout=null}},startSendingKeepAlives:{writable:!0,value:function(){this.configuration.keepAliveInterval&&!this.keepAliveInterval&&(this.keepAliveInterval=e.Timers.setInterval(function(){this.sendKeepAlive(),this.startSendingKeepAlives()}.bind(this),function(e){var t=.8*e;return 1e3*(Math.random()*(e-t)+t)}(this.configuration.keepAliveInterval)))}},stopSendingKeepAlives:{writable:!0,value:function(){e.Timers.clearInterval(this.keepAliveInterval),e.Timers.clearTimeout(this.keepAliveDebounceTimeout),this.keepAliveInterval=null,this.keepAliveDebounceTimeout=null}},statusAssert:{writable:!0,value:function(e,t){return e===this.status||(t?(this.logger.warn("Attempted to assert "+Object.keys(i)[this.status]+" as "+Object.keys(i)[e]+"- continuing with option: 'force'"),!0):(this.logger.warn("Tried to assert "+Object.keys(i)[e]+" but is currently "+Object.keys(i)[this.status]),!1))}},statusTransition:{writable:!0,value:function(e,t){return this.logger.log("Attempting to transition status from "+Object.keys(i)[this.status]+" to "+Object.keys(i)[e]),e===i.STATUS_OPEN&&this.statusAssert(i.STATUS_CONNECTING,t)||e===i.STATUS_CLOSING&&this.statusAssert(i.STATUS_OPEN,t)||e===i.STATUS_CLOSED&&this.statusAssert(i.STATUS_CLOSING,t)?(this.status=e,!0):(this.logger.warn("Status transition failed - result: no-op - reason: either gave an nonexistent status or attempted illegal transition"),!1)}},loadConfig:{writable:!0,value:function(t){var n,i,r,s={wsServers:[{scheme:"WSS",sip_uri:"<sip:edge.sip.onsip.com;transport=ws;lr>",weight:0,ws_uri:"wss://edge.sip.onsip.com",isError:!1}],connectionTimeout:5,maxReconnectionAttempts:3,reconnectionTimeout:4,keepAliveInterval:0,keepAliveDebounce:10,traceSip:!1};function o(e,n){var i=e.replace(/([a-z][A-Z])/g,function(e){return e[0]+"_"+e[1].toLowerCase()});if(e!==i){var r=t.hasOwnProperty(e);t.hasOwnProperty(i)&&(n.warn(i+" is deprecated, please use "+e),r&&n.warn(e+" overriding "+i)),t[e]=r?t[e]:t[i]}}var a=this.getConfigurationCheck();for(n in a.mandatory){if(o(n,this.logger),!t.hasOwnProperty(n))throw new e.Exceptions.ConfigurationError(n);if(i=t[n],void 0===(r=a.mandatory[n](i)))throw new e.Exceptions.ConfigurationError(n,i);s[n]=r}for(n in a.optional)if(o(n,this.logger),t.hasOwnProperty(n)){if((i=t[n])instanceof Array&&0===i.length)continue;if(null===i||""===i||void 0===i)continue;if("number"==typeof i&&isNaN(i))continue;if(void 0===(r=a.optional[n](i)))throw new e.Exceptions.ConfigurationError(n,i);s[n]=r}var u={};for(n in s)u[n]={value:s[n]};for(n in Object.defineProperties(this.configuration,u),this.logger.log("configuration parameters after validation:"),s)this.logger.log("· "+n+": "+JSON.stringify(s[n]))}},getConfigurationCheck:{writable:!0,value:function(){return{mandatory:{},optional:{wsServers:function(t){var n,i,r;if("string"==typeof t)t=[{ws_uri:t}];else{if(!(t instanceof Array))return;for(i=t.length,n=0;n<i;n++)"string"==typeof t[n]&&(t[n]={ws_uri:t[n]})}if(0===t.length)return!1;for(i=t.length,n=0;n<i;n++){if(!t[n].ws_uri)return;if(t[n].weight&&!Number(t[n].weight))return;if(-1===(r=e.Grammar.parse(t[n].ws_uri,"absoluteURI")))return;if(["wss","ws","udp"].indexOf(r.scheme)<0)return;t[n].sip_uri="<sip:"+r.host+(r.port?":"+r.port:"")+";transport="+r.scheme.replace(/^wss$/i,"ws")+";lr>",t[n].weight||(t[n].weight=0),t[n].isError=!1,t[n].scheme=r.scheme.toUpperCase()}return t},keepAliveInterval:function(t){var n;if(e.Utils.isDecimal(t)&&(n=Number(t))>0)return n},keepAliveDebounce:function(t){var n;if(e.Utils.isDecimal(t)&&(n=Number(t))>0)return n},traceSip:function(e){if("boolean"==typeof e)return e},connectionTimeout:function(t){var n;if(e.Utils.isDecimal(t)&&(n=Number(t))>0)return n},maxReconnectionAttempts:function(t){var n;if(e.Utils.isDecimal(t)&&(n=Number(t))>=0)return n},reconnectionTimeout:function(t){var n;if(e.Utils.isDecimal(t)&&(n=Number(t))>0)return n}}}}}}),n.C=i,e.Web.Transport=n,n}}).call(this,n(28))},function(e,t,n){"use strict";(function(t){e.exports=function(e){var i=function(e,n,i){this.options=i||{},this.logger=e,this.observer=n,this.dtmfSender=null,this.shouldAcquireMedia=!0,this.CONTENT_TYPE="application/sdp",this.C={},this.C.DIRECTION={NULL:null,SENDRECV:"sendrecv",SENDONLY:"sendonly",RECVONLY:"recvonly",INACTIVE:"inactive"},this.logger.log("SessionDescriptionHandlerOptions: "+JSON.stringify(this.options)),this.direction=this.C.DIRECTION.NULL,this.modifiers=this.options.modifiers||[],Array.isArray(this.modifiers)||(this.modifiers=[this.modifiers]);var r=t.window||t;this.WebRTC={MediaStream:r.MediaStream,getUserMedia:r.navigator.mediaDevices.getUserMedia.bind(r.navigator.mediaDevices),RTCPeerConnection:r.RTCPeerConnection},this.iceGatheringDeferred=null,this.iceGatheringTimeout=!1,this.iceGatheringTimer=null,this.initPeerConnection(this.options.peerConnectionOptions),this.constraints=this.checkAndDefaultConstraints(this.options.constraints)};return i.defaultFactory=function(e,t){var r=e.ua.getLogger("sip.invitecontext.sessionDescriptionHandler",e.id),s=new(n(31))(e,t);return new i(r,s,t)},i.prototype=Object.create(e.SessionDescriptionHandler.prototype,{close:{writable:!0,value:function(){this.logger.log("closing PeerConnection"),this.peerConnection&&"closed"!==this.peerConnection.signalingState&&(this.peerConnection.getSenders?this.peerConnection.getSenders().forEach(function(e){e.track&&e.track.stop()}):(this.logger.warn("Using getLocalStreams which is deprecated"),this.peerConnection.getLocalStreams().forEach(function(e){e.getTracks().forEach(function(e){e.stop()})})),this.peerConnection.getReceivers?this.peerConnection.getReceivers().forEach(function(e){e.track&&e.track.stop()}):(this.logger.warn("Using getRemoteStreams which is deprecated"),this.peerConnection.getRemoteStreams().forEach(function(e){e.getTracks().forEach(function(e){e.stop()})})),this.resetIceGatheringComplete(),this.peerConnection.close())}},getDescription:{writable:!0,value:function(t,n){(t=t||{}).peerConnectionOptions&&this.initPeerConnection(t.peerConnectionOptions);var i=Object.assign({},this.constraints,t.constraints);return i=this.checkAndDefaultConstraints(i),JSON.stringify(i)!==JSON.stringify(this.constraints)&&(this.constraints=i,this.shouldAcquireMedia=!0),n=n||[],Array.isArray(n)||(n=[n]),n=n.concat(this.modifiers),e.Utils.Promise.resolve().then(function(){if(this.shouldAcquireMedia)return this.acquire(this.constraints).then(function(){this.shouldAcquireMedia=!1}.bind(this))}.bind(this)).then(function(){return this.createOfferOrAnswer(t.RTCOfferOptions,n)}.bind(this)).then(function(e){return this.emit("getDescription",e),{body:e.sdp,contentType:this.CONTENT_TYPE}}.bind(this))}},hasDescription:{writable:!0,value:function(e){return e===this.CONTENT_TYPE}},holdModifier:{writable:!0,value:function(t){return/a=(sendrecv|sendonly|recvonly|inactive)/.test(t.sdp)?(t.sdp=t.sdp.replace(/a=sendrecv\r\n/g,"a=sendonly\r\n"),t.sdp=t.sdp.replace(/a=recvonly\r\n/g,"a=inactive\r\n")):t.sdp=t.sdp.replace(/(m=[^\r]*\r\n)/g,"$1a=sendonly\r\n"),e.Utils.Promise.resolve(t)}},setDescription:{writable:!0,value:function(t,n,i){var r=this,s=this;(n=n||{}).peerConnectionOptions&&this.initPeerConnection(n.peerConnectionOptions),i=i||[],Array.isArray(i)||(i=[i]),i=i.concat(this.modifiers);var o={type:this.hasOffer("local")?"answer":"offer",sdp:t};return e.Utils.Promise.resolve().then(function(){if(this.shouldAcquireMedia&&this.options.alwaysAcquireMediaFirst)return this.acquire(this.constraints).then(function(){this.shouldAcquireMedia=!1}.bind(this))}.bind(this)).then(function(){return e.Utils.reducePromises(i,o)}).catch(function(t){if(t instanceof e.Exceptions.SessionDescriptionHandlerError)throw t;var n=new e.Exceptions.SessionDescriptionHandlerError("setDescription",t,"The modifiers did not resolve successfully");throw r.logger.error(n.message),s.emit("peerConnection-setRemoteDescriptionFailed",n),n}).then(function(e){return s.emit("setDescription",e),s.peerConnection.setRemoteDescription(e)}).catch(function(s){if(s instanceof e.Exceptions.SessionDescriptionHandlerError)throw s;if(/^m=video.+$/gm.test(t)&&!n.disableAudioFallback)return n.disableAudioFallback=!0,r.setDescription(t,n,[e.Web.Modifiers.stripVideo].concat(i));var o=new e.Exceptions.SessionDescriptionHandlerError("setDescription",s);throw r.logger.error(o.error),r.emit("peerConnection-setRemoteDescriptionFailed",o),o}).then(function(){s.peerConnection.getReceivers?s.emit("setRemoteDescription",s.peerConnection.getReceivers()):s.emit("setRemoteDescription",s.peerConnection.getRemoteStreams()),s.emit("confirmed",s)})}},sendDtmf:{writable:!0,value:function(e,t){if(!this.dtmfSender&&this.hasBrowserGetSenderSupport()){var n=this.peerConnection.getSenders();n.length>0&&(this.dtmfSender=n[0].dtmf)}if(!this.dtmfSender&&this.hasBrowserTrackSupport()){var i=this.peerConnection.getLocalStreams();if(i.length>0){var r=i[0].getAudioTracks();r.length>0&&(this.dtmfSender=this.peerConnection.createDTMFSender(r[0]))}}if(!this.dtmfSender)return!1;try{this.dtmfSender.insertDTMF(e,t.duration,t.interToneGap)}catch(e){if("InvalidStateError"===e.type||"InvalidCharacterError"===e.type)return this.logger.error(e),!1;throw e}return this.logger.log("DTMF sent via RTP: "+e.toString()),!0}},getDirection:{writable:!0,value:function(){return this.direction}},createOfferOrAnswer:{writable:!0,value:function(t,n){var i,r=this,s=this,o=this.peerConnection;return t=t||{},i=s.hasOffer("remote")?"createAnswer":"createOffer",o[i](t).catch(function(t){if(t instanceof e.Exceptions.SessionDescriptionHandlerError)throw t;var n=new e.Exceptions.SessionDescriptionHandlerError("createOfferOrAnswer",t,"peerConnection-"+i+"Failed");throw r.emit("peerConnection-"+i+"Failed",n),n}).then(function(t){return e.Utils.reducePromises(n,s.createRTCSessionDescriptionInit(t))}).then(function(e){return s.resetIceGatheringComplete(),o.setLocalDescription(e)}).catch(function(t){if(t instanceof e.Exceptions.SessionDescriptionHandlerError)throw t;var n=new e.Exceptions.SessionDescriptionHandlerError("createOfferOrAnswer",t,"peerConnection-SetLocalDescriptionFailed");throw r.emit("peerConnection-SetLocalDescriptionFailed",n),n}).then(function(){return s.waitForIceGatheringComplete()}).then(function(){var t=s.createRTCSessionDescriptionInit(s.peerConnection.localDescription);return e.Utils.reducePromises(n,t)}).then(function(e){return s.setDirection(e.sdp),e}).catch(function(t){if(t instanceof e.Exceptions.SessionDescriptionHandlerError)throw t;var n=new e.Exceptions.SessionDescriptionHandlerError("createOfferOrAnswer",t);throw r.logger.error(n),n})}},createRTCSessionDescriptionInit:{writable:!0,value:function(e){return{type:e.type,sdp:e.sdp}}},addDefaultIceCheckingTimeout:{writable:!0,value:function(e){return void 0===e.iceCheckingTimeout&&(e.iceCheckingTimeout=5e3),e}},addDefaultIceServers:{writable:!0,value:function(e){return e.iceServers||(e.iceServers=[{urls:"stun:stun.l.google.com:19302"}]),e}},checkAndDefaultConstraints:{writable:!0,value:function(e){var t={audio:!0,video:!this.options.alwaysAcquireMediaFirst};return e=e||t,0===Object.keys(e).length&&e.constructor===Object?t:e}},hasBrowserTrackSupport:{writable:!0,value:function(){return Boolean(this.peerConnection.addTrack)}},hasBrowserGetSenderSupport:{writable:!0,value:function(){return Boolean(this.peerConnection.getSenders)}},initPeerConnection:{writable:!0,value:function(t){var n=this;t=t||{},(t=this.addDefaultIceCheckingTimeout(t)).rtcConfiguration=t.rtcConfiguration||{},t.rtcConfiguration=this.addDefaultIceServers(t.rtcConfiguration),this.logger.log("initPeerConnection"),this.peerConnection&&(this.logger.log("Already have a peer connection for this session. Tearing down."),this.resetIceGatheringComplete(),this.peerConnection.close()),this.peerConnection=new this.WebRTC.RTCPeerConnection(t.rtcConfiguration),this.logger.log("New peer connection created"),"ontrack"in this.peerConnection?this.peerConnection.addEventListener("track",function(e){n.logger.log("track added"),n.observer.trackAdded(),n.emit("addTrack",e)}):(this.logger.warn("Using onaddstream which is deprecated"),this.peerConnection.onaddstream=function(e){n.logger.log("stream added"),n.emit("addStream",e)}),this.peerConnection.onicecandidate=function(e){n.emit("iceCandidate",e),e.candidate?n.logger.log("ICE candidate received: "+(null===e.candidate.candidate?null:e.candidate.candidate.trim())):null===e.candidate&&(n.logger.log("ICE candidate gathering complete"),n.triggerIceGatheringComplete())},this.peerConnection.onicegatheringstatechange=function(){switch(n.logger.log("RTCIceGatheringState changed: "+this.iceGatheringState),this.iceGatheringState){case"gathering":n.emit("iceGathering",this),!n.iceGatheringTimer&&t.iceCheckingTimeout&&(n.iceGatheringTimeout=!1,n.iceGatheringTimer=e.Timers.setTimeout(function(){n.logger.log("RTCIceChecking Timeout Triggered after "+t.iceCheckingTimeout+" milliseconds"),n.iceGatheringTimeout=!0,n.triggerIceGatheringComplete()},t.iceCheckingTimeout));break;case"complete":n.triggerIceGatheringComplete()}},this.peerConnection.oniceconnectionstatechange=function(){var e;switch(this.iceConnectionState){case"new":e="iceConnection";break;case"checking":e="iceConnectionChecking";break;case"connected":e="iceConnectionConnected";break;case"completed":e="iceConnectionCompleted";break;case"failed":e="iceConnectionFailed";break;case"disconnected":e="iceConnectionDisconnected";break;case"closed":e="iceConnectionClosed";break;default:return void n.logger.warn("Unknown iceConnection state:",this.iceConnectionState)}n.emit(e,this)}}},acquire:{writable:!0,value:function(t){var n=this;return t=this.checkAndDefaultConstraints(t),new e.Utils.Promise(function(e,n){this.logger.log("acquiring local media"),this.emit("userMediaRequest",t),t.audio||t.video?this.WebRTC.getUserMedia(t).then(function(t){this.observer.trackAdded(),this.emit("userMedia",t),e(t)}.bind(this)).catch(function(e){this.emit("userMediaFailed",e),n(e)}.bind(this)):e([])}.bind(this)).catch(function(t){if(t instanceof e.Exceptions.SessionDescriptionHandlerError)throw t;var i=new e.Exceptions.SessionDescriptionHandlerError("acquire",t,"unable to acquire streams");throw n.logger.error(i.message),n.logger.error(i.error),i}).then(function(t){this.logger.log("acquired local media streams");try{return this.peerConnection.removeTrack&&this.peerConnection.getSenders().forEach(function(e){this.peerConnection.removeTrack(e)},this),t}catch(t){return e.Utils.Promise.reject(t)}}.bind(this)).catch(function(t){if(t instanceof e.Exceptions.SessionDescriptionHandlerError)throw t;var i=new e.Exceptions.SessionDescriptionHandlerError("acquire",t,"error removing streams");throw n.logger.error(i.message),n.logger.error(i.error),i}).then(function(t){try{(t=[].concat(t)).forEach(function(e){this.peerConnection.addTrack?e.getTracks().forEach(function(t){this.peerConnection.addTrack(t,e)},this):this.peerConnection.addStream(e)},this)}catch(t){return e.Utils.Promise.reject(t)}return e.Utils.Promise.resolve()}.bind(this)).catch(function(t){if(t instanceof e.Exceptions.SessionDescriptionHandlerError)throw t;var i=new e.Exceptions.SessionDescriptionHandlerError("acquire",t,"error adding stream");throw n.logger.error(i.message),n.logger.error(i.error),i})}},hasOffer:{writable:!0,value:function(e){var t="have-"+e+"-offer";return this.peerConnection.signalingState===t}},isIceGatheringComplete:{writable:!0,value:function(){return"complete"===this.peerConnection.iceGatheringState||this.iceGatheringTimeout}},resetIceGatheringComplete:{writable:!0,value:function(){this.iceGatheringTimeout=!1,this.iceGatheringTimer&&(e.Timers.clearTimeout(this.iceGatheringTimer),this.iceGatheringTimer=null),this.iceGatheringDeferred&&(this.iceGatheringDeferred.reject(),this.iceGatheringDeferred=null)}},setDirection:{writable:!0,value:function(e){var t=e.match(/a=(sendrecv|sendonly|recvonly|inactive)/);if(null===t)return this.direction=this.C.DIRECTION.NULL,void this.observer.directionChanged();var n=t[1];switch(n){case this.C.DIRECTION.SENDRECV:case this.C.DIRECTION.SENDONLY:case this.C.DIRECTION.RECVONLY:case this.C.DIRECTION.INACTIVE:this.direction=n;break;default:this.direction=this.C.DIRECTION.NULL}this.observer.directionChanged()}},triggerIceGatheringComplete:{writable:!0,value:function(){this.isIceGatheringComplete()&&(this.emit("iceGatheringComplete",this),this.iceGatheringTimer&&(e.Timers.clearTimeout(this.iceGatheringTimer),this.iceGatheringTimer=null),this.iceGatheringDeferred&&(this.iceGatheringDeferred.resolve(),this.iceGatheringDeferred=null))}},waitForIceGatheringComplete:{writable:!0,value:function(){return this.isIceGatheringComplete()?e.Utils.Promise.resolve():(this.isIceGatheringDeferred||(this.iceGatheringDeferred=e.Utils.defer()),this.iceGatheringDeferred.promise)}}}),i}}).call(this,n(28))},function(e,t,n){"use strict";var i=function(e,t){this.session=e||{},this.options=t||{}};i.prototype={trackAdded:function(){this.session.emit("trackAdded")},directionChanged:function(){this.session.emit("directionChanged")}},e.exports=i},function(e,t,n){"use strict";e.exports=function(e){var t,n=[],i=[],r=[];function s(t,n,i){for(var r,s=e.Utils.buildStatusLine(t),o=n.getHeaders("via"),a=o.length,u=0;u<a;u++)s+="Via: "+o[u]+"\r\n";r=n.getHeader("To"),n.to_tag||(r+=";tag="+e.Utils.newTag()),s+="To: "+r+"\r\n",s+="From: "+n.getHeader("From")+"\r\n",s+="Call-ID: "+n.call_id+"\r\n",s+="CSeq: "+n.cseq+" "+n.method+"\r\n",s+="\r\n",i.send(s)}n.push(function(e,t,n){if(!e.ruri||"sip"!==e.ruri.scheme)return s(416,e,n),!1}),n.push(function(e,t,n){if(!e.to_tag&&e.call_id.substr(0,5)===t.configuration.sipjsId)return s(482,e,n),!1}),n.push(function(t,n,i){if(e.Utils.str_utf8_length(t.body)<t.getHeader("content-length"))return s(400,t,i),!1}),n.push(function(t,n,i){var r,o,a=t.from_tag,u=t.call_id,l=t.cseq;if(!t.to_tag)if(t.method===e.C.INVITE){if(r=n.transactions.ist[t.via_branch])return;for(o in n.transactions.ist)if((r=n.transactions.ist[o]).request.from_tag===a&&r.request.call_id===u&&r.request.cseq===l)return s(482,t,i),!1}else{if(r=n.transactions.nist[t.via_branch])return;for(o in n.transactions.nist)if((r=n.transactions.nist[o]).request.from_tag===a&&r.request.call_id===u&&r.request.cseq===l)return s(482,t,i),!1}}),i.push(function(e,t){if(e.getHeaders("via").length>1)return t.getLogger("sip.sanitycheck").warn("More than one Via header field present in the response. Dropping the response"),!1}),i.push(function(e,t){var n=t.configuration.viaHost;if(e.via.host!==n||void 0!==e.via.port)return t.getLogger("sip.sanitycheck").warn("Via sent-by in the response does not match UA Via host value. Dropping the response"),!1}),i.push(function(t,n){if(e.Utils.str_utf8_length(t.body)<t.getHeader("content-length"))return n.getLogger("sip.sanitycheck").warn("Message body length is lower than the value in Content-Length header field. Dropping the response"),!1}),r.push(function(e,t){for(var n=["from","to","call_id","cseq","via"],i=n.length;i--;)if(!e.hasHeader(n[i]))return t.getLogger("sip.sanitycheck").warn("Missing mandatory header field : "+n[i]+". Dropping the response"),!1}),t=function(t,s,o){var a;for(a=r.length;a--;)if(!1===r[a](t,s,o))return!1;if(t instanceof e.IncomingRequest){for(a=n.length;a--;)if(!1===n[a](t,s,o))return!1}else if(t instanceof e.IncomingResponse)for(a=i.length;a--;)if(!1===i[a](t,s,o))return!1;return!0},e.sanityCheck=t}},function(e,t,n){"use strict";var i=n(34);e.exports=function(e){var t;return(t=function(e){this.logger=e.getLogger("sipjs.digestauthentication"),this.username=e.configuration.authorizationUser,this.password=e.configuration.password,this.cnonce=null,this.nc=0,this.ncHex="00000000",this.response=null}).prototype.authenticate=function(t,n){if(this.algorithm=n.algorithm,this.realm=n.realm,this.nonce=n.nonce,this.opaque=n.opaque,this.stale=n.stale,this.algorithm){if("MD5"!==this.algorithm)return this.logger.warn('challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this.algorithm="MD5";if(!this.realm)return this.logger.warn("challenge without Digest realm, authentication aborted"),!1;if(!this.nonce)return this.logger.warn("challenge without Digest nonce, authentication aborted"),!1;if(n.qop)if(n.qop.indexOf("auth")>-1)this.qop="auth";else{if(!(n.qop.indexOf("auth-int")>-1))return this.logger.warn('challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this.qop="auth-int"}else this.qop=null;return this.method=t.method,this.uri=t.ruri,this.cnonce=e.createRandomToken(12),this.nc+=1,this.updateNcHex(),4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.calculateResponse(),!0},t.prototype.calculateResponse=function(){var e,t;e=i(this.username+":"+this.realm+":"+this.password),"auth"===this.qop?(t=i(this.method+":"+this.uri),this.response=i(e+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+t)):"auth-int"===this.qop?(t=i(this.method+":"+this.uri+":"+i(this.body?this.body:"")),this.response=i(e+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+t)):null===this.qop&&(t=i(this.method+":"+this.uri),this.response=i(e+":"+this.nonce+":"+t))},t.prototype.toString=function(){var e=[];if(!this.response)throw new Error("response field does not exist, cannot generate Authorization header");return e.push("algorithm="+this.algorithm),e.push('username="'+this.username+'"'),e.push('realm="'+this.realm+'"'),e.push('nonce="'+this.nonce+'"'),e.push('uri="'+this.uri+'"'),e.push('response="'+this.response+'"'),this.opaque&&e.push('opaque="'+this.opaque+'"'),this.qop&&(e.push("qop="+this.qop),e.push('cnonce="'+this.cnonce+'"'),e.push("nc="+this.ncHex)),"Digest "+e.join(", ")},t.prototype.updateNcHex=function(){var e=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-e.length)+e},t}},function(e,t,n){e.exports=function(e){return function(t){var n=e,i=n.lib,r=i.WordArray,s=i.Hasher,o=n.algo,a=[];!function(){for(var e=0;e<64;e++)a[e]=4294967296*t.abs(t.sin(e+1))|0}();var u=o.MD5=s.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var i=t+n,r=e[i];e[i]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}var s=this._hash.words,o=e[t+0],u=e[t+1],p=e[t+2],f=e[t+3],m=e[t+4],g=e[t+5],T=e[t+6],v=e[t+7],y=e[t+8],E=e[t+9],b=e[t+10],S=e[t+11],_=e[t+12],C=e[t+13],w=e[t+14],R=e[t+15],A=s[0],I=s[1],N=s[2],x=s[3];I=h(I=h(I=h(I=h(I=d(I=d(I=d(I=d(I=c(I=c(I=c(I=c(I=l(I=l(I=l(I=l(I,N=l(N,x=l(x,A=l(A,I,N,x,o,7,a[0]),I,N,u,12,a[1]),A,I,p,17,a[2]),x,A,f,22,a[3]),N=l(N,x=l(x,A=l(A,I,N,x,m,7,a[4]),I,N,g,12,a[5]),A,I,T,17,a[6]),x,A,v,22,a[7]),N=l(N,x=l(x,A=l(A,I,N,x,y,7,a[8]),I,N,E,12,a[9]),A,I,b,17,a[10]),x,A,S,22,a[11]),N=l(N,x=l(x,A=l(A,I,N,x,_,7,a[12]),I,N,C,12,a[13]),A,I,w,17,a[14]),x,A,R,22,a[15]),N=c(N,x=c(x,A=c(A,I,N,x,u,5,a[16]),I,N,T,9,a[17]),A,I,S,14,a[18]),x,A,o,20,a[19]),N=c(N,x=c(x,A=c(A,I,N,x,g,5,a[20]),I,N,b,9,a[21]),A,I,R,14,a[22]),x,A,m,20,a[23]),N=c(N,x=c(x,A=c(A,I,N,x,E,5,a[24]),I,N,w,9,a[25]),A,I,f,14,a[26]),x,A,y,20,a[27]),N=c(N,x=c(x,A=c(A,I,N,x,C,5,a[28]),I,N,p,9,a[29]),A,I,v,14,a[30]),x,A,_,20,a[31]),N=d(N,x=d(x,A=d(A,I,N,x,g,4,a[32]),I,N,y,11,a[33]),A,I,S,16,a[34]),x,A,w,23,a[35]),N=d(N,x=d(x,A=d(A,I,N,x,u,4,a[36]),I,N,m,11,a[37]),A,I,v,16,a[38]),x,A,b,23,a[39]),N=d(N,x=d(x,A=d(A,I,N,x,C,4,a[40]),I,N,o,11,a[41]),A,I,f,16,a[42]),x,A,T,23,a[43]),N=d(N,x=d(x,A=d(A,I,N,x,E,4,a[44]),I,N,_,11,a[45]),A,I,R,16,a[46]),x,A,p,23,a[47]),N=h(N,x=h(x,A=h(A,I,N,x,o,6,a[48]),I,N,v,10,a[49]),A,I,w,15,a[50]),x,A,g,21,a[51]),N=h(N,x=h(x,A=h(A,I,N,x,_,6,a[52]),I,N,f,10,a[53]),A,I,b,15,a[54]),x,A,u,21,a[55]),N=h(N,x=h(x,A=h(A,I,N,x,y,6,a[56]),I,N,R,10,a[57]),A,I,T,15,a[58]),x,A,C,21,a[59]),N=h(N,x=h(x,A=h(A,I,N,x,m,6,a[60]),I,N,S,10,a[61]),A,I,p,15,a[62]),x,A,E,21,a[63]),s[0]=s[0]+A|0,s[1]=s[1]+I|0,s[2]=s[2]+N|0,s[3]=s[3]+x|0},_doFinalize:function(){var e=this._data,n=e.words,i=8*this._nDataBytes,r=8*e.sigBytes;n[r>>>5]|=128<<24-r%32;var s=t.floor(i/4294967296),o=i;n[15+(r+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),n[14+(r+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),e.sigBytes=4*(n.length+1),this._process();for(var a=this._hash,u=a.words,l=0;l<4;l++){var c=u[l];u[l]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}return a},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});function l(e,t,n,i,r,s,o){var a=e+(t&n|~t&i)+r+o;return(a<<s|a>>>32-s)+t}function c(e,t,n,i,r,s,o){var a=e+(t&i|n&~i)+r+o;return(a<<s|a>>>32-s)+t}function d(e,t,n,i,r,s,o){var a=e+(t^n^i)+r+o;return(a<<s|a>>>32-s)+t}function h(e,t,n,i,r,s,o){var a=e+(n^(t|~i))+r+o;return(a<<s|a>>>32-s)+t}n.MD5=s._createHelper(u),n.HmacMD5=s._createHmacHelper(u)}(Math),e.MD5}(n(35))},function(e,t,n){e.exports=function(){var e=e||function(e,t){var n=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),i={},r=i.lib={},s=r.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=r.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes,r=e.sigBytes;if(this.clamp(),i%4)for(var s=0;s<r;s++){var o=n[s>>>2]>>>24-s%4*8&255;t[i+s>>>2]|=o<<24-(i+s)%4*8}else for(var s=0;s<r;s+=4)t[i+s>>>2]=n[s>>>2];return this.sigBytes+=r,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n,i=[],r=function(t){var t=t,n=987654321,i=4294967295;return function(){var r=((n=36969*(65535&n)+(n>>16)&i)<<16)+(t=18e3*(65535&t)+(t>>16)&i)&i;return r/=4294967296,(r+=.5)*(e.random()>.5?1:-1)}},s=0;s<t;s+=4){var a=r(4294967296*(n||e.random()));n=987654071*a(),i.push(4294967296*a()|0)}return new o.init(i,t)}}),a=i.enc={},u=a.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],r=0;r<n;r++){var s=t[r>>>2]>>>24-r%4*8&255;i.push((s>>>4).toString(16)),i.push((15&s).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new o.init(n,t/2)}},l=a.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],r=0;r<n;r++){var s=t[r>>>2]>>>24-r%4*8&255;i.push(String.fromCharCode(s))}return i.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new o.init(n,t)}},c=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(l.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return l.parse(unescape(encodeURIComponent(e)))}},d=r.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,i=n.words,r=n.sigBytes,s=this.blockSize,a=4*s,u=r/a,l=(u=t?e.ceil(u):e.max((0|u)-this._minBufferSize,0))*s,c=e.min(4*l,r);if(l){for(var d=0;d<l;d+=s)this._doProcessBlock(i,d);var h=i.splice(0,l);n.sigBytes-=c}return new o.init(h,c)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),h=(r.Hasher=d.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}}),i.algo={});return i}(Math);return e}()},function(e,t,n){"use strict";var i=n(37);e.exports=function(e){return{parse:function(t,n){var r={startRule:n,SIP:e};try{i.parse(t,r)}catch(e){r.data=-1}return r.data}}}},function(e,t,n){"use strict";function i(e,t,n,r){this.message=e,this.expected=t,this.found=n,this.location=r,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,i)}!function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}(i,Error),i.buildMessage=function(e,t){var n={literal:function(e){return'"'+r(e.text)+'"'},class:function(e){var t,n="";for(t=0;t<e.parts.length;t++)n+=e.parts[t]instanceof Array?s(e.parts[t][0])+"-"+s(e.parts[t][1]):s(e.parts[t]);return"["+(e.inverted?"^":"")+n+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function i(e){return e.charCodeAt(0).toString(16).toUpperCase()}function r(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+i(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+i(e)})}function s(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+i(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+i(e)})}function o(e){return n[e.type](e)}return"Expected "+function(e){var t,n,i=new Array(e.length);for(t=0;t<e.length;t++)i[t]=o(e[t]);if(i.sort(),i.length>0){for(t=1,n=1;t<i.length;t++)i[t-1]!==i[t]&&(i[n]=i[t],n++);i.length=n}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(e)+" but "+function(e){return e?'"'+r(e)+'"':"end of input"}(t)+" found."},e.exports={SyntaxError:i,parse:function(e,t){t=void 0!==t?t:{};var n,r={},s={Contact:119,Name_Addr_Header:156,Record_Route:176,Request_Response:81,SIP_URI:45,Subscription_State:186,Supported:191,Require:182,Via:194,absoluteURI:84,Call_ID:118,Content_Disposition:130,Content_Length:135,Content_Type:136,CSeq:146,displayName:122,Event:149,From:151,host:52,Max_Forwards:154,Min_SE:213,Proxy_Authenticate:157,quoted_string:40,Refer_To:178,Replaces:179,Session_Expires:210,stun_URI:217,To:192,turn_URI:223,uuid:226,WWW_Authenticate:209,challenge:158,sipfrag:230,Referred_By:231},o=119,a=["\r\n",T("\r\n",!1),/^[0-9]/,v([["0","9"]],!1,!1),/^[a-zA-Z]/,v([["a","z"],["A","Z"]],!1,!1),/^[0-9a-fA-F]/,v([["0","9"],["a","f"],["A","F"]],!1,!1),/^[\0-\xFF]/,v([["\0","ÿ"]],!1,!1),/^["]/,v(['"'],!1,!1)," ",T(" ",!1),"\t",T("\t",!1),/^[a-zA-Z0-9]/,v([["a","z"],["A","Z"],["0","9"]],!1,!1),";",T(";",!1),"/",T("/",!1),"?",T("?",!1),":",T(":",!1),"@",T("@",!1),"&",T("&",!1),"=",T("=",!1),"+",T("+",!1),"$",T("$",!1),",",T(",",!1),"-",T("-",!1),"_",T("_",!1),".",T(".",!1),"!",T("!",!1),"~",T("~",!1),"*",T("*",!1),"'",T("'",!1),"(",T("(",!1),")",T(")",!1),"%",T("%",!1),function(){return" "},function(){return":"},/^[!-~]/,v([["!","~"]],!1,!1),/^[\x80-\uFFFF]/,v([["","￿"]],!1,!1),/^[\x80-\xBF]/,v([["","¿"]],!1,!1),/^[a-f]/,v([["a","f"]],!1,!1),"`",T("`",!1),"<",T("<",!1),">",T(">",!1),"\\",T("\\",!1),"[",T("[",!1),"]",T("]",!1),"{",T("{",!1),"}",T("}",!1),function(){return"*"},function(){return"/"},function(){return"="},function(){return"("},function(){return")"},function(){return">"},function(){return"<"},function(){return","},function(){return";"},function(){return":"},function(){return'"'},/^[!-']/,v([["!","'"]],!1,!1),/^[*-[]/,v([["*","["]],!1,!1),/^[\]-~]/,v([["]","~"]],!1,!1),function(e){return e},/^[#-[]/,v([["#","["]],!1,!1),/^[\0-\t]/,v([["\0","\t"]],!1,!1),/^[\x0B-\f]/,v([["\v","\f"]],!1,!1),/^[\x0E-\x7F]/,v([["",""]],!1,!1),function(){t.data.uri=new t.SIP.URI(t.data.scheme,t.data.user,t.data.host,t.data.port),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port},function(){t.data.uri=new t.SIP.URI(t.data.scheme,t.data.user,t.data.host,t.data.port,t.data.uri_params,t.data.uri_headers),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port,delete t.data.uri_params,"SIP_URI"===t.startRule&&(t.data=t.data.uri)},"sips",T("sips",!0),"sip",T("sip",!0),function(e){t.data.scheme=e},function(){t.data.user=decodeURIComponent(m().slice(0,-1))},function(){t.data.password=m()},function(){return t.data.host=m(),t.data.host},function(){return t.data.host_type="domain",m()},/^[a-zA-Z0-9_\-]/,v([["a","z"],["A","Z"],["0","9"],"_","-"],!1,!1),/^[a-zA-Z0-9\-]/,v([["a","z"],["A","Z"],["0","9"],"-"],!1,!1),function(){return t.data.host_type="IPv6",m()},"::",T("::",!1),function(){return t.data.host_type="IPv6",m()},function(){return t.data.host_type="IPv4",m()},"25",T("25",!1),/^[0-5]/,v([["0","5"]],!1,!1),"2",T("2",!1),/^[0-4]/,v([["0","4"]],!1,!1),"1",T("1",!1),/^[1-9]/,v([["1","9"]],!1,!1),function(e){return e=parseInt(e.join("")),t.data.port=e,e},"transport=",T("transport=",!0),"udp",T("udp",!0),"tcp",T("tcp",!0),"sctp",T("sctp",!0),"tls",T("tls",!0),function(e){t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.transport=e.toLowerCase()},"user=",T("user=",!0),"phone",T("phone",!0),"ip",T("ip",!0),function(e){t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.user=e.toLowerCase()},"method=",T("method=",!0),function(e){t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.method=e},"ttl=",T("ttl=",!0),function(e){t.data.params||(t.data.params={}),t.data.params.ttl=e},"maddr=",T("maddr=",!0),function(e){t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.maddr=e},"lr",T("lr",!0),function(){t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.lr=void 0},function(e,n){t.data.uri_params||(t.data.uri_params={}),n=null===n?void 0:n[1],t.data.uri_params[e.toLowerCase()]=n},function(e,n){e=e.join("").toLowerCase(),n=n.join(""),t.data.uri_headers||(t.data.uri_headers={}),t.data.uri_headers[e]?t.data.uri_headers[e].push(n):t.data.uri_headers[e]=[n]},function(){"Refer_To"===t.startRule&&(t.data.uri=new t.SIP.URI(t.data.scheme,t.data.user,t.data.host,t.data.port,t.data.uri_params,t.data.uri_headers),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port,delete t.data.uri_params)},"//",T("//",!1),function(){t.data.scheme=m()},T("SIP",!0),function(){t.data.sip_version=m()},"INVITE",T("INVITE",!1),"ACK",T("ACK",!1),"VXACH",T("VXACH",!1),"OPTIONS",T("OPTIONS",!1),"BYE",T("BYE",!1),"CANCEL",T("CANCEL",!1),"REGISTER",T("REGISTER",!1),"SUBSCRIBE",T("SUBSCRIBE",!1),"NOTIFY",T("NOTIFY",!1),"REFER",T("REFER",!1),"PUBLISH",T("PUBLISH",!1),function(){return t.data.method=m(),t.data.method},function(e){t.data.status_code=parseInt(e.join(""))},function(){t.data.reason_phrase=m()},function(){t.data=m()},function(){var e,n;for(n=t.data.multi_header.length,e=0;e<n;e++)if(null===t.data.multi_header[e].parsed){t.data=null;break}null!==t.data?t.data=t.data.multi_header:t.data=-1},function(){var e;t.data.multi_header||(t.data.multi_header=[]);try{e=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),delete t.data.uri,delete t.data.displayName,delete t.data.params}catch(t){e=null}t.data.multi_header.push({position:l,offset:g().start.offset,parsed:e})},function(e){'"'===(e=m().trim())[0]&&(e=e.substring(1,e.length-1)),t.data.displayName=e},"q",T("q",!0),function(e){t.data.params||(t.data.params={}),t.data.params.q=e},"expires",T("expires",!0),function(e){t.data.params||(t.data.params={}),t.data.params.expires=e},function(e){return parseInt(e.join(""))},"0",T("0",!1),function(){return parseFloat(m())},function(e,n){t.data.params||(t.data.params={}),n=null===n?void 0:n[1],t.data.params[e.toLowerCase()]=n},"render",T("render",!0),"session",T("session",!0),"icon",T("icon",!0),"alert",T("alert",!0),function(){"Content_Disposition"===t.startRule&&(t.data.type=m().toLowerCase())},"handling",T("handling",!0),"optional",T("optional",!0),"required",T("required",!0),function(e){t.data=parseInt(e.join(""))},function(){t.data=m()},"text",T("text",!0),"image",T("image",!0),"audio",T("audio",!0),"video",T("video",!0),"application",T("application",!0),"message",T("message",!0),"multipart",T("multipart",!0),"x-",T("x-",!0),function(e){t.data.value=parseInt(e.join(""))},function(e){t.data=e},function(e){t.data.event=e.toLowerCase()},function(){var e=t.data.tag;t.data=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),e&&t.data.setParam("tag",e)},"tag",T("tag",!0),function(e){t.data.tag=e},function(e){t.data=parseInt(e.join(""))},function(e){t.data=e},function(){t.data=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params)},"digest",T("Digest",!0),"realm",T("realm",!0),function(e){t.data.realm=e},"domain",T("domain",!0),"nonce",T("nonce",!0),function(e){t.data.nonce=e},"opaque",T("opaque",!0),function(e){t.data.opaque=e},"stale",T("stale",!0),"true",T("true",!0),function(){t.data.stale=!0},"false",T("false",!0),function(){t.data.stale=!1},"algorithm",T("algorithm",!0),"md5",T("MD5",!0),"md5-sess",T("MD5-sess",!0),function(e){t.data.algorithm=e.toUpperCase()},"qop",T("qop",!0),"auth-int",T("auth-int",!0),"auth",T("auth",!0),function(e){t.data.qop||(t.data.qop=[]),t.data.qop.push(e.toLowerCase())},function(e){t.data.value=parseInt(e.join(""))},function(){var e,n;for(n=t.data.multi_header.length,e=0;e<n;e++)if(null===t.data.multi_header[e].parsed){t.data=null;break}null!==t.data?t.data=t.data.multi_header:t.data=-1},function(){var e;t.data.multi_header||(t.data.multi_header=[]);try{e=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),delete t.data.uri,delete t.data.displayName,delete t.data.params}catch(t){e=null}t.data.multi_header.push({position:l,offset:g().start.offset,parsed:e})},function(){t.data=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params)},function(){t.data.replaces_from_tag&&t.data.replaces_to_tag||(t.data=-1)},function(){t.data={call_id:t.data}},"from-tag",T("from-tag",!0),function(e){t.data.replaces_from_tag=e},"to-tag",T("to-tag",!0),function(e){t.data.replaces_to_tag=e},"early-only",T("early-only",!0),function(){t.data.early_only=!0},function(e,t){return t},function(e,t){return function(e,t){return[e].concat(t)}(e,t)},function(e){"Require"===t.startRule&&(t.data=e||[])},function(e){t.data.value=parseInt(e.join(""))},"active",T("active",!0),"pending",T("pending",!0),"terminated",T("terminated",!0),function(){t.data.state=m()},"reason",T("reason",!0),function(e){void 0!==e&&(t.data.reason=e)},function(e){void 0!==e&&(t.data.expires=e)},"retry_after",T("retry_after",!0),function(e){void 0!==e&&(t.data.retry_after=e)},"deactivated",T("deactivated",!0),"probation",T("probation",!0),"rejected",T("rejected",!0),"timeout",T("timeout",!0),"giveup",T("giveup",!0),"noresource",T("noresource",!0),"invariant",T("invariant",!0),function(e){"Supported"===t.startRule&&(t.data=e||[])},function(){var e=t.data.tag;t.data=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),e&&t.data.setParam("tag",e)},"ttl",T("ttl",!0),function(e){t.data.ttl=e},"maddr",T("maddr",!0),function(e){t.data.maddr=e},"received",T("received",!0),function(e){t.data.received=e},"branch",T("branch",!0),function(e){t.data.branch=e},"rport",T("rport",!0),function(){"undefined"!=typeof response_port&&(t.data.rport=response_port.join(""))},function(e){t.data.protocol=e},T("UDP",!0),T("TCP",!0),T("TLS",!0),T("SCTP",!0),function(e){t.data.transport=e},function(){t.data.host=m()},function(e){t.data.port=parseInt(e.join(""))},function(e){return parseInt(e.join(""))},function(e){"Session_Expires"===t.startRule&&(t.data.deltaSeconds=e)},"refresher",T("refresher",!1),"uas",T("uas",!1),"uac",T("uac",!1),function(e){"Session_Expires"===t.startRule&&(t.data.refresher=e)},function(e){"Min_SE"===t.startRule&&(t.data=e)},"stuns",T("stuns",!0),"stun",T("stun",!0),function(e){t.data.scheme=e},function(e){t.data.host=e},"?transport=",T("?transport=",!1),"turns",T("turns",!0),"turn",T("turn",!0),function(){t.data.transport=transport},function(){t.data=m()},"Referred-By",T("Referred-By",!1),"b",T("b",!1),"cid",T("cid",!1)],u=[_('2 ""6 7!'),_('4"""5!7#'),_('4$""5!7%'),_('4&""5!7\''),_(";'.# &;("),_('4(""5!7)'),_('4*""5!7+'),_('2,""6,7-'),_('2.""6.7/'),_('40""5!71'),_('22""6273. &24""6475.} &26""6677.q &28""6879.e &2:""6:7;.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E'),_(";).# &;,"),_('2F""6F7G.} &2H""6H7I.q &2J""6J7K.e &2L""6L7M.Y &2N""6N7O.M &2P""6P7Q.A &2R""6R7S.5 &2T""6T7U.) &2V""6V7W'),_('%%2X""6X7Y/5#;#/,$;#/#$+#)(#\'#("\'#&\'#/"!&,)'),_('%%$;$0#*;$&/,#; /#$+")("\'#&\'#." &"/=#$;$/&#0#*;$&&&#/\'$8":Z" )("\'#&\'#'),_(';.." &"'),_("%$;'.# &;(0)*;'.# &;(&/?#28\"\"6879/0$;//'$8#:[# )(#'#(\"'#&'#"),_('%%$;2/&#0#*;2&&&#/g#$%$;.0#*;.&/,#;2/#$+")("\'#&\'#0=*%$;.0#*;.&/,#;2/#$+")("\'#&\'#&/#$+")("\'#&\'#/"!&,)'),_('4\\""5!7].# &;3'),_('4^""5!7_'),_('4`""5!7a'),_(';!.) &4b""5!7c'),_('%$;). &2F""6F7G. &2J""6J7K.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O/#0*;). &2F""6F7G. &2J""6J7K.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O&&&#/"!&,)'),_('%$;). &2F""6F7G.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O/#0*;). &2F""6F7G.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O&&&#/"!&,)'),_('2T""6T7U.ã &2V""6V7W.× &2f""6f7g.Ë &2h""6h7i.¿ &2:""6:7;.³ &2D""6D7E.§ &22""6273. &28""6879. &2j""6j7k. &;&.} &24""6475.q &2l""6l7m.e &2n""6n7o.Y &26""6677.M &2>""6>7?.A &2p""6p7q.5 &2r""6r7s.) &;\'.# &;('),_('%$;).ī &2F""6F7G.ğ &2J""6J7K.ē &2L""6L7M.ć &2X""6X7Y.û &2P""6P7Q.ï &2H""6H7I.ã &2@""6@7A.× &2d""6d7e.Ë &2R""6R7S.¿ &2N""6N7O.³ &2T""6T7U.§ &2V""6V7W. &2f""6f7g. &2h""6h7i. &28""6879.w &2j""6j7k.k &;&.e &24""6475.Y &2l""6l7m.M &2n""6n7o.A &26""6677.5 &2p""6p7q.) &2r""6r7s/Ĵ#0ı*;).ī &2F""6F7G.ğ &2J""6J7K.ē &2L""6L7M.ć &2X""6X7Y.û &2P""6P7Q.ï &2H""6H7I.ã &2@""6@7A.× &2d""6d7e.Ë &2R""6R7S.¿ &2N""6N7O.³ &2T""6T7U.§ &2V""6V7W. &2f""6f7g. &2h""6h7i. &28""6879.w &2j""6j7k.k &;&.e &24""6475.Y &2l""6l7m.M &2n""6n7o.A &26""6677.5 &2p""6p7q.) &2r""6r7s&&&#/"!&,)'),_("%;//?#2P\"\"6P7Q/0$;//'$8#:t# )(#'#(\"'#&'#"),_("%;//?#24\"\"6475/0$;//'$8#:u# )(#'#(\"'#&'#"),_("%;//?#2>\"\"6>7?/0$;//'$8#:v# )(#'#(\"'#&'#"),_("%;//?#2T\"\"6T7U/0$;//'$8#:w# )(#'#(\"'#&'#"),_("%;//?#2V\"\"6V7W/0$;//'$8#:x# )(#'#(\"'#&'#"),_('%2h""6h7i/0#;//\'$8":y" )("\'#&\'#'),_('%;//6#2f""6f7g/\'$8":z" )("\'#&\'#'),_("%;//?#2D\"\"6D7E/0$;//'$8#:{# )(#'#(\"'#&'#"),_("%;//?#22\"\"6273/0$;//'$8#:|# )(#'#(\"'#&'#"),_("%;//?#28\"\"6879/0$;//'$8#:}# )(#'#(\"'#&'#"),_("%;//0#;&/'$8\":~\" )(\"'#&'#"),_("%;&/0#;//'$8\":~\" )(\"'#&'#"),_("%;=/T#$;G.) &;K.# &;F0/*;G.) &;K.# &;F&/,$;>/#$+#)(#'#(\"'#&'#"),_('4""5!7.A &4""5!7.5 &4""5!7.) &;3.# &;.'),_("%%;//Q#;&/H$$;J.# &;K0)*;J.# &;K&/,$;&/#$+$)($'#(#'#(\"'#&'#/\"!&,)"),_("%;//]#;&/T$%$;J.# &;K0)*;J.# &;K&/\"!&,)/1$;&/($8$:$!!)($'#(#'#(\"'#&'#"),_(';..G &2L""6L7M.; &4""5!7./ &4""5!7.# &;3'),_('%2j""6j7k/J#4""5!7.5 &4""5!7.) &4""5!7/#$+")("\'#&\'#'),_("%;N/M#28\"\"6879/>$;O.\" &\"/0$;S/'$8$:$ )($'#(#'#(\"'#&'#"),_("%;N/d#28\"\"6879/U$;O.\" &\"/G$;S/>$;_/5$;l.\" &\"/'$8&:& )(&'#(%'#($'#(#'#(\"'#&'#"),_('%3""5$7.) &3""5#7/\' 8!:!! )'),_('%;P/]#%28""6879/,#;R/#$+")("\'#&\'#." &"/6$2:""6:7;/\'$8#:# )(#\'#("\'#&\'#'),_("$;+.) &;-.# &;Q/2#0/*;+.) &;-.# &;Q&&&#"),_('2<""6<7=.q &2>""6>7?.e &2@""6@7A.Y &2B""6B7C.M &2D""6D7E.A &22""6273.5 &26""6677.) &24""6475'),_('%$;+._ &;-.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E0e*;+._ &;-.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E&/& 8!:! )'),_('%;T/J#%28""6879/,#;^/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),_("%;U.) &;\\.# &;X/& 8!:! )"),_('%$%;V/2#2J""6J7K/#$+")("\'#&\'#0<*%;V/2#2J""6J7K/#$+")("\'#&\'#&/D#;W/;$2J""6J7K." &"/\'$8#:# )(#\'#("\'#&\'#'),_('$4""5!7/,#0)*4""5!7&&&#'),_('%4$""5!7%/?#$4""5!70)*4""5!7&/#$+")("\'#&\'#'),_('%2l""6l7m/?#;Y/6$2n""6n7o/\'$8#:# )(#\'#("\'#&\'#'),_('%%;Z/³#28""6879/¤$;Z/$28""6879/$;Z/$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+-)(-\'#(,\'#(+\'#(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ސ &%2""67/¤#;Z/$28""6879/$;Z/$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+,)(,\'#(+\'#(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.۹ &%2""67/#;Z/$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+*)(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ٺ &%2""67/t#;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ؓ &%2""67/\\#;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+&)(&\'#(%\'#($\'#(#\'#("\'#&\'#.ׄ &%2""67/D#;Z/;$28""6879/,$;[/#$+$)($\'#(#\'#("\'#&\'#.֍ &%2""67/,#;[/#$+")("\'#&\'#.ծ &%2""67/,#;Z/#$+")("\'#&\'#.Տ &%;Z/#2""67/$;Z/$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$++)(+\'#(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.Ӈ &%;Z/ª#%28""6879/,#;Z/#$+")("\'#&\'#." &"/$2""67/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+*)(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.а &%;Z/¹#%28""6879/,#;Z/#$+")("\'#&\'#." &"/$%28""6879/,#;Z/#$+")("\'#&\'#." &"/k$2""67/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+))()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.Ί &%;Z/È#%28""6879/,#;Z/#$+")("\'#&\'#." &"/¡$%28""6879/,#;Z/#$+")("\'#&\'#." &"/z$%28""6879/,#;Z/#$+")("\'#&\'#." &"/S$2""67/D$;Z/;$28""6879/,$;[/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.˕ &%;Z/×#%28""6879/,#;Z/#$+")("\'#&\'#." &"/°$%28""6879/,#;Z/#$+")("\'#&\'#." &"/$%28""6879/,#;Z/#$+")("\'#&\'#." &"/b$%28""6879/,#;Z/#$+")("\'#&\'#." &"/;$2""67/,$;[/#$+\')(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ȑ &%;Z/þ#%28""6879/,#;Z/#$+")("\'#&\'#." &"/×$%28""6879/,#;Z/#$+")("\'#&\'#." &"/°$%28""6879/,#;Z/#$+")("\'#&\'#." &"/$%28""6879/,#;Z/#$+")("\'#&\'#." &"/b$%28""6879/,#;Z/#$+")("\'#&\'#." &"/;$2""67/,$;Z/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.Ħ &%;Z/Ĝ#%28""6879/,#;Z/#$+")("\'#&\'#." &"/õ$%28""6879/,#;Z/#$+")("\'#&\'#." &"/Î$%28""6879/,#;Z/#$+")("\'#&\'#." &"/§$%28""6879/,#;Z/#$+")("\'#&\'#." &"/$%28""6879/,#;Z/#$+")("\'#&\'#." &"/Y$%28""6879/,#;Z/#$+")("\'#&\'#." &"/2$2""67/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#/& 8!: ! )'),_('%;#/M#;#." &"/?$;#." &"/1$;#." &"/#$+$)($\'#(#\'#("\'#&\'#'),_("%;Z/;#28\"\"6879/,$;Z/#$+#)(#'#(\"'#&'#.# &;\\"),_("%;]/o#2J\"\"6J7K/`$;]/W$2J\"\"6J7K/H$;]/?$2J\"\"6J7K/0$;]/'$8':¡' )(''#(&'#(%'#($'#(#'#(\"'#&'#"),_('%2¢""6¢7£/2#4¤""5!7¥/#$+")("\'#&\'#. &%2¦""6¦7§/;#4¨""5!7©/,$;!/#$+#)(#\'#("\'#&\'#.j &%2ª""6ª7«/5#;!/,$;!/#$+#)(#\'#("\'#&\'#.B &%4¬""5!7­/,#;!/#$+")("\'#&\'#.# &;!'),_('%%;!." &"/[#;!." &"/M$;!." &"/?$;!." &"/1$;!." &"/#$+%)(%\'#($\'#(#\'#("\'#&\'#/\' 8!:®!! )'),_('$%22""6273/,#;`/#$+")("\'#&\'#0<*%22""6273/,#;`/#$+")("\'#&\'#&'),_(";a.A &;b.; &;c.5 &;d./ &;e.) &;f.# &;g"),_('%3¯""5*7°/a#3±""5#7².G &3³""5#7´.; &3µ""5$7¶./ &3·""5#7¸.# &;6/($8":¹"! )("\'#&\'#'),_('%3º""5%7»/I#3¼""5%7½./ &3¾""5"7¿.# &;6/($8":À"! )("\'#&\'#'),_('%3Á""5\'7Â/1#;/($8":Ã"! )("\'#&\'#'),_('%3Ä""5$7Å/1#;ð/($8":Æ"! )("\'#&\'#'),_('%3Ç""5&7È/1#;T/($8":É"! )("\'#&\'#'),_('%3Ê""5"7Ë/N#%2>""6>7?/,#;6/#$+")("\'#&\'#." &"/\'$8":Ì" )("\'#&\'#'),_('%;h/P#%2>""6>7?/,#;i/#$+")("\'#&\'#." &"/)$8":Í""! )("\'#&\'#'),_('%$;j/&#0#*;j&&&#/"!&,)'),_('%$;j/&#0#*;j&&&#/"!&,)'),_(";k.) &;+.# &;-"),_('2l""6l7m.e &2n""6n7o.Y &24""6475.M &28""6879.A &2<""6<7=.5 &2@""6@7A.) &2B""6B7C'),_('%26""6677/n#;m/e$$%2<""6<7=/,#;m/#$+")("\'#&\'#0<*%2<""6<7=/,#;m/#$+")("\'#&\'#&/#$+#)(#\'#("\'#&\'#'),_('%;n/A#2>""6>7?/2$;o/)$8#:Î#"" )(#\'#("\'#&\'#'),_("$;p.) &;+.# &;-/2#0/*;p.) &;+.# &;-&&&#"),_("$;p.) &;+.# &;-0/*;p.) &;+.# &;-&"),_('2l""6l7m.e &2n""6n7o.Y &24""6475.M &26""6677.A &28""6879.5 &2@""6@7A.) &2B""6B7C'),_(";.# &;r"),_("%;/G#;'/>$;s/5$;'/,$;/#$+%)(%'#($'#(#'#(\"'#&'#"),_(";M.# &;t"),_("%;/E#28\"\"6879/6$;u.# &;x/'$8#:Ï# )(#'#(\"'#&'#"),_('%;v.# &;w/J#%26""6677/,#;/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),_('%2Ð""6Ð7Ñ/:#;/1$;w." &"/#$+#)(#\'#("\'#&\'#'),_('%24""6475/,#;{/#$+")("\'#&\'#'),_("%;z/3#$;y0#*;y&/#$+\")(\"'#&'#"),_(";*.) &;+.# &;-"),_(';+. &;-. &22""6273.} &26""6677.q &28""6879.e &2:""6:7;.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E'),_('%;|/e#$%24""6475/,#;|/#$+")("\'#&\'#0<*%24""6475/,#;|/#$+")("\'#&\'#&/#$+")("\'#&\'#'),_('%$;~0#*;~&/e#$%22""6273/,#;}/#$+")("\'#&\'#0<*%22""6273/,#;}/#$+")("\'#&\'#&/#$+")("\'#&\'#'),_("$;~0#*;~&"),_(';+.w &;-.q &28""6879.e &2:""6:7;.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E'),_('%%;"/#$;".G &;!.A &2@""6@7A.5 &2F""6F7G.) &2J""6J7K0M*;".G &;!.A &2@""6@7A.5 &2F""6F7G.) &2J""6J7K&/#$+")("\'#&\'#/& 8!:Ò! )'),_(";.# &;"),_('%%;O/2#2:""6:7;/#$+")("\'#&\'#." &"/,#;S/#$+")("\'#&\'#." &"'),_('$;+. &;-.} &2B""6B7C.q &2D""6D7E.e &22""6273.Y &28""6879.M &2:""6:7;.A &2<""6<7=.5 &2>""6>7?.) &2@""6@7A/#0*;+. &;-.} &2B""6B7C.q &2D""6D7E.e &22""6273.Y &28""6879.M &2:""6:7;.A &2<""6<7=.5 &2>""6>7?.) &2@""6@7A&&&#'),_("$;y0#*;y&"),_('%3""5#7Ó/q#24""6475/b$$;!/&#0#*;!&&&#/L$2J""6J7K/=$$;!/&#0#*;!&&&#/\'$8%:Ô% )(%\'#($\'#(#\'#("\'#&\'#'),_('2Õ""6Õ7Ö'),_('2×""6×7Ø'),_('2Ù""6Ù7Ú'),_('2Û""6Û7Ü'),_('2Ý""6Ý7Þ'),_('2ß""6ß7à'),_('2á""6á7â'),_('2ã""6ã7ä'),_('2å""6å7æ'),_('2ç""6ç7è'),_('2é""6é7ê'),_("%;.Y &;.S &;.M &;.G &;.A &;.; &;.5 &;./ &;.) &;.# &;6/& 8!:ë! )"),_("%;/G#;'/>$;/5$;'/,$;/#$+%)(%'#($'#(#'#(\"'#&'#"),_("%;/' 8!:ì!! )"),_("%;!/5#;!/,$;!/#$+#)(#'#(\"'#&'#"),_("%$;*.A &;+.; &;-.5 &;3./ &;4.) &;'.# &;(0G*;*.A &;+.; &;-.5 &;3./ &;4.) &;'.# &;(&/& 8!:í! )"),_("%;¶/Y#$%;A/,#;¶/#$+\")(\"'#&'#06*%;A/,#;¶/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),_('%;9/N#%2:""6:7;/,#;9/#$+")("\'#&\'#." &"/\'$8":î" )("\'#&\'#'),_("%;:.c &%;/Y#$%;A/,#;/#$+\")(\"'#&'#06*%;A/,#;/#$+\")(\"'#&'#&/#$+\")(\"'#&'#/& 8!:ï! )"),_("%;L.# &;/]#$%;B/,#;/#$+\")(\"'#&'#06*%;B/,#;/#$+\")(\"'#&'#&/'$8\":ð\" )(\"'#&'#"),_("%;.\" &\"/>#;@/5$;M/,$;?/#$+$)($'#(#'#(\"'#&'#"),_("%%;6/Y#$%;./,#;6/#$+\")(\"'#&'#06*%;./,#;6/#$+\")(\"'#&'#&/#$+\")(\"'#&'#.# &;H/' 8!:ñ!! )"),_(";.) &;.# &; "),_("%3ò\"\"5!7ó/:#;</1$;/($8#:ô#! )(#'#(\"'#&'#"),_("%3õ\"\"5'7ö/:#;</1$;/($8#:÷#! )(#'#(\"'#&'#"),_("%$;!/&#0#*;!&&&#/' 8!:ø!! )"),_('%2ù""6ù7ú/o#%2J""6J7K/M#;!." &"/?$;!." &"/1$;!." &"/#$+$)($\'#(#\'#("\'#&\'#." &"/\'$8":û" )("\'#&\'#'),_('%;6/J#%;</,#;¡/#$+")("\'#&\'#." &"/)$8":ü""! )("\'#&\'#'),_(";6.) &;T.# &;H"),_("%;£/Y#$%;B/,#;¤/#$+\")(\"'#&'#06*%;B/,#;¤/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),_('%3ý""5&7þ.G &3ÿ""5\'7Ā.; &3ā""5$7Ă./ &3ă""5%7Ą.# &;6/& 8!:ą! )'),_(";¥.# &; "),_('%3Ć""5(7ć/M#;</D$3Ĉ""5(7ĉ./ &3Ċ""5(7ċ.# &;6/#$+#)(#\'#("\'#&\'#'),_("%;6/Y#$%;A/,#;6/#$+\")(\"'#&'#06*%;A/,#;6/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),_("%$;!/&#0#*;!&&&#/' 8!:Č!! )"),_("%;©/& 8!:č! )"),_("%;ª/k#;;/b$;¯/Y$$%;B/,#;°/#$+\")(\"'#&'#06*%;B/,#;°/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#"),_(";«.# &;¬"),_('3Ď""5$7ď.S &3Đ""5%7đ.G &3Ē""5%7ē.; &3Ĕ""5%7ĕ./ &3Ė""5+7ė.# &;­'),_('3Ę""5\'7ę./ &3Ě""5)7ě.# &;­'),_(";6.# &;®"),_('%3Ĝ""5"7ĝ/,#;6/#$+")("\'#&\'#'),_(";­.# &;6"),_("%;6/5#;</,$;±/#$+#)(#'#(\"'#&'#"),_(";6.# &;H"),_("%;³/5#;./,$;/#$+#)(#'#(\"'#&'#"),_("%$;!/&#0#*;!&&&#/' 8!:Ğ!! )"),_("%;/' 8!:ğ!! )"),_('%;¶/^#$%;B/,#; /#$+")("\'#&\'#06*%;B/,#; /#$+")("\'#&\'#&/($8":Ġ"!!)("\'#&\'#'),_('%%;7/e#$%2J""6J7K/,#;7/#$+")("\'#&\'#0<*%2J""6J7K/,#;7/#$+")("\'#&\'#&/#$+")("\'#&\'#/"!&,)'),_("%;L.# &;/]#$%;B/,#;¸/#$+\")(\"'#&'#06*%;B/,#;¸/#$+\")(\"'#&'#&/'$8\":ġ\" )(\"'#&'#"),_(";¹.# &; "),_("%3Ģ\"\"5#7ģ/:#;</1$;6/($8#:Ĥ#! )(#'#(\"'#&'#"),_("%$;!/&#0#*;!&&&#/' 8!:ĥ!! )"),_("%;/' 8!:Ħ!! )"),_("%$;0#*;&/x#;@/o$;M/f$;?/]$$%;B/,#; /#$+\")(\"'#&'#06*%;B/,#; /#$+\")(\"'#&'#&/'$8%:ħ% )(%'#($'#(#'#(\"'#&'#"),_(";¾"),_("%3Ĩ\"\"5&7ĩ/k#;./b$;Á/Y$$%;A/,#;Á/#$+\")(\"'#&'#06*%;A/,#;Á/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#.# &;¿"),_("%;6/k#;./b$;À/Y$$%;A/,#;À/#$+\")(\"'#&'#06*%;A/,#;À/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#"),_("%;6/;#;</2$;6.# &;H/#$+#)(#'#(\"'#&'#"),_(";Â.G &;Ä.A &;Æ.; &;È.5 &;É./ &;Ê.) &;Ë.# &;À"),_("%3Ī\"\"5%7ī/5#;</,$;Ã/#$+#)(#'#(\"'#&'#"),_("%;I/' 8!:Ĭ!! )"),_("%3ĭ\"\"5&7Į/#;</$;D/$;Å/|$$%$;'/&#0#*;'&&&#/,#;Å/#$+\")(\"'#&'#0C*%$;'/&#0#*;'&&&#/,#;Å/#$+\")(\"'#&'#&/,$;E/#$+&)(&'#(%'#($'#(#'#(\"'#&'#"),_(";t.# &;w"),_("%3į\"\"5%7İ/5#;</,$;Ç/#$+#)(#'#(\"'#&'#"),_("%;I/' 8!:ı!! )"),_("%3Ĳ\"\"5&7ĳ/:#;</1$;I/($8#:Ĵ#! )(#'#(\"'#&'#"),_('%3ĵ""5%7Ķ/]#;</T$%3ķ""5$7ĸ/& 8!:Ĺ! ).4 &%3ĺ""5%7Ļ/& 8!:ļ! )/#$+#)(#\'#("\'#&\'#'),_('%3Ľ""5)7ľ/R#;</I$3Ŀ""5#7ŀ./ &3Ł""5(7ł.# &;6/($8#:Ń#! )(#\'#("\'#&\'#'),_('%3ń""5#7Ņ/#;</$;D/$%;Ì/e#$%2D""6D7E/,#;Ì/#$+")("\'#&\'#0<*%2D""6D7E/,#;Ì/#$+")("\'#&\'#&/#$+")("\'#&\'#/,$;E/#$+%)(%\'#($\'#(#\'#("\'#&\'#'),_('%3ņ""5(7Ň./ &3ň""5$7ŉ.# &;6/\' 8!:Ŋ!! )'),_("%;6/Y#$%;A/,#;6/#$+\")(\"'#&'#06*%;A/,#;6/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),_("%;Ï/G#;./>$;Ï/5$;./,$;/#$+%)(%'#($'#(#'#(\"'#&'#"),_("%$;!/&#0#*;!&&&#/' 8!:ŋ!! )"),_("%;Ñ/]#$%;A/,#;Ñ/#$+\")(\"'#&'#06*%;A/,#;Ñ/#$+\")(\"'#&'#&/'$8\":Ō\" )(\"'#&'#"),_("%;/]#$%;B/,#; /#$+\")(\"'#&'#06*%;B/,#; /#$+\")(\"'#&'#&/'$8\":ō\" )(\"'#&'#"),_('%;L.O &;.I &%;@." &"/:#;t/1$;?." &"/#$+#)(#\'#("\'#&\'#/]#$%;B/,#; /#$+")("\'#&\'#06*%;B/,#; /#$+")("\'#&\'#&/\'$8":Ŏ" )("\'#&\'#'),_("%;Ô/]#$%;B/,#;Õ/#$+\")(\"'#&'#06*%;B/,#;Õ/#$+\")(\"'#&'#&/'$8\":ŏ\" )(\"'#&'#"),_("%;/& 8!:Ő! )"),_('%3ő""5(7Œ/:#;</1$;6/($8#:œ#! )(#\'#("\'#&\'#.g &%3Ŕ""5&7ŕ/:#;</1$;6/($8#:Ŗ#! )(#\'#("\'#&\'#.: &%3ŗ""5*7Ř/& 8!:ř! ).# &; '),_('%%;6/k#$%;A/2#;6/)$8":Ś""$ )("\'#&\'#0<*%;A/2#;6/)$8":Ś""$ )("\'#&\'#&/)$8":ś""! )("\'#&\'#." &"/\' 8!:Ŝ!! )'),_("%;Ø/Y#$%;A/,#;Ø/#$+\")(\"'#&'#06*%;A/,#;Ø/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),_("%;/Y#$%;B/,#; /#$+\")(\"'#&'#06*%;B/,#; /#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),_("%$;!/&#0#*;!&&&#/' 8!:ŝ!! )"),_("%;Û/Y#$%;B/,#;Ü/#$+\")(\"'#&'#06*%;B/,#;Ü/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),_('%3Ş""5&7ş.; &3Š""5\'7š./ &3Ţ""5*7ţ.# &;6/& 8!:Ť! )'),_("%3ť\"\"5&7Ŧ/:#;</1$;Ý/($8#:ŧ#! )(#'#(\"'#&'#.} &%3õ\"\"5'7ö/:#;</1$;/($8#:Ũ#! )(#'#(\"'#&'#.P &%3ũ\"\"5+7Ū/:#;</1$;/($8#:ū#! )(#'#(\"'#&'#.# &; "),_('3Ŭ""5+7ŭ.k &3Ů""5)7ů._ &3Ű""5(7ű.S &3Ų""5\'7ų.G &3Ŵ""5&7ŵ.; &3Ŷ""5*7ŷ./ &3Ÿ""5)7Ź.# &;6'),_(';1." &"'),_('%%;6/k#$%;A/2#;6/)$8":Ś""$ )("\'#&\'#0<*%;A/2#;6/)$8":Ś""$ )("\'#&\'#&/)$8":ś""! )("\'#&\'#." &"/\' 8!:ź!! )'),_("%;L.# &;/]#$%;B/,#;á/#$+\")(\"'#&'#06*%;B/,#;á/#$+\")(\"'#&'#&/'$8\":Ż\" )(\"'#&'#"),_(";¹.# &; "),_("%;ã/Y#$%;A/,#;ã/#$+\")(\"'#&'#06*%;A/,#;ã/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),_("%;ê/k#;./b$;í/Y$$%;B/,#;ä/#$+\")(\"'#&'#06*%;B/,#;ä/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#"),_(";å.; &;æ.5 &;ç./ &;è.) &;é.# &; "),_("%3ż\"\"5#7Ž/:#;</1$;ð/($8#:ž#! )(#'#(\"'#&'#"),_("%3ſ\"\"5%7ƀ/:#;</1$;T/($8#:Ɓ#! )(#'#(\"'#&'#"),_("%3Ƃ\"\"5(7ƃ/F#;</=$;\\.) &;Y.# &;X/($8#:Ƅ#! )(#'#(\"'#&'#"),_("%3ƅ\"\"5&7Ɔ/:#;</1$;6/($8#:Ƈ#! )(#'#(\"'#&'#"),_('%3ƈ""5%7Ɖ/O#%;</3#$;!0#*;!&/#$+")("\'#&\'#." &"/\'$8":Ɗ" )("\'#&\'#'),_("%;ë/G#;;/>$;6/5$;;/,$;ì/#$+%)(%'#($'#(#'#(\"'#&'#"),_('%3""5#7Ó.# &;6/\' 8!:Ƌ!! )'),_('%3±""5#7ƌ.G &3³""5#7ƍ.; &3·""5#7Ǝ./ &3µ""5$7Ə.# &;6/\' 8!:Ɛ!! )'),_('%;î/D#%;C/,#;ï/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),_("%;U.) &;\\.# &;X/& 8!:Ƒ! )"),_('%%;!." &"/[#;!." &"/M$;!." &"/?$;!." &"/1$;!." &"/#$+%)(%\'#($\'#(#\'#("\'#&\'#/\' 8!:ƒ!! )'),_('%%;!/?#;!." &"/1$;!." &"/#$+#)(#\'#("\'#&\'#/\' 8!:Ɠ!! )'),_(";¾"),_('%;/^#$%;B/,#;ó/#$+")("\'#&\'#06*%;B/,#;ó/#$+")("\'#&\'#&/($8":Ɣ"!!)("\'#&\'#'),_(";ô.# &; "),_('%2ƕ""6ƕ7Ɩ/L#;</C$2Ɨ""6Ɨ7Ƙ.) &2ƙ""6ƙ7ƚ/($8#:ƛ#! )(#\'#("\'#&\'#'),_('%;/^#$%;B/,#; /#$+")("\'#&\'#06*%;B/,#; /#$+")("\'#&\'#&/($8":Ɯ"!!)("\'#&\'#'),_("%;6/5#;0/,$;÷/#$+#)(#'#(\"'#&'#"),_("$;2.) &;4.# &;.0/*;2.) &;4.# &;.&"),_("$;%0#*;%&"),_("%;ú/;#28\"\"6879/,$;û/#$+#)(#'#(\"'#&'#"),_('%3Ɲ""5%7ƞ.) &3Ɵ""5$7Ơ/\' 8!:ơ!! )'),_('%;ü/J#%28""6879/,#;^/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),_("%;\\.) &;X.# &;/' 8!:Ƣ!! )"),_(';".S &;!.M &2F""6F7G.A &2J""6J7K.5 &2H""6H7I.) &2N""6N7O'),_('2L""6L7M. &2B""6B7C. &2<""6<7=.} &2R""6R7S.q &2T""6T7U.e &2V""6V7W.Y &2P""6P7Q.M &2@""6@7A.A &2D""6D7E.5 &22""6273.) &2>""6>7?'),_('%;Ā/b#28""6879/S$;û/J$%2ƣ""6ƣ7Ƥ/,#;ì/#$+")("\'#&\'#." &"/#$+$)($\'#(#\'#("\'#&\'#'),_('%3ƥ""5%7Ʀ.) &3Ƨ""5$7ƨ/\' 8!:ơ!! )'),_('%;ì/O#3±""5#7².6 &3³""5#7´.* &$;+0#*;+&/\'$8":Ʃ" )("\'#&\'#'),_("%;Ą/#2F\"\"6F7G/x$;ă/o$2F\"\"6F7G/`$;ă/W$2F\"\"6F7G/H$;ă/?$2F\"\"6F7G/0$;ą/'$8):ƪ) )()'#(('#(''#(&'#(%'#($'#(#'#(\"'#&'#"),_("%;#/>#;#/5$;#/,$;#/#$+$)($'#(#'#(\"'#&'#"),_("%;ă/,#;ă/#$+\")(\"'#&'#"),_("%;ă/5#;ă/,$;ă/#$+#)(#'#(\"'#&'#"),_("%;/U#;'/L$;/C$;'/:$;/1$; .\" &\"/#$+&)(&'#(%'#($'#(#'#(\"'#&'#"),_('%2ƫ""6ƫ7Ƭ.) &2ƭ""6ƭ7Ʈ/w#;0/n$;Ĉ/e$$%;B/2#;ĉ.# &; /#$+")("\'#&\'#0<*%;B/2#;ĉ.# &; /#$+")("\'#&\'#&/#$+$)($\'#(#\'#("\'#&\'#'),_(";.# &;L"),_("%2Ư\"\"6Ư7ư/5#;</,$;Ċ/#$+#)(#'#(\"'#&'#"),_("%;D/S#;,/J$2:\"\"6:7;/;$;,.# &;T/,$;E/#$+%)(%'#($'#(#'#(\"'#&'#")],l=0,c=0,d=[{line:1,column:1}],h=0,p=[],f=0;if("startRule"in t){if(!(t.startRule in s))throw new Error("Can't start parsing from rule \""+t.startRule+'".');o=s[t.startRule]}function m(){return e.substring(c,l)}function g(){return E(c,l)}function T(e,t){return{type:"literal",text:e,ignoreCase:t}}function v(e,t,n){return{type:"class",parts:e,inverted:t,ignoreCase:n}}function y(t){var n,i=d[t];if(i)return i;for(n=t-1;!d[n];)n--;for(i={line:(i=d[n]).line,column:i.column};n<t;)10===e.charCodeAt(n)?(i.line++,i.column=1):i.column++,n++;return d[t]=i,i}function E(e,t){var n=y(e),i=y(t);return{start:{offset:e,line:n.line,column:n.column},end:{offset:t,line:i.line,column:i.column}}}function b(e){l<h||(l>h&&(h=l,p=[]),p.push(e))}function S(e,t,n){return new i(i.buildMessage(e,t),e,t,n)}function _(e){var t,n=new Array(e.length);for(t=0;t<e.length;t++)n[t]=e.charCodeAt(t)-32;return n}if(t.data={},(n=function t(n){for(var i,s,o=u[n],d=0,h=[],p=o.length,m=[],g=[];;){for(;d<p;)switch(o[d]){case 0:g.push(a[o[d+1]]),d+=2;break;case 1:g.push(void 0),d++;break;case 2:g.push(null),d++;break;case 3:g.push(r),d++;break;case 4:g.push([]),d++;break;case 5:g.push(l),d++;break;case 6:g.pop(),d++;break;case 7:l=g.pop(),d++;break;case 8:g.length-=o[d+1],d+=2;break;case 9:g.splice(-2,1),d++;break;case 10:g[g.length-2].push(g.pop()),d++;break;case 11:g.push(g.splice(g.length-o[d+1],o[d+1])),d+=2;break;case 12:g.push(e.substring(g.pop(),l)),d++;break;case 13:m.push(p),h.push(d+3+o[d+1]+o[d+2]),g[g.length-1]?(p=d+3+o[d+1],d+=3):(p=d+3+o[d+1]+o[d+2],d+=3+o[d+1]);break;case 14:m.push(p),h.push(d+3+o[d+1]+o[d+2]),g[g.length-1]===r?(p=d+3+o[d+1],d+=3):(p=d+3+o[d+1]+o[d+2],d+=3+o[d+1]);break;case 15:m.push(p),h.push(d+3+o[d+1]+o[d+2]),g[g.length-1]!==r?(p=d+3+o[d+1],d+=3):(p=d+3+o[d+1]+o[d+2],d+=3+o[d+1]);break;case 16:g[g.length-1]!==r?(m.push(p),h.push(d),p=d+2+o[d+1],d+=2):d+=2+o[d+1];break;case 17:m.push(p),h.push(d+3+o[d+1]+o[d+2]),e.length>l?(p=d+3+o[d+1],d+=3):(p=d+3+o[d+1]+o[d+2],d+=3+o[d+1]);break;case 18:m.push(p),h.push(d+4+o[d+2]+o[d+3]),e.substr(l,a[o[d+1]].length)===a[o[d+1]]?(p=d+4+o[d+2],d+=4):(p=d+4+o[d+2]+o[d+3],d+=4+o[d+2]);break;case 19:m.push(p),h.push(d+4+o[d+2]+o[d+3]),e.substr(l,a[o[d+1]].length).toLowerCase()===a[o[d+1]]?(p=d+4+o[d+2],d+=4):(p=d+4+o[d+2]+o[d+3],d+=4+o[d+2]);break;case 20:m.push(p),h.push(d+4+o[d+2]+o[d+3]),a[o[d+1]].test(e.charAt(l))?(p=d+4+o[d+2],d+=4):(p=d+4+o[d+2]+o[d+3],d+=4+o[d+2]);break;case 21:g.push(e.substr(l,o[d+1])),l+=o[d+1],d+=2;break;case 22:g.push(a[o[d+1]]),l+=a[o[d+1]].length,d+=2;break;case 23:g.push(r),0===f&&b(a[o[d+1]]),d+=2;break;case 24:c=g[g.length-1-o[d+1]],d+=2;break;case 25:c=l,d++;break;case 26:for(i=o.slice(d+4,d+4+o[d+3]),s=0;s<o[d+3];s++)i[s]=g[g.length-1-i[s]];g.splice(g.length-o[d+2],o[d+2],a[o[d+1]].apply(null,i)),d+=4+o[d+3];break;case 27:g.push(t(o[d+1])),d+=2;break;case 28:f++,d++;break;case 29:f--,d++;break;default:throw new Error("Invalid opcode: "+o[d]+".")}if(!(m.length>0))break;p=m.pop(),d=h.pop()}return g[0]}(o))!==r&&l===e.length)return n;throw n!==r&&l<e.length&&b({type:"end"}),S(p,h<e.length?e.charAt(h):null,h<e.length?E(h,h+1):E(h,h))}}},function(e,t,n){"use strict";e.exports=function(e){function t(e,t){var n,i,r=[],s=e.split(/\r\n/);for(n=0;n<s.length;){var o=s[n];if(/^m=(?:audio|video)/.test(o))i={index:n,stripped:[]},r.push(i);else if(i){var a=/^a=rtpmap:(\d+) ([^/]+)\//.exec(o);if(a&&t===a[2]){s.splice(n,1),i.stripped.push(a[1]);continue}}n++}for(n=0;n<r.length;n++){for(var u=s[r[n].index].split(" "),l=3;l<u.length;)-1===r[n].stripped.indexOf(u[l])?l++:u.splice(l,1);s[r[n].index]=u.join(" ")}return s.join("\r\n")}return{stripTcpCandidates:function(t){return t.sdp=t.sdp.replace(/^a=candidate:\d+ \d+ tcp .*?\r\n/gim,""),e.Utils.Promise.resolve(t)},stripTelephoneEvent:function(n){return n.sdp=t(n.sdp,"telephone-event"),e.Utils.Promise.resolve(n)},cleanJitsiSdpImageattr:function(t){return t.sdp=t.sdp.replace(/^(a=imageattr:.*?)(x|y)=\[0-/gm,"$1$2=[1:"),e.Utils.Promise.resolve(t)},stripG722:function(n){return n.sdp=t(n.sdp,"G722"),e.Utils.Promise.resolve(n)},stripRtpPayload:function(n){return function(i){return i.sdp=t(i.sdp,n),e.Utils.Promise.resolve(i)}},stripVideo:function(t){return t.sdp=function(e,t){var n=new RegExp("m="+t+".*$","gm"),i=new RegExp("^a=group:.*$","gm");if(n.test(e)){var r,s=(e=e.split(/^m=/gm).filter(function(e){return e.substr(0,t.length)!==t||((r=e.match(/^a=mid:.*$/gm))&&(r=r[0].match(/:.+$/g)[0].substr(1)),!1)}).join("m=")).match(i);if(s&&1===s.length){s=s[0];var o=new RegExp(" *"+r+"[^ ]*","g");s=s.replace(o,""),e=e.split(i).join(s)}}return e}(t.sdp,"video"),e.Utils.Promise.resolve(t)},addMidLines:function(t){var n=t.sdp;if(-1===n.search(/^a=mid.*$/gm)){var i=n.match(/^m=.*$/gm);n=n.split(/^m=.*$/gm),i.forEach(function(e,t){i[t]=e+"\na=mid:"+t}),n.forEach(function(e,t){i[t]&&(n[t]=e+i[t])}),n=n.join(""),t.sdp=n}return e.Utils.Promise.resolve(t)}}}},function(e,t,n){"use strict";(function(t){e.exports=function(e){var n={STATUS_NULL:0,STATUS_NEW:1,STATUS_CONNECTING:2,STATUS_CONNECTED:3,STATUS_COMPLETED:4},i=function(i){if(i.media.remote.video?this.video=!0:this.video=!1,i.media.remote.audio?this.audio=!0:this.audio=!1,!this.audio&&!this.video)throw new Error("At least one remote audio or video element is required for Simple.");this.options=i;var r=t.navigator.userAgent.toLowerCase(),s=!1,o=!1;r.indexOf("safari")>-1&&r.indexOf("chrome")<0?s=!0:r.indexOf("firefox")>-1&&r.indexOf("chrome")<0&&(o=!0);var a={};return s&&(a.modifiers=[e.Web.Modifiers.stripG722]),o&&(a.alwaysAcquireMediaFirst=!0),this.options.ua.uri||(this.anonymous=!0),this.ua=new e.UA({uri:this.options.ua.uri,authorizationUser:this.options.ua.authorizationUser,password:this.options.ua.password,displayName:this.options.ua.displayName,userAgentString:this.options.ua.userAgentString,register:!0,sessionDescriptionHandlerFactoryOptions:a,transportOptions:{traceSip:this.options.ua.traceSip,wsServers:this.options.ua.wsServers}}),this.state=n.STATUS_NULL,this.logger=this.ua.getLogger("sip.simple"),this.ua.on("registered",function(){this.emit("registered",this.ua)}.bind(this)),this.ua.on("unregistered",function(){this.emit("unregistered",this.ua)}.bind(this)),this.ua.on("failed",function(){this.emit("unregistered",this.ua)}.bind(this)),this.ua.on("invite",function(e){if(this.state!==n.STATUS_NULL&&this.state!==n.STATUS_COMPLETED)return this.logger.warn("Rejecting incoming call. Simple only supports 1 call at a time"),void e.reject();this.session=e,this.setupSession(),this.emit("ringing",this.session)}.bind(this)),this.ua.on("message",function(e){this.emit("message",e)}.bind(this)),this};return i.prototype=Object.create(e.EventEmitter.prototype),i.C=n,i.prototype.call=function(e){if(this.ua&&this.checkRegistration()){if(this.state===n.STATUS_NULL||this.state===n.STATUS_COMPLETED)return this.options.media.remote.audio&&(this.options.media.remote.audio.autoplay=!0),this.options.media.remote.video&&(this.options.media.remote.video.autoplay=!0),this.options.media.local&&this.options.media.local.video&&(this.options.media.local.video.autoplay=!0,this.options.media.local.video.volume=0),this.session=this.ua.invite(e,{sessionDescriptionHandlerOptions:{constraints:{audio:this.audio,video:this.video}}}),this.setupSession(),this.session;this.logger.warn("Cannot make more than a single call with Simple")}else this.logger.warn("A registered UA is required for calling")},i.prototype.answer=function(){if(this.state===n.STATUS_NEW||this.state===n.STATUS_CONNECTING)return this.options.media.remote.audio&&(this.options.media.remote.audio.autoplay=!0),this.options.media.remote.video&&(this.options.media.remote.video.autoplay=!0),this.session.accept({sessionDescriptionHandlerOptions:{constraints:{audio:this.audio,video:this.video}}});this.logger.warn("No call to answer")},i.prototype.reject=function(){if(this.state===n.STATUS_NEW||this.state===n.STATUS_CONNECTING)return this.session.reject();this.logger.warn("Call is already answered")},i.prototype.hangup=function(){if(this.state===n.STATUS_CONNECTED||this.state===n.STATUS_CONNECTING||this.state===n.STATUS_NEW)return this.state!==n.STATUS_CONNECTED?this.session.cancel():this.session.bye();this.logger.warn("No active call to hang up on")},i.prototype.hold=function(){if(this.state===n.STATUS_CONNECTED&&!this.session.local_hold)return this.mute(),this.logger.log("Placing session on hold"),this.session.hold();this.logger.warn("Cannot put call on hold")},i.prototype.unhold=function(){if(this.state===n.STATUS_CONNECTED&&this.session.local_hold)return this.unmute(),this.logger.log("Placing call off hold"),this.session.unhold();this.logger.warn("Cannot unhold a call that is not on hold")},i.prototype.mute=function(){this.state===n.STATUS_CONNECTED?(this.logger.log("Muting Audio"),this.toggleMute(!0),this.emit("mute",this)):this.logger.warn("An acitve call is required to mute audio")},i.prototype.unmute=function(){this.state===n.STATUS_CONNECTED?(this.logger.log("Unmuting Audio"),this.toggleMute(!1),this.emit("unmute",this)):this.logger.warn("An active call is required to unmute audio")},i.prototype.sendDTMF=function(e){this.state===n.STATUS_CONNECTED?(this.logger.log("Sending DTMF tone: "+e),this.session.dtmf(e)):this.logger.warn("An active call is required to send a DTMF tone")},i.prototype.message=function(e,t){this.ua&&this.checkRegistration()?e&&t?this.ua.message(e,t):this.logger.warn("A destination and message are required to send a message"):this.logger.warn("A registered UA is required to send a message")},i.prototype.checkRegistration=function(){return this.anonymous||this.ua&&this.ua.isRegistered()},i.prototype.setupRemoteMedia=function(){var e,n=this.session.sessionDescriptionHandler.peerConnection;n.getReceivers?(e=new t.window.MediaStream,n.getReceivers().forEach(function(t){var n=t.track;n&&e.addTrack(n)})):e=n.getRemoteStreams()[0],this.video?(this.options.media.remote.video.srcObject=e,this.options.media.remote.video.play().catch(function(){this.logger.log("play was rejected")}.bind(this))):this.audio&&(this.options.media.remote.audio.srcObject=e,this.options.media.remote.audio.play().catch(function(){this.logger.log("play was rejected")}.bind(this)))},i.prototype.setupLocalMedia=function(){if(this.video&&this.options.media.local&&this.options.media.local.video){var e,n=this.session.sessionDescriptionHandler.peerConnection;n.getSenders?(e=new t.window.MediaStream,n.getSenders().forEach(function(t){var n=t.track;n&&"video"===n.kind&&e.addTrack(n)})):e=n.getLocalStreams()[0],this.options.media.local.video.srcObject=e,this.options.media.local.video.volume=0,this.options.media.local.video.play()}},i.prototype.cleanupMedia=function(){this.video&&(this.options.media.remote.video.srcObject=null,this.options.media.remote.video.pause(),this.options.media.local&&this.options.media.local.video&&(this.options.media.local.video.srcObject=null,this.options.media.local.video.pause())),this.audio&&(this.options.media.remote.audio.srcObject=null,this.options.media.remote.audio.pause())},i.prototype.setupSession=function(){this.state=n.STATUS_NEW,this.emit("new",this.session),this.session.on("progress",this.onProgress.bind(this)),this.session.on("accepted",this.onAccepted.bind(this)),this.session.on("rejected",this.onEnded.bind(this)),this.session.on("failed",this.onFailed.bind(this)),this.session.on("terminated",this.onEnded.bind(this))},i.prototype.destroyMedia=function(){this.session.sessionDescriptionHandler.close()},i.prototype.toggleMute=function(e){var t=this.session.sessionDescriptionHandler.peerConnection;t.getSenders?t.getSenders().forEach(function(t){t.track&&(t.track.enabled=!e)}):t.getLocalStreams().forEach(function(t){t.getAudioTracks().forEach(function(t){t.enabled=!e}),t.getVideoTracks().forEach(function(t){t.enabled=!e})})},i.prototype.onAccepted=function(){this.state=n.STATUS_CONNECTED,this.emit("connected",this.session),this.setupLocalMedia(),this.setupRemoteMedia(),this.session.sessionDescriptionHandler.on("addTrack",function(){this.logger.log("A track has been added, triggering new remoteMedia setup"),this.setupRemoteMedia()}.bind(this)),this.session.sessionDescriptionHandler.on("addStream",function(){this.logger.log("A stream has been added, trigger new remoteMedia setup"),this.setupRemoteMedia()}.bind(this)),this.session.on("hold",function(){this.emit("hold",this.session)}.bind(this)),this.session.on("unhold",function(){this.emit("unhold",this.session)}.bind(this)),this.session.on("dtmf",function(e){this.emit("dtmf",e)}.bind(this)),this.session.on("bye",this.onEnded.bind(this))},i.prototype.onProgress=function(){this.state=n.STATUS_CONNECTING,this.emit("connecting",this.session)},i.prototype.onFailed=function(){this.onEnded()},i.prototype.onEnded=function(){this.state=n.STATUS_COMPLETED,this.emit("ended",this.session),this.cleanupMedia()},i}}).call(this,n(28))},function(e,t,n){"use strict";(function(t){var i=t.window||t;function r(e,t){if(null!=e){var n=t.charAt(0).toUpperCase()+t.slice(1),i=[t,"webkit"+n,"moz"+n];for(var r in i){var s=e[i[r]];if(s)return s.bind(e)}}}e.exports={WebSocket:i.WebSocket,Transport:n(10),open:i.open,Promise:i.Promise,timers:i,console:i.console||{debug:function(){},log:function(){},warn:function(){},error:function(){}},addEventListener:r(i,"addEventListener"),removeEventListener:r(i,"removeEventListener")}}).call(this,n(28))}])})},function(e,t,n){"use strict";
/** @license React v16.6.0
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var i=n(2),r="function"==typeof Symbol&&Symbol.for,s=r?Symbol.for("react.element"):60103,o=r?Symbol.for("react.portal"):60106,a=r?Symbol.for("react.fragment"):60107,u=r?Symbol.for("react.strict_mode"):60108,l=r?Symbol.for("react.profiler"):60114,c=r?Symbol.for("react.provider"):60109,d=r?Symbol.for("react.context"):60110,h=r?Symbol.for("react.concurrent_mode"):60111,p=r?Symbol.for("react.forward_ref"):60112,f=r?Symbol.for("react.suspense"):60113,m=r?Symbol.for("react.memo"):60115,g=r?Symbol.for("react.lazy"):60116,T="function"==typeof Symbol&&Symbol.iterator;function v(e){for(var t=arguments.length-1,n="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=0;i<t;i++)n+="&args[]="+encodeURIComponent(arguments[i+1]);!function(e,t,n,i,r,s,o,a){if(!e){if(e=void 0,void 0===t)e=Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var u=[n,i,r,s,o,a],l=0;(e=Error(t.replace(/%s/g,function(){return u[l++]}))).name="Invariant Violation"}throw e.framesToPop=1,e}}(!1,"Minified React error #"+e+"; visit %s for the full message or use the non-minified dev environment for full errors and additional helpful warnings. ",n)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E={};function b(e,t,n){this.props=e,this.context=t,this.refs=E,this.updater=n||y}function S(){}function _(e,t,n){this.props=e,this.context=t,this.refs=E,this.updater=n||y}b.prototype.isReactComponent={},b.prototype.setState=function(e,t){"object"!=typeof e&&"function"!=typeof e&&null!=e&&v("85"),this.updater.enqueueSetState(this,e,t,"setState")},b.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},S.prototype=b.prototype;var C=_.prototype=new S;C.constructor=_,i(C,b.prototype),C.isPureReactComponent=!0;var w={current:null,currentDispatcher:null},R=Object.prototype.hasOwnProperty,A={key:!0,ref:!0,__self:!0,__source:!0};function I(e,t,n){var i=void 0,r={},o=null,a=null;if(null!=t)for(i in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(o=""+t.key),t)R.call(t,i)&&!A.hasOwnProperty(i)&&(r[i]=t[i]);var u=arguments.length-2;if(1===u)r.children=n;else if(1<u){for(var l=Array(u),c=0;c<u;c++)l[c]=arguments[c+2];r.children=l}if(e&&e.defaultProps)for(i in u=e.defaultProps)void 0===r[i]&&(r[i]=u[i]);return{$$typeof:s,type:e,key:o,ref:a,props:r,_owner:w.current}}function N(e){return"object"==typeof e&&null!==e&&e.$$typeof===s}var x=/\/+/g,D=[];function O(e,t,n,i){if(D.length){var r=D.pop();return r.result=e,r.keyPrefix=t,r.func=n,r.context=i,r.count=0,r}return{result:e,keyPrefix:t,func:n,context:i,count:0}}function k(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>D.length&&D.push(e)}function U(e,t,n){return null==e?0:function e(t,n,i,r){var a=typeof t;"undefined"!==a&&"boolean"!==a||(t=null);var u=!1;if(null===t)u=!0;else switch(a){case"string":case"number":u=!0;break;case"object":switch(t.$$typeof){case s:case o:u=!0}}if(u)return i(r,t,""===n?"."+P(t,0):n),1;if(u=0,n=""===n?".":n+":",Array.isArray(t))for(var l=0;l<t.length;l++){var c=n+P(a=t[l],l);u+=e(a,c,i,r)}else if(c=null===t||"object"!=typeof t?null:"function"==typeof(c=T&&t[T]||t["@@iterator"])?c:null,"function"==typeof c)for(t=c.call(t),l=0;!(a=t.next()).done;)u+=e(a=a.value,c=n+P(a,l++),i,r);else"object"===a&&v("31","[object Object]"==(i=""+t)?"object with keys {"+Object.keys(t).join(", ")+"}":i,"");return u}(e,"",t,n)}function P(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,function(e){return t[e]})}(e.key):t.toString(36)}function $(e,t){e.func.call(e.context,t,e.count++)}function H(e,t,n){var i=e.result,r=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?M(e,i,n,function(e){return e}):null!=e&&(N(e)&&(e=function(e,t){return{$$typeof:s,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(e,r+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(x,"$&/")+"/")+n)),i.push(e))}function M(e,t,n,i,r){var s="";null!=n&&(s=(""+n).replace(x,"$&/")+"/"),U(e,H,t=O(t,s,i,r)),k(t)}var q={Children:{map:function(e,t,n){if(null==e)return e;var i=[];return M(e,i,null,t,n),i},forEach:function(e,t,n){if(null==e)return e;U(e,$,t=O(null,null,t,n)),k(t)},count:function(e){return U(e,function(){return null},null)},toArray:function(e){var t=[];return M(e,t,null,function(e){return e}),t},only:function(e){return N(e)||v("143"),e}},createRef:function(){return{current:null}},Component:b,PureComponent:_,createContext:function(e,t){return void 0===t&&(t=null),(e={$$typeof:d,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,Provider:null,Consumer:null}).Provider={$$typeof:c,_context:e},e.Consumer=e},forwardRef:function(e){return{$$typeof:p,render:e}},lazy:function(e){return{$$typeof:g,_ctor:e,_status:-1,_result:null}},memo:function(e,t){return{$$typeof:m,type:e,compare:void 0===t?null:t}},Fragment:a,StrictMode:u,unstable_ConcurrentMode:h,Suspense:f,unstable_Profiler:l,createElement:I,cloneElement:function(e,t,n){(null===e||void 0===e)&&v("267",e);var r=void 0,o=i({},e.props),a=e.key,u=e.ref,l=e._owner;if(null!=t){void 0!==t.ref&&(u=t.ref,l=w.current),void 0!==t.key&&(a=""+t.key);var c=void 0;for(r in e.type&&e.type.defaultProps&&(c=e.type.defaultProps),t)R.call(t,r)&&!A.hasOwnProperty(r)&&(o[r]=void 0===t[r]&&void 0!==c?c[r]:t[r])}if(1===(r=arguments.length-2))o.children=n;else if(1<r){c=Array(r);for(var d=0;d<r;d++)c[d]=arguments[d+2];o.children=c}return{$$typeof:s,type:e.type,key:a,ref:u,props:o,_owner:l}},createFactory:function(e){var t=I.bind(null,e);return t.type=e,t},isValidElement:N,version:"16.6.0",__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{ReactCurrentOwner:w,assign:i}},L={default:q},F=L&&q||L;e.exports=F.default||F},function(e,t,n){"use strict";
/** @license React v16.6.0
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var i=n(0),r=n(2),s=n(6);function o(e){for(var t=arguments.length-1,n="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=0;i<t;i++)n+="&args[]="+encodeURIComponent(arguments[i+1]);!function(e,t,n,i,r,s,o,a){if(!e){if(e=void 0,void 0===t)e=Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var u=[n,i,r,s,o,a],l=0;(e=Error(t.replace(/%s/g,function(){return u[l++]}))).name="Invariant Violation"}throw e.framesToPop=1,e}}(!1,"Minified React error #"+e+"; visit %s for the full message or use the non-minified dev environment for full errors and additional helpful warnings. ",n)}i||o("227");var a=!1,u=null,l=!1,c=null,d={onError:function(e){a=!0,u=e}};function h(e,t,n,i,r,s,o,l,c){a=!1,u=null,function(e,t,n,i,r,s,o,a,u){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(e){this.onError(e)}}.apply(d,arguments)}var p=null,f={};function m(){if(p)for(var e in f){var t=f[e],n=p.indexOf(e);if(-1<n||o("96",e),!T[n])for(var i in t.extractEvents||o("97",e),T[n]=t,n=t.eventTypes){var r=void 0,s=n[i],a=t,u=i;v.hasOwnProperty(u)&&o("99",u),v[u]=s;var l=s.phasedRegistrationNames;if(l){for(r in l)l.hasOwnProperty(r)&&g(l[r],a,u);r=!0}else s.registrationName?(g(s.registrationName,a,u),r=!0):r=!1;r||o("98",i,e)}}}function g(e,t,n){y[e]&&o("100",e),y[e]=t,E[e]=t.eventTypes[n].dependencies}var T=[],v={},y={},E={},b=null,S=null,_=null;function C(e,t,n,i){t=e.type||"unknown-event",e.currentTarget=_(i),function(e,t,n,i,r,s,d,p,f){if(h.apply(this,arguments),a){if(a){var m=u;a=!1,u=null}else o("198"),m=void 0;l||(l=!0,c=m)}}(t,n,void 0,e),e.currentTarget=null}function w(e,t){return null==t&&o("30"),null==e?t:Array.isArray(e)?Array.isArray(t)?(e.push.apply(e,t),e):(e.push(t),e):Array.isArray(t)?[e].concat(t):[e,t]}function R(e,t,n){Array.isArray(e)?e.forEach(t,n):e&&t.call(n,e)}var A=null;function I(e,t){if(e){var n=e._dispatchListeners,i=e._dispatchInstances;if(Array.isArray(n))for(var r=0;r<n.length&&!e.isPropagationStopped();r++)C(e,t,n[r],i[r]);else n&&C(e,t,n,i);e._dispatchListeners=null,e._dispatchInstances=null,e.isPersistent()||e.constructor.release(e)}}function N(e){return I(e,!0)}function x(e){return I(e,!1)}var D={injectEventPluginOrder:function(e){p&&o("101"),p=Array.prototype.slice.call(e),m()},injectEventPluginsByName:function(e){var t,n=!1;for(t in e)if(e.hasOwnProperty(t)){var i=e[t];f.hasOwnProperty(t)&&f[t]===i||(f[t]&&o("102",t),f[t]=i,n=!0)}n&&m()}};function O(e,t){var n=e.stateNode;if(!n)return null;var i=b(n);if(!i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}return e?null:(n&&"function"!=typeof n&&o("231",t,typeof n),n)}function k(e,t){if(null!==e&&(A=w(A,e)),e=A,A=null,e&&(R(e,t?N:x),A&&o("95"),l))throw t=c,l=!1,c=null,t}var U=Math.random().toString(36).slice(2),P="__reactInternalInstance$"+U,$="__reactEventHandlers$"+U;function H(e){if(e[P])return e[P];for(;!e[P];){if(!e.parentNode)return null;e=e.parentNode}return 5===(e=e[P]).tag||6===e.tag?e:null}function M(e){return!(e=e[P])||5!==e.tag&&6!==e.tag?null:e}function q(e){if(5===e.tag||6===e.tag)return e.stateNode;o("33")}function L(e){return e[$]||null}function F(e){do{e=e.return}while(e&&5!==e.tag);return e||null}function j(e,t,n){(t=O(e,n.dispatchConfig.phasedRegistrationNames[t]))&&(n._dispatchListeners=w(n._dispatchListeners,t),n._dispatchInstances=w(n._dispatchInstances,e))}function B(e){if(e&&e.dispatchConfig.phasedRegistrationNames){for(var t=e._targetInst,n=[];t;)n.push(t),t=F(t);for(t=n.length;0<t--;)j(n[t],"captured",e);for(t=0;t<n.length;t++)j(n[t],"bubbled",e)}}function G(e,t,n){e&&n&&n.dispatchConfig.registrationName&&(t=O(e,n.dispatchConfig.registrationName))&&(n._dispatchListeners=w(n._dispatchListeners,t),n._dispatchInstances=w(n._dispatchInstances,e))}function W(e){e&&e.dispatchConfig.registrationName&&G(e._targetInst,null,e)}function z(e){R(e,B)}var V=!("undefined"==typeof window||!window.document||!window.document.createElement);function K(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Y={animationend:K("Animation","AnimationEnd"),animationiteration:K("Animation","AnimationIteration"),animationstart:K("Animation","AnimationStart"),transitionend:K("Transition","TransitionEnd")},Z={},J={};function Q(e){if(Z[e])return Z[e];if(!Y[e])return e;var t,n=Y[e];for(t in n)if(n.hasOwnProperty(t)&&t in J)return Z[e]=n[t];return e}V&&(J=document.createElement("div").style,"AnimationEvent"in window||(delete Y.animationend.animation,delete Y.animationiteration.animation,delete Y.animationstart.animation),"TransitionEvent"in window||delete Y.transitionend.transition);var X=Q("animationend"),ee=Q("animationiteration"),te=Q("animationstart"),ne=Q("transitionend"),ie="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),re=null,se=null,oe=null;function ae(){if(oe)return oe;var e,t,n=se,i=n.length,r="value"in re?re.value:re.textContent,s=r.length;for(e=0;e<i&&n[e]===r[e];e++);var o=i-e;for(t=1;t<=o&&n[i-t]===r[s-t];t++);return oe=r.slice(e,1<t?1-t:void 0)}function ue(){return!0}function le(){return!1}function ce(e,t,n,i){for(var r in this.dispatchConfig=e,this._targetInst=t,this.nativeEvent=n,e=this.constructor.Interface)e.hasOwnProperty(r)&&((t=e[r])?this[r]=t(n):"target"===r?this.target=i:this[r]=n[r]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?ue:le,this.isPropagationStopped=le,this}function de(e,t,n,i){if(this.eventPool.length){var r=this.eventPool.pop();return this.call(r,e,t,n,i),r}return new this(e,t,n,i)}function he(e){e instanceof this||o("279"),e.destructor(),10>this.eventPool.length&&this.eventPool.push(e)}function pe(e){e.eventPool=[],e.getPooled=de,e.release=he}r(ce.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=ue)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=ue)},persist:function(){this.isPersistent=ue},isPersistent:le,destructor:function(){var e,t=this.constructor.Interface;for(e in t)this[e]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=le,this._dispatchInstances=this._dispatchListeners=null}}),ce.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},ce.extend=function(e){function t(){}function n(){return i.apply(this,arguments)}var i=this;t.prototype=i.prototype;var s=new t;return r(s,n.prototype),n.prototype=s,n.prototype.constructor=n,n.Interface=r({},i.Interface,e),n.extend=i.extend,pe(n),n},pe(ce);var fe=ce.extend({data:null}),me=ce.extend({data:null}),ge=[9,13,27,32],Te=V&&"CompositionEvent"in window,ve=null;V&&"documentMode"in document&&(ve=document.documentMode);var ye=V&&"TextEvent"in window&&!ve,Ee=V&&(!Te||ve&&8<ve&&11>=ve),be=String.fromCharCode(32),Se={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},_e=!1;function Ce(e,t){switch(e){case"keyup":return-1!==ge.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function we(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Re=!1;var Ae={eventTypes:Se,extractEvents:function(e,t,n,i){var r=void 0,s=void 0;if(Te)e:{switch(e){case"compositionstart":r=Se.compositionStart;break e;case"compositionend":r=Se.compositionEnd;break e;case"compositionupdate":r=Se.compositionUpdate;break e}r=void 0}else Re?Ce(e,n)&&(r=Se.compositionEnd):"keydown"===e&&229===n.keyCode&&(r=Se.compositionStart);return r?(Ee&&"ko"!==n.locale&&(Re||r!==Se.compositionStart?r===Se.compositionEnd&&Re&&(s=ae()):(se="value"in(re=i)?re.value:re.textContent,Re=!0)),r=fe.getPooled(r,t,n,i),s?r.data=s:null!==(s=we(n))&&(r.data=s),z(r),s=r):s=null,(e=ye?function(e,t){switch(e){case"compositionend":return we(t);case"keypress":return 32!==t.which?null:(_e=!0,be);case"textInput":return(e=t.data)===be&&_e?null:e;default:return null}}(e,n):function(e,t){if(Re)return"compositionend"===e||!Te&&Ce(e,t)?(e=ae(),oe=se=re=null,Re=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Ee&&"ko"!==t.locale?null:t.data;default:return null}}(e,n))?((t=me.getPooled(Se.beforeInput,t,n,i)).data=e,z(t)):t=null,null===s?t:null===t?s:[s,t]}},Ie=null,Ne=null,xe=null;function De(e){if(e=S(e)){"function"!=typeof Ie&&o("280");var t=b(e.stateNode);Ie(e.stateNode,e.type,t)}}function Oe(e){Ne?xe?xe.push(e):xe=[e]:Ne=e}function ke(){if(Ne){var e=Ne,t=xe;if(xe=Ne=null,De(e),t)for(e=0;e<t.length;e++)De(t[e])}}function Ue(e,t){return e(t)}function Pe(e,t,n){return e(t,n)}function $e(){}var He=!1;function Me(e,t){if(He)return e(t);He=!0;try{return Ue(e,t)}finally{He=!1,(null!==Ne||null!==xe)&&($e(),ke())}}var qe={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Le(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!qe[e.type]:"textarea"===t}function Fe(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}function je(e){if(!V)return!1;var t=(e="on"+e)in document;return t||((t=document.createElement("div")).setAttribute(e,"return;"),t="function"==typeof t[e]),t}function Be(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Ge(e){e._valueTracker||(e._valueTracker=function(e){var t=Be(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var r=n.get,s=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function We(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=Be(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}var ze=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ve=/^(.*)[\\\/]/,Ke="function"==typeof Symbol&&Symbol.for,Ye=Ke?Symbol.for("react.element"):60103,Ze=Ke?Symbol.for("react.portal"):60106,Je=Ke?Symbol.for("react.fragment"):60107,Qe=Ke?Symbol.for("react.strict_mode"):60108,Xe=Ke?Symbol.for("react.profiler"):60114,et=Ke?Symbol.for("react.provider"):60109,tt=Ke?Symbol.for("react.context"):60110,nt=Ke?Symbol.for("react.concurrent_mode"):60111,it=Ke?Symbol.for("react.forward_ref"):60112,rt=Ke?Symbol.for("react.suspense"):60113,st=Ke?Symbol.for("react.memo"):60115,ot=Ke?Symbol.for("react.lazy"):60116,at="function"==typeof Symbol&&Symbol.iterator;function ut(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=at&&e[at]||e["@@iterator"])?e:null}function lt(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case nt:return"ConcurrentMode";case Je:return"Fragment";case Ze:return"Portal";case Xe:return"Profiler";case Qe:return"StrictMode";case rt:return"Suspense"}if("object"==typeof e)switch(e.$$typeof){case tt:return"Context.Consumer";case et:return"Context.Provider";case it:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case st:return lt(e.type);case ot:if(e=1===e._status?e._result:null)return lt(e)}return null}function ct(e){var t="";do{e:switch(e.tag){case 2:case 16:case 0:case 1:case 5:case 8:var n=e._debugOwner,i=e._debugSource,r=lt(e.type),s=null;n&&(s=lt(n.type)),n=r,r="",i?r=" (at "+i.fileName.replace(Ve,"")+":"+i.lineNumber+")":s&&(r=" (created by "+s+")"),s="\n    in "+(n||"Unknown")+r;break e;default:s=""}t+=s,e=e.return}while(e);return t}var dt=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ht=Object.prototype.hasOwnProperty,pt={},ft={};function mt(e,t,n,i,r){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t}var gt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){gt[e]=new mt(e,0,!1,e,null)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];gt[t]=new mt(t,1,!1,e[1],null)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){gt[e]=new mt(e,2,!1,e.toLowerCase(),null)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){gt[e]=new mt(e,2,!1,e,null)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){gt[e]=new mt(e,3,!1,e.toLowerCase(),null)}),["checked","multiple","muted","selected"].forEach(function(e){gt[e]=new mt(e,3,!0,e,null)}),["capture","download"].forEach(function(e){gt[e]=new mt(e,4,!1,e,null)}),["cols","rows","size","span"].forEach(function(e){gt[e]=new mt(e,6,!1,e,null)}),["rowSpan","start"].forEach(function(e){gt[e]=new mt(e,5,!1,e.toLowerCase(),null)});var Tt=/[\-:]([a-z])/g;function vt(e){return e[1].toUpperCase()}function yt(e,t,n,i){var r=gt.hasOwnProperty(t)?gt[t]:null;(null!==r?0===r.type:!i&&(2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1])))||(function(e,t,n,i){if(null===t||void 0===t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,i)&&(n=null),i||null===r?function(e){return!!ht.call(ft,e)||!ht.call(pt,e)&&(dt.test(e)?ft[e]=!0:(pt[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,i=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}function Et(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function bt(e,t){var n=t.checked;return r({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function St(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=Et(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function _t(e,t){null!=(t=t.checked)&&yt(e,"checked",t,!1)}function Ct(e,t){_t(e,t);var n=Et(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?Rt(e,t.type,n):t.hasOwnProperty("defaultValue")&&Rt(e,t.type,Et(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function wt(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!e.defaultChecked,e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function Rt(e,t,n){"number"===t&&e.ownerDocument.activeElement===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Tt,vt);gt[t]=new mt(t,1,!1,e,null)}),"xlink:actuate xlink:arcrole xlink:href xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Tt,vt);gt[t]=new mt(t,1,!1,e,"http://www.w3.org/1999/xlink")}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Tt,vt);gt[t]=new mt(t,1,!1,e,"http://www.w3.org/XML/1998/namespace")}),gt.tabIndex=new mt("tabIndex",1,!1,"tabindex",null);var At={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function It(e,t,n){return(e=ce.getPooled(At.change,e,t,n)).type="change",Oe(n),z(e),e}var Nt=null,xt=null;function Dt(e){k(e,!1)}function Ot(e){if(We(q(e)))return e}function kt(e,t){if("change"===e)return t}var Ut=!1;function Pt(){Nt&&(Nt.detachEvent("onpropertychange",$t),xt=Nt=null)}function $t(e){"value"===e.propertyName&&Ot(xt)&&Me(Dt,e=It(xt,e,Fe(e)))}function Ht(e,t,n){"focus"===e?(Pt(),xt=n,(Nt=t).attachEvent("onpropertychange",$t)):"blur"===e&&Pt()}function Mt(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Ot(xt)}function qt(e,t){if("click"===e)return Ot(t)}function Lt(e,t){if("input"===e||"change"===e)return Ot(t)}V&&(Ut=je("input")&&(!document.documentMode||9<document.documentMode));var Ft={eventTypes:At,_isInputEventSupported:Ut,extractEvents:function(e,t,n,i){var r=t?q(t):window,s=void 0,o=void 0,a=r.nodeName&&r.nodeName.toLowerCase();if("select"===a||"input"===a&&"file"===r.type?s=kt:Le(r)?Ut?s=Lt:(s=Mt,o=Ht):(a=r.nodeName)&&"input"===a.toLowerCase()&&("checkbox"===r.type||"radio"===r.type)&&(s=qt),s&&(s=s(e,t)))return It(s,n,i);o&&o(e,r,t),"blur"===e&&(e=r._wrapperState)&&e.controlled&&"number"===r.type&&Rt(r,"number",r.value)}},jt=ce.extend({view:null,detail:null}),Bt={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Gt(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Bt[e])&&!!t[e]}function Wt(){return Gt}var zt=0,Vt=0,Kt=!1,Yt=!1,Zt=jt.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:Wt,button:null,buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},movementX:function(e){if("movementX"in e)return e.movementX;var t=zt;return zt=e.screenX,Kt?"mousemove"===e.type?e.screenX-t:0:(Kt=!0,0)},movementY:function(e){if("movementY"in e)return e.movementY;var t=Vt;return Vt=e.screenY,Yt?"mousemove"===e.type?e.screenY-t:0:(Yt=!0,0)}}),Jt=Zt.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),Qt={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},Xt={eventTypes:Qt,extractEvents:function(e,t,n,i){var r="mouseover"===e||"pointerover"===e,s="mouseout"===e||"pointerout"===e;if(r&&(n.relatedTarget||n.fromElement)||!s&&!r)return null;if(r=i.window===i?i:(r=i.ownerDocument)?r.defaultView||r.parentWindow:window,s?(s=t,t=(t=n.relatedTarget||n.toElement)?H(t):null):s=null,s===t)return null;var o=void 0,a=void 0,u=void 0,l=void 0;"mouseout"===e||"mouseover"===e?(o=Zt,a=Qt.mouseLeave,u=Qt.mouseEnter,l="mouse"):"pointerout"!==e&&"pointerover"!==e||(o=Jt,a=Qt.pointerLeave,u=Qt.pointerEnter,l="pointer");var c=null==s?r:q(s);if(r=null==t?r:q(t),(e=o.getPooled(a,s,n,i)).type=l+"leave",e.target=c,e.relatedTarget=r,(n=o.getPooled(u,t,n,i)).type=l+"enter",n.target=r,n.relatedTarget=c,i=t,s&&i)e:{for(r=i,l=0,o=t=s;o;o=F(o))l++;for(o=0,u=r;u;u=F(u))o++;for(;0<l-o;)t=F(t),l--;for(;0<o-l;)r=F(r),o--;for(;l--;){if(t===r||t===r.alternate)break e;t=F(t),r=F(r)}t=null}else t=null;for(r=t,t=[];s&&s!==r&&(null===(l=s.alternate)||l!==r);)t.push(s),s=F(s);for(s=[];i&&i!==r&&(null===(l=i.alternate)||l!==r);)s.push(i),i=F(i);for(i=0;i<t.length;i++)G(t[i],"bubbled",e);for(i=s.length;0<i--;)G(s[i],"captured",n);return[e,n]}},en=Object.prototype.hasOwnProperty;function tn(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}function nn(e,t){if(tn(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++)if(!en.call(t,n[i])||!tn(e[n[i]],t[n[i]]))return!1;return!0}function rn(e){var t=e;if(e.alternate)for(;t.return;)t=t.return;else{if(0!=(2&t.effectTag))return 1;for(;t.return;)if(0!=(2&(t=t.return).effectTag))return 1}return 3===t.tag?2:3}function sn(e){2!==rn(e)&&o("188")}function on(e){if(!(e=function(e){var t=e.alternate;if(!t)return 3===(t=rn(e))&&o("188"),1===t?null:e;for(var n=e,i=t;;){var r=n.return,s=r?r.alternate:null;if(!r||!s)break;if(r.child===s.child){for(var a=r.child;a;){if(a===n)return sn(r),e;if(a===i)return sn(r),t;a=a.sibling}o("188")}if(n.return!==i.return)n=r,i=s;else{a=!1;for(var u=r.child;u;){if(u===n){a=!0,n=r,i=s;break}if(u===i){a=!0,i=r,n=s;break}u=u.sibling}if(!a){for(u=s.child;u;){if(u===n){a=!0,n=s,i=r;break}if(u===i){a=!0,i=s,n=r;break}u=u.sibling}a||o("189")}}n.alternate!==i&&o("190")}return 3!==n.tag&&o("188"),n.stateNode.current===n?e:t}(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}var an=ce.extend({animationName:null,elapsedTime:null,pseudoElement:null}),un=ce.extend({clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),ln=jt.extend({relatedTarget:null});function cn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}var dn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},pn=jt.extend({key:function(e){if(e.key){var t=dn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=cn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?hn[e.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:Wt,charCode:function(e){return"keypress"===e.type?cn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?cn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),fn=Zt.extend({dataTransfer:null}),mn=jt.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:Wt}),gn=ce.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),Tn=Zt.extend({deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null}),vn=[["abort","abort"],[X,"animationEnd"],[ee,"animationIteration"],[te,"animationStart"],["canplay","canPlay"],["canplaythrough","canPlayThrough"],["drag","drag"],["dragenter","dragEnter"],["dragexit","dragExit"],["dragleave","dragLeave"],["dragover","dragOver"],["durationchange","durationChange"],["emptied","emptied"],["encrypted","encrypted"],["ended","ended"],["error","error"],["gotpointercapture","gotPointerCapture"],["load","load"],["loadeddata","loadedData"],["loadedmetadata","loadedMetadata"],["loadstart","loadStart"],["lostpointercapture","lostPointerCapture"],["mousemove","mouseMove"],["mouseout","mouseOut"],["mouseover","mouseOver"],["playing","playing"],["pointermove","pointerMove"],["pointerout","pointerOut"],["pointerover","pointerOver"],["progress","progress"],["scroll","scroll"],["seeking","seeking"],["stalled","stalled"],["suspend","suspend"],["timeupdate","timeUpdate"],["toggle","toggle"],["touchmove","touchMove"],[ne,"transitionEnd"],["waiting","waiting"],["wheel","wheel"]],yn={},En={};function bn(e,t){var n=e[0],i="on"+((e=e[1])[0].toUpperCase()+e.slice(1));t={phasedRegistrationNames:{bubbled:i,captured:i+"Capture"},dependencies:[n],isInteractive:t},yn[e]=t,En[n]=t}[["blur","blur"],["cancel","cancel"],["click","click"],["close","close"],["contextmenu","contextMenu"],["copy","copy"],["cut","cut"],["auxclick","auxClick"],["dblclick","doubleClick"],["dragend","dragEnd"],["dragstart","dragStart"],["drop","drop"],["focus","focus"],["input","input"],["invalid","invalid"],["keydown","keyDown"],["keypress","keyPress"],["keyup","keyUp"],["mousedown","mouseDown"],["mouseup","mouseUp"],["paste","paste"],["pause","pause"],["play","play"],["pointercancel","pointerCancel"],["pointerdown","pointerDown"],["pointerup","pointerUp"],["ratechange","rateChange"],["reset","reset"],["seeked","seeked"],["submit","submit"],["touchcancel","touchCancel"],["touchend","touchEnd"],["touchstart","touchStart"],["volumechange","volumeChange"]].forEach(function(e){bn(e,!0)}),vn.forEach(function(e){bn(e,!1)});var Sn={eventTypes:yn,isInteractiveTopLevelEventType:function(e){return void 0!==(e=En[e])&&!0===e.isInteractive},extractEvents:function(e,t,n,i){var r=En[e];if(!r)return null;switch(e){case"keypress":if(0===cn(n))return null;case"keydown":case"keyup":e=pn;break;case"blur":case"focus":e=ln;break;case"click":if(2===n.button)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":e=Zt;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":e=fn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":e=mn;break;case X:case ee:case te:e=an;break;case ne:e=gn;break;case"scroll":e=jt;break;case"wheel":e=Tn;break;case"copy":case"cut":case"paste":e=un;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":e=Jt;break;default:e=ce}return z(t=e.getPooled(r,t,n,i)),t}},_n=Sn.isInteractiveTopLevelEventType,Cn=[];function wn(e){var t=e.targetInst,n=t;do{if(!n){e.ancestors.push(n);break}var i;for(i=n;i.return;)i=i.return;if(!(i=3!==i.tag?null:i.stateNode.containerInfo))break;e.ancestors.push(n),n=H(i)}while(n);for(n=0;n<e.ancestors.length;n++){t=e.ancestors[n];var r=Fe(e.nativeEvent);i=e.topLevelType;for(var s=e.nativeEvent,o=null,a=0;a<T.length;a++){var u=T[a];u&&(u=u.extractEvents(i,t,s,r))&&(o=w(o,u))}k(o,!1)}}var Rn=!0;function An(e,t){if(!t)return null;var n=(_n(e)?Nn:xn).bind(null,e);t.addEventListener(e,n,!1)}function In(e,t){if(!t)return null;var n=(_n(e)?Nn:xn).bind(null,e);t.addEventListener(e,n,!0)}function Nn(e,t){Pe(xn,e,t)}function xn(e,t){if(Rn){var n=Fe(t);if(null===(n=H(n))||"number"!=typeof n.tag||2===rn(n)||(n=null),Cn.length){var i=Cn.pop();i.topLevelType=e,i.nativeEvent=t,i.targetInst=n,e=i}else e={topLevelType:e,nativeEvent:t,targetInst:n,ancestors:[]};try{Me(wn,e)}finally{e.topLevelType=null,e.nativeEvent=null,e.targetInst=null,e.ancestors.length=0,10>Cn.length&&Cn.push(e)}}}var Dn={},On=0,kn="_reactListenersID"+(""+Math.random()).slice(2);function Un(e){return Object.prototype.hasOwnProperty.call(e,kn)||(e[kn]=On++,Dn[e[kn]]={}),Dn[e[kn]]}function Pn(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function $n(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Hn(e,t){var n,i=$n(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=$n(i)}}function Mn(){for(var e=window,t=Pn();t instanceof e.HTMLIFrameElement;){try{e=t.contentDocument.defaultView}catch(e){break}t=Pn(e.document)}return t}function qn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var Ln=V&&"documentMode"in document&&11>=document.documentMode,Fn={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},jn=null,Bn=null,Gn=null,Wn=!1;function zn(e,t){var n=t.window===t?t.document:9===t.nodeType?t:t.ownerDocument;return Wn||null==jn||jn!==Pn(n)?null:("selectionStart"in(n=jn)&&qn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},Gn&&nn(Gn,n)?null:(Gn=n,(e=ce.getPooled(Fn.select,Bn,e,t)).type="select",e.target=jn,z(e),e))}var Vn={eventTypes:Fn,extractEvents:function(e,t,n,i){var r,s=i.window===i?i.document:9===i.nodeType?i:i.ownerDocument;if(!(r=!s)){e:{s=Un(s),r=E.onSelect;for(var o=0;o<r.length;o++){var a=r[o];if(!s.hasOwnProperty(a)||!s[a]){s=!1;break e}}s=!0}r=!s}if(r)return null;switch(s=t?q(t):window,e){case"focus":(Le(s)||"true"===s.contentEditable)&&(jn=s,Bn=t,Gn=null);break;case"blur":Gn=Bn=jn=null;break;case"mousedown":Wn=!0;break;case"contextmenu":case"mouseup":case"dragend":return Wn=!1,zn(n,i);case"selectionchange":if(Ln)break;case"keydown":case"keyup":return zn(n,i)}return null}};function Kn(e,t){return e=r({children:void 0},t),(t=function(e){var t="";return i.Children.forEach(e,function(e){null!=e&&(t+=e)}),t}(t.children))&&(e.children=t),e}function Yn(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+Et(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function Zn(e,t){return null!=t.dangerouslySetInnerHTML&&o("91"),r({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Jn(e,t){var n=t.value;null==n&&(n=t.defaultValue,null!=(t=t.children)&&(null!=n&&o("92"),Array.isArray(t)&&(1>=t.length||o("93"),t=t[0]),n=t),null==n&&(n="")),e._wrapperState={initialValue:Et(n)}}function Qn(e,t){var n=Et(t.value),i=Et(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function Xn(e){var t=e.textContent;t===e._wrapperState.initialValue&&(e.value=t)}D.injectEventPluginOrder("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" ")),b=L,S=M,_=q,D.injectEventPluginsByName({SimpleEventPlugin:Sn,EnterLeaveEventPlugin:Xt,ChangeEventPlugin:Ft,SelectEventPlugin:Vn,BeforeInputEventPlugin:Ae});var ei={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function ti(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ni(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ti(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ii=void 0,ri=function(e){return"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,n,i,r){MSApp.execUnsafeLocalFunction(function(){return e(t,n)})}:e}(function(e,t){if(e.namespaceURI!==ei.svg||"innerHTML"in e)e.innerHTML=t;else{for((ii=ii||document.createElement("div")).innerHTML="<svg>"+t+"</svg>",t=ii.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function si(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var oi={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ai=["Webkit","ms","Moz","O"];function ui(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=n,s=t[n];r=null==s||"boolean"==typeof s||""===s?"":i||"number"!=typeof s||0===s||oi.hasOwnProperty(r)&&oi[r]?(""+s).trim():s+"px","float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}Object.keys(oi).forEach(function(e){ai.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),oi[t]=oi[e]})});var li=r({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ci(e,t){t&&(li[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML)&&o("137",e,""),null!=t.dangerouslySetInnerHTML&&(null!=t.children&&o("60"),"object"==typeof t.dangerouslySetInnerHTML&&"__html"in t.dangerouslySetInnerHTML||o("61")),null!=t.style&&"object"!=typeof t.style&&o("62",""))}function di(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function hi(e,t){var n=Un(e=9===e.nodeType||11===e.nodeType?e:e.ownerDocument);t=E[t];for(var i=0;i<t.length;i++){var r=t[i];if(!n.hasOwnProperty(r)||!n[r]){switch(r){case"scroll":In("scroll",e);break;case"focus":case"blur":In("focus",e),In("blur",e),n.blur=!0,n.focus=!0;break;case"cancel":case"close":je(r)&&In(r,e);break;case"invalid":case"submit":case"reset":break;default:-1===ie.indexOf(r)&&An(r,e)}n[r]=!0}}}function pi(){}var fi=null,mi=null;function gi(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function Ti(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var vi=setTimeout,yi=clearTimeout;function Ei(e){for(e=e.nextSibling;e&&1!==e.nodeType&&3!==e.nodeType;)e=e.nextSibling;return e}function bi(e){for(e=e.firstChild;e&&1!==e.nodeType&&3!==e.nodeType;)e=e.nextSibling;return e}new Set;var Si=[],_i=-1;function Ci(e){0>_i||(e.current=Si[_i],Si[_i]=null,_i--)}function wi(e,t){Si[++_i]=e.current,e.current=t}var Ri={},Ai={current:Ri},Ii={current:!1},Ni=Ri;function xi(e,t){var n=e.type.contextTypes;if(!n)return Ri;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,s={};for(r in n)s[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function Di(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Oi(e){Ci(Ii),Ci(Ai)}function ki(e){Ci(Ii),Ci(Ai)}function Ui(e,t,n){Ai.current!==Ri&&o("168"),wi(Ai,t),wi(Ii,n)}function Pi(e,t,n){var i=e.stateNode;if(e=t.childContextTypes,"function"!=typeof i.getChildContext)return n;for(var s in i=i.getChildContext())s in e||o("108",lt(t)||"Unknown",s);return r({},n,i)}function $i(e){var t=e.stateNode;return t=t&&t.__reactInternalMemoizedMergedChildContext||Ri,Ni=Ai.current,wi(Ai,t),wi(Ii,Ii.current),!0}function Hi(e,t,n){var i=e.stateNode;i||o("169"),n?(t=Pi(e,t,Ni),i.__reactInternalMemoizedMergedChildContext=t,Ci(Ii),Ci(Ai),wi(Ai,t)):Ci(Ii),wi(Ii,n)}var Mi=null,qi=null;function Li(e){return function(t){try{return e(t)}catch(e){}}}function Fi(e,t,n,i){return new function(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.firstContextDependency=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}(e,t,n,i)}function ji(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Bi(e,t){var n=e.alternate;return null===n?((n=Fi(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.effectTag=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childExpirationTime=e.childExpirationTime,n.expirationTime=e.expirationTime,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,n.firstContextDependency=e.firstContextDependency,n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Gi(e,t,n,i,r,s){var a=2;if(i=e,"function"==typeof e)ji(e)&&(a=1);else if("string"==typeof e)a=5;else e:switch(e){case Je:return Wi(n.children,r,s,t);case nt:return zi(n,3|r,s,t);case Qe:return zi(n,2|r,s,t);case Xe:return(e=Fi(12,n,t,4|r)).elementType=Xe,e.type=Xe,e.expirationTime=s,e;case rt:return(e=Fi(13,n,t,r)).elementType=rt,e.type=rt,e.expirationTime=s,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case et:a=10;break e;case tt:a=9;break e;case it:a=11;break e;case st:a=14;break e;case ot:a=16,i=null;break e}o("130",null==e?e:typeof e,"")}return(t=Fi(a,n,t,r)).elementType=e,t.type=i,t.expirationTime=s,t}function Wi(e,t,n,i){return(e=Fi(7,e,i,t)).expirationTime=n,e}function zi(e,t,n,i){return e=Fi(8,e,i,t),t=0==(1&t)?Qe:nt,e.elementType=t,e.type=t,e.expirationTime=n,e}function Vi(e,t,n){return(e=Fi(6,e,null,t)).expirationTime=n,e}function Ki(e,t,n){return(t=Fi(4,null!==e.children?e.children:[],e.key,t)).expirationTime=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Yi(e,t){e.didError=!1;var n=e.earliestPendingTime;0===n?e.earliestPendingTime=e.latestPendingTime=t:n>t?e.earliestPendingTime=t:e.latestPendingTime<t&&(e.latestPendingTime=t),Qi(t,e)}function Zi(e,t){e.didError=!1;var n=e.latestPingedTime;0!==n&&n<=t&&(e.latestPingedTime=0),n=e.earliestPendingTime;var i=e.latestPendingTime;n===t?e.earliestPendingTime=i===t?e.latestPendingTime=0:i:i===t&&(e.latestPendingTime=n),n=e.earliestSuspendedTime,i=e.latestSuspendedTime,0===n?e.earliestSuspendedTime=e.latestSuspendedTime=t:n>t?e.earliestSuspendedTime=t:i<t&&(e.latestSuspendedTime=t),Qi(t,e)}function Ji(e,t){var n=e.earliestPendingTime;return e=e.earliestSuspendedTime,(0===t||0!==n&&n<t)&&(t=n),(0===t||0!==e&&e<t)&&(t=e),t}function Qi(e,t){var n=t.earliestSuspendedTime,i=t.latestSuspendedTime,r=t.earliestPendingTime,s=t.latestPingedTime;0===(r=0!==r?r:s)&&(0===e||i>e)&&(r=i),0!==(e=r)&&0!==n&&n<e&&(e=n),t.nextExpirationTimeToWorkOn=r,t.expirationTime=e}var Xi=!1;function er(e){return{baseState:e,firstUpdate:null,lastUpdate:null,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function tr(e){return{baseState:e.baseState,firstUpdate:e.firstUpdate,lastUpdate:e.lastUpdate,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function nr(e){return{expirationTime:e,tag:0,payload:null,callback:null,next:null,nextEffect:null}}function ir(e,t){null===e.lastUpdate?e.firstUpdate=e.lastUpdate=t:(e.lastUpdate.next=t,e.lastUpdate=t)}function rr(e,t){var n=e.alternate;if(null===n){var i=e.updateQueue,r=null;null===i&&(i=e.updateQueue=er(e.memoizedState))}else i=e.updateQueue,r=n.updateQueue,null===i?null===r?(i=e.updateQueue=er(e.memoizedState),r=n.updateQueue=er(n.memoizedState)):i=e.updateQueue=tr(r):null===r&&(r=n.updateQueue=tr(i));null===r||i===r?ir(i,t):null===i.lastUpdate||null===r.lastUpdate?(ir(i,t),ir(r,t)):(ir(i,t),r.lastUpdate=t)}function sr(e,t){var n=e.updateQueue;null===(n=null===n?e.updateQueue=er(e.memoizedState):or(e,n)).lastCapturedUpdate?n.firstCapturedUpdate=n.lastCapturedUpdate=t:(n.lastCapturedUpdate.next=t,n.lastCapturedUpdate=t)}function or(e,t){var n=e.alternate;return null!==n&&t===n.updateQueue&&(t=e.updateQueue=tr(t)),t}function ar(e,t,n,i,s,o){switch(n.tag){case 1:return"function"==typeof(e=n.payload)?e.call(o,i,s):e;case 3:e.effectTag=-1025&e.effectTag|64;case 0:if(null===(s="function"==typeof(e=n.payload)?e.call(o,i,s):e)||void 0===s)break;return r({},i,s);case 2:Xi=!0}return i}function ur(e,t,n,i,r){Xi=!1;for(var s=(t=or(e,t)).baseState,o=null,a=0,u=t.firstUpdate,l=s;null!==u;){var c=u.expirationTime;c>r?(null===o&&(o=u,s=l),(0===a||a>c)&&(a=c)):(l=ar(e,0,u,l,n,i),null!==u.callback&&(e.effectTag|=32,u.nextEffect=null,null===t.lastEffect?t.firstEffect=t.lastEffect=u:(t.lastEffect.nextEffect=u,t.lastEffect=u))),u=u.next}for(c=null,u=t.firstCapturedUpdate;null!==u;){var d=u.expirationTime;d>r?(null===c&&(c=u,null===o&&(s=l)),(0===a||a>d)&&(a=d)):(l=ar(e,0,u,l,n,i),null!==u.callback&&(e.effectTag|=32,u.nextEffect=null,null===t.lastCapturedEffect?t.firstCapturedEffect=t.lastCapturedEffect=u:(t.lastCapturedEffect.nextEffect=u,t.lastCapturedEffect=u))),u=u.next}null===o&&(t.lastUpdate=null),null===c?t.lastCapturedUpdate=null:e.effectTag|=32,null===o&&null===c&&(s=l),t.baseState=s,t.firstUpdate=o,t.firstCapturedUpdate=c,e.expirationTime=a,e.memoizedState=l}function lr(e,t,n){null!==t.firstCapturedUpdate&&(null!==t.lastUpdate&&(t.lastUpdate.next=t.firstCapturedUpdate,t.lastUpdate=t.lastCapturedUpdate),t.firstCapturedUpdate=t.lastCapturedUpdate=null),cr(t.firstEffect,n),t.firstEffect=t.lastEffect=null,cr(t.firstCapturedEffect,n),t.firstCapturedEffect=t.lastCapturedEffect=null}function cr(e,t){for(;null!==e;){var n=e.callback;if(null!==n){e.callback=null;var i=t;"function"!=typeof n&&o("191",n),n.call(i)}e=e.nextEffect}}function dr(e,t){return{value:e,source:t,stack:ct(t)}}var hr={current:null},pr=null,fr=null,mr=null;function gr(e,t){var n=e.type._context;wi(hr,n._currentValue),n._currentValue=t}function Tr(e){var t=hr.current;Ci(hr),e.type._context._currentValue=t}function vr(e){pr=e,mr=fr=null,e.firstContextDependency=null}function yr(e,t){return mr!==e&&!1!==t&&0!==t&&("number"==typeof t&&1073741823!==t||(mr=e,t=1073741823),t={context:e,observedBits:t,next:null},null===fr?(null===pr&&o("293"),pr.firstContextDependency=fr=t):fr=fr.next=t),e._currentValue}var Er={},br={current:Er},Sr={current:Er},_r={current:Er};function Cr(e){return e===Er&&o("174"),e}function wr(e,t){wi(_r,t),wi(Sr,e),wi(br,Er);var n=t.nodeType;switch(n){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ni(null,"");break;default:t=ni(t=(n=8===n?t.parentNode:t).namespaceURI||null,n=n.tagName)}Ci(br),wi(br,t)}function Rr(e){Ci(br),Ci(Sr),Ci(_r)}function Ar(e){Cr(_r.current);var t=Cr(br.current),n=ni(t,e.type);t!==n&&(wi(Sr,e),wi(br,n))}function Ir(e){Sr.current===e&&(Ci(br),Ci(Sr))}var Nr=ze.ReactCurrentOwner,xr=(new i.Component).refs;function Dr(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:r({},t,n),e.memoizedState=n,null!==(i=e.updateQueue)&&0===e.expirationTime&&(i.baseState=n)}var Or={isMounted:function(e){return!!(e=e._reactInternalFiber)&&2===rn(e)},enqueueSetState:function(e,t,n){e=e._reactInternalFiber;var i=_o(),r=nr(i=Ws(i,e));r.payload=t,void 0!==n&&null!==n&&(r.callback=n),rr(e,r),Ks(e,i)},enqueueReplaceState:function(e,t,n){e=e._reactInternalFiber;var i=_o(),r=nr(i=Ws(i,e));r.tag=1,r.payload=t,void 0!==n&&null!==n&&(r.callback=n),rr(e,r),Ks(e,i)},enqueueForceUpdate:function(e,t){e=e._reactInternalFiber;var n=_o(),i=nr(n=Ws(n,e));i.tag=2,void 0!==t&&null!==t&&(i.callback=t),rr(e,i),Ks(e,n)}};function kr(e,t,n,i,r,s,o){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,s,o):!t.prototype||!t.prototype.isPureReactComponent||(!nn(n,i)||!nn(r,s))}function Ur(e,t,n){var i=!1,r=Ri,s=t.contextType;return"object"==typeof s&&null!==s?s=Nr.currentDispatcher.readContext(s):(r=Di(t)?Ni:Ai.current,s=(i=null!==(i=t.contextTypes)&&void 0!==i)?xi(e,r):Ri),t=new t(n,s),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Or,e.stateNode=t,t._reactInternalFiber=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=s),t}function Pr(e,t,n,i){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&Or.enqueueReplaceState(t,t.state,null)}function $r(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs=xr;var s=t.contextType;"object"==typeof s&&null!==s?r.context=Nr.currentDispatcher.readContext(s):(s=Di(t)?Ni:Ai.current,r.context=xi(e,s)),null!==(s=e.updateQueue)&&(ur(e,s,n,r,i),r.state=e.memoizedState),"function"==typeof(s=t.getDerivedStateFromProps)&&(Dr(e,t,s,n),r.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof r.getSnapshotBeforeUpdate||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||(t=r.state,"function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&Or.enqueueReplaceState(r,r.state,null),null!==(s=e.updateQueue)&&(ur(e,s,n,r,i),r.state=e.memoizedState)),"function"==typeof r.componentDidMount&&(e.effectTag|=4)}var Hr=Array.isArray;function Mr(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){var i=void 0;(n=n._owner)&&(1!==n.tag&&o("289"),i=n.stateNode),i||o("147",e);var r=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===r?t.ref:((t=function(e){var t=i.refs;t===xr&&(t=i.refs={}),null===e?delete t[r]:t[r]=e})._stringRef=r,t)}"string"!=typeof e&&o("284"),n._owner||o("290",e)}return e}function qr(e,t){"textarea"!==e.type&&o("31","[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t,"")}function Lr(e){function t(t,n){if(e){var i=t.lastEffect;null!==i?(i.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.effectTag=8}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t,n){return(e=Bi(e,t)).index=0,e.sibling=null,e}function s(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.effectTag=2,n):i:(t.effectTag=2,n):n}function a(t){return e&&null===t.alternate&&(t.effectTag=2),t}function u(e,t,n,i){return null===t||6!==t.tag?((t=Vi(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function l(e,t,n,i){return null!==t&&t.elementType===n.type?((i=r(t,n.props)).ref=Mr(e,t,n),i.return=e,i):((i=Gi(n.type,n.key,n.props,null,e.mode,i)).ref=Mr(e,t,n),i.return=e,i)}function c(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Ki(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function d(e,t,n,i,s){return null===t||7!==t.tag?((t=Wi(n,e.mode,i,s)).return=e,t):((t=r(t,n)).return=e,t)}function h(e,t,n){if("string"==typeof t||"number"==typeof t)return(t=Vi(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case Ye:return(n=Gi(t.type,t.key,t.props,null,e.mode,n)).ref=Mr(e,null,t),n.return=e,n;case Ze:return(t=Ki(t,e.mode,n)).return=e,t}if(Hr(t)||ut(t))return(t=Wi(t,e.mode,n,null)).return=e,t;qr(e,t)}return null}function p(e,t,n,i){var r=null!==t?t.key:null;if("string"==typeof n||"number"==typeof n)return null!==r?null:u(e,t,""+n,i);if("object"==typeof n&&null!==n){switch(n.$$typeof){case Ye:return n.key===r?n.type===Je?d(e,t,n.props.children,i,r):l(e,t,n,i):null;case Ze:return n.key===r?c(e,t,n,i):null}if(Hr(n)||ut(n))return null!==r?null:d(e,t,n,i,null);qr(e,n)}return null}function f(e,t,n,i,r){if("string"==typeof i||"number"==typeof i)return u(t,e=e.get(n)||null,""+i,r);if("object"==typeof i&&null!==i){switch(i.$$typeof){case Ye:return e=e.get(null===i.key?n:i.key)||null,i.type===Je?d(t,e,i.props.children,r,i.key):l(t,e,i,r);case Ze:return c(t,e=e.get(null===i.key?n:i.key)||null,i,r)}if(Hr(i)||ut(i))return d(t,e=e.get(n)||null,i,r,null);qr(t,i)}return null}function m(r,o,a,u){for(var l=null,c=null,d=o,m=o=0,g=null;null!==d&&m<a.length;m++){d.index>m?(g=d,d=null):g=d.sibling;var T=p(r,d,a[m],u);if(null===T){null===d&&(d=g);break}e&&d&&null===T.alternate&&t(r,d),o=s(T,o,m),null===c?l=T:c.sibling=T,c=T,d=g}if(m===a.length)return n(r,d),l;if(null===d){for(;m<a.length;m++)(d=h(r,a[m],u))&&(o=s(d,o,m),null===c?l=d:c.sibling=d,c=d);return l}for(d=i(r,d);m<a.length;m++)(g=f(d,r,m,a[m],u))&&(e&&null!==g.alternate&&d.delete(null===g.key?m:g.key),o=s(g,o,m),null===c?l=g:c.sibling=g,c=g);return e&&d.forEach(function(e){return t(r,e)}),l}function g(r,a,u,l){var c=ut(u);"function"!=typeof c&&o("150"),null==(u=c.call(u))&&o("151");for(var d=c=null,m=a,g=a=0,T=null,v=u.next();null!==m&&!v.done;g++,v=u.next()){m.index>g?(T=m,m=null):T=m.sibling;var y=p(r,m,v.value,l);if(null===y){m||(m=T);break}e&&m&&null===y.alternate&&t(r,m),a=s(y,a,g),null===d?c=y:d.sibling=y,d=y,m=T}if(v.done)return n(r,m),c;if(null===m){for(;!v.done;g++,v=u.next())null!==(v=h(r,v.value,l))&&(a=s(v,a,g),null===d?c=v:d.sibling=v,d=v);return c}for(m=i(r,m);!v.done;g++,v=u.next())null!==(v=f(m,r,g,v.value,l))&&(e&&null!==v.alternate&&m.delete(null===v.key?g:v.key),a=s(v,a,g),null===d?c=v:d.sibling=v,d=v);return e&&m.forEach(function(e){return t(r,e)}),c}return function(e,i,s,u){var l="object"==typeof s&&null!==s&&s.type===Je&&null===s.key;l&&(s=s.props.children);var c="object"==typeof s&&null!==s;if(c)switch(s.$$typeof){case Ye:e:{for(c=s.key,l=i;null!==l;){if(l.key===c){if(7===l.tag?s.type===Je:l.elementType===s.type){n(e,l.sibling),(i=r(l,s.type===Je?s.props.children:s.props)).ref=Mr(e,l,s),i.return=e,e=i;break e}n(e,l);break}t(e,l),l=l.sibling}s.type===Je?((i=Wi(s.props.children,e.mode,u,s.key)).return=e,e=i):((u=Gi(s.type,s.key,s.props,null,e.mode,u)).ref=Mr(e,i,s),u.return=e,e=u)}return a(e);case Ze:e:{for(l=s.key;null!==i;){if(i.key===l){if(4===i.tag&&i.stateNode.containerInfo===s.containerInfo&&i.stateNode.implementation===s.implementation){n(e,i.sibling),(i=r(i,s.children||[])).return=e,e=i;break e}n(e,i);break}t(e,i),i=i.sibling}(i=Ki(s,e.mode,u)).return=e,e=i}return a(e)}if("string"==typeof s||"number"==typeof s)return s=""+s,null!==i&&6===i.tag?(n(e,i.sibling),(i=r(i,s)).return=e,e=i):(n(e,i),(i=Vi(s,e.mode,u)).return=e,e=i),a(e);if(Hr(s))return m(e,i,s,u);if(ut(s))return g(e,i,s,u);if(c&&qr(e,s),void 0===s&&!l)switch(e.tag){case 1:case 0:o("152",(u=e.type).displayName||u.name||"Component")}return n(e,i)}}var Fr=Lr(!0),jr=Lr(!1),Br=null,Gr=null,Wr=!1;function zr(e,t){var n=Fi(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.effectTag=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function Vr(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);default:return!1}}function Kr(e){if(Wr){var t=Gr;if(t){var n=t;if(!Vr(e,t)){if(!(t=Ei(n))||!Vr(e,t))return e.effectTag|=2,Wr=!1,void(Br=e);zr(Br,n)}Br=e,Gr=bi(t)}else e.effectTag|=2,Wr=!1,Br=e}}function Yr(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag;)e=e.return;Br=e}function Zr(e){if(e!==Br)return!1;if(!Wr)return Yr(e),Wr=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!Ti(t,e.memoizedProps))for(t=Gr;t;)zr(e,t),t=Ei(t);return Yr(e),Gr=Br?Ei(e.stateNode):null,!0}function Jr(){Gr=Br=null,Wr=!1}var Qr=ze.ReactCurrentOwner;function Xr(e,t,n,i){t.child=null===e?jr(t,null,n,i):Fr(t,e.child,n,i)}function es(e,t,n,i,r){n=n.render;var s=t.ref;return Ii.current||t.memoizedProps!==i||s!==(null!==e?e.ref:null)?(Xr(e,t,i=n(i,s),r),t.child):cs(e,t,r)}function ts(e,t,n,i,r,s){if(null===e){var o=n.type;return"function"!=typeof o||ji(o)||void 0!==o.defaultProps||null!==n.compare?((e=Gi(n.type,null,i,null,t.mode,s)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,ns(e,t,o,i,r,s))}return o=e.child,(0===r||r>s)&&(r=o.memoizedProps,(n=null!==(n=n.compare)?n:nn)(r,i)&&e.ref===t.ref)?cs(e,t,s):((e=Bi(o,i)).ref=t.ref,e.return=t,t.child=e)}function ns(e,t,n,i,r,s){return null!==e&&(0===r||r>s)&&nn(e.memoizedProps,i)&&e.ref===t.ref?cs(e,t,s):rs(e,t,n,i,s)}function is(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.effectTag|=128)}function rs(e,t,n,i,r){var s=Di(n)?Ni:Ai.current;return s=xi(t,s),vr(t),n=n(i,s),t.effectTag|=1,Xr(e,t,n,r),t.child}function ss(e,t,n,i,r){if(Di(n)){var s=!0;$i(t)}else s=!1;if(vr(t),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),Ur(t,n,i),$r(t,n,i,r),i=!0;else if(null===e){var o=t.stateNode,a=t.memoizedProps;o.props=a;var u=o.context,l=n.contextType;"object"==typeof l&&null!==l?l=Nr.currentDispatcher.readContext(l):l=xi(t,l=Di(n)?Ni:Ai.current);var c=n.getDerivedStateFromProps,d="function"==typeof c||"function"==typeof o.getSnapshotBeforeUpdate;d||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(a!==i||u!==l)&&Pr(t,o,i,l),Xi=!1;var h=t.memoizedState;u=o.state=h;var p=t.updateQueue;null!==p&&(ur(t,p,i,o,r),u=t.memoizedState),a!==i||h!==u||Ii.current||Xi?("function"==typeof c&&(Dr(t,n,c,i),u=t.memoizedState),(a=Xi||kr(t,n,a,i,h,u,l))?(d||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||("function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"==typeof o.componentDidMount&&(t.effectTag|=4)):("function"==typeof o.componentDidMount&&(t.effectTag|=4),t.memoizedProps=i,t.memoizedState=u),o.props=i,o.state=u,o.context=l,i=a):("function"==typeof o.componentDidMount&&(t.effectTag|=4),i=!1)}else o=t.stateNode,a=t.memoizedProps,o.props=a,u=o.context,"object"==typeof(l=n.contextType)&&null!==l?l=Nr.currentDispatcher.readContext(l):l=xi(t,l=Di(n)?Ni:Ai.current),(d="function"==typeof(c=n.getDerivedStateFromProps)||"function"==typeof o.getSnapshotBeforeUpdate)||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(a!==i||u!==l)&&Pr(t,o,i,l),Xi=!1,u=t.memoizedState,h=o.state=u,null!==(p=t.updateQueue)&&(ur(t,p,i,o,r),h=t.memoizedState),a!==i||u!==h||Ii.current||Xi?("function"==typeof c&&(Dr(t,n,c,i),h=t.memoizedState),(c=Xi||kr(t,n,a,i,u,h,l))?(d||"function"!=typeof o.UNSAFE_componentWillUpdate&&"function"!=typeof o.componentWillUpdate||("function"==typeof o.componentWillUpdate&&o.componentWillUpdate(i,h,l),"function"==typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,h,l)),"function"==typeof o.componentDidUpdate&&(t.effectTag|=4),"function"==typeof o.getSnapshotBeforeUpdate&&(t.effectTag|=256)):("function"!=typeof o.componentDidUpdate||a===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=4),"function"!=typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=256),t.memoizedProps=i,t.memoizedState=h),o.props=i,o.state=h,o.context=l,i=c):("function"!=typeof o.componentDidUpdate||a===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=4),"function"!=typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=256),i=!1);return os(e,t,n,i,s,r)}function os(e,t,n,i,r,s){is(e,t);var o=0!=(64&t.effectTag);if(!i&&!o)return r&&Hi(t,n,!1),cs(e,t,s);i=t.stateNode,Qr.current=t;var a=o&&"function"!=typeof n.getDerivedStateFromError?null:i.render();return t.effectTag|=1,null!==e&&o?(t.child=Fr(t,e.child,null,s),t.child=Fr(t,null,a,s)):Xr(e,t,a,s),t.memoizedState=i.state,r&&Hi(t,n,!0),t.child}function as(e){var t=e.stateNode;t.pendingContext?Ui(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Ui(0,t.context,!1),wr(e,t.containerInfo)}function us(e,t){if(e&&e.defaultProps)for(var n in t=r({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}function ls(e,t,n){var i=t.mode,r=t.pendingProps,s=t.memoizedState;null!==s&&(s.alreadyCaptured?null!==e&&s===e.memoizedState?s={alreadyCaptured:!0,didTimeout:!0,timedOutAt:s.timedOutAt}:(s.alreadyCaptured=!0,s.didTimeout=!0):s=null);var o=null!==s&&s.didTimeout;if(null===e)o?(o=r.fallback,r=Wi(null,i,0,null),i=Wi(o,i,n,null),r.sibling=i,(n=r).return=i.return=t):n=i=jr(t,null,r.children,n);else{var a=e.memoizedState;null!==a&&a.didTimeout?(e=(i=e.child).sibling,o?(n=r.fallback,(i=Bi(i,i.pendingProps)).effectTag|=2,(r=i.sibling=Bi(e,n,e.expirationTime)).effectTag|=2,n=i,i.childExpirationTime=0,i=r,n.return=i.return=t):(o=e.child,i=Fr(t,i.child,r.children,n),Fr(t,o,null,n),n=i)):(e=e.child,o?(o=r.fallback,(r=Wi(null,i,0,null)).effectTag|=2,r.child=e,e.return=r,(i=r.sibling=Wi(o,i,n,null)).effectTag|=2,n=r,r.childExpirationTime=0,n.return=i.return=t):i=n=Fr(t,e,r.children,n))}return t.memoizedState=s,t.child=n,i}function cs(e,t,n){null!==e&&(t.firstContextDependency=e.firstContextDependency);var i=t.childExpirationTime;if(0===i||i>n)return null;if(null!==e&&t.child!==e.child&&o("153"),null!==t.child){for(n=Bi(e=t.child,e.pendingProps,e.expirationTime),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Bi(e,e.pendingProps,e.expirationTime)).return=t;n.sibling=null}return t.child}function ds(e,t,n){var i=t.expirationTime;if(null!==e&&e.memoizedProps===t.pendingProps&&!Ii.current&&(0===i||i>n)){switch(t.tag){case 3:as(t),Jr();break;case 5:Ar(t);break;case 1:Di(t.type)&&$i(t);break;case 4:wr(t,t.stateNode.containerInfo);break;case 10:gr(t,t.memoizedProps.value);break;case 13:if(null!==(i=t.memoizedState)&&i.didTimeout)return 0!==(i=t.child.childExpirationTime)&&i<=n?ls(e,t,n):null!==(t=cs(e,t,n))?t.sibling:null}return cs(e,t,n)}switch(t.expirationTime=0,t.tag){case 2:i=t.elementType,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps;var r=xi(t,Ai.current);if(vr(t),r=i(e,r),t.effectTag|=1,"object"==typeof r&&null!==r&&"function"==typeof r.render&&void 0===r.$$typeof){if(t.tag=1,Di(i)){var s=!0;$i(t)}else s=!1;t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null;var a=i.getDerivedStateFromProps;"function"==typeof a&&Dr(t,i,a,e),r.updater=Or,t.stateNode=r,r._reactInternalFiber=t,$r(t,i,e,n),t=os(null,t,i,!0,s,n)}else t.tag=0,Xr(null,t,r,n),t=t.child;return t;case 16:switch(r=t.elementType,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),s=t.pendingProps,e=function(e){var t=e._result;switch(e._status){case 1:return t;case 2:case 0:throw t;default:throw e._status=0,(t=(t=e._ctor)()).then(function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)},function(t){0===e._status&&(e._status=2,e._result=t)}),e._result=t,t}}(r),t.type=e,r=t.tag=function(e){if("function"==typeof e)return ji(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===it)return 11;if(e===st)return 14}return 2}(e),s=us(e,s),a=void 0,r){case 0:a=rs(null,t,e,s,n);break;case 1:a=ss(null,t,e,s,n);break;case 11:a=es(null,t,e,s,n);break;case 14:a=ts(null,t,e,us(e.type,s),i,n);break;default:o("283",e)}return a;case 0:return i=t.type,r=t.pendingProps,rs(e,t,i,r=t.elementType===i?r:us(i,r),n);case 1:return i=t.type,r=t.pendingProps,ss(e,t,i,r=t.elementType===i?r:us(i,r),n);case 3:return as(t),null===(i=t.updateQueue)&&o("282"),r=null!==(r=t.memoizedState)?r.element:null,ur(t,i,t.pendingProps,null,n),(i=t.memoizedState.element)===r?(Jr(),t=cs(e,t,n)):(r=t.stateNode,(r=(null===e||null===e.child)&&r.hydrate)&&(Gr=bi(t.stateNode.containerInfo),Br=t,r=Wr=!0),r?(t.effectTag|=2,t.child=jr(t,null,i,n)):(Xr(e,t,i,n),Jr()),t=t.child),t;case 5:return Ar(t),null===e&&Kr(t),i=t.type,r=t.pendingProps,s=null!==e?e.memoizedProps:null,a=r.children,Ti(i,r)?a=null:null!==s&&Ti(i,s)&&(t.effectTag|=16),is(e,t),1073741823!==n&&1&t.mode&&r.hidden?(t.expirationTime=1073741823,t=null):(Xr(e,t,a,n),t=t.child),t;case 6:return null===e&&Kr(t),null;case 13:return ls(e,t,n);case 4:return wr(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=Fr(t,null,i,n):Xr(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,es(e,t,i,r=t.elementType===i?r:us(i,r),n);case 7:return Xr(e,t,t.pendingProps,n),t.child;case 8:case 12:return Xr(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,a=t.memoizedProps,gr(t,s=r.value),null!==a){var u=a.value;if(0===(s=u===s&&(0!==u||1/u==1/s)||u!=u&&s!=s?0:0|("function"==typeof i._calculateChangedBits?i._calculateChangedBits(u,s):1073741823))){if(a.children===r.children&&!Ii.current){t=cs(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){if(null!==(u=a.firstContextDependency))do{if(u.context===i&&0!=(u.observedBits&s)){if(1===a.tag){var l=nr(n);l.tag=2,rr(a,l)}(0===a.expirationTime||a.expirationTime>n)&&(a.expirationTime=n),null!==(l=a.alternate)&&(0===l.expirationTime||l.expirationTime>n)&&(l.expirationTime=n);for(var c=a.return;null!==c;){if(l=c.alternate,0===c.childExpirationTime||c.childExpirationTime>n)c.childExpirationTime=n,null!==l&&(0===l.childExpirationTime||l.childExpirationTime>n)&&(l.childExpirationTime=n);else{if(null===l||!(0===l.childExpirationTime||l.childExpirationTime>n))break;l.childExpirationTime=n}c=c.return}}l=a.child,u=u.next}while(null!==u);else l=10===a.tag&&a.type===t.type?null:a.child;if(null!==l)l.return=a;else for(l=a;null!==l;){if(l===t){l=null;break}if(null!==(a=l.sibling)){a.return=l.return,l=a;break}l=l.return}a=l}}Xr(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=(s=t.pendingProps).children,vr(t),i=i(r=yr(r,s.unstable_observedBits)),t.effectTag|=1,Xr(e,t,i,n),t.child;case 14:return ts(e,t,r=t.type,s=us(r.type,t.pendingProps),i,n);case 15:return ns(e,t,t.type,t.pendingProps,i,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:us(i,r),null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),t.tag=1,Di(i)?(e=!0,$i(t)):e=!1,vr(t),Ur(t,i,r),$r(t,i,r,n),os(null,t,i,!0,e,n);default:o("156")}}function hs(e){e.effectTag|=4}var ps=void 0,fs=void 0,ms=void 0,gs=void 0;function Ts(e,t){var n=t.source,i=t.stack;null===i&&null!==n&&(i=ct(n)),null!==n&&lt(n.type),t=t.value,null!==e&&1===e.tag&&lt(e.type);try{console.error(t)}catch(e){setTimeout(function(){throw e})}}function vs(e){var t=e.ref;if(null!==t)if("function"==typeof t)try{t(null)}catch(t){Gs(e,t)}else t.current=null}function ys(e){switch("function"==typeof qi&&qi(e),e.tag){case 1:vs(e);var t=e.stateNode;if("function"==typeof t.componentWillUnmount)try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(t){Gs(e,t)}break;case 5:vs(e);break;case 4:Ss(e)}}function Es(e){return 5===e.tag||3===e.tag||4===e.tag}function bs(e){e:{for(var t=e.return;null!==t;){if(Es(t)){var n=t;break e}t=t.return}o("160"),n=void 0}var i=t=void 0;switch(n.tag){case 5:t=n.stateNode,i=!1;break;case 3:case 4:t=n.stateNode.containerInfo,i=!0;break;default:o("161")}16&n.effectTag&&(si(t,""),n.effectTag&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||Es(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag;){if(2&n.effectTag)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.effectTag)){n=n.stateNode;break e}}for(var r=e;;){if(5===r.tag||6===r.tag)if(n)if(i){var s=t,a=r.stateNode,u=n;8===s.nodeType?s.parentNode.insertBefore(a,u):s.insertBefore(a,u)}else t.insertBefore(r.stateNode,n);else i?(a=t,u=r.stateNode,8===a.nodeType?(s=a.parentNode).insertBefore(u,a):(s=a).appendChild(u),null!==(a=a._reactRootContainer)&&void 0!==a||null!==s.onclick||(s.onclick=pi)):t.appendChild(r.stateNode);else if(4!==r.tag&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===e)break;for(;null===r.sibling;){if(null===r.return||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}}function Ss(e){for(var t=e,n=!1,i=void 0,r=void 0;;){if(!n){n=t.return;e:for(;;){switch(null===n&&o("160"),n.tag){case 5:i=n.stateNode,r=!1;break e;case 3:case 4:i=n.stateNode.containerInfo,r=!0;break e}n=n.return}n=!0}if(5===t.tag||6===t.tag){e:for(var s=t,a=s;;)if(ys(a),null!==a.child&&4!==a.tag)a.child.return=a,a=a.child;else{if(a===s)break;for(;null===a.sibling;){if(null===a.return||a.return===s)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}r?(s=i,a=t.stateNode,8===s.nodeType?s.parentNode.removeChild(a):s.removeChild(a)):i.removeChild(t.stateNode)}else if(4===t.tag?(i=t.stateNode.containerInfo,r=!0):ys(t),null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return;4===(t=t.return).tag&&(n=!1)}t.sibling.return=t.return,t=t.sibling}}function _s(e,t){switch(t.tag){case 1:break;case 5:var n=t.stateNode;if(null!=n){var i=t.memoizedProps,r=null!==e?e.memoizedProps:i;e=t.type;var s=t.updateQueue;if(t.updateQueue=null,null!==s){for(n[$]=i,"input"===e&&"radio"===i.type&&null!=i.name&&_t(n,i),di(e,r),t=di(e,i),r=0;r<s.length;r+=2){var a=s[r],u=s[r+1];"style"===a?ui(n,u):"dangerouslySetInnerHTML"===a?ri(n,u):"children"===a?si(n,u):yt(n,a,u,t)}switch(e){case"input":Ct(n,i);break;case"textarea":Qn(n,i);break;case"select":e=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!i.multiple,null!=(s=i.value)?Yn(n,!!i.multiple,s,!1):e!==!!i.multiple&&(null!=i.defaultValue?Yn(n,!!i.multiple,i.defaultValue,!0):Yn(n,!!i.multiple,i.multiple?[]:"",!1))}}}break;case 6:null===t.stateNode&&o("162"),t.stateNode.nodeValue=t.memoizedProps;break;case 3:case 12:case 13:case 17:break;default:o("163")}}function Cs(e,t,n){(n=nr(n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){Oo(i),Ts(e,t)},n}function ws(e,t,n){(n=nr(n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"==typeof i){var r=t.value;n.payload=function(){return i(r)}}var s=e.stateNode;return null!==s&&"function"==typeof s.componentDidCatch&&(n.callback=function(){"function"!=typeof i&&(null===qs?qs=new Set([this]):qs.add(this));var n=t.value,r=t.stack;Ts(e,t),this.componentDidCatch(n,{componentStack:null!==r?r:""})}),n}function Rs(e){switch(e.tag){case 1:Di(e.type)&&Oi();var t=e.effectTag;return 1024&t?(e.effectTag=-1025&t|64,e):null;case 3:return Rr(),ki(),0!=(64&(t=e.effectTag))&&o("285"),e.effectTag=-1025&t|64,e;case 5:return Ir(e),null;case 13:if(1024&(t=e.effectTag)){e.effectTag=-1025&t|64,t=null!==(t=e.alternate)?t.memoizedState:null;var n=e.memoizedState;return null===n?n={alreadyCaptured:!0,didTimeout:!1,timedOutAt:0}:t===n?n={alreadyCaptured:!0,didTimeout:n.didTimeout,timedOutAt:n.timedOutAt}:n.alreadyCaptured=!0,e.memoizedState=n,e}return null;case 4:return Rr(),null;case 10:return Tr(e),null;default:return null}}ps=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},fs=function(){},ms=function(e,t,n,i,s){var o=e.memoizedProps;if(o!==i){var a=t.stateNode;switch(Cr(br.current),e=null,n){case"input":o=bt(a,o),i=bt(a,i),e=[];break;case"option":o=Kn(a,o),i=Kn(a,i),e=[];break;case"select":o=r({},o,{value:void 0}),i=r({},i,{value:void 0}),e=[];break;case"textarea":o=Zn(a,o),i=Zn(a,i),e=[];break;default:"function"!=typeof o.onClick&&"function"==typeof i.onClick&&(a.onclick=pi)}ci(n,i),a=n=void 0;var u=null;for(n in o)if(!i.hasOwnProperty(n)&&o.hasOwnProperty(n)&&null!=o[n])if("style"===n){var l=o[n];for(a in l)l.hasOwnProperty(a)&&(u||(u={}),u[a]="")}else"dangerouslySetInnerHTML"!==n&&"children"!==n&&"suppressContentEditableWarning"!==n&&"suppressHydrationWarning"!==n&&"autoFocus"!==n&&(y.hasOwnProperty(n)?e||(e=[]):(e=e||[]).push(n,null));for(n in i){var c=i[n];if(l=null!=o?o[n]:void 0,i.hasOwnProperty(n)&&c!==l&&(null!=c||null!=l))if("style"===n)if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(u||(u={}),u[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(u||(u={}),u[a]=c[a])}else u||(e||(e=[]),e.push(n,u)),u=c;else"dangerouslySetInnerHTML"===n?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(e=e||[]).push(n,""+c)):"children"===n?l===c||"string"!=typeof c&&"number"!=typeof c||(e=e||[]).push(n,""+c):"suppressContentEditableWarning"!==n&&"suppressHydrationWarning"!==n&&(y.hasOwnProperty(n)?(null!=c&&hi(s,n),e||l===c||(e=[])):(e=e||[]).push(n,c))}u&&(e=e||[]).push("style",u),s=e,(t.updateQueue=s)&&hs(t)}},gs=function(e,t,n,i){n!==i&&hs(t)};var As={readContext:yr},Is=ze.ReactCurrentOwner,Ns=0,xs=0,Ds=!1,Os=null,ks=null,Us=0,Ps=-1,$s=!1,Hs=null,Ms=!1,qs=null;function Ls(){if(null!==Os)for(var e=Os.return;null!==e;){var t=e;switch(t.tag){case 1:var n=t.type.childContextTypes;null!==n&&void 0!==n&&Oi();break;case 3:Rr(),ki();break;case 5:Ir(t);break;case 4:Rr();break;case 10:Tr(t)}e=e.return}ks=null,Us=0,Ps=-1,$s=!1,Os=null}function Fs(e){for(;;){var t=e.alternate,n=e.return,i=e.sibling;if(0==(512&e.effectTag)){var s=t,a=(t=e).pendingProps;switch(t.tag){case 2:case 16:break;case 15:case 0:break;case 1:Di(t.type)&&Oi();break;case 3:Rr(),ki(),(a=t.stateNode).pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),null!==s&&null!==s.child||(Zr(t),t.effectTag&=-3),fs(t);break;case 5:Ir(t);var u=Cr(_r.current),l=t.type;if(null!==s&&null!=t.stateNode)ms(s,t,l,a,u),s.ref!==t.ref&&(t.effectTag|=128);else if(a){var c=Cr(br.current);if(Zr(t)){s=(a=t).stateNode;var d=a.type,h=a.memoizedProps,p=u;switch(s[P]=a,s[$]=h,l=void 0,u=d){case"iframe":case"object":An("load",s);break;case"video":case"audio":for(d=0;d<ie.length;d++)An(ie[d],s);break;case"source":An("error",s);break;case"img":case"image":case"link":An("error",s),An("load",s);break;case"form":An("reset",s),An("submit",s);break;case"details":An("toggle",s);break;case"input":St(s,h),An("invalid",s),hi(p,"onChange");break;case"select":s._wrapperState={wasMultiple:!!h.multiple},An("invalid",s),hi(p,"onChange");break;case"textarea":Jn(s,h),An("invalid",s),hi(p,"onChange")}for(l in ci(u,h),d=null,h)h.hasOwnProperty(l)&&(c=h[l],"children"===l?"string"==typeof c?s.textContent!==c&&(d=["children",c]):"number"==typeof c&&s.textContent!==""+c&&(d=["children",""+c]):y.hasOwnProperty(l)&&null!=c&&hi(p,l));switch(u){case"input":Ge(s),wt(s,h,!0);break;case"textarea":Ge(s),Xn(s);break;case"select":case"option":break;default:"function"==typeof h.onClick&&(s.onclick=pi)}l=d,a.updateQueue=l,(a=null!==l)&&hs(t)}else{h=t,s=l,p=a,d=9===u.nodeType?u:u.ownerDocument,c===ei.html&&(c=ti(s)),c===ei.html?"script"===s?((s=d.createElement("div")).innerHTML="<script><\/script>",d=s.removeChild(s.firstChild)):"string"==typeof p.is?d=d.createElement(s,{is:p.is}):(d=d.createElement(s),"select"===s&&p.multiple&&(d.multiple=!0)):d=d.createElementNS(c,s),(s=d)[P]=h,s[$]=a,ps(s,t,!1,!1),p=s;var f=u,m=di(d=l,h=a);switch(d){case"iframe":case"object":An("load",p),u=h;break;case"video":case"audio":for(u=0;u<ie.length;u++)An(ie[u],p);u=h;break;case"source":An("error",p),u=h;break;case"img":case"image":case"link":An("error",p),An("load",p),u=h;break;case"form":An("reset",p),An("submit",p),u=h;break;case"details":An("toggle",p),u=h;break;case"input":St(p,h),u=bt(p,h),An("invalid",p),hi(f,"onChange");break;case"option":u=Kn(p,h);break;case"select":p._wrapperState={wasMultiple:!!h.multiple},u=r({},h,{value:void 0}),An("invalid",p),hi(f,"onChange");break;case"textarea":Jn(p,h),u=Zn(p,h),An("invalid",p),hi(f,"onChange");break;default:u=h}ci(d,u),c=void 0;var g=d,T=p,v=u;for(c in v)if(v.hasOwnProperty(c)){var E=v[c];"style"===c?ui(T,E):"dangerouslySetInnerHTML"===c?null!=(E=E?E.__html:void 0)&&ri(T,E):"children"===c?"string"==typeof E?("textarea"!==g||""!==E)&&si(T,E):"number"==typeof E&&si(T,""+E):"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&"autoFocus"!==c&&(y.hasOwnProperty(c)?null!=E&&hi(f,c):null!=E&&yt(T,c,E,m))}switch(d){case"input":Ge(p),wt(p,h,!1);break;case"textarea":Ge(p),Xn(p);break;case"option":null!=h.value&&p.setAttribute("value",""+Et(h.value));break;case"select":(u=p).multiple=!!h.multiple,null!=(p=h.value)?Yn(u,!!h.multiple,p,!1):null!=h.defaultValue&&Yn(u,!!h.multiple,h.defaultValue,!0);break;default:"function"==typeof u.onClick&&(p.onclick=pi)}(a=gi(l,a))&&hs(t),t.stateNode=s}null!==t.ref&&(t.effectTag|=128)}else null===t.stateNode&&o("166");break;case 6:s&&null!=t.stateNode?gs(s,t,s.memoizedProps,a):("string"!=typeof a&&(null===t.stateNode&&o("166")),s=Cr(_r.current),Cr(br.current),Zr(t)?(l=(a=t).stateNode,s=a.memoizedProps,l[P]=a,(a=l.nodeValue!==s)&&hs(t)):(l=t,(a=(9===s.nodeType?s:s.ownerDocument).createTextNode(a))[P]=t,l.stateNode=a));break;case 11:break;case 13:a=t.memoizedState,l=null!==s?s.memoizedState:null,(null!==a&&a.didTimeout)!==(null!==l&&l.didTimeout)&&(t.effectTag|=4);break;case 7:case 8:case 12:break;case 4:Rr(),fs(t);break;case 10:Tr(t);break;case 9:case 14:break;case 17:Di(t.type)&&Oi();break;default:o("156")}if(Os=null,t=e,1073741823===Us||1073741823!==t.childExpirationTime){for(a=0,l=t.child;null!==l;)s=l.expirationTime,u=l.childExpirationTime,(0===a||0!==s&&s<a)&&(a=s),(0===a||0!==u&&u<a)&&(a=u),l=l.sibling;t.childExpirationTime=a}null!==n&&0==(512&n.effectTag)&&(null===n.firstEffect&&(n.firstEffect=e.firstEffect),null!==e.lastEffect&&(null!==n.lastEffect&&(n.lastEffect.nextEffect=e.firstEffect),n.lastEffect=e.lastEffect),1<e.effectTag&&(null!==n.lastEffect?n.lastEffect.nextEffect=e:n.firstEffect=e,n.lastEffect=e))}else{if(null!==(e=Rs(e)))return e.effectTag&=511,e;null!==n&&(n.firstEffect=n.lastEffect=null,n.effectTag|=512)}if(null!==i)return i;if(null===n)break;e=n}return null}function js(e){var t=ds(e.alternate,e,Us);return e.memoizedProps=e.pendingProps,null===t&&(t=Fs(e)),Is.current=null,t}function Bs(e,t,n){Ds&&o("243"),Ds=!0,Is.currentDispatcher=As;var i=e.nextExpirationTimeToWorkOn;i===Us&&e===ks&&null!==Os||(Ls(),Us=i,Os=Bi((ks=e).current,null),e.pendingCommitExpirationTime=0);for(var r=!1;;){try{if(t)for(;null!==Os&&!Do();)Os=js(Os);else for(;null!==Os;)Os=js(Os)}catch(t){if(null===Os)r=!0,Oo(t);else{null===Os&&o("271");var s=Os,a=s.return;if(null!==a){e:{var u=e,l=a,c=s,d=t;if(a=Us,c.effectTag|=512,c.firstEffect=c.lastEffect=null,null!==d&&"object"==typeof d&&"function"==typeof d.then){var h=d;d=l;var p=-1,f=-1;do{if(13===d.tag){var m=d.alternate;if(null!==m&&(null!==(m=m.memoizedState)&&m.didTimeout)){f=10*(m.timedOutAt-2);break}"number"==typeof(m=d.pendingProps.maxDuration)&&(0>=m?p=0:(-1===p||m<p)&&(p=m))}d=d.return}while(null!==d);d=l;do{if((m=13===d.tag)&&(void 0===d.memoizedProps.fallback?m=!1:m=null===(m=d.memoizedState)||!m.didTimeout),m){if(l=zs.bind(null,u,d,c,0==(1&d.mode)?1:a),h.then(l,l),0==(1&d.mode)){d.effectTag|=32,Xr(c.alternate,c,null,a),c.effectTag&=-513,1===c.tag&&(c.effectTag&=-421,null===c.alternate&&(c.tag=17));break e}-1===p?u=1073741823:(-1===f&&(f=10*(Ji(u,a)-2)-5e3),u=f+p),0<=u&&Ps<u&&(Ps=u),d.effectTag|=1024,d.expirationTime=a;break e}d=d.return}while(null!==d);d=Error("An update was suspended, but no placeholder UI was provided.")}$s=!0,d=dr(d,c),u=l;do{switch(u.tag){case 3:c=d,u.effectTag|=1024,u.expirationTime=a,sr(u,a=Cs(u,c,a));break e;case 1:if(c=d,l=u.type,h=u.stateNode,0==(64&u.effectTag)&&("function"==typeof l.getDerivedStateFromError||null!==h&&"function"==typeof h.componentDidCatch&&(null===qs||!qs.has(h)))){u.effectTag|=1024,u.expirationTime=a,sr(u,a=ws(u,c,a));break e}}u=u.return}while(null!==u)}Os=Fs(s);continue}r=!0,Oo(t)}}break}if(Ds=!1,mr=fr=pr=Is.currentDispatcher=null,r)ks=null,e.finishedWork=null;else if(null!==Os)e.finishedWork=null;else{if(null===(t=e.current.alternate)&&o("281"),ks=null,$s){if(r=e.latestPendingTime,s=e.latestSuspendedTime,a=e.latestPingedTime,0!==r&&r>i||0!==s&&s>i||0!==a&&a>i)return Zi(e,i),void So(e,t,i,e.expirationTime,-1);if(!e.didError&&!n)return e.didError=!0,i=e.nextExpirationTimeToWorkOn=i,n=e.expirationTime=1,void So(e,t,i,n,-1)}n||-1===Ps?(e.pendingCommitExpirationTime=i,e.finishedWork=t):(Zi(e,i),(n=10*(Ji(e,i)-2))<Ps&&(Ps=n),n=10*(_o()-2),n=Ps-n,So(e,t,i,e.expirationTime,0>n?0:n))}}function Gs(e,t){var n;e:{for(Ds&&!Ms&&o("263"),n=e.return;null!==n;){switch(n.tag){case 1:var i=n.stateNode;if("function"==typeof n.type.getDerivedStateFromError||"function"==typeof i.componentDidCatch&&(null===qs||!qs.has(i))){rr(n,e=ws(n,e=dr(t,e),1)),Ks(n,1),n=void 0;break e}break;case 3:rr(n,e=Cs(n,e=dr(t,e),1)),Ks(n,1),n=void 0;break e}n=n.return}3===e.tag&&(rr(e,n=Cs(e,n=dr(t,e),1)),Ks(e,1)),n=void 0}return n}function Ws(e,t){return 0!==xs?e=xs:Ds?e=Ms?1:Us:1&t.mode?(e=co?2+10*(1+((e-2+15)/10|0)):2+25*(1+((e-2+500)/25|0)),null!==ks&&e===Us&&(e+=1)):e=1,co&&e>io&&(io=e),e}function zs(e,t,n,i){var r=e.earliestSuspendedTime,s=e.latestSuspendedTime;if(0!==r&&i>=r&&i<=s){s=r=i,e.didError=!1;var o=e.latestPingedTime;(0===o||o<s)&&(e.latestPingedTime=s),Qi(s,e)}else Yi(e,r=Ws(r=_o(),t));0!=(1&t.mode)&&e===ks&&Us===i&&(ks=null),Vs(t,r),0==(1&t.mode)&&(Vs(n,r),1===n.tag&&null!==n.stateNode&&((t=nr(r)).tag=2,rr(n,t))),0!==(n=e.expirationTime)&&Co(e,n)}function Vs(e,t){(0===e.expirationTime||e.expirationTime>t)&&(e.expirationTime=t);var n=e.alternate;null!==n&&(0===n.expirationTime||n.expirationTime>t)&&(n.expirationTime=t);var i=e.return,r=null;if(null===i&&3===e.tag)r=e.stateNode;else for(;null!==i;){if(n=i.alternate,(0===i.childExpirationTime||i.childExpirationTime>t)&&(i.childExpirationTime=t),null!==n&&(0===n.childExpirationTime||n.childExpirationTime>t)&&(n.childExpirationTime=t),null===i.return&&3===i.tag){r=i.stateNode;break}i=i.return}return null===r?null:r}function Ks(e,t){null!==(e=Vs(e,t))&&(!Ds&&0!==Us&&t<Us&&Ls(),Yi(e,t),Ds&&!Ms&&ks===e||Co(e,e.expirationTime),To>go&&(To=0,o("185")))}function Ys(e,t,n,i,r){var s=xs;xs=1;try{return e(t,n,i,r)}finally{xs=s}}var Zs=null,Js=null,Qs=0,Xs=void 0,eo=!1,to=null,no=0,io=0,ro=!1,so=!1,oo=null,ao=null,uo=!1,lo=!1,co=!1,ho=null,po=s.unstable_now(),fo=2+(po/10|0),mo=fo,go=50,To=0,vo=null,yo=1;function Eo(){fo=2+((s.unstable_now()-po)/10|0)}function bo(e,t){if(0!==Qs){if(t>Qs)return;null!==Xs&&s.unstable_cancelCallback(Xs)}Qs=t,e=s.unstable_now()-po,Xs=s.unstable_scheduleCallback(Ro,{timeout:10*(t-2)-e})}function So(e,t,n,i,r){e.expirationTime=i,0!==r||Do()?0<r&&(e.timeoutHandle=vi(function(e,t,n){e.pendingCommitExpirationTime=n,e.finishedWork=t,Eo(),mo=fo,Io(e,n)}.bind(null,e,t,n),r)):(e.pendingCommitExpirationTime=n,e.finishedWork=t)}function _o(){return eo?mo:(wo(),0!==no&&1073741823!==no||(Eo(),mo=fo),mo)}function Co(e,t){if(null===e.nextScheduledRoot)e.expirationTime=t,null===Js?(Zs=Js=e,e.nextScheduledRoot=e):(Js=Js.nextScheduledRoot=e).nextScheduledRoot=Zs;else{var n=e.expirationTime;(0===n||t<n)&&(e.expirationTime=t)}eo||(uo?lo&&(to=e,no=1,No(e,1,!0)):1===t?Ao(1,null):bo(e,t))}function wo(){var e=0,t=null;if(null!==Js)for(var n=Js,i=Zs;null!==i;){var r=i.expirationTime;if(0===r){if((null===n||null===Js)&&o("244"),i===i.nextScheduledRoot){Zs=Js=i.nextScheduledRoot=null;break}if(i===Zs)Zs=r=i.nextScheduledRoot,Js.nextScheduledRoot=r,i.nextScheduledRoot=null;else{if(i===Js){(Js=n).nextScheduledRoot=Zs,i.nextScheduledRoot=null;break}n.nextScheduledRoot=i.nextScheduledRoot,i.nextScheduledRoot=null}i=n.nextScheduledRoot}else{if((0===e||r<e)&&(e=r,t=i),i===Js)break;if(1===e)break;n=i,i=i.nextScheduledRoot}}to=t,no=e}function Ro(e){if(e.didTimeout&&null!==Zs){Eo();var t=Zs;do{var n=t.expirationTime;0!==n&&fo>=n&&(t.nextExpirationTimeToWorkOn=fo),t=t.nextScheduledRoot}while(t!==Zs)}Ao(0,e)}function Ao(e,t){if(ao=t,wo(),null!==ao)for(Eo(),mo=fo;null!==to&&0!==no&&(0===e||e>=no)&&(!ro||fo>=no);)No(to,no,fo>=no),wo(),Eo(),mo=fo;else for(;null!==to&&0!==no&&(0===e||e>=no);)No(to,no,!0),wo();if(null!==ao&&(Qs=0,Xs=null),0!==no&&bo(to,no),ao=null,ro=!1,To=0,vo=null,null!==ho)for(e=ho,ho=null,t=0;t<e.length;t++){var n=e[t];try{n._onComplete()}catch(e){so||(so=!0,oo=e)}}if(so)throw e=oo,oo=null,so=!1,e}function Io(e,t){eo&&o("253"),to=e,no=t,No(e,t,!0),Ao(1,null)}function No(e,t,n){if(eo&&o("245"),eo=!0,null===ao||n){var i=e.finishedWork;null!==i?xo(e,i,t):(e.finishedWork=null,-1!==(i=e.timeoutHandle)&&(e.timeoutHandle=-1,yi(i)),Bs(e,!1,n),null!==(i=e.finishedWork)&&xo(e,i,t))}else null!==(i=e.finishedWork)?xo(e,i,t):(e.finishedWork=null,-1!==(i=e.timeoutHandle)&&(e.timeoutHandle=-1,yi(i)),Bs(e,!0,n),null!==(i=e.finishedWork)&&(Do()?e.finishedWork=i:xo(e,i,t)));eo=!1}function xo(e,t,n){var i=e.firstBatch;if(null!==i&&i._expirationTime<=n&&(null===ho?ho=[i]:ho.push(i),i._defer))return e.finishedWork=t,void(e.expirationTime=0);e.finishedWork=null,e===vo?To++:(vo=e,To=0),Ms=Ds=!0,e.current===t&&o("177");var r=e.pendingCommitExpirationTime;0===r&&o("261"),e.pendingCommitExpirationTime=0;var s=t.expirationTime,a=t.childExpirationTime,u=0===s||0!==a&&a<s?a:s;if(e.didError=!1,0===u)e.earliestPendingTime=0,e.latestPendingTime=0,e.earliestSuspendedTime=0,e.latestSuspendedTime=0,e.latestPingedTime=0;else{var l=e.latestPendingTime;0!==l&&(l<u?e.earliestPendingTime=e.latestPendingTime=0:e.earliestPendingTime<u&&(e.earliestPendingTime=e.latestPendingTime));var c=e.earliestSuspendedTime;0===c?Yi(e,u):u>e.latestSuspendedTime?(e.earliestSuspendedTime=0,e.latestSuspendedTime=0,e.latestPingedTime=0,Yi(e,u)):u<c&&Yi(e,u)}if(Qi(0,e),Is.current=null,1<t.effectTag)if(null!==t.lastEffect){t.lastEffect.nextEffect=t;var d=t.firstEffect}else d=t;else d=t.firstEffect;fi=Rn;var h=Mn();if(qn(h)){if("selectionStart"in h)var p={start:h.selectionStart,end:h.selectionEnd};else e:{var f=h.ownerDocument,m=f&&f.defaultView||window,g=m.getSelection&&m.getSelection();if(g&&0!==g.rangeCount){var T=g.anchorNode,v=g.anchorOffset,y=g.focusNode,E=g.focusOffset;try{T.nodeType,y.nodeType}catch(e){p=null;break e}var b=0,S=-1,_=-1,C=0,w=0,R=h,A=null;t:for(;;){for(var I;R!==T||0!==v&&3!==R.nodeType||(S=b+v),R!==y||0!==E&&3!==R.nodeType||(_=b+E),3===R.nodeType&&(b+=R.nodeValue.length),null!==(I=R.firstChild);)A=R,R=I;for(;;){if(R===h)break t;if(A===T&&++C===v&&(S=b),A===y&&++w===E&&(_=b),null!==(I=R.nextSibling))break;A=(R=A).parentNode}R=I}p=-1===S||-1===_?null:{start:S,end:_}}else p=null}var N=p||{start:0,end:0}}else N=null;for(mi={focusedElem:h,selectionRange:N},Rn=!1,Hs=d;null!==Hs;){var x=!1,D=void 0;try{for(;null!==Hs;){if(256&Hs.effectTag){var O=Hs.alternate;e:{var k=Hs;switch(k.tag){case 1:if(256&k.effectTag&&null!==O){var U=O.memoizedProps,P=O.memoizedState,$=k.stateNode;$.props=k.memoizedProps,$.state=k.memoizedState;var H=$.getSnapshotBeforeUpdate(U,P);$.__reactInternalSnapshotBeforeUpdate=H}break e;case 3:case 5:case 6:case 4:case 17:break e;default:o("163")}}}Hs=Hs.nextEffect}}catch(e){x=!0,D=e}x&&(null===Hs&&o("178"),Gs(Hs,D),null!==Hs&&(Hs=Hs.nextEffect))}for(Hs=d;null!==Hs;){var M=!1,q=void 0;try{for(;null!==Hs;){var L=Hs.effectTag;if(16&L&&si(Hs.stateNode,""),128&L){var F=Hs.alternate;if(null!==F){var j=F.ref;null!==j&&("function"==typeof j?j(null):j.current=null)}}switch(14&L){case 2:bs(Hs),Hs.effectTag&=-3;break;case 6:bs(Hs),Hs.effectTag&=-3,_s(Hs.alternate,Hs);break;case 4:_s(Hs.alternate,Hs);break;case 8:var B=Hs;Ss(B);var G=B;G.return=null,G.child=null,G.alternate&&(G.alternate.child=null,G.alternate.return=null)}Hs=Hs.nextEffect}}catch(e){M=!0,q=e}M&&(null===Hs&&o("178"),Gs(Hs,q),null!==Hs&&(Hs=Hs.nextEffect))}var W=mi,z=Mn(),V=W.focusedElem,K=W.selectionRange;if(z!==V&&V&&V.ownerDocument&&function e(t,n){return!(!t||!n)&&(t===n||(!t||3!==t.nodeType)&&(n&&3===n.nodeType?e(t,n.parentNode):"contains"in t?t.contains(n):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(n))))}(V.ownerDocument.documentElement,V)){if(null!==K&&qn(V)){var Y=K.start,Z=K.end;if(void 0===Z&&(Z=Y),"selectionStart"in V)V.selectionStart=Y,V.selectionEnd=Math.min(Z,V.value.length);else{var J=V.ownerDocument||document,Q=(J&&J.defaultView||window).getSelection(),X=V.textContent.length,ee=Math.min(K.start,X),te=void 0===K.end?ee:Math.min(K.end,X);if(!Q.extend&&ee>te){var ne=te;te=ee,ee=ne}var ie=Hn(V,ee),re=Hn(V,te);if(ie&&re&&(1!==Q.rangeCount||Q.anchorNode!==ie.node||Q.anchorOffset!==ie.offset||Q.focusNode!==re.node||Q.focusOffset!==re.offset)){var se=J.createRange();se.setStart(ie.node,ie.offset),Q.removeAllRanges(),ee>te?(Q.addRange(se),Q.extend(re.node,re.offset)):(se.setEnd(re.node,re.offset),Q.addRange(se))}}}for(var oe=[],ae=V;ae=ae.parentNode;)1===ae.nodeType&&oe.push({element:ae,left:ae.scrollLeft,top:ae.scrollTop});"function"==typeof V.focus&&V.focus();for(var ue=0;ue<oe.length;ue++){var le=oe[ue];le.element.scrollLeft=le.left,le.element.scrollTop=le.top}}for(mi=null,Rn=!!fi,fi=null,e.current=t,Hs=d;null!==Hs;){var ce=!1,de=void 0;try{for(;null!==Hs;){var he=Hs.effectTag;if(36&he){var pe=void 0,fe=Hs.alternate,me=Hs;switch(me.tag){case 1:var ge=me.stateNode;if(4&me.effectTag)if(null===fe)ge.props=me.memoizedProps,ge.state=me.memoizedState,ge.componentDidMount();else{var Te=fe.memoizedProps,ve=fe.memoizedState;ge.props=me.memoizedProps,ge.state=me.memoizedState,ge.componentDidUpdate(Te,ve,ge.__reactInternalSnapshotBeforeUpdate)}var ye=me.updateQueue;null!==ye&&(ge.props=me.memoizedProps,ge.state=me.memoizedState,lr(0,ye,ge));break;case 3:var Ee=me.updateQueue;if(null!==Ee){var be=null;if(null!==me.child)switch(me.child.tag){case 5:be=me.child.stateNode;break;case 1:be=me.child.stateNode}lr(0,Ee,be)}break;case 5:var Se=me.stateNode;null===fe&&4&me.effectTag&&gi(me.type,me.memoizedProps)&&Se.focus();break;case 6:case 4:case 12:break;case 13:if(32&me.effectTag){me.memoizedState={alreadyCaptured:!0,didTimeout:!1,timedOutAt:0},Ks(me,1);break}var _e=null!==fe?fe.memoizedState:null,Ce=me.memoizedState,we=null!==_e&&_e.didTimeout,Re=me;if(null===Ce?pe=!1:(pe=Ce.didTimeout)&&(Re=me.child,Ce.alreadyCaptured=!1,0===Ce.timedOutAt&&(Ce.timedOutAt=_o())),pe!==we&&null!==Re)e:for(var Ae=Re,Ie=pe,Ne=Ae;;){if(5===Ne.tag){var xe=Ne.stateNode;if(Ie)xe.style.display="none";else{var De=Ne.stateNode,Oe=Ne.memoizedProps.style,ke=void 0!==Oe&&null!==Oe&&Oe.hasOwnProperty("display")?Oe.display:null;De.style.display=ke}}else if(6===Ne.tag)Ne.stateNode.nodeValue=Ie?"":Ne.memoizedProps;else if(null!==Ne.child){Ne.child.return=Ne,Ne=Ne.child;continue}if(Ne===Ae)break e;for(;null===Ne.sibling;){if(null===Ne.return||Ne.return===Ae)break e;Ne=Ne.return}Ne.sibling.return=Ne.return,Ne=Ne.sibling}break;case 17:break;default:o("163")}}if(128&he){var Ue=Hs.ref;if(null!==Ue){var Pe=Hs.stateNode;switch(Hs.tag){case 5:var $e=Pe;break;default:$e=Pe}"function"==typeof Ue?Ue($e):Ue.current=$e}}var He=Hs.nextEffect;Hs.nextEffect=null,Hs=He}}catch(e){ce=!0,de=e}ce&&(null===Hs&&o("178"),Gs(Hs,de),null!==Hs&&(Hs=Hs.nextEffect))}Ds=Ms=!1,"function"==typeof Mi&&Mi(t.stateNode);var Me=t.expirationTime,qe=t.childExpirationTime,Le=0===Me||0!==qe&&qe<Me?qe:Me;0===Le&&(qs=null),e.expirationTime=Le,e.finishedWork=null}function Do(){return!!ro||!(null===ao||ao.timeRemaining()>yo)&&(ro=!0)}function Oo(e){null===to&&o("246"),to.expirationTime=0,so||(so=!0,oo=e)}function ko(e,t){var n=uo;uo=!0;try{return e(t)}finally{(uo=n)||eo||Ao(1,null)}}function Uo(e,t){if(uo&&!lo){lo=!0;try{return e(t)}finally{lo=!1}}return e(t)}function Po(e,t,n){if(co)return e(t,n);uo||eo||0===io||(Ao(io,null),io=0);var i=co,r=uo;uo=co=!0;try{return e(t,n)}finally{co=i,(uo=r)||eo||Ao(1,null)}}function $o(e,t,n,i,r){var s=t.current;e:if(n){n=n._reactInternalFiber;t:{2===rn(n)&&1===n.tag||o("170");var a=n;do{switch(a.tag){case 3:a=a.stateNode.context;break t;case 1:if(Di(a.type)){a=a.stateNode.__reactInternalMemoizedMergedChildContext;break t}}a=a.return}while(null!==a);o("171"),a=void 0}if(1===n.tag){var u=n.type;if(Di(u)){n=Pi(n,u,a);break e}}n=a}else n=Ri;return null===t.context?t.context=n:t.pendingContext=n,t=r,(r=nr(i)).payload={element:e},null!==(t=void 0===t?null:t)&&(r.callback=t),rr(s,r),Ks(s,i),i}function Ho(e,t,n,i){var r=t.current;return $o(e,t,n,r=Ws(_o(),r),i)}function Mo(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 5:default:return e.child.stateNode}}function qo(e){var t=2+25*(1+((_o()-2+500)/25|0));t<=Ns&&(t=Ns+1),this._expirationTime=Ns=t,this._root=e,this._callbacks=this._next=null,this._hasChildren=this._didComplete=!1,this._children=null,this._defer=!0}function Lo(){this._callbacks=null,this._didCommit=!1,this._onCommit=this._onCommit.bind(this)}function Fo(e,t,n){e={current:t=Fi(3,null,null,t?3:0),containerInfo:e,pendingChildren:null,earliestPendingTime:0,latestPendingTime:0,earliestSuspendedTime:0,latestSuspendedTime:0,latestPingedTime:0,didError:!1,pendingCommitExpirationTime:0,finishedWork:null,timeoutHandle:-1,context:null,pendingContext:null,hydrate:n,nextExpirationTimeToWorkOn:0,expirationTime:0,firstBatch:null,nextScheduledRoot:null},this._internalRoot=t.stateNode=e}function jo(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Bo(e,t,n,i,r){jo(n)||o("200");var s=n._reactRootContainer;if(s){if("function"==typeof r){var a=r;r=function(){var e=Mo(s._internalRoot);a.call(e)}}null!=e?s.legacy_renderSubtreeIntoContainer(e,t,r):s.render(t,r)}else{if(s=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new Fo(e,!1,t)}(n,i),"function"==typeof r){var u=r;r=function(){var e=Mo(s._internalRoot);u.call(e)}}Uo(function(){null!=e?s.legacy_renderSubtreeIntoContainer(e,t,r):s.render(t,r)})}return Mo(s._internalRoot)}function Go(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return jo(t)||o("200"),function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:Ze,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)}Ie=function(e,t,n){switch(t){case"input":if(Ct(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=L(i);r||o("90"),We(i),Ct(i,r)}}}break;case"textarea":Qn(e,n);break;case"select":null!=(t=n.value)&&Yn(e,!!n.multiple,t,!1)}},qo.prototype.render=function(e){this._defer||o("250"),this._hasChildren=!0,this._children=e;var t=this._root._internalRoot,n=this._expirationTime,i=new Lo;return $o(e,t,null,n,i._onCommit),i},qo.prototype.then=function(e){if(this._didComplete)e();else{var t=this._callbacks;null===t&&(t=this._callbacks=[]),t.push(e)}},qo.prototype.commit=function(){var e=this._root._internalRoot,t=e.firstBatch;if(this._defer&&null!==t||o("251"),this._hasChildren){var n=this._expirationTime;if(t!==this){this._hasChildren&&(n=this._expirationTime=t._expirationTime,this.render(this._children));for(var i=null,r=t;r!==this;)i=r,r=r._next;null===i&&o("251"),i._next=r._next,this._next=t,e.firstBatch=this}this._defer=!1,Io(e,n),t=this._next,this._next=null,null!==(t=e.firstBatch=t)&&t._hasChildren&&t.render(t._children)}else this._next=null,this._defer=!1},qo.prototype._onComplete=function(){if(!this._didComplete){this._didComplete=!0;var e=this._callbacks;if(null!==e)for(var t=0;t<e.length;t++)(0,e[t])()}},Lo.prototype.then=function(e){if(this._didCommit)e();else{var t=this._callbacks;null===t&&(t=this._callbacks=[]),t.push(e)}},Lo.prototype._onCommit=function(){if(!this._didCommit){this._didCommit=!0;var e=this._callbacks;if(null!==e)for(var t=0;t<e.length;t++){var n=e[t];"function"!=typeof n&&o("191",n),n()}}},Fo.prototype.render=function(e,t){var n=this._internalRoot,i=new Lo;return null!==(t=void 0===t?null:t)&&i.then(t),Ho(e,n,null,i._onCommit),i},Fo.prototype.unmount=function(e){var t=this._internalRoot,n=new Lo;return null!==(e=void 0===e?null:e)&&n.then(e),Ho(null,t,null,n._onCommit),n},Fo.prototype.legacy_renderSubtreeIntoContainer=function(e,t,n){var i=this._internalRoot,r=new Lo;return null!==(n=void 0===n?null:n)&&r.then(n),Ho(t,i,e,r._onCommit),r},Fo.prototype.createBatch=function(){var e=new qo(this),t=e._expirationTime,n=this._internalRoot,i=n.firstBatch;if(null===i)n.firstBatch=e,e._next=null;else{for(n=null;null!==i&&i._expirationTime<=t;)n=i,i=i._next;e._next=i,null!==n&&(n._next=e)}return e},Ue=ko,Pe=Po,$e=function(){eo||0===io||(Ao(io,null),io=0)};var Wo={createPortal:Go,findDOMNode:function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternalFiber;return void 0===t&&("function"==typeof e.render?o("188"):o("268",Object.keys(e))),e=null===(e=on(t))?null:e.stateNode},hydrate:function(e,t,n){return Bo(null,e,t,!0,n)},render:function(e,t,n){return Bo(null,e,t,!1,n)},unstable_renderSubtreeIntoContainer:function(e,t,n,i){return(null==e||void 0===e._reactInternalFiber)&&o("38"),Bo(e,t,n,!1,i)},unmountComponentAtNode:function(e){return jo(e)||o("40"),!!e._reactRootContainer&&(Uo(function(){Bo(null,null,e,!1,function(){e._reactRootContainer=null})}),!0)},unstable_createPortal:function(){return Go.apply(void 0,arguments)},unstable_batchedUpdates:ko,unstable_interactiveUpdates:Po,flushSync:function(e,t){eo&&o("187");var n=uo;uo=!0;try{return Ys(e,t)}finally{uo=n,Ao(1,null)}},unstable_flushControlled:function(e){var t=uo;uo=!0;try{Ys(e)}finally{(uo=t)||eo||Ao(1,null)}},__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{Events:[M,q,L,D.injectEventPluginsByName,v,z,function(e){R(e,W)},Oe,ke,xn,k]},unstable_createRoot:function(e,t){return jo(e)||o("278"),new Fo(e,!0,null!=t&&!0===t.hydrate)}};!function(e){var t=e.findFiberByHostInstance;(function(e){if("undefined"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)return!0;try{var n=t.inject(e);Mi=Li(function(e){return t.onCommitFiberRoot(n,e)}),qi=Li(function(e){return t.onCommitFiberUnmount(n,e)})}catch(e){}})(r({},e,{findHostInstanceByFiber:function(e){return null===(e=on(e))?null:e.stateNode},findFiberByHostInstance:function(e){return t?t(e):null}}))}({findFiberByHostInstance:H,bundleType:0,version:"16.6.0",rendererPackageName:"react-dom"});var zo={default:Wo},Vo=zo&&Wo||zo;e.exports=Vo.default||Vo},function(e,t,n){"use strict";e.exports=n(7)},function(e,t,n){"use strict";
/** @license React v16.6.0
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */Object.defineProperty(t,"__esModule",{value:!0});var i=null,r=3,s=-1,o=-1,a=!1,u=!1,l="object"==typeof performance&&"function"==typeof performance.now,c={timeRemaining:l?function(){if(null!==i&&i.expirationTime<o)return 0;var e=y()-performance.now();return 0<e?e:0}:function(){if(null!==i&&i.expirationTime<o)return 0;var e=y()-Date.now();return 0<e?e:0},didTimeout:!1};function d(){if(!a){var e=i.expirationTime;u?v():u=!0,T(f,e)}}function h(){var e=i,t=i.next;if(i===t)i=null;else{var n=i.previous;i=n.next=t,t.previous=n}e.next=e.previous=null,n=e.callback,t=e.expirationTime,e=e.priorityLevel;var s=r,a=o;r=e,o=t;try{var u=n(c)}finally{r=s,o=a}if("function"==typeof u)if(u={callback:u,priorityLevel:e,expirationTime:t,next:null,previous:null},null===i)i=u.next=u.previous=u;else{n=null,e=i;do{if(e.expirationTime>=t){n=e;break}e=e.next}while(e!==i);null===n?n=i:n===i&&(i=u,d()),(t=n.previous).next=n.previous=u,u.next=n,u.previous=t}}function p(){if(-1===s&&null!==i&&1===i.priorityLevel){a=!0,c.didTimeout=!0;try{do{h()}while(null!==i&&1===i.priorityLevel)}finally{a=!1,null!==i?d():u=!1}}}function f(e){a=!0,c.didTimeout=e;try{if(e)for(;null!==i;){var n=t.unstable_now();if(!(i.expirationTime<=n))break;do{h()}while(null!==i&&i.expirationTime<=n)}else if(null!==i)do{h()}while(null!==i&&0<y()-t.unstable_now())}finally{a=!1,null!==i?d():u=!1,p()}}var m,g,T,v,y,E=Date,b="function"==typeof setTimeout?setTimeout:void 0,S="function"==typeof clearTimeout?clearTimeout:void 0,_="function"==typeof requestAnimationFrame?requestAnimationFrame:void 0,C="function"==typeof cancelAnimationFrame?cancelAnimationFrame:void 0;function w(e){m=_(function(t){S(g),e(t)}),g=b(function(){C(m),e(t.unstable_now())},100)}if(l){var R=performance;t.unstable_now=function(){return R.now()}}else t.unstable_now=function(){return E.now()};if("undefined"!=typeof window&&window._schedMock){var A=window._schedMock;T=A[0],v=A[1],y=A[2]}else if("undefined"==typeof window||"function"!=typeof window.addEventListener){var I=null,N=-1,x=function(e,t){if(null!==I){var n=I;I=null;try{N=t,n(e)}finally{N=-1}}};T=function(e,t){-1!==N?setTimeout(T,0,e,t):(I=e,setTimeout(x,t,!0,t),setTimeout(x,1073741823,!1,1073741823))},v=function(){I=null},y=function(){return 1/0},t.unstable_now=function(){return-1===N?0:N}}else{"undefined"!=typeof console&&("function"!=typeof _&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"function"!=typeof C&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"));var D=null,O=!1,k=-1,U=!1,P=!1,$=0,H=33,M=33;y=function(){return $};var q="__reactIdleCallback$"+Math.random().toString(36).slice(2);window.addEventListener("message",function(e){if(e.source===window&&e.data===q){O=!1,e=D;var n=k;D=null,k=-1;var i=t.unstable_now(),r=!1;if(0>=$-i){if(!(-1!==n&&n<=i))return U||(U=!0,w(L)),D=e,void(k=n);r=!0}if(null!==e){P=!0;try{e(r)}finally{P=!1}}}},!1);var L=function(e){if(null!==D){w(L);var t=e-$+M;t<M&&H<M?(8>t&&(t=8),M=t<H?H:t):H=t,$=e+M,O||(O=!0,window.postMessage(q,"*"))}else U=!1};T=function(e,t){D=e,k=t,P||0>t?window.postMessage(q,"*"):U||(U=!0,w(L))},v=function(){D=null,O=!1,k=-1}}t.unstable_ImmediatePriority=1,t.unstable_UserBlockingPriority=2,t.unstable_NormalPriority=3,t.unstable_IdlePriority=4,t.unstable_runWithPriority=function(e,n){switch(e){case 1:case 2:case 3:case 4:break;default:e=3}var i=r,o=s;r=e,s=t.unstable_now();try{return n()}finally{r=i,s=o,p()}},t.unstable_scheduleCallback=function(e,n){var o=-1!==s?s:t.unstable_now();if("object"==typeof n&&null!==n&&"number"==typeof n.timeout)n=o+n.timeout;else switch(r){case 1:n=o+-1;break;case 2:n=o+250;break;case 4:n=o+1073741823;break;default:n=o+5e3}if(e={callback:e,priorityLevel:r,expirationTime:n,next:null,previous:null},null===i)i=e.next=e.previous=e,d();else{o=null;var a=i;do{if(a.expirationTime>n){o=a;break}a=a.next}while(a!==i);null===o?o=i:o===i&&(i=e,d()),(n=o.previous).next=o.previous=e,e.next=o,e.previous=n}return e},t.unstable_cancelCallback=function(e){var t=e.next;if(null!==t){if(t===e)i=null;else{e===i&&(i=t);var n=e.previous;n.next=t,t.previous=n}e.next=e.previous=null}},t.unstable_wrapCallback=function(e){var n=r;return function(){var i=r,o=s;r=n,s=t.unstable_now();try{return e.apply(this,arguments)}finally{r=i,s=o,p()}}},t.unstable_getCurrentPriorityLevel=function(){return r}},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var i=n(0),r=n.n(i),s=n(1),o=n.n(s);function a(e){if(isNaN(e))return e;var t=e.getHours(),n=e.getMinutes();return(t>9?t:"0"+t)+":"+(n>9?n:"0"+n)}function u(e){if(isNaN(e))return"---";var t=new Date;switch(Math.round(t/864e5-e/864e5)){case 2:var n="позавчера";break;case 1:n="вчера";break;case 0:n="сегодня";break;case-1:n="завтра";break;case-2:n="послезавтра";break;default:var i=e.getDate(),r=e.getMonth()+1;n=(i>9?i:"0"+i)+"-"+(r>9?r:"0"+r)+"-"+e.getFullYear()}return n+" "+a(e)}var l="STATE_OFF",c="STATE_GO_ON",d="STATE_READY",h="STATE_CALLING",p="STATE_PROGRESS",f="STATE_RINGING",m="STATE_GO_TALK",g="STATE_BUSY",T="STATE_GO_OFF";n(8);function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function S(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var C=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return _(S(S(n=function(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?S(e):t}(this,(e=E(t)).call.apply(e,[this].concat(r))))),"state",{outcalls:[],types:[],loading:!0,error:!1}),_(S(S(n)),"handleClickSelectClient",function(e){n.props.onClickClient(e)}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,i["Component"]),function(e,t,n){t&&y(e.prototype,t),n&&y(e,n)}(t,[{key:"componentDidMount",value:function(){var e=this;this.state;$.get("callcenter/get-outcalls",{},function(t){console.log(t),e.state={outcalls:t.outcalls,types:t.types,loading:!1,error:!1};var n=!0,i=!1,r=void 0;try{for(var s,o=e.state.outcalls[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var a=s.value;e.addOutcallType(a)}}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}e.setState(e.state)},"json").fail(function(t){console.log(t),e.setState({outcalls:[],types:[],loading:!1,error:t.responseText})})}},{key:"addOutcallType",value:function(e){for(var t in this.state.types)if(e.type_id==this.state.types[t].id)return e.type_name=this.state.types[t].name,void(e.type_desc=this.state.types[t].desc)}},{key:"render",value:function(){var e=this,t=this.props,n=this.state;return r.a.createElement("div",{className:"cc-outcalls-outher"},r.a.createElement("table",{className:"table table-condensed outcalls"},r.a.createElement("tbody",null,n.outcalls.map(function(n,i){return r.a.createElement("tr",{key:i},r.a.createElement("td",{className:"o-date"},u(function(e){return"string"==typeof e?new Date(e.replace(/-/g,"/")):"---"}(n.created))),r.a.createElement("td",{className:"o-desc"},r.a.createElement("span",{className:"glyphicon glyphicon-question-sign"})),r.a.createElement("td",{className:"o-type"},n.type_name),r.a.createElement("td",{className:"o-name"},n.name),r.a.createElement("td",{className:"o-phone"},n.phone),r.a.createElement("td",{className:"o-desc"},r.a.createElement("button",{className:"btn btn-info btn-block btn-xs",onClick:t.onClickClient.bind(e,n.user_id)},r.a.createElement("span",{className:"glyphicon glyphicon-user"}))),r.a.createElement("td",{className:"o-attempt"},n.attempt,"1"),r.a.createElement("td",{className:"o-call-button"},r.a.createElement("button",{className:"btn btn-success btn-block btn-xs",onClick:t.onClickCall.bind(e,n.phone,n.user_id,n.id),disabled:t.state!=d},"Позвонить")))}))))}}]),t}();n(9);function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function R(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function A(e){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function I(e,t){return(I=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function N(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var D=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return x(N(N(n=function(e,t){return!t||"object"!==w(t)&&"function"!=typeof t?N(e):t}(this,(e=A(t)).call.apply(e,[this].concat(r))))),"componentDidMount",function(){if(n.props.options.client){var e,t=n.props.options.client;switch(e=t.name?t.name:"CallcenterClient",t.type){case"react":o.a.render(window[e],n.refs.container);break;case"function":window[e](N(N(n)),n.refs.container)}}}),x(N(N(n)),"clickArea",function(){}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&I(e,t)}(t,i["Component"]),function(e,t,n){t&&R(e.prototype,t),n&&R(e,n)}(t,[{key:"render",value:function(){this.props,this.state;return r.a.createElement("div",{className:"cc-client-outher",ref:"container"},"Loading...")}}]),t}();n(10);function O(e){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function U(e,t){return!t||"object"!==O(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function H(e,t){return(H=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var M=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),U(this,P(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&H(e,t)}(t,i["Component"]),function(e,t,n){t&&k(e.prototype,t),n&&k(e,n)}(t,[{key:"render",value:function(){this.props,this.state;return r.a.createElement("div",{className:"cc-wiki-outher"},"Hello from Wiki!")}}]),t}();n(11);function q(e){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function L(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function F(e){return(F=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function B(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function G(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var W=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return G(B(B(n=function(e,t){return!t||"object"!==q(t)&&"function"!=typeof t?B(e):t}(this,(e=F(t)).call.apply(e,[this].concat(s))))),"state",{ajaxNum:0,ajaxError:!1}),G(B(B(n)),"getButtonsBlock",function(e,t){var i=[];for(var s in e)e.hasOwnProperty(s)&&i.push({name:s,items:e[s]});var o=B(B(n));function a(e,t){return r.a.createElement("button",{key:t,className:"btn btn-default"+(e.width?" width-"+e.width:""),onClick:o.props.onClickCustom.bind(this,e.event)},e.name)}return r.a.createElement("div",{className:"p-o-block-wrapper p-o-custom"},i.map(function(e,t){return r.a.createElement("fieldset",{key:t},r.a.createElement("legend",null,e.name),e.items.map(a))}))}),G(B(B(n)),"componentDidMount",function(){var e=B(B(n));$(document).ajaxSend(function(t,n,i){e.state.ajaxNum++,e.setState(e.state)}).ajaxSuccess(function(t,n,i){e.state.ajaxNum>0&&e.state.ajaxNum--,e.state.ajaxError=!1,e.setState(e.state)}).ajaxError(function(t,n,i){e.state.ajaxNum>0&&e.state.ajaxNum--,e.state.ajaxError=!0,e.setState(e.state)})}),G(B(B(n)),"getDisplayValue",function(){var e=n.props.display+"",t="888888888888888",i=t.length,s=e.length,o=n.props.state,a=o==p||o==f||o==h||o==m;if(s>i)return r.a.createElement("span",{className:"n-d-full"},r.a.createElement("span",{className:"d-f-data"+(a?" blink":"")},e.substring(0,i)));var u=Math.floor((i-s)/2),l=i-u-s;return r.a.createElement("span",{className:"n-d-full"},t.substring(0,u),r.a.createElement("span",{className:"d-f-data"+(a?" blink":"")},e),t.substring(0,l))}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(t,i["Component"]),function(e,t,n){t&&L(e.prototype,t),n&&L(e,n)}(t,[{key:"render",value:function(){var e,t=this.props,n=this.state,i=t.state,s=this.props.options,o="";if(t.options.logo){var a=t.options.logo;"object"==q(a)&&(e={backgroundColor:a.bgColor,padding:a.padding},o=r.a.createElement("img",{className:"yii2-callcenter-logo",src:a.url}))}var u,d,h,v=i==p||i==f||"STATE_TALKING"==i||i==m||"STATE_ENDING"==i||i==g;switch(console.log("Phone render ",v,i),i){case l:u=" red";break;case T:case c:u=" disabled";break;default:u=" green"}return n.ajaxError?(d="red",h="Последний запрос к серверу выполнен с ошибкой."):n.ajaxNum>0?(d="yellow",h="Запрос к серверу выполняется."):(d="#008000",h="Система работает нормально. Запросы к серверу выполняются без ошибок."),r.a.createElement("div",{className:"cc-phone-outher"},r.a.createElement("div",{className:"p-o-block-wrapper p-o-logo"},r.a.createElement("div",{className:"o-l-lines"},"0"),r.a.createElement("div",{className:"o-l-img",style:e},o),r.a.createElement("div",{className:"o-l-power"+u,onClick:t.onClickPower},r.a.createElement("span",{className:"glyphicon glyphicon-off"}))),r.a.createElement("div",{className:"p-o-block-wrapper p-o-number"},r.a.createElement("div",{className:"o-n-lights"},r.a.createElement("div",{className:"n-lighs-ws"}),r.a.createElement("div",{className:"n-lighs-sip"+(t.register?" green":"")}),r.a.createElement("div",{className:"n-lighs-query",title:h,style:{background:d}})),r.a.createElement("div",{className:"o-n-display"},this.getDisplayValue())),r.a.createElement("div",{className:"p-o-block-wrapper p-o-buttons"},r.a.createElement("button",{className:"btn btn-xl btn-danger",disabled:!v,onClick:t.onClickCancel},r.a.createElement("span",{className:"glyphicon glyphicon-phone-alt"})),r.a.createElement("button",{className:"btn btn-xl btn-success",disabled:!(i==f),onClick:t.onClickAnswer},r.a.createElement("span",{className:"glyphicon glyphicon-earphone"}))),r.a.createElement("div",{className:"p-o-block-wrapper p-o-transfer"},r.a.createElement("button",{className:"btn btn-default",onClick:t.onClickTransfer},r.a.createElement("span",{className:"glyphicon glyphicon-arrow-right"})),r.a.createElement("select",{className:"form-control"},r.a.createElement("option",null,"888888888"),r.a.createElement("option",null,"777777777")),r.a.createElement("button",{className:"btn btn-default",onClick:t.onClickHold},r.a.createElement("span",{className:"glyphicon gluphicon-mic"}))),this.getButtonsBlock(s.buttons))}}]),t}(),z=n(3),V=n.n(z);n(12);function K(e){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Y(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Z(e){return(Z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function J(e,t){return(J=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function X(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ee=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return X(Q(Q(n=function(e,t){return!t||"object"!==K(t)&&"function"!=typeof t?Q(e):t}(this,(e=Z(t)).call.apply(e,[this].concat(r))))),"state",{soundPhone:document.getElementById("sound-phone"),session:!1,phoneState:l,display:""}),X(Q(Q(n)),"onClickPower",function(e){console.log("onClickPower",n.state);var t=Q(Q(n));n.state.phoneState==l?(n.state.phoneState=c,n.setState(n.state,function(){t.state.ua.register()})):n.state.phoneState==d&&(n.state.phoneState=T,n.setState(n.state,function(){t.state.ua.unregister()}))}),X(Q(Q(n)),"onClickCancel",function(e){console.log("clickCancel",Q(Q(n))),n.state.phoneState==g?(n.state.phoneState=d,n.state.display="",n.setState(n.state)):n.state.session&&(n.state.session.terminate(),n.state.session=!1,n.setState(n.state))}),X(Q(Q(n)),"onClickAnswer",function(){n.state.session&&n.state.phoneState==f&&(n.state.session.accept({sessionDescriptionHandlerOptions:{constraints:{audio:!0,video:!1}}}),n.state.phoneState=m,n.setState(n.state)),console.log("cliclAccept")}),X(Q(Q(n)),"onClickHold",function(){}),X(Q(Q(n)),"onClickTransfer",function(){}),X(Q(Q(n)),"onClickCustom",function(e){n.makeCall(e)}),X(Q(Q(n)),"onClickCall",function(e,t,i){n.selectClient(t),n.makeCall(e,i)}),X(Q(Q(n)),"onClickInfo",function(e){console.log("clickInfo",e)}),X(Q(Q(n)),"selectClient",function(e){"object"==K(n.props.options)&&"object"==K(n.props.options.client)&&n.props.options.client.select&&window[n.props.options.client.select](e)}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&J(e,t)}(t,i["Component"]),function(e,t,n){t&&Y(e.prototype,t),n&&Y(e,n)}(t,[{key:"componentDidMount",value:function(){var e=this,t=this,n=this.props,i=this.state,r=n.options.sip;i.ua=new V.a.UA({uri:r.name+"@"+r.url,transportOptions:{wsServers:[r.ws],traceSip:!0,maxReconnectionAttempts:1e9},log:{level:"debug"},authorizationUser:r.name,password:r.password,hackIpInContact:!1,hackWssInTransport:!1,hackViaTcp:!1}),i.ua.on("invite",function(t){var n=e,i=e.state;i.phoneState==d&&(n.refs.soundPhoneRing.play(),i.session=t,i.phoneState=f,i.display=i.session.remoteIdentity.displayName,n.setState(i)),t.on("accepted",function(e){n.refs.soundPhoneRing.pause(),n.refs.soundPhoneRing.currentTime=0;var r=t.sessionDescriptionHandler.peerConnection,s=new MediaStream;r.getReceivers().forEach(function(e){var t=e.track;t&&s.addTrack(t)}),i.soundPhone.srcObject=s,i.phoneState="STATE_TALKING",n.setState(i),console.log("Incoming call accepted",t)}),t.on("failed",function(e){}),t.on("bye",function(e){}),t.on("terminated",function(e){console.log("incoming call terminated"+e),n.state.phoneState==T?n.state.phoneState=l:n.state.phoneState=g,n.refs.soundPhoneRing.pause(),n.refs.soundPhoneRing.currentTime=0,n.state.session=!1,n.setState(n.state)})}),i.ua.on("registered",function(){var n=e.state;n.phoneState!=c&&n.phoneState!=l||(n.phoneState=d,n.display=""),t.setState(n),console.log("Sip phone registered",n)}),i.ua.on("unregistered",function(n,i){var r=e.state;r.phoneState==T&&(r.phoneState=l),console.log("Sip phone ubregistered",i,r),t.setState(r)}),i.ua.on("registrationFailed",function(n,i){var r=e.state;console.log("Sip phone registration failed",i),r.phoneState==c&&(r.phoneState=l),t.setState(r)})}},{key:"makeCall",value:function(e,t){var n=this,i=this;if(i.state.phoneState==d){var r={sessionDescriptionHandlerOptions:{constraints:{audio:!0,video:!1}},extraHeaders:["X-user-domain: "+this.props.options.sip.url,"X-callid: "+t]};i.state.display=e,i.state.phoneState=h,i.setState(i.state),i.state.session=this.state.ua.invite(e+"@"+this.props.options.sip.url,r),i.state.session.on("progress",function(e){if(i.state.phoneState==h){i.state.phoneState=p;try{i.refs.soundPhoneRingback.play()}catch(e){console.log(e)}i.setState(i.state)}}),i.state.session.on("accepted",function(e,t){console.log("Outgoing  call accepted",e,t,n),i.refs.soundPhoneRingback.pause(),i.refs.soundPhoneRingback.currentTime=0;var r=i.state.session.sessionDescriptionHandler.peerConnection,s=new MediaStream;r.getReceivers().forEach(function(e){var t=e.track;t&&s.addTrack(t)}),i.state.soundPhone.srcObject=s;try{i.state.soundPhone.play()}catch(e){console.log(e)}i.state.phoneState="STATE_TALKING",i.setState(i.state)}),i.state.session.on("terminated",function(e){console.log("outgoing call terminated"+e),i.refs.soundPhoneRingback.pause(),i.refs.soundPhoneRingback.currentTime=0,i.state.phoneState==T?i.state.phoneState=l:i.state.phoneState=g,i.state.session=!1,i.setState(i.state)})}}},{key:"render",value:function(){var e=this.props,t=this.state,n=e.options;return r.a.createElement("div",{className:"cc-outher"},r.a.createElement("audio",{ref:"soundPhoneRingback",src:"/sound/phone_wait.mp3",loop:!0}),r.a.createElement("audio",{ref:"soundPhoneRing",src:"/sound/phone_ring.mp3",loop:!0}),r.a.createElement("audio",{ref:"soundPhoneBusy",src:"/sound/phone_busy.mp3"}),r.a.createElement("div",{className:"c-o-left"},r.a.createElement(C,{state:t.phoneState,onClickInfo:this.onClickInfo,onClickClient:this.selectClient,onClickCall:this.onClickCall}),r.a.createElement(D,{options:n}),r.a.createElement(M,null)),r.a.createElement("div",{className:"c-o-right"},r.a.createElement(W,{onClickPower:this.onClickPower,onClickAnswer:this.onClickAnswer,onClickCancel:this.onClickCancel,onClickTransfer:this.onClickTransfer,onClickHold:this.onClickHold,onClickCustom:this.onClickCustom,display:t.display,state:t.phoneState,options:n,register:t.ua&&t.ua.isRegistered()})))}}]),t}(),te=document.getElementById("yii2-callcenter-root"),ne=JSON.parse(te.dataset.options);o.a.render(r.a.createElement(ee,{options:ne}),te)}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoianMvY2FsbGNlbnRlci5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly8vL1VzZXJzL3BhdmVsL1BocHN0b3JtUHJvamVjdHMvY2FsbGNlbnRlci92ZW5kb3IvbnBtLWFzc2V0L29iamVjdC1hc3NpZ24vaW5kZXguanMiLCJ3ZWJwYWNrOi8vLy9Vc2Vycy9wYXZlbC9QaHBzdG9ybVByb2plY3RzL2NhbGxjZW50ZXIvdmVuZG9yL25wbS1hc3NldC9zaXAuanMvZGlzdC9zaXAuanMiLCJ3ZWJwYWNrOi8vLy9Vc2Vycy9wYXZlbC9QaHBzdG9ybVByb2plY3RzL2NhbGxjZW50ZXIvdmVuZG9yL25wbS1hc3NldC9yZWFjdC9janMvcmVhY3QucHJvZHVjdGlvbi5taW4uanMiLCJ3ZWJwYWNrOi8vLy9Vc2Vycy9wYXZlbC9QaHBzdG9ybVByb2plY3RzL2NhbGxjZW50ZXIvdmVuZG9yL25wbS1hc3NldC9yZWFjdC1kb20vY2pzL3JlYWN0LWRvbS5wcm9kdWN0aW9uLm1pbi5qcyIsIndlYnBhY2s6Ly8vL1VzZXJzL3BhdmVsL1BocHN0b3JtUHJvamVjdHMvY2FsbGNlbnRlci92ZW5kb3IvbnBtLWFzc2V0L3NjaGVkdWxlci9janMvc2NoZWR1bGVyLnByb2R1Y3Rpb24ubWluLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAxMyk7XG4iLCIvKlxub2JqZWN0LWFzc2lnblxuKGMpIFNpbmRyZSBTb3JodXNcbkBsaWNlbnNlIE1JVFxuKi9cblxuJ3VzZSBzdHJpY3QnO1xuLyogZXNsaW50LWRpc2FibGUgbm8tdW51c2VkLXZhcnMgKi9cbnZhciBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzO1xudmFyIGhhc093blByb3BlcnR5ID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTtcbnZhciBwcm9wSXNFbnVtZXJhYmxlID0gT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZTtcblxuZnVuY3Rpb24gdG9PYmplY3QodmFsKSB7XG5cdGlmICh2YWwgPT09IG51bGwgfHwgdmFsID09PSB1bmRlZmluZWQpIHtcblx0XHR0aHJvdyBuZXcgVHlwZUVycm9yKCdPYmplY3QuYXNzaWduIGNhbm5vdCBiZSBjYWxsZWQgd2l0aCBudWxsIG9yIHVuZGVmaW5lZCcpO1xuXHR9XG5cblx0cmV0dXJuIE9iamVjdCh2YWwpO1xufVxuXG5mdW5jdGlvbiBzaG91bGRVc2VOYXRpdmUoKSB7XG5cdHRyeSB7XG5cdFx0aWYgKCFPYmplY3QuYXNzaWduKSB7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXG5cdFx0Ly8gRGV0ZWN0IGJ1Z2d5IHByb3BlcnR5IGVudW1lcmF0aW9uIG9yZGVyIGluIG9sZGVyIFY4IHZlcnNpb25zLlxuXG5cdFx0Ly8gaHR0cHM6Ly9idWdzLmNocm9taXVtLm9yZy9wL3Y4L2lzc3Vlcy9kZXRhaWw/aWQ9NDExOFxuXHRcdHZhciB0ZXN0MSA9IG5ldyBTdHJpbmcoJ2FiYycpOyAgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1uZXctd3JhcHBlcnNcblx0XHR0ZXN0MVs1XSA9ICdkZSc7XG5cdFx0aWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHRlc3QxKVswXSA9PT0gJzUnKSB7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXG5cdFx0Ly8gaHR0cHM6Ly9idWdzLmNocm9taXVtLm9yZy9wL3Y4L2lzc3Vlcy9kZXRhaWw/aWQ9MzA1NlxuXHRcdHZhciB0ZXN0MiA9IHt9O1xuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgMTA7IGkrKykge1xuXHRcdFx0dGVzdDJbJ18nICsgU3RyaW5nLmZyb21DaGFyQ29kZShpKV0gPSBpO1xuXHRcdH1cblx0XHR2YXIgb3JkZXIyID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGVzdDIpLm1hcChmdW5jdGlvbiAobikge1xuXHRcdFx0cmV0dXJuIHRlc3QyW25dO1xuXHRcdH0pO1xuXHRcdGlmIChvcmRlcjIuam9pbignJykgIT09ICcwMTIzNDU2Nzg5Jykge1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdC8vIGh0dHBzOi8vYnVncy5jaHJvbWl1bS5vcmcvcC92OC9pc3N1ZXMvZGV0YWlsP2lkPTMwNTZcblx0XHR2YXIgdGVzdDMgPSB7fTtcblx0XHQnYWJjZGVmZ2hpamtsbW5vcHFyc3QnLnNwbGl0KCcnKS5mb3JFYWNoKGZ1bmN0aW9uIChsZXR0ZXIpIHtcblx0XHRcdHRlc3QzW2xldHRlcl0gPSBsZXR0ZXI7XG5cdFx0fSk7XG5cdFx0aWYgKE9iamVjdC5rZXlzKE9iamVjdC5hc3NpZ24oe30sIHRlc3QzKSkuam9pbignJykgIT09XG5cdFx0XHRcdCdhYmNkZWZnaGlqa2xtbm9wcXJzdCcpIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cblx0XHRyZXR1cm4gdHJ1ZTtcblx0fSBjYXRjaCAoZXJyKSB7XG5cdFx0Ly8gV2UgZG9uJ3QgZXhwZWN0IGFueSBvZiB0aGUgYWJvdmUgdG8gdGhyb3csIGJ1dCBiZXR0ZXIgdG8gYmUgc2FmZS5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBzaG91bGRVc2VOYXRpdmUoKSA/IE9iamVjdC5hc3NpZ24gOiBmdW5jdGlvbiAodGFyZ2V0LCBzb3VyY2UpIHtcblx0dmFyIGZyb207XG5cdHZhciB0byA9IHRvT2JqZWN0KHRhcmdldCk7XG5cdHZhciBzeW1ib2xzO1xuXG5cdGZvciAodmFyIHMgPSAxOyBzIDwgYXJndW1lbnRzLmxlbmd0aDsgcysrKSB7XG5cdFx0ZnJvbSA9IE9iamVjdChhcmd1bWVudHNbc10pO1xuXG5cdFx0Zm9yICh2YXIga2V5IGluIGZyb20pIHtcblx0XHRcdGlmIChoYXNPd25Qcm9wZXJ0eS5jYWxsKGZyb20sIGtleSkpIHtcblx0XHRcdFx0dG9ba2V5XSA9IGZyb21ba2V5XTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7XG5cdFx0XHRzeW1ib2xzID0gZ2V0T3duUHJvcGVydHlTeW1ib2xzKGZyb20pO1xuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBzeW1ib2xzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdGlmIChwcm9wSXNFbnVtZXJhYmxlLmNhbGwoZnJvbSwgc3ltYm9sc1tpXSkpIHtcblx0XHRcdFx0XHR0b1tzeW1ib2xzW2ldXSA9IGZyb21bc3ltYm9sc1tpXV07XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRyZXR1cm4gdG87XG59O1xuIiwiLyohXG4gKiBcbiAqICBTSVAgdmVyc2lvbiAwLjExLjZcbiAqICBDb3B5cmlnaHQgKGMpIDIwMTQtMjAxOCBKdW5jdGlvbiBOZXR3b3JrcywgSW5jIDxodHRwOi8vd3d3Lm9uc2lwLmNvbT5cbiAqICBIb21lcGFnZTogaHR0cHM6Ly9zaXBqcy5jb21cbiAqICBMaWNlbnNlOiBodHRwczovL3NpcGpzLmNvbS9saWNlbnNlL1xuICogXG4gKiBcbiAqICB+fn5TSVAuanMgY29udGFpbnMgc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgSnNTSVAgdW5kZXIgdGhlIGZvbGxvd2luZyBsaWNlbnNlfn5+XG4gKiAgSG9tZXBhZ2U6IGh0dHA6Ly9qc3NpcC5uZXRcbiAqICBDb3B5cmlnaHQgKGMpIDIwMTItMjAxMyBKb3PDqSBMdWlzIE1pbGzDoW4gLSBWZXJzYXRpY2EgPGh0dHA6Ly93d3cudmVyc2F0aWNhLmNvbT5cbiAqIFxuICogIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZ1xuICogIGEgY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZVxuICogIFwiU29mdHdhcmVcIiksIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZ1xuICogIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCxcbiAqICBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG9cbiAqICBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG9cbiAqICB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG4gKiBcbiAqICBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZVxuICogIGluY2x1ZGVkIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuICogXG4gKiAgVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCxcbiAqICBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0ZcbiAqICBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORFxuICogIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkVcbiAqICBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OXG4gKiAgT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OXG4gKiAgV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuXG4gKiBcbiAqICB+fn4gZW5kIEpzU0lQIGxpY2Vuc2Ugfn5+XG4gKiBcbiAqIFxuICogXG4gKiBcbiAqL1xuKGZ1bmN0aW9uIHdlYnBhY2tVbml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uKHJvb3QsIGZhY3RvcnkpIHtcblx0aWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKVxuXHRcdG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpO1xuXHRlbHNlIGlmKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZClcblx0XHRkZWZpbmUoW10sIGZhY3RvcnkpO1xuXHRlbHNlIGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jylcblx0XHRleHBvcnRzW1wiU0lQXCJdID0gZmFjdG9yeSgpO1xuXHRlbHNlXG5cdFx0cm9vdFtcIlNJUFwiXSA9IGZhY3RvcnkoKTtcbn0pKHRoaXMsIGZ1bmN0aW9uKCkge1xucmV0dXJuIC8qKioqKiovIChmdW5jdGlvbihtb2R1bGVzKSB7IC8vIHdlYnBhY2tCb290c3RyYXBcbi8qKioqKiovIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuLyoqKioqKi8gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbi8qKioqKiovIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbi8qKioqKiovIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuLyoqKioqKi8gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4vKioqKioqLyBcdFx0fVxuLyoqKioqKi8gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4vKioqKioqLyBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuLyoqKioqKi8gXHRcdFx0aTogbW9kdWxlSWQsXG4vKioqKioqLyBcdFx0XHRsOiBmYWxzZSxcbi8qKioqKiovIFx0XHRcdGV4cG9ydHM6IHt9XG4vKioqKioqLyBcdFx0fTtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4vKioqKioqLyBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbi8qKioqKiovIFx0XHRtb2R1bGUubCA9IHRydWU7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4vKioqKioqLyBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuLyoqKioqKi8gXHR9XG4vKioqKioqL1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4vKioqKioqLyBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuLyoqKioqKi8gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4vKioqKioqLyBcdFx0fVxuLyoqKioqKi8gXHR9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4vKioqKioqLyBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4vKioqKioqLyBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbi8qKioqKiovIFx0XHR9XG4vKioqKioqLyBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbi8qKioqKiovIFx0fTtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuLyoqKioqKi8gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbi8qKioqKiovIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4vKioqKioqLyBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuLyoqKioqKi8gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4vKioqKioqLyBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4vKioqKioqLyBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbi8qKioqKiovIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuLyoqKioqKi8gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4vKioqKioqLyBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbi8qKioqKiovIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4vKioqKioqLyBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuLyoqKioqKi8gXHRcdHJldHVybiBucztcbi8qKioqKiovIFx0fTtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuLyoqKioqKi8gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuLyoqKioqKi8gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbi8qKioqKiovIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4vKioqKioqLyBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuLyoqKioqKi8gXHRcdHJldHVybiBnZXR0ZXI7XG4vKioqKioqLyBcdH07XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcbi8qKioqKiovXG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8qKioqKiovIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7XG4vKioqKioqLyB9KVxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qKioqKiovIChbXG4vKiAwICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblwidXNlIHN0cmljdFwiO1xuXG5tb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oMSkoX193ZWJwYWNrX3JlcXVpcmVfXyg0MCkpO1xuXG5cbi8qKiovIH0pLFxuLyogMSAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cInVzZSBzdHJpY3RcIjtcbi8qKlxuICogQG5hbWUgU0lQXG4gKiBAbmFtZXNwYWNlXG4gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoZW52aXJvbm1lbnQpIHtcbiAgICB2YXIgcGtnID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKSwgdmVyc2lvbiA9IHBrZy52ZXJzaW9uLCB0aXRsZSA9IHBrZy50aXRsZTtcbiAgICB2YXIgU0lQID0gT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoe30sIHtcbiAgICAgICAgdmVyc2lvbjoge1xuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB2ZXJzaW9uOyB9XG4gICAgICAgIH0sXG4gICAgICAgIG5hbWU6IHtcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGl0bGU7IH1cbiAgICAgICAgfVxuICAgIH0pO1xuICAgIF9fd2VicGFja19yZXF1aXJlX18oMykoU0lQLCBlbnZpcm9ubWVudCk7XG4gICAgU0lQLkxvZ2dlckZhY3RvcnkgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQpKGVudmlyb25tZW50LmNvbnNvbGUpO1xuICAgIFNJUC5FdmVudEVtaXR0ZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUpKCk7XG4gICAgU0lQLkMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcpKFNJUC5uYW1lLCBTSVAudmVyc2lvbik7XG4gICAgU0lQLkV4Y2VwdGlvbnMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgpO1xuICAgIFNJUC5UaW1lcnMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDkpKGVudmlyb25tZW50LnRpbWVycyk7XG4gICAgU0lQLlRyYW5zcG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oMTApKFNJUCk7XG4gICAgX193ZWJwYWNrX3JlcXVpcmVfXygxMSkoU0lQKTtcbiAgICBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyKShTSVApO1xuICAgIF9fd2VicGFja19yZXF1aXJlX18oMTMpKFNJUCk7XG4gICAgX193ZWJwYWNrX3JlcXVpcmVfXygxNCkoU0lQKTtcbiAgICBfX3dlYnBhY2tfcmVxdWlyZV9fKDE1KShTSVApO1xuICAgIF9fd2VicGFja19yZXF1aXJlX18oMTYpKFNJUCk7XG4gICAgX193ZWJwYWNrX3JlcXVpcmVfXygxOCkoU0lQKTtcbiAgICBfX3dlYnBhY2tfcmVxdWlyZV9fKDE5KShTSVApO1xuICAgIFNJUC5TZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMCkoU0lQLkV2ZW50RW1pdHRlcik7XG4gICAgX193ZWJwYWNrX3JlcXVpcmVfXygyMSkoU0lQKTtcbiAgICBfX3dlYnBhY2tfcmVxdWlyZV9fKDIyKShTSVApO1xuICAgIF9fd2VicGFja19yZXF1aXJlX18oMjMpKFNJUCk7XG4gICAgX193ZWJwYWNrX3JlcXVpcmVfXygyNSkoU0lQKTtcbiAgICBfX3dlYnBhY2tfcmVxdWlyZV9fKDI2KShTSVApO1xuICAgIF9fd2VicGFja19yZXF1aXJlX18oMjcpKFNJUCwgZW52aXJvbm1lbnQpO1xuICAgIF9fd2VicGFja19yZXF1aXJlX18oMzIpKFNJUCk7XG4gICAgU0lQLkRpZ2VzdEF1dGhlbnRpY2F0aW9uID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMykoU0lQLlV0aWxzKTtcbiAgICBTSVAuR3JhbW1hciA9IF9fd2VicGFja19yZXF1aXJlX18oMzYpKFNJUCk7XG4gICAgU0lQLldlYiA9IHtcbiAgICAgICAgTW9kaWZpZXJzOiBfX3dlYnBhY2tfcmVxdWlyZV9fKDM4KShTSVApLFxuICAgICAgICBTaW1wbGU6IF9fd2VicGFja19yZXF1aXJlX18oMzkpKFNJUClcbiAgICB9O1xuICAgIHJldHVybiBTSVA7XG59O1xuXG5cbi8qKiovIH0pLFxuLyogMiAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSkge1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcIm5hbWVcIjpcInNpcC5qc1wiLFwidGl0bGVcIjpcIlNJUC5qc1wiLFwiZGVzY3JpcHRpb25cIjpcIkEgc2ltcGxlLCBpbnR1aXRpdmUsIGFuZCBwb3dlcmZ1bCBKYXZhU2NyaXB0IHNpZ25hbGluZyBsaWJyYXJ5XCIsXCJ2ZXJzaW9uXCI6XCIwLjExLjZcIixcIm1haW5cIjpcImRpc3Qvc2lwLmpzXCIsXCJicm93c2VyXCI6e1wiLi9zcmMvZW52aXJvbm1lbnQuanNcIjpcIi4vc3JjL2Vudmlyb25tZW50X2Jyb3dzZXIuanNcIn0sXCJob21lcGFnZVwiOlwiaHR0cHM6Ly9zaXBqcy5jb21cIixcImF1dGhvclwiOlwiT25TSVAgPGRldmVsb3BlckBvbnNpcC5jb20+IChodHRwczovL3NpcGpzLmNvbS9hYm91dHVzLylcIixcImNvbnRyaWJ1dG9yc1wiOlt7XCJ1cmxcIjpcImh0dHBzOi8vZ2l0aHViLmNvbS9vbnNpcC9TSVAuanMvYmxvYi9tYXN0ZXIvVEhBTktTLm1kXCJ9XSxcInJlcG9zaXRvcnlcIjp7XCJ0eXBlXCI6XCJnaXRcIixcInVybFwiOlwiaHR0cHM6Ly9naXRodWIuY29tL29uc2lwL1NJUC5qcy5naXRcIn0sXCJrZXl3b3Jkc1wiOltcInNpcFwiLFwid2Vic29ja2V0XCIsXCJ3ZWJydGNcIixcImxpYnJhcnlcIixcImphdmFzY3JpcHRcIl0sXCJkZXZEZXBlbmRlbmNpZXNcIjp7XCJhd2Vzb21lLXR5cGVzY3JpcHQtbG9hZGVyXCI6XCJeNS4yLjFcIixcImVzbGludFwiOlwiXjUuNC4wXCIsXCJqYXNtaW5lLWNvcmVcIjpcIl4zLjIuMVwiLFwia2FybWFcIjpcIl4zLjAuMFwiLFwia2FybWEtY2hyb21lLWxhdW5jaGVyXCI6XCJeMi4yLjBcIixcImthcm1hLWNsaVwiOlwiXjEuMC4xXCIsXCJrYXJtYS1qYXNtaW5lXCI6XCJeMS4xLjBcIixcImthcm1hLWphc21pbmUtaHRtbC1yZXBvcnRlclwiOlwiXjEuMy4xXCIsXCJrYXJtYS1tb2NoYS1yZXBvcnRlclwiOlwiXjIuMi41XCIsXCJrYXJtYS13ZWJwYWNrXCI6XCJeMy4wLjBcIixcInBlZ2pzXCI6XCJeMC4xMC4wXCIsXCJwZWdqcy1sb2FkZXJcIjpcIl4wLjUuNFwiLFwidHlwZXNjcmlwdFwiOlwiXjMuMC4zXCIsXCJ3ZWJwYWNrXCI6XCJeNC4xOS4wXCIsXCJ3ZWJwYWNrLWNsaVwiOlwiXjMuMC44XCJ9LFwiZW5naW5lc1wiOntcIm5vZGVcIjpcIj49Ni4wXCJ9LFwibGljZW5zZVwiOlwiTUlUXCIsXCJzY3JpcHRzXCI6e1wicHJlYnVpbGRcIjpcImVzbGludCBzcmMvKi5qcyBzcmMvKiovKi5qc1wiLFwiYnVpbGQtZGV2XCI6XCJ3ZWJwYWNrIC0tcHJvZ3Jlc3MgLS1lbnYuYnVpbGRUeXBlIGRldlwiLFwiYnVpbGQtcHJvZFwiOlwid2VicGFjayAtLXByb2dyZXNzIC0tZW52LmJ1aWxkVHlwZSBwcm9kXCIsXCJjb3B5LWRpc3QtZmlsZXNcIjpcImNwIGRpc3Qvc2lwLmpzIGRpc3Qvc2lwLSRucG1fcGFja2FnZV92ZXJzaW9uLmpzICYmIGNwIGRpc3Qvc2lwLm1pbi5qcyAgZGlzdC9zaXAtJG5wbV9wYWNrYWdlX3ZlcnNpb24ubWluLmpzXCIsXCJidWlsZFwiOlwibnBtIHJ1biBidWlsZC1kZXYgJiYgbnBtIHJ1biBidWlsZC1wcm9kICYmIG5wbSBydW4gY29weS1kaXN0LWZpbGVzXCIsXCJicm93c2VyVGVzdFwiOlwic2xlZXAgMiAmJiBvcGVuIGh0dHA6Ly8wLjAuMC4wOjk4NzYvZGVidWcuaHRtbCAmIGthcm1hIHN0YXJ0IC0tcmVwb3J0ZXJzIGtqaHRtbCAtLW5vLXNpbmdsZS1ydW5cIixcImNvbW1hbmRMaW5lVGVzdFwiOlwia2FybWEgc3RhcnQgLS1yZXBvcnRlcnMgbW9jaGEgLS1icm93c2VycyBDaHJvbWVIZWFkbGVzcyAtLXNpbmdsZS1ydW5cIixcImJ1aWxkQW5kVGVzdFwiOlwibnBtIHJ1biBidWlsZCAmJiBucG0gcnVuIGNvbW1hbmRMaW5lVGVzdFwiLFwiYnVpbGRBbmRCcm93c2VyVGVzdFwiOlwibnBtIHJ1biBidWlsZCAmJiBucG0gcnVuIGJyb3dzZXJUZXN0XCJ9LFwiZGVwZW5kZW5jaWVzXCI6e1wiY3J5cHRvLWpzXCI6XCJeMy4xLjktMVwifSxcIm9wdGlvbmFsRGVwZW5kZW5jaWVzXCI6e1wicHJvbWlzY3VvdXNcIjpcIl4wLjYuMFwifX07XG5cbi8qKiovIH0pLFxuLyogMyAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cInVzZSBzdHJpY3RcIjtcblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IFV0aWxzXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKFNJUCwgZW52aXJvbm1lbnQpIHtcbiAgICB2YXIgVXRpbHM7XG4gICAgVXRpbHMgPSB7XG4gICAgICAgIFByb21pc2U6IGVudmlyb25tZW50LlByb21pc2UsXG4gICAgICAgIGRlZmVyOiBmdW5jdGlvbiBkZWZlcigpIHtcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9IHt9O1xuICAgICAgICAgICAgZGVmZXJyZWQucHJvbWlzZSA9IG5ldyBVdGlscy5Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlID0gcmVzb2x2ZTtcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QgPSByZWplY3Q7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZDtcbiAgICAgICAgfSxcbiAgICAgICAgcmVkdWNlUHJvbWlzZXM6IGZ1bmN0aW9uIHJlZHVjZVByb21pc2VzKGFyciwgdmFsKSB7XG4gICAgICAgICAgICByZXR1cm4gYXJyLnJlZHVjZShmdW5jdGlvbiAoYWNjLCBmbikge1xuICAgICAgICAgICAgICAgIGFjYyA9IGFjYy50aGVuKGZuKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgICAgICAgfSwgU0lQLlV0aWxzLlByb21pc2UucmVzb2x2ZSh2YWwpKTtcbiAgICAgICAgfSxcbiAgICAgICAgYXVnbWVudDogZnVuY3Rpb24gKG9iamVjdCwgY29uc3RydWN0b3IsIGFyZ3MsIG92ZXJyaWRlKSB7XG4gICAgICAgICAgICB2YXIgaWR4LCBwcm90bztcbiAgICAgICAgICAgIC8vIEFkZCBwdWJsaWMgcHJvcGVydGllcyBmcm9tIGNvbnN0cnVjdG9yJ3MgcHJvdG90eXBlIG9udG8gb2JqZWN0XG4gICAgICAgICAgICBwcm90byA9IGNvbnN0cnVjdG9yLnByb3RvdHlwZTtcbiAgICAgICAgICAgIGZvciAoaWR4IGluIHByb3RvKSB7XG4gICAgICAgICAgICAgICAgaWYgKG92ZXJyaWRlIHx8IG9iamVjdFtpZHhdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0W2lkeF0gPSBwcm90b1tpZHhdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIENvbnN0cnVjdCB0aGUgb2JqZWN0IGFzIHRob3VnaCBpdCB3ZXJlIGp1c3QgY3JlYXRlZCBieSBjb25zdHJ1Y3RvclxuICAgICAgICAgICAgY29uc3RydWN0b3IuYXBwbHkob2JqZWN0LCBhcmdzKTtcbiAgICAgICAgfSxcbiAgICAgICAgZGVmYXVsdE9wdGlvbnM6IGZ1bmN0aW9uIChkZWZhdWx0T3B0aW9ucywgb3ZlcnJpZGluZ09wdGlvbnMpIHtcbiAgICAgICAgICAgIGRlZmF1bHRPcHRpb25zID0gZGVmYXVsdE9wdGlvbnMgfHwge307XG4gICAgICAgICAgICBvdmVycmlkaW5nT3B0aW9ucyA9IG92ZXJyaWRpbmdPcHRpb25zIHx8IHt9O1xuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRPcHRpb25zLCBvdmVycmlkaW5nT3B0aW9ucyk7XG4gICAgICAgIH0sXG4gICAgICAgIG9wdGlvbnNPdmVycmlkZTogZnVuY3Rpb24gKG9wdGlvbnMsIHdpbm5lciwgbG9zZXIsIGlzRGVwcmVjYXRlZCwgbG9nZ2VyLCBkZWZhdWx0VmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChpc0RlcHJlY2F0ZWQgJiYgb3B0aW9uc1tsb3Nlcl0pIHtcbiAgICAgICAgICAgICAgICBsb2dnZXIud2Fybihsb3NlciArICcgaXMgZGVwcmVjYXRlZCwgcGxlYXNlIHVzZSAnICsgd2lubmVyICsgJyBpbnN0ZWFkJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAob3B0aW9uc1t3aW5uZXJdICYmIG9wdGlvbnNbbG9zZXJdKSB7XG4gICAgICAgICAgICAgICAgbG9nZ2VyLndhcm4od2lubmVyICsgJyBvdmVycmlkaW5nICcgKyBsb3Nlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvcHRpb25zW3dpbm5lcl0gPSBvcHRpb25zW3dpbm5lcl0gfHwgb3B0aW9uc1tsb3Nlcl0gfHwgZGVmYXVsdFZhbHVlO1xuICAgICAgICB9LFxuICAgICAgICBzdHJfdXRmOF9sZW5ndGg6IGZ1bmN0aW9uIChzdHJpbmcpIHtcbiAgICAgICAgICAgIHJldHVybiBlbmNvZGVVUklDb21wb25lbnQoc3RyaW5nKS5yZXBsYWNlKC8lW0EtRlxcZF17Mn0vZywgJ1UnKS5sZW5ndGg7XG4gICAgICAgIH0sXG4gICAgICAgIGdlbmVyYXRlRmFrZVNEUDogZnVuY3Rpb24gKGJvZHkpIHtcbiAgICAgICAgICAgIGlmICghYm9keSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBzdGFydCA9IGJvZHkuaW5kZXhPZignbz0nKTtcbiAgICAgICAgICAgIHZhciBlbmQgPSBib2R5LmluZGV4T2YoJ1xcclxcbicsIHN0YXJ0KTtcbiAgICAgICAgICAgIHJldHVybiAndj0wXFxyXFxuJyArIGJvZHkuc2xpY2Uoc3RhcnQsIGVuZCkgKyAnXFxyXFxucz0tXFxyXFxudD0wIDBcXHJcXG5jPUlOIElQNCAwLjAuMC4wJztcbiAgICAgICAgfSxcbiAgICAgICAgaXNGdW5jdGlvbjogZnVuY3Rpb24gKGZuKSB7XG4gICAgICAgICAgICBpZiAoZm4gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoZm4pID09PSAnW29iamVjdCBGdW5jdGlvbl0nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBpc0RlY2ltYWw6IGZ1bmN0aW9uIChudW0pIHtcbiAgICAgICAgICAgIHJldHVybiAhaXNOYU4obnVtKSAmJiAocGFyc2VGbG9hdChudW0pID09PSBwYXJzZUludChudW0sIDEwKSk7XG4gICAgICAgIH0sXG4gICAgICAgIGNyZWF0ZVJhbmRvbVRva2VuOiBmdW5jdGlvbiAoc2l6ZSwgYmFzZSkge1xuICAgICAgICAgICAgdmFyIGksIHIsIHRva2VuID0gJyc7XG4gICAgICAgICAgICBiYXNlID0gYmFzZSB8fCAzMjtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzaXplOyBpKyspIHtcbiAgICAgICAgICAgICAgICByID0gTWF0aC5yYW5kb20oKSAqIGJhc2UgfCAwO1xuICAgICAgICAgICAgICAgIHRva2VuICs9IHIudG9TdHJpbmcoYmFzZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdG9rZW47XG4gICAgICAgIH0sXG4gICAgICAgIG5ld1RhZzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIFNJUC5VdGlscy5jcmVhdGVSYW5kb21Ub2tlbihTSVAuVUEuQy5UQUdfTEVOR1RIKTtcbiAgICAgICAgfSxcbiAgICAgICAgLy8gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3VzZXJzLzEwOTUzOC9icm9vZmFcbiAgICAgICAgbmV3VVVJRDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIFVVSUQgPSAneHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4Jy5yZXBsYWNlKC9beHldL2csIGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICAgICAgdmFyIHIgPSBNYXRoLnJhbmRvbSgpICogMTYgfCAwLCB2ID0gYyA9PT0gJ3gnID8gciA6IChyICYgMHgzIHwgMHg4KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdi50b1N0cmluZygxNik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBVVUlEO1xuICAgICAgICB9LFxuICAgICAgICBob3N0VHlwZTogZnVuY3Rpb24gKGhvc3QpIHtcbiAgICAgICAgICAgIGlmICghaG9zdCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGhvc3QgPSBTSVAuR3JhbW1hci5wYXJzZShob3N0LCAnaG9zdCcpO1xuICAgICAgICAgICAgICAgIGlmIChob3N0ICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaG9zdC5ob3N0X3R5cGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICAvKipcbiAgICAgICAgKiBOb3JtYWxpemUgU0lQIFVSSS5cbiAgICAgICAgKiBOT1RFOiBJdCBkb2VzIG5vdCBhbGxvdyBhIFNJUCBVUkkgd2l0aG91dCB1c2VybmFtZS5cbiAgICAgICAgKiBBY2NlcHRzICdzaXAnLCAnc2lwcycgYW5kICd0ZWwnIFVSSXMgYW5kIGNvbnZlcnQgdGhlbSBpbnRvICdzaXAnLlxuICAgICAgICAqIERldGVjdHMgdGhlIGRvbWFpbiBwYXJ0IChpZiBnaXZlbikgYW5kIHByb3Blcmx5IGhleC1lc2NhcGVzIHRoZSB1c2VyIHBvcnRpb24uXG4gICAgICAgICogSWYgdGhlIHVzZXIgcG9ydGlvbiBoYXMgb25seSAndGVsJyBudW1iZXIgc3ltYm9scyB0aGUgdXNlciBwb3J0aW9uIGlzIGNsZWFuIG9mICd0ZWwnIHZpc3VhbCBzZXBhcmF0b3JzLlxuICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHRhcmdldFxuICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbZG9tYWluXVxuICAgICAgICAqL1xuICAgICAgICBub3JtYWxpemVUYXJnZXQ6IGZ1bmN0aW9uICh0YXJnZXQsIGRvbWFpbikge1xuICAgICAgICAgICAgdmFyIHVyaSwgdGFyZ2V0X2FycmF5LCB0YXJnZXRfdXNlciwgdGFyZ2V0X2RvbWFpbjtcbiAgICAgICAgICAgIC8vIElmIG5vIHRhcmdldCBpcyBnaXZlbiB0aGVuIHJhaXNlIGFuIGVycm9yLlxuICAgICAgICAgICAgaWYgKCF0YXJnZXQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgLy8gSWYgYSBTSVAuVVJJIGluc3RhbmNlIGlzIGdpdmVuIHRoZW4gcmV0dXJuIGl0LlxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGFyZ2V0IGluc3RhbmNlb2YgU0lQLlVSSSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0YXJnZXQ7XG4gICAgICAgICAgICAgICAgLy8gSWYgYSBzdHJpbmcgaXMgZ2l2ZW4gc3BsaXQgaXQgYnkgJ0AnOlxuICAgICAgICAgICAgICAgIC8vIC0gTGFzdCBmcmFnbWVudCBpcyB0aGUgZGVzaXJlZCBkb21haW4uXG4gICAgICAgICAgICAgICAgLy8gLSBPdGhlcndpc2UgYXBwZW5kIHRoZSBnaXZlbiBkb21haW4gYXJndW1lbnQuXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdGFyZ2V0ID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIHRhcmdldF9hcnJheSA9IHRhcmdldC5zcGxpdCgnQCcpO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodGFyZ2V0X2FycmF5Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWRvbWFpbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldF91c2VyID0gdGFyZ2V0O1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X2RvbWFpbiA9IGRvbWFpbjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRfdXNlciA9IHRhcmdldF9hcnJheVswXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldF9kb21haW4gPSB0YXJnZXRfYXJyYXlbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldF91c2VyID0gdGFyZ2V0X2FycmF5LnNsaWNlKDAsIHRhcmdldF9hcnJheS5sZW5ndGggLSAxKS5qb2luKCdAJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRfZG9tYWluID0gdGFyZ2V0X2FycmF5W3RhcmdldF9hcnJheS5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHRoZSBVUkkgc2NoZW1lIChpZiBwcmVzZW50KS5cbiAgICAgICAgICAgICAgICB0YXJnZXRfdXNlciA9IHRhcmdldF91c2VyLnJlcGxhY2UoL14oc2lwcz98dGVsKTovaSwgJycpO1xuICAgICAgICAgICAgICAgIC8vIFJlbW92ZSAndGVsJyB2aXN1YWwgc2VwYXJhdG9ycyBpZiB0aGUgdXNlciBwb3J0aW9uIGp1c3QgY29udGFpbnMgJ3RlbCcgbnVtYmVyIHN5bWJvbHMuXG4gICAgICAgICAgICAgICAgaWYgKC9eW1xcLVxcLlxcKFxcKV0qXFwrP1swLTlcXC1cXC5cXChcXCldKyQvLnRlc3QodGFyZ2V0X3VzZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldF91c2VyID0gdGFyZ2V0X3VzZXIucmVwbGFjZSgvW1xcLVxcLlxcKFxcKV0vZywgJycpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBCdWlsZCB0aGUgY29tcGxldGUgU0lQIFVSSS5cbiAgICAgICAgICAgICAgICB0YXJnZXQgPSBTSVAuQy5TSVAgKyAnOicgKyBTSVAuVXRpbHMuZXNjYXBlVXNlcih0YXJnZXRfdXNlcikgKyAnQCcgKyB0YXJnZXRfZG9tYWluO1xuICAgICAgICAgICAgICAgIC8vIEZpbmFsbHkgcGFyc2UgdGhlIHJlc3VsdGluZyBVUkkuXG4gICAgICAgICAgICAgICAgdXJpID0gU0lQLlVSSS5wYXJzZSh0YXJnZXQpO1xuICAgICAgICAgICAgICAgIHJldHVybiB1cmk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICAqIEhleC1lc2NhcGUgYSBTSVAgVVJJIHVzZXIuXG4gICAgICAgICogQHByaXZhdGVcbiAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gdXNlclxuICAgICAgICAqL1xuICAgICAgICBlc2NhcGVVc2VyOiBmdW5jdGlvbiAodXNlcikge1xuICAgICAgICAgICAgLy8gRG9uJ3QgaGV4LWVzY2FwZSAnOicgKCUzQSksICcrJyAoJTJCKSwgJz8nICglM0ZcIiksICcvJyAoJTJGKS5cbiAgICAgICAgICAgIHJldHVybiBlbmNvZGVVUklDb21wb25lbnQoZGVjb2RlVVJJQ29tcG9uZW50KHVzZXIpKS5yZXBsYWNlKC8lM0EvaWcsICc6JykucmVwbGFjZSgvJTJCL2lnLCAnKycpLnJlcGxhY2UoLyUzRi9pZywgJz8nKS5yZXBsYWNlKC8lMkYvaWcsICcvJyk7XG4gICAgICAgIH0sXG4gICAgICAgIGhlYWRlcml6ZTogZnVuY3Rpb24gKHN0cmluZykge1xuICAgICAgICAgICAgdmFyIGV4Y2VwdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgJ0NhbGwtSWQnOiAnQ2FsbC1JRCcsXG4gICAgICAgICAgICAgICAgJ0NzZXEnOiAnQ1NlcScsXG4gICAgICAgICAgICAgICAgJ01pbi1TZSc6ICdNaW4tU0UnLFxuICAgICAgICAgICAgICAgICdSYWNrJzogJ1JBY2snLFxuICAgICAgICAgICAgICAgICdSc2VxJzogJ1JTZXEnLFxuICAgICAgICAgICAgICAgICdXd3ctQXV0aGVudGljYXRlJzogJ1dXVy1BdXRoZW50aWNhdGUnXG4gICAgICAgICAgICB9LCBuYW1lID0gc3RyaW5nLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvXy9nLCAnLScpLnNwbGl0KCctJyksIGhuYW1lID0gJycsIHBhcnRzID0gbmFtZS5sZW5ndGgsIHBhcnQ7XG4gICAgICAgICAgICBmb3IgKHBhcnQgPSAwOyBwYXJ0IDwgcGFydHM7IHBhcnQrKykge1xuICAgICAgICAgICAgICAgIGlmIChwYXJ0ICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGhuYW1lICs9ICctJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaG5hbWUgKz0gbmFtZVtwYXJ0XS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIG5hbWVbcGFydF0uc3Vic3RyaW5nKDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGV4Y2VwdGlvbnNbaG5hbWVdKSB7XG4gICAgICAgICAgICAgICAgaG5hbWUgPSBleGNlcHRpb25zW2huYW1lXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBobmFtZTtcbiAgICAgICAgfSxcbiAgICAgICAgc2lwRXJyb3JDYXVzZTogZnVuY3Rpb24gKHN0YXR1c19jb2RlKSB7XG4gICAgICAgICAgICB2YXIgY2F1c2U7XG4gICAgICAgICAgICBmb3IgKGNhdXNlIGluIFNJUC5DLlNJUF9FUlJPUl9DQVVTRVMpIHtcbiAgICAgICAgICAgICAgICBpZiAoU0lQLkMuU0lQX0VSUk9SX0NBVVNFU1tjYXVzZV0uaW5kZXhPZihzdGF0dXNfY29kZSkgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBTSVAuQy5jYXVzZXNbY2F1c2VdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBTSVAuQy5jYXVzZXMuU0lQX0ZBSUxVUkVfQ09ERTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0UmVhc29uUGhyYXNlOiBmdW5jdGlvbiBnZXRSZWFzb25QaHJhc2UoY29kZSwgc3BlY2lmaWMpIHtcbiAgICAgICAgICAgIHJldHVybiBzcGVjaWZpYyB8fCBTSVAuQy5SRUFTT05fUEhSQVNFW2NvZGVdIHx8ICcnO1xuICAgICAgICB9LFxuICAgICAgICBnZXRSZWFzb25IZWFkZXJWYWx1ZTogZnVuY3Rpb24gZ2V0UmVhc29uSGVhZGVyVmFsdWUoY29kZSwgcmVhc29uKSB7XG4gICAgICAgICAgICByZWFzb24gPSBTSVAuVXRpbHMuZ2V0UmVhc29uUGhyYXNlKGNvZGUsIHJlYXNvbik7XG4gICAgICAgICAgICByZXR1cm4gJ1NJUDtjYXVzZT0nICsgY29kZSArICc7dGV4dD1cIicgKyByZWFzb24gKyAnXCInO1xuICAgICAgICB9LFxuICAgICAgICBnZXRDYW5jZWxSZWFzb246IGZ1bmN0aW9uIGdldENhbmNlbFJlYXNvbihjb2RlLCByZWFzb24pIHtcbiAgICAgICAgICAgIGlmIChjb2RlICYmIGNvZGUgPCAyMDAgfHwgY29kZSA+IDY5OSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0ludmFsaWQgc3RhdHVzX2NvZGU6ICcgKyBjb2RlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNvZGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gU0lQLlV0aWxzLmdldFJlYXNvbkhlYWRlclZhbHVlKGNvZGUsIHJlYXNvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGJ1aWxkU3RhdHVzTGluZTogZnVuY3Rpb24gYnVpbGRTdGF0dXNMaW5lKGNvZGUsIHJlYXNvbikge1xuICAgICAgICAgICAgY29kZSA9IGNvZGUgfHwgbnVsbDtcbiAgICAgICAgICAgIHJlYXNvbiA9IHJlYXNvbiB8fCBudWxsO1xuICAgICAgICAgICAgLy8gVmFsaWRhdGUgY29kZSBhbmQgcmVhc29uIHZhbHVlc1xuICAgICAgICAgICAgaWYgKCFjb2RlIHx8IChjb2RlIDwgMTAwIHx8IGNvZGUgPiA2OTkpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignSW52YWxpZCBzdGF0dXNfY29kZTogJyArIGNvZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocmVhc29uICYmIHR5cGVvZiByZWFzb24gIT09ICdzdHJpbmcnICYmICEocmVhc29uIGluc3RhbmNlb2YgU3RyaW5nKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0ludmFsaWQgcmVhc29uX3BocmFzZTogJyArIHJlYXNvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZWFzb24gPSBVdGlscy5nZXRSZWFzb25QaHJhc2UoY29kZSwgcmVhc29uKTtcbiAgICAgICAgICAgIHJldHVybiAnU0lQLzIuMCAnICsgY29kZSArICcgJyArIHJlYXNvbiArICdcXHJcXG4nO1xuICAgICAgICB9LFxuICAgICAgICAvKipcbiAgICAgICAgKiBHZW5lcmF0ZSBhIHJhbmRvbSBUZXN0LU5ldCBJUCAoaHR0cDovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjNTczNSlcbiAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAqL1xuICAgICAgICBnZXRSYW5kb21UZXN0TmV0SVA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldE9jdGV0KGZyb20sIHRvKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICh0byAtIGZyb20gKyAxKSArIGZyb20pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICcxOTIuMC4yLicgKyBnZXRPY3RldCgxLCAyNTQpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBTSVAuVXRpbHMgPSBVdGlscztcbn07XG5cblxuLyoqKi8gfSksXG4vKiA0ICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblwidXNlIHN0cmljdFwiO1xuXG52YXIgbGV2ZWxzID0ge1xuICAgICdlcnJvcic6IDAsXG4gICAgJ3dhcm4nOiAxLFxuICAgICdsb2cnOiAyLFxuICAgICdkZWJ1Zyc6IDNcbn07XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChjb25zb2xlKSB7XG4gICAgdmFyIExvZ2dlckZhY3RvcnkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBsb2dnZXIsIGxldmVsID0gMiwgYnVpbHRpbkVuYWJsZWQgPSB0cnVlLCBjb25uZWN0b3IgPSBudWxsO1xuICAgICAgICB0aGlzLmxvZ2dlcnMgPSB7fTtcbiAgICAgICAgbG9nZ2VyID0gdGhpcy5nZXRMb2dnZXIoJ3NpcC5sb2dnZXJmYWN0b3J5Jyk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMsIHtcbiAgICAgICAgICAgIGJ1aWx0aW5FbmFibGVkOiB7XG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBidWlsdGluRW5hYmxlZDsgfSxcbiAgICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1aWx0aW5FbmFibGVkID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoJ2ludmFsaWQgXCJidWlsdGluRW5hYmxlZFwiIHBhcmFtZXRlciB2YWx1ZTogJyArIEpTT04uc3RyaW5naWZ5KHZhbHVlKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGV2ZWw6IHtcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGxldmVsOyB9LFxuICAgICAgICAgICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA+PSAwICYmIHZhbHVlIDw9IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldmVsID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPiAzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXZlbCA9IDM7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAobGV2ZWxzLmhhc093blByb3BlcnR5KHZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV2ZWwgPSBsZXZlbHNbdmFsdWVdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCdpbnZhbGlkIFwibGV2ZWxcIiBwYXJhbWV0ZXIgdmFsdWU6ICcgKyBKU09OLnN0cmluZ2lmeSh2YWx1ZSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbm5lY3Rvcjoge1xuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gY29ubmVjdG9yOyB9LFxuICAgICAgICAgICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gXCJcIiB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25uZWN0b3IgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVjdG9yID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoJ2ludmFsaWQgXCJjb25uZWN0b3JcIiBwYXJhbWV0ZXIgdmFsdWU6ICcgKyBKU09OLnN0cmluZ2lmeSh2YWx1ZSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIExvZ2dlckZhY3RvcnkucHJvdG90eXBlLnByaW50ID0gZnVuY3Rpb24gKHRhcmdldCwgY2F0ZWdvcnksIGxhYmVsLCBjb250ZW50KSB7XG4gICAgICAgIGlmICh0eXBlb2YgY29udGVudCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHZhciBwcmVmaXggPSBbbmV3IERhdGUoKSwgY2F0ZWdvcnldO1xuICAgICAgICAgICAgaWYgKGxhYmVsKSB7XG4gICAgICAgICAgICAgICAgcHJlZml4LnB1c2gobGFiZWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29udGVudCA9IHByZWZpeC5jb25jYXQoY29udGVudCkuam9pbignIHwgJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGFyZ2V0LmNhbGwoY29uc29sZSwgY29udGVudCk7XG4gICAgfTtcbiAgICBmdW5jdGlvbiBMb2dnZXIobG9nZ2VyLCBjYXRlZ29yeSwgbGFiZWwpIHtcbiAgICAgICAgdGhpcy5sb2dnZXIgPSBsb2dnZXI7XG4gICAgICAgIHRoaXMuY2F0ZWdvcnkgPSBjYXRlZ29yeTtcbiAgICAgICAgdGhpcy5sYWJlbCA9IGxhYmVsO1xuICAgIH1cbiAgICBPYmplY3Qua2V5cyhsZXZlbHMpLmZvckVhY2goZnVuY3Rpb24gKHRhcmdldE5hbWUpIHtcbiAgICAgICAgTG9nZ2VyLnByb3RvdHlwZVt0YXJnZXROYW1lXSA9IGZ1bmN0aW9uIChjb250ZW50KSB7XG4gICAgICAgICAgICB0aGlzLmxvZ2dlclt0YXJnZXROYW1lXSh0aGlzLmNhdGVnb3J5LCB0aGlzLmxhYmVsLCBjb250ZW50KTtcbiAgICAgICAgfTtcbiAgICAgICAgTG9nZ2VyRmFjdG9yeS5wcm90b3R5cGVbdGFyZ2V0TmFtZV0gPSBmdW5jdGlvbiAoY2F0ZWdvcnksIGxhYmVsLCBjb250ZW50KSB7XG4gICAgICAgICAgICBpZiAodGhpcy5sZXZlbCA+PSBsZXZlbHNbdGFyZ2V0TmFtZV0pIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5idWlsdGluRW5hYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnByaW50KGNvbnNvbGVbdGFyZ2V0TmFtZV0sIGNhdGVnb3J5LCBsYWJlbCwgY29udGVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbm5lY3Rvcikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3Rvcih0YXJnZXROYW1lLCBjYXRlZ29yeSwgbGFiZWwsIGNvbnRlbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbiAgICBMb2dnZXJGYWN0b3J5LnByb3RvdHlwZS5nZXRMb2dnZXIgPSBmdW5jdGlvbiAoY2F0ZWdvcnksIGxhYmVsKSB7XG4gICAgICAgIHZhciBsb2dnZXI7XG4gICAgICAgIGlmIChsYWJlbCAmJiB0aGlzLmxldmVsID09PSAzKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IExvZ2dlcih0aGlzLCBjYXRlZ29yeSwgbGFiZWwpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMubG9nZ2Vyc1tjYXRlZ29yeV0pIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxvZ2dlcnNbY2F0ZWdvcnldO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbG9nZ2VyID0gbmV3IExvZ2dlcih0aGlzLCBjYXRlZ29yeSk7XG4gICAgICAgICAgICB0aGlzLmxvZ2dlcnNbY2F0ZWdvcnldID0gbG9nZ2VyO1xuICAgICAgICAgICAgcmV0dXJuIGxvZ2dlcjtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIExvZ2dlckZhY3Rvcnk7XG59O1xuXG5cbi8qKiovIH0pLFxuLyogNSAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cInVzZSBzdHJpY3RcIjtcblxudmFyIE5vZGVFdmVudEVtaXR0ZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYpLkV2ZW50RW1pdHRlcjtcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKCkge1xuICAgIC8vIERvbid0IHVzZSBgbmV3IFNJUC5FdmVudEVtaXR0ZXIoKWAgZm9yIGluaGVyaXRpbmcuXG4gICAgLy8gVXNlIE9iamVjdC5jcmVhdGUoU0lQLkV2ZW50RW1pdHRlci5wcm90b3RveXBlKTtcbiAgICBmdW5jdGlvbiBFdmVudEVtaXR0ZXIoKSB7XG4gICAgICAgIE5vZGVFdmVudEVtaXR0ZXIuY2FsbCh0aGlzKTtcbiAgICB9XG4gICAgRXZlbnRFbWl0dGVyLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoTm9kZUV2ZW50RW1pdHRlci5wcm90b3R5cGUsIHtcbiAgICAgICAgY29uc3RydWN0b3I6IHtcbiAgICAgICAgICAgIHZhbHVlOiBFdmVudEVtaXR0ZXIsXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gRXZlbnRFbWl0dGVyO1xufTtcblxuXG4vKioqLyB9KSxcbi8qIDYgKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHtcblxuLy8gQ29weXJpZ2h0IEpveWVudCwgSW5jLiBhbmQgb3RoZXIgTm9kZSBjb250cmlidXRvcnMuXG4vL1xuLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGFcbi8vIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGVcbi8vIFwiU29mdHdhcmVcIiksIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZ1xuLy8gd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLFxuLy8gZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdFxuLy8gcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlXG4vLyBmb2xsb3dpbmcgY29uZGl0aW9uczpcbi8vXG4vLyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZFxuLy8gaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4vL1xuLy8gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTU1xuLy8gT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRlxuLy8gTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTlxuLy8gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sXG4vLyBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1Jcbi8vIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEVcbi8vIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuXG5cbmZ1bmN0aW9uIEV2ZW50RW1pdHRlcigpIHtcbiAgdGhpcy5fZXZlbnRzID0gdGhpcy5fZXZlbnRzIHx8IHt9O1xuICB0aGlzLl9tYXhMaXN0ZW5lcnMgPSB0aGlzLl9tYXhMaXN0ZW5lcnMgfHwgdW5kZWZpbmVkO1xufVxubW9kdWxlLmV4cG9ydHMgPSBFdmVudEVtaXR0ZXI7XG5cbi8vIEJhY2t3YXJkcy1jb21wYXQgd2l0aCBub2RlIDAuMTAueFxuRXZlbnRFbWl0dGVyLkV2ZW50RW1pdHRlciA9IEV2ZW50RW1pdHRlcjtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5fZXZlbnRzID0gdW5kZWZpbmVkO1xuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5fbWF4TGlzdGVuZXJzID0gdW5kZWZpbmVkO1xuXG4vLyBCeSBkZWZhdWx0IEV2ZW50RW1pdHRlcnMgd2lsbCBwcmludCBhIHdhcm5pbmcgaWYgbW9yZSB0aGFuIDEwIGxpc3RlbmVycyBhcmVcbi8vIGFkZGVkIHRvIGl0LiBUaGlzIGlzIGEgdXNlZnVsIGRlZmF1bHQgd2hpY2ggaGVscHMgZmluZGluZyBtZW1vcnkgbGVha3MuXG5FdmVudEVtaXR0ZXIuZGVmYXVsdE1heExpc3RlbmVycyA9IDEwO1xuXG4vLyBPYnZpb3VzbHkgbm90IGFsbCBFbWl0dGVycyBzaG91bGQgYmUgbGltaXRlZCB0byAxMC4gVGhpcyBmdW5jdGlvbiBhbGxvd3Ncbi8vIHRoYXQgdG8gYmUgaW5jcmVhc2VkLiBTZXQgdG8gemVybyBmb3IgdW5saW1pdGVkLlxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5zZXRNYXhMaXN0ZW5lcnMgPSBmdW5jdGlvbihuKSB7XG4gIGlmICghaXNOdW1iZXIobikgfHwgbiA8IDAgfHwgaXNOYU4obikpXG4gICAgdGhyb3cgVHlwZUVycm9yKCduIG11c3QgYmUgYSBwb3NpdGl2ZSBudW1iZXInKTtcbiAgdGhpcy5fbWF4TGlzdGVuZXJzID0gbjtcbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLmVtaXQgPSBmdW5jdGlvbih0eXBlKSB7XG4gIHZhciBlciwgaGFuZGxlciwgbGVuLCBhcmdzLCBpLCBsaXN0ZW5lcnM7XG5cbiAgaWYgKCF0aGlzLl9ldmVudHMpXG4gICAgdGhpcy5fZXZlbnRzID0ge307XG5cbiAgLy8gSWYgdGhlcmUgaXMgbm8gJ2Vycm9yJyBldmVudCBsaXN0ZW5lciB0aGVuIHRocm93LlxuICBpZiAodHlwZSA9PT0gJ2Vycm9yJykge1xuICAgIGlmICghdGhpcy5fZXZlbnRzLmVycm9yIHx8XG4gICAgICAgIChpc09iamVjdCh0aGlzLl9ldmVudHMuZXJyb3IpICYmICF0aGlzLl9ldmVudHMuZXJyb3IubGVuZ3RoKSkge1xuICAgICAgZXIgPSBhcmd1bWVudHNbMV07XG4gICAgICBpZiAoZXIgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICB0aHJvdyBlcjsgLy8gVW5oYW5kbGVkICdlcnJvcicgZXZlbnRcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEF0IGxlYXN0IGdpdmUgc29tZSBraW5kIG9mIGNvbnRleHQgdG8gdGhlIHVzZXJcbiAgICAgICAgdmFyIGVyciA9IG5ldyBFcnJvcignVW5jYXVnaHQsIHVuc3BlY2lmaWVkIFwiZXJyb3JcIiBldmVudC4gKCcgKyBlciArICcpJyk7XG4gICAgICAgIGVyci5jb250ZXh0ID0gZXI7XG4gICAgICAgIHRocm93IGVycjtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBoYW5kbGVyID0gdGhpcy5fZXZlbnRzW3R5cGVdO1xuXG4gIGlmIChpc1VuZGVmaW5lZChoYW5kbGVyKSlcbiAgICByZXR1cm4gZmFsc2U7XG5cbiAgaWYgKGlzRnVuY3Rpb24oaGFuZGxlcikpIHtcbiAgICBzd2l0Y2ggKGFyZ3VtZW50cy5sZW5ndGgpIHtcbiAgICAgIC8vIGZhc3QgY2FzZXNcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgaGFuZGxlci5jYWxsKHRoaXMpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgaGFuZGxlci5jYWxsKHRoaXMsIGFyZ3VtZW50c1sxXSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBoYW5kbGVyLmNhbGwodGhpcywgYXJndW1lbnRzWzFdLCBhcmd1bWVudHNbMl0pO1xuICAgICAgICBicmVhaztcbiAgICAgIC8vIHNsb3dlclxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7XG4gICAgICAgIGhhbmRsZXIuYXBwbHkodGhpcywgYXJncyk7XG4gICAgfVxuICB9IGVsc2UgaWYgKGlzT2JqZWN0KGhhbmRsZXIpKSB7XG4gICAgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7XG4gICAgbGlzdGVuZXJzID0gaGFuZGxlci5zbGljZSgpO1xuICAgIGxlbiA9IGxpc3RlbmVycy5sZW5ndGg7XG4gICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKVxuICAgICAgbGlzdGVuZXJzW2ldLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICB9XG5cbiAgcmV0dXJuIHRydWU7XG59O1xuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLmFkZExpc3RlbmVyID0gZnVuY3Rpb24odHlwZSwgbGlzdGVuZXIpIHtcbiAgdmFyIG07XG5cbiAgaWYgKCFpc0Z1bmN0aW9uKGxpc3RlbmVyKSlcbiAgICB0aHJvdyBUeXBlRXJyb3IoJ2xpc3RlbmVyIG11c3QgYmUgYSBmdW5jdGlvbicpO1xuXG4gIGlmICghdGhpcy5fZXZlbnRzKVxuICAgIHRoaXMuX2V2ZW50cyA9IHt9O1xuXG4gIC8vIFRvIGF2b2lkIHJlY3Vyc2lvbiBpbiB0aGUgY2FzZSB0aGF0IHR5cGUgPT09IFwibmV3TGlzdGVuZXJcIiEgQmVmb3JlXG4gIC8vIGFkZGluZyBpdCB0byB0aGUgbGlzdGVuZXJzLCBmaXJzdCBlbWl0IFwibmV3TGlzdGVuZXJcIi5cbiAgaWYgKHRoaXMuX2V2ZW50cy5uZXdMaXN0ZW5lcilcbiAgICB0aGlzLmVtaXQoJ25ld0xpc3RlbmVyJywgdHlwZSxcbiAgICAgICAgICAgICAgaXNGdW5jdGlvbihsaXN0ZW5lci5saXN0ZW5lcikgP1xuICAgICAgICAgICAgICBsaXN0ZW5lci5saXN0ZW5lciA6IGxpc3RlbmVyKTtcblxuICBpZiAoIXRoaXMuX2V2ZW50c1t0eXBlXSlcbiAgICAvLyBPcHRpbWl6ZSB0aGUgY2FzZSBvZiBvbmUgbGlzdGVuZXIuIERvbid0IG5lZWQgdGhlIGV4dHJhIGFycmF5IG9iamVjdC5cbiAgICB0aGlzLl9ldmVudHNbdHlwZV0gPSBsaXN0ZW5lcjtcbiAgZWxzZSBpZiAoaXNPYmplY3QodGhpcy5fZXZlbnRzW3R5cGVdKSlcbiAgICAvLyBJZiB3ZSd2ZSBhbHJlYWR5IGdvdCBhbiBhcnJheSwganVzdCBhcHBlbmQuXG4gICAgdGhpcy5fZXZlbnRzW3R5cGVdLnB1c2gobGlzdGVuZXIpO1xuICBlbHNlXG4gICAgLy8gQWRkaW5nIHRoZSBzZWNvbmQgZWxlbWVudCwgbmVlZCB0byBjaGFuZ2UgdG8gYXJyYXkuXG4gICAgdGhpcy5fZXZlbnRzW3R5cGVdID0gW3RoaXMuX2V2ZW50c1t0eXBlXSwgbGlzdGVuZXJdO1xuXG4gIC8vIENoZWNrIGZvciBsaXN0ZW5lciBsZWFrXG4gIGlmIChpc09iamVjdCh0aGlzLl9ldmVudHNbdHlwZV0pICYmICF0aGlzLl9ldmVudHNbdHlwZV0ud2FybmVkKSB7XG4gICAgaWYgKCFpc1VuZGVmaW5lZCh0aGlzLl9tYXhMaXN0ZW5lcnMpKSB7XG4gICAgICBtID0gdGhpcy5fbWF4TGlzdGVuZXJzO1xuICAgIH0gZWxzZSB7XG4gICAgICBtID0gRXZlbnRFbWl0dGVyLmRlZmF1bHRNYXhMaXN0ZW5lcnM7XG4gICAgfVxuXG4gICAgaWYgKG0gJiYgbSA+IDAgJiYgdGhpcy5fZXZlbnRzW3R5cGVdLmxlbmd0aCA+IG0pIHtcbiAgICAgIHRoaXMuX2V2ZW50c1t0eXBlXS53YXJuZWQgPSB0cnVlO1xuICAgICAgY29uc29sZS5lcnJvcignKG5vZGUpIHdhcm5pbmc6IHBvc3NpYmxlIEV2ZW50RW1pdHRlciBtZW1vcnkgJyArXG4gICAgICAgICAgICAgICAgICAgICdsZWFrIGRldGVjdGVkLiAlZCBsaXN0ZW5lcnMgYWRkZWQuICcgK1xuICAgICAgICAgICAgICAgICAgICAnVXNlIGVtaXR0ZXIuc2V0TWF4TGlzdGVuZXJzKCkgdG8gaW5jcmVhc2UgbGltaXQuJyxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZXZlbnRzW3R5cGVdLmxlbmd0aCk7XG4gICAgICBpZiAodHlwZW9mIGNvbnNvbGUudHJhY2UgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgLy8gbm90IHN1cHBvcnRlZCBpbiBJRSAxMFxuICAgICAgICBjb25zb2xlLnRyYWNlKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLm9uID0gRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5hZGRMaXN0ZW5lcjtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5vbmNlID0gZnVuY3Rpb24odHlwZSwgbGlzdGVuZXIpIHtcbiAgaWYgKCFpc0Z1bmN0aW9uKGxpc3RlbmVyKSlcbiAgICB0aHJvdyBUeXBlRXJyb3IoJ2xpc3RlbmVyIG11c3QgYmUgYSBmdW5jdGlvbicpO1xuXG4gIHZhciBmaXJlZCA9IGZhbHNlO1xuXG4gIGZ1bmN0aW9uIGcoKSB7XG4gICAgdGhpcy5yZW1vdmVMaXN0ZW5lcih0eXBlLCBnKTtcblxuICAgIGlmICghZmlyZWQpIHtcbiAgICAgIGZpcmVkID0gdHJ1ZTtcbiAgICAgIGxpc3RlbmVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgfVxuICB9XG5cbiAgZy5saXN0ZW5lciA9IGxpc3RlbmVyO1xuICB0aGlzLm9uKHR5cGUsIGcpO1xuXG4gIHJldHVybiB0aGlzO1xufTtcblxuLy8gZW1pdHMgYSAncmVtb3ZlTGlzdGVuZXInIGV2ZW50IGlmZiB0aGUgbGlzdGVuZXIgd2FzIHJlbW92ZWRcbkV2ZW50RW1pdHRlci5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXIgPSBmdW5jdGlvbih0eXBlLCBsaXN0ZW5lcikge1xuICB2YXIgbGlzdCwgcG9zaXRpb24sIGxlbmd0aCwgaTtcblxuICBpZiAoIWlzRnVuY3Rpb24obGlzdGVuZXIpKVxuICAgIHRocm93IFR5cGVFcnJvcignbGlzdGVuZXIgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7XG5cbiAgaWYgKCF0aGlzLl9ldmVudHMgfHwgIXRoaXMuX2V2ZW50c1t0eXBlXSlcbiAgICByZXR1cm4gdGhpcztcblxuICBsaXN0ID0gdGhpcy5fZXZlbnRzW3R5cGVdO1xuICBsZW5ndGggPSBsaXN0Lmxlbmd0aDtcbiAgcG9zaXRpb24gPSAtMTtcblxuICBpZiAobGlzdCA9PT0gbGlzdGVuZXIgfHxcbiAgICAgIChpc0Z1bmN0aW9uKGxpc3QubGlzdGVuZXIpICYmIGxpc3QubGlzdGVuZXIgPT09IGxpc3RlbmVyKSkge1xuICAgIGRlbGV0ZSB0aGlzLl9ldmVudHNbdHlwZV07XG4gICAgaWYgKHRoaXMuX2V2ZW50cy5yZW1vdmVMaXN0ZW5lcilcbiAgICAgIHRoaXMuZW1pdCgncmVtb3ZlTGlzdGVuZXInLCB0eXBlLCBsaXN0ZW5lcik7XG5cbiAgfSBlbHNlIGlmIChpc09iamVjdChsaXN0KSkge1xuICAgIGZvciAoaSA9IGxlbmd0aDsgaS0tID4gMDspIHtcbiAgICAgIGlmIChsaXN0W2ldID09PSBsaXN0ZW5lciB8fFxuICAgICAgICAgIChsaXN0W2ldLmxpc3RlbmVyICYmIGxpc3RbaV0ubGlzdGVuZXIgPT09IGxpc3RlbmVyKSkge1xuICAgICAgICBwb3NpdGlvbiA9IGk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChwb3NpdGlvbiA8IDApXG4gICAgICByZXR1cm4gdGhpcztcblxuICAgIGlmIChsaXN0Lmxlbmd0aCA9PT0gMSkge1xuICAgICAgbGlzdC5sZW5ndGggPSAwO1xuICAgICAgZGVsZXRlIHRoaXMuX2V2ZW50c1t0eXBlXTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGlzdC5zcGxpY2UocG9zaXRpb24sIDEpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLl9ldmVudHMucmVtb3ZlTGlzdGVuZXIpXG4gICAgICB0aGlzLmVtaXQoJ3JlbW92ZUxpc3RlbmVyJywgdHlwZSwgbGlzdGVuZXIpO1xuICB9XG5cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLnJlbW92ZUFsbExpc3RlbmVycyA9IGZ1bmN0aW9uKHR5cGUpIHtcbiAgdmFyIGtleSwgbGlzdGVuZXJzO1xuXG4gIGlmICghdGhpcy5fZXZlbnRzKVxuICAgIHJldHVybiB0aGlzO1xuXG4gIC8vIG5vdCBsaXN0ZW5pbmcgZm9yIHJlbW92ZUxpc3RlbmVyLCBubyBuZWVkIHRvIGVtaXRcbiAgaWYgKCF0aGlzLl9ldmVudHMucmVtb3ZlTGlzdGVuZXIpIHtcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMClcbiAgICAgIHRoaXMuX2V2ZW50cyA9IHt9O1xuICAgIGVsc2UgaWYgKHRoaXMuX2V2ZW50c1t0eXBlXSlcbiAgICAgIGRlbGV0ZSB0aGlzLl9ldmVudHNbdHlwZV07XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvLyBlbWl0IHJlbW92ZUxpc3RlbmVyIGZvciBhbGwgbGlzdGVuZXJzIG9uIGFsbCBldmVudHNcbiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHtcbiAgICBmb3IgKGtleSBpbiB0aGlzLl9ldmVudHMpIHtcbiAgICAgIGlmIChrZXkgPT09ICdyZW1vdmVMaXN0ZW5lcicpIGNvbnRpbnVlO1xuICAgICAgdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoa2V5KTtcbiAgICB9XG4gICAgdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoJ3JlbW92ZUxpc3RlbmVyJyk7XG4gICAgdGhpcy5fZXZlbnRzID0ge307XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBsaXN0ZW5lcnMgPSB0aGlzLl9ldmVudHNbdHlwZV07XG5cbiAgaWYgKGlzRnVuY3Rpb24obGlzdGVuZXJzKSkge1xuICAgIHRoaXMucmVtb3ZlTGlzdGVuZXIodHlwZSwgbGlzdGVuZXJzKTtcbiAgfSBlbHNlIGlmIChsaXN0ZW5lcnMpIHtcbiAgICAvLyBMSUZPIG9yZGVyXG4gICAgd2hpbGUgKGxpc3RlbmVycy5sZW5ndGgpXG4gICAgICB0aGlzLnJlbW92ZUxpc3RlbmVyKHR5cGUsIGxpc3RlbmVyc1tsaXN0ZW5lcnMubGVuZ3RoIC0gMV0pO1xuICB9XG4gIGRlbGV0ZSB0aGlzLl9ldmVudHNbdHlwZV07XG5cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLmxpc3RlbmVycyA9IGZ1bmN0aW9uKHR5cGUpIHtcbiAgdmFyIHJldDtcbiAgaWYgKCF0aGlzLl9ldmVudHMgfHwgIXRoaXMuX2V2ZW50c1t0eXBlXSlcbiAgICByZXQgPSBbXTtcbiAgZWxzZSBpZiAoaXNGdW5jdGlvbih0aGlzLl9ldmVudHNbdHlwZV0pKVxuICAgIHJldCA9IFt0aGlzLl9ldmVudHNbdHlwZV1dO1xuICBlbHNlXG4gICAgcmV0ID0gdGhpcy5fZXZlbnRzW3R5cGVdLnNsaWNlKCk7XG4gIHJldHVybiByZXQ7XG59O1xuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLmxpc3RlbmVyQ291bnQgPSBmdW5jdGlvbih0eXBlKSB7XG4gIGlmICh0aGlzLl9ldmVudHMpIHtcbiAgICB2YXIgZXZsaXN0ZW5lciA9IHRoaXMuX2V2ZW50c1t0eXBlXTtcblxuICAgIGlmIChpc0Z1bmN0aW9uKGV2bGlzdGVuZXIpKVxuICAgICAgcmV0dXJuIDE7XG4gICAgZWxzZSBpZiAoZXZsaXN0ZW5lcilcbiAgICAgIHJldHVybiBldmxpc3RlbmVyLmxlbmd0aDtcbiAgfVxuICByZXR1cm4gMDtcbn07XG5cbkV2ZW50RW1pdHRlci5saXN0ZW5lckNvdW50ID0gZnVuY3Rpb24oZW1pdHRlciwgdHlwZSkge1xuICByZXR1cm4gZW1pdHRlci5saXN0ZW5lckNvdW50KHR5cGUpO1xufTtcblxuZnVuY3Rpb24gaXNGdW5jdGlvbihhcmcpIHtcbiAgcmV0dXJuIHR5cGVvZiBhcmcgPT09ICdmdW5jdGlvbic7XG59XG5cbmZ1bmN0aW9uIGlzTnVtYmVyKGFyZykge1xuICByZXR1cm4gdHlwZW9mIGFyZyA9PT0gJ251bWJlcic7XG59XG5cbmZ1bmN0aW9uIGlzT2JqZWN0KGFyZykge1xuICByZXR1cm4gdHlwZW9mIGFyZyA9PT0gJ29iamVjdCcgJiYgYXJnICE9PSBudWxsO1xufVxuXG5mdW5jdGlvbiBpc1VuZGVmaW5lZChhcmcpIHtcbiAgcmV0dXJuIGFyZyA9PT0gdm9pZCAwO1xufVxuXG5cbi8qKiovIH0pLFxuLyogNyAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cInVzZSBzdHJpY3RcIjtcblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IFNJUCBDb25zdGFudHNcbiAqL1xuLyoqXG4gKiBTSVAgQ29uc3RhbnRzLlxuICogQGF1Z21lbnRzIFNJUFxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChuYW1lLCB2ZXJzaW9uKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgVVNFUl9BR0VOVDogbmFtZSArICcvJyArIHZlcnNpb24sXG4gICAgICAgIC8vIFNJUCBzY2hlbWVcbiAgICAgICAgU0lQOiAnc2lwJyxcbiAgICAgICAgU0lQUzogJ3NpcHMnLFxuICAgICAgICAvLyBFbmQgYW5kIEZhaWx1cmUgY2F1c2VzXG4gICAgICAgIGNhdXNlczoge1xuICAgICAgICAgICAgLy8gR2VuZXJpYyBlcnJvciBjYXVzZXNcbiAgICAgICAgICAgIENPTk5FQ1RJT05fRVJST1I6ICdDb25uZWN0aW9uIEVycm9yJyxcbiAgICAgICAgICAgIFJFUVVFU1RfVElNRU9VVDogJ1JlcXVlc3QgVGltZW91dCcsXG4gICAgICAgICAgICBTSVBfRkFJTFVSRV9DT0RFOiAnU0lQIEZhaWx1cmUgQ29kZScsXG4gICAgICAgICAgICBJTlRFUk5BTF9FUlJPUjogJ0ludGVybmFsIEVycm9yJyxcbiAgICAgICAgICAgIC8vIFNJUCBlcnJvciBjYXVzZXNcbiAgICAgICAgICAgIEJVU1k6ICdCdXN5JyxcbiAgICAgICAgICAgIFJFSkVDVEVEOiAnUmVqZWN0ZWQnLFxuICAgICAgICAgICAgUkVESVJFQ1RFRDogJ1JlZGlyZWN0ZWQnLFxuICAgICAgICAgICAgVU5BVkFJTEFCTEU6ICdVbmF2YWlsYWJsZScsXG4gICAgICAgICAgICBOT1RfRk9VTkQ6ICdOb3QgRm91bmQnLFxuICAgICAgICAgICAgQUREUkVTU19JTkNPTVBMRVRFOiAnQWRkcmVzcyBJbmNvbXBsZXRlJyxcbiAgICAgICAgICAgIElOQ09NUEFUSUJMRV9TRFA6ICdJbmNvbXBhdGlibGUgU0RQJyxcbiAgICAgICAgICAgIEFVVEhFTlRJQ0FUSU9OX0VSUk9SOiAnQXV0aGVudGljYXRpb24gRXJyb3InLFxuICAgICAgICAgICAgRElBTE9HX0VSUk9SOiAnRGlhbG9nIEVycm9yJyxcbiAgICAgICAgICAgIC8vIFNlc3Npb24gZXJyb3IgY2F1c2VzXG4gICAgICAgICAgICBXRUJSVENfTk9UX1NVUFBPUlRFRDogJ1dlYlJUQyBOb3QgU3VwcG9ydGVkJyxcbiAgICAgICAgICAgIFdFQlJUQ19FUlJPUjogJ1dlYlJUQyBFcnJvcicsXG4gICAgICAgICAgICBDQU5DRUxFRDogJ0NhbmNlbGVkJyxcbiAgICAgICAgICAgIE5PX0FOU1dFUjogJ05vIEFuc3dlcicsXG4gICAgICAgICAgICBFWFBJUkVTOiAnRXhwaXJlcycsXG4gICAgICAgICAgICBOT19BQ0s6ICdObyBBQ0snLFxuICAgICAgICAgICAgTk9fUFJBQ0s6ICdObyBQUkFDSycsXG4gICAgICAgICAgICBVU0VSX0RFTklFRF9NRURJQV9BQ0NFU1M6ICdVc2VyIERlbmllZCBNZWRpYSBBY2Nlc3MnLFxuICAgICAgICAgICAgQkFEX01FRElBX0RFU0NSSVBUSU9OOiAnQmFkIE1lZGlhIERlc2NyaXB0aW9uJyxcbiAgICAgICAgICAgIFJUUF9USU1FT1VUOiAnUlRQIFRpbWVvdXQnXG4gICAgICAgIH0sXG4gICAgICAgIHN1cHBvcnRlZDoge1xuICAgICAgICAgICAgVU5TVVBQT1JURUQ6ICdub25lJyxcbiAgICAgICAgICAgIFNVUFBPUlRFRDogJ3N1cHBvcnRlZCcsXG4gICAgICAgICAgICBSRVFVSVJFRDogJ3JlcXVpcmVkJ1xuICAgICAgICB9LFxuICAgICAgICBTSVBfRVJST1JfQ0FVU0VTOiB7XG4gICAgICAgICAgICBSRURJUkVDVEVEOiBbMzAwLCAzMDEsIDMwMiwgMzA1LCAzODBdLFxuICAgICAgICAgICAgQlVTWTogWzQ4NiwgNjAwXSxcbiAgICAgICAgICAgIFJFSkVDVEVEOiBbNDAzLCA2MDNdLFxuICAgICAgICAgICAgTk9UX0ZPVU5EOiBbNDA0LCA2MDRdLFxuICAgICAgICAgICAgVU5BVkFJTEFCTEU6IFs0ODAsIDQxMCwgNDA4LCA0MzBdLFxuICAgICAgICAgICAgQUREUkVTU19JTkNPTVBMRVRFOiBbNDg0XSxcbiAgICAgICAgICAgIElOQ09NUEFUSUJMRV9TRFA6IFs0ODgsIDYwNl0sXG4gICAgICAgICAgICBBVVRIRU5USUNBVElPTl9FUlJPUjogWzQwMSwgNDA3XVxuICAgICAgICB9LFxuICAgICAgICAvLyBTSVAgTWV0aG9kc1xuICAgICAgICBBQ0s6ICdBQ0snLFxuICAgICAgICBCWUU6ICdCWUUnLFxuICAgICAgICBDQU5DRUw6ICdDQU5DRUwnLFxuICAgICAgICBJTkZPOiAnSU5GTycsXG4gICAgICAgIElOVklURTogJ0lOVklURScsXG4gICAgICAgIE1FU1NBR0U6ICdNRVNTQUdFJyxcbiAgICAgICAgTk9USUZZOiAnTk9USUZZJyxcbiAgICAgICAgT1BUSU9OUzogJ09QVElPTlMnLFxuICAgICAgICBSRUdJU1RFUjogJ1JFR0lTVEVSJyxcbiAgICAgICAgVVBEQVRFOiAnVVBEQVRFJyxcbiAgICAgICAgU1VCU0NSSUJFOiAnU1VCU0NSSUJFJyxcbiAgICAgICAgUFVCTElTSDogJ1BVQkxJU0gnLFxuICAgICAgICBSRUZFUjogJ1JFRkVSJyxcbiAgICAgICAgUFJBQ0s6ICdQUkFDSycsXG4gICAgICAgIC8qIFNJUCBSZXNwb25zZSBSZWFzb25zXG4gICAgICAgICAqIERPQzogaHR0cDovL3d3dy5pYW5hLm9yZy9hc3NpZ25tZW50cy9zaXAtcGFyYW1ldGVyc1xuICAgICAgICAgKiBDb3BpZWQgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vdmVyc2F0aWNhL092ZXJTSVAvYmxvYi9tYXN0ZXIvbGliL292ZXJzaXAvc2lwL2NvbnN0YW50cy5yYiNMN1xuICAgICAgICAgKi9cbiAgICAgICAgUkVBU09OX1BIUkFTRToge1xuICAgICAgICAgICAgMTAwOiAnVHJ5aW5nJyxcbiAgICAgICAgICAgIDE4MDogJ1JpbmdpbmcnLFxuICAgICAgICAgICAgMTgxOiAnQ2FsbCBJcyBCZWluZyBGb3J3YXJkZWQnLFxuICAgICAgICAgICAgMTgyOiAnUXVldWVkJyxcbiAgICAgICAgICAgIDE4MzogJ1Nlc3Npb24gUHJvZ3Jlc3MnLFxuICAgICAgICAgICAgMTk5OiAnRWFybHkgRGlhbG9nIFRlcm1pbmF0ZWQnLFxuICAgICAgICAgICAgMjAwOiAnT0snLFxuICAgICAgICAgICAgMjAyOiAnQWNjZXB0ZWQnLFxuICAgICAgICAgICAgMjA0OiAnTm8gTm90aWZpY2F0aW9uJyxcbiAgICAgICAgICAgIDMwMDogJ011bHRpcGxlIENob2ljZXMnLFxuICAgICAgICAgICAgMzAxOiAnTW92ZWQgUGVybWFuZW50bHknLFxuICAgICAgICAgICAgMzAyOiAnTW92ZWQgVGVtcG9yYXJpbHknLFxuICAgICAgICAgICAgMzA1OiAnVXNlIFByb3h5JyxcbiAgICAgICAgICAgIDM4MDogJ0FsdGVybmF0aXZlIFNlcnZpY2UnLFxuICAgICAgICAgICAgNDAwOiAnQmFkIFJlcXVlc3QnLFxuICAgICAgICAgICAgNDAxOiAnVW5hdXRob3JpemVkJyxcbiAgICAgICAgICAgIDQwMjogJ1BheW1lbnQgUmVxdWlyZWQnLFxuICAgICAgICAgICAgNDAzOiAnRm9yYmlkZGVuJyxcbiAgICAgICAgICAgIDQwNDogJ05vdCBGb3VuZCcsXG4gICAgICAgICAgICA0MDU6ICdNZXRob2QgTm90IEFsbG93ZWQnLFxuICAgICAgICAgICAgNDA2OiAnTm90IEFjY2VwdGFibGUnLFxuICAgICAgICAgICAgNDA3OiAnUHJveHkgQXV0aGVudGljYXRpb24gUmVxdWlyZWQnLFxuICAgICAgICAgICAgNDA4OiAnUmVxdWVzdCBUaW1lb3V0JyxcbiAgICAgICAgICAgIDQxMDogJ0dvbmUnLFxuICAgICAgICAgICAgNDEyOiAnQ29uZGl0aW9uYWwgUmVxdWVzdCBGYWlsZWQnLFxuICAgICAgICAgICAgNDEzOiAnUmVxdWVzdCBFbnRpdHkgVG9vIExhcmdlJyxcbiAgICAgICAgICAgIDQxNDogJ1JlcXVlc3QtVVJJIFRvbyBMb25nJyxcbiAgICAgICAgICAgIDQxNTogJ1Vuc3VwcG9ydGVkIE1lZGlhIFR5cGUnLFxuICAgICAgICAgICAgNDE2OiAnVW5zdXBwb3J0ZWQgVVJJIFNjaGVtZScsXG4gICAgICAgICAgICA0MTc6ICdVbmtub3duIFJlc291cmNlLVByaW9yaXR5JyxcbiAgICAgICAgICAgIDQyMDogJ0JhZCBFeHRlbnNpb24nLFxuICAgICAgICAgICAgNDIxOiAnRXh0ZW5zaW9uIFJlcXVpcmVkJyxcbiAgICAgICAgICAgIDQyMjogJ1Nlc3Npb24gSW50ZXJ2YWwgVG9vIFNtYWxsJyxcbiAgICAgICAgICAgIDQyMzogJ0ludGVydmFsIFRvbyBCcmllZicsXG4gICAgICAgICAgICA0Mjg6ICdVc2UgSWRlbnRpdHkgSGVhZGVyJyxcbiAgICAgICAgICAgIDQyOTogJ1Byb3ZpZGUgUmVmZXJyZXIgSWRlbnRpdHknLFxuICAgICAgICAgICAgNDMwOiAnRmxvdyBGYWlsZWQnLFxuICAgICAgICAgICAgNDMzOiAnQW5vbnltaXR5IERpc2FsbG93ZWQnLFxuICAgICAgICAgICAgNDM2OiAnQmFkIElkZW50aXR5LUluZm8nLFxuICAgICAgICAgICAgNDM3OiAnVW5zdXBwb3J0ZWQgQ2VydGlmaWNhdGUnLFxuICAgICAgICAgICAgNDM4OiAnSW52YWxpZCBJZGVudGl0eSBIZWFkZXInLFxuICAgICAgICAgICAgNDM5OiAnRmlyc3QgSG9wIExhY2tzIE91dGJvdW5kIFN1cHBvcnQnLFxuICAgICAgICAgICAgNDQwOiAnTWF4LUJyZWFkdGggRXhjZWVkZWQnLFxuICAgICAgICAgICAgNDY5OiAnQmFkIEluZm8gUGFja2FnZScsXG4gICAgICAgICAgICA0NzA6ICdDb25zZW50IE5lZWRlZCcsXG4gICAgICAgICAgICA0Nzg6ICdVbnJlc29sdmFibGUgRGVzdGluYXRpb24nLFxuICAgICAgICAgICAgNDgwOiAnVGVtcG9yYXJpbHkgVW5hdmFpbGFibGUnLFxuICAgICAgICAgICAgNDgxOiAnQ2FsbC9UcmFuc2FjdGlvbiBEb2VzIE5vdCBFeGlzdCcsXG4gICAgICAgICAgICA0ODI6ICdMb29wIERldGVjdGVkJyxcbiAgICAgICAgICAgIDQ4MzogJ1RvbyBNYW55IEhvcHMnLFxuICAgICAgICAgICAgNDg0OiAnQWRkcmVzcyBJbmNvbXBsZXRlJyxcbiAgICAgICAgICAgIDQ4NTogJ0FtYmlndW91cycsXG4gICAgICAgICAgICA0ODY6ICdCdXN5IEhlcmUnLFxuICAgICAgICAgICAgNDg3OiAnUmVxdWVzdCBUZXJtaW5hdGVkJyxcbiAgICAgICAgICAgIDQ4ODogJ05vdCBBY2NlcHRhYmxlIEhlcmUnLFxuICAgICAgICAgICAgNDg5OiAnQmFkIEV2ZW50JyxcbiAgICAgICAgICAgIDQ5MTogJ1JlcXVlc3QgUGVuZGluZycsXG4gICAgICAgICAgICA0OTM6ICdVbmRlY2lwaGVyYWJsZScsXG4gICAgICAgICAgICA0OTQ6ICdTZWN1cml0eSBBZ3JlZW1lbnQgUmVxdWlyZWQnLFxuICAgICAgICAgICAgNTAwOiAnSW50ZXJuYWwgU2VydmVyIEVycm9yJyxcbiAgICAgICAgICAgIDUwMTogJ05vdCBJbXBsZW1lbnRlZCcsXG4gICAgICAgICAgICA1MDI6ICdCYWQgR2F0ZXdheScsXG4gICAgICAgICAgICA1MDM6ICdTZXJ2aWNlIFVuYXZhaWxhYmxlJyxcbiAgICAgICAgICAgIDUwNDogJ1NlcnZlciBUaW1lLW91dCcsXG4gICAgICAgICAgICA1MDU6ICdWZXJzaW9uIE5vdCBTdXBwb3J0ZWQnLFxuICAgICAgICAgICAgNTEzOiAnTWVzc2FnZSBUb28gTGFyZ2UnLFxuICAgICAgICAgICAgNTgwOiAnUHJlY29uZGl0aW9uIEZhaWx1cmUnLFxuICAgICAgICAgICAgNjAwOiAnQnVzeSBFdmVyeXdoZXJlJyxcbiAgICAgICAgICAgIDYwMzogJ0RlY2xpbmUnLFxuICAgICAgICAgICAgNjA0OiAnRG9lcyBOb3QgRXhpc3QgQW55d2hlcmUnLFxuICAgICAgICAgICAgNjA2OiAnTm90IEFjY2VwdGFibGUnXG4gICAgICAgIH0sXG4gICAgICAgIC8qIFNJUCBPcHRpb24gVGFnc1xuICAgICAgICAgKiBET0M6IGh0dHA6Ly93d3cuaWFuYS5vcmcvYXNzaWdubWVudHMvc2lwLXBhcmFtZXRlcnMvc2lwLXBhcmFtZXRlcnMueGh0bWwjc2lwLXBhcmFtZXRlcnMtNFxuICAgICAgICAgKi9cbiAgICAgICAgT1BUSU9OX1RBR1M6IHtcbiAgICAgICAgICAgICcxMDByZWwnOiB0cnVlLFxuICAgICAgICAgICAgMTk5OiB0cnVlLFxuICAgICAgICAgICAgYW5zd2VybW9kZTogdHJ1ZSxcbiAgICAgICAgICAgICdlYXJseS1zZXNzaW9uJzogdHJ1ZSxcbiAgICAgICAgICAgIGV2ZW50bGlzdDogdHJ1ZSxcbiAgICAgICAgICAgIGV4cGxpY2l0c3ViOiB0cnVlLFxuICAgICAgICAgICAgJ2Zyb20tY2hhbmdlJzogdHJ1ZSxcbiAgICAgICAgICAgICdnZW9sb2NhdGlvbi1odHRwJzogdHJ1ZSxcbiAgICAgICAgICAgICdnZW9sb2NhdGlvbi1zaXAnOiB0cnVlLFxuICAgICAgICAgICAgZ2luOiB0cnVlLFxuICAgICAgICAgICAgZ3J1dTogdHJ1ZSxcbiAgICAgICAgICAgIGhpc3RpbmZvOiB0cnVlLFxuICAgICAgICAgICAgaWNlOiB0cnVlLFxuICAgICAgICAgICAgam9pbjogdHJ1ZSxcbiAgICAgICAgICAgICdtdWx0aXBsZS1yZWZlcic6IHRydWUsXG4gICAgICAgICAgICBub3JlZmVyc3ViOiB0cnVlLFxuICAgICAgICAgICAgbm9zdWI6IHRydWUsXG4gICAgICAgICAgICBvdXRib3VuZDogdHJ1ZSxcbiAgICAgICAgICAgIHBhdGg6IHRydWUsXG4gICAgICAgICAgICBwb2xpY3k6IHRydWUsXG4gICAgICAgICAgICBwcmVjb25kaXRpb246IHRydWUsXG4gICAgICAgICAgICBwcmVmOiB0cnVlLFxuICAgICAgICAgICAgcHJpdmFjeTogdHJ1ZSxcbiAgICAgICAgICAgICdyZWNpcGllbnQtbGlzdC1pbnZpdGUnOiB0cnVlLFxuICAgICAgICAgICAgJ3JlY2lwaWVudC1saXN0LW1lc3NhZ2UnOiB0cnVlLFxuICAgICAgICAgICAgJ3JlY2lwaWVudC1saXN0LXN1YnNjcmliZSc6IHRydWUsXG4gICAgICAgICAgICByZXBsYWNlczogdHJ1ZSxcbiAgICAgICAgICAgICdyZXNvdXJjZS1wcmlvcml0eSc6IHRydWUsXG4gICAgICAgICAgICAnc2RwLWFuYXQnOiB0cnVlLFxuICAgICAgICAgICAgJ3NlYy1hZ3JlZSc6IHRydWUsXG4gICAgICAgICAgICB0ZGlhbG9nOiB0cnVlLFxuICAgICAgICAgICAgdGltZXI6IHRydWUsXG4gICAgICAgICAgICB1dWk6IHRydWUgLy8gUkZDIDc0MzNcbiAgICAgICAgfSxcbiAgICAgICAgZHRtZlR5cGU6IHtcbiAgICAgICAgICAgIElORk86ICdpbmZvJyxcbiAgICAgICAgICAgIFJUUDogJ3J0cCdcbiAgICAgICAgfVxuICAgIH07XG59O1xuXG5cbi8qKiovIH0pLFxuLyogOCAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cInVzZSBzdHJpY3RcIjtcblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IEV4Y2VwdGlvbnNcbiAqL1xuLyoqXG4gKiBTSVAgRXhjZXB0aW9ucy5cbiAqIEBhdWdtZW50cyBTSVBcbiAqL1xubW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgQ29uZmlndXJhdGlvbkVycm9yOiAoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZXhjZXB0aW9uID0gZnVuY3Rpb24gKHBhcmFtZXRlciwgdmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuY29kZSA9IDE7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSAnQ09ORklHVVJBVElPTl9FUlJPUic7XG4gICAgICAgICAgICB0aGlzLnBhcmFtZXRlciA9IHBhcmFtZXRlcjtcbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZSA9ICghdGhpcy52YWx1ZSkgPyAnTWlzc2luZyBwYXJhbWV0ZXI6ICcgKyB0aGlzLnBhcmFtZXRlciA6ICdJbnZhbGlkIHZhbHVlICcgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnZhbHVlKSArICcgZm9yIHBhcmFtZXRlciBcIicgKyB0aGlzLnBhcmFtZXRlciArICdcIic7XG4gICAgICAgIH07XG4gICAgICAgIGV4Y2VwdGlvbi5wcm90b3R5cGUgPSBuZXcgRXJyb3IoKTtcbiAgICAgICAgcmV0dXJuIGV4Y2VwdGlvbjtcbiAgICB9KCkpLFxuICAgIEludmFsaWRTdGF0ZUVycm9yOiAoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZXhjZXB0aW9uID0gZnVuY3Rpb24gKHN0YXR1cykge1xuICAgICAgICAgICAgdGhpcy5jb2RlID0gMjtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9ICdJTlZBTElEX1NUQVRFX0VSUk9SJztcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzO1xuICAgICAgICAgICAgdGhpcy5tZXNzYWdlID0gJ0ludmFsaWQgc3RhdHVzOiAnICsgc3RhdHVzO1xuICAgICAgICB9O1xuICAgICAgICBleGNlcHRpb24ucHJvdG90eXBlID0gbmV3IEVycm9yKCk7XG4gICAgICAgIHJldHVybiBleGNlcHRpb247XG4gICAgfSgpKSxcbiAgICBOb3RTdXBwb3J0ZWRFcnJvcjogKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGV4Y2VwdGlvbiA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgICAgICAgICB0aGlzLmNvZGUgPSAzO1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gJ05PVF9TVVBQT1JURURfRVJST1InO1xuICAgICAgICAgICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZTtcbiAgICAgICAgfTtcbiAgICAgICAgZXhjZXB0aW9uLnByb3RvdHlwZSA9IG5ldyBFcnJvcigpO1xuICAgICAgICByZXR1cm4gZXhjZXB0aW9uO1xuICAgIH0oKSksXG4gICAgLy8gRGVwcmVjYXRlZFxuICAgIEdldERlc2NyaXB0aW9uRXJyb3I6IChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBleGNlcHRpb24gPSBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgICAgICAgICAgdGhpcy5jb2RlID0gNDtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9ICdHRVRfREVTQ1JJUFRJT05fRVJST1InO1xuICAgICAgICAgICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZTtcbiAgICAgICAgfTtcbiAgICAgICAgZXhjZXB0aW9uLnByb3RvdHlwZSA9IG5ldyBFcnJvcigpO1xuICAgICAgICByZXR1cm4gZXhjZXB0aW9uO1xuICAgIH0oKSksXG4gICAgUmVuZWdvdGlhdGlvbkVycm9yOiAoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZXhjZXB0aW9uID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgIHRoaXMuY29kZSA9IDU7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSAnUkVORUdPVElBVElPTl9FUlJPUic7XG4gICAgICAgICAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlO1xuICAgICAgICB9O1xuICAgICAgICBleGNlcHRpb24ucHJvdG90eXBlID0gbmV3IEVycm9yKCk7XG4gICAgICAgIHJldHVybiBleGNlcHRpb247XG4gICAgfSgpKSxcbiAgICBNZXRob2RQYXJhbWV0ZXJFcnJvcjogKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGV4Y2VwdGlvbiA9IGZ1bmN0aW9uIChtZXRob2QsIHBhcmFtZXRlciwgdmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuY29kZSA9IDY7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSAnTUVUSE9EX1BBUkFNRVRFUl9FUlJPUic7XG4gICAgICAgICAgICB0aGlzLm1ldGhvZCA9IG1ldGhvZDtcbiAgICAgICAgICAgIHRoaXMucGFyYW1ldGVyID0gcGFyYW1ldGVyO1xuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy5tZXNzYWdlID0gKCF0aGlzLnZhbHVlKSA/ICdNaXNzaW5nIHBhcmFtZXRlcjogJyArIHRoaXMucGFyYW1ldGVyIDogJ0ludmFsaWQgdmFsdWUgJyArIEpTT04uc3RyaW5naWZ5KHRoaXMudmFsdWUpICsgJyBmb3IgcGFyYW1ldGVyIFwiJyArIHRoaXMucGFyYW1ldGVyICsgJ1wiJztcbiAgICAgICAgfTtcbiAgICAgICAgZXhjZXB0aW9uLnByb3RvdHlwZSA9IG5ldyBFcnJvcigpO1xuICAgICAgICByZXR1cm4gZXhjZXB0aW9uO1xuICAgIH0oKSksXG4gICAgVHJhbnNwb3J0RXJyb3I6IChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBleGNlcHRpb24gPSBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgICAgICAgICAgdGhpcy5jb2RlID0gNztcbiAgICAgICAgICAgIHRoaXMubmFtZSA9ICdUUkFOU1BPUlRfRVJST1InO1xuICAgICAgICAgICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZTtcbiAgICAgICAgfTtcbiAgICAgICAgZXhjZXB0aW9uLnByb3RvdHlwZSA9IG5ldyBFcnJvcigpO1xuICAgICAgICByZXR1cm4gZXhjZXB0aW9uO1xuICAgIH0oKSksXG4gICAgU2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlckVycm9yOiAoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZXhjZXB0aW9uID0gZnVuY3Rpb24gKG1ldGhvZCwgZXJyb3IsIG1lc3NhZ2UpIHtcbiAgICAgICAgICAgIHRoaXMuY29kZSA9IDg7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSAnU0VTU0lPTl9ERVNDUklQVElPTl9IQU5ETEVSX0VSUk9SJztcbiAgICAgICAgICAgIHRoaXMubWV0aG9kID0gbWV0aG9kO1xuICAgICAgICAgICAgdGhpcy5lcnJvciA9IGVycm9yO1xuICAgICAgICAgICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZSB8fCAnRXJyb3Igd2l0aCBTZXNzaW9uIERlc2NyaXB0aW9uIEhhbmRsZXInO1xuICAgICAgICB9O1xuICAgICAgICBleGNlcHRpb24ucHJvdG90eXBlID0gbmV3IEVycm9yKCk7XG4gICAgICAgIHJldHVybiBleGNlcHRpb247XG4gICAgfSgpKSxcbn07XG5cblxuLyoqKi8gfSksXG4vKiA5ICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblwidXNlIHN0cmljdFwiO1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgU0lQIFRJTUVSU1xuICovXG4vKipcbiAqIEBhdWdtZW50cyBTSVBcbiAqL1xudmFyIFQxID0gNTAwLCBUMiA9IDQwMDAsIFQ0ID0gNTAwMDtcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKHRpbWVycykge1xuICAgIHZhciBUaW1lcnMgPSB7XG4gICAgICAgIFQxOiBUMSxcbiAgICAgICAgVDI6IFQyLFxuICAgICAgICBUNDogVDQsXG4gICAgICAgIFRJTUVSX0I6IDY0ICogVDEsXG4gICAgICAgIFRJTUVSX0Q6IDAgKiBUMSxcbiAgICAgICAgVElNRVJfRjogNjQgKiBUMSxcbiAgICAgICAgVElNRVJfSDogNjQgKiBUMSxcbiAgICAgICAgVElNRVJfSTogMCAqIFQxLFxuICAgICAgICBUSU1FUl9KOiAwICogVDEsXG4gICAgICAgIFRJTUVSX0s6IDAgKiBUNCxcbiAgICAgICAgVElNRVJfTDogNjQgKiBUMSxcbiAgICAgICAgVElNRVJfTTogNjQgKiBUMSxcbiAgICAgICAgVElNRVJfTjogNjQgKiBUMSxcbiAgICAgICAgUFJPVklTSU9OQUxfUkVTUE9OU0VfSU5URVJWQUw6IDYwMDAwIC8vIFNlZSBSRkMgMzI2MSBTZWN0aW9uIDEzLjMuMS4xXG4gICAgfTtcbiAgICBbJ3NldFRpbWVvdXQnLCAnY2xlYXJUaW1lb3V0JywgJ3NldEludGVydmFsJywgJ2NsZWFySW50ZXJ2YWwnXVxuICAgICAgICAuZm9yRWFjaChmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICAvLyBjYW4ndCBqdXN0IHVzZSB0aW1lcnNbbmFtZV0uYmluZCh0aW1lcnMpIHNpbmNlIGl0IGJ5cGFzc2VzIGphc21pbmUnc1xuICAgICAgICAvLyBjbG9jay1tb2NraW5nXG4gICAgICAgIFRpbWVyc1tuYW1lXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aW1lcnNbbmFtZV0uYXBwbHkodGltZXJzLCBhcmd1bWVudHMpO1xuICAgICAgICB9O1xuICAgIH0pO1xuICAgIHJldHVybiBUaW1lcnM7XG59O1xuXG5cbi8qKiovIH0pLFxuLyogMTAgKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qIGVzbGludC1kaXNhYmxlICovXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgVHJhbnNwb3J0XG4gKi9cbi8qIFRyYW5zcG9ydFxuICogQGNsYXNzIEFic3RyYWN0IHRyYW5zcG9ydCBsYXllciBwYXJlbnQgY2xhc3NcbiAqIEBwYXJhbSB7TG9nZ2VyfSBsb2dnZXJcbiAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoU0lQKSB7XG4gICAgdmFyIFRyYW5zcG9ydCA9IGZ1bmN0aW9uIChsb2dnZXIsIG9wdGlvbnMpIHsgfTtcbiAgICBUcmFuc3BvcnQucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShTSVAuRXZlbnRFbWl0dGVyLnByb3RvdHlwZSwge1xuICAgICAgICAvKipcbiAgICAgICAgKiBSZXR1cm5zIHRoZSBwcm9taXNlIGRlc2lnbmF0ZWQgYnkgdGhlIGNoaWxkIGxheWVyIHRoZW4gZW1pdHMgYSBjb25uZWN0ZWQgZXZlbnQuIEF1dG9tYXRpY2FsbHkgZW1pdHMgYW4gZXZlbnQgdXBvbiByZXNvbHV0aW9uLCB1bmxlc3Mgb3ZlcnJpZGVFdmVudCBpcyBzZXQuIElmIHlvdSBvdmVycmlkZSB0aGUgZXZlbnQgaW4gdGhpcyBmYXNoaW9uLCB5b3Ugc2hvdWxkIGVtaXQgaXQgaW4geW91ciBpbXBsZW1lbnRhdGlvbiBvZiBjb25uZWN0UHJvbWlzZVxuICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cbiAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAgICAgICAgKi9cbiAgICAgICAgY29ubmVjdDogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uIGNvbm5lY3Qob3B0aW9ucykge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbm5lY3RQcm9taXNlKG9wdGlvbnMpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHsgIWRhdGEub3ZlcnJpZGVFdmVudCAmJiB0aGlzLmVtaXQoJ2Nvbm5lY3RlZCcpOyB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgfSB9LFxuICAgICAgICAvKipcbiAgICAgICAgKiBDYWxsZWQgYnkgY29ubmVjdCwgbXVzdCByZXR1cm4gYSBwcm9taXNlXG4gICAgICAgICogcHJvbWlzZSBtdXN0IHJlc29sdmUgdG8gYW4gb2JqZWN0LiBvYmplY3Qgc3VwcG9ydHMgMSBwYXJhbWV0ZXI6IG92ZXJyaWRlRXZlbnQgLSBCb29sZWFuXG4gICAgICAgICogQGFic3RyYWN0XG4gICAgICAgICogQHByaXZhdGVcbiAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdXG4gICAgICAgICogQHJldHVybnMge1Byb21pc2V9XG4gICAgICAgICovXG4gICAgICAgIGNvbm5lY3RQcm9taXNlOiB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogZnVuY3Rpb24gY29ubmVjdFByb21pc2Uob3B0aW9ucykgeyB9IH0sXG4gICAgICAgIC8qKlxuICAgICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgdHJhbnNwb3J0IGlzIGNvbm5lY3RlZFxuICAgICAgICAqIEBhYnN0cmFjdFxuICAgICAgICAqIEByZXR1cm5zIHtCb29sZWFufVxuICAgICAgICAqL1xuICAgICAgICBpc0Nvbm5lY3RlZDogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uIGlzQ29ubmVjdGVkKCkgeyB9IH0sXG4gICAgICAgIC8qKlxuICAgICAgICAqIFNlbmRzIGEgbWVzc2FnZSB0aGVuIGVtaXRzIGEgJ21lc3NhZ2VTZW50JyBldmVudC4gQXV0b21hdGljYWxseSBlbWl0cyBhbiBldmVudCB1cG9uIHJlc29sdXRpb24sIHVubGVzcyBkYXRhLm92ZXJyaWRlRXZlbnQgaXMgc2V0LiBJZiB5b3Ugb3ZlcnJpZGUgdGhlIGV2ZW50IGluIHRoaXMgZmFzaGlvbiwgeW91IHNob3VsZCBlbWl0IGl0IGluIHlvdXIgaW1wbGVtZW50YXRpb24gb2Ygc2VuZFByb21pc2VcbiAgICAgICAgKiBAcGFyYW0ge1NJUC5PdXRnb2luZ1JlcXVlc3R8U3RyaW5nfSBtc2dcbiAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9uc1xuICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlfVxuICAgICAgICAqL1xuICAgICAgICBzZW5kOiB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogZnVuY3Rpb24gc2VuZChtc2csIG9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zZW5kUHJvbWlzZShtc2cpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHsgIWRhdGEub3ZlcnJpZGVFdmVudCAmJiB0aGlzLmVtaXQoJ21lc3NhZ2VTZW50JywgZGF0YS5tc2cpOyB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgfSB9LFxuICAgICAgICAvKipcbiAgICAgICAgKiBDYWxsZWQgYnkgc2VuZCwgbXVzdCByZXR1cm4gYSBwcm9taXNlXG4gICAgICAgICogcHJvbWlzZSBtdXN0IHJlc29sdmUgdG8gYW4gb2JqZWN0LiBvYmplY3Qgc3VwcG9ydHMgMiBwYXJhbWV0ZXJzOiBtc2cgLSBzdHJpbmcgKG1hbmRhdG9yeSkgYW5kIG92ZXJyaWRlRXZlbnQgLSBCb29sZWFuIChvcHRpb25hbClcbiAgICAgICAgKiBAYWJzdHJhY3RcbiAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAqIEBwYXJhbSB7U0lQLk91dGdvaW5nUmVxdWVzdHxTdHJpbmd9IG1zZ1xuICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cbiAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAgICAgICAgKi9cbiAgICAgICAgc2VuZFByb21pc2U6IHsgd3JpdGFibGU6IHRydWUsIHZhbHVlOiBmdW5jdGlvbiBzZW5kUHJvbWlzZShtc2csIG9wdGlvbnMpIHsgfSB9LFxuICAgICAgICAvKipcbiAgICAgICAgKiBUbyBiZSBjYWxsZWQgd2hlbiBhIG1lc3NhZ2UgaXMgcmVjZWl2ZWRcbiAgICAgICAgKiBAYWJzdHJhY3RcbiAgICAgICAgKiBAcGFyYW0ge0V2ZW50fSBlXG4gICAgICAgICovXG4gICAgICAgIG9uTWVzc2FnZTogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uIG9uTWVzc2FnZShlKSB7IH0gfSxcbiAgICAgICAgLyoqXG4gICAgICAgICogUmV0dXJucyB0aGUgcHJvbWlzZSBkZXNpZ25hdGVkIGJ5IHRoZSBjaGlsZCBsYXllciB0aGVuIGVtaXRzIGEgZGlzY29ubmVjdGVkIGV2ZW50LiBBdXRvbWF0aWNhbGx5IGVtaXRzIGFuIGV2ZW50IHVwb24gcmVzb2x1dGlvbiwgdW5sZXNzIG92ZXJyaWRlRXZlbnQgaXMgc2V0LiBJZiB5b3Ugb3ZlcnJpZGUgdGhlIGV2ZW50IGluIHRoaXMgZmFzaGlvbiwgeW91IHNob3VsZCBlbWl0IGl0IGluIHlvdXIgaW1wbGVtZW50YXRpb24gb2YgZGlzY29ubmVjdFByb21pc2VcbiAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdXG4gICAgICAgICogQHJldHVybnMge1Byb21pc2V9XG4gICAgICAgICovXG4gICAgICAgIGRpc2Nvbm5lY3Q6IHsgd3JpdGFibGU6IHRydWUsIHZhbHVlOiBmdW5jdGlvbiBkaXNjb25uZWN0KG9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kaXNjb25uZWN0UHJvbWlzZShvcHRpb25zKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7ICFkYXRhLm92ZXJyaWRlRXZlbnQgJiYgdGhpcy5lbWl0KCdkaXNjb25uZWN0ZWQnKTsgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgIH0gfSxcbiAgICAgICAgLyoqXG4gICAgICAgICogQ2FsbGVkIGJ5IGRpc2Nvbm5lY3QsIG11c3QgcmV0dXJuIGEgcHJvbWlzZVxuICAgICAgICAqIHByb21pc2UgbXVzdCByZXNvbHZlIHRvIGFuIG9iamVjdC4gb2JqZWN0IHN1cHBvcnRzIDEgcGFyYW1ldGVyOiBvdmVycmlkZUV2ZW50IC0gQm9vbGVhblxuICAgICAgICAqIEBhYnN0cmFjdFxuICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxuICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlfVxuICAgICAgICAqL1xuICAgICAgICBkaXNjb25uZWN0UHJvbWlzZTogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uIGRpc2Nvbm5lY3RQcm9taXNlKG9wdGlvbnMpIHsgfSB9LFxuICAgICAgICBhZnRlckNvbm5lY3RlZDogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uIGFmdGVyQ29ubmVjdGVkKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNDb25uZWN0ZWQoKSkge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbmNlKCdjb25uZWN0ZWQnLCBjYWxsYmFjayk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9LFxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0dXJucyBhIHByb21pc2Ugd2hpY2ggcmVzb2x2ZXMgb25jZSB0aGUgVUEgaXMgY29ubmVjdGVkLiBERVBSRUNBVElPTiBXQVJOSU5HOiBqdXN0IHVzZSBhZnRlckNvbm5lY3RlZCgpXG4gICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlfVxuICAgICAgICAgKi9cbiAgICAgICAgd2FpdEZvckNvbm5lY3RlZDogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uIHdhaXRGb3JDb25uZWN0ZWQoKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKFwiREVQUkVDQVRJT04gV0FSTklORyBUcmFuc3BvcnQud2FpdEZvckNvbm5lY3RlZCgpOiB1c2UgYWZ0ZXJDb25uZWN0ZWQoKSBpbnN0ZWFkXCIpO1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU0lQLlV0aWxzLlByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZnRlckNvbm5lY3RlZChyZXNvbHZlKTtcbiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgfSB9LFxuICAgIH0pO1xuICAgIHJldHVybiBUcmFuc3BvcnQ7XG59O1xuXG5cbi8qKiovIH0pLFxuLyogMTEgKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBTSVAgTWVzc2FnZSBQYXJzZXJcbiAqL1xuLyoqXG4gKiBFeHRyYWN0IGFuZCBwYXJzZSBldmVyeSBoZWFkZXIgb2YgYSBTSVAgbWVzc2FnZS5cbiAqIEBhdWdtZW50cyBTSVBcbiAqIEBuYW1lc3BhY2VcbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoU0lQKSB7XG4gICAgdmFyIFBhcnNlcjtcbiAgICBmdW5jdGlvbiBnZXRIZWFkZXIoZGF0YSwgaGVhZGVyU3RhcnQpIHtcbiAgICAgICAgdmFyIFxuICAgICAgICAvLyAnc3RhcnQnIHBvc2l0aW9uIG9mIHRoZSBoZWFkZXIuXG4gICAgICAgIHN0YXJ0ID0gaGVhZGVyU3RhcnQsIFxuICAgICAgICAvLyAnZW5kJyBwb3NpdGlvbiBvZiB0aGUgaGVhZGVyLlxuICAgICAgICBlbmQgPSAwLCBcbiAgICAgICAgLy8gJ3BhcnRpYWwgZW5kJyBwb3NpdGlvbiBvZiB0aGUgaGVhZGVyLlxuICAgICAgICBwYXJ0aWFsRW5kID0gMDtcbiAgICAgICAgLy9FbmQgb2YgbWVzc2FnZS5cbiAgICAgICAgaWYgKGRhdGEuc3Vic3RyaW5nKHN0YXJ0LCBzdGFydCArIDIpLm1hdGNoKC8oXlxcclxcbikvKSkge1xuICAgICAgICAgICAgcmV0dXJuIC0yO1xuICAgICAgICB9XG4gICAgICAgIHdoaWxlIChlbmQgPT09IDApIHtcbiAgICAgICAgICAgIC8vIFBhcnRpYWwgRW5kIG9mIEhlYWRlci5cbiAgICAgICAgICAgIHBhcnRpYWxFbmQgPSBkYXRhLmluZGV4T2YoJ1xcclxcbicsIHN0YXJ0KTtcbiAgICAgICAgICAgIC8vICdpbmRleE9mJyByZXR1cm5zIC0xIGlmIHRoZSB2YWx1ZSB0byBiZSBmb3VuZCBuZXZlciBvY2N1cnMuXG4gICAgICAgICAgICBpZiAocGFydGlhbEVuZCA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcGFydGlhbEVuZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghZGF0YS5zdWJzdHJpbmcocGFydGlhbEVuZCArIDIsIHBhcnRpYWxFbmQgKyA0KS5tYXRjaCgvKF5cXHJcXG4pLykgJiYgZGF0YS5jaGFyQXQocGFydGlhbEVuZCArIDIpLm1hdGNoKC8oXlxccyspLykpIHtcbiAgICAgICAgICAgICAgICAvLyBOb3QgdGhlIGVuZCBvZiB0aGUgbWVzc2FnZS4gQ29udGludWUgZnJvbSB0aGUgbmV4dCBwb3NpdGlvbi5cbiAgICAgICAgICAgICAgICBzdGFydCA9IHBhcnRpYWxFbmQgKyAyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgZW5kID0gcGFydGlhbEVuZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZW5kO1xuICAgIH1cbiAgICBmdW5jdGlvbiBwYXJzZUhlYWRlcihtZXNzYWdlLCBkYXRhLCBoZWFkZXJTdGFydCwgaGVhZGVyRW5kKSB7XG4gICAgICAgIHZhciBoZWFkZXIsIGlkeCwgbGVuZ3RoLCBwYXJzZWQsIGhjb2xvbkluZGV4ID0gZGF0YS5pbmRleE9mKCc6JywgaGVhZGVyU3RhcnQpLCBoZWFkZXJOYW1lID0gZGF0YS5zdWJzdHJpbmcoaGVhZGVyU3RhcnQsIGhjb2xvbkluZGV4KS50cmltKCksIGhlYWRlclZhbHVlID0gZGF0YS5zdWJzdHJpbmcoaGNvbG9uSW5kZXggKyAxLCBoZWFkZXJFbmQpLnRyaW0oKTtcbiAgICAgICAgLy8gSWYgaGVhZGVyLWZpZWxkIGlzIHdlbGwta25vd24sIHBhcnNlIGl0LlxuICAgICAgICBzd2l0Y2ggKGhlYWRlck5hbWUudG9Mb3dlckNhc2UoKSkge1xuICAgICAgICAgICAgY2FzZSAndmlhJzpcbiAgICAgICAgICAgIGNhc2UgJ3YnOlxuICAgICAgICAgICAgICAgIG1lc3NhZ2UuYWRkSGVhZGVyKCd2aWEnLCBoZWFkZXJWYWx1ZSk7XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UuZ2V0SGVhZGVycygndmlhJykubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcnNlZCA9IG1lc3NhZ2UucGFyc2VIZWFkZXIoJ1ZpYScpO1xuICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnZpYSA9IHBhcnNlZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UudmlhX2JyYW5jaCA9IHBhcnNlZC5icmFuY2g7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcnNlZCA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnZnJvbSc6XG4gICAgICAgICAgICBjYXNlICdmJzpcbiAgICAgICAgICAgICAgICBtZXNzYWdlLnNldEhlYWRlcignZnJvbScsIGhlYWRlclZhbHVlKTtcbiAgICAgICAgICAgICAgICBwYXJzZWQgPSBtZXNzYWdlLnBhcnNlSGVhZGVyKCdmcm9tJyk7XG4gICAgICAgICAgICAgICAgaWYgKHBhcnNlZCkge1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmZyb20gPSBwYXJzZWQ7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuZnJvbV90YWcgPSBwYXJzZWQuZ2V0UGFyYW0oJ3RhZycpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3RvJzpcbiAgICAgICAgICAgIGNhc2UgJ3QnOlxuICAgICAgICAgICAgICAgIG1lc3NhZ2Uuc2V0SGVhZGVyKCd0bycsIGhlYWRlclZhbHVlKTtcbiAgICAgICAgICAgICAgICBwYXJzZWQgPSBtZXNzYWdlLnBhcnNlSGVhZGVyKCd0bycpO1xuICAgICAgICAgICAgICAgIGlmIChwYXJzZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS50byA9IHBhcnNlZDtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS50b190YWcgPSBwYXJzZWQuZ2V0UGFyYW0oJ3RhZycpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3JlY29yZC1yb3V0ZSc6XG4gICAgICAgICAgICAgICAgcGFyc2VkID0gU0lQLkdyYW1tYXIucGFyc2UoaGVhZGVyVmFsdWUsICdSZWNvcmRfUm91dGUnKTtcbiAgICAgICAgICAgICAgICBpZiAocGFyc2VkID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICBwYXJzZWQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBsZW5ndGggPSBwYXJzZWQubGVuZ3RoO1xuICAgICAgICAgICAgICAgIGZvciAoaWR4ID0gMDsgaWR4IDwgbGVuZ3RoOyBpZHgrKykge1xuICAgICAgICAgICAgICAgICAgICBoZWFkZXIgPSBwYXJzZWRbaWR4XTtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5hZGRIZWFkZXIoJ3JlY29yZC1yb3V0ZScsIGhlYWRlclZhbHVlLnN1YnN0cmluZyhoZWFkZXIucG9zaXRpb24sIGhlYWRlci5vZmZzZXQpKTtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5oZWFkZXJzWydSZWNvcmQtUm91dGUnXVttZXNzYWdlLmdldEhlYWRlcnMoJ3JlY29yZC1yb3V0ZScpLmxlbmd0aCAtIDFdLnBhcnNlZCA9IGhlYWRlci5wYXJzZWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnY2FsbC1pZCc6XG4gICAgICAgICAgICBjYXNlICdpJzpcbiAgICAgICAgICAgICAgICBtZXNzYWdlLnNldEhlYWRlcignY2FsbC1pZCcsIGhlYWRlclZhbHVlKTtcbiAgICAgICAgICAgICAgICBwYXJzZWQgPSBtZXNzYWdlLnBhcnNlSGVhZGVyKCdjYWxsLWlkJyk7XG4gICAgICAgICAgICAgICAgaWYgKHBhcnNlZCkge1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmNhbGxfaWQgPSBoZWFkZXJWYWx1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdjb250YWN0JzpcbiAgICAgICAgICAgIGNhc2UgJ20nOlxuICAgICAgICAgICAgICAgIHBhcnNlZCA9IFNJUC5HcmFtbWFyLnBhcnNlKGhlYWRlclZhbHVlLCAnQ29udGFjdCcpO1xuICAgICAgICAgICAgICAgIGlmIChwYXJzZWQgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcnNlZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxlbmd0aCA9IHBhcnNlZC5sZW5ndGg7XG4gICAgICAgICAgICAgICAgZm9yIChpZHggPSAwOyBpZHggPCBsZW5ndGg7IGlkeCsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGhlYWRlciA9IHBhcnNlZFtpZHhdO1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmFkZEhlYWRlcignY29udGFjdCcsIGhlYWRlclZhbHVlLnN1YnN0cmluZyhoZWFkZXIucG9zaXRpb24sIGhlYWRlci5vZmZzZXQpKTtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5oZWFkZXJzWydDb250YWN0J11bbWVzc2FnZS5nZXRIZWFkZXJzKCdjb250YWN0JykubGVuZ3RoIC0gMV0ucGFyc2VkID0gaGVhZGVyLnBhcnNlZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdjb250ZW50LWxlbmd0aCc6XG4gICAgICAgICAgICBjYXNlICdsJzpcbiAgICAgICAgICAgICAgICBtZXNzYWdlLnNldEhlYWRlcignY29udGVudC1sZW5ndGgnLCBoZWFkZXJWYWx1ZSk7XG4gICAgICAgICAgICAgICAgcGFyc2VkID0gbWVzc2FnZS5wYXJzZUhlYWRlcignY29udGVudC1sZW5ndGgnKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2NvbnRlbnQtdHlwZSc6XG4gICAgICAgICAgICBjYXNlICdjJzpcbiAgICAgICAgICAgICAgICBtZXNzYWdlLnNldEhlYWRlcignY29udGVudC10eXBlJywgaGVhZGVyVmFsdWUpO1xuICAgICAgICAgICAgICAgIHBhcnNlZCA9IG1lc3NhZ2UucGFyc2VIZWFkZXIoJ2NvbnRlbnQtdHlwZScpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnY3NlcSc6XG4gICAgICAgICAgICAgICAgbWVzc2FnZS5zZXRIZWFkZXIoJ2NzZXEnLCBoZWFkZXJWYWx1ZSk7XG4gICAgICAgICAgICAgICAgcGFyc2VkID0gbWVzc2FnZS5wYXJzZUhlYWRlcignY3NlcScpO1xuICAgICAgICAgICAgICAgIGlmIChwYXJzZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5jc2VxID0gcGFyc2VkLnZhbHVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZSBpbnN0YW5jZW9mIFNJUC5JbmNvbWluZ1Jlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UubWV0aG9kID0gcGFyc2VkLm1ldGhvZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdtYXgtZm9yd2FyZHMnOlxuICAgICAgICAgICAgICAgIG1lc3NhZ2Uuc2V0SGVhZGVyKCdtYXgtZm9yd2FyZHMnLCBoZWFkZXJWYWx1ZSk7XG4gICAgICAgICAgICAgICAgcGFyc2VkID0gbWVzc2FnZS5wYXJzZUhlYWRlcignbWF4LWZvcndhcmRzJyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd3d3ctYXV0aGVudGljYXRlJzpcbiAgICAgICAgICAgICAgICBtZXNzYWdlLnNldEhlYWRlcignd3d3LWF1dGhlbnRpY2F0ZScsIGhlYWRlclZhbHVlKTtcbiAgICAgICAgICAgICAgICBwYXJzZWQgPSBtZXNzYWdlLnBhcnNlSGVhZGVyKCd3d3ctYXV0aGVudGljYXRlJyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdwcm94eS1hdXRoZW50aWNhdGUnOlxuICAgICAgICAgICAgICAgIG1lc3NhZ2Uuc2V0SGVhZGVyKCdwcm94eS1hdXRoZW50aWNhdGUnLCBoZWFkZXJWYWx1ZSk7XG4gICAgICAgICAgICAgICAgcGFyc2VkID0gbWVzc2FnZS5wYXJzZUhlYWRlcigncHJveHktYXV0aGVudGljYXRlJyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdyZWZlci10byc6XG4gICAgICAgICAgICBjYXNlICdyJzpcbiAgICAgICAgICAgICAgICBtZXNzYWdlLnNldEhlYWRlcigncmVmZXItdG8nLCBoZWFkZXJWYWx1ZSk7XG4gICAgICAgICAgICAgICAgcGFyc2VkID0gbWVzc2FnZS5wYXJzZUhlYWRlcigncmVmZXItdG8nKTtcbiAgICAgICAgICAgICAgICBpZiAocGFyc2VkKSB7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucmVmZXJfdG8gPSBwYXJzZWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAvLyBEbyBub3QgcGFyc2UgdGhpcyBoZWFkZXIuXG4gICAgICAgICAgICAgICAgbWVzc2FnZS5zZXRIZWFkZXIoaGVhZGVyTmFtZSwgaGVhZGVyVmFsdWUpO1xuICAgICAgICAgICAgICAgIHBhcnNlZCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhcnNlZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGVycm9yOiAnZXJyb3IgcGFyc2luZyBoZWFkZXIgXCInICsgaGVhZGVyTmFtZSArICdcIidcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKiogUGFyc2UgU0lQIE1lc3NhZ2VcbiAgICAgKiBAZnVuY3Rpb25cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbWVzc2FnZSBTSVAgbWVzc2FnZS5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gbG9nZ2VyIG9iamVjdC5cbiAgICAgKiBAcmV0dXJucyB7U0lQLkluY29taW5nUmVxdWVzdHxTSVAuSW5jb21pbmdSZXNwb25zZXx1bmRlZmluZWR9XG4gICAgICovXG4gICAgUGFyc2VyID0ge307XG4gICAgUGFyc2VyLnBhcnNlTWVzc2FnZSA9IGZ1bmN0aW9uIChkYXRhLCB1YSkge1xuICAgICAgICB2YXIgbWVzc2FnZSwgZmlyc3RMaW5lLCBjb250ZW50TGVuZ3RoLCBib2R5U3RhcnQsIHBhcnNlZCwgaGVhZGVyU3RhcnQgPSAwLCBoZWFkZXJFbmQgPSBkYXRhLmluZGV4T2YoJ1xcclxcbicpLCBsb2dnZXIgPSB1YS5nZXRMb2dnZXIoJ3NpcC5wYXJzZXInKTtcbiAgICAgICAgaWYgKGhlYWRlckVuZCA9PT0gLTEpIHtcbiAgICAgICAgICAgIGxvZ2dlci53YXJuKCdubyBDUkxGIGZvdW5kLCBub3QgYSBTSVAgbWVzc2FnZSwgZGlzY2FyZGVkJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gUGFyc2UgZmlyc3QgbGluZS4gQ2hlY2sgaWYgaXQgaXMgYSBSZXF1ZXN0IG9yIGEgUmVwbHkuXG4gICAgICAgIGZpcnN0TGluZSA9IGRhdGEuc3Vic3RyaW5nKDAsIGhlYWRlckVuZCk7XG4gICAgICAgIHBhcnNlZCA9IFNJUC5HcmFtbWFyLnBhcnNlKGZpcnN0TGluZSwgJ1JlcXVlc3RfUmVzcG9uc2UnKTtcbiAgICAgICAgaWYgKHBhcnNlZCA9PT0gLTEpIHtcbiAgICAgICAgICAgIGxvZ2dlci53YXJuKCdlcnJvciBwYXJzaW5nIGZpcnN0IGxpbmUgb2YgU0lQIG1lc3NhZ2U6IFwiJyArIGZpcnN0TGluZSArICdcIicpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCFwYXJzZWQuc3RhdHVzX2NvZGUpIHtcbiAgICAgICAgICAgIG1lc3NhZ2UgPSBuZXcgU0lQLkluY29taW5nUmVxdWVzdCh1YSk7XG4gICAgICAgICAgICBtZXNzYWdlLm1ldGhvZCA9IHBhcnNlZC5tZXRob2Q7XG4gICAgICAgICAgICBtZXNzYWdlLnJ1cmkgPSBwYXJzZWQudXJpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbWVzc2FnZSA9IG5ldyBTSVAuSW5jb21pbmdSZXNwb25zZSh1YSk7XG4gICAgICAgICAgICBtZXNzYWdlLnN0YXR1c19jb2RlID0gcGFyc2VkLnN0YXR1c19jb2RlO1xuICAgICAgICAgICAgbWVzc2FnZS5yZWFzb25fcGhyYXNlID0gcGFyc2VkLnJlYXNvbl9waHJhc2U7XG4gICAgICAgIH1cbiAgICAgICAgbWVzc2FnZS5kYXRhID0gZGF0YTtcbiAgICAgICAgaGVhZGVyU3RhcnQgPSBoZWFkZXJFbmQgKyAyO1xuICAgICAgICAvKiBMb29wIG92ZXIgZXZlcnkgbGluZSBpbiBkYXRhLiBEZXRlY3QgdGhlIGVuZCBvZiBlYWNoIGhlYWRlciBhbmQgcGFyc2VcbiAgICAgICAgKiBpdCBvciBzaW1wbHkgYWRkIHRvIHRoZSBoZWFkZXJzIGNvbGxlY3Rpb24uXG4gICAgICAgICovXG4gICAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgICAgICBoZWFkZXJFbmQgPSBnZXRIZWFkZXIoZGF0YSwgaGVhZGVyU3RhcnQpO1xuICAgICAgICAgICAgLy8gVGhlIFNJUCBtZXNzYWdlIGhhcyBub3JtYWxseSBmaW5pc2hlZC5cbiAgICAgICAgICAgIGlmIChoZWFkZXJFbmQgPT09IC0yKSB7XG4gICAgICAgICAgICAgICAgYm9keVN0YXJ0ID0gaGVhZGVyU3RhcnQgKyAyO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gZGF0YS5pbmRleE9mIHJldHVybmVkIC0xIGR1ZSB0byBhIG1hbGZvcm1lZCBtZXNzYWdlLlxuICAgICAgICAgICAgZWxzZSBpZiAoaGVhZGVyRW5kID09PSAtMSkge1xuICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcignbWFsZm9ybWVkIG1lc3NhZ2UnKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwYXJzZWQgPSBwYXJzZUhlYWRlcihtZXNzYWdlLCBkYXRhLCBoZWFkZXJTdGFydCwgaGVhZGVyRW5kKTtcbiAgICAgICAgICAgIGlmIChwYXJzZWQgIT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IocGFyc2VkLmVycm9yKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBoZWFkZXJTdGFydCA9IGhlYWRlckVuZCArIDI7XG4gICAgICAgIH1cbiAgICAgICAgLyogUkZDMzI2MSAxOC4zLlxuICAgICAgICAgKiBJZiB0aGVyZSBhcmUgYWRkaXRpb25hbCBieXRlcyBpbiB0aGUgdHJhbnNwb3J0IHBhY2tldFxuICAgICAgICAgKiBiZXlvbmQgdGhlIGVuZCBvZiB0aGUgYm9keSwgdGhleSBNVVNUIGJlIGRpc2NhcmRlZC5cbiAgICAgICAgICovXG4gICAgICAgIGlmIChtZXNzYWdlLmhhc0hlYWRlcignY29udGVudC1sZW5ndGgnKSkge1xuICAgICAgICAgICAgY29udGVudExlbmd0aCA9IG1lc3NhZ2UuZ2V0SGVhZGVyKCdjb250ZW50LWxlbmd0aCcpO1xuICAgICAgICAgICAgbWVzc2FnZS5ib2R5ID0gZGF0YS5zdWJzdHIoYm9keVN0YXJ0LCBjb250ZW50TGVuZ3RoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG1lc3NhZ2UuYm9keSA9IGRhdGEuc3Vic3RyaW5nKGJvZHlTdGFydCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XG4gICAgfTtcbiAgICBTSVAuUGFyc2VyID0gUGFyc2VyO1xufTtcblxuXG4vKioqLyB9KSxcbi8qIDEyICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblwidXNlIHN0cmljdFwiO1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgU0lQIE1lc3NhZ2VcbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoU0lQKSB7XG4gICAgdmFyIE91dGdvaW5nUmVxdWVzdCwgSW5jb21pbmdNZXNzYWdlLCBJbmNvbWluZ1JlcXVlc3QsIEluY29taW5nUmVzcG9uc2U7XG4gICAgZnVuY3Rpb24gZ2V0U3VwcG9ydGVkSGVhZGVyKHJlcXVlc3QpIHtcbiAgICAgICAgdmFyIGFsbG93VW5yZWdpc3RlcmVkID0gcmVxdWVzdC51YS5jb25maWd1cmF0aW9uLmhhY2tBbGxvd1VucmVnaXN0ZXJlZE9wdGlvblRhZ3M7XG4gICAgICAgIHZhciBvcHRpb25UYWdzID0gW107XG4gICAgICAgIHZhciBvcHRpb25UYWdTZXQgPSB7fTtcbiAgICAgICAgaWYgKHJlcXVlc3QubWV0aG9kID09PSBTSVAuQy5SRUdJU1RFUikge1xuICAgICAgICAgICAgb3B0aW9uVGFncy5wdXNoKCdwYXRoJywgJ2dydXUnKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChyZXF1ZXN0Lm1ldGhvZCA9PT0gU0lQLkMuSU5WSVRFICYmXG4gICAgICAgICAgICAocmVxdWVzdC51YS5jb250YWN0LnB1Yl9ncnV1IHx8IHJlcXVlc3QudWEuY29udGFjdC50ZW1wX2dydXUpKSB7XG4gICAgICAgICAgICBvcHRpb25UYWdzLnB1c2goJ2dydXUnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVxdWVzdC51YS5jb25maWd1cmF0aW9uLnJlbDEwMCA9PT0gU0lQLkMuc3VwcG9ydGVkLlNVUFBPUlRFRCkge1xuICAgICAgICAgICAgb3B0aW9uVGFncy5wdXNoKCcxMDByZWwnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVxdWVzdC51YS5jb25maWd1cmF0aW9uLnJlcGxhY2VzID09PSBTSVAuQy5zdXBwb3J0ZWQuU1VQUE9SVEVEKSB7XG4gICAgICAgICAgICBvcHRpb25UYWdzLnB1c2goJ3JlcGxhY2VzJyk7XG4gICAgICAgIH1cbiAgICAgICAgb3B0aW9uVGFncy5wdXNoKCdvdXRib3VuZCcpO1xuICAgICAgICBvcHRpb25UYWdzID0gb3B0aW9uVGFncy5jb25jYXQocmVxdWVzdC51YS5jb25maWd1cmF0aW9uLmV4dHJhU3VwcG9ydGVkKTtcbiAgICAgICAgb3B0aW9uVGFncyA9IG9wdGlvblRhZ3MuZmlsdGVyKGZ1bmN0aW9uIChvcHRpb25UYWcpIHtcbiAgICAgICAgICAgIHZhciByZWdpc3RlcmVkID0gU0lQLkMuT1BUSU9OX1RBR1Nbb3B0aW9uVGFnXTtcbiAgICAgICAgICAgIHZhciB1bmlxdWUgPSAhb3B0aW9uVGFnU2V0W29wdGlvblRhZ107XG4gICAgICAgICAgICBvcHRpb25UYWdTZXRbb3B0aW9uVGFnXSA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm4gKHJlZ2lzdGVyZWQgfHwgYWxsb3dVbnJlZ2lzdGVyZWQpICYmIHVuaXF1ZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiAnU3VwcG9ydGVkOiAnICsgb3B0aW9uVGFncy5qb2luKCcsICcpICsgJ1xcclxcbic7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBhdWdtZW50cyBTSVBcbiAgICAgKiBAY2xhc3MgQ2xhc3MgZm9yIG91dGdvaW5nIFNJUCByZXF1ZXN0LlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBtZXRob2QgcmVxdWVzdCBtZXRob2RcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gcnVyaSByZXF1ZXN0IHVyaVxuICAgICAqIEBwYXJhbSB7U0lQLlVBfSB1YVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBwYXJhbXMgcGFyYW1ldGVycyB0aGF0IHdpbGwgaGF2ZSBwcmlvcml0eSBvdmVyIHVhLmNvbmZpZ3VyYXRpb24gcGFyYW1ldGVyczpcbiAgICAgKiA8YnI+XG4gICAgICogIC0gY3NlcSwgY2FsbF9pZCwgZnJvbV90YWcsIGZyb21fdXJpLCBmcm9tX2Rpc3BsYXlOYW1lLCB0b191cmksIHRvX3RhZywgcm91dGVfc2V0XG4gICAgICogQHBhcmFtIHtPYmplY3R9IFtoZWFkZXJzXSBleHRyYSBoZWFkZXJzXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtib2R5XVxuICAgICAqL1xuICAgIE91dGdvaW5nUmVxdWVzdCA9IGZ1bmN0aW9uIChtZXRob2QsIHJ1cmksIHVhLCBwYXJhbXMsIGV4dHJhSGVhZGVycywgYm9keSkge1xuICAgICAgICB2YXIgdG8sIGZyb20sIGNhbGxfaWQsIGNzZXEsIHRvX3VyaSwgZnJvbV91cmk7XG4gICAgICAgIHBhcmFtcyA9IHBhcmFtcyB8fCB7fTtcbiAgICAgICAgLy8gTWFuZGF0b3J5IHBhcmFtZXRlcnMgY2hlY2tcbiAgICAgICAgaWYgKCFtZXRob2QgfHwgIXJ1cmkgfHwgIXVhKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxvZ2dlciA9IHVhLmdldExvZ2dlcignc2lwLnNpcG1lc3NhZ2UnKTtcbiAgICAgICAgdGhpcy51YSA9IHVhO1xuICAgICAgICB0aGlzLmhlYWRlcnMgPSB7fTtcbiAgICAgICAgdGhpcy5tZXRob2QgPSBtZXRob2Q7XG4gICAgICAgIHRoaXMucnVyaSA9IHJ1cmk7XG4gICAgICAgIHRoaXMuYm9keSA9IGJvZHk7XG4gICAgICAgIHRoaXMuZXh0cmFIZWFkZXJzID0gKGV4dHJhSGVhZGVycyB8fCBbXSkuc2xpY2UoKTtcbiAgICAgICAgdGhpcy5zdGF0dXNDb2RlID0gcGFyYW1zLnN0YXR1c19jb2RlO1xuICAgICAgICB0aGlzLnJlYXNvblBocmFzZSA9IHBhcmFtcy5yZWFzb25fcGhyYXNlO1xuICAgICAgICAvLyBGaWxsIHRoZSBDb21tb24gU0lQIFJlcXVlc3QgSGVhZGVyc1xuICAgICAgICAvLyBSb3V0ZVxuICAgICAgICBpZiAocGFyYW1zLnJvdXRlX3NldCkge1xuICAgICAgICAgICAgdGhpcy5zZXRIZWFkZXIoJ3JvdXRlJywgcGFyYW1zLnJvdXRlX3NldCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodWEuY29uZmlndXJhdGlvbi51c2VQcmVsb2FkZWRSb3V0ZSkge1xuICAgICAgICAgICAgdGhpcy5zZXRIZWFkZXIoJ3JvdXRlJywgdWEudHJhbnNwb3J0LnNlcnZlci5zaXBfdXJpKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBWaWFcbiAgICAgICAgLy8gRW1wdHkgVmlhIGhlYWRlci4gV2lsbCBiZSBmaWxsZWQgYnkgdGhlIGNsaWVudCB0cmFuc2FjdGlvbi5cbiAgICAgICAgdGhpcy5zZXRIZWFkZXIoJ3ZpYScsICcnKTtcbiAgICAgICAgLy8gTWF4LUZvcndhcmRzXG4gICAgICAgIHRoaXMuc2V0SGVhZGVyKCdtYXgtZm9yd2FyZHMnLCBTSVAuVUEuQy5NQVhfRk9SV0FSRFMpO1xuICAgICAgICAvLyBUb1xuICAgICAgICB0b191cmkgPSBwYXJhbXMudG9fdXJpIHx8IHJ1cmk7XG4gICAgICAgIHRvID0gKHBhcmFtcy50b19kaXNwbGF5TmFtZSB8fCBwYXJhbXMudG9fZGlzcGxheU5hbWUgPT09IDApID8gJ1wiJyArIHBhcmFtcy50b19kaXNwbGF5TmFtZSArICdcIiAnIDogJyc7XG4gICAgICAgIHRvICs9ICc8JyArICh0b191cmkgJiYgdG9fdXJpLnRvUmF3ID8gdG9fdXJpLnRvUmF3KCkgOiB0b191cmkpICsgJz4nO1xuICAgICAgICB0byArPSBwYXJhbXMudG9fdGFnID8gJzt0YWc9JyArIHBhcmFtcy50b190YWcgOiAnJztcbiAgICAgICAgdGhpcy50byA9IG5ldyBTSVAuTmFtZUFkZHJIZWFkZXIucGFyc2UodG8pO1xuICAgICAgICB0aGlzLnNldEhlYWRlcigndG8nLCB0byk7XG4gICAgICAgIC8vIEZyb21cbiAgICAgICAgZnJvbV91cmkgPSBwYXJhbXMuZnJvbV91cmkgfHwgdWEuY29uZmlndXJhdGlvbi51cmk7XG4gICAgICAgIGlmIChwYXJhbXMuZnJvbV9kaXNwbGF5TmFtZSB8fCBwYXJhbXMuZnJvbV9kaXNwbGF5TmFtZSA9PT0gMCkge1xuICAgICAgICAgICAgZnJvbSA9ICdcIicgKyBwYXJhbXMuZnJvbV9kaXNwbGF5TmFtZSArICdcIiAnO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHVhLmNvbmZpZ3VyYXRpb24uZGlzcGxheU5hbWUpIHtcbiAgICAgICAgICAgIGZyb20gPSAnXCInICsgdWEuY29uZmlndXJhdGlvbi5kaXNwbGF5TmFtZSArICdcIiAnO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZnJvbSA9ICcnO1xuICAgICAgICB9XG4gICAgICAgIGZyb20gKz0gJzwnICsgKGZyb21fdXJpICYmIGZyb21fdXJpLnRvUmF3ID8gZnJvbV91cmkudG9SYXcoKSA6IGZyb21fdXJpKSArICc+O3RhZz0nO1xuICAgICAgICBmcm9tICs9IHBhcmFtcy5mcm9tX3RhZyB8fCBTSVAuVXRpbHMubmV3VGFnKCk7XG4gICAgICAgIHRoaXMuZnJvbSA9IG5ldyBTSVAuTmFtZUFkZHJIZWFkZXIucGFyc2UoZnJvbSk7XG4gICAgICAgIHRoaXMuc2V0SGVhZGVyKCdmcm9tJywgZnJvbSk7XG4gICAgICAgIC8vIENhbGwtSURcbiAgICAgICAgY2FsbF9pZCA9IHBhcmFtcy5jYWxsX2lkIHx8ICh1YS5jb25maWd1cmF0aW9uLnNpcGpzSWQgKyBTSVAuVXRpbHMuY3JlYXRlUmFuZG9tVG9rZW4oMTUpKTtcbiAgICAgICAgdGhpcy5jYWxsX2lkID0gY2FsbF9pZDtcbiAgICAgICAgdGhpcy5zZXRIZWFkZXIoJ2NhbGwtaWQnLCBjYWxsX2lkKTtcbiAgICAgICAgLy8gQ1NlcVxuICAgICAgICBjc2VxID0gcGFyYW1zLmNzZXEgfHwgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMDApO1xuICAgICAgICB0aGlzLmNzZXEgPSBjc2VxO1xuICAgICAgICB0aGlzLnNldEhlYWRlcignY3NlcScsIGNzZXEgKyAnICcgKyBtZXRob2QpO1xuICAgIH07XG4gICAgT3V0Z29pbmdSZXF1ZXN0LnByb3RvdHlwZSA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlcGxhY2UgdGhlIHRoZSBnaXZlbiBoZWFkZXIgYnkgdGhlIGdpdmVuIHZhbHVlLlxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBoZWFkZXIgbmFtZVxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZyB8IEFycmF5fSB2YWx1ZSBoZWFkZXIgdmFsdWVcbiAgICAgICAgICovXG4gICAgICAgIHNldEhlYWRlcjogZnVuY3Rpb24gKG5hbWUsIHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLmhlYWRlcnNbU0lQLlV0aWxzLmhlYWRlcml6ZShuYW1lKV0gPSAodmFsdWUgaW5zdGFuY2VvZiBBcnJheSkgPyB2YWx1ZSA6IFt2YWx1ZV07XG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHZXQgdGhlIHZhbHVlIG9mIHRoZSBnaXZlbiBoZWFkZXIgbmFtZSBhdCB0aGUgZ2l2ZW4gcG9zaXRpb24uXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIGhlYWRlciBuYW1lXG4gICAgICAgICAqIEByZXR1cm5zIHtTdHJpbmd8dW5kZWZpbmVkfSBSZXR1cm5zIHRoZSBzcGVjaWZpZWQgaGVhZGVyLCB1bmRlZmluZWQgaWYgaGVhZGVyIGRvZXNuJ3QgZXhpc3QuXG4gICAgICAgICAqL1xuICAgICAgICBnZXRIZWFkZXI6IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgICAgICB2YXIgcmVnZXhwLCBpZHgsIGxlbmd0aCA9IHRoaXMuZXh0cmFIZWFkZXJzLmxlbmd0aCwgaGVhZGVyID0gdGhpcy5oZWFkZXJzW1NJUC5VdGlscy5oZWFkZXJpemUobmFtZSldO1xuICAgICAgICAgICAgaWYgKGhlYWRlcikge1xuICAgICAgICAgICAgICAgIGlmIChoZWFkZXJbMF0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhlYWRlclswXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZWdleHAgPSBuZXcgUmVnRXhwKCdeXFxcXHMqJyArIG5hbWUgKyAnXFxcXHMqOicsICdpJyk7XG4gICAgICAgICAgICAgICAgZm9yIChpZHggPSAwOyBpZHggPCBsZW5ndGg7IGlkeCsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGhlYWRlciA9IHRoaXMuZXh0cmFIZWFkZXJzW2lkeF07XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZWdleHAudGVzdChoZWFkZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaGVhZGVyLnN1YnN0cmluZyhoZWFkZXIuaW5kZXhPZignOicpICsgMSkudHJpbSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9LFxuICAgICAgICAvKipcbiAgICAgICAgICogR2V0IHRoZSBoZWFkZXIvcyBvZiB0aGUgZ2l2ZW4gbmFtZS5cbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgaGVhZGVyIG5hbWVcbiAgICAgICAgICogQHJldHVybnMge0FycmF5fSBBcnJheSB3aXRoIGFsbCB0aGUgaGVhZGVycyBvZiB0aGUgc3BlY2lmaWVkIG5hbWUuXG4gICAgICAgICAqL1xuICAgICAgICBnZXRIZWFkZXJzOiBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICAgICAgdmFyIGlkeCwgbGVuZ3RoLCByZWdleHAsIGhlYWRlciA9IHRoaXMuaGVhZGVyc1tTSVAuVXRpbHMuaGVhZGVyaXplKG5hbWUpXSwgcmVzdWx0ID0gW107XG4gICAgICAgICAgICBpZiAoaGVhZGVyKSB7XG4gICAgICAgICAgICAgICAgbGVuZ3RoID0gaGVhZGVyLmxlbmd0aDtcbiAgICAgICAgICAgICAgICBmb3IgKGlkeCA9IDA7IGlkeCA8IGxlbmd0aDsgaWR4KyspIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goaGVhZGVyW2lkeF0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbGVuZ3RoID0gdGhpcy5leHRyYUhlYWRlcnMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHJlZ2V4cCA9IG5ldyBSZWdFeHAoJ15cXFxccyonICsgbmFtZSArICdcXFxccyo6JywgJ2knKTtcbiAgICAgICAgICAgICAgICBmb3IgKGlkeCA9IDA7IGlkeCA8IGxlbmd0aDsgaWR4KyspIHtcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyID0gdGhpcy5leHRyYUhlYWRlcnNbaWR4XTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlZ2V4cC50ZXN0KGhlYWRlcikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGhlYWRlci5zdWJzdHJpbmcoaGVhZGVyLmluZGV4T2YoJzonKSArIDEpLnRyaW0oKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFZlcmlmeSB0aGUgZXhpc3RlbmNlIG9mIHRoZSBnaXZlbiBoZWFkZXIuXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIGhlYWRlciBuYW1lXG4gICAgICAgICAqIEByZXR1cm5zIHtib29sZWFufSB0cnVlIGlmIGhlYWRlciB3aXRoIGdpdmVuIG5hbWUgZXhpc3RzLCBmYWxzZSBvdGhlcndpc2VcbiAgICAgICAgICovXG4gICAgICAgIGhhc0hlYWRlcjogZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgICAgIHZhciByZWdleHAsIGlkeCwgbGVuZ3RoID0gdGhpcy5leHRyYUhlYWRlcnMubGVuZ3RoO1xuICAgICAgICAgICAgaWYgKHRoaXMuaGVhZGVyc1tTSVAuVXRpbHMuaGVhZGVyaXplKG5hbWUpXSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVnZXhwID0gbmV3IFJlZ0V4cCgnXlxcXFxzKicgKyBuYW1lICsgJ1xcXFxzKjonLCAnaScpO1xuICAgICAgICAgICAgICAgIGZvciAoaWR4ID0gMDsgaWR4IDwgbGVuZ3RoOyBpZHgrKykge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVnZXhwLnRlc3QodGhpcy5leHRyYUhlYWRlcnNbaWR4XSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9LFxuICAgICAgICB0b1N0cmluZzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIG1zZyA9ICcnLCBoZWFkZXIsIGxlbmd0aCwgaWR4O1xuICAgICAgICAgICAgbXNnICs9IHRoaXMubWV0aG9kICsgJyAnICsgKHRoaXMucnVyaS50b1JhdyA/IHRoaXMucnVyaS50b1JhdygpIDogdGhpcy5ydXJpKSArICcgU0lQLzIuMFxcclxcbic7XG4gICAgICAgICAgICBmb3IgKGhlYWRlciBpbiB0aGlzLmhlYWRlcnMpIHtcbiAgICAgICAgICAgICAgICBsZW5ndGggPSB0aGlzLmhlYWRlcnNbaGVhZGVyXS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgZm9yIChpZHggPSAwOyBpZHggPCBsZW5ndGg7IGlkeCsrKSB7XG4gICAgICAgICAgICAgICAgICAgIG1zZyArPSBoZWFkZXIgKyAnOiAnICsgdGhpcy5oZWFkZXJzW2hlYWRlcl1baWR4XSArICdcXHJcXG4nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxlbmd0aCA9IHRoaXMuZXh0cmFIZWFkZXJzLmxlbmd0aDtcbiAgICAgICAgICAgIGZvciAoaWR4ID0gMDsgaWR4IDwgbGVuZ3RoOyBpZHgrKykge1xuICAgICAgICAgICAgICAgIG1zZyArPSB0aGlzLmV4dHJhSGVhZGVyc1tpZHhdLnRyaW0oKSArICdcXHJcXG4nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbXNnICs9IGdldFN1cHBvcnRlZEhlYWRlcih0aGlzKTtcbiAgICAgICAgICAgIG1zZyArPSAnVXNlci1BZ2VudDogJyArIHRoaXMudWEuY29uZmlndXJhdGlvbi51c2VyQWdlbnRTdHJpbmcgKyAnXFxyXFxuJztcbiAgICAgICAgICAgIGlmICh0aGlzLmJvZHkpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHRoaXMuYm9keSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgbGVuZ3RoID0gU0lQLlV0aWxzLnN0cl91dGY4X2xlbmd0aCh0aGlzLmJvZHkpO1xuICAgICAgICAgICAgICAgICAgICBtc2cgKz0gJ0NvbnRlbnQtTGVuZ3RoOiAnICsgbGVuZ3RoICsgJ1xcclxcblxcclxcbic7XG4gICAgICAgICAgICAgICAgICAgIG1zZyArPSB0aGlzLmJvZHk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ib2R5LmJvZHkgJiYgdGhpcy5ib2R5LmNvbnRlbnRUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZW5ndGggPSBTSVAuVXRpbHMuc3RyX3V0ZjhfbGVuZ3RoKHRoaXMuYm9keS5ib2R5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1zZyArPSAnQ29udGVudC1UeXBlOiAnICsgdGhpcy5ib2R5LmNvbnRlbnRUeXBlICsgJ1xcclxcbic7XG4gICAgICAgICAgICAgICAgICAgICAgICBtc2cgKz0gJ0NvbnRlbnQtTGVuZ3RoOiAnICsgbGVuZ3RoICsgJ1xcclxcblxcclxcbic7XG4gICAgICAgICAgICAgICAgICAgICAgICBtc2cgKz0gdGhpcy5ib2R5LmJvZHk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtc2cgKz0gJ0NvbnRlbnQtTGVuZ3RoOiAnICsgMCArICdcXHJcXG5cXHJcXG4nO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbXNnICs9ICdDb250ZW50LUxlbmd0aDogJyArIDAgKyAnXFxyXFxuXFxyXFxuJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBtc2c7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEBhdWdtZW50cyBTSVBcbiAgICAgKiBAY2xhc3MgQ2xhc3MgZm9yIGluY29taW5nIFNJUCBtZXNzYWdlLlxuICAgICAqL1xuICAgIEluY29taW5nTWVzc2FnZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5kYXRhID0gbnVsbDtcbiAgICAgICAgdGhpcy5oZWFkZXJzID0gbnVsbDtcbiAgICAgICAgdGhpcy5tZXRob2QgPSBudWxsO1xuICAgICAgICB0aGlzLnZpYSA9IG51bGw7XG4gICAgICAgIHRoaXMudmlhX2JyYW5jaCA9IG51bGw7XG4gICAgICAgIHRoaXMuY2FsbF9pZCA9IG51bGw7XG4gICAgICAgIHRoaXMuY3NlcSA9IG51bGw7XG4gICAgICAgIHRoaXMuZnJvbSA9IG51bGw7XG4gICAgICAgIHRoaXMuZnJvbV90YWcgPSBudWxsO1xuICAgICAgICB0aGlzLnRvID0gbnVsbDtcbiAgICAgICAgdGhpcy50b190YWcgPSBudWxsO1xuICAgICAgICB0aGlzLmJvZHkgPSBudWxsO1xuICAgIH07XG4gICAgSW5jb21pbmdNZXNzYWdlLnByb3RvdHlwZSA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICogSW5zZXJ0IGEgaGVhZGVyIG9mIHRoZSBnaXZlbiBuYW1lIGFuZCB2YWx1ZSBpbnRvIHRoZSBsYXN0IHBvc2l0aW9uIG9mIHRoZVxuICAgICAgICAqIGhlYWRlciBhcnJheS5cbiAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBoZWFkZXIgbmFtZVxuICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB2YWx1ZSBoZWFkZXIgdmFsdWVcbiAgICAgICAgKi9cbiAgICAgICAgYWRkSGVhZGVyOiBmdW5jdGlvbiAobmFtZSwgdmFsdWUpIHtcbiAgICAgICAgICAgIHZhciBoZWFkZXIgPSB7IHJhdzogdmFsdWUgfTtcbiAgICAgICAgICAgIG5hbWUgPSBTSVAuVXRpbHMuaGVhZGVyaXplKG5hbWUpO1xuICAgICAgICAgICAgaWYgKHRoaXMuaGVhZGVyc1tuYW1lXSkge1xuICAgICAgICAgICAgICAgIHRoaXMuaGVhZGVyc1tuYW1lXS5wdXNoKGhlYWRlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhlYWRlcnNbbmFtZV0gPSBbaGVhZGVyXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdldCB0aGUgdmFsdWUgb2YgdGhlIGdpdmVuIGhlYWRlciBuYW1lIGF0IHRoZSBnaXZlbiBwb3NpdGlvbi5cbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgaGVhZGVyIG5hbWVcbiAgICAgICAgICogQHJldHVybnMge1N0cmluZ3x1bmRlZmluZWR9IFJldHVybnMgdGhlIHNwZWNpZmllZCBoZWFkZXIsIG51bGwgaWYgaGVhZGVyIGRvZXNuJ3QgZXhpc3QuXG4gICAgICAgICAqL1xuICAgICAgICBnZXRIZWFkZXI6IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgICAgICB2YXIgaGVhZGVyID0gdGhpcy5oZWFkZXJzW1NJUC5VdGlscy5oZWFkZXJpemUobmFtZSldO1xuICAgICAgICAgICAgaWYgKGhlYWRlcikge1xuICAgICAgICAgICAgICAgIGlmIChoZWFkZXJbMF0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhlYWRlclswXS5yYXc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICAvKipcbiAgICAgICAgICogR2V0IHRoZSBoZWFkZXIvcyBvZiB0aGUgZ2l2ZW4gbmFtZS5cbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgaGVhZGVyIG5hbWVcbiAgICAgICAgICogQHJldHVybnMge0FycmF5fSBBcnJheSB3aXRoIGFsbCB0aGUgaGVhZGVycyBvZiB0aGUgc3BlY2lmaWVkIG5hbWUuXG4gICAgICAgICAqL1xuICAgICAgICBnZXRIZWFkZXJzOiBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICAgICAgdmFyIGlkeCwgbGVuZ3RoLCBoZWFkZXIgPSB0aGlzLmhlYWRlcnNbU0lQLlV0aWxzLmhlYWRlcml6ZShuYW1lKV0sIHJlc3VsdCA9IFtdO1xuICAgICAgICAgICAgaWYgKCFoZWFkZXIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZW5ndGggPSBoZWFkZXIubGVuZ3RoO1xuICAgICAgICAgICAgZm9yIChpZHggPSAwOyBpZHggPCBsZW5ndGg7IGlkeCsrKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goaGVhZGVyW2lkeF0ucmF3KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBWZXJpZnkgdGhlIGV4aXN0ZW5jZSBvZiB0aGUgZ2l2ZW4gaGVhZGVyLlxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBoZWFkZXIgbmFtZVxuICAgICAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gdHJ1ZSBpZiBoZWFkZXIgd2l0aCBnaXZlbiBuYW1lIGV4aXN0cywgZmFsc2Ugb3RoZXJ3aXNlXG4gICAgICAgICAqL1xuICAgICAgICBoYXNIZWFkZXI6IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgICAgICByZXR1cm4gKHRoaXMuaGVhZGVyc1tTSVAuVXRpbHMuaGVhZGVyaXplKG5hbWUpXSkgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICAqIFBhcnNlIHRoZSBnaXZlbiBoZWFkZXIgb24gdGhlIGdpdmVuIGluZGV4LlxuICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIGhlYWRlciBuYW1lXG4gICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IFtpZHg9MF0gaGVhZGVyIGluZGV4XG4gICAgICAgICogQHJldHVybnMge09iamVjdHx1bmRlZmluZWR9IFBhcnNlZCBoZWFkZXIgb2JqZWN0LCB1bmRlZmluZWQgaWYgdGhlIGhlYWRlciBpcyBub3QgcHJlc2VudCBvciBpbiBjYXNlIG9mIGEgcGFyc2luZyBlcnJvci5cbiAgICAgICAgKi9cbiAgICAgICAgcGFyc2VIZWFkZXI6IGZ1bmN0aW9uIChuYW1lLCBpZHgpIHtcbiAgICAgICAgICAgIHZhciBoZWFkZXIsIHZhbHVlLCBwYXJzZWQ7XG4gICAgICAgICAgICBuYW1lID0gU0lQLlV0aWxzLmhlYWRlcml6ZShuYW1lKTtcbiAgICAgICAgICAgIGlkeCA9IGlkeCB8fCAwO1xuICAgICAgICAgICAgaWYgKCF0aGlzLmhlYWRlcnNbbmFtZV0pIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ2hlYWRlciBcIicgKyBuYW1lICsgJ1wiIG5vdCBwcmVzZW50Jyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoaWR4ID49IHRoaXMuaGVhZGVyc1tuYW1lXS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ25vdCBzbyBtYW55IFwiJyArIG5hbWUgKyAnXCIgaGVhZGVycyBwcmVzZW50Jyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaGVhZGVyID0gdGhpcy5oZWFkZXJzW25hbWVdW2lkeF07XG4gICAgICAgICAgICB2YWx1ZSA9IGhlYWRlci5yYXc7XG4gICAgICAgICAgICBpZiAoaGVhZGVyLnBhcnNlZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBoZWFkZXIucGFyc2VkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy9zdWJzdGl0dXRlICctJyBieSAnXycgZm9yIGdyYW1tYXIgcnVsZSBtYXRjaGluZy5cbiAgICAgICAgICAgIHBhcnNlZCA9IFNJUC5HcmFtbWFyLnBhcnNlKHZhbHVlLCBuYW1lLnJlcGxhY2UoLy0vZywgJ18nKSk7XG4gICAgICAgICAgICBpZiAocGFyc2VkID09PSAtMSkge1xuICAgICAgICAgICAgICAgIHRoaXMuaGVhZGVyc1tuYW1lXS5zcGxpY2UoaWR4LCAxKTsgLy9kZWxldGUgZnJvbSBoZWFkZXJzXG4gICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIud2FybignZXJyb3IgcGFyc2luZyBcIicgKyBuYW1lICsgJ1wiIGhlYWRlciBmaWVsZCB3aXRoIHZhbHVlIFwiJyArIHZhbHVlICsgJ1wiJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaGVhZGVyLnBhcnNlZCA9IHBhcnNlZDtcbiAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VkO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICAvKipcbiAgICAgICAgICogTWVzc2FnZSBIZWFkZXIgYXR0cmlidXRlIHNlbGVjdG9yLiBBbGlhcyBvZiBwYXJzZUhlYWRlci5cbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgaGVhZGVyIG5hbWVcbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IFtpZHg9MF0gaGVhZGVyIGluZGV4XG4gICAgICAgICAqIEByZXR1cm5zIHtPYmplY3R8dW5kZWZpbmVkfSBQYXJzZWQgaGVhZGVyIG9iamVjdCwgdW5kZWZpbmVkIGlmIHRoZSBoZWFkZXIgaXMgbm90IHByZXNlbnQgb3IgaW4gY2FzZSBvZiBhIHBhcnNpbmcgZXJyb3IuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBleGFtcGxlXG4gICAgICAgICAqIG1lc3NhZ2UucygndmlhJywzKS5wb3J0XG4gICAgICAgICAqL1xuICAgICAgICBzOiBmdW5jdGlvbiAobmFtZSwgaWR4KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZUhlYWRlcihuYW1lLCBpZHgpO1xuICAgICAgICB9LFxuICAgICAgICAvKipcbiAgICAgICAgKiBSZXBsYWNlIHRoZSB2YWx1ZSBvZiB0aGUgZ2l2ZW4gaGVhZGVyIGJ5IHRoZSB2YWx1ZS5cbiAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBoZWFkZXIgbmFtZVxuICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB2YWx1ZSBoZWFkZXIgdmFsdWVcbiAgICAgICAgKi9cbiAgICAgICAgc2V0SGVhZGVyOiBmdW5jdGlvbiAobmFtZSwgdmFsdWUpIHtcbiAgICAgICAgICAgIHZhciBoZWFkZXIgPSB7IHJhdzogdmFsdWUgfTtcbiAgICAgICAgICAgIHRoaXMuaGVhZGVyc1tTSVAuVXRpbHMuaGVhZGVyaXplKG5hbWUpXSA9IFtoZWFkZXJdO1xuICAgICAgICB9LFxuICAgICAgICB0b1N0cmluZzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGF0YTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgLyoqXG4gICAgICogQGF1Z21lbnRzIEluY29taW5nTWVzc2FnZVxuICAgICAqIEBjbGFzcyBDbGFzcyBmb3IgaW5jb21pbmcgU0lQIHJlcXVlc3QuXG4gICAgICovXG4gICAgSW5jb21pbmdSZXF1ZXN0ID0gZnVuY3Rpb24gKHVhKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyID0gdWEuZ2V0TG9nZ2VyKCdzaXAuc2lwbWVzc2FnZScpO1xuICAgICAgICB0aGlzLnVhID0gdWE7XG4gICAgICAgIHRoaXMuaGVhZGVycyA9IHt9O1xuICAgICAgICB0aGlzLnJ1cmkgPSBudWxsO1xuICAgICAgICB0aGlzLnRyYW5zcG9ydCA9IG51bGw7XG4gICAgICAgIHRoaXMuc2VydmVyX3RyYW5zYWN0aW9uID0gbnVsbDtcbiAgICB9O1xuICAgIEluY29taW5nUmVxdWVzdC5wcm90b3R5cGUgPSBuZXcgSW5jb21pbmdNZXNzYWdlKCk7XG4gICAgLyoqXG4gICAgKiBTdGF0ZWZ1bCByZXBseS5cbiAgICAqIEBwYXJhbSB7TnVtYmVyfSBjb2RlIHN0YXR1cyBjb2RlXG4gICAgKiBAcGFyYW0ge1N0cmluZ30gcmVhc29uIHJlYXNvbiBwaHJhc2VcbiAgICAqIEBwYXJhbSB7T2JqZWN0fSBoZWFkZXJzIGV4dHJhIGhlYWRlcnNcbiAgICAqIEBwYXJhbSB7U3RyaW5nfSBib2R5IGJvZHlcbiAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtvblN1Y2Nlc3NdIG9uU3VjY2VzcyBjYWxsYmFja1xuICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW29uRmFpbHVyZV0gb25GYWlsdXJlIGNhbGxiYWNrXG4gICAgKi9cbiAgICAvLyBUT0RPOiBHZXQgcmlkIG9mIGNhbGxiYWNrcyBhbmQgbWFrZSBwcm9taXNlIGJhc2VkXG4gICAgSW5jb21pbmdSZXF1ZXN0LnByb3RvdHlwZS5yZXBseSA9IGZ1bmN0aW9uIChjb2RlLCByZWFzb24sIGV4dHJhSGVhZGVycywgYm9keSwgb25TdWNjZXNzLCBvbkZhaWx1cmUpIHtcbiAgICAgICAgdmFyIHJyLCB2aWFzLCBsZW5ndGgsIGlkeCwgcmVzcG9uc2UsIHRvID0gdGhpcy5nZXRIZWFkZXIoJ1RvJyksIHIgPSAwLCB2ID0gMDtcbiAgICAgICAgcmVzcG9uc2UgPSBTSVAuVXRpbHMuYnVpbGRTdGF0dXNMaW5lKGNvZGUsIHJlYXNvbik7XG4gICAgICAgIGV4dHJhSGVhZGVycyA9IChleHRyYUhlYWRlcnMgfHwgW10pLnNsaWNlKCk7XG4gICAgICAgIGlmICh0aGlzLm1ldGhvZCA9PT0gU0lQLkMuSU5WSVRFICYmIGNvZGUgPiAxMDAgJiYgY29kZSA8PSAyMDApIHtcbiAgICAgICAgICAgIHJyID0gdGhpcy5nZXRIZWFkZXJzKCdyZWNvcmQtcm91dGUnKTtcbiAgICAgICAgICAgIGxlbmd0aCA9IHJyLmxlbmd0aDtcbiAgICAgICAgICAgIGZvciAocjsgciA8IGxlbmd0aDsgcisrKSB7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2UgKz0gJ1JlY29yZC1Sb3V0ZTogJyArIHJyW3JdICsgJ1xcclxcbic7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdmlhcyA9IHRoaXMuZ2V0SGVhZGVycygndmlhJyk7XG4gICAgICAgIGxlbmd0aCA9IHZpYXMubGVuZ3RoO1xuICAgICAgICBmb3IgKHY7IHYgPCBsZW5ndGg7IHYrKykge1xuICAgICAgICAgICAgcmVzcG9uc2UgKz0gJ1ZpYTogJyArIHZpYXNbdl0gKyAnXFxyXFxuJztcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMudG9fdGFnICYmIGNvZGUgPiAxMDApIHtcbiAgICAgICAgICAgIHRvICs9ICc7dGFnPScgKyBTSVAuVXRpbHMubmV3VGFnKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy50b190YWcgJiYgIXRoaXMucygndG8nKS5oYXNQYXJhbSgndGFnJykpIHtcbiAgICAgICAgICAgIHRvICs9ICc7dGFnPScgKyB0aGlzLnRvX3RhZztcbiAgICAgICAgfVxuICAgICAgICByZXNwb25zZSArPSAnVG86ICcgKyB0byArICdcXHJcXG4nO1xuICAgICAgICByZXNwb25zZSArPSAnRnJvbTogJyArIHRoaXMuZ2V0SGVhZGVyKCdGcm9tJykgKyAnXFxyXFxuJztcbiAgICAgICAgcmVzcG9uc2UgKz0gJ0NhbGwtSUQ6ICcgKyB0aGlzLmNhbGxfaWQgKyAnXFxyXFxuJztcbiAgICAgICAgcmVzcG9uc2UgKz0gJ0NTZXE6ICcgKyB0aGlzLmNzZXEgKyAnICcgKyB0aGlzLm1ldGhvZCArICdcXHJcXG4nO1xuICAgICAgICBsZW5ndGggPSBleHRyYUhlYWRlcnMubGVuZ3RoO1xuICAgICAgICBmb3IgKGlkeCA9IDA7IGlkeCA8IGxlbmd0aDsgaWR4KyspIHtcbiAgICAgICAgICAgIHJlc3BvbnNlICs9IGV4dHJhSGVhZGVyc1tpZHhdLnRyaW0oKSArICdcXHJcXG4nO1xuICAgICAgICB9XG4gICAgICAgIHJlc3BvbnNlICs9IGdldFN1cHBvcnRlZEhlYWRlcih0aGlzKTtcbiAgICAgICAgcmVzcG9uc2UgKz0gJ1VzZXItQWdlbnQ6ICcgKyB0aGlzLnVhLmNvbmZpZ3VyYXRpb24udXNlckFnZW50U3RyaW5nICsgJ1xcclxcbic7XG4gICAgICAgIGlmIChib2R5KSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGJvZHkgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgbGVuZ3RoID0gU0lQLlV0aWxzLnN0cl91dGY4X2xlbmd0aChib2R5KTtcbiAgICAgICAgICAgICAgICByZXNwb25zZSArPSAnQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9zZHBcXHJcXG4nO1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlICs9ICdDb250ZW50LUxlbmd0aDogJyArIGxlbmd0aCArICdcXHJcXG5cXHJcXG4nO1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlICs9IGJvZHk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoYm9keS5ib2R5ICYmIGJvZHkuY29udGVudFR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgbGVuZ3RoID0gU0lQLlV0aWxzLnN0cl91dGY4X2xlbmd0aChib2R5LmJvZHkpO1xuICAgICAgICAgICAgICAgICAgICByZXNwb25zZSArPSAnQ29udGVudC1UeXBlOiAnICsgYm9keS5jb250ZW50VHlwZSArICdcXHJcXG4nO1xuICAgICAgICAgICAgICAgICAgICByZXNwb25zZSArPSAnQ29udGVudC1MZW5ndGg6ICcgKyBsZW5ndGggKyAnXFxyXFxuXFxyXFxuJztcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgKz0gYm9keS5ib2R5O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgKz0gJ0NvbnRlbnQtTGVuZ3RoOiAnICsgMCArICdcXHJcXG5cXHJcXG4nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJlc3BvbnNlICs9ICdDb250ZW50LUxlbmd0aDogJyArIDAgKyAnXFxyXFxuXFxyXFxuJztcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNlcnZlcl90cmFuc2FjdGlvbi5yZWNlaXZlUmVzcG9uc2UoY29kZSwgcmVzcG9uc2UpLnRoZW4ob25TdWNjZXNzLCBvbkZhaWx1cmUpO1xuICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfTtcbiAgICAvKipcbiAgICAqIFN0YXRlbGVzcyByZXBseS5cbiAgICAqIEBwYXJhbSB7TnVtYmVyfSBjb2RlIHN0YXR1cyBjb2RlXG4gICAgKiBAcGFyYW0ge1N0cmluZ30gcmVhc29uIHJlYXNvbiBwaHJhc2VcbiAgICAqL1xuICAgIEluY29taW5nUmVxdWVzdC5wcm90b3R5cGUucmVwbHlfc2wgPSBmdW5jdGlvbiAoY29kZSwgcmVhc29uKSB7XG4gICAgICAgIHZhciB0bywgcmVzcG9uc2UsIHYgPSAwLCB2aWFzID0gdGhpcy5nZXRIZWFkZXJzKCd2aWEnKSwgbGVuZ3RoID0gdmlhcy5sZW5ndGg7XG4gICAgICAgIHJlc3BvbnNlID0gU0lQLlV0aWxzLmJ1aWxkU3RhdHVzTGluZShjb2RlLCByZWFzb24pO1xuICAgICAgICBmb3IgKHY7IHYgPCBsZW5ndGg7IHYrKykge1xuICAgICAgICAgICAgcmVzcG9uc2UgKz0gJ1ZpYTogJyArIHZpYXNbdl0gKyAnXFxyXFxuJztcbiAgICAgICAgfVxuICAgICAgICB0byA9IHRoaXMuZ2V0SGVhZGVyKCdUbycpO1xuICAgICAgICBpZiAoIXRoaXMudG9fdGFnICYmIGNvZGUgPiAxMDApIHtcbiAgICAgICAgICAgIHRvICs9ICc7dGFnPScgKyBTSVAuVXRpbHMubmV3VGFnKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy50b190YWcgJiYgIXRoaXMucygndG8nKS5oYXNQYXJhbSgndGFnJykpIHtcbiAgICAgICAgICAgIHRvICs9ICc7dGFnPScgKyB0aGlzLnRvX3RhZztcbiAgICAgICAgfVxuICAgICAgICByZXNwb25zZSArPSAnVG86ICcgKyB0byArICdcXHJcXG4nO1xuICAgICAgICByZXNwb25zZSArPSAnRnJvbTogJyArIHRoaXMuZ2V0SGVhZGVyKCdGcm9tJykgKyAnXFxyXFxuJztcbiAgICAgICAgcmVzcG9uc2UgKz0gJ0NhbGwtSUQ6ICcgKyB0aGlzLmNhbGxfaWQgKyAnXFxyXFxuJztcbiAgICAgICAgcmVzcG9uc2UgKz0gJ0NTZXE6ICcgKyB0aGlzLmNzZXEgKyAnICcgKyB0aGlzLm1ldGhvZCArICdcXHJcXG4nO1xuICAgICAgICByZXNwb25zZSArPSAnVXNlci1BZ2VudDogJyArIHRoaXMudWEuY29uZmlndXJhdGlvbi51c2VyQWdlbnRTdHJpbmcgKyAnXFxyXFxuJztcbiAgICAgICAgcmVzcG9uc2UgKz0gJ0NvbnRlbnQtTGVuZ3RoOiAnICsgMCArICdcXHJcXG5cXHJcXG4nO1xuICAgICAgICB0aGlzLnRyYW5zcG9ydC5zZW5kKHJlc3BvbnNlKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEBhdWdtZW50cyBJbmNvbWluZ01lc3NhZ2VcbiAgICAgKiBAY2xhc3MgQ2xhc3MgZm9yIGluY29taW5nIFNJUCByZXNwb25zZS5cbiAgICAgKi9cbiAgICBJbmNvbWluZ1Jlc3BvbnNlID0gZnVuY3Rpb24gKHVhKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyID0gdWEuZ2V0TG9nZ2VyKCdzaXAuc2lwbWVzc2FnZScpO1xuICAgICAgICB0aGlzLmhlYWRlcnMgPSB7fTtcbiAgICAgICAgdGhpcy5zdGF0dXNfY29kZSA9IG51bGw7XG4gICAgICAgIHRoaXMucmVhc29uX3BocmFzZSA9IG51bGw7XG4gICAgfTtcbiAgICBJbmNvbWluZ1Jlc3BvbnNlLnByb3RvdHlwZSA9IG5ldyBJbmNvbWluZ01lc3NhZ2UoKTtcbiAgICBTSVAuT3V0Z29pbmdSZXF1ZXN0ID0gT3V0Z29pbmdSZXF1ZXN0O1xuICAgIFNJUC5JbmNvbWluZ1JlcXVlc3QgPSBJbmNvbWluZ1JlcXVlc3Q7XG4gICAgU0lQLkluY29taW5nUmVzcG9uc2UgPSBJbmNvbWluZ1Jlc3BvbnNlO1xufTtcblxuXG4vKioqLyB9KSxcbi8qIDEzICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblwidXNlIHN0cmljdFwiO1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgU0lQIFVSSVxuICovXG4vKipcbiAqIEBhdWdtZW50cyBTSVBcbiAqIEBjbGFzcyBDbGFzcyBjcmVhdGluZyBhIFNJUCBVUkkuXG4gKlxuICogQHBhcmFtIHtTdHJpbmd9IFtzY2hlbWVdXG4gKiBAcGFyYW0ge1N0cmluZ30gW3VzZXJdXG4gKiBAcGFyYW0ge1N0cmluZ30gaG9zdFxuICogQHBhcmFtIHtTdHJpbmd9IFtwb3J0XVxuICogQHBhcmFtIHtPYmplY3R9IFtwYXJhbWV0ZXJzXVxuICogQHBhcmFtIHtPYmplY3R9IFtoZWFkZXJzXVxuICpcbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoU0lQKSB7XG4gICAgdmFyIFVSSTtcbiAgICBVUkkgPSBmdW5jdGlvbiAoc2NoZW1lLCB1c2VyLCBob3N0LCBwb3J0LCBwYXJhbWV0ZXJzLCBoZWFkZXJzKSB7XG4gICAgICAgIHZhciBwYXJhbSwgaGVhZGVyLCByYXcsIG5vcm1hbDtcbiAgICAgICAgLy8gQ2hlY2tzXG4gICAgICAgIGlmICghaG9zdCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignbWlzc2luZyBvciBpbnZhbGlkIFwiaG9zdFwiIHBhcmFtZXRlcicpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEluaXRpYWxpemUgcGFyYW1ldGVyc1xuICAgICAgICBzY2hlbWUgPSBzY2hlbWUgfHwgU0lQLkMuU0lQO1xuICAgICAgICB0aGlzLnBhcmFtZXRlcnMgPSB7fTtcbiAgICAgICAgdGhpcy5oZWFkZXJzID0ge307XG4gICAgICAgIGZvciAocGFyYW0gaW4gcGFyYW1ldGVycykge1xuICAgICAgICAgICAgdGhpcy5zZXRQYXJhbShwYXJhbSwgcGFyYW1ldGVyc1twYXJhbV0pO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoaGVhZGVyIGluIGhlYWRlcnMpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0SGVhZGVyKGhlYWRlciwgaGVhZGVyc1toZWFkZXJdKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBSYXcgVVJJXG4gICAgICAgIHJhdyA9IHtcbiAgICAgICAgICAgIHNjaGVtZTogc2NoZW1lLFxuICAgICAgICAgICAgdXNlcjogdXNlcixcbiAgICAgICAgICAgIGhvc3Q6IGhvc3QsXG4gICAgICAgICAgICBwb3J0OiBwb3J0XG4gICAgICAgIH07XG4gICAgICAgIC8vIE5vcm1hbGl6ZWQgVVJJXG4gICAgICAgIG5vcm1hbCA9IHtcbiAgICAgICAgICAgIHNjaGVtZTogc2NoZW1lLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICB1c2VyOiB1c2VyLFxuICAgICAgICAgICAgaG9zdDogaG9zdC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgcG9ydDogcG9ydFxuICAgICAgICB9O1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0aGlzLCB7XG4gICAgICAgICAgICBfbm9ybWFsOiB7XG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBub3JtYWw7IH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfcmF3OiB7XG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiByYXc7IH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzY2hlbWU6IHtcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIG5vcm1hbC5zY2hlbWU7IH0sXG4gICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmF3LnNjaGVtZSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBub3JtYWwuc2NoZW1lID0gdmFsdWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gbm9ybWFsLnVzZXI7IH0sXG4gICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgbm9ybWFsLnVzZXIgPSByYXcudXNlciA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBob3N0OiB7XG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBub3JtYWwuaG9zdDsgfSxcbiAgICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICByYXcuaG9zdCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBub3JtYWwuaG9zdCA9IHZhbHVlLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGFvcjoge1xuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gbm9ybWFsLnVzZXIgKyAnQCcgKyBub3JtYWwuaG9zdDsgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBvcnQ6IHtcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIG5vcm1hbC5wb3J0OyB9LFxuICAgICAgICAgICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vcm1hbC5wb3J0ID0gcmF3LnBvcnQgPSB2YWx1ZSA9PT0gMCA/IHZhbHVlIDogKHBhcnNlSW50KHZhbHVlLCAxMCkgfHwgbnVsbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFVSSS5wcm90b3R5cGUgPSB7XG4gICAgICAgIHNldFBhcmFtOiBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKGtleSkge1xuICAgICAgICAgICAgICAgIHRoaXMucGFyYW1ldGVyc1trZXkudG9Mb3dlckNhc2UoKV0gPSAodHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJyB8fCB2YWx1ZSA9PT0gbnVsbCkgPyBudWxsIDogdmFsdWUudG9TdHJpbmcoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZ2V0UGFyYW06IGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIGlmIChrZXkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJhbWV0ZXJzW2tleS50b0xvd2VyQ2FzZSgpXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgaGFzUGFyYW06IGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIGlmIChrZXkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKHRoaXMucGFyYW1ldGVycy5oYXNPd25Qcm9wZXJ0eShrZXkudG9Mb3dlckNhc2UoKSkgJiYgdHJ1ZSkgfHwgZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGRlbGV0ZVBhcmFtOiBmdW5jdGlvbiAocGFyYW1ldGVyKSB7XG4gICAgICAgICAgICB2YXIgdmFsdWU7XG4gICAgICAgICAgICBwYXJhbWV0ZXIgPSBwYXJhbWV0ZXIudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIGlmICh0aGlzLnBhcmFtZXRlcnMuaGFzT3duUHJvcGVydHkocGFyYW1ldGVyKSkge1xuICAgICAgICAgICAgICAgIHZhbHVlID0gdGhpcy5wYXJhbWV0ZXJzW3BhcmFtZXRlcl07XG4gICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMucGFyYW1ldGVyc1twYXJhbWV0ZXJdO1xuICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgY2xlYXJQYXJhbXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMucGFyYW1ldGVycyA9IHt9O1xuICAgICAgICB9LFxuICAgICAgICBzZXRIZWFkZXI6IGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5oZWFkZXJzW1NJUC5VdGlscy5oZWFkZXJpemUobmFtZSldID0gKHZhbHVlIGluc3RhbmNlb2YgQXJyYXkpID8gdmFsdWUgOiBbdmFsdWVdO1xuICAgICAgICB9LFxuICAgICAgICBnZXRIZWFkZXI6IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgICAgICBpZiAobmFtZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmhlYWRlcnNbU0lQLlV0aWxzLmhlYWRlcml6ZShuYW1lKV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGhhc0hlYWRlcjogZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgICAgIGlmIChuYW1lKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICh0aGlzLmhlYWRlcnMuaGFzT3duUHJvcGVydHkoU0lQLlV0aWxzLmhlYWRlcml6ZShuYW1lKSkgJiYgdHJ1ZSkgfHwgZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGRlbGV0ZUhlYWRlcjogZnVuY3Rpb24gKGhlYWRlcikge1xuICAgICAgICAgICAgdmFyIHZhbHVlO1xuICAgICAgICAgICAgaGVhZGVyID0gU0lQLlV0aWxzLmhlYWRlcml6ZShoZWFkZXIpO1xuICAgICAgICAgICAgaWYgKHRoaXMuaGVhZGVycy5oYXNPd25Qcm9wZXJ0eShoZWFkZXIpKSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSB0aGlzLmhlYWRlcnNbaGVhZGVyXTtcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5oZWFkZXJzW2hlYWRlcl07XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBjbGVhckhlYWRlcnM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuaGVhZGVycyA9IHt9O1xuICAgICAgICB9LFxuICAgICAgICBjbG9uZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBVUkkodGhpcy5fcmF3LnNjaGVtZSwgdGhpcy5fcmF3LnVzZXIsIHRoaXMuX3Jhdy5ob3N0LCB0aGlzLl9yYXcucG9ydCwgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLnBhcmFtZXRlcnMpKSwgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmhlYWRlcnMpKSk7XG4gICAgICAgIH0sXG4gICAgICAgIHRvUmF3OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fdG9TdHJpbmcodGhpcy5fcmF3KTtcbiAgICAgICAgfSxcbiAgICAgICAgdG9TdHJpbmc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl90b1N0cmluZyh0aGlzLl9ub3JtYWwpO1xuICAgICAgICB9LFxuICAgICAgICBfdG9TdHJpbmc6IGZ1bmN0aW9uICh1cmkpIHtcbiAgICAgICAgICAgIHZhciBoZWFkZXIsIHBhcmFtZXRlciwgaWR4LCB1cmlTdHJpbmcsIGhlYWRlcnMgPSBbXTtcbiAgICAgICAgICAgIHVyaVN0cmluZyA9IHVyaS5zY2hlbWUgKyAnOic7XG4gICAgICAgICAgICAvLyBhZGQgc2xhc2hlcyBpZiBpdCdzIG5vdCBhIHNpcChzKSBVUklcbiAgICAgICAgICAgIGlmICghdXJpLnNjaGVtZS50b0xvd2VyQ2FzZSgpLm1hdGNoKFwiXnNpcHM/JFwiKSkge1xuICAgICAgICAgICAgICAgIHVyaVN0cmluZyArPSBcIi8vXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodXJpLnVzZXIpIHtcbiAgICAgICAgICAgICAgICB1cmlTdHJpbmcgKz0gU0lQLlV0aWxzLmVzY2FwZVVzZXIodXJpLnVzZXIpICsgJ0AnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdXJpU3RyaW5nICs9IHVyaS5ob3N0O1xuICAgICAgICAgICAgaWYgKHVyaS5wb3J0IHx8IHVyaS5wb3J0ID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdXJpU3RyaW5nICs9ICc6JyArIHVyaS5wb3J0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yIChwYXJhbWV0ZXIgaW4gdGhpcy5wYXJhbWV0ZXJzKSB7XG4gICAgICAgICAgICAgICAgdXJpU3RyaW5nICs9ICc7JyArIHBhcmFtZXRlcjtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5wYXJhbWV0ZXJzW3BhcmFtZXRlcl0gIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgdXJpU3RyaW5nICs9ICc9JyArIHRoaXMucGFyYW1ldGVyc1twYXJhbWV0ZXJdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAoaGVhZGVyIGluIHRoaXMuaGVhZGVycykge1xuICAgICAgICAgICAgICAgIGZvciAoaWR4IGluIHRoaXMuaGVhZGVyc1toZWFkZXJdKSB7XG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnMucHVzaChoZWFkZXIgKyAnPScgKyB0aGlzLmhlYWRlcnNbaGVhZGVyXVtpZHhdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaGVhZGVycy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdXJpU3RyaW5nICs9ICc/JyArIGhlYWRlcnMuam9pbignJicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHVyaVN0cmluZztcbiAgICAgICAgfVxuICAgIH07XG4gICAgLyoqXG4gICAgICAqIFBhcnNlIHRoZSBnaXZlbiBzdHJpbmcgYW5kIHJldHVybnMgYSBTSVAuVVJJIGluc3RhbmNlIG9yIHVuZGVmaW5lZCBpZlxuICAgICAgKiBpdCBpcyBhbiBpbnZhbGlkIFVSSS5cbiAgICAgICogQHB1YmxpY1xuICAgICAgKiBAcGFyYW0ge1N0cmluZ30gdXJpXG4gICAgICAqL1xuICAgIFVSSS5wYXJzZSA9IGZ1bmN0aW9uICh1cmkpIHtcbiAgICAgICAgdXJpID0gU0lQLkdyYW1tYXIucGFyc2UodXJpLCAnU0lQX1VSSScpO1xuICAgICAgICBpZiAodXJpICE9PSAtMSkge1xuICAgICAgICAgICAgcmV0dXJuIHVyaTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFNJUC5VUkkgPSBVUkk7XG59O1xuXG5cbi8qKiovIH0pLFxuLyogMTQgKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBTSVAgTmFtZUFkZHJIZWFkZXJcbiAqL1xuLyoqXG4gKiBAYXVnbWVudHMgU0lQXG4gKiBAY2xhc3MgQ2xhc3MgY3JlYXRpbmcgYSBOYW1lIEFkZHJlc3MgU0lQIGhlYWRlci5cbiAqXG4gKiBAcGFyYW0ge1NJUC5VUkl9IHVyaVxuICogQHBhcmFtIHtTdHJpbmd9IFtkaXNwbGF5TmFtZV1cbiAqIEBwYXJhbSB7T2JqZWN0fSBbcGFyYW1ldGVyc11cbiAqXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKFNJUCkge1xuICAgIHZhciBOYW1lQWRkckhlYWRlcjtcbiAgICBOYW1lQWRkckhlYWRlciA9IGZ1bmN0aW9uICh1cmksIGRpc3BsYXlOYW1lLCBwYXJhbWV0ZXJzKSB7XG4gICAgICAgIHZhciBwYXJhbTtcbiAgICAgICAgLy8gQ2hlY2tzXG4gICAgICAgIGlmICghdXJpIHx8ICEodXJpIGluc3RhbmNlb2YgU0lQLlVSSSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ21pc3Npbmcgb3IgaW52YWxpZCBcInVyaVwiIHBhcmFtZXRlcicpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEluaXRpYWxpemUgcGFyYW1ldGVyc1xuICAgICAgICB0aGlzLnVyaSA9IHVyaTtcbiAgICAgICAgdGhpcy5wYXJhbWV0ZXJzID0ge307XG4gICAgICAgIGZvciAocGFyYW0gaW4gcGFyYW1ldGVycykge1xuICAgICAgICAgICAgdGhpcy5zZXRQYXJhbShwYXJhbSwgcGFyYW1ldGVyc1twYXJhbV0pO1xuICAgICAgICB9XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMsIHtcbiAgICAgICAgICAgIGZyaWVuZGx5TmFtZToge1xuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5kaXNwbGF5TmFtZSB8fCB1cmkuYW9yOyB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6IHtcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGRpc3BsYXlOYW1lOyB9LFxuICAgICAgICAgICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lID0gKHZhbHVlID09PSAwKSA/ICcwJyA6IHZhbHVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBOYW1lQWRkckhlYWRlci5wcm90b3R5cGUgPSB7XG4gICAgICAgIHNldFBhcmFtOiBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKGtleSkge1xuICAgICAgICAgICAgICAgIHRoaXMucGFyYW1ldGVyc1trZXkudG9Mb3dlckNhc2UoKV0gPSAodHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJyB8fCB2YWx1ZSA9PT0gbnVsbCkgPyBudWxsIDogdmFsdWUudG9TdHJpbmcoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZ2V0UGFyYW06IFNJUC5VUkkucHJvdG90eXBlLmdldFBhcmFtLFxuICAgICAgICBoYXNQYXJhbTogU0lQLlVSSS5wcm90b3R5cGUuaGFzUGFyYW0sXG4gICAgICAgIGRlbGV0ZVBhcmFtOiBTSVAuVVJJLnByb3RvdHlwZS5kZWxldGVQYXJhbSxcbiAgICAgICAgY2xlYXJQYXJhbXM6IFNJUC5VUkkucHJvdG90eXBlLmNsZWFyUGFyYW1zLFxuICAgICAgICBjbG9uZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBOYW1lQWRkckhlYWRlcih0aGlzLnVyaS5jbG9uZSgpLCB0aGlzLmRpc3BsYXlOYW1lLCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMucGFyYW1ldGVycykpKTtcbiAgICAgICAgfSxcbiAgICAgICAgdG9TdHJpbmc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBib2R5LCBwYXJhbWV0ZXI7XG4gICAgICAgICAgICBib2R5ID0gKHRoaXMuZGlzcGxheU5hbWUgfHwgdGhpcy5kaXNwbGF5TmFtZSA9PT0gMCkgPyAnXCInICsgdGhpcy5kaXNwbGF5TmFtZSArICdcIiAnIDogJyc7XG4gICAgICAgICAgICBib2R5ICs9ICc8JyArIHRoaXMudXJpLnRvU3RyaW5nKCkgKyAnPic7XG4gICAgICAgICAgICBmb3IgKHBhcmFtZXRlciBpbiB0aGlzLnBhcmFtZXRlcnMpIHtcbiAgICAgICAgICAgICAgICBib2R5ICs9ICc7JyArIHBhcmFtZXRlcjtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5wYXJhbWV0ZXJzW3BhcmFtZXRlcl0gIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgYm9keSArPSAnPScgKyB0aGlzLnBhcmFtZXRlcnNbcGFyYW1ldGVyXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gYm9keTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgLyoqXG4gICAgICAqIFBhcnNlIHRoZSBnaXZlbiBzdHJpbmcgYW5kIHJldHVybnMgYSBTSVAuTmFtZUFkZHJIZWFkZXIgaW5zdGFuY2Ugb3IgdW5kZWZpbmVkIGlmXG4gICAgICAqIGl0IGlzIGFuIGludmFsaWQgTmFtZUFkZHJIZWFkZXIuXG4gICAgICAqIEBwdWJsaWNcbiAgICAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWVfYWRkcl9oZWFkZXJcbiAgICAgICovXG4gICAgTmFtZUFkZHJIZWFkZXIucGFyc2UgPSBmdW5jdGlvbiAobmFtZV9hZGRyX2hlYWRlcikge1xuICAgICAgICBuYW1lX2FkZHJfaGVhZGVyID0gU0lQLkdyYW1tYXIucGFyc2UobmFtZV9hZGRyX2hlYWRlciwgJ05hbWVfQWRkcl9IZWFkZXInKTtcbiAgICAgICAgaWYgKG5hbWVfYWRkcl9oZWFkZXIgIT09IC0xKSB7XG4gICAgICAgICAgICByZXR1cm4gbmFtZV9hZGRyX2hlYWRlcjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFNJUC5OYW1lQWRkckhlYWRlciA9IE5hbWVBZGRySGVhZGVyO1xufTtcblxuXG4vKioqLyB9KSxcbi8qIDE1ICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblwidXNlIHN0cmljdFwiO1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgU0lQIFRyYW5zYWN0aW9uc1xuICovXG4vKipcbiAqIFNJUCBUcmFuc2FjdGlvbnMgbW9kdWxlLlxuICogQGF1Z21lbnRzIFNJUFxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChTSVApIHtcbiAgICB2YXIgQyA9IHtcbiAgICAgICAgLy8gVHJhbnNhY3Rpb24gc3RhdGVzXG4gICAgICAgIFNUQVRVU19UUllJTkc6IDEsXG4gICAgICAgIFNUQVRVU19QUk9DRUVESU5HOiAyLFxuICAgICAgICBTVEFUVVNfQ0FMTElORzogMyxcbiAgICAgICAgU1RBVFVTX0FDQ0VQVEVEOiA0LFxuICAgICAgICBTVEFUVVNfQ09NUExFVEVEOiA1LFxuICAgICAgICBTVEFUVVNfVEVSTUlOQVRFRDogNixcbiAgICAgICAgU1RBVFVTX0NPTkZJUk1FRDogNyxcbiAgICAgICAgLy8gVHJhbnNhY3Rpb24gdHlwZXNcbiAgICAgICAgTk9OX0lOVklURV9DTElFTlQ6ICduaWN0JyxcbiAgICAgICAgTk9OX0lOVklURV9TRVJWRVI6ICduaXN0JyxcbiAgICAgICAgSU5WSVRFX0NMSUVOVDogJ2ljdCcsXG4gICAgICAgIElOVklURV9TRVJWRVI6ICdpc3QnXG4gICAgfTtcbiAgICBmdW5jdGlvbiBidWlsZFZpYUhlYWRlcihyZXF1ZXN0X3NlbmRlciwgdHJhbnNwb3J0LCBpZCkge1xuICAgICAgICB2YXIgdmlhO1xuICAgICAgICB2aWEgPSAnU0lQLzIuMC8nICsgKHJlcXVlc3Rfc2VuZGVyLnVhLmNvbmZpZ3VyYXRpb24uaGFja1ZpYVRjcCA/ICdUQ1AnIDogdHJhbnNwb3J0LnNlcnZlci5zY2hlbWUpO1xuICAgICAgICB2aWEgKz0gJyAnICsgcmVxdWVzdF9zZW5kZXIudWEuY29uZmlndXJhdGlvbi52aWFIb3N0ICsgJzticmFuY2g9JyArIGlkO1xuICAgICAgICBpZiAocmVxdWVzdF9zZW5kZXIudWEuY29uZmlndXJhdGlvbi5mb3JjZVJwb3J0KSB7XG4gICAgICAgICAgICB2aWEgKz0gJztycG9ydCc7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZpYTtcbiAgICB9XG4gICAgLyoqXG4gICAgKiBAYXVnbWVudHMgU0lQLlRyYW5zYWN0aW9uc1xuICAgICogQGNsYXNzIE5vbiBJbnZpdGUgQ2xpZW50IFRyYW5zYWN0aW9uXG4gICAgKiBAcGFyYW0ge1NJUC5SZXF1ZXN0U2VuZGVyfSByZXF1ZXN0X3NlbmRlclxuICAgICogQHBhcmFtIHtTSVAuT3V0Z29pbmdSZXF1ZXN0fSByZXF1ZXN0XG4gICAgKiBAcGFyYW0ge1NJUC5UcmFuc3BvcnR9IHRyYW5zcG9ydFxuICAgICovXG4gICAgdmFyIE5vbkludml0ZUNsaWVudFRyYW5zYWN0aW9uID0gZnVuY3Rpb24gKHJlcXVlc3Rfc2VuZGVyLCByZXF1ZXN0LCB0cmFuc3BvcnQpIHtcbiAgICAgICAgdmFyIHZpYTtcbiAgICAgICAgdGhpcy50eXBlID0gQy5OT05fSU5WSVRFX0NMSUVOVDtcbiAgICAgICAgdGhpcy50cmFuc3BvcnQgPSB0cmFuc3BvcnQ7XG4gICAgICAgIHRoaXMuaWQgPSAnejloRzRiSycgKyBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwMDAwMCk7XG4gICAgICAgIHRoaXMucmVxdWVzdF9zZW5kZXIgPSByZXF1ZXN0X3NlbmRlcjtcbiAgICAgICAgdGhpcy5yZXF1ZXN0ID0gcmVxdWVzdDtcbiAgICAgICAgdGhpcy5sb2dnZXIgPSByZXF1ZXN0X3NlbmRlci51YS5nZXRMb2dnZXIoJ3NpcC50cmFuc2FjdGlvbi5uaWN0JywgdGhpcy5pZCk7XG4gICAgICAgIHZpYSA9IGJ1aWxkVmlhSGVhZGVyKHJlcXVlc3Rfc2VuZGVyLCB0cmFuc3BvcnQsIHRoaXMuaWQpO1xuICAgICAgICB0aGlzLnJlcXVlc3Quc2V0SGVhZGVyKCd2aWEnLCB2aWEpO1xuICAgICAgICB0aGlzLnJlcXVlc3Rfc2VuZGVyLnVhLm5ld1RyYW5zYWN0aW9uKHRoaXMpO1xuICAgIH07XG4gICAgTm9uSW52aXRlQ2xpZW50VHJhbnNhY3Rpb24ucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShTSVAuRXZlbnRFbWl0dGVyLnByb3RvdHlwZSk7XG4gICAgTm9uSW52aXRlQ2xpZW50VHJhbnNhY3Rpb24ucHJvdG90eXBlLnN0YXRlQ2hhbmdlZCA9IGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICB0aGlzLnN0YXRlID0gc3RhdGU7XG4gICAgICAgIHRoaXMuZW1pdCgnc3RhdGVDaGFuZ2VkJyk7XG4gICAgfTtcbiAgICBOb25JbnZpdGVDbGllbnRUcmFuc2FjdGlvbi5wcm90b3R5cGUuc2VuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyID0gdGhpcztcbiAgICAgICAgdGhpcy5zdGF0ZUNoYW5nZWQoQy5TVEFUVVNfVFJZSU5HKTtcbiAgICAgICAgdGhpcy5GID0gU0lQLlRpbWVycy5zZXRUaW1lb3V0KHRyLnRpbWVyX0YuYmluZCh0ciksIFNJUC5UaW1lcnMuVElNRVJfRik7XG4gICAgICAgIHRoaXMudHJhbnNwb3J0LnNlbmQodGhpcy5yZXF1ZXN0KS5jYXRjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLm9uVHJhbnNwb3J0RXJyb3IoKTtcbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9O1xuICAgIE5vbkludml0ZUNsaWVudFRyYW5zYWN0aW9uLnByb3RvdHlwZS5vblRyYW5zcG9ydEVycm9yID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ3RyYW5zcG9ydCBlcnJvciBvY2N1cnJlZCwgZGVsZXRpbmcgbm9uLUlOVklURSBjbGllbnQgdHJhbnNhY3Rpb24gJyArIHRoaXMuaWQpO1xuICAgICAgICBTSVAuVGltZXJzLmNsZWFyVGltZW91dCh0aGlzLkYpO1xuICAgICAgICBTSVAuVGltZXJzLmNsZWFyVGltZW91dCh0aGlzLkspO1xuICAgICAgICB0aGlzLnN0YXRlQ2hhbmdlZChDLlNUQVRVU19URVJNSU5BVEVEKTtcbiAgICAgICAgdGhpcy5yZXF1ZXN0X3NlbmRlci51YS5kZXN0cm95VHJhbnNhY3Rpb24odGhpcyk7XG4gICAgICAgIHRoaXMucmVxdWVzdF9zZW5kZXIub25UcmFuc3BvcnRFcnJvcigpO1xuICAgIH07XG4gICAgTm9uSW52aXRlQ2xpZW50VHJhbnNhY3Rpb24ucHJvdG90eXBlLnRpbWVyX0YgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyLmRlYnVnKCdUaW1lciBGIGV4cGlyZWQgZm9yIG5vbi1JTlZJVEUgY2xpZW50IHRyYW5zYWN0aW9uICcgKyB0aGlzLmlkKTtcbiAgICAgICAgdGhpcy5zdGF0ZUNoYW5nZWQoQy5TVEFUVVNfVEVSTUlOQVRFRCk7XG4gICAgICAgIHRoaXMucmVxdWVzdF9zZW5kZXIudWEuZGVzdHJveVRyYW5zYWN0aW9uKHRoaXMpO1xuICAgICAgICB0aGlzLnJlcXVlc3Rfc2VuZGVyLm9uUmVxdWVzdFRpbWVvdXQoKTtcbiAgICB9O1xuICAgIE5vbkludml0ZUNsaWVudFRyYW5zYWN0aW9uLnByb3RvdHlwZS50aW1lcl9LID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnN0YXRlQ2hhbmdlZChDLlNUQVRVU19URVJNSU5BVEVEKTtcbiAgICAgICAgdGhpcy5yZXF1ZXN0X3NlbmRlci51YS5kZXN0cm95VHJhbnNhY3Rpb24odGhpcyk7XG4gICAgfTtcbiAgICBOb25JbnZpdGVDbGllbnRUcmFuc2FjdGlvbi5wcm90b3R5cGUucmVjZWl2ZVJlc3BvbnNlID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgIHZhciB0ciA9IHRoaXMsIHN0YXR1c19jb2RlID0gcmVzcG9uc2Uuc3RhdHVzX2NvZGU7XG4gICAgICAgIGlmIChzdGF0dXNfY29kZSA8IDIwMCkge1xuICAgICAgICAgICAgc3dpdGNoICh0aGlzLnN0YXRlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBDLlNUQVRVU19UUllJTkc6XG4gICAgICAgICAgICAgICAgY2FzZSBDLlNUQVRVU19QUk9DRUVESU5HOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlQ2hhbmdlZChDLlNUQVRVU19QUk9DRUVESU5HKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0X3NlbmRlci5yZWNlaXZlUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5zdGF0ZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgQy5TVEFUVVNfVFJZSU5HOlxuICAgICAgICAgICAgICAgIGNhc2UgQy5TVEFUVVNfUFJPQ0VFRElORzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZUNoYW5nZWQoQy5TVEFUVVNfQ09NUExFVEVEKTtcbiAgICAgICAgICAgICAgICAgICAgU0lQLlRpbWVycy5jbGVhclRpbWVvdXQodGhpcy5GKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXR1c19jb2RlID09PSA0MDgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdF9zZW5kZXIub25SZXF1ZXN0VGltZW91dCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0X3NlbmRlci5yZWNlaXZlUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuSyA9IFNJUC5UaW1lcnMuc2V0VGltZW91dCh0ci50aW1lcl9LLmJpbmQodHIpLCBTSVAuVGltZXJzLlRJTUVSX0spO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIEMuU1RBVFVTX0NPTVBMRVRFRDpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuICAgIC8qKlxuICAgICogQGF1Z21lbnRzIFNJUC5UcmFuc2FjdGlvbnNcbiAgICAqIEBjbGFzcyBJbnZpdGUgQ2xpZW50IFRyYW5zYWN0aW9uXG4gICAgKiBAcGFyYW0ge1NJUC5SZXF1ZXN0U2VuZGVyfSByZXF1ZXN0X3NlbmRlclxuICAgICogQHBhcmFtIHtTSVAuT3V0Z29pbmdSZXF1ZXN0fSByZXF1ZXN0XG4gICAgKiBAcGFyYW0ge1NJUC5UcmFuc3BvcnR9IHRyYW5zcG9ydFxuICAgICovXG4gICAgdmFyIEludml0ZUNsaWVudFRyYW5zYWN0aW9uID0gZnVuY3Rpb24gKHJlcXVlc3Rfc2VuZGVyLCByZXF1ZXN0LCB0cmFuc3BvcnQpIHtcbiAgICAgICAgdmFyIHZpYSwgdHIgPSB0aGlzO1xuICAgICAgICB0aGlzLnR5cGUgPSBDLklOVklURV9DTElFTlQ7XG4gICAgICAgIHRoaXMudHJhbnNwb3J0ID0gdHJhbnNwb3J0O1xuICAgICAgICB0aGlzLmlkID0gJ3o5aEc0YksnICsgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMDAwMDApO1xuICAgICAgICB0aGlzLnJlcXVlc3Rfc2VuZGVyID0gcmVxdWVzdF9zZW5kZXI7XG4gICAgICAgIHRoaXMucmVxdWVzdCA9IHJlcXVlc3Q7XG4gICAgICAgIHRoaXMubG9nZ2VyID0gcmVxdWVzdF9zZW5kZXIudWEuZ2V0TG9nZ2VyKCdzaXAudHJhbnNhY3Rpb24uaWN0JywgdGhpcy5pZCk7XG4gICAgICAgIHZpYSA9IGJ1aWxkVmlhSGVhZGVyKHJlcXVlc3Rfc2VuZGVyLCB0cmFuc3BvcnQsIHRoaXMuaWQpO1xuICAgICAgICB0aGlzLnJlcXVlc3Quc2V0SGVhZGVyKCd2aWEnLCB2aWEpO1xuICAgICAgICB0aGlzLnJlcXVlc3Rfc2VuZGVyLnVhLm5ld1RyYW5zYWN0aW9uKHRoaXMpO1xuICAgICAgICAvLyBBZGQgdGhlIGNhbmNlbCBwcm9wZXJ0eSB0byB0aGUgcmVxdWVzdC5cbiAgICAgICAgLy9XaWxsIGJlIGNhbGxlZCBmcm9tIHRoZSByZXF1ZXN0IGluc3RhbmNlLCBub3QgdGhlIHRyYW5zYWN0aW9uIGl0c2VsZi5cbiAgICAgICAgdGhpcy5yZXF1ZXN0LmNhbmNlbCA9IGZ1bmN0aW9uIChyZWFzb24sIGV4dHJhSGVhZGVycykge1xuICAgICAgICAgICAgZXh0cmFIZWFkZXJzID0gKGV4dHJhSGVhZGVycyB8fCBbXSkuc2xpY2UoKTtcbiAgICAgICAgICAgIHZhciBsZW5ndGggPSBleHRyYUhlYWRlcnMubGVuZ3RoO1xuICAgICAgICAgICAgdmFyIGV4dHJhSGVhZGVyc1N0cmluZyA9IG51bGw7XG4gICAgICAgICAgICBmb3IgKHZhciBpZHggPSAwOyBpZHggPCBsZW5ndGg7IGlkeCsrKSB7XG4gICAgICAgICAgICAgICAgZXh0cmFIZWFkZXJzU3RyaW5nID0gKGV4dHJhSGVhZGVyc1N0cmluZyB8fCAnJykgKyBleHRyYUhlYWRlcnNbaWR4XS50cmltKCkgKyAnXFxyXFxuJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRyLmNhbmNlbF9yZXF1ZXN0KHRyLCByZWFzb24sIGV4dHJhSGVhZGVyc1N0cmluZyk7XG4gICAgICAgIH07XG4gICAgfTtcbiAgICBJbnZpdGVDbGllbnRUcmFuc2FjdGlvbi5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFNJUC5FdmVudEVtaXR0ZXIucHJvdG90eXBlKTtcbiAgICBJbnZpdGVDbGllbnRUcmFuc2FjdGlvbi5wcm90b3R5cGUuc3RhdGVDaGFuZ2VkID0gZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgIHRoaXMuc3RhdGUgPSBzdGF0ZTtcbiAgICAgICAgdGhpcy5lbWl0KCdzdGF0ZUNoYW5nZWQnKTtcbiAgICB9O1xuICAgIEludml0ZUNsaWVudFRyYW5zYWN0aW9uLnByb3RvdHlwZS5zZW5kID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHIgPSB0aGlzO1xuICAgICAgICB0aGlzLnN0YXRlQ2hhbmdlZChDLlNUQVRVU19DQUxMSU5HKTtcbiAgICAgICAgdGhpcy5CID0gU0lQLlRpbWVycy5zZXRUaW1lb3V0KHRyLnRpbWVyX0IuYmluZCh0ciksIFNJUC5UaW1lcnMuVElNRVJfQik7XG4gICAgICAgIHRoaXMudHJhbnNwb3J0LnNlbmQodGhpcy5yZXF1ZXN0KS5jYXRjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLm9uVHJhbnNwb3J0RXJyb3IoKTtcbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9O1xuICAgIEludml0ZUNsaWVudFRyYW5zYWN0aW9uLnByb3RvdHlwZS5vblRyYW5zcG9ydEVycm9yID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ3RyYW5zcG9ydCBlcnJvciBvY2N1cnJlZCwgZGVsZXRpbmcgSU5WSVRFIGNsaWVudCB0cmFuc2FjdGlvbiAnICsgdGhpcy5pZCk7XG4gICAgICAgIFNJUC5UaW1lcnMuY2xlYXJUaW1lb3V0KHRoaXMuQik7XG4gICAgICAgIFNJUC5UaW1lcnMuY2xlYXJUaW1lb3V0KHRoaXMuRCk7XG4gICAgICAgIFNJUC5UaW1lcnMuY2xlYXJUaW1lb3V0KHRoaXMuTSk7XG4gICAgICAgIHRoaXMuc3RhdGVDaGFuZ2VkKEMuU1RBVFVTX1RFUk1JTkFURUQpO1xuICAgICAgICB0aGlzLnJlcXVlc3Rfc2VuZGVyLnVhLmRlc3Ryb3lUcmFuc2FjdGlvbih0aGlzKTtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUgIT09IEMuU1RBVFVTX0FDQ0VQVEVEKSB7XG4gICAgICAgICAgICB0aGlzLnJlcXVlc3Rfc2VuZGVyLm9uVHJhbnNwb3J0RXJyb3IoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgLy8gUkZDIDYwMjYgNy4yXG4gICAgSW52aXRlQ2xpZW50VHJhbnNhY3Rpb24ucHJvdG90eXBlLnRpbWVyX00gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyLmRlYnVnKCdUaW1lciBNIGV4cGlyZWQgZm9yIElOVklURSBjbGllbnQgdHJhbnNhY3Rpb24gJyArIHRoaXMuaWQpO1xuICAgICAgICBpZiAodGhpcy5zdGF0ZSA9PT0gQy5TVEFUVVNfQUNDRVBURUQpIHtcbiAgICAgICAgICAgIFNJUC5UaW1lcnMuY2xlYXJUaW1lb3V0KHRoaXMuQik7XG4gICAgICAgICAgICB0aGlzLnN0YXRlQ2hhbmdlZChDLlNUQVRVU19URVJNSU5BVEVEKTtcbiAgICAgICAgICAgIHRoaXMucmVxdWVzdF9zZW5kZXIudWEuZGVzdHJveVRyYW5zYWN0aW9uKHRoaXMpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICAvLyBSRkMgMzI2MSAxNy4xLjFcbiAgICBJbnZpdGVDbGllbnRUcmFuc2FjdGlvbi5wcm90b3R5cGUudGltZXJfQiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5sb2dnZXIuZGVidWcoJ1RpbWVyIEIgZXhwaXJlZCBmb3IgSU5WSVRFIGNsaWVudCB0cmFuc2FjdGlvbiAnICsgdGhpcy5pZCk7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlID09PSBDLlNUQVRVU19DQUxMSU5HKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlQ2hhbmdlZChDLlNUQVRVU19URVJNSU5BVEVEKTtcbiAgICAgICAgICAgIHRoaXMucmVxdWVzdF9zZW5kZXIudWEuZGVzdHJveVRyYW5zYWN0aW9uKHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5yZXF1ZXN0X3NlbmRlci5vblJlcXVlc3RUaW1lb3V0KCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEludml0ZUNsaWVudFRyYW5zYWN0aW9uLnByb3RvdHlwZS50aW1lcl9EID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmxvZ2dlci5kZWJ1ZygnVGltZXIgRCBleHBpcmVkIGZvciBJTlZJVEUgY2xpZW50IHRyYW5zYWN0aW9uICcgKyB0aGlzLmlkKTtcbiAgICAgICAgU0lQLlRpbWVycy5jbGVhclRpbWVvdXQodGhpcy5CKTtcbiAgICAgICAgdGhpcy5zdGF0ZUNoYW5nZWQoQy5TVEFUVVNfVEVSTUlOQVRFRCk7XG4gICAgICAgIHRoaXMucmVxdWVzdF9zZW5kZXIudWEuZGVzdHJveVRyYW5zYWN0aW9uKHRoaXMpO1xuICAgIH07XG4gICAgSW52aXRlQ2xpZW50VHJhbnNhY3Rpb24ucHJvdG90eXBlLnNlbmRBQ0sgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICAvLyBUT0RPOiBNb3ZlIFBSQUNLIHN0dWZmIGludG8gdGhlIHRyYW5zYWN0aW9uIGxheWVyLiBUaGF0IGlzIHJlYWxseSB3aGVyZSBpdCBzaG91bGQgYmVcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzLCBydXJpO1xuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAgICAgaWYgKHRoaXMucmVzcG9uc2UuZ2V0SGVhZGVyKCdjb250YWN0JykpIHtcbiAgICAgICAgICAgIHJ1cmkgPSB0aGlzLnJlc3BvbnNlLnBhcnNlSGVhZGVyKCdjb250YWN0JykudXJpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcnVyaSA9IHRoaXMucmVxdWVzdC5ydXJpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBhY2sgPSBuZXcgU0lQLk91dGdvaW5nUmVxdWVzdChcIkFDS1wiLCBydXJpLCB0aGlzLnJlcXVlc3QudWEsIHtcbiAgICAgICAgICAgIGNzZXE6IHRoaXMucmVzcG9uc2UuY3NlcSxcbiAgICAgICAgICAgIGNhbGxfaWQ6IHRoaXMucmVzcG9uc2UuY2FsbF9pZCxcbiAgICAgICAgICAgIGZyb21fdXJpOiB0aGlzLnJlc3BvbnNlLmZyb20udXJpLFxuICAgICAgICAgICAgZnJvbV90YWc6IHRoaXMucmVzcG9uc2UuZnJvbV90YWcsXG4gICAgICAgICAgICB0b191cmk6IHRoaXMucmVzcG9uc2UudG8udXJpLFxuICAgICAgICAgICAgdG9fdGFnOiB0aGlzLnJlc3BvbnNlLnRvX3RhZyxcbiAgICAgICAgICAgIHJvdXRlX3NldDogdGhpcy5yZXNwb25zZS5nZXRIZWFkZXJzKCdyZWNvcmQtcm91dGUnKS5yZXZlcnNlKClcbiAgICAgICAgfSwgb3B0aW9ucy5leHRyYUhlYWRlcnMgfHwgW10sIG9wdGlvbnMuYm9keSk7XG4gICAgICAgIHRoaXMuYWNrU2VuZGVyID0gbmV3IFNJUC5SZXF1ZXN0U2VuZGVyKHtcbiAgICAgICAgICAgIHJlcXVlc3Q6IGFjayxcbiAgICAgICAgICAgIG9uUmVxdWVzdFRpbWVvdXQ6IHRoaXMucmVxdWVzdF9zZW5kZXIuYXBwbGljYW50LmFwcGxpY2FudCA/IHRoaXMucmVxdWVzdF9zZW5kZXIuYXBwbGljYW50LmFwcGxpY2FudC5vblJlcXVlc3RUaW1lb3V0IDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm4oXCJBQ0sgUmVxdWVzdCB0aW1lZCBvdXRcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25UcmFuc3BvcnRFcnJvcjogdGhpcy5yZXF1ZXN0X3NlbmRlci5hcHBsaWNhbnQuYXBwbGljYW50ID8gdGhpcy5yZXF1ZXN0X3NlbmRlci5hcHBsaWNhbnQuYXBwbGljYW50Lm9uUmVxdWVzdFRyYW5zcG9ydEVycm9yIDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm4oXCJBQ0sgUmVxdWVzdCBoYWQgYSB0cmFuc3BvcnQgZXJyb3JcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVjZWl2ZVJlc3BvbnNlOiBvcHRpb25zLnJlY2VpdmVSZXNwb25zZSB8fCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybihcIlJlY2VpdmVkIGEgcmVzcG9uc2UgdG8gYW4gQUNLIHdoaWNoIHdhcyB1bmV4cGVjdGVkLiBEcm9wcGluZyBSZXNwb25zZS5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHRoaXMucmVxdWVzdC51YSkuc2VuZCgpO1xuICAgICAgICByZXR1cm4gYWNrO1xuICAgIH07XG4gICAgSW52aXRlQ2xpZW50VHJhbnNhY3Rpb24ucHJvdG90eXBlLmNhbmNlbF9yZXF1ZXN0ID0gZnVuY3Rpb24gKHRyLCByZWFzb24sIGV4dHJhSGVhZGVycykge1xuICAgICAgICB2YXIgcmVxdWVzdCA9IHRyLnJlcXVlc3Q7XG4gICAgICAgIHRoaXMuY2FuY2VsID0gU0lQLkMuQ0FOQ0VMICsgJyAnICsgcmVxdWVzdC5ydXJpICsgJyBTSVAvMi4wXFxyXFxuJztcbiAgICAgICAgdGhpcy5jYW5jZWwgKz0gJ1ZpYTogJyArIHJlcXVlc3QuaGVhZGVyc1snVmlhJ10udG9TdHJpbmcoKSArICdcXHJcXG4nO1xuICAgICAgICBpZiAodGhpcy5yZXF1ZXN0LmhlYWRlcnNbJ1JvdXRlJ10pIHtcbiAgICAgICAgICAgIHRoaXMuY2FuY2VsICs9ICdSb3V0ZTogJyArIHJlcXVlc3QuaGVhZGVyc1snUm91dGUnXS50b1N0cmluZygpICsgJ1xcclxcbic7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jYW5jZWwgKz0gJ1RvOiAnICsgcmVxdWVzdC5oZWFkZXJzWydUbyddLnRvU3RyaW5nKCkgKyAnXFxyXFxuJztcbiAgICAgICAgdGhpcy5jYW5jZWwgKz0gJ0Zyb206ICcgKyByZXF1ZXN0LmhlYWRlcnNbJ0Zyb20nXS50b1N0cmluZygpICsgJ1xcclxcbic7XG4gICAgICAgIHRoaXMuY2FuY2VsICs9ICdDYWxsLUlEOiAnICsgcmVxdWVzdC5oZWFkZXJzWydDYWxsLUlEJ10udG9TdHJpbmcoKSArICdcXHJcXG4nO1xuICAgICAgICB0aGlzLmNhbmNlbCArPSAnTWF4LUZvcndhcmRzOiAnICsgU0lQLlVBLkMuTUFYX0ZPUldBUkRTICsgJ1xcclxcbic7XG4gICAgICAgIHRoaXMuY2FuY2VsICs9ICdDU2VxOiAnICsgcmVxdWVzdC5oZWFkZXJzWydDU2VxJ10udG9TdHJpbmcoKS5zcGxpdCgnICcpWzBdICtcbiAgICAgICAgICAgICcgQ0FOQ0VMXFxyXFxuJztcbiAgICAgICAgaWYgKHJlYXNvbikge1xuICAgICAgICAgICAgdGhpcy5jYW5jZWwgKz0gJ1JlYXNvbjogJyArIHJlYXNvbiArICdcXHJcXG4nO1xuICAgICAgICB9XG4gICAgICAgIGlmIChleHRyYUhlYWRlcnMpIHtcbiAgICAgICAgICAgIHRoaXMuY2FuY2VsICs9IGV4dHJhSGVhZGVycztcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNhbmNlbCArPSAnQ29udGVudC1MZW5ndGg6IDBcXHJcXG5cXHJcXG4nO1xuICAgICAgICAvLyBTZW5kIG9ubHkgaWYgYSBwcm92aXNpb25hbCByZXNwb25zZSAoPjEwMCkgaGFzIGJlZW4gcmVjZWl2ZWQuXG4gICAgICAgIGlmICh0aGlzLnN0YXRlID09PSBDLlNUQVRVU19QUk9DRUVESU5HKSB7XG4gICAgICAgICAgICB0aGlzLnRyYW5zcG9ydC5zZW5kKHRoaXMuY2FuY2VsKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgSW52aXRlQ2xpZW50VHJhbnNhY3Rpb24ucHJvdG90eXBlLnJlY2VpdmVSZXNwb25zZSA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICB2YXIgdHIgPSB0aGlzLCBzdGF0dXNfY29kZSA9IHJlc3BvbnNlLnN0YXR1c19jb2RlO1xuICAgICAgICAvLyBUaGlzIG1heSBjcmVhdGUgYSBjaXJjdWxhciBkZXBlbmRlbmN5Li4uXG4gICAgICAgIHJlc3BvbnNlLnRyYW5zYWN0aW9uID0gdGhpcztcbiAgICAgICAgaWYgKHRoaXMucmVzcG9uc2UgJiZcbiAgICAgICAgICAgIHRoaXMucmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT09IHJlc3BvbnNlLnN0YXR1c19jb2RlICYmXG4gICAgICAgICAgICB0aGlzLnJlc3BvbnNlLmNzZXEgPT09IHJlc3BvbnNlLmNzZXEpIHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmRlYnVnKFwiSUNUIFJlY2VpdmVkIGEgcmV0cmFuc21pc3Npb24gZm9yIGNzZXE6IFwiICsgcmVzcG9uc2UuY3NlcSk7XG4gICAgICAgICAgICBpZiAodGhpcy5hY2tTZW5kZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFja1NlbmRlci5zZW5kKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZXNwb25zZSA9IHJlc3BvbnNlO1xuICAgICAgICBpZiAoc3RhdHVzX2NvZGUgPj0gMTAwICYmIHN0YXR1c19jb2RlIDw9IDE5OSkge1xuICAgICAgICAgICAgc3dpdGNoICh0aGlzLnN0YXRlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBDLlNUQVRVU19DQUxMSU5HOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlQ2hhbmdlZChDLlNUQVRVU19QUk9DRUVESU5HKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0X3NlbmRlci5yZWNlaXZlUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jYW5jZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0LnNlbmQodGhpcy5jYW5jZWwpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgQy5TVEFUVVNfUFJPQ0VFRElORzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0X3NlbmRlci5yZWNlaXZlUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChzdGF0dXNfY29kZSA+PSAyMDAgJiYgc3RhdHVzX2NvZGUgPD0gMjk5KSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMuc3RhdGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIEMuU1RBVFVTX0NBTExJTkc6XG4gICAgICAgICAgICAgICAgY2FzZSBDLlNUQVRVU19QUk9DRUVESU5HOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlQ2hhbmdlZChDLlNUQVRVU19BQ0NFUFRFRCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuTSA9IFNJUC5UaW1lcnMuc2V0VGltZW91dCh0ci50aW1lcl9NLmJpbmQodHIpLCBTSVAuVGltZXJzLlRJTUVSX00pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlcXVlc3Rfc2VuZGVyLnJlY2VpdmVSZXNwb25zZShyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgQy5TVEFUVVNfQUNDRVBURUQ6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdF9zZW5kZXIucmVjZWl2ZVJlc3BvbnNlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoc3RhdHVzX2NvZGUgPj0gMzAwICYmIHN0YXR1c19jb2RlIDw9IDY5OSkge1xuICAgICAgICAgICAgc3dpdGNoICh0aGlzLnN0YXRlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBDLlNUQVRVU19DQUxMSU5HOlxuICAgICAgICAgICAgICAgIGNhc2UgQy5TVEFUVVNfUFJPQ0VFRElORzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZUNoYW5nZWQoQy5TVEFUVVNfQ09NUExFVEVEKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZW5kQUNLKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdF9zZW5kZXIucmVjZWl2ZVJlc3BvbnNlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBDLlNUQVRVU19DT01QTEVURUQ6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VuZEFDSygpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgLyoqXG4gICAgICogQGF1Z21lbnRzIFNJUC5UcmFuc2FjdGlvbnNcbiAgICAgKiBAY2xhc3MgQUNLIENsaWVudCBUcmFuc2FjdGlvblxuICAgICAqIEBwYXJhbSB7U0lQLlJlcXVlc3RTZW5kZXJ9IHJlcXVlc3Rfc2VuZGVyXG4gICAgICogQHBhcmFtIHtTSVAuT3V0Z29pbmdSZXF1ZXN0fSByZXF1ZXN0XG4gICAgICogQHBhcmFtIHtTSVAuVHJhbnNwb3J0fSB0cmFuc3BvcnRcbiAgICAgKi9cbiAgICB2YXIgQWNrQ2xpZW50VHJhbnNhY3Rpb24gPSBmdW5jdGlvbiAocmVxdWVzdF9zZW5kZXIsIHJlcXVlc3QsIHRyYW5zcG9ydCkge1xuICAgICAgICB2YXIgdmlhO1xuICAgICAgICB0aGlzLnRyYW5zcG9ydCA9IHRyYW5zcG9ydDtcbiAgICAgICAgdGhpcy5pZCA9ICd6OWhHNGJLJyArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDAwMDAwKTtcbiAgICAgICAgdGhpcy5yZXF1ZXN0X3NlbmRlciA9IHJlcXVlc3Rfc2VuZGVyO1xuICAgICAgICB0aGlzLnJlcXVlc3QgPSByZXF1ZXN0O1xuICAgICAgICB0aGlzLmxvZ2dlciA9IHJlcXVlc3Rfc2VuZGVyLnVhLmdldExvZ2dlcignc2lwLnRyYW5zYWN0aW9uLm5pY3QnLCB0aGlzLmlkKTtcbiAgICAgICAgdmlhID0gYnVpbGRWaWFIZWFkZXIocmVxdWVzdF9zZW5kZXIsIHRyYW5zcG9ydCwgdGhpcy5pZCk7XG4gICAgICAgIHRoaXMucmVxdWVzdC5zZXRIZWFkZXIoJ3ZpYScsIHZpYSk7XG4gICAgfTtcbiAgICBBY2tDbGllbnRUcmFuc2FjdGlvbi5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFNJUC5FdmVudEVtaXR0ZXIucHJvdG90eXBlKTtcbiAgICBBY2tDbGllbnRUcmFuc2FjdGlvbi5wcm90b3R5cGUuc2VuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy50cmFuc3BvcnQuc2VuZCh0aGlzLnJlcXVlc3QpLmNhdGNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMub25UcmFuc3BvcnRFcnJvcigpO1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH07XG4gICAgQWNrQ2xpZW50VHJhbnNhY3Rpb24ucHJvdG90eXBlLm9uVHJhbnNwb3J0RXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyLmxvZygndHJhbnNwb3J0IGVycm9yIG9jY3VycmVkLCBmb3IgYW4gQUNLIGNsaWVudCB0cmFuc2FjdGlvbiAnICsgdGhpcy5pZCk7XG4gICAgICAgIHRoaXMucmVxdWVzdF9zZW5kZXIub25UcmFuc3BvcnRFcnJvcigpO1xuICAgIH07XG4gICAgLyoqXG4gICAgKiBAYXVnbWVudHMgU0lQLlRyYW5zYWN0aW9uc1xuICAgICogQGNsYXNzIE5vbiBJbnZpdGUgU2VydmVyIFRyYW5zYWN0aW9uXG4gICAgKiBAcGFyYW0ge1NJUC5JbmNvbWluZ1JlcXVlc3R9IHJlcXVlc3RcbiAgICAqIEBwYXJhbSB7U0lQLlVBfSB1YVxuICAgICovXG4gICAgdmFyIE5vbkludml0ZVNlcnZlclRyYW5zYWN0aW9uID0gZnVuY3Rpb24gKHJlcXVlc3QsIHVhKSB7XG4gICAgICAgIHRoaXMudHlwZSA9IEMuTk9OX0lOVklURV9TRVJWRVI7XG4gICAgICAgIHRoaXMuaWQgPSByZXF1ZXN0LnZpYV9icmFuY2g7XG4gICAgICAgIHRoaXMucmVxdWVzdCA9IHJlcXVlc3Q7XG4gICAgICAgIHRoaXMudHJhbnNwb3J0ID0gdWEudHJhbnNwb3J0O1xuICAgICAgICB0aGlzLnVhID0gdWE7XG4gICAgICAgIHRoaXMubGFzdF9yZXNwb25zZSA9ICcnO1xuICAgICAgICByZXF1ZXN0LnNlcnZlcl90cmFuc2FjdGlvbiA9IHRoaXM7XG4gICAgICAgIHRoaXMubG9nZ2VyID0gdWEuZ2V0TG9nZ2VyKCdzaXAudHJhbnNhY3Rpb24ubmlzdCcsIHRoaXMuaWQpO1xuICAgICAgICB0aGlzLnN0YXRlID0gQy5TVEFUVVNfVFJZSU5HO1xuICAgICAgICB1YS5uZXdUcmFuc2FjdGlvbih0aGlzKTtcbiAgICB9O1xuICAgIE5vbkludml0ZVNlcnZlclRyYW5zYWN0aW9uLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoU0lQLkV2ZW50RW1pdHRlci5wcm90b3R5cGUpO1xuICAgIE5vbkludml0ZVNlcnZlclRyYW5zYWN0aW9uLnByb3RvdHlwZS5zdGF0ZUNoYW5nZWQgPSBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHN0YXRlO1xuICAgICAgICB0aGlzLmVtaXQoJ3N0YXRlQ2hhbmdlZCcpO1xuICAgIH07XG4gICAgTm9uSW52aXRlU2VydmVyVHJhbnNhY3Rpb24ucHJvdG90eXBlLnRpbWVyX0ogPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyLmRlYnVnKCdUaW1lciBKIGV4cGlyZWQgZm9yIG5vbi1JTlZJVEUgc2VydmVyIHRyYW5zYWN0aW9uICcgKyB0aGlzLmlkKTtcbiAgICAgICAgdGhpcy5zdGF0ZUNoYW5nZWQoQy5TVEFUVVNfVEVSTUlOQVRFRCk7XG4gICAgICAgIHRoaXMudWEuZGVzdHJveVRyYW5zYWN0aW9uKHRoaXMpO1xuICAgIH07XG4gICAgTm9uSW52aXRlU2VydmVyVHJhbnNhY3Rpb24ucHJvdG90eXBlLm9uVHJhbnNwb3J0RXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy50cmFuc3BvcnRFcnJvcikge1xuICAgICAgICAgICAgdGhpcy50cmFuc3BvcnRFcnJvciA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ3RyYW5zcG9ydCBlcnJvciBvY2N1cnJlZCwgZGVsZXRpbmcgbm9uLUlOVklURSBzZXJ2ZXIgdHJhbnNhY3Rpb24gJyArIHRoaXMuaWQpO1xuICAgICAgICAgICAgU0lQLlRpbWVycy5jbGVhclRpbWVvdXQodGhpcy5KKTtcbiAgICAgICAgICAgIHRoaXMuc3RhdGVDaGFuZ2VkKEMuU1RBVFVTX1RFUk1JTkFURUQpO1xuICAgICAgICAgICAgdGhpcy51YS5kZXN0cm95VHJhbnNhY3Rpb24odGhpcyk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIE5vbkludml0ZVNlcnZlclRyYW5zYWN0aW9uLnByb3RvdHlwZS5yZWNlaXZlUmVzcG9uc2UgPSBmdW5jdGlvbiAoc3RhdHVzX2NvZGUsIHJlc3BvbnNlKSB7XG4gICAgICAgIHZhciB0ciA9IHRoaXM7XG4gICAgICAgIHZhciBkZWZlcnJlZCA9IFNJUC5VdGlscy5kZWZlcigpO1xuICAgICAgICBpZiAoc3RhdHVzX2NvZGUgPT09IDEwMCkge1xuICAgICAgICAgICAgLyogUkZDIDQzMjAgNC4xXG4gICAgICAgICAgICAgKiAnQSBTSVAgZWxlbWVudCBNVVNUIE5PVFxuICAgICAgICAgICAgICogc2VuZCBhbnkgcHJvdmlzaW9uYWwgcmVzcG9uc2Ugd2l0aCBhXG4gICAgICAgICAgICAgKiBTdGF0dXMtQ29kZSBvdGhlciB0aGFuIDEwMCB0byBhIG5vbi1JTlZJVEUgcmVxdWVzdC4nXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5zdGF0ZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgQy5TVEFUVVNfVFJZSU5HOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlQ2hhbmdlZChDLlNUQVRVU19QUk9DRUVESU5HKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQuc2VuZChyZXNwb25zZSkuY2F0Y2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vblRyYW5zcG9ydEVycm9yKCk7XG4gICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgQy5TVEFUVVNfUFJPQ0VFRElORzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYXN0X3Jlc3BvbnNlID0gcmVzcG9uc2U7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0LnNlbmQocmVzcG9uc2UpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9uVHJhbnNwb3J0RXJyb3IoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdCgpO1xuICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChzdGF0dXNfY29kZSA+PSAyMDAgJiYgc3RhdHVzX2NvZGUgPD0gNjk5KSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMuc3RhdGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIEMuU1RBVFVTX1RSWUlORzpcbiAgICAgICAgICAgICAgICBjYXNlIEMuU1RBVFVTX1BST0NFRURJTkc6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdGVDaGFuZ2VkKEMuU1RBVFVTX0NPTVBMRVRFRCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGFzdF9yZXNwb25zZSA9IHJlc3BvbnNlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLkogPSBTSVAuVGltZXJzLnNldFRpbWVvdXQodHIudGltZXJfSi5iaW5kKHRyKSwgU0lQLlRpbWVycy5USU1FUl9KKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQuc2VuZChyZXNwb25zZSkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25UcmFuc3BvcnRFcnJvcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KCk7XG4gICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgQy5TVEFUVVNfQ09NUExFVEVEOlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9O1xuICAgIC8qKlxuICAgICogQGF1Z21lbnRzIFNJUC5UcmFuc2FjdGlvbnNcbiAgICAqIEBjbGFzcyBJbnZpdGUgU2VydmVyIFRyYW5zYWN0aW9uXG4gICAgKiBAcGFyYW0ge1NJUC5JbmNvbWluZ1JlcXVlc3R9IHJlcXVlc3RcbiAgICAqIEBwYXJhbSB7U0lQLlVBfSB1YVxuICAgICovXG4gICAgdmFyIEludml0ZVNlcnZlclRyYW5zYWN0aW9uID0gZnVuY3Rpb24gKHJlcXVlc3QsIHVhKSB7XG4gICAgICAgIHRoaXMudHlwZSA9IEMuSU5WSVRFX1NFUlZFUjtcbiAgICAgICAgdGhpcy5pZCA9IHJlcXVlc3QudmlhX2JyYW5jaDtcbiAgICAgICAgdGhpcy5yZXF1ZXN0ID0gcmVxdWVzdDtcbiAgICAgICAgdGhpcy50cmFuc3BvcnQgPSB1YS50cmFuc3BvcnQ7XG4gICAgICAgIHRoaXMudWEgPSB1YTtcbiAgICAgICAgdGhpcy5sYXN0X3Jlc3BvbnNlID0gJyc7XG4gICAgICAgIHJlcXVlc3Quc2VydmVyX3RyYW5zYWN0aW9uID0gdGhpcztcbiAgICAgICAgdGhpcy5sb2dnZXIgPSB1YS5nZXRMb2dnZXIoJ3NpcC50cmFuc2FjdGlvbi5pc3QnLCB0aGlzLmlkKTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IEMuU1RBVFVTX1BST0NFRURJTkc7XG4gICAgICAgIHVhLm5ld1RyYW5zYWN0aW9uKHRoaXMpO1xuICAgICAgICB0aGlzLnJlc2VuZFByb3Zpc2lvbmFsVGltZXIgPSBudWxsO1xuICAgICAgICByZXF1ZXN0LnJlcGx5KDEwMCk7XG4gICAgfTtcbiAgICBJbnZpdGVTZXJ2ZXJUcmFuc2FjdGlvbi5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFNJUC5FdmVudEVtaXR0ZXIucHJvdG90eXBlKTtcbiAgICBJbnZpdGVTZXJ2ZXJUcmFuc2FjdGlvbi5wcm90b3R5cGUuc3RhdGVDaGFuZ2VkID0gZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgIHRoaXMuc3RhdGUgPSBzdGF0ZTtcbiAgICAgICAgdGhpcy5lbWl0KCdzdGF0ZUNoYW5nZWQnKTtcbiAgICB9O1xuICAgIEludml0ZVNlcnZlclRyYW5zYWN0aW9uLnByb3RvdHlwZS50aW1lcl9IID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmxvZ2dlci5kZWJ1ZygnVGltZXIgSCBleHBpcmVkIGZvciBJTlZJVEUgc2VydmVyIHRyYW5zYWN0aW9uICcgKyB0aGlzLmlkKTtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUgPT09IEMuU1RBVFVTX0NPTVBMRVRFRCkge1xuICAgICAgICAgICAgdGhpcy5sb2dnZXIud2FybigndHJhbnNhY3Rpb25zJywgJ0FDSyBmb3IgSU5WSVRFIHNlcnZlciB0cmFuc2FjdGlvbiB3YXMgbmV2ZXIgcmVjZWl2ZWQsIGNhbGwgd2lsbCBiZSB0ZXJtaW5hdGVkJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zdGF0ZUNoYW5nZWQoQy5TVEFUVVNfVEVSTUlOQVRFRCk7XG4gICAgICAgIHRoaXMudWEuZGVzdHJveVRyYW5zYWN0aW9uKHRoaXMpO1xuICAgIH07XG4gICAgSW52aXRlU2VydmVyVHJhbnNhY3Rpb24ucHJvdG90eXBlLnRpbWVyX0kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuc3RhdGVDaGFuZ2VkKEMuU1RBVFVTX1RFUk1JTkFURUQpO1xuICAgICAgICB0aGlzLnVhLmRlc3Ryb3lUcmFuc2FjdGlvbih0aGlzKTtcbiAgICB9O1xuICAgIC8vIFJGQyA2MDI2IDcuMVxuICAgIEludml0ZVNlcnZlclRyYW5zYWN0aW9uLnByb3RvdHlwZS50aW1lcl9MID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmxvZ2dlci5kZWJ1ZygnVGltZXIgTCBleHBpcmVkIGZvciBJTlZJVEUgc2VydmVyIHRyYW5zYWN0aW9uICcgKyB0aGlzLmlkKTtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUgPT09IEMuU1RBVFVTX0FDQ0VQVEVEKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlQ2hhbmdlZChDLlNUQVRVU19URVJNSU5BVEVEKTtcbiAgICAgICAgICAgIHRoaXMudWEuZGVzdHJveVRyYW5zYWN0aW9uKHRoaXMpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBJbnZpdGVTZXJ2ZXJUcmFuc2FjdGlvbi5wcm90b3R5cGUub25UcmFuc3BvcnRFcnJvciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCF0aGlzLnRyYW5zcG9ydEVycm9yKSB7XG4gICAgICAgICAgICB0aGlzLnRyYW5zcG9ydEVycm9yID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZygndHJhbnNwb3J0IGVycm9yIG9jY3VycmVkLCBkZWxldGluZyBJTlZJVEUgc2VydmVyIHRyYW5zYWN0aW9uICcgKyB0aGlzLmlkKTtcbiAgICAgICAgICAgIGlmICh0aGlzLnJlc2VuZFByb3Zpc2lvbmFsVGltZXIgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBTSVAuVGltZXJzLmNsZWFySW50ZXJ2YWwodGhpcy5yZXNlbmRQcm92aXNpb25hbFRpbWVyKTtcbiAgICAgICAgICAgICAgICB0aGlzLnJlc2VuZFByb3Zpc2lvbmFsVGltZXIgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgU0lQLlRpbWVycy5jbGVhclRpbWVvdXQodGhpcy5MKTtcbiAgICAgICAgICAgIFNJUC5UaW1lcnMuY2xlYXJUaW1lb3V0KHRoaXMuSCk7XG4gICAgICAgICAgICBTSVAuVGltZXJzLmNsZWFyVGltZW91dCh0aGlzLkkpO1xuICAgICAgICAgICAgdGhpcy5zdGF0ZUNoYW5nZWQoQy5TVEFUVVNfVEVSTUlOQVRFRCk7XG4gICAgICAgICAgICB0aGlzLnVhLmRlc3Ryb3lUcmFuc2FjdGlvbih0aGlzKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgSW52aXRlU2VydmVyVHJhbnNhY3Rpb24ucHJvdG90eXBlLnJlc2VuZF9wcm92aXNpb25hbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy50cmFuc3BvcnQuc2VuZCh0aGlzLnJlcXVlc3QpLmNhdGNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMub25UcmFuc3BvcnRFcnJvcigpO1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH07XG4gICAgLy8gSU5WSVRFIFNlcnZlciBUcmFuc2FjdGlvbiBSRkMgMzI2MSAxNy4yLjFcbiAgICBJbnZpdGVTZXJ2ZXJUcmFuc2FjdGlvbi5wcm90b3R5cGUucmVjZWl2ZVJlc3BvbnNlID0gZnVuY3Rpb24gKHN0YXR1c19jb2RlLCByZXNwb25zZSkge1xuICAgICAgICB2YXIgdHIgPSB0aGlzO1xuICAgICAgICB2YXIgZGVmZXJyZWQgPSBTSVAuVXRpbHMuZGVmZXIoKTtcbiAgICAgICAgaWYgKHN0YXR1c19jb2RlID49IDEwMCAmJiBzdGF0dXNfY29kZSA8PSAxOTkpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5zdGF0ZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgQy5TVEFUVVNfUFJPQ0VFRElORzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQuc2VuZChyZXNwb25zZSkuY2F0Y2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vblRyYW5zcG9ydEVycm9yKCk7XG4gICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGFzdF9yZXNwb25zZSA9IHJlc3BvbnNlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoc3RhdHVzX2NvZGUgPiAxMDAgJiYgc3RhdHVzX2NvZGUgPD0gMTk5ICYmIHRoaXMuc3RhdGUgPT09IEMuU1RBVFVTX1BST0NFRURJTkcpIHtcbiAgICAgICAgICAgIC8vIFRyaWdnZXIgdGhlIHJlc2VuZFByb3Zpc2lvbmFsVGltZXIgb25seSBmb3IgdGhlIGZpcnN0IG5vbiAxMDAgcHJvdmlzaW9uYWwgcmVzcG9uc2UuXG4gICAgICAgICAgICBpZiAodGhpcy5yZXNlbmRQcm92aXNpb25hbFRpbWVyID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXNlbmRQcm92aXNpb25hbFRpbWVyID0gU0lQLlRpbWVycy5zZXRJbnRlcnZhbCh0ci5yZXNlbmRfcHJvdmlzaW9uYWwuYmluZCh0ciksIFNJUC5UaW1lcnMuUFJPVklTSU9OQUxfUkVTUE9OU0VfSU5URVJWQUwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHN0YXR1c19jb2RlID49IDIwMCAmJiBzdGF0dXNfY29kZSA8PSAyOTkpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5zdGF0ZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgQy5TVEFUVVNfUFJPQ0VFRElORzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZUNoYW5nZWQoQy5TVEFUVVNfQUNDRVBURUQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxhc3RfcmVzcG9uc2UgPSByZXNwb25zZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5MID0gU0lQLlRpbWVycy5zZXRUaW1lb3V0KHRyLnRpbWVyX0wuYmluZCh0ciksIFNJUC5UaW1lcnMuVElNRVJfTCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlc2VuZFByb3Zpc2lvbmFsVGltZXIgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFNJUC5UaW1lcnMuY2xlYXJJbnRlcnZhbCh0aGlzLnJlc2VuZFByb3Zpc2lvbmFsVGltZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNlbmRQcm92aXNpb25hbFRpbWVyID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi9cbiAgICAgICAgICAgICAgICBjYXNlIEMuU1RBVFVTX0FDQ0VQVEVEOlxuICAgICAgICAgICAgICAgICAgICAvLyBOb3RlIHRoYXQgdGhpcyBwb2ludCB3aWxsIGJlIHJlYWNoZWQgZm9yIHByb2NlZWRpbmcgdHIuc3RhdGUgYWxzby5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQuc2VuZChyZXNwb25zZSkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vblRyYW5zcG9ydEVycm9yKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoKTtcbiAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoc3RhdHVzX2NvZGUgPj0gMzAwICYmIHN0YXR1c19jb2RlIDw9IDY5OSkge1xuICAgICAgICAgICAgc3dpdGNoICh0aGlzLnN0YXRlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBDLlNUQVRVU19QUk9DRUVESU5HOlxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5yZXNlbmRQcm92aXNpb25hbFRpbWVyICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBTSVAuVGltZXJzLmNsZWFySW50ZXJ2YWwodGhpcy5yZXNlbmRQcm92aXNpb25hbFRpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVzZW5kUHJvdmlzaW9uYWxUaW1lciA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQuc2VuZChyZXNwb25zZSkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlQ2hhbmdlZChDLlNUQVRVU19DT01QTEVURUQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5IID0gU0lQLlRpbWVycy5zZXRUaW1lb3V0KHRyLnRpbWVyX0guYmluZCh0ciksIFNJUC5UaW1lcnMuVElNRVJfSCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9uVHJhbnNwb3J0RXJyb3IoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdCgpO1xuICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEBmdW5jdGlvblxuICAgICAqIEBwYXJhbSB7U0lQLlVBfSB1YVxuICAgICAqIEBwYXJhbSB7U0lQLkluY29taW5nUmVxdWVzdH0gcmVxdWVzdFxuICAgICAqXG4gICAgICogQHJldHVybiB7Ym9vbGVhbn1cbiAgICAgKiBJTlZJVEU6XG4gICAgICogIF90cnVlXyBpZiByZXRyYW5zbWlzc2lvblxuICAgICAqICBfZmFsc2VfIG5ldyByZXF1ZXN0XG4gICAgICpcbiAgICAgKiBBQ0s6XG4gICAgICogIF90cnVlXyAgQUNLIHRvIG5vbjJ4eCByZXNwb25zZVxuICAgICAqICBfZmFsc2VfIEFDSyBtdXN0IGJlIHBhc3NlZCB0byBUVSAoYWNjZXB0ZWQgc3RhdGUpXG4gICAgICogICAgICAgICAgQUNLIHRvIDJ4eCByZXNwb25zZVxuICAgICAqXG4gICAgICogQ0FOQ0VMOlxuICAgICAqICBfdHJ1ZV8gIG5vIG1hdGNoaW5nIGludml0ZSB0cmFuc2FjdGlvblxuICAgICAqICBfZmFsc2VfIG1hdGNoaW5nIGludml0ZSB0cmFuc2FjdGlvbiBhbmQgbm8gZmluYWwgcmVzcG9uc2Ugc2VudFxuICAgICAqXG4gICAgICogT1RIRVI6XG4gICAgICogIF90cnVlXyAgcmV0cmFuc21pc3Npb25cbiAgICAgKiAgX2ZhbHNlXyBuZXcgcmVxdWVzdFxuICAgICAqL1xuICAgIHZhciBjaGVja1RyYW5zYWN0aW9uID0gZnVuY3Rpb24gKHVhLCByZXF1ZXN0KSB7XG4gICAgICAgIHZhciB0cjtcbiAgICAgICAgc3dpdGNoIChyZXF1ZXN0Lm1ldGhvZCkge1xuICAgICAgICAgICAgY2FzZSBTSVAuQy5JTlZJVEU6XG4gICAgICAgICAgICAgICAgdHIgPSB1YS50cmFuc2FjdGlvbnMuaXN0W3JlcXVlc3QudmlhX2JyYW5jaF07XG4gICAgICAgICAgICAgICAgaWYgKHRyKSB7XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodHIuc3RhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQy5TVEFUVVNfUFJPQ0VFRElORzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ci50cmFuc3BvcnQuc2VuZCh0ci5sYXN0X3Jlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJGQyA2MDI2IDcuMSBJbnZpdGUgcmV0cmFuc21pc3Npb25cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vcmVjZWl2ZWQgd2hpbGUgaW4gQy5TVEFUVVNfQUNDRVBURUQgc3RhdGUuIEFic29yYiBpdC5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQy5TVEFUVVNfQUNDRVBURUQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBTSVAuQy5BQ0s6XG4gICAgICAgICAgICAgICAgdHIgPSB1YS50cmFuc2FjdGlvbnMuaXN0W3JlcXVlc3QudmlhX2JyYW5jaF07XG4gICAgICAgICAgICAgICAgLy8gUkZDIDYwMjYgNy4xXG4gICAgICAgICAgICAgICAgaWYgKHRyKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0ci5zdGF0ZSA9PT0gQy5TVEFUVVNfQUNDRVBURUQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0ci5zdGF0ZSA9PT0gQy5TVEFUVVNfQ09NUExFVEVEKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ci5zdGF0ZUNoYW5nZWQoQy5TVEFUVVNfQ09ORklSTUVEKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyLkkgPSBTSVAuVGltZXJzLnNldFRpbWVvdXQodHIudGltZXJfSS5iaW5kKHRyKSwgU0lQLlRpbWVycy5USU1FUl9JKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIEFDSyB0byAyWFggUmVzcG9uc2UuXG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFNJUC5DLkNBTkNFTDpcbiAgICAgICAgICAgICAgICB0ciA9IHVhLnRyYW5zYWN0aW9ucy5pc3RbcmVxdWVzdC52aWFfYnJhbmNoXTtcbiAgICAgICAgICAgICAgICBpZiAodHIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5yZXBseV9zbCgyMDApO1xuICAgICAgICAgICAgICAgICAgICBpZiAodHIuc3RhdGUgPT09IEMuU1RBVFVTX1BST0NFRURJTkcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnJlcGx5X3NsKDQ4MSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgLy8gTm9uLUlOVklURSBTZXJ2ZXIgVHJhbnNhY3Rpb24gUkZDIDMyNjEgMTcuMi4yXG4gICAgICAgICAgICAgICAgdHIgPSB1YS50cmFuc2FjdGlvbnMubmlzdFtyZXF1ZXN0LnZpYV9icmFuY2hdO1xuICAgICAgICAgICAgICAgIGlmICh0cikge1xuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHRyLnN0YXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEMuU1RBVFVTX1RSWUlORzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQy5TVEFUVVNfUFJPQ0VFRElORzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQy5TVEFUVVNfQ09NUExFVEVEOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyLnRyYW5zcG9ydC5zZW5kKHRyLmxhc3RfcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH07XG4gICAgU0lQLlRyYW5zYWN0aW9ucyA9IHtcbiAgICAgICAgQzogQyxcbiAgICAgICAgY2hlY2tUcmFuc2FjdGlvbjogY2hlY2tUcmFuc2FjdGlvbixcbiAgICAgICAgTm9uSW52aXRlQ2xpZW50VHJhbnNhY3Rpb246IE5vbkludml0ZUNsaWVudFRyYW5zYWN0aW9uLFxuICAgICAgICBJbnZpdGVDbGllbnRUcmFuc2FjdGlvbjogSW52aXRlQ2xpZW50VHJhbnNhY3Rpb24sXG4gICAgICAgIEFja0NsaWVudFRyYW5zYWN0aW9uOiBBY2tDbGllbnRUcmFuc2FjdGlvbixcbiAgICAgICAgTm9uSW52aXRlU2VydmVyVHJhbnNhY3Rpb246IE5vbkludml0ZVNlcnZlclRyYW5zYWN0aW9uLFxuICAgICAgICBJbnZpdGVTZXJ2ZXJUcmFuc2FjdGlvbjogSW52aXRlU2VydmVyVHJhbnNhY3Rpb25cbiAgICB9O1xufTtcblxuXG4vKioqLyB9KSxcbi8qIDE2ICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblwidXNlIHN0cmljdFwiO1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgU0lQIERpYWxvZ1xuICovXG4vKipcbiAqIEBhdWdtZW50cyBTSVBcbiAqIEBjbGFzcyBDbGFzcyBjcmVhdGluZyBhIFNJUCBkaWFsb2cuXG4gKiBAcGFyYW0ge1NJUC5SVENTZXNzaW9ufSBvd25lclxuICogQHBhcmFtIHtTSVAuSW5jb21pbmdSZXF1ZXN0fFNJUC5JbmNvbWluZ1Jlc3BvbnNlfSBtZXNzYWdlXG4gKiBAcGFyYW0ge0VudW19IHR5cGUgVUFDIC8gVUFTXG4gKiBAcGFyYW0ge0VudW19IHN0YXRlIFNJUC5EaWFsb2cuQy5TVEFUVVNfRUFSTFkgLyBTSVAuRGlhbG9nLkMuU1RBVFVTX0NPTkZJUk1FRFxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChTSVApIHtcbiAgICB2YXIgUmVxdWVzdFNlbmRlciA9IF9fd2VicGFja19yZXF1aXJlX18oMTcpKFNJUCk7XG4gICAgdmFyIERpYWxvZywgQyA9IHtcbiAgICAgICAgLy8gRGlhbG9nIHN0YXRlc1xuICAgICAgICBTVEFUVVNfRUFSTFk6IDEsXG4gICAgICAgIFNUQVRVU19DT05GSVJNRUQ6IDJcbiAgICB9O1xuICAgIC8vIFJGQyAzMjYxIDEyLjFcbiAgICBEaWFsb2cgPSBmdW5jdGlvbiAob3duZXIsIG1lc3NhZ2UsIHR5cGUsIHN0YXRlKSB7XG4gICAgICAgIHZhciBjb250YWN0O1xuICAgICAgICB0aGlzLnVhY19wZW5kaW5nX3JlcGx5ID0gZmFsc2U7XG4gICAgICAgIHRoaXMudWFzX3BlbmRpbmdfcmVwbHkgPSBmYWxzZTtcbiAgICAgICAgaWYgKCFtZXNzYWdlLmhhc0hlYWRlcignY29udGFjdCcpKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGVycm9yOiAndW5hYmxlIHRvIGNyZWF0ZSBhIERpYWxvZyB3aXRob3V0IENvbnRhY3QgaGVhZGVyIGZpZWxkJ1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobWVzc2FnZSBpbnN0YW5jZW9mIFNJUC5JbmNvbWluZ1Jlc3BvbnNlKSB7XG4gICAgICAgICAgICBzdGF0ZSA9IChtZXNzYWdlLnN0YXR1c19jb2RlIDwgMjAwKSA/IEMuU1RBVFVTX0VBUkxZIDogQy5TVEFUVVNfQ09ORklSTUVEO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gQ3JlYXRlIGNvbmZpcm1lZCBkaWFsb2cgaWYgc3RhdGUgaXMgbm90IGRlZmluZWRcbiAgICAgICAgICAgIHN0YXRlID0gc3RhdGUgfHwgQy5TVEFUVVNfQ09ORklSTUVEO1xuICAgICAgICB9XG4gICAgICAgIGNvbnRhY3QgPSBtZXNzYWdlLnBhcnNlSGVhZGVyKCdjb250YWN0Jyk7XG4gICAgICAgIC8vIFJGQyAzMjYxIDEyLjEuMVxuICAgICAgICBpZiAodHlwZSA9PT0gJ1VBUycpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSB7XG4gICAgICAgICAgICAgICAgY2FsbF9pZDogbWVzc2FnZS5jYWxsX2lkLFxuICAgICAgICAgICAgICAgIGxvY2FsX3RhZzogbWVzc2FnZS50b190YWcsXG4gICAgICAgICAgICAgICAgcmVtb3RlX3RhZzogbWVzc2FnZS5mcm9tX3RhZyxcbiAgICAgICAgICAgICAgICB0b1N0cmluZzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jYWxsX2lkICsgdGhpcy5sb2NhbF90YWcgKyB0aGlzLnJlbW90ZV90YWc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSBzdGF0ZTtcbiAgICAgICAgICAgIHRoaXMucmVtb3RlX3NlcW51bSA9IG1lc3NhZ2UuY3NlcTtcbiAgICAgICAgICAgIHRoaXMubG9jYWxfdXJpID0gbWVzc2FnZS5wYXJzZUhlYWRlcigndG8nKS51cmk7XG4gICAgICAgICAgICB0aGlzLnJlbW90ZV91cmkgPSBtZXNzYWdlLnBhcnNlSGVhZGVyKCdmcm9tJykudXJpO1xuICAgICAgICAgICAgdGhpcy5yZW1vdGVfdGFyZ2V0ID0gY29udGFjdC51cmk7XG4gICAgICAgICAgICB0aGlzLnJvdXRlX3NldCA9IG1lc3NhZ2UuZ2V0SGVhZGVycygncmVjb3JkLXJvdXRlJyk7XG4gICAgICAgICAgICB0aGlzLmludml0ZV9zZXFudW0gPSBtZXNzYWdlLmNzZXE7XG4gICAgICAgICAgICB0aGlzLmxvY2FsX3NlcW51bSA9IG1lc3NhZ2UuY3NlcTtcbiAgICAgICAgfVxuICAgICAgICAvLyBSRkMgMzI2MSAxMi4xLjJcbiAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ1VBQycpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSB7XG4gICAgICAgICAgICAgICAgY2FsbF9pZDogbWVzc2FnZS5jYWxsX2lkLFxuICAgICAgICAgICAgICAgIGxvY2FsX3RhZzogbWVzc2FnZS5mcm9tX3RhZyxcbiAgICAgICAgICAgICAgICByZW1vdGVfdGFnOiBtZXNzYWdlLnRvX3RhZyxcbiAgICAgICAgICAgICAgICB0b1N0cmluZzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jYWxsX2lkICsgdGhpcy5sb2NhbF90YWcgKyB0aGlzLnJlbW90ZV90YWc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSBzdGF0ZTtcbiAgICAgICAgICAgIHRoaXMuaW52aXRlX3NlcW51bSA9IG1lc3NhZ2UuY3NlcTtcbiAgICAgICAgICAgIHRoaXMubG9jYWxfc2VxbnVtID0gbWVzc2FnZS5jc2VxO1xuICAgICAgICAgICAgdGhpcy5sb2NhbF91cmkgPSBtZXNzYWdlLnBhcnNlSGVhZGVyKCdmcm9tJykudXJpO1xuICAgICAgICAgICAgdGhpcy5wcmFja2VkID0gW107XG4gICAgICAgICAgICB0aGlzLnJlbW90ZV91cmkgPSBtZXNzYWdlLnBhcnNlSGVhZGVyKCd0bycpLnVyaTtcbiAgICAgICAgICAgIHRoaXMucmVtb3RlX3RhcmdldCA9IGNvbnRhY3QudXJpO1xuICAgICAgICAgICAgdGhpcy5yb3V0ZV9zZXQgPSBtZXNzYWdlLmdldEhlYWRlcnMoJ3JlY29yZC1yb3V0ZScpLnJldmVyc2UoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxvZ2dlciA9IG93bmVyLnVhLmdldExvZ2dlcignc2lwLmRpYWxvZycsIHRoaXMuaWQudG9TdHJpbmcoKSk7XG4gICAgICAgIHRoaXMub3duZXIgPSBvd25lcjtcbiAgICAgICAgb3duZXIudWEuZGlhbG9nc1t0aGlzLmlkLnRvU3RyaW5nKCldID0gdGhpcztcbiAgICAgICAgdGhpcy5sb2dnZXIubG9nKCduZXcgJyArIHR5cGUgKyAnIGRpYWxvZyBjcmVhdGVkIHdpdGggc3RhdHVzICcgKyAodGhpcy5zdGF0ZSA9PT0gQy5TVEFUVVNfRUFSTFkgPyAnRUFSTFknIDogJ0NPTkZJUk1FRCcpKTtcbiAgICAgICAgb3duZXIuZW1pdCgnZGlhbG9nJywgdGhpcyk7XG4gICAgfTtcbiAgICBEaWFsb2cucHJvdG90eXBlID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogQHBhcmFtIHtTSVAuSW5jb21pbmdNZXNzYWdlfSBtZXNzYWdlXG4gICAgICAgICAqIEBwYXJhbSB7RW51bX0gVUFDL1VBU1xuICAgICAgICAgKi9cbiAgICAgICAgdXBkYXRlOiBmdW5jdGlvbiAobWVzc2FnZSwgdHlwZSkge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IEMuU1RBVFVTX0NPTkZJUk1FRDtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZygnZGlhbG9nICcgKyB0aGlzLmlkLnRvU3RyaW5nKCkgKyAnICBjaGFuZ2VkIHRvIENPTkZJUk1FRCBzdGF0ZScpO1xuICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdVQUMnKSB7XG4gICAgICAgICAgICAgICAgLy8gUkZDIDMyNjEgMTMuMi4yLjRcbiAgICAgICAgICAgICAgICB0aGlzLnJvdXRlX3NldCA9IG1lc3NhZ2UuZ2V0SGVhZGVycygncmVjb3JkLXJvdXRlJykucmV2ZXJzZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB0ZXJtaW5hdGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZygnZGlhbG9nICcgKyB0aGlzLmlkLnRvU3RyaW5nKCkgKyAnIGRlbGV0ZWQnKTtcbiAgICAgICAgICAgIGlmICh0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIgJiYgdGhpcy5zdGF0ZSAhPT0gQy5TVEFUVVNfQ09ORklSTUVEKSB7XG4gICAgICAgICAgICAgICAgLy8gVE9ETzogVGhpcyBzaG91bGQgY2FsbCAuY2xvc2UoKSBvbiB0aGUgaGFuZGxlciB3aGVuIGltcGxlbWVudGVkXG4gICAgICAgICAgICAgICAgdGhpcy5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyLmNsb3NlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5vd25lci51YS5kaWFsb2dzW3RoaXMuaWQudG9TdHJpbmcoKV07XG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBtZXRob2QgcmVxdWVzdCBtZXRob2RcbiAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXh0cmFIZWFkZXJzIGV4dHJhIGhlYWRlcnNcbiAgICAgICAgKiBAcmV0dXJucyB7U0lQLk91dGdvaW5nUmVxdWVzdH1cbiAgICAgICAgKi9cbiAgICAgICAgLy8gUkZDIDMyNjEgMTIuMi4xLjFcbiAgICAgICAgY3JlYXRlUmVxdWVzdDogZnVuY3Rpb24gKG1ldGhvZCwgZXh0cmFIZWFkZXJzLCBib2R5KSB7XG4gICAgICAgICAgICB2YXIgY3NlcSwgcmVxdWVzdDtcbiAgICAgICAgICAgIGV4dHJhSGVhZGVycyA9IChleHRyYUhlYWRlcnMgfHwgW10pLnNsaWNlKCk7XG4gICAgICAgICAgICBpZiAoIXRoaXMubG9jYWxfc2VxbnVtKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2NhbF9zZXFudW0gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjc2VxID0gKG1ldGhvZCA9PT0gU0lQLkMuQ0FOQ0VMIHx8IG1ldGhvZCA9PT0gU0lQLkMuQUNLKSA/IHRoaXMuaW52aXRlX3NlcW51bSA6IHRoaXMubG9jYWxfc2VxbnVtICs9IDE7XG4gICAgICAgICAgICByZXF1ZXN0ID0gbmV3IFNJUC5PdXRnb2luZ1JlcXVlc3QobWV0aG9kLCB0aGlzLnJlbW90ZV90YXJnZXQsIHRoaXMub3duZXIudWEsIHtcbiAgICAgICAgICAgICAgICAnY3NlcSc6IGNzZXEsXG4gICAgICAgICAgICAgICAgJ2NhbGxfaWQnOiB0aGlzLmlkLmNhbGxfaWQsXG4gICAgICAgICAgICAgICAgJ2Zyb21fdXJpJzogdGhpcy5sb2NhbF91cmksXG4gICAgICAgICAgICAgICAgJ2Zyb21fdGFnJzogdGhpcy5pZC5sb2NhbF90YWcsXG4gICAgICAgICAgICAgICAgJ3RvX3VyaSc6IHRoaXMucmVtb3RlX3VyaSxcbiAgICAgICAgICAgICAgICAndG9fdGFnJzogdGhpcy5pZC5yZW1vdGVfdGFnLFxuICAgICAgICAgICAgICAgICdyb3V0ZV9zZXQnOiB0aGlzLnJvdXRlX3NldFxuICAgICAgICAgICAgfSwgZXh0cmFIZWFkZXJzLCBib2R5KTtcbiAgICAgICAgICAgIHJlcXVlc3QuZGlhbG9nID0gdGhpcztcbiAgICAgICAgICAgIHJldHVybiByZXF1ZXN0O1xuICAgICAgICB9LFxuICAgICAgICAvKipcbiAgICAgICAgKiBAcGFyYW0ge1NJUC5JbmNvbWluZ1JlcXVlc3R9IHJlcXVlc3RcbiAgICAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbn1cbiAgICAgICAgKi9cbiAgICAgICAgLy8gUkZDIDMyNjEgMTIuMi4yXG4gICAgICAgIGNoZWNrSW5EaWFsb2dSZXF1ZXN0OiBmdW5jdGlvbiAocmVxdWVzdCkge1xuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgaWYgKCF0aGlzLnJlbW90ZV9zZXFudW0pIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW90ZV9zZXFudW0gPSByZXF1ZXN0LmNzZXE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChyZXF1ZXN0LmNzZXEgPCB0aGlzLnJlbW90ZV9zZXFudW0pIHtcbiAgICAgICAgICAgICAgICAvL0RvIG5vdCB0cnkgdG8gcmVwbHkgdG8gYW4gQUNLIHJlcXVlc3QuXG4gICAgICAgICAgICAgICAgaWYgKHJlcXVlc3QubWV0aG9kICE9PSBTSVAuQy5BQ0spIHtcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5yZXBseSg1MDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocmVxdWVzdC5jc2VxID09PSB0aGlzLmludml0ZV9zZXFudW0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN3aXRjaCAocmVxdWVzdC5tZXRob2QpIHtcbiAgICAgICAgICAgICAgICAvLyBSRkMzMjYxIDE0LjIgTW9kaWZ5aW5nIGFuIEV4aXN0aW5nIFNlc3Npb24gLVVBUyBCRUhBVklPUi1cbiAgICAgICAgICAgICAgICBjYXNlIFNJUC5DLklOVklURTpcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudWFjX3BlbmRpbmdfcmVwbHkgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3QucmVwbHkoNDkxKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLnVhc19wZW5kaW5nX3JlcGx5ID09PSB0cnVlICYmIHJlcXVlc3QuY3NlcSA+IHRoaXMucmVtb3RlX3NlcW51bSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJldHJ5QWZ0ZXIgPSAoTWF0aC5yYW5kb20oKSAqIDEwIHwgMCkgKyAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5yZXBseSg1MDAsIG51bGwsIFsnUmV0cnktQWZ0ZXI6JyArIHJldHJ5QWZ0ZXJdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3RlX3NlcW51bSA9IHJlcXVlc3QuY3NlcTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudWFzX3BlbmRpbmdfcmVwbHkgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zZXJ2ZXJfdHJhbnNhY3Rpb24ub24oJ3N0YXRlQ2hhbmdlZCcsIGZ1bmN0aW9uIHN0YXRlQ2hhbmdlZCgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSA9PT0gU0lQLlRyYW5zYWN0aW9ucy5DLlNUQVRVU19BQ0NFUFRFRCB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlID09PSBTSVAuVHJhbnNhY3Rpb25zLkMuU1RBVFVTX0NPTVBMRVRFRCB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlID09PSBTSVAuVHJhbnNhY3Rpb25zLkMuU1RBVFVTX1RFUk1JTkFURUQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVMaXN0ZW5lcignc3RhdGVDaGFuZ2VkJywgc3RhdGVDaGFuZ2VkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi51YXNfcGVuZGluZ19yZXBseSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIFJGQzMyNjEgMTIuMi4yIFJlcGxhY2UgdGhlIGRpYWxvZ2BzIHJlbW90ZSB0YXJnZXQgVVJJIGlmIHRoZSByZXF1ZXN0IGlzIGFjY2VwdGVkXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXF1ZXN0Lmhhc0hlYWRlcignY29udGFjdCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnNlcnZlcl90cmFuc2FjdGlvbi5vbignc3RhdGVDaGFuZ2VkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlID09PSBTSVAuVHJhbnNhY3Rpb25zLkMuU1RBVFVTX0FDQ0VQVEVEKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYucmVtb3RlX3RhcmdldCA9IHJlcXVlc3QucGFyc2VIZWFkZXIoJ2NvbnRhY3QnKS51cmk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBTSVAuQy5OT1RJRlk6XG4gICAgICAgICAgICAgICAgICAgIC8vIFJGQzY2NjUgMy4yIFJlcGxhY2UgdGhlIGRpYWxvZ2BzIHJlbW90ZSB0YXJnZXQgVVJJIGlmIHRoZSByZXF1ZXN0IGlzIGFjY2VwdGVkXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXF1ZXN0Lmhhc0hlYWRlcignY29udGFjdCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnNlcnZlcl90cmFuc2FjdGlvbi5vbignc3RhdGVDaGFuZ2VkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlID09PSBTSVAuVHJhbnNhY3Rpb25zLkMuU1RBVFVTX0NPTVBMRVRFRCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnJlbW90ZV90YXJnZXQgPSByZXF1ZXN0LnBhcnNlSGVhZGVyKCdjb250YWN0JykudXJpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHJlcXVlc3QuY3NlcSA+IHRoaXMucmVtb3RlX3NlcW51bSkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVtb3RlX3NlcW51bSA9IHJlcXVlc3QuY3NlcTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9LFxuICAgICAgICBzZW5kUmVxdWVzdDogZnVuY3Rpb24gKGFwcGxpY2FudCwgbWV0aG9kLCBvcHRpb25zKSB7XG4gICAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAgICAgICAgIHZhciBleHRyYUhlYWRlcnMgPSAob3B0aW9ucy5leHRyYUhlYWRlcnMgfHwgW10pLnNsaWNlKCk7XG4gICAgICAgICAgICB2YXIgYm9keSA9IG51bGw7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5ib2R5KSB7XG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuYm9keS5ib2R5KSB7XG4gICAgICAgICAgICAgICAgICAgIGJvZHkgPSBvcHRpb25zLmJvZHk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBib2R5ID0ge307XG4gICAgICAgICAgICAgICAgICAgIGJvZHkuYm9keSA9IG9wdGlvbnMuYm9keTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuY29udGVudFR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJvZHkuY29udGVudFR5cGUgPSBvcHRpb25zLmNvbnRlbnRUeXBlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSB0aGlzLmNyZWF0ZVJlcXVlc3QobWV0aG9kLCBleHRyYUhlYWRlcnMsIGJvZHkpLCByZXF1ZXN0X3NlbmRlciA9IG5ldyBSZXF1ZXN0U2VuZGVyKHRoaXMsIGFwcGxpY2FudCwgcmVxdWVzdCk7XG4gICAgICAgICAgICByZXF1ZXN0X3NlbmRlci5zZW5kKCk7XG4gICAgICAgICAgICByZXR1cm4gcmVxdWVzdDtcbiAgICAgICAgfSxcbiAgICAgICAgLyoqXG4gICAgICAgICogQHBhcmFtIHtTSVAuSW5jb21pbmdSZXF1ZXN0fSByZXF1ZXN0XG4gICAgICAgICovXG4gICAgICAgIHJlY2VpdmVSZXF1ZXN0OiBmdW5jdGlvbiAocmVxdWVzdCkge1xuICAgICAgICAgICAgLy9DaGVjayBpbi1kaWFsb2cgcmVxdWVzdFxuICAgICAgICAgICAgaWYgKCF0aGlzLmNoZWNrSW5EaWFsb2dSZXF1ZXN0KHJlcXVlc3QpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5vd25lci5yZWNlaXZlUmVxdWVzdChyZXF1ZXN0KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgRGlhbG9nLkMgPSBDO1xuICAgIFNJUC5EaWFsb2cgPSBEaWFsb2c7XG59O1xuXG5cbi8qKiovIH0pLFxuLyogMTcgKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBJbi1EaWFsb2cgUmVxdWVzdCBTZW5kZXJcbiAqL1xuLyoqXG4gKiBAYXVnbWVudHMgU0lQLkRpYWxvZ1xuICogQGNsYXNzIENsYXNzIGNyZWF0aW5nIGFuIEluLWRpYWxvZyByZXF1ZXN0IHNlbmRlci5cbiAqIEBwYXJhbSB7U0lQLkRpYWxvZ30gZGlhbG9nXG4gKiBAcGFyYW0ge09iamVjdH0gYXBwbGljYW50XG4gKiBAcGFyYW0ge1NJUC5PdXRnb2luZ1JlcXVlc3R9IHJlcXVlc3RcbiAqL1xuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IGluLURpYWxvZyBSZXF1ZXN0IFNlbmRlclxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChTSVApIHtcbiAgICB2YXIgUmVxdWVzdFNlbmRlcjtcbiAgICBSZXF1ZXN0U2VuZGVyID0gZnVuY3Rpb24gKGRpYWxvZywgYXBwbGljYW50LCByZXF1ZXN0KSB7XG4gICAgICAgIHRoaXMuZGlhbG9nID0gZGlhbG9nO1xuICAgICAgICB0aGlzLmFwcGxpY2FudCA9IGFwcGxpY2FudDtcbiAgICAgICAgdGhpcy5yZXF1ZXN0ID0gcmVxdWVzdDtcbiAgICAgICAgLy8gUkZDMzI2MSAxNC4xIE1vZGlmeWluZyBhbiBFeGlzdGluZyBTZXNzaW9uLiBVQUMgQmVoYXZpb3IuXG4gICAgICAgIHRoaXMucmVhdHRlbXB0ID0gZmFsc2U7XG4gICAgICAgIHRoaXMucmVhdHRlbXB0VGltZXIgPSBudWxsO1xuICAgIH07XG4gICAgUmVxdWVzdFNlbmRlci5wcm90b3R5cGUgPSB7XG4gICAgICAgIHNlbmQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcywgcmVxdWVzdF9zZW5kZXIgPSBuZXcgU0lQLlJlcXVlc3RTZW5kZXIodGhpcywgdGhpcy5kaWFsb2cub3duZXIudWEpO1xuICAgICAgICAgICAgcmVxdWVzdF9zZW5kZXIuc2VuZCgpO1xuICAgICAgICAgICAgLy8gUkZDMzI2MSAxNC4yIE1vZGlmeWluZyBhbiBFeGlzdGluZyBTZXNzaW9uIC1VQUMgQkVIQVZJT1ItXG4gICAgICAgICAgICBpZiAodGhpcy5yZXF1ZXN0Lm1ldGhvZCA9PT0gU0lQLkMuSU5WSVRFICYmIHJlcXVlc3Rfc2VuZGVyLmNsaWVudFRyYW5zYWN0aW9uLnN0YXRlICE9PSBTSVAuVHJhbnNhY3Rpb25zLkMuU1RBVFVTX1RFUk1JTkFURUQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpYWxvZy51YWNfcGVuZGluZ19yZXBseSA9IHRydWU7XG4gICAgICAgICAgICAgICAgcmVxdWVzdF9zZW5kZXIuY2xpZW50VHJhbnNhY3Rpb24ub24oJ3N0YXRlQ2hhbmdlZCcsIGZ1bmN0aW9uIHN0YXRlQ2hhbmdlZCgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUgPT09IFNJUC5UcmFuc2FjdGlvbnMuQy5TVEFUVVNfQUNDRVBURUQgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUgPT09IFNJUC5UcmFuc2FjdGlvbnMuQy5TVEFUVVNfQ09NUExFVEVEIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlID09PSBTSVAuVHJhbnNhY3Rpb25zLkMuU1RBVFVTX1RFUk1JTkFURUQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlTGlzdGVuZXIoJ3N0YXRlQ2hhbmdlZCcsIHN0YXRlQ2hhbmdlZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmRpYWxvZy51YWNfcGVuZGluZ19yZXBseSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIG9uUmVxdWVzdFRpbWVvdXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuYXBwbGljYW50Lm9uUmVxdWVzdFRpbWVvdXQoKTtcbiAgICAgICAgfSxcbiAgICAgICAgb25UcmFuc3BvcnRFcnJvcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5hcHBsaWNhbnQub25UcmFuc3BvcnRFcnJvcigpO1xuICAgICAgICB9LFxuICAgICAgICByZWNlaXZlUmVzcG9uc2U6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgLy8gUkZDMzI2MSAxMi4yLjEuMiA0MDggb3IgNDgxIGlzIHJlY2VpdmVkIGZvciBhIHJlcXVlc3Qgd2l0aGluIGEgZGlhbG9nLlxuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1c19jb2RlID09PSA0MDggfHwgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT09IDQ4MSkge1xuICAgICAgICAgICAgICAgIHRoaXMuYXBwbGljYW50Lm9uRGlhbG9nRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocmVzcG9uc2UubWV0aG9kID09PSBTSVAuQy5JTlZJVEUgJiYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT09IDQ5MSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlYXR0ZW1wdCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGxpY2FudC5yZWNlaXZlUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0LmNzZXEudmFsdWUgPSB0aGlzLmRpYWxvZy5sb2NhbF9zZXFudW0gKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWF0dGVtcHRUaW1lciA9IFNJUC5UaW1lcnMuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZi5hcHBsaWNhbnQub3duZXIuc3RhdHVzICE9PSBTSVAuU2Vzc2lvbi5DLlNUQVRVU19URVJNSU5BVEVEKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5yZWF0dGVtcHQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYucmVxdWVzdF9zZW5kZXIuc2VuZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLmdldFJlYXR0ZW1wdFRpbWVvdXQoKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hcHBsaWNhbnQucmVjZWl2ZVJlc3BvbnNlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIFJlcXVlc3RTZW5kZXI7XG59O1xuXG5cbi8qKiovIH0pLFxuLyogMTggKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBSZXF1ZXN0IFNlbmRlclxuICovXG4vKipcbiAqIEBhdWdtZW50cyBTSVBcbiAqIEBjbGFzcyBDbGFzcyBjcmVhdGluZyBhIHJlcXVlc3Qgc2VuZGVyLlxuICogQHBhcmFtIHtPYmplY3R9IGFwcGxpY2FudFxuICogQHBhcmFtIHtTSVAuVUF9IHVhXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKFNJUCkge1xuICAgIHZhciBSZXF1ZXN0U2VuZGVyO1xuICAgIFJlcXVlc3RTZW5kZXIgPSBmdW5jdGlvbiAoYXBwbGljYW50LCB1YSkge1xuICAgICAgICB0aGlzLmxvZ2dlciA9IHVhLmdldExvZ2dlcignc2lwLnJlcXVlc3RzZW5kZXInKTtcbiAgICAgICAgdGhpcy51YSA9IHVhO1xuICAgICAgICB0aGlzLmFwcGxpY2FudCA9IGFwcGxpY2FudDtcbiAgICAgICAgdGhpcy5tZXRob2QgPSBhcHBsaWNhbnQucmVxdWVzdC5tZXRob2Q7XG4gICAgICAgIHRoaXMucmVxdWVzdCA9IGFwcGxpY2FudC5yZXF1ZXN0O1xuICAgICAgICB0aGlzLmNyZWRlbnRpYWxzID0gbnVsbDtcbiAgICAgICAgdGhpcy5jaGFsbGVuZ2VkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc3RhbGVkID0gZmFsc2U7XG4gICAgICAgIC8vIElmIHVhIGlzIGluIGNsb3NpbmcgcHJvY2VzcyBvciBldmVuIGNsb3NlZCBqdXN0IGFsbG93IHNlbmRpbmcgQnllIGFuZCBBQ0tcbiAgICAgICAgaWYgKHVhLnN0YXR1cyA9PT0gU0lQLlVBLkMuU1RBVFVTX1VTRVJfQ0xPU0VEICYmICh0aGlzLm1ldGhvZCAhPT0gU0lQLkMuQllFIHx8IHRoaXMubWV0aG9kICE9PSBTSVAuQy5BQ0spKSB7XG4gICAgICAgICAgICB0aGlzLm9uVHJhbnNwb3J0RXJyb3IoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgLyoqXG4gICAgKiBDcmVhdGUgdGhlIGNsaWVudCB0cmFuc2FjdGlvbiBhbmQgc2VuZCB0aGUgbWVzc2FnZS5cbiAgICAqL1xuICAgIFJlcXVlc3RTZW5kZXIucHJvdG90eXBlID0ge1xuICAgICAgICBzZW5kOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMubWV0aG9kKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcIklOVklURVwiOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsaWVudFRyYW5zYWN0aW9uID0gbmV3IFNJUC5UcmFuc2FjdGlvbnMuSW52aXRlQ2xpZW50VHJhbnNhY3Rpb24odGhpcywgdGhpcy5yZXF1ZXN0LCB0aGlzLnVhLnRyYW5zcG9ydCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJBQ0tcIjpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGllbnRUcmFuc2FjdGlvbiA9IG5ldyBTSVAuVHJhbnNhY3Rpb25zLkFja0NsaWVudFRyYW5zYWN0aW9uKHRoaXMsIHRoaXMucmVxdWVzdCwgdGhpcy51YS50cmFuc3BvcnQpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsaWVudFRyYW5zYWN0aW9uID0gbmV3IFNJUC5UcmFuc2FjdGlvbnMuTm9uSW52aXRlQ2xpZW50VHJhbnNhY3Rpb24odGhpcywgdGhpcy5yZXF1ZXN0LCB0aGlzLnVhLnRyYW5zcG9ydCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmNsaWVudFRyYW5zYWN0aW9uLnNlbmQoKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsaWVudFRyYW5zYWN0aW9uO1xuICAgICAgICB9LFxuICAgICAgICAvKipcbiAgICAgICAgKiBDYWxsYmFjayBmaXJlZCB3aGVuIHJlY2VpdmluZyBhIHJlcXVlc3QgdGltZW91dCBlcnJvciBmcm9tIHRoZSBjbGllbnQgdHJhbnNhY3Rpb24uXG4gICAgICAgICogVG8gYmUgcmUtZGVmaW5lZCBieSB0aGUgYXBwbGljYW50LlxuICAgICAgICAqIEBldmVudFxuICAgICAgICAqL1xuICAgICAgICBvblJlcXVlc3RUaW1lb3V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLmFwcGxpY2FudC5vblJlcXVlc3RUaW1lb3V0KCk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICAqIENhbGxiYWNrIGZpcmVkIHdoZW4gcmVjZWl2aW5nIGEgdHJhbnNwb3J0IGVycm9yIGZyb20gdGhlIGNsaWVudCB0cmFuc2FjdGlvbi5cbiAgICAgICAgKiBUbyBiZSByZS1kZWZpbmVkIGJ5IHRoZSBhcHBsaWNhbnQuXG4gICAgICAgICogQGV2ZW50XG4gICAgICAgICovXG4gICAgICAgIG9uVHJhbnNwb3J0RXJyb3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuYXBwbGljYW50Lm9uVHJhbnNwb3J0RXJyb3IoKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyoqXG4gICAgICAgICogQ2FsbGVkIGZyb20gY2xpZW50IHRyYW5zYWN0aW9uIHdoZW4gcmVjZWl2aW5nIGEgY29ycmVjdCByZXNwb25zZSB0byB0aGUgcmVxdWVzdC5cbiAgICAgICAgKiBBdXRoZW50aWNhdGUgcmVxdWVzdCBpZiBuZWVkZWQgb3IgcGFzcyB0aGUgcmVzcG9uc2UgYmFjayB0byB0aGUgYXBwbGljYW50LlxuICAgICAgICAqIEBwYXJhbSB7U0lQLkluY29taW5nUmVzcG9uc2V9IHJlc3BvbnNlXG4gICAgICAgICovXG4gICAgICAgIHJlY2VpdmVSZXNwb25zZTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICB2YXIgY3NlcSwgY2hhbGxlbmdlLCBhdXRob3JpemF0aW9uX2hlYWRlcl9uYW1lLCBzdGF0dXNfY29kZSA9IHJlc3BvbnNlLnN0YXR1c19jb2RlO1xuICAgICAgICAgICAgLypcbiAgICAgICAgICAgICogQXV0aGVudGljYXRpb25cbiAgICAgICAgICAgICogQXV0aGVudGljYXRlIG9uY2UuIF9jaGFsbGVuZ2VkXyBmbGFnIHVzZWQgdG8gYXZvaWQgaW5maW5pdGUgYXV0aGVudGljYXRpb25zLlxuICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGlmIChzdGF0dXNfY29kZSA9PT0gNDAxIHx8IHN0YXR1c19jb2RlID09PSA0MDcpIHtcbiAgICAgICAgICAgICAgICAvLyBHZXQgYW5kIHBhcnNlIHRoZSBhcHByb3ByaWF0ZSBXV1ctQXV0aGVudGljYXRlIG9yIFByb3h5LUF1dGhlbnRpY2F0ZSBoZWFkZXIuXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1c19jb2RlID09PSA0MDEpIHtcbiAgICAgICAgICAgICAgICAgICAgY2hhbGxlbmdlID0gcmVzcG9uc2UucGFyc2VIZWFkZXIoJ3d3dy1hdXRoZW50aWNhdGUnKTtcbiAgICAgICAgICAgICAgICAgICAgYXV0aG9yaXphdGlvbl9oZWFkZXJfbmFtZSA9ICdhdXRob3JpemF0aW9uJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNoYWxsZW5nZSA9IHJlc3BvbnNlLnBhcnNlSGVhZGVyKCdwcm94eS1hdXRoZW50aWNhdGUnKTtcbiAgICAgICAgICAgICAgICAgICAgYXV0aG9yaXphdGlvbl9oZWFkZXJfbmFtZSA9ICdwcm94eS1hdXRob3JpemF0aW9uJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gVmVyaWZ5IGl0IHNlZW1zIGEgdmFsaWQgY2hhbGxlbmdlLlxuICAgICAgICAgICAgICAgIGlmICghY2hhbGxlbmdlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4ocmVzcG9uc2Uuc3RhdHVzX2NvZGUgKyAnIHdpdGggd3Jvbmcgb3IgbWlzc2luZyBjaGFsbGVuZ2UsIGNhbm5vdCBhdXRoZW50aWNhdGUnKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBsaWNhbnQucmVjZWl2ZVJlc3BvbnNlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuY2hhbGxlbmdlZCB8fCAoIXRoaXMuc3RhbGVkICYmIGNoYWxsZW5nZS5zdGFsZSA9PT0gdHJ1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmNyZWRlbnRpYWxzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWRlbnRpYWxzID0gdGhpcy51YS5jb25maWd1cmF0aW9uLmF1dGhlbnRpY2F0aW9uRmFjdG9yeSh0aGlzLnVhKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBWZXJpZnkgdGhhdCB0aGUgY2hhbGxlbmdlIGlzIHJlYWxseSB2YWxpZC5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmNyZWRlbnRpYWxzLmF1dGhlbnRpY2F0ZSh0aGlzLnJlcXVlc3QsIGNoYWxsZW5nZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwbGljYW50LnJlY2VpdmVSZXNwb25zZShyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGFsbGVuZ2VkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoYWxsZW5nZS5zdGFsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGFsZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5tZXRob2QgPT09IFNJUC5DLlJFR0lTVEVSKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjc2VxID0gdGhpcy5hcHBsaWNhbnQuY3NlcSArPSAxO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMucmVxdWVzdC5kaWFsb2cpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNzZXEgPSB0aGlzLnJlcXVlc3QuZGlhbG9nLmxvY2FsX3NlcW51bSArPSAxO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY3NlcSA9IHRoaXMucmVxdWVzdC5jc2VxICsgMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdC5jc2VxID0gY3NlcTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlcXVlc3Quc2V0SGVhZGVyKCdjc2VxJywgY3NlcSArICcgJyArIHRoaXMubWV0aG9kKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0LnNldEhlYWRlcihhdXRob3JpemF0aW9uX2hlYWRlcl9uYW1lLCB0aGlzLmNyZWRlbnRpYWxzLnRvU3RyaW5nKCkpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbmQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwbGljYW50LnJlY2VpdmVSZXNwb25zZShyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hcHBsaWNhbnQucmVjZWl2ZVJlc3BvbnNlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgU0lQLlJlcXVlc3RTZW5kZXIgPSBSZXF1ZXN0U2VuZGVyO1xufTtcblxuXG4vKioqLyB9KSxcbi8qIDE5ICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblwidXNlIHN0cmljdFwiO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChTSVApIHtcbiAgICB2YXIgUmVnaXN0ZXJDb250ZXh0O1xuICAgIFJlZ2lzdGVyQ29udGV4dCA9IGZ1bmN0aW9uICh1YSkge1xuICAgICAgICB2YXIgcGFyYW1zID0ge30sIHJlZ0lkID0gMTtcbiAgICAgICAgdGhpcy5yZWdpc3RyYXIgPSB1YS5jb25maWd1cmF0aW9uLnJlZ2lzdHJhclNlcnZlcjtcbiAgICAgICAgdGhpcy5leHBpcmVzID0gdWEuY29uZmlndXJhdGlvbi5yZWdpc3RlckV4cGlyZXM7XG4gICAgICAgIC8vIENvbnRhY3QgaGVhZGVyXG4gICAgICAgIHRoaXMuY29udGFjdCA9IHVhLmNvbnRhY3QudG9TdHJpbmcoKTtcbiAgICAgICAgaWYgKHJlZ0lkKSB7XG4gICAgICAgICAgICB0aGlzLmNvbnRhY3QgKz0gJztyZWctaWQ9JyArIHJlZ0lkO1xuICAgICAgICAgICAgdGhpcy5jb250YWN0ICs9ICc7K3NpcC5pbnN0YW5jZT1cIjx1cm46dXVpZDonICsgdWEuY29uZmlndXJhdGlvbi5pbnN0YW5jZUlkICsgJz5cIic7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQ2FsbC1JRCBhbmQgQ1NlcSB2YWx1ZXMgUkZDMzI2MSAxMC4yXG4gICAgICAgIHRoaXMuY2FsbF9pZCA9IFNJUC5VdGlscy5jcmVhdGVSYW5kb21Ub2tlbigyMik7XG4gICAgICAgIHRoaXMuY3NlcSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDAwKTtcbiAgICAgICAgdGhpcy50b191cmkgPSB1YS5jb25maWd1cmF0aW9uLnVyaTtcbiAgICAgICAgcGFyYW1zLnRvX3VyaSA9IHRoaXMudG9fdXJpO1xuICAgICAgICBwYXJhbXMudG9fZGlzcGxheU5hbWUgPSB1YS5jb25maWd1cmF0aW9uLmRpc3BsYXlOYW1lO1xuICAgICAgICBwYXJhbXMuY2FsbF9pZCA9IHRoaXMuY2FsbF9pZDtcbiAgICAgICAgcGFyYW1zLmNzZXEgPSB0aGlzLmNzZXE7XG4gICAgICAgIC8vIEV4dGVuZHMgQ2xpZW50Q29udGV4dFxuICAgICAgICBTSVAuVXRpbHMuYXVnbWVudCh0aGlzLCBTSVAuQ2xpZW50Q29udGV4dCwgW3VhLCAnUkVHSVNURVInLCB0aGlzLnJlZ2lzdHJhciwgeyBwYXJhbXM6IHBhcmFtcyB9XSk7XG4gICAgICAgIHRoaXMucmVnaXN0cmF0aW9uVGltZXIgPSBudWxsO1xuICAgICAgICB0aGlzLnJlZ2lzdHJhdGlvbkV4cGlyZWRUaW1lciA9IG51bGw7XG4gICAgICAgIC8vIFNldCBzdGF0dXNcbiAgICAgICAgdGhpcy5yZWdpc3RlcmVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMubG9nZ2VyID0gdWEuZ2V0TG9nZ2VyKCdzaXAucmVnaXN0ZXJjb250ZXh0Jyk7XG4gICAgICAgIHVhLm9uKCd0cmFuc3BvcnRDcmVhdGVkJywgZnVuY3Rpb24gKHRyYW5zcG9ydCkge1xuICAgICAgICAgICAgdHJhbnNwb3J0Lm9uKCdkaXNjb25uZWN0ZWQnLCB0aGlzLm9uVHJhbnNwb3J0RGlzY29ubmVjdGVkLmJpbmQodGhpcykpO1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH07XG4gICAgUmVnaXN0ZXJDb250ZXh0LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoe30sIHtcbiAgICAgICAgcmVnaXN0ZXI6IHsgd3JpdGFibGU6IHRydWUsIHZhbHVlOiBmdW5jdGlvbiByZWdpc3RlcihvcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzLCBleHRyYUhlYWRlcnM7XG4gICAgICAgICAgICAgICAgLy8gSGFuZGxlIE9wdGlvbnNcbiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgICAgICAgICAgICAgIGV4dHJhSGVhZGVycyA9ICh0aGlzLm9wdGlvbnMuZXh0cmFIZWFkZXJzIHx8IFtdKS5zbGljZSgpO1xuICAgICAgICAgICAgICAgIGV4dHJhSGVhZGVycy5wdXNoKCdDb250YWN0OiAnICsgdGhpcy5jb250YWN0ICsgJztleHBpcmVzPScgKyB0aGlzLmV4cGlyZXMpO1xuICAgICAgICAgICAgICAgIGV4dHJhSGVhZGVycy5wdXNoKCdBbGxvdzogJyArIFNJUC5VQS5DLkFMTE9XRURfTUVUSE9EUy50b1N0cmluZygpKTtcbiAgICAgICAgICAgICAgICAvLyBTYXZlIG9yaWdpbmFsIGV4dHJhSGVhZGVycyB0byBiZSB1c2VkIGluIC5jbG9zZVxuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VIZWFkZXJzID0gdGhpcy5vcHRpb25zLmNsb3NlV2l0aEhlYWRlcnMgP1xuICAgICAgICAgICAgICAgICAgICAodGhpcy5vcHRpb25zLmV4dHJhSGVhZGVycyB8fCBbXSkuc2xpY2UoKSA6IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMucmVjZWl2ZVJlc3BvbnNlID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjb250YWN0LCBleHBpcmVzLCBjb250YWN0cyA9IHJlc3BvbnNlLmdldEhlYWRlcnMoJ2NvbnRhY3QnKS5sZW5ndGgsIGNhdXNlO1xuICAgICAgICAgICAgICAgICAgICAvLyBEaXNjYXJkIHJlc3BvbnNlcyB0byBvbGRlciBSRUdJU1RFUi91bi1SRUdJU1RFUiByZXF1ZXN0cy5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmNzZXEgIT09IHRoaXMuY3NlcSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIENsZWFyIHJlZ2lzdHJhdGlvbiB0aW1lclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5yZWdpc3RyYXRpb25UaW1lciAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgU0lQLlRpbWVycy5jbGVhclRpbWVvdXQodGhpcy5yZWdpc3RyYXRpb25UaW1lcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZ2lzdHJhdGlvblRpbWVyID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgL14xWzAtOV17Mn0kLy50ZXN0KHJlc3BvbnNlLnN0YXR1c19jb2RlKTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ3Byb2dyZXNzJywgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAvXjJbMC05XXsyfSQvLnRlc3QocmVzcG9uc2Uuc3RhdHVzX2NvZGUpOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgnYWNjZXB0ZWQnLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmhhc0hlYWRlcignZXhwaXJlcycpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGlyZXMgPSByZXNwb25zZS5nZXRIZWFkZXIoJ2V4cGlyZXMnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVnaXN0cmF0aW9uRXhwaXJlZFRpbWVyICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNJUC5UaW1lcnMuY2xlYXJUaW1lb3V0KHRoaXMucmVnaXN0cmF0aW9uRXhwaXJlZFRpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWdpc3RyYXRpb25FeHBpcmVkVGltZXIgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZWFyY2ggdGhlIENvbnRhY3QgcG9pbnRpbmcgdG8gdXMgYW5kIHVwZGF0ZSB0aGUgZXhwaXJlcyB2YWx1ZSBhY2NvcmRpbmdseS5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWNvbnRhY3RzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ25vIENvbnRhY3QgaGVhZGVyIGluIHJlc3BvbnNlIHRvIFJFR0lTVEVSLCByZXNwb25zZSBpZ25vcmVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoY29udGFjdHMtLSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250YWN0ID0gcmVzcG9uc2UucGFyc2VIZWFkZXIoJ2NvbnRhY3QnLCBjb250YWN0cyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb250YWN0LnVyaS51c2VyID09PSB0aGlzLnVhLmNvbnRhY3QudXJpLnVzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGlyZXMgPSBjb250YWN0LmdldFBhcmFtKCdleHBpcmVzJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhY3QgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY29udGFjdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuKCdubyBDb250YWN0IGhlYWRlciBwb2ludGluZyB0byB1cywgcmVzcG9uc2UgaWdub3JlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFleHBpcmVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGlyZXMgPSB0aGlzLmV4cGlyZXM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlLVJlZ2lzdGVyIGJlZm9yZSB0aGUgZXhwaXJhdGlvbiBpbnRlcnZhbCBoYXMgZWxhcHNlZC5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBGb3IgdGhhdCwgZGVjcmVhc2UgdGhlIGV4cGlyZXMgdmFsdWUuIGllOiAzIHNlY29uZHNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZ2lzdHJhdGlvblRpbWVyID0gU0lQLlRpbWVycy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5yZWdpc3RyYXRpb25UaW1lciA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYucmVnaXN0ZXIoc2VsZi5vcHRpb25zKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCAoZXhwaXJlcyAqIDEwMDApIC0gMzAwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWdpc3RyYXRpb25FeHBpcmVkVGltZXIgPSBTSVAuVGltZXJzLnNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuKCdyZWdpc3RyYXRpb24gZXhwaXJlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZi5yZWdpc3RlcmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnVucmVnaXN0ZXJlZChudWxsLCBTSVAuQy5jYXVzZXMuRVhQSVJFUyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBleHBpcmVzICogMTAwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9TYXZlIGdydXUgdmFsdWVzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRhY3QuaGFzUGFyYW0oJ3RlbXAtZ3J1dScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudWEuY29udGFjdC50ZW1wX2dydXUgPSBTSVAuVVJJLnBhcnNlKGNvbnRhY3QuZ2V0UGFyYW0oJ3RlbXAtZ3J1dScpLnJlcGxhY2UoL1wiL2csICcnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb250YWN0Lmhhc1BhcmFtKCdwdWItZ3J1dScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudWEuY29udGFjdC5wdWJfZ3J1dSA9IFNJUC5VUkkucGFyc2UoY29udGFjdC5nZXRQYXJhbSgncHViLWdydXUnKS5yZXBsYWNlKC9cIi9nLCAnJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZ2lzdGVyZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgncmVnaXN0ZXJlZCcsIHJlc3BvbnNlIHx8IG51bGwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSW50ZXJ2YWwgdG9vIGJyaWVmIFJGQzMyNjEgMTAuMi44XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIC9eNDIzJC8udGVzdChyZXNwb25zZS5zdGF0dXNfY29kZSk6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmhhc0hlYWRlcignbWluLWV4cGlyZXMnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJbmNyZWFzZSBvdXIgcmVnaXN0cmF0aW9uIGludGVydmFsIHRvIHRoZSBzdWdnZXN0ZWQgbWluaW11bVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmV4cGlyZXMgPSByZXNwb25zZS5nZXRIZWFkZXIoJ21pbi1leHBpcmVzJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEF0dGVtcHQgdGhlIHJlZ2lzdHJhdGlvbiBhZ2FpbiBpbW1lZGlhdGVseVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZ2lzdGVyKHRoaXMub3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgeyAvL1RoaXMgcmVzcG9uc2UgTVVTVCBjb250YWluIGEgTWluLUV4cGlyZXMgaGVhZGVyIGZpZWxkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oJzQyMyByZXNwb25zZSByZWNlaXZlZCBmb3IgUkVHSVNURVIgd2l0aG91dCBNaW4tRXhwaXJlcycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZ2lzdHJhdGlvbkZhaWx1cmUocmVzcG9uc2UsIFNJUC5DLmNhdXNlcy5TSVBfRkFJTFVSRV9DT0RFKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdXNlID0gU0lQLlV0aWxzLnNpcEVycm9yQ2F1c2UocmVzcG9uc2Uuc3RhdHVzX2NvZGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVnaXN0cmF0aW9uRmFpbHVyZShyZXNwb25zZSwgY2F1c2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB0aGlzLm9uUmVxdWVzdFRpbWVvdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVnaXN0cmF0aW9uRmFpbHVyZShudWxsLCBTSVAuQy5jYXVzZXMuUkVRVUVTVF9USU1FT1VUKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHRoaXMub25UcmFuc3BvcnRFcnJvciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWdpc3RyYXRpb25GYWlsdXJlKG51bGwsIFNJUC5DLmNhdXNlcy5DT05ORUNUSU9OX0VSUk9SKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHRoaXMuY3NlcSsrO1xuICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdC5jc2VxID0gdGhpcy5jc2VxO1xuICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdC5zZXRIZWFkZXIoJ2NzZXEnLCB0aGlzLmNzZXEgKyAnIFJFR0lTVEVSJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0LmV4dHJhSGVhZGVycyA9IGV4dHJhSGVhZGVycztcbiAgICAgICAgICAgICAgICB0aGlzLnNlbmQoKTtcbiAgICAgICAgICAgIH0gfSxcbiAgICAgICAgcmVnaXN0cmF0aW9uRmFpbHVyZTogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uIHJlZ2lzdHJhdGlvbkZhaWx1cmUocmVzcG9uc2UsIGNhdXNlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdmYWlsZWQnLCByZXNwb25zZSB8fCBudWxsLCBjYXVzZSB8fCBudWxsKTtcbiAgICAgICAgICAgIH0gfSxcbiAgICAgICAgb25UcmFuc3BvcnREaXNjb25uZWN0ZWQ6IHsgd3JpdGFibGU6IHRydWUsIHZhbHVlOiBmdW5jdGlvbiBvblRyYW5zcG9ydERpc2Nvbm5lY3RlZCgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlZ2lzdGVyZWRfYmVmb3JlID0gdGhpcy5yZWdpc3RlcmVkO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlZ2lzdHJhdGlvblRpbWVyICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIFNJUC5UaW1lcnMuY2xlYXJUaW1lb3V0KHRoaXMucmVnaXN0cmF0aW9uVGltZXIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZ2lzdHJhdGlvblRpbWVyID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucmVnaXN0cmF0aW9uRXhwaXJlZFRpbWVyICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIFNJUC5UaW1lcnMuY2xlYXJUaW1lb3V0KHRoaXMucmVnaXN0cmF0aW9uRXhwaXJlZFRpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWdpc3RyYXRpb25FeHBpcmVkVGltZXIgPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5yZWdpc3RlcmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudW5yZWdpc3RlcmVkKG51bGwsIFNJUC5DLmNhdXNlcy5DT05ORUNUSU9OX0VSUk9SKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0sXG4gICAgICAgIG9uVHJhbnNwb3J0Q29ubmVjdGVkOiB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogZnVuY3Rpb24gb25UcmFuc3BvcnRDb25uZWN0ZWQoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZWdpc3Rlcih0aGlzLm9wdGlvbnMpO1xuICAgICAgICAgICAgfSB9LFxuICAgICAgICBjbG9zZTogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uIGNsb3NlKCkge1xuICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICAgICAgICAgICAgICBhbGw6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBleHRyYUhlYWRlcnM6IHRoaXMuY2xvc2VIZWFkZXJzXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB0aGlzLnJlZ2lzdGVyZWRfYmVmb3JlID0gdGhpcy5yZWdpc3RlcmVkO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlZ2lzdGVyZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51bnJlZ2lzdGVyKG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSxcbiAgICAgICAgdW5yZWdpc3RlcjogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uIHVucmVnaXN0ZXIob3B0aW9ucykge1xuICAgICAgICAgICAgICAgIHZhciBleHRyYUhlYWRlcnM7XG4gICAgICAgICAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnJlZ2lzdGVyZWQgJiYgIW9wdGlvbnMuYWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ0FscmVhZHkgdW5yZWdpc3RlcmVkLCBidXQgc2VuZGluZyBhbiB1bnJlZ2lzdGVyIGFueXdheXMuJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGV4dHJhSGVhZGVycyA9IChvcHRpb25zLmV4dHJhSGVhZGVycyB8fCBbXSkuc2xpY2UoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnJlZ2lzdGVyZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAvLyBDbGVhciB0aGUgcmVnaXN0cmF0aW9uIHRpbWVyLlxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlZ2lzdHJhdGlvblRpbWVyICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIFNJUC5UaW1lcnMuY2xlYXJUaW1lb3V0KHRoaXMucmVnaXN0cmF0aW9uVGltZXIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZ2lzdHJhdGlvblRpbWVyID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuYWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGV4dHJhSGVhZGVycy5wdXNoKCdDb250YWN0OiAqJyk7XG4gICAgICAgICAgICAgICAgICAgIGV4dHJhSGVhZGVycy5wdXNoKCdFeHBpcmVzOiAwJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBleHRyYUhlYWRlcnMucHVzaCgnQ29udGFjdDogJyArIHRoaXMuY29udGFjdCArICc7ZXhwaXJlcz0wJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMucmVjZWl2ZVJlc3BvbnNlID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjYXVzZTtcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIC9eMVswLTldezJ9JC8udGVzdChyZXNwb25zZS5zdGF0dXNfY29kZSk6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdwcm9ncmVzcycsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgL14yWzAtOV17Mn0kLy50ZXN0KHJlc3BvbnNlLnN0YXR1c19jb2RlKTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ2FjY2VwdGVkJywgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlZ2lzdHJhdGlvbkV4cGlyZWRUaW1lciAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTSVAuVGltZXJzLmNsZWFyVGltZW91dCh0aGlzLnJlZ2lzdHJhdGlvbkV4cGlyZWRUaW1lcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVnaXN0cmF0aW9uRXhwaXJlZFRpbWVyID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51bnJlZ2lzdGVyZWQocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXVzZSA9IFNJUC5VdGlscy5zaXBFcnJvckNhdXNlKHJlc3BvbnNlLnN0YXR1c19jb2RlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVucmVnaXN0ZXJlZChyZXNwb25zZSwgY2F1c2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB0aGlzLm9uUmVxdWVzdFRpbWVvdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIE5vdCBhY3R1YWxseSB1bnJlZ2lzdGVyZWQuLi5cbiAgICAgICAgICAgICAgICAgICAgLy90aGlzLnVucmVnaXN0ZXJlZChudWxsLCBTSVAuQy5jYXVzZXMuUkVRVUVTVF9USU1FT1VUKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHRoaXMuY3NlcSsrO1xuICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdC5jc2VxID0gdGhpcy5jc2VxO1xuICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdC5zZXRIZWFkZXIoJ2NzZXEnLCB0aGlzLmNzZXEgKyAnIFJFR0lTVEVSJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0LmV4dHJhSGVhZGVycyA9IGV4dHJhSGVhZGVycztcbiAgICAgICAgICAgICAgICB0aGlzLnNlbmQoKTtcbiAgICAgICAgICAgIH0gfSxcbiAgICAgICAgdW5yZWdpc3RlcmVkOiB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogZnVuY3Rpb24gdW5yZWdpc3RlcmVkKHJlc3BvbnNlLCBjYXVzZSkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVnaXN0ZXJlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgndW5yZWdpc3RlcmVkJywgcmVzcG9uc2UgfHwgbnVsbCwgY2F1c2UgfHwgbnVsbCk7XG4gICAgICAgICAgICB9IH1cbiAgICB9KTtcbiAgICBTSVAuUmVnaXN0ZXJDb250ZXh0ID0gUmVnaXN0ZXJDb250ZXh0O1xufTtcblxuXG4vKioqLyB9KSxcbi8qIDIwICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblwidXNlIHN0cmljdFwiO1xuXG4vKiBlc2xpbnQtZGlzYWJsZSAqL1xuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IFNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJcbiAqL1xuLyogU2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlclxuICogQGNsYXNzIFBlZXJDb25uZWN0aW9uIGhlbHBlciBDbGFzcy5cbiAqIEBwYXJhbSB7U0lQLlNlc3Npb259IHNlc3Npb25cbiAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoRXZlbnRFbWl0dGVyKSB7XG4gICAgdmFyIFNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIgPSBmdW5jdGlvbiAoKSB7IH07XG4gICAgU2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEV2ZW50RW1pdHRlci5wcm90b3R5cGUsIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIERlc3RydWN0b3JcbiAgICAgICAgICovXG4gICAgICAgIGNsb3NlOiB7IHZhbHVlOiBmdW5jdGlvbiBjbG9zZSgpIHsgfSB9LFxuICAgICAgICAvKipcbiAgICAgICAgICogR2V0cyB0aGUgbG9jYWwgZGVzY3JpcHRpb24gZnJvbSB0aGUgdW5kZXJseWluZyBtZWRpYSBpbXBsZW1lbnRhdGlvblxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdIE9wdGlvbnMgb2JqZWN0IHRvIGJlIHVzZWQgYnkgZ2V0RGVzY3JpcHRpb25cbiAgICAgICAgICogQHBhcmFtIHtBcnJheX0gW21vZGlmaWVyc10gQXJyYXkgd2l0aCBvbmUgdGltZSB1c2UgZGVzY3JpcHRpb24gbW9kaWZpZXJzXG4gICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlfSBQcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2l0aCB0aGUgbG9jYWwgZGVzY3JpcHRpb24gdG8gYmUgdXNlZCBmb3IgdGhlIHNlc3Npb25cbiAgICAgICAgICovXG4gICAgICAgIGdldERlc2NyaXB0aW9uOiB7IHZhbHVlOiBmdW5jdGlvbiBnZXREZXNjcmlwdGlvbihvcHRpb25zLCBtb2RpZmllcnMpIHsgfSB9LFxuICAgICAgICAvKipcbiAgICAgICAgICogQ2hlY2sgaWYgdGhlIFNlc3Npb24gRGVzY3JpcHRpb24gSGFuZGxlciBjYW4gaGFuZGxlIHRoZSBDb250ZW50LVR5cGUgZGVzY3JpYmVkIGJ5IGEgU0lQIE1lc3NhZ2VcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNvbnRlbnRUeXBlIFRoZSBjb250ZW50IHR5cGUgdGhhdCBpcyBpbiB0aGUgU0lQIE1lc3NhZ2VcbiAgICAgICAgICogQHJldHVybnMge2Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICBoYXNEZXNjcmlwdGlvbjogeyB2YWx1ZTogZnVuY3Rpb24gaGFzU2Vzc2lvbkRlc2NyaXB0aW9uKGNvbnRlbnRUeXBlKSB7IH0gfSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBtb2RpZmllciB0aGF0IHNob3VsZCBiZSB1c2VkIHdoZW4gdGhlIHNlc3Npb24gd291bGQgbGlrZSB0byBwbGFjZSB0aGUgY2FsbCBvbiBob2xkXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbc2RwXSBUaGUgZGVzY3JpcHRpb24gdGhhdCB3aWxsIGJlIG1vZGlmaWVkXG4gICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlfSBQcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2l0aCBtb2RpZmllZCBTRFBcbiAgICAgICAgICovXG4gICAgICAgIGhvbGRNb2RpZmllcjogeyB2YWx1ZTogZnVuY3Rpb24gaG9sZE1vZGlmaWVyKHNkcCkgeyB9IH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXQgdGhlIHJlbW90ZSBkZXNjcmlwdGlvbiB0byB0aGUgdW5kZXJseWluZyBtZWRpYSBpbXBsZW1lbnRhdGlvblxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gc2Vzc2lvbkRlc2NyaXB0aW9uIFRoZSBkZXNjcmlwdGlvbiBwcm92aWRlZCBieSBhIFNJUCBtZXNzYWdlIHRvIGJlIHNldCBvbiB0aGUgbWVkaWEgaW1wbGVtZW50YXRpb25cbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSBPcHRpb25zIG9iamVjdCB0byBiZSB1c2VkIGJ5IHNldERlc2NyaXB0aW9uXG4gICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IFttb2RpZmllcnNdIEFycmF5IHdpdGggb25lIHRpbWUgdXNlIGRlc2NyaXB0aW9uIG1vZGlmaWVyc1xuICAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX0gUHJvbWlzZSB0aGF0IHJlc29sdmVzIG9uY2UgdGhlIGRlc2NyaXB0aW9uIGlzIHNldFxuICAgICAgICAgKi9cbiAgICAgICAgc2V0RGVzY3JpcHRpb246IHsgdmFsdWU6IGZ1bmN0aW9uIHNldERlc2NyaXB0aW9uKHNlc3Npb25EZXNjcmlwdGlvbiwgb3B0aW9ucywgbW9kaWZpZXJzKSB7IH0gfSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNlbmQgRFRNRiB2aWEgUlRQIChSRkMgNDczMylcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHRvbmVzIEEgc3RyaW5nIGNvbnRhaW5pbmcgRFRNRiBkaWdpdHNcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSBPcHRpb25zIG9iamVjdCB0byBiZSB1c2VkIGJ5IHNlbmREdG1mXG4gICAgICAgICAqIEByZXR1cm5zIHtib29sZWFufSB0cnVlIGlmIERUTUYgc2VuZCBpcyBzdWNjZXNzZnVsLCBmYWxzZSBvdGhlcndpc2VcbiAgICAgICAgICovXG4gICAgICAgIHNlbmREdG1mOiB7IHZhbHVlOiBmdW5jdGlvbiBzZW5kRHRtZih0b25lcywgb3B0aW9ucykgeyB9IH0sXG4gICAgICAgIC8qKlxuICAgICAgICAqIEdldCB0aGUgZGlyZWN0aW9uIG9mIHRoZSBzZXNzaW9uIGRlc2NyaXB0aW9uXG4gICAgICAgICogQHJldHVybnMge1N0cmluZ30gZGlyZWN0aW9uIG9mIHRoZSBkZXNjcmlwdGlvblxuICAgICAgICAqL1xuICAgICAgICBnZXREaXJlY3Rpb246IHsgdmFsdWU6IGZ1bmN0aW9uIGdldERpcmVjdGlvbigpIHsgfSB9LFxuICAgIH0pO1xuICAgIHJldHVybiBTZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyO1xufTtcblxuXG4vKioqLyB9KSxcbi8qIDIxICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblwidXNlIHN0cmljdFwiO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChTSVApIHtcbiAgICB2YXIgQ2xpZW50Q29udGV4dDtcbiAgICBDbGllbnRDb250ZXh0ID0gZnVuY3Rpb24gKHVhLCBtZXRob2QsIHRhcmdldCwgb3B0aW9ucykge1xuICAgICAgICB2YXIgb3JpZ2luYWxUYXJnZXQgPSB0YXJnZXQ7XG4gICAgICAgIC8vIFZhbGlkYXRlIGFyZ3VtZW50c1xuICAgICAgICBpZiAodGFyZ2V0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ05vdCBlbm91Z2ggYXJndW1lbnRzJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy51YSA9IHVhO1xuICAgICAgICB0aGlzLmxvZ2dlciA9IHVhLmdldExvZ2dlcignc2lwLmNsaWVudGNvbnRleHQnKTtcbiAgICAgICAgdGhpcy5tZXRob2QgPSBtZXRob2Q7XG4gICAgICAgIHRhcmdldCA9IHVhLm5vcm1hbGl6ZVRhcmdldCh0YXJnZXQpO1xuICAgICAgICBpZiAoIXRhcmdldCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignSW52YWxpZCB0YXJnZXQ6ICcgKyBvcmlnaW5hbFRhcmdldCk7XG4gICAgICAgIH1cbiAgICAgICAgLyogT3B0aW9uc1xuICAgICAgICAgKiAtIGV4dHJhSGVhZGVyc1xuICAgICAgICAgKiAtIHBhcmFtc1xuICAgICAgICAgKiAtIGNvbnRlbnRUeXBlXG4gICAgICAgICAqIC0gYm9keVxuICAgICAgICAgKi9cbiAgICAgICAgb3B0aW9ucyA9IE9iamVjdC5jcmVhdGUob3B0aW9ucyB8fCBPYmplY3QucHJvdG90eXBlKTtcbiAgICAgICAgb3B0aW9ucy5leHRyYUhlYWRlcnMgPSAob3B0aW9ucy5leHRyYUhlYWRlcnMgfHwgW10pLnNsaWNlKCk7XG4gICAgICAgIC8vIEJ1aWxkIHRoZSByZXF1ZXN0XG4gICAgICAgIHRoaXMucmVxdWVzdCA9IG5ldyBTSVAuT3V0Z29pbmdSZXF1ZXN0KHRoaXMubWV0aG9kLCB0YXJnZXQsIHRoaXMudWEsIG9wdGlvbnMucGFyYW1zLCBvcHRpb25zLmV4dHJhSGVhZGVycyk7XG4gICAgICAgIGlmIChvcHRpb25zLmJvZHkpIHtcbiAgICAgICAgICAgIHRoaXMuYm9keSA9IHt9O1xuICAgICAgICAgICAgdGhpcy5ib2R5LmJvZHkgPSBvcHRpb25zLmJvZHk7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5jb250ZW50VHlwZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuYm9keS5jb250ZW50VHlwZSA9IG9wdGlvbnMuY29udGVudFR5cGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnJlcXVlc3QuYm9keSA9IHRoaXMuYm9keTtcbiAgICAgICAgfVxuICAgICAgICAvKiBTZXQgb3RoZXIgcHJvcGVydGllcyBmcm9tIHRoZSByZXF1ZXN0ICovXG4gICAgICAgIHRoaXMubG9jYWxJZGVudGl0eSA9IHRoaXMucmVxdWVzdC5mcm9tO1xuICAgICAgICB0aGlzLnJlbW90ZUlkZW50aXR5ID0gdGhpcy5yZXF1ZXN0LnRvO1xuICAgICAgICB0aGlzLmRhdGEgPSB7fTtcbiAgICB9O1xuICAgIENsaWVudENvbnRleHQucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShTSVAuRXZlbnRFbWl0dGVyLnByb3RvdHlwZSk7XG4gICAgQ2xpZW50Q29udGV4dC5wcm90b3R5cGUuc2VuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgKG5ldyBTSVAuUmVxdWVzdFNlbmRlcih0aGlzLCB0aGlzLnVhKSkuc2VuZCgpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIENsaWVudENvbnRleHQucHJvdG90eXBlLmNhbmNlbCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgICAgICBvcHRpb25zLmV4dHJhSGVhZGVycyA9IChvcHRpb25zLmV4dHJhSGVhZGVycyB8fCBbXSkuc2xpY2UoKTtcbiAgICAgICAgdmFyIGNhbmNlbF9yZWFzb24gPSBTSVAuVXRpbHMuZ2V0Q2FuY2VsUmVhc29uKG9wdGlvbnMuc3RhdHVzX2NvZGUsIG9wdGlvbnMucmVhc29uX3BocmFzZSk7XG4gICAgICAgIHRoaXMucmVxdWVzdC5jYW5jZWwoY2FuY2VsX3JlYXNvbiwgb3B0aW9ucy5leHRyYUhlYWRlcnMpO1xuICAgICAgICB0aGlzLmVtaXQoJ2NhbmNlbCcpO1xuICAgIH07XG4gICAgQ2xpZW50Q29udGV4dC5wcm90b3R5cGUucmVjZWl2ZVJlc3BvbnNlID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgIHZhciBjYXVzZSA9IFNJUC5VdGlscy5nZXRSZWFzb25QaHJhc2UocmVzcG9uc2Uuc3RhdHVzX2NvZGUpO1xuICAgICAgICBzd2l0Y2ggKHRydWUpIHtcbiAgICAgICAgICAgIGNhc2UgL14xWzAtOV17Mn0kLy50ZXN0KHJlc3BvbnNlLnN0YXR1c19jb2RlKTpcbiAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ3Byb2dyZXNzJywgcmVzcG9uc2UsIGNhdXNlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgL14yWzAtOV17Mn0kLy50ZXN0KHJlc3BvbnNlLnN0YXR1c19jb2RlKTpcbiAgICAgICAgICAgICAgICBpZiAodGhpcy51YS5hcHBsaWNhbnRzW3RoaXNdKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnVhLmFwcGxpY2FudHNbdGhpc107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgnYWNjZXB0ZWQnLCByZXNwb25zZSwgY2F1c2UpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBpZiAodGhpcy51YS5hcHBsaWNhbnRzW3RoaXNdKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnVhLmFwcGxpY2FudHNbdGhpc107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgncmVqZWN0ZWQnLCByZXNwb25zZSwgY2F1c2UpO1xuICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgnZmFpbGVkJywgcmVzcG9uc2UsIGNhdXNlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH07XG4gICAgQ2xpZW50Q29udGV4dC5wcm90b3R5cGUub25SZXF1ZXN0VGltZW91dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5lbWl0KCdmYWlsZWQnLCBudWxsLCBTSVAuQy5jYXVzZXMuUkVRVUVTVF9USU1FT1VUKTtcbiAgICB9O1xuICAgIENsaWVudENvbnRleHQucHJvdG90eXBlLm9uVHJhbnNwb3J0RXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuZW1pdCgnZmFpbGVkJywgbnVsbCwgU0lQLkMuY2F1c2VzLkNPTk5FQ1RJT05fRVJST1IpO1xuICAgIH07XG4gICAgU0lQLkNsaWVudENvbnRleHQgPSBDbGllbnRDb250ZXh0O1xufTtcblxuXG4vKioqLyB9KSxcbi8qIDIyICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblwidXNlIHN0cmljdFwiO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChTSVApIHtcbiAgICB2YXIgU2VydmVyQ29udGV4dDtcbiAgICBTZXJ2ZXJDb250ZXh0ID0gZnVuY3Rpb24gKHVhLCByZXF1ZXN0KSB7XG4gICAgICAgIHRoaXMudWEgPSB1YTtcbiAgICAgICAgdGhpcy5sb2dnZXIgPSB1YS5nZXRMb2dnZXIoJ3NpcC5zZXJ2ZXJjb250ZXh0Jyk7XG4gICAgICAgIHRoaXMucmVxdWVzdCA9IHJlcXVlc3Q7XG4gICAgICAgIGlmIChyZXF1ZXN0Lm1ldGhvZCA9PT0gU0lQLkMuSU5WSVRFKSB7XG4gICAgICAgICAgICB0aGlzLnRyYW5zYWN0aW9uID0gbmV3IFNJUC5UcmFuc2FjdGlvbnMuSW52aXRlU2VydmVyVHJhbnNhY3Rpb24ocmVxdWVzdCwgdWEpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvbiA9IG5ldyBTSVAuVHJhbnNhY3Rpb25zLk5vbkludml0ZVNlcnZlclRyYW5zYWN0aW9uKHJlcXVlc3QsIHVhKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVxdWVzdC5ib2R5KSB7XG4gICAgICAgICAgICB0aGlzLmJvZHkgPSByZXF1ZXN0LmJvZHk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJlcXVlc3QuaGFzSGVhZGVyKCdDb250ZW50LVR5cGUnKSkge1xuICAgICAgICAgICAgdGhpcy5jb250ZW50VHlwZSA9IHJlcXVlc3QuZ2V0SGVhZGVyKCdDb250ZW50LVR5cGUnKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm1ldGhvZCA9IHJlcXVlc3QubWV0aG9kO1xuICAgICAgICB0aGlzLmRhdGEgPSB7fTtcbiAgICAgICAgdGhpcy5sb2NhbElkZW50aXR5ID0gcmVxdWVzdC50bztcbiAgICAgICAgdGhpcy5yZW1vdGVJZGVudGl0eSA9IHJlcXVlc3QuZnJvbTtcbiAgICAgICAgaWYgKHJlcXVlc3QuaGFzSGVhZGVyKCdQLUFzc2VydGVkLUlkZW50aXR5JykpIHtcbiAgICAgICAgICAgIHRoaXMuYXNzZXJ0ZWRJZGVudGl0eSA9IG5ldyBTSVAuTmFtZUFkZHJIZWFkZXIucGFyc2UocmVxdWVzdC5nZXRIZWFkZXIoJ1AtQXNzZXJ0ZWQtSWRlbnRpdHknKSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFNlcnZlckNvbnRleHQucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShTSVAuRXZlbnRFbWl0dGVyLnByb3RvdHlwZSk7XG4gICAgU2VydmVyQ29udGV4dC5wcm90b3R5cGUucHJvZ3Jlc3MgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gT2JqZWN0LmNyZWF0ZShvcHRpb25zIHx8IE9iamVjdC5wcm90b3R5cGUpO1xuICAgICAgICBvcHRpb25zLnN0YXR1c0NvZGUgfHwgKG9wdGlvbnMuc3RhdHVzQ29kZSA9IDE4MCk7XG4gICAgICAgIG9wdGlvbnMubWluQ29kZSA9IDEwMDtcbiAgICAgICAgb3B0aW9ucy5tYXhDb2RlID0gMTk5O1xuICAgICAgICBvcHRpb25zLmV2ZW50cyA9IFsncHJvZ3Jlc3MnXTtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVwbHkob3B0aW9ucyk7XG4gICAgfTtcbiAgICBTZXJ2ZXJDb250ZXh0LnByb3RvdHlwZS5hY2NlcHQgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gT2JqZWN0LmNyZWF0ZShvcHRpb25zIHx8IE9iamVjdC5wcm90b3R5cGUpO1xuICAgICAgICBvcHRpb25zLnN0YXR1c0NvZGUgfHwgKG9wdGlvbnMuc3RhdHVzQ29kZSA9IDIwMCk7XG4gICAgICAgIG9wdGlvbnMubWluQ29kZSA9IDIwMDtcbiAgICAgICAgb3B0aW9ucy5tYXhDb2RlID0gMjk5O1xuICAgICAgICBvcHRpb25zLmV2ZW50cyA9IFsnYWNjZXB0ZWQnXTtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVwbHkob3B0aW9ucyk7XG4gICAgfTtcbiAgICBTZXJ2ZXJDb250ZXh0LnByb3RvdHlwZS5yZWplY3QgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gT2JqZWN0LmNyZWF0ZShvcHRpb25zIHx8IE9iamVjdC5wcm90b3R5cGUpO1xuICAgICAgICBvcHRpb25zLnN0YXR1c0NvZGUgfHwgKG9wdGlvbnMuc3RhdHVzQ29kZSA9IDQ4MCk7XG4gICAgICAgIG9wdGlvbnMubWluQ29kZSA9IDMwMDtcbiAgICAgICAgb3B0aW9ucy5tYXhDb2RlID0gNjk5O1xuICAgICAgICBvcHRpb25zLmV2ZW50cyA9IFsncmVqZWN0ZWQnLCAnZmFpbGVkJ107XG4gICAgICAgIHJldHVybiB0aGlzLnJlcGx5KG9wdGlvbnMpO1xuICAgIH07XG4gICAgU2VydmVyQ29udGV4dC5wcm90b3R5cGUucmVwbHkgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsgLy8gVGhpcyBpcyBva2F5LCBzbyBsb25nIGFzIHdlIHRyZWF0IG9wdGlvbnMgYXMgcmVhZC1vbmx5IGluIHRoaXMgbWV0aG9kXG4gICAgICAgIHZhciBzdGF0dXNDb2RlID0gb3B0aW9ucy5zdGF0dXNDb2RlIHx8IDEwMCwgbWluQ29kZSA9IG9wdGlvbnMubWluQ29kZSB8fCAxMDAsIG1heENvZGUgPSBvcHRpb25zLm1heENvZGUgfHwgNjk5LCByZWFzb25QaHJhc2UgPSBTSVAuVXRpbHMuZ2V0UmVhc29uUGhyYXNlKHN0YXR1c0NvZGUsIG9wdGlvbnMucmVhc29uUGhyYXNlKSwgZXh0cmFIZWFkZXJzID0gb3B0aW9ucy5leHRyYUhlYWRlcnMgfHwgW10sIGJvZHkgPSBvcHRpb25zLmJvZHksIGV2ZW50cyA9IG9wdGlvbnMuZXZlbnRzIHx8IFtdLCByZXNwb25zZTtcbiAgICAgICAgaWYgKHN0YXR1c0NvZGUgPCBtaW5Db2RlIHx8IHN0YXR1c0NvZGUgPiBtYXhDb2RlKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdJbnZhbGlkIHN0YXR1c0NvZGU6ICcgKyBzdGF0dXNDb2RlKTtcbiAgICAgICAgfVxuICAgICAgICByZXNwb25zZSA9IHRoaXMucmVxdWVzdC5yZXBseShzdGF0dXNDb2RlLCByZWFzb25QaHJhc2UsIGV4dHJhSGVhZGVycywgYm9keSk7XG4gICAgICAgIGV2ZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgdGhpcy5lbWl0KGV2ZW50LCByZXNwb25zZSwgcmVhc29uUGhyYXNlKTtcbiAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgU2VydmVyQ29udGV4dC5wcm90b3R5cGUub25SZXF1ZXN0VGltZW91dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5lbWl0KCdmYWlsZWQnLCBudWxsLCBTSVAuQy5jYXVzZXMuUkVRVUVTVF9USU1FT1VUKTtcbiAgICB9O1xuICAgIFNlcnZlckNvbnRleHQucHJvdG90eXBlLm9uVHJhbnNwb3J0RXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuZW1pdCgnZmFpbGVkJywgbnVsbCwgU0lQLkMuY2F1c2VzLkNPTk5FQ1RJT05fRVJST1IpO1xuICAgIH07XG4gICAgU0lQLlNlcnZlckNvbnRleHQgPSBTZXJ2ZXJDb250ZXh0O1xufTtcblxuXG4vKioqLyB9KSxcbi8qIDIzICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblwidXNlIHN0cmljdFwiO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChTSVApIHtcbiAgICB2YXIgRFRNRiA9IF9fd2VicGFja19yZXF1aXJlX18oMjQpKFNJUCk7XG4gICAgdmFyIFNlc3Npb24sIEludml0ZVNlcnZlckNvbnRleHQsIEludml0ZUNsaWVudENvbnRleHQsIFJlZmVyU2VydmVyQ29udGV4dCwgUmVmZXJDbGllbnRDb250ZXh0LCBDID0ge1xuICAgICAgICAvL1Nlc3Npb24gc3RhdGVzXG4gICAgICAgIFNUQVRVU19OVUxMOiAwLFxuICAgICAgICBTVEFUVVNfSU5WSVRFX1NFTlQ6IDEsXG4gICAgICAgIFNUQVRVU18xWFhfUkVDRUlWRUQ6IDIsXG4gICAgICAgIFNUQVRVU19JTlZJVEVfUkVDRUlWRUQ6IDMsXG4gICAgICAgIFNUQVRVU19XQUlUSU5HX0ZPUl9BTlNXRVI6IDQsXG4gICAgICAgIFNUQVRVU19BTlNXRVJFRDogNSxcbiAgICAgICAgU1RBVFVTX1dBSVRJTkdfRk9SX1BSQUNLOiA2LFxuICAgICAgICBTVEFUVVNfV0FJVElOR19GT1JfQUNLOiA3LFxuICAgICAgICBTVEFUVVNfQ0FOQ0VMRUQ6IDgsXG4gICAgICAgIFNUQVRVU19URVJNSU5BVEVEOiA5LFxuICAgICAgICBTVEFUVVNfQU5TV0VSRURfV0FJVElOR19GT1JfUFJBQ0s6IDEwLFxuICAgICAgICBTVEFUVVNfRUFSTFlfTUVESUE6IDExLFxuICAgICAgICBTVEFUVVNfQ09ORklSTUVEOiAxMlxuICAgIH07XG4gICAgLypcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9uIHJldHVybmluZyBTSVAuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlcn0gW3Nlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJGYWN0b3J5XVxuICAgICAqICAgICAgICAoU2VlIHRoZSBkb2N1bWVudGF0aW9uIGZvciB0aGUgc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlckZhY3RvcnkgYXJndW1lbnQgb2YgdGhlIFVBIGNvbnN0cnVjdG9yLilcbiAgICAgKi9cbiAgICBTZXNzaW9uID0gZnVuY3Rpb24gKHNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJGYWN0b3J5KSB7XG4gICAgICAgIHRoaXMuc3RhdHVzID0gQy5TVEFUVVNfTlVMTDtcbiAgICAgICAgdGhpcy5kaWFsb2cgPSBudWxsO1xuICAgICAgICB0aGlzLnBlbmRpbmdSZWludml0ZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmVhcmx5RGlhbG9ncyA9IHt9O1xuICAgICAgICBpZiAoIXNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJGYWN0b3J5KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgU0lQLkV4Y2VwdGlvbnMuU2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlck1pc3NpbmcoJ0Egc2Vzc2lvbiBkZXNjcmlwdGlvbiBoYW5kbGVyIGlzIHJlcXVpcmVkIGZvciB0aGUgc2Vzc2lvbiB0byBmdW5jdGlvbicpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlckZhY3RvcnkgPSBzZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyRmFjdG9yeTtcbiAgICAgICAgdGhpcy5oYXNPZmZlciA9IGZhbHNlO1xuICAgICAgICB0aGlzLmhhc0Fuc3dlciA9IGZhbHNlO1xuICAgICAgICAvLyBTZXNzaW9uIFRpbWVyc1xuICAgICAgICB0aGlzLnRpbWVycyA9IHtcbiAgICAgICAgICAgIGFja1RpbWVyOiBudWxsLFxuICAgICAgICAgICAgZXhwaXJlc1RpbWVyOiBudWxsLFxuICAgICAgICAgICAgaW52aXRlMnh4VGltZXI6IG51bGwsXG4gICAgICAgICAgICB1c2VyTm9BbnN3ZXJUaW1lcjogbnVsbCxcbiAgICAgICAgICAgIHJlbDF4eFRpbWVyOiBudWxsLFxuICAgICAgICAgICAgcHJhY2tUaW1lcjogbnVsbFxuICAgICAgICB9O1xuICAgICAgICAvLyBTZXNzaW9uIGluZm9cbiAgICAgICAgdGhpcy5zdGFydFRpbWUgPSBudWxsO1xuICAgICAgICB0aGlzLmVuZFRpbWUgPSBudWxsO1xuICAgICAgICB0aGlzLnRvbmVzID0gbnVsbDtcbiAgICAgICAgLy8gSG9sZCBzdGF0ZVxuICAgICAgICB0aGlzLmxvY2FsX2hvbGQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5lYXJseV9zZHAgPSBudWxsO1xuICAgICAgICB0aGlzLnJlbDEwMCA9IFNJUC5DLnN1cHBvcnRlZC5VTlNVUFBPUlRFRDtcbiAgICB9O1xuICAgIFNlc3Npb24ucHJvdG90eXBlID0ge1xuICAgICAgICBkdG1mOiBmdW5jdGlvbiAodG9uZXMsIG9wdGlvbnMpIHtcbiAgICAgICAgICAgIHZhciB0b25lLCBkdG1mcyA9IFtdLCBzZWxmID0gdGhpcywgZHRtZlR5cGUgPSB0aGlzLnVhLmNvbmZpZ3VyYXRpb24uZHRtZlR5cGU7XG4gICAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAgICAgICAgIGlmICh0b25lcyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignTm90IGVub3VnaCBhcmd1bWVudHMnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIENoZWNrIFNlc3Npb24gU3RhdHVzXG4gICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMgIT09IEMuU1RBVFVTX0NPTkZJUk1FRCAmJiB0aGlzLnN0YXR1cyAhPT0gQy5TVEFUVVNfV0FJVElOR19GT1JfQUNLKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNJUC5FeGNlcHRpb25zLkludmFsaWRTdGF0ZUVycm9yKHRoaXMuc3RhdHVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIENoZWNrIHRvbmVzXG4gICAgICAgICAgICBpZiAoKHR5cGVvZiB0b25lcyAhPT0gJ3N0cmluZycgJiYgdHlwZW9mIHRvbmVzICE9PSAnbnVtYmVyJykgfHwgIXRvbmVzLnRvU3RyaW5nKCkubWF0Y2goL15bMC05QS1EIyosXSskL2kpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignSW52YWxpZCB0b25lczogJyArIHRvbmVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBzZW5kRFRNRiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZHRtZiwgdGltZW91dDtcbiAgICAgICAgICAgICAgICBpZiAoc2VsZi5zdGF0dXMgPT09IEMuU1RBVFVTX1RFUk1JTkFURUQgfHwgIXNlbGYudG9uZXMgfHwgc2VsZi50b25lcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gU3RvcCBzZW5kaW5nIERUTUZcbiAgICAgICAgICAgICAgICAgICAgc2VsZi50b25lcyA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkdG1mID0gc2VsZi50b25lcy5zaGlmdCgpO1xuICAgICAgICAgICAgICAgIGlmICh0b25lID09PSAnLCcpIHtcbiAgICAgICAgICAgICAgICAgICAgdGltZW91dCA9IDIwMDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkdG1mLm9uKCdmYWlsZWQnLCBmdW5jdGlvbiAoKSB7IHNlbGYudG9uZXMgPSBudWxsOyB9KTtcbiAgICAgICAgICAgICAgICAgICAgZHRtZi5zZW5kKG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgICAgICB0aW1lb3V0ID0gZHRtZi5kdXJhdGlvbiArIGR0bWYuaW50ZXJUb25lR2FwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBTZXQgdGltZW91dCBmb3IgdGhlIG5leHQgdG9uZVxuICAgICAgICAgICAgICAgIFNJUC5UaW1lcnMuc2V0VGltZW91dChzZW5kRFRNRiwgdGltZW91dCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdG9uZXMgPSB0b25lcy50b1N0cmluZygpO1xuICAgICAgICAgICAgaWYgKGR0bWZUeXBlID09PSBTSVAuQy5kdG1mVHlwZS5SVFApIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VudCA9IHRoaXMuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlci5zZW5kRHRtZih0b25lcywgb3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgaWYgKCFzZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oXCJBdHRlbXB0IHRvIHVzZSBkdG1mVHlwZSAnUlRQJyBoYXMgZmFpbGVkLCBmYWxsaW5nIGJhY2sgdG8gSU5GTyBwYWNrZXQgbWV0aG9kXCIpO1xuICAgICAgICAgICAgICAgICAgICBkdG1mVHlwZSA9IFNJUC5DLmR0bWZUeXBlLklORk87XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGR0bWZUeXBlID09PSBTSVAuQy5kdG1mVHlwZS5JTkZPKSB7XG4gICAgICAgICAgICAgICAgdG9uZXMgPSB0b25lcy5zcGxpdCgnJyk7XG4gICAgICAgICAgICAgICAgd2hpbGUgKHRvbmVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZHRtZnMucHVzaChuZXcgRFRNRih0aGlzLCB0b25lcy5zaGlmdCgpLCBvcHRpb25zKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnRvbmVzKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRvbmVzIGFyZSBhbHJlYWR5IHF1ZXVlZCwganVzdCBhZGQgdG8gdGhlIHF1ZXVlXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudG9uZXMgPSB0aGlzLnRvbmVzLmNvbmNhdChkdG1mcyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnRvbmVzID0gZHRtZnM7XG4gICAgICAgICAgICAgICAgc2VuZERUTUYoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuICAgICAgICBieWU6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgICAgICBvcHRpb25zID0gT2JqZWN0LmNyZWF0ZShvcHRpb25zIHx8IE9iamVjdC5wcm90b3R5cGUpO1xuICAgICAgICAgICAgdmFyIHN0YXR1c0NvZGUgPSBvcHRpb25zLnN0YXR1c0NvZGU7XG4gICAgICAgICAgICAvLyBDaGVjayBTZXNzaW9uIFN0YXR1c1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzID09PSBDLlNUQVRVU19URVJNSU5BVEVEKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0Vycm9yOiBBdHRlbXB0ZWQgdG8gc2VuZCBCWUUgaW4gYSB0ZXJtaW5hdGVkIHNlc3Npb24uJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ3Rlcm1pbmF0aW5nIFNlc3Npb24nKTtcbiAgICAgICAgICAgIGlmIChzdGF0dXNDb2RlICYmIChzdGF0dXNDb2RlIDwgMjAwIHx8IHN0YXR1c0NvZGUgPj0gNzAwKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0ludmFsaWQgc3RhdHVzQ29kZTogJyArIHN0YXR1c0NvZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3B0aW9ucy5yZWNlaXZlUmVzcG9uc2UgPSBmdW5jdGlvbiAoKSB7IH07XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5cbiAgICAgICAgICAgICAgICBzZW5kUmVxdWVzdChTSVAuQy5CWUUsIG9wdGlvbnMpLlxuICAgICAgICAgICAgICAgIHRlcm1pbmF0ZWQoKTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVmZXI6IGZ1bmN0aW9uICh0YXJnZXQsIG9wdGlvbnMpIHtcbiAgICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgICAgICAgICAgLy8gQ2hlY2sgU2Vzc2lvbiBTdGF0dXNcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cyAhPT0gQy5TVEFUVVNfQ09ORklSTUVEKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNJUC5FeGNlcHRpb25zLkludmFsaWRTdGF0ZUVycm9yKHRoaXMuc3RhdHVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucmVmZXJDb250ZXh0ID0gbmV3IFNJUC5SZWZlckNsaWVudENvbnRleHQodGhpcy51YSwgdGhpcywgdGFyZ2V0LCBvcHRpb25zKTtcbiAgICAgICAgICAgIHRoaXMuZW1pdCgncmVmZXJSZXF1ZXN0ZWQnLCB0aGlzLnJlZmVyQ29udGV4dCk7XG4gICAgICAgICAgICB0aGlzLnJlZmVyQ29udGV4dC5yZWZlcihvcHRpb25zKTtcbiAgICAgICAgfSxcbiAgICAgICAgc2VuZFJlcXVlc3Q6IGZ1bmN0aW9uIChtZXRob2QsIG9wdGlvbnMpIHtcbiAgICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBuZXcgU0lQLk91dGdvaW5nUmVxdWVzdChtZXRob2QsIHRoaXMuZGlhbG9nLnJlbW90ZV90YXJnZXQsIHRoaXMudWEsIHtcbiAgICAgICAgICAgICAgICBjc2VxOiBvcHRpb25zLmNzZXEgfHwgKHRoaXMuZGlhbG9nLmxvY2FsX3NlcW51bSArPSAxKSxcbiAgICAgICAgICAgICAgICBjYWxsX2lkOiB0aGlzLmRpYWxvZy5pZC5jYWxsX2lkLFxuICAgICAgICAgICAgICAgIGZyb21fdXJpOiB0aGlzLmRpYWxvZy5sb2NhbF91cmksXG4gICAgICAgICAgICAgICAgZnJvbV90YWc6IHRoaXMuZGlhbG9nLmlkLmxvY2FsX3RhZyxcbiAgICAgICAgICAgICAgICB0b191cmk6IHRoaXMuZGlhbG9nLnJlbW90ZV91cmksXG4gICAgICAgICAgICAgICAgdG9fdGFnOiB0aGlzLmRpYWxvZy5pZC5yZW1vdGVfdGFnLFxuICAgICAgICAgICAgICAgIHJvdXRlX3NldDogdGhpcy5kaWFsb2cucm91dGVfc2V0LFxuICAgICAgICAgICAgICAgIHN0YXR1c0NvZGU6IG9wdGlvbnMuc3RhdHVzQ29kZSxcbiAgICAgICAgICAgICAgICByZWFzb25QaHJhc2U6IG9wdGlvbnMucmVhc29uUGhyYXNlXG4gICAgICAgICAgICB9LCBvcHRpb25zLmV4dHJhSGVhZGVycyB8fCBbXSwgb3B0aW9ucy5ib2R5KTtcbiAgICAgICAgICAgIG5ldyBTSVAuUmVxdWVzdFNlbmRlcih7XG4gICAgICAgICAgICAgICAgcmVxdWVzdDogcmVxdWVzdCxcbiAgICAgICAgICAgICAgICBvblJlcXVlc3RUaW1lb3V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYub25SZXF1ZXN0VGltZW91dCgpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25UcmFuc3BvcnRFcnJvcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLm9uVHJhbnNwb3J0RXJyb3IoKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHJlY2VpdmVSZXNwb25zZTogb3B0aW9ucy5yZWNlaXZlUmVzcG9uc2UgfHwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYucmVjZWl2ZU5vbkludml0ZVJlc3BvbnNlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB0aGlzLnVhKS5zZW5kKCk7XG4gICAgICAgICAgICAvLyBFbWl0IHRoZSByZXF1ZXN0IGV2ZW50XG4gICAgICAgICAgICB0aGlzLmVtaXQobWV0aG9kLnRvTG93ZXJDYXNlKCksIHJlcXVlc3QpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG4gICAgICAgIGNsb3NlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgaWR4O1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzID09PSBDLlNUQVRVU19URVJNSU5BVEVEKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ2Nsb3NpbmcgSU5WSVRFIHNlc3Npb24gJyArIHRoaXMuaWQpO1xuICAgICAgICAgICAgLy8gMXN0IFN0ZXAuIFRlcm1pbmF0ZSBtZWRpYS5cbiAgICAgICAgICAgIGlmICh0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIuY2xvc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIDJuZCBTdGVwLiBUZXJtaW5hdGUgc2lnbmFsaW5nLlxuICAgICAgICAgICAgLy8gQ2xlYXIgc2Vzc2lvbiB0aW1lcnNcbiAgICAgICAgICAgIGZvciAoaWR4IGluIHRoaXMudGltZXJzKSB7XG4gICAgICAgICAgICAgICAgU0lQLlRpbWVycy5jbGVhclRpbWVvdXQodGhpcy50aW1lcnNbaWR4XSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBUZXJtaW5hdGUgZGlhbG9nc1xuICAgICAgICAgICAgLy8gVGVybWluYXRlIGNvbmZpcm1lZCBkaWFsb2dcbiAgICAgICAgICAgIGlmICh0aGlzLmRpYWxvZykge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlhbG9nLnRlcm1pbmF0ZSgpO1xuICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmRpYWxvZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFRlcm1pbmF0ZSBlYXJseSBkaWFsb2dzXG4gICAgICAgICAgICBmb3IgKGlkeCBpbiB0aGlzLmVhcmx5RGlhbG9ncykge1xuICAgICAgICAgICAgICAgIHRoaXMuZWFybHlEaWFsb2dzW2lkeF0udGVybWluYXRlKCk7XG4gICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuZWFybHlEaWFsb2dzW2lkeF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnN0YXR1cyA9IEMuU1RBVFVTX1RFUk1JTkFURUQ7XG4gICAgICAgICAgICB0aGlzLnVhLnRyYW5zcG9ydC5yZW1vdmVMaXN0ZW5lcihcInRyYW5zcG9ydEVycm9yXCIsIHRoaXMuZXJyb3JMaXN0ZW5lcik7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy51YS5zZXNzaW9uc1t0aGlzLmlkXTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuICAgICAgICBjcmVhdGVEaWFsb2c6IGZ1bmN0aW9uIChtZXNzYWdlLCB0eXBlLCBlYXJseSkge1xuICAgICAgICAgICAgdmFyIGRpYWxvZywgZWFybHlfZGlhbG9nLCBsb2NhbF90YWcgPSBtZXNzYWdlWyh0eXBlID09PSAnVUFTJykgPyAndG9fdGFnJyA6ICdmcm9tX3RhZyddLCByZW1vdGVfdGFnID0gbWVzc2FnZVsodHlwZSA9PT0gJ1VBUycpID8gJ2Zyb21fdGFnJyA6ICd0b190YWcnXSwgaWQgPSBtZXNzYWdlLmNhbGxfaWQgKyBsb2NhbF90YWcgKyByZW1vdGVfdGFnO1xuICAgICAgICAgICAgZWFybHlfZGlhbG9nID0gdGhpcy5lYXJseURpYWxvZ3NbaWRdO1xuICAgICAgICAgICAgLy8gRWFybHkgRGlhbG9nXG4gICAgICAgICAgICBpZiAoZWFybHkpIHtcbiAgICAgICAgICAgICAgICBpZiAoZWFybHlfZGlhbG9nKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZWFybHlfZGlhbG9nID0gbmV3IFNJUC5EaWFsb2codGhpcywgbWVzc2FnZSwgdHlwZSwgU0lQLkRpYWxvZy5DLlNUQVRVU19FQVJMWSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIERpYWxvZyBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgY3JlYXRlZC5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGVhcmx5X2RpYWxvZy5lcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoZWFybHlfZGlhbG9nLmVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmFpbGVkKG1lc3NhZ2UsIFNJUC5DLmNhdXNlcy5JTlRFUk5BTF9FUlJPUik7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVhcmx5RGlhbG9nc1tpZF0gPSBlYXJseV9kaWFsb2c7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIENvbmZpcm1lZCBEaWFsb2dcbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIEluIGNhc2UgdGhlIGRpYWxvZyBpcyBpbiBfZWFybHlfIHN0YXRlLCB1cGRhdGUgaXRcbiAgICAgICAgICAgICAgICBpZiAoZWFybHlfZGlhbG9nKSB7XG4gICAgICAgICAgICAgICAgICAgIGVhcmx5X2RpYWxvZy51cGRhdGUobWVzc2FnZSwgdHlwZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlhbG9nID0gZWFybHlfZGlhbG9nO1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5lYXJseURpYWxvZ3NbaWRdO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBkaWEgaW4gdGhpcy5lYXJseURpYWxvZ3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZWFybHlEaWFsb2dzW2RpYV0udGVybWluYXRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5lYXJseURpYWxvZ3NbZGlhXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCBjcmVhdGUgYSBfY29uZmlybWVkXyBkaWFsb2dcbiAgICAgICAgICAgICAgICBkaWFsb2cgPSBuZXcgU0lQLkRpYWxvZyh0aGlzLCBtZXNzYWdlLCB0eXBlKTtcbiAgICAgICAgICAgICAgICBpZiAoZGlhbG9nLmVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmVycm9yKGRpYWxvZy5lcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmFpbGVkKG1lc3NhZ2UsIFNJUC5DLmNhdXNlcy5JTlRFUk5BTF9FUlJPUik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudG9fdGFnID0gbWVzc2FnZS50b190YWc7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlhbG9nID0gZGlhbG9nO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIb2xkXG4gICAgICAgICAqL1xuICAgICAgICBob2xkOiBmdW5jdGlvbiAob3B0aW9ucywgbW9kaWZpZXJzKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMgIT09IEMuU1RBVFVTX1dBSVRJTkdfRk9SX0FDSyAmJiB0aGlzLnN0YXR1cyAhPT0gQy5TVEFUVVNfQ09ORklSTUVEKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNJUC5FeGNlcHRpb25zLkludmFsaWRTdGF0ZUVycm9yKHRoaXMuc3RhdHVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmxvY2FsX2hvbGQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ1Nlc3Npb24gaXMgYWxyZWFkeSBvbiBob2xkLCBjYW5ub3QgcHV0IGl0IG9uIGhvbGQgYWdhaW4nKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAgICAgICAgIG9wdGlvbnMubW9kaWZpZXJzID0gbW9kaWZpZXJzIHx8IFtdO1xuICAgICAgICAgICAgb3B0aW9ucy5tb2RpZmllcnMucHVzaCh0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIuaG9sZE1vZGlmaWVyKTtcbiAgICAgICAgICAgIHRoaXMubG9jYWxfaG9sZCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnNlbmRSZWludml0ZShvcHRpb25zKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVuaG9sZFxuICAgICAgICAgKi9cbiAgICAgICAgdW5ob2xkOiBmdW5jdGlvbiAob3B0aW9ucywgbW9kaWZpZXJzKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMgIT09IEMuU1RBVFVTX1dBSVRJTkdfRk9SX0FDSyAmJiB0aGlzLnN0YXR1cyAhPT0gQy5TVEFUVVNfQ09ORklSTUVEKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNJUC5FeGNlcHRpb25zLkludmFsaWRTdGF0ZUVycm9yKHRoaXMuc3RhdHVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghdGhpcy5sb2NhbF9ob2xkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKCdTZXNzaW9uIGlzIG5vdCBvbiBob2xkLCBjYW5ub3QgdW5ob2xkIGl0Jyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgICAgICAgICBpZiAobW9kaWZpZXJzKSB7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5tb2RpZmllcnMgPSBtb2RpZmllcnM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmxvY2FsX2hvbGQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuc2VuZFJlaW52aXRlKG9wdGlvbnMpO1xuICAgICAgICB9LFxuICAgICAgICByZWludml0ZTogZnVuY3Rpb24gKG9wdGlvbnMsIG1vZGlmaWVycykge1xuICAgICAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgICAgICAgICBpZiAobW9kaWZpZXJzKSB7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5tb2RpZmllcnMgPSBtb2RpZmllcnM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zZW5kUmVpbnZpdGUob3B0aW9ucyk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbiBkaWFsb2cgSU5WSVRFIFJlY2VwdGlvblxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgcmVjZWl2ZVJlaW52aXRlOiBmdW5jdGlvbiAocmVxdWVzdCkge1xuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzLCBwcm9taXNlO1xuICAgICAgICAgICAgLy8gVE9ETzogU2hvdWxkIHByb2JhYmx5IGNoZWNrIHN0YXRlIG9mIHRoZSBzZXNzaW9uXG4gICAgICAgICAgICBzZWxmLmVtaXQoJ3JlaW52aXRlJywgdGhpcyk7XG4gICAgICAgICAgICBpZiAocmVxdWVzdC5oYXNIZWFkZXIoJ1AtQXNzZXJ0ZWQtSWRlbnRpdHknKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuYXNzZXJ0ZWRJZGVudGl0eSA9IG5ldyBTSVAuTmFtZUFkZHJIZWFkZXIucGFyc2UocmVxdWVzdC5nZXRIZWFkZXIoJ1AtQXNzZXJ0ZWQtSWRlbnRpdHknKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBJbnZpdGUgdy9vIFNEUFxuICAgICAgICAgICAgaWYgKHJlcXVlc3QuZ2V0SGVhZGVyKCdDb250ZW50LUxlbmd0aCcpID09PSAnMCcgJiYgIXJlcXVlc3QuZ2V0SGVhZGVyKCdDb250ZW50LVR5cGUnKSkge1xuICAgICAgICAgICAgICAgIHByb21pc2UgPSB0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIuZ2V0RGVzY3JpcHRpb24odGhpcy5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyT3B0aW9ucywgdGhpcy5tb2RpZmllcnMpO1xuICAgICAgICAgICAgICAgIC8vIEludml0ZSB3LyBTRFBcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlci5oYXNEZXNjcmlwdGlvbihyZXF1ZXN0LmdldEhlYWRlcignQ29udGVudC1UeXBlJykpKSB7XG4gICAgICAgICAgICAgICAgcHJvbWlzZSA9IHRoaXMuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlci5zZXREZXNjcmlwdGlvbihyZXF1ZXN0LmJvZHksIHRoaXMuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlck9wdGlvbnMsIHRoaXMubW9kaWZpZXJzKVxuICAgICAgICAgICAgICAgICAgICAudGhlbih0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIuZ2V0RGVzY3JpcHRpb24uYmluZCh0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIsIHRoaXMuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlck9wdGlvbnMsIHRoaXMubW9kaWZpZXJzKSk7XG4gICAgICAgICAgICAgICAgLy8gQmFkIFBhY2tldCAoc2hvdWxkIG5ldmVyIGdldCBoaXQpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXF1ZXN0LnJlcGx5KDQxNSk7XG4gICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdyZWludml0ZUZhaWxlZCcsIHNlbGYpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucmVjZWl2ZVJlcXVlc3QgPSBmdW5jdGlvbiAocmVxdWVzdCkge1xuICAgICAgICAgICAgICAgIGlmIChyZXF1ZXN0Lm1ldGhvZCA9PT0gU0lQLkMuQUNLICYmIHRoaXMuc3RhdHVzID09PSBDLlNUQVRVU19XQUlUSU5HX0ZPUl9BQ0spIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlci5oYXNEZXNjcmlwdGlvbihyZXF1ZXN0LmdldEhlYWRlcignQ29udGVudC1UeXBlJykpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhhc0Fuc3dlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIuc2V0RGVzY3JpcHRpb24ocmVxdWVzdC5ib2R5LCB0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJPcHRpb25zLCB0aGlzLm1vZGlmaWVycylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgU0lQLlRpbWVycy5jbGVhclRpbWVvdXQodGhpcy50aW1lcnMuYWNrVGltZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNJUC5UaW1lcnMuY2xlYXJUaW1lb3V0KHRoaXMudGltZXJzLmludml0ZTJ4eFRpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXR1cyA9IEMuU1RBVFVTX0NPTkZJUk1FRDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ2NvbmZpcm1lZCcsIHJlcXVlc3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFNJUC5UaW1lcnMuY2xlYXJUaW1lb3V0KHRoaXMudGltZXJzLmFja1RpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIFNJUC5UaW1lcnMuY2xlYXJUaW1lb3V0KHRoaXMudGltZXJzLmludml0ZTJ4eFRpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gQy5TVEFUVVNfQ09ORklSTUVEO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdjb25maXJtZWQnLCByZXF1ZXN0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgU0lQLlNlc3Npb24ucHJvdG90eXBlLnJlY2VpdmVSZXF1ZXN0LmFwcGx5KHRoaXMsIFtyZXF1ZXN0XSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfS5iaW5kKHRoaXMpO1xuICAgICAgICAgICAgcHJvbWlzZS5jYXRjaChmdW5jdGlvbiBvbkZhaWx1cmUoZSkge1xuICAgICAgICAgICAgICAgIHZhciBzdGF0dXNDb2RlO1xuICAgICAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgU0lQLkV4Y2VwdGlvbnMuU2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlckVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXR1c0NvZGUgPSA1MDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGUgaW5zdGFuY2VvZiBTSVAuRXhjZXB0aW9ucy5SZW5lZ290aWF0aW9uRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5lbWl0KCdyZW5lZ290aWF0aW9uRXJyb3InLCBlKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybihlKTtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZSA9IDQ4ODtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGUpO1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXNDb2RlID0gNDg4O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXF1ZXN0LnJlcGx5KHN0YXR1c0NvZGUpO1xuICAgICAgICAgICAgICAgIHNlbGYuZW1pdCgncmVpbnZpdGVGYWlsZWQnLCBzZWxmKTtcbiAgICAgICAgICAgICAgICAvLyBUT0RPOiBUaGlzIGNvdWxkIGJlIGJldHRlclxuICAgICAgICAgICAgICAgIHRocm93IGU7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkZXNjcmlwdGlvbikge1xuICAgICAgICAgICAgICAgIHZhciBleHRyYUhlYWRlcnMgPSBbJ0NvbnRhY3Q6ICcgKyBzZWxmLmNvbnRhY3RdO1xuICAgICAgICAgICAgICAgIHJlcXVlc3QucmVwbHkoMjAwLCBudWxsLCBleHRyYUhlYWRlcnMsIGRlc2NyaXB0aW9uLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuc3RhdHVzID0gQy5TVEFUVVNfV0FJVElOR19GT1JfQUNLO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnNldEFDS1RpbWVyKCk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuZW1pdCgncmVpbnZpdGVBY2NlcHRlZCcsIHNlbGYpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHNlbmRSZWludml0ZTogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnBlbmRpbmdSZWludml0ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ1JlaW52aXRlIGluIHByb2dyZXNzLiBQbGVhc2Ugd2FpdCB1bnRpbCBjb21wbGV0ZSwgdGhlbiB0cnkgYWdhaW4uJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5wZW5kaW5nUmVpbnZpdGUgPSB0cnVlO1xuICAgICAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgICAgICAgICBvcHRpb25zLm1vZGlmaWVycyA9IG9wdGlvbnMubW9kaWZpZXJzIHx8IFtdO1xuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzLCBleHRyYUhlYWRlcnMgPSAob3B0aW9ucy5leHRyYUhlYWRlcnMgfHwgW10pLnNsaWNlKCk7XG4gICAgICAgICAgICBleHRyYUhlYWRlcnMucHVzaCgnQ29udGFjdDogJyArIHRoaXMuY29udGFjdCk7XG4gICAgICAgICAgICBleHRyYUhlYWRlcnMucHVzaCgnQWxsb3c6ICcgKyBTSVAuVUEuQy5BTExPV0VEX01FVEhPRFMudG9TdHJpbmcoKSk7XG4gICAgICAgICAgICB0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIuZ2V0RGVzY3JpcHRpb24ob3B0aW9ucy5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyT3B0aW9ucywgb3B0aW9ucy5tb2RpZmllcnMpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRlc2NyaXB0aW9uKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5zZW5kUmVxdWVzdChTSVAuQy5JTlZJVEUsIHtcbiAgICAgICAgICAgICAgICAgICAgZXh0cmFIZWFkZXJzOiBleHRyYUhlYWRlcnMsXG4gICAgICAgICAgICAgICAgICAgIGJvZHk6IGRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICByZWNlaXZlUmVzcG9uc2U6IHNlbGYucmVjZWl2ZVJlaW52aXRlUmVzcG9uc2UuYmluZChzZWxmKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gb25GYWlsdXJlKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIFNJUC5FeGNlcHRpb25zLlJlbmVnb3RpYXRpb25FcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnBlbmRpbmdSZWludml0ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmVtaXQoJ3JlbmVnb3RpYXRpb25FcnJvcicsIGUpO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuKCdSZW5lZ290aWF0aW9uIEVycm9yJyk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm4oZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoJ3Nlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIgZXJyb3InKTtcbiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICByZWNlaXZlUmVxdWVzdDogZnVuY3Rpb24gKHJlcXVlc3QpIHtcbiAgICAgICAgICAgIHN3aXRjaCAocmVxdWVzdC5tZXRob2QpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFNJUC5DLkJZRTpcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5yZXBseSgyMDApO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMgPT09IEMuU1RBVFVTX0NPTkZJUk1FRCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdieWUnLCByZXF1ZXN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGVybWluYXRlZChyZXF1ZXN0LCBTSVAuQy5jYXVzZXMuQllFKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFNJUC5DLklOVklURTpcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzID09PSBDLlNUQVRVU19DT05GSVJNRUQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZygncmUtSU5WSVRFIHJlY2VpdmVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlY2VpdmVSZWludml0ZShyZXF1ZXN0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFNJUC5DLklORk86XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cyA9PT0gQy5TVEFUVVNfQ09ORklSTUVEIHx8IHRoaXMuc3RhdHVzID09PSBDLlNUQVRVU19XQUlUSU5HX0ZPUl9BQ0spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9uSW5mbykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm9uSW5mbyhyZXF1ZXN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBib2R5LCB0b25lLCBkdXJhdGlvbiwgY29udGVudFR5cGUgPSByZXF1ZXN0LmdldEhlYWRlcignY29udGVudC10eXBlJyksIHJlZ190b25lID0gL14oU2lnbmFsXFxzKj89XFxzKj8pKFswLTlBLUQjKl17MX0pKFxccyk/LiovLCByZWdfZHVyYXRpb24gPSAvXihEdXJhdGlvblxccz89XFxzPykoWzAtOV17MSw0fSkoXFxzKT8uKi87XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29udGVudFR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29udGVudFR5cGUubWF0Y2goL15hcHBsaWNhdGlvblxcL2R0bWYtcmVsYXkvaSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcXVlc3QuYm9keSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9keSA9IHJlcXVlc3QuYm9keS5zcGxpdCgnXFxyXFxuJywgMik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYm9keS5sZW5ndGggPT09IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVnX3RvbmUudGVzdChib2R5WzBdKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b25lID0gYm9keVswXS5yZXBsYWNlKHJlZ190b25lLCBcIiQyXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVnX2R1cmF0aW9uLnRlc3QoYm9keVsxXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb24gPSBwYXJzZUludChib2R5WzFdLnJlcGxhY2UocmVnX2R1cmF0aW9uLCBcIiQyXCIpLCAxMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBEVE1GKHRoaXMsIHRvbmUsIHsgZHVyYXRpb246IGR1cmF0aW9uIH0pLmluaXRfaW5jb21pbmcocmVxdWVzdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnJlcGx5KDQxNSwgbnVsbCwgW1wiQWNjZXB0OiBhcHBsaWNhdGlvbi9kdG1mLXJlbGF5XCJdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBTSVAuQy5SRUZFUjpcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzID09PSBDLlNUQVRVU19DT05GSVJNRUQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZygnUkVGRVIgcmVjZWl2ZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVmZXJDb250ZXh0ID0gbmV3IFNJUC5SZWZlclNlcnZlckNvbnRleHQodGhpcy51YSwgcmVxdWVzdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaGFzUmVmZXJMaXN0ZW5lciA9IHRoaXMubGlzdGVuZXJzKCdyZWZlclJlcXVlc3RlZCcpLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYXNSZWZlckxpc3RlbmVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdyZWZlclJlcXVlc3RlZCcsIHRoaXMucmVmZXJDb250ZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZygnTm8gcmVmZXJSZXF1ZXN0ZWQgbGlzdGVuZXJzLCBhdXRvbWF0aWNhbGx5IGFjY2VwdGluZyBhbmQgZm9sbG93aW5nIHRoZSByZWZlcicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0geyBmb2xsb3dSZWZlcjogdHJ1ZSB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnBhc3NlZE9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5pbnZpdGVPcHRpb25zID0gdGhpcy5wYXNzZWRPcHRpb25zO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZmVyQ29udGV4dC5hY2NlcHQob3B0aW9ucywgdGhpcy5tb2RpZmllcnMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgU0lQLkMuTk9USUZZOlxuICAgICAgICAgICAgICAgICAgICBpZiAoKHRoaXMucmVmZXJDb250ZXh0ICYmIHRoaXMucmVmZXJDb250ZXh0IGluc3RhbmNlb2YgU0lQLlJlZmVyQ2xpZW50Q29udGV4dCkgJiYgcmVxdWVzdC5oYXNIZWFkZXIoJ2V2ZW50JykgJiYgL15yZWZlcig7LiopPyQvLnRlc3QocmVxdWVzdC5nZXRIZWFkZXIoJ2V2ZW50JykpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZmVyQ29udGV4dC5yZWNlaXZlTm90aWZ5KHJlcXVlc3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3QucmVwbHkoMjAwLCAnT0snKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdub3RpZnknLCByZXF1ZXN0KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZWNlcHRpb24gb2YgUmVzcG9uc2UgZm9yIGluLWRpYWxvZyBJTlZJVEVcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIHJlY2VpdmVSZWludml0ZVJlc3BvbnNlOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cyA9PT0gQy5TVEFUVVNfVEVSTUlOQVRFRCkge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdSZWNlaXZlZCByZWludml0ZSByZXNwb25zZSwgYnV0IGluIFNUQVRVU19URVJNSU5BVEVEJyk7XG4gICAgICAgICAgICAgICAgLy8gVE9ETzogRG8gd2UgbmVlZCB0byBzZW5kIGEgU0lQIHJlc3BvbnNlP1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghdGhpcy5wZW5kaW5nUmVpbnZpdGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5lcnJvcignUmVjZWl2ZWQgcmVpbnZpdGUgcmVzcG9uc2UsIGJ1dCBoYXZlIG5vIHBlbmRpbmcgcmVpbnZpdGUnKTtcbiAgICAgICAgICAgICAgICAvLyBUT0RPOiBEbyB3ZSBuZWVkIHRvIHNlbmQgYSBTSVAgcmVzcG9uc2U/XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3dpdGNoICh0cnVlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAvXjFbMC05XXsyfSQvLnRlc3QocmVzcG9uc2Uuc3RhdHVzX2NvZGUpOlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIC9eMlswLTldezJ9JC8udGVzdChyZXNwb25zZS5zdGF0dXNfY29kZSk6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gQy5TVEFUVVNfQ09ORklSTUVEO1xuICAgICAgICAgICAgICAgICAgICAvLyAxNy4xLjEuMSAtIEZvciBlYWNoIGZpbmFsIHJlc3BvbnNlIHRoYXQgaXMgcmVjZWl2ZWQgYXQgdGhlIGNsaWVudCB0cmFuc2FjdGlvbiwgdGhlIGNsaWVudCB0cmFuc2FjdGlvbiBzZW5kcyBhbiBBQ0ssXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdChcImFja1wiLCByZXNwb25zZS50cmFuc2FjdGlvbi5zZW5kQUNLKCkpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBlbmRpbmdSZWludml0ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBBbGwgb2YgdGhlc2UgdGltZXJzIHNob3VsZCBtb3ZlIGludG8gdGhlIFRyYW5zYWN0aW9uIGxheWVyXG4gICAgICAgICAgICAgICAgICAgIFNJUC5UaW1lcnMuY2xlYXJUaW1lb3V0KHNlbGYudGltZXJzLmludml0ZTJ4eFRpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIuaGFzRGVzY3JpcHRpb24ocmVzcG9uc2UuZ2V0SGVhZGVyKCdDb250ZW50LVR5cGUnKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCcyWFggcmVzcG9uc2UgcmVjZWl2ZWQgdG8gcmUtaW52aXRlIGJ1dCBkaWQgbm90IGhhdmUgYSBkZXNjcmlwdGlvbicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdyZWludml0ZUZhaWxlZCcsIHNlbGYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdyZW5lZ290aWF0aW9uRXJyb3InLCBuZXcgU0lQLkV4Y2VwdGlvbnMuUmVuZWdvdGlhdGlvbkVycm9yKCcyWFggcmVzcG9uc2UgcmVjZWl2ZWQgdG8gcmUtaW52aXRlIGJ1dCBkaWQgbm90IGhhdmUgYSBkZXNjcmlwdGlvbicpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlci5zZXREZXNjcmlwdGlvbihyZXNwb25zZS5ib2R5LCB0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJPcHRpb25zLCB0aGlzLm1vZGlmaWVycylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiBvbkZhaWx1cmUoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoJ0NvdWxkIG5vdCBzZXQgdGhlIGRlc2NyaXB0aW9uIGluIDJYWCByZXNwb25zZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmVtaXQoJ3JlaW52aXRlRmFpbGVkJywgc2VsZik7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmVtaXQoJ3JlbmVnb3RpYXRpb25FcnJvcicsIGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kUmVxdWVzdChTSVAuQy5CWUUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRyYUhlYWRlcnM6IFsnUmVhc29uOiAnICsgU0lQLlV0aWxzLmdldFJlYXNvbkhlYWRlclZhbHVlKDQ4OCwgJ05vdCBBY2NlcHRhYmxlIEhlcmUnKV1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50ZXJtaW5hdGVkKG51bGwsIFNJUC5DLmNhdXNlcy5JTkNPTVBBVElCTEVfU0RQKTtcbiAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmVtaXQoJ3JlaW52aXRlQWNjZXB0ZWQnLCBzZWxmKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGVuZGluZ1JlaW52aXRlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZygnUmVjZWl2ZWQgYSBub24gMVhYIG9yIDJYWCByZXNwb25zZSB0byBhIHJlLWludml0ZScpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ3JlaW52aXRlRmFpbGVkJywgc2VsZik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgncmVuZWdvdGlhdGlvbkVycm9yJywgbmV3IFNJUC5FeGNlcHRpb25zLlJlbmVnb3RpYXRpb25FcnJvcignSW52YWxpZCByZXNwb25zZSB0byBhIHJlLWludml0ZScpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgYWNjZXB0QW5kVGVybWluYXRlOiBmdW5jdGlvbiAocmVzcG9uc2UsIHN0YXR1c19jb2RlLCByZWFzb25fcGhyYXNlKSB7XG4gICAgICAgICAgICB2YXIgZXh0cmFIZWFkZXJzID0gW107XG4gICAgICAgICAgICBpZiAoc3RhdHVzX2NvZGUpIHtcbiAgICAgICAgICAgICAgICBleHRyYUhlYWRlcnMucHVzaCgnUmVhc29uOiAnICsgU0lQLlV0aWxzLmdldFJlYXNvbkhlYWRlclZhbHVlKHN0YXR1c19jb2RlLCByZWFzb25fcGhyYXNlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBBbiBlcnJvciBvbiBkaWFsb2cgY3JlYXRpb24gd2lsbCBmaXJlICdmYWlsZWQnIGV2ZW50XG4gICAgICAgICAgICBpZiAodGhpcy5kaWFsb2cgfHwgdGhpcy5jcmVhdGVEaWFsb2cocmVzcG9uc2UsICdVQUMnKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZW1pdChcImFja1wiLCByZXNwb25zZS50cmFuc2FjdGlvbi5zZW5kQUNLKCkpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2VuZFJlcXVlc3QoU0lQLkMuQllFLCB7XG4gICAgICAgICAgICAgICAgICAgIGV4dHJhSGVhZGVyczogZXh0cmFIZWFkZXJzXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJGQzMyNjEgMTMuMy4xLjRcbiAgICAgICAgICogUmVzcG9uc2UgcmV0cmFuc21pc3Npb25zIGNhbm5vdCBiZSBhY2NvbXBsaXNoZWQgYnkgdHJhbnNhY3Rpb24gbGF5ZXJcbiAgICAgICAgICogIHNpbmNlIGl0IGlzIGRlc3Ryb3llZCB3aGVuIHJlY2VpdmluZyB0aGUgZmlyc3QgMnh4IGFuc3dlclxuICAgICAgICAgKi9cbiAgICAgICAgc2V0SW52aXRlMnh4VGltZXI6IGZ1bmN0aW9uIChyZXF1ZXN0LCBkZXNjcmlwdGlvbikge1xuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzLCB0aW1lb3V0ID0gU0lQLlRpbWVycy5UMTtcbiAgICAgICAgICAgIHRoaXMudGltZXJzLmludml0ZTJ4eFRpbWVyID0gU0lQLlRpbWVycy5zZXRUaW1lb3V0KGZ1bmN0aW9uIGludml0ZTJ4eFJldHJhbnNtaXNzaW9uKCkge1xuICAgICAgICAgICAgICAgIGlmIChzZWxmLnN0YXR1cyAhPT0gQy5TVEFUVVNfV0FJVElOR19GT1JfQUNLKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKCdubyBBQ0sgcmVjZWl2ZWQsIGF0dGVtcHRpbmcgdG8gcmV0cmFuc21pdCBPSycpO1xuICAgICAgICAgICAgICAgIHZhciBleHRyYUhlYWRlcnMgPSBbJ0NvbnRhY3Q6ICcgKyBzZWxmLmNvbnRhY3RdO1xuICAgICAgICAgICAgICAgIHJlcXVlc3QucmVwbHkoMjAwLCBudWxsLCBleHRyYUhlYWRlcnMsIGRlc2NyaXB0aW9uKTtcbiAgICAgICAgICAgICAgICB0aW1lb3V0ID0gTWF0aC5taW4odGltZW91dCAqIDIsIFNJUC5UaW1lcnMuVDIpO1xuICAgICAgICAgICAgICAgIHNlbGYudGltZXJzLmludml0ZTJ4eFRpbWVyID0gU0lQLlRpbWVycy5zZXRUaW1lb3V0KGludml0ZTJ4eFJldHJhbnNtaXNzaW9uLCB0aW1lb3V0KTtcbiAgICAgICAgICAgIH0sIHRpbWVvdXQpO1xuICAgICAgICB9LFxuICAgICAgICAvKipcbiAgICAgICAgICogUkZDMzI2MSAxNC4yXG4gICAgICAgICAqIElmIGEgVUFTIGdlbmVyYXRlcyBhIDJ4eCByZXNwb25zZSBhbmQgbmV2ZXIgcmVjZWl2ZXMgYW4gQUNLLFxuICAgICAgICAgKiAgaXQgU0hPVUxEIGdlbmVyYXRlIGEgQllFIHRvIHRlcm1pbmF0ZSB0aGUgZGlhbG9nLlxuICAgICAgICAgKi9cbiAgICAgICAgc2V0QUNLVGltZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgIHRoaXMudGltZXJzLmFja1RpbWVyID0gU0lQLlRpbWVycy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2VsZi5zdGF0dXMgPT09IEMuU1RBVFVTX1dBSVRJTkdfRk9SX0FDSykge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coJ25vIEFDSyByZWNlaXZlZCBmb3IgYW4gZXh0ZW5kZWQgcGVyaW9kIG9mIHRpbWUsIHRlcm1pbmF0aW5nIHRoZSBjYWxsJyk7XG4gICAgICAgICAgICAgICAgICAgIFNJUC5UaW1lcnMuY2xlYXJUaW1lb3V0KHNlbGYudGltZXJzLmludml0ZTJ4eFRpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kUmVxdWVzdChTSVAuQy5CWUUpO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnRlcm1pbmF0ZWQobnVsbCwgU0lQLkMuY2F1c2VzLk5PX0FDSyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgU0lQLlRpbWVycy5USU1FUl9IKTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIG9uVHJhbnNwb3J0RXJyb3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cyAhPT0gQy5TVEFUVVNfQ09ORklSTUVEICYmIHRoaXMuc3RhdHVzICE9PSBDLlNUQVRVU19URVJNSU5BVEVEKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mYWlsZWQobnVsbCwgU0lQLkMuY2F1c2VzLkNPTk5FQ1RJT05fRVJST1IpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBvblJlcXVlc3RUaW1lb3V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMgPT09IEMuU1RBVFVTX0NPTkZJUk1FRCkge1xuICAgICAgICAgICAgICAgIHRoaXMudGVybWluYXRlZChudWxsLCBTSVAuQy5jYXVzZXMuUkVRVUVTVF9USU1FT1VUKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuc3RhdHVzICE9PSBDLlNUQVRVU19URVJNSU5BVEVEKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mYWlsZWQobnVsbCwgU0lQLkMuY2F1c2VzLlJFUVVFU1RfVElNRU9VVCk7XG4gICAgICAgICAgICAgICAgdGhpcy50ZXJtaW5hdGVkKG51bGwsIFNJUC5DLmNhdXNlcy5SRVFVRVNUX1RJTUVPVVQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBvbkRpYWxvZ0Vycm9yOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cyA9PT0gQy5TVEFUVVNfQ09ORklSTUVEKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50ZXJtaW5hdGVkKHJlc3BvbnNlLCBTSVAuQy5jYXVzZXMuRElBTE9HX0VSUk9SKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuc3RhdHVzICE9PSBDLlNUQVRVU19URVJNSU5BVEVEKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mYWlsZWQocmVzcG9uc2UsIFNJUC5DLmNhdXNlcy5ESUFMT0dfRVJST1IpO1xuICAgICAgICAgICAgICAgIHRoaXMudGVybWluYXRlZChyZXNwb25zZSwgU0lQLkMuY2F1c2VzLkRJQUxPR19FUlJPUik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgZmFpbGVkOiBmdW5jdGlvbiAocmVzcG9uc2UsIGNhdXNlKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMgPT09IEMuU1RBVFVTX1RFUk1JTkFURUQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZW1pdCgnZmFpbGVkJywgcmVzcG9uc2UgfHwgbnVsbCwgY2F1c2UgfHwgbnVsbCk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcbiAgICAgICAgcmVqZWN0ZWQ6IGZ1bmN0aW9uIChyZXNwb25zZSwgY2F1c2UpIHtcbiAgICAgICAgICAgIHRoaXMuZW1pdCgncmVqZWN0ZWQnLCByZXNwb25zZSB8fCBudWxsLCBjYXVzZSB8fCBudWxsKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuICAgICAgICBjYW5jZWxlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlcikge1xuICAgICAgICAgICAgICAgIHRoaXMuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlci5jbG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5lbWl0KCdjYW5jZWwnKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuICAgICAgICBhY2NlcHRlZDogZnVuY3Rpb24gKHJlc3BvbnNlLCBjYXVzZSkge1xuICAgICAgICAgICAgY2F1c2UgPSBTSVAuVXRpbHMuZ2V0UmVhc29uUGhyYXNlKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1c19jb2RlLCBjYXVzZSk7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICBpZiAodGhpcy5yZXBsYWNlZSkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVwbGFjZWUuZW1pdCgncmVwbGFjZWQnLCB0aGlzKTtcbiAgICAgICAgICAgICAgICB0aGlzLnJlcGxhY2VlLnRlcm1pbmF0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5lbWl0KCdhY2NlcHRlZCcsIHJlc3BvbnNlLCBjYXVzZSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcbiAgICAgICAgdGVybWluYXRlZDogZnVuY3Rpb24gKG1lc3NhZ2UsIGNhdXNlKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMgPT09IEMuU1RBVFVTX1RFUk1JTkFURUQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZW5kVGltZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICB0aGlzLmVtaXQoJ3Rlcm1pbmF0ZWQnLCBtZXNzYWdlIHx8IG51bGwsIGNhdXNlIHx8IG51bGwpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG4gICAgICAgIGNvbm5lY3Rpbmc6IGZ1bmN0aW9uIChyZXF1ZXN0KSB7XG4gICAgICAgICAgICB0aGlzLmVtaXQoJ2Nvbm5lY3RpbmcnLCB7IHJlcXVlc3Q6IHJlcXVlc3QgfSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgIH07XG4gICAgU2Vzc2lvbi5DID0gQztcbiAgICBTSVAuU2Vzc2lvbiA9IFNlc3Npb247XG4gICAgSW52aXRlU2VydmVyQ29udGV4dCA9IGZ1bmN0aW9uICh1YSwgcmVxdWVzdCkge1xuICAgICAgICB2YXIgZXhwaXJlcywgc2VsZiA9IHRoaXMsIGNvbnRlbnRUeXBlID0gcmVxdWVzdC5nZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScpLCBjb250ZW50RGlzcCA9IHJlcXVlc3QucGFyc2VIZWFkZXIoJ0NvbnRlbnQtRGlzcG9zaXRpb24nKTtcbiAgICAgICAgU0lQLlV0aWxzLmF1Z21lbnQodGhpcywgU0lQLlNlcnZlckNvbnRleHQsIFt1YSwgcmVxdWVzdF0pO1xuICAgICAgICBTSVAuVXRpbHMuYXVnbWVudCh0aGlzLCBTSVAuU2Vzc2lvbiwgW3VhLmNvbmZpZ3VyYXRpb24uc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlckZhY3RvcnldKTtcbiAgICAgICAgaWYgKGNvbnRlbnREaXNwICYmIGNvbnRlbnREaXNwLnR5cGUgPT09ICdyZW5kZXInKSB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcmJvZHkgPSByZXF1ZXN0LmJvZHk7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcnR5cGUgPSBjb250ZW50VHlwZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnN0YXR1cyA9IEMuU1RBVFVTX0lOVklURV9SRUNFSVZFRDtcbiAgICAgICAgdGhpcy5mcm9tX3RhZyA9IHJlcXVlc3QuZnJvbV90YWc7XG4gICAgICAgIHRoaXMuaWQgPSByZXF1ZXN0LmNhbGxfaWQgKyB0aGlzLmZyb21fdGFnO1xuICAgICAgICB0aGlzLnJlcXVlc3QgPSByZXF1ZXN0O1xuICAgICAgICB0aGlzLmNvbnRhY3QgPSB0aGlzLnVhLmNvbnRhY3QudG9TdHJpbmcoKTtcbiAgICAgICAgdGhpcy5yZWNlaXZlTm9uSW52aXRlUmVzcG9uc2UgPSBmdW5jdGlvbiAoKSB7IH07IC8vIGludGVudGlvbmFsIG5vLW9wXG4gICAgICAgIHRoaXMubG9nZ2VyID0gdWEuZ2V0TG9nZ2VyKCdzaXAuaW52aXRlc2VydmVyY29udGV4dCcsIHRoaXMuaWQpO1xuICAgICAgICAvL1NhdmUgdGhlIHNlc3Npb24gaW50byB0aGUgdWEgc2Vzc2lvbnMgY29sbGVjdGlvbi5cbiAgICAgICAgdGhpcy51YS5zZXNzaW9uc1t0aGlzLmlkXSA9IHRoaXM7XG4gICAgICAgIC8vR2V0IHRoZSBFeHBpcmVzIGhlYWRlciB2YWx1ZSBpZiBleGlzdHNcbiAgICAgICAgaWYgKHJlcXVlc3QuaGFzSGVhZGVyKCdleHBpcmVzJykpIHtcbiAgICAgICAgICAgIGV4cGlyZXMgPSByZXF1ZXN0LmdldEhlYWRlcignZXhwaXJlcycpICogMTAwMDtcbiAgICAgICAgfVxuICAgICAgICAvL1NldCAxMDByZWwgaWYgbmVjZXNzYXJ5XG4gICAgICAgIGZ1bmN0aW9uIHNldDEwMHJlbChoLCBjKSB7XG4gICAgICAgICAgICBpZiAocmVxdWVzdC5oYXNIZWFkZXIoaCkgJiYgcmVxdWVzdC5nZXRIZWFkZXIoaCkudG9Mb3dlckNhc2UoKS5pbmRleE9mKCcxMDByZWwnKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5yZWwxMDAgPSBjO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHNldDEwMHJlbCgncmVxdWlyZScsIFNJUC5DLnN1cHBvcnRlZC5SRVFVSVJFRCk7XG4gICAgICAgIHNldDEwMHJlbCgnc3VwcG9ydGVkJywgU0lQLkMuc3VwcG9ydGVkLlNVUFBPUlRFRCk7XG4gICAgICAgIC8qIFNldCB0aGUgdG9fdGFnIGJlZm9yZVxuICAgICAgICAgKiByZXBseWluZyBhIHJlc3BvbnNlIGNvZGUgdGhhdCB3aWxsIGNyZWF0ZSBhIGRpYWxvZy5cbiAgICAgICAgICovXG4gICAgICAgIHJlcXVlc3QudG9fdGFnID0gU0lQLlV0aWxzLm5ld1RhZygpO1xuICAgICAgICAvLyBBbiBlcnJvciBvbiBkaWFsb2cgY3JlYXRpb24gd2lsbCBmaXJlICdmYWlsZWQnIGV2ZW50XG4gICAgICAgIGlmICghdGhpcy5jcmVhdGVEaWFsb2cocmVxdWVzdCwgJ1VBUycsIHRydWUpKSB7XG4gICAgICAgICAgICByZXF1ZXN0LnJlcGx5KDUwMCwgJ01pc3NpbmcgQ29udGFjdCBoZWFkZXIgZmllbGQnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgb3B0aW9ucyA9IHsgZXh0cmFIZWFkZXJzOiBbJ0NvbnRhY3Q6ICcgKyBzZWxmLmNvbnRhY3RdIH07XG4gICAgICAgIGlmIChzZWxmLnJlbDEwMCAhPT0gU0lQLkMuc3VwcG9ydGVkLlJFUVVJUkVEKSB7XG4gICAgICAgICAgICBzZWxmLnByb2dyZXNzKG9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgICAgIHNlbGYuc3RhdHVzID0gQy5TVEFUVVNfV0FJVElOR19GT1JfQU5TV0VSO1xuICAgICAgICAvLyBTZXQgdXNlck5vQW5zd2VyVGltZXJcbiAgICAgICAgc2VsZi50aW1lcnMudXNlck5vQW5zd2VyVGltZXIgPSBTSVAuVGltZXJzLnNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmVxdWVzdC5yZXBseSg0MDgpO1xuICAgICAgICAgICAgc2VsZi5mYWlsZWQocmVxdWVzdCwgU0lQLkMuY2F1c2VzLk5PX0FOU1dFUik7XG4gICAgICAgICAgICBzZWxmLnRlcm1pbmF0ZWQocmVxdWVzdCwgU0lQLkMuY2F1c2VzLk5PX0FOU1dFUik7XG4gICAgICAgIH0sIHNlbGYudWEuY29uZmlndXJhdGlvbi5ub0Fuc3dlclRpbWVvdXQpO1xuICAgICAgICAvKiBTZXQgZXhwaXJlc1RpbWVyXG4gICAgICAgICAqIFJGQzMyNjEgMTMuMy4xXG4gICAgICAgICAqL1xuICAgICAgICBpZiAoZXhwaXJlcykge1xuICAgICAgICAgICAgc2VsZi50aW1lcnMuZXhwaXJlc1RpbWVyID0gU0lQLlRpbWVycy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2VsZi5zdGF0dXMgPT09IEMuU1RBVFVTX1dBSVRJTkdfRk9SX0FOU1dFUikge1xuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnJlcGx5KDQ4Nyk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuZmFpbGVkKHJlcXVlc3QsIFNJUC5DLmNhdXNlcy5FWFBJUkVTKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi50ZXJtaW5hdGVkKHJlcXVlc3QsIFNJUC5DLmNhdXNlcy5FWFBJUkVTKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBleHBpcmVzKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmVycm9yTGlzdGVuZXIgPSB0aGlzLm9uVHJhbnNwb3J0RXJyb3IuYmluZCh0aGlzKTtcbiAgICAgICAgdWEudHJhbnNwb3J0Lm9uKCd0cmFuc3BvcnRFcnJvcicsIHRoaXMuZXJyb3JMaXN0ZW5lcik7XG4gICAgfTtcbiAgICBJbnZpdGVTZXJ2ZXJDb250ZXh0LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoe30sIHtcbiAgICAgICAgcmVqZWN0OiB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAvLyBDaGVjayBTZXNzaW9uIFN0YXR1c1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cyA9PT0gQy5TVEFUVVNfVEVSTUlOQVRFRCkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU0lQLkV4Y2VwdGlvbnMuSW52YWxpZFN0YXRlRXJyb3IodGhpcy5zdGF0dXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ3JlamVjdGluZyBSVENTZXNzaW9uJyk7XG4gICAgICAgICAgICAgICAgU0lQLlNlcnZlckNvbnRleHQucHJvdG90eXBlLnJlamVjdC5jYWxsKHRoaXMsIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRlcm1pbmF0ZWQoKTtcbiAgICAgICAgICAgIH0gfSxcbiAgICAgICAgdGVybWluYXRlOiB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAgICAgICAgICAgICB2YXIgZXh0cmFIZWFkZXJzID0gKG9wdGlvbnMuZXh0cmFIZWFkZXJzIHx8IFtdKS5zbGljZSgpLCBib2R5ID0gb3B0aW9ucy5ib2R5LCBkaWFsb2csIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cyA9PT0gQy5TVEFUVVNfV0FJVElOR19GT1JfQUNLICYmXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdC5zZXJ2ZXJfdHJhbnNhY3Rpb24uc3RhdGUgIT09IFNJUC5UcmFuc2FjdGlvbnMuQy5TVEFUVVNfVEVSTUlOQVRFRCkge1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2cgPSB0aGlzLmRpYWxvZztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWNlaXZlUmVxdWVzdCA9IGZ1bmN0aW9uIChyZXF1ZXN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVxdWVzdC5tZXRob2QgPT09IFNJUC5DLkFDSykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VuZFJlcXVlc3QoU0lQLkMuQllFLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhSGVhZGVyczogZXh0cmFIZWFkZXJzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5OiBib2R5XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlhbG9nLnRlcm1pbmF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlcXVlc3Quc2VydmVyX3RyYW5zYWN0aW9uLm9uKCdzdGF0ZUNoYW5nZWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSA9PT0gU0lQLlRyYW5zYWN0aW9ucy5DLlNUQVRVU19URVJNSU5BVEVEICYmIHRoaXMuZGlhbG9nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0ID0gbmV3IFNJUC5PdXRnb2luZ1JlcXVlc3QoU0lQLkMuQllFLCB0aGlzLmRpYWxvZy5yZW1vdGVfdGFyZ2V0LCB0aGlzLnVhLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjc2VxJzogdGhpcy5kaWFsb2cubG9jYWxfc2VxbnVtICs9IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjYWxsX2lkJzogdGhpcy5kaWFsb2cuaWQuY2FsbF9pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Zyb21fdXJpJzogdGhpcy5kaWFsb2cubG9jYWxfdXJpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZnJvbV90YWcnOiB0aGlzLmRpYWxvZy5pZC5sb2NhbF90YWcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0b191cmknOiB0aGlzLmRpYWxvZy5yZW1vdGVfdXJpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndG9fdGFnJzogdGhpcy5kaWFsb2cuaWQucmVtb3RlX3RhZyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JvdXRlX3NldCc6IHRoaXMuZGlhbG9nLnJvdXRlX3NldFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGV4dHJhSGVhZGVycywgYm9keSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFNJUC5SZXF1ZXN0U2VuZGVyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdDogdGhpcy5yZXF1ZXN0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblJlcXVlc3RUaW1lb3V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm9uUmVxdWVzdFRpbWVvdXQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25UcmFuc3BvcnRFcnJvcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5vblRyYW5zcG9ydEVycm9yKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpdmVSZXNwb25zZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy51YSkuc2VuZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpYWxvZy50ZXJtaW5hdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgnYnllJywgdGhpcy5yZXF1ZXN0KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50ZXJtaW5hdGVkKCk7XG4gICAgICAgICAgICAgICAgICAgIC8vIFJlc3RvcmUgdGhlIGRpYWxvZyBpbnRvICd0aGlzJyBpbiBvcmRlciB0byBiZSBhYmxlIHRvIHNlbmQgdGhlIGluLWRpYWxvZyBCWUUgOi0pXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlhbG9nID0gZGlhbG9nO1xuICAgICAgICAgICAgICAgICAgICAvLyBSZXN0b3JlIHRoZSBkaWFsb2cgaW50byAndWEnIHNvIHRoZSBBQ0sgY2FuIHJlYWNoICd0aGlzJyBzZXNzaW9uXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudWEuZGlhbG9nc1tkaWFsb2cuaWQudG9TdHJpbmcoKV0gPSBkaWFsb2c7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuc3RhdHVzID09PSBDLlNUQVRVU19DT05GSVJNRUQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ieWUob3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlamVjdChvcHRpb25zKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICB9IH0sXG4gICAgICAgIC8qXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9ucy5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyT3B0aW9uc10gZ2V0cyBwYXNzZWQgdG8gU0lQLlNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIuZ2V0RGVzY3JpcHRpb24gYXMgb3B0aW9uc1xuICAgICAgICAgKi9cbiAgICAgICAgcHJvZ3Jlc3M6IHsgd3JpdGFibGU6IHRydWUsIHZhbHVlOiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgICAgICAgICAgICAgIHZhciBzdGF0dXNDb2RlID0gb3B0aW9ucy5zdGF0dXNDb2RlIHx8IDE4MCwgcmVhc29uUGhyYXNlID0gb3B0aW9ucy5yZWFzb25QaHJhc2UsIGV4dHJhSGVhZGVycyA9IChvcHRpb25zLmV4dHJhSGVhZGVycyB8fCBbXSkuc2xpY2UoKSwgYm9keSA9IG9wdGlvbnMuYm9keSwgcmVzcG9uc2U7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXR1c0NvZGUgPCAxMDAgfHwgc3RhdHVzQ29kZSA+IDE5OSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdJbnZhbGlkIHN0YXR1c0NvZGU6ICcgKyBzdGF0dXNDb2RlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNDYW5jZWxlZCB8fCB0aGlzLnN0YXR1cyA9PT0gQy5TVEFUVVNfVEVSTUlOQVRFRCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gZG8xMDByZWwoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8qIGpzaGludCB2YWxpZHRoaXM6IHRydWUgKi9cbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZSA9IG9wdGlvbnMuc3RhdHVzQ29kZSB8fCAxODM7XG4gICAgICAgICAgICAgICAgICAgIC8vIFNldCBzdGF0dXMgYW5kIGFkZCBleHRyYSBoZWFkZXJzXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gQy5TVEFUVVNfV0FJVElOR19GT1JfUFJBQ0s7XG4gICAgICAgICAgICAgICAgICAgIGV4dHJhSGVhZGVycy5wdXNoKCdDb250YWN0OiAnICsgdGhpcy5jb250YWN0KTtcbiAgICAgICAgICAgICAgICAgICAgZXh0cmFIZWFkZXJzLnB1c2goJ1JlcXVpcmU6IDEwMHJlbCcpO1xuICAgICAgICAgICAgICAgICAgICBleHRyYUhlYWRlcnMucHVzaCgnUlNlcTogJyArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDAwKSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIEdldCB0aGUgc2Vzc2lvbiBkZXNjcmlwdGlvbiB0byBhZGQgdG8gcHJlYWNjZXB0IHdpdGhcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyLmdldERlc2NyaXB0aW9uKG9wdGlvbnMuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlck9wdGlvbnMsIG9wdGlvbnMubW9kaWZpZXJzKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gb25TdWNjZXNzKGRlc2NyaXB0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0NhbmNlbGVkIHx8IHRoaXMuc3RhdHVzID09PSBDLlNUQVRVU19URVJNSU5BVEVEKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lYXJseV9zZHAgPSBkZXNjcmlwdGlvbi5ib2R5O1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1t0aGlzLmhhc09mZmVyID8gJ2hhc0Fuc3dlcicgOiAnaGFzT2ZmZXInXSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZXRyYW5zbWl0IHVudGlsIHdlIGdldCBhIHJlc3BvbnNlIG9yIHdlIHRpbWUgb3V0IChzZWUgcHJhY2tUaW1lciBiZWxvdylcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0aW1lb3V0ID0gU0lQLlRpbWVycy5UMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGltZXJzLnJlbDF4eFRpbWVyID0gU0lQLlRpbWVycy5zZXRUaW1lb3V0KGZ1bmN0aW9uIHJlbDF4eFJldHJhbnNtaXNzaW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdC5yZXBseShzdGF0dXNDb2RlLCBudWxsLCBleHRyYUhlYWRlcnMsIGRlc2NyaXB0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0ICo9IDI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50aW1lcnMucmVsMXh4VGltZXIgPSBTSVAuVGltZXJzLnNldFRpbWVvdXQocmVsMXh4UmV0cmFuc21pc3Npb24uYmluZCh0aGlzKSwgdGltZW91dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcyksIHRpbWVvdXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGltZW91dCBhbmQgcmVqZWN0IElOVklURSBpZiBubyByZXNwb25zZVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50aW1lcnMucHJhY2tUaW1lciA9IFNJUC5UaW1lcnMuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzICE9PSBDLlNUQVRVU19XQUlUSU5HX0ZPUl9QUkFDSykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZygnbm8gUFJBQ0sgcmVjZWl2ZWQsIHJlamVjdGluZyB0aGUgY2FsbCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNJUC5UaW1lcnMuY2xlYXJUaW1lb3V0KHRoaXMudGltZXJzLnJlbDF4eFRpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlcXVlc3QucmVwbHkoNTA0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRlcm1pbmF0ZWQobnVsbCwgU0lQLkMuY2F1c2VzLk5PX1BSQUNLKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSwgU0lQLlRpbWVycy5UMSAqIDY0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNlbmQgdGhlIGluaXRpYWwgcmVzcG9uc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gdGhpcy5yZXF1ZXN0LnJlcGx5KHN0YXR1c0NvZGUsIHJlYXNvblBocmFzZSwgZXh0cmFIZWFkZXJzLCBkZXNjcmlwdGlvbik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ3Byb2dyZXNzJywgcmVzcG9uc2UsIHJlYXNvblBocmFzZSk7XG4gICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSwgZnVuY3Rpb24gb25GYWlsdXJlKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0LnJlcGx5KDQ4MCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZhaWxlZChudWxsLCBTSVAuQy5jYXVzZXMuV0VCUlRDX0VSUk9SKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGVybWluYXRlZChudWxsLCBTSVAuQy5jYXVzZXMuV0VCUlRDX0VSUk9SKTtcbiAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICB9IC8vIGVuZCBkbzEwMHJlbFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIG5vcm1hbFJlcGx5KCkge1xuICAgICAgICAgICAgICAgICAgICAvKiBqc2hpbnQgdmFsaWR0aGlzOnRydWUgKi9cbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSB0aGlzLnJlcXVlc3QucmVwbHkoc3RhdHVzQ29kZSwgcmVhc29uUGhyYXNlLCBleHRyYUhlYWRlcnMsIGJvZHkpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ3Byb2dyZXNzJywgcmVzcG9uc2UsIHJlYXNvblBocmFzZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnN0YXR1c0NvZGUgIT09IDEwMCAmJlxuICAgICAgICAgICAgICAgICAgICAodGhpcy5yZWwxMDAgPT09IFNJUC5DLnN1cHBvcnRlZC5SRVFVSVJFRCB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMucmVsMTAwID09PSBTSVAuQy5zdXBwb3J0ZWQuU1VQUE9SVEVEICYmIG9wdGlvbnMucmVsMTAwKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMucmVsMTAwID09PSBTSVAuQy5zdXBwb3J0ZWQuU1VQUE9SVEVEICYmICh0aGlzLnVhLmNvbmZpZ3VyYXRpb24ucmVsMTAwID09PSBTSVAuQy5zdXBwb3J0ZWQuUkVRVUlSRUQpKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyID0gdGhpcy5zZXR1cFNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdTZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyLWNyZWF0ZWQnLCB0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyLmhhc0Rlc2NyaXB0aW9uKHRoaXMucmVxdWVzdC5nZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYXNPZmZlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIuc2V0RGVzY3JpcHRpb24odGhpcy5yZXF1ZXN0LmJvZHksIG9wdGlvbnMuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlck9wdGlvbnMsIG9wdGlvbnMubW9kaWZpZXJzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGRvMTAwcmVsLmFwcGx5KHRoaXMpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiBvbkZhaWx1cmUoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ2ludmFsaWQgZGVzY3JpcHRpb24nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuKGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmFpbGVkKG51bGwsIFNJUC5DLmNhdXNlcy5XRUJSVENfRVJST1IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGVybWluYXRlZChudWxsLCBTSVAuQy5jYXVzZXMuV0VCUlRDX0VSUk9SKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkbzEwMHJlbC5hcHBseSh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbm9ybWFsUmVwbHkuYXBwbHkodGhpcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgfSB9LFxuICAgICAgICAvKlxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnMuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlck9wdGlvbnNdIGdldHMgcGFzc2VkIHRvIFNJUC5TZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyLmdldERlc2NyaXB0aW9uIGFzIG9wdGlvbnNcbiAgICAgICAgICovXG4gICAgICAgIGFjY2VwdDogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgICAgICAgICAgICAgdGhpcy5vbkluZm8gPSBvcHRpb25zLm9uSW5mbztcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXMsIHJlcXVlc3QgPSB0aGlzLnJlcXVlc3QsIGV4dHJhSGVhZGVycyA9IChvcHRpb25zLmV4dHJhSGVhZGVycyB8fCBbXSkuc2xpY2UoKSwgZGVzY3JpcHRpb25DcmVhdGlvblN1Y2NlZWRlZCA9IGZ1bmN0aW9uIChkZXNjcmlwdGlvbikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UsIFxuICAgICAgICAgICAgICAgICAgICAvLyBydW4gZm9yIHJlcGx5IHN1Y2Nlc3MgY2FsbGJhY2tcbiAgICAgICAgICAgICAgICAgICAgcmVwbHlTdWNjZWVkZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnN0YXR1cyA9IEMuU1RBVFVTX1dBSVRJTkdfRk9SX0FDSztcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2V0SW52aXRlMnh4VGltZXIocmVxdWVzdCwgZGVzY3JpcHRpb24pO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXRBQ0tUaW1lcigpO1xuICAgICAgICAgICAgICAgICAgICB9LCBcbiAgICAgICAgICAgICAgICAgICAgLy8gcnVuIGZvciByZXBseSBmYWlsdXJlIGNhbGxiYWNrXG4gICAgICAgICAgICAgICAgICAgIHJlcGx5RmFpbGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5mYWlsZWQobnVsbCwgU0lQLkMuY2F1c2VzLkNPTk5FQ1RJT05fRVJST1IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50ZXJtaW5hdGVkKG51bGwsIFNJUC5DLmNhdXNlcy5DT05ORUNUSU9OX0VSUk9SKTtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgZXh0cmFIZWFkZXJzLnB1c2goJ0NvbnRhY3Q6ICcgKyBzZWxmLmNvbnRhY3QpO1xuICAgICAgICAgICAgICAgICAgICBleHRyYUhlYWRlcnMucHVzaCgnQWxsb3c6ICcgKyBTSVAuVUEuQy5BTExPV0VEX01FVEhPRFMudG9TdHJpbmcoKSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghc2VsZi5oYXNPZmZlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oYXNPZmZlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhhc0Fuc3dlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0LnJlcGx5KDIwMCwgbnVsbCwgZXh0cmFIZWFkZXJzLCBkZXNjcmlwdGlvbiwgcmVwbHlTdWNjZWVkZWQsIHJlcGx5RmFpbGVkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGYuc3RhdHVzICE9PSBDLlNUQVRVU19URVJNSU5BVEVEKSB7IC8vIERpZG4ndCBmYWlsXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFjY2VwdGVkKHJlc3BvbnNlLCBTSVAuVXRpbHMuZ2V0UmVhc29uUGhyYXNlKDIwMCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgZGVzY3JpcHRpb25DcmVhdGlvbkZhaWxlZCA9IGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVyciBpbnN0YW5jZW9mIFNJUC5FeGNlcHRpb25zLlNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJFcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKGVyci5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhlcnIuZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IFRoaXMgc2hvdWxkIGNoZWNrIHRoZSBhY3R1YWwgZXJyb3IgYW5kIG1ha2Ugc3VyZSBpdCBpcyBhblxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgXCJleHBlY3RlZFwiIGVycm9yLiBPdGhlcndpc2UgaXQgc2hvdWxkIHRocm93LlxuICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZi5zdGF0dXMgPT09IEMuU1RBVFVTX1RFUk1JTkFURUQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBzZWxmLnJlcXVlc3QucmVwbHkoNDgwKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5mYWlsZWQobnVsbCwgU0lQLkMuY2F1c2VzLldFQlJUQ19FUlJPUik7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYudGVybWluYXRlZChudWxsLCBTSVAuQy5jYXVzZXMuV0VCUlRDX0VSUk9SKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIC8vIENoZWNrIFNlc3Npb24gU3RhdHVzXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzID09PSBDLlNUQVRVU19XQUlUSU5HX0ZPUl9QUkFDSykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXR1cyA9IEMuU1RBVFVTX0FOU1dFUkVEX1dBSVRJTkdfRk9SX1BSQUNLO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5zdGF0dXMgPT09IEMuU1RBVFVTX1dBSVRJTkdfRk9SX0FOU1dFUikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXR1cyA9IEMuU1RBVFVTX0FOU1dFUkVEO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLnN0YXR1cyAhPT0gQy5TVEFUVVNfRUFSTFlfTUVESUEpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNJUC5FeGNlcHRpb25zLkludmFsaWRTdGF0ZUVycm9yKHRoaXMuc3RhdHVzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gQW4gZXJyb3Igb24gZGlhbG9nIGNyZWF0aW9uIHdpbGwgZmlyZSAnZmFpbGVkJyBldmVudFxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5jcmVhdGVEaWFsb2cocmVxdWVzdCwgJ1VBUycpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3QucmVwbHkoNTAwLCAnTWlzc2luZyBDb250YWN0IGhlYWRlciBmaWVsZCcpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgU0lQLlRpbWVycy5jbGVhclRpbWVvdXQodGhpcy50aW1lcnMudXNlck5vQW5zd2VyVGltZXIpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cyA9PT0gQy5TVEFUVVNfRUFSTFlfTUVESUEpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb25DcmVhdGlvblN1Y2NlZWRlZCh7fSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIgPSB0aGlzLnNldHVwU2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlcigpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ1Nlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXItY3JlYXRlZCcsIHRoaXMuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlcik7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlcXVlc3QuZ2V0SGVhZGVyKCdDb250ZW50LUxlbmd0aCcpID09PSAnMCcgJiYgIXRoaXMucmVxdWVzdC5nZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIuZ2V0RGVzY3JpcHRpb24ob3B0aW9ucy5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyT3B0aW9ucywgb3B0aW9ucy5tb2RpZmllcnMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGRlc2NyaXB0aW9uQ3JlYXRpb25GYWlsZWQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZGVzY3JpcHRpb25DcmVhdGlvblN1Y2NlZWRlZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyLmhhc0Rlc2NyaXB0aW9uKHRoaXMucmVxdWVzdC5nZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYXNPZmZlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIuc2V0RGVzY3JpcHRpb24odGhpcy5yZXF1ZXN0LmJvZHksIG9wdGlvbnMuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlck9wdGlvbnMsIG9wdGlvbnMubW9kaWZpZXJzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyLmdldERlc2NyaXB0aW9uKG9wdGlvbnMuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlck9wdGlvbnMsIG9wdGlvbnMubW9kaWZpZXJzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZGVzY3JpcHRpb25DcmVhdGlvbkZhaWxlZClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihkZXNjcmlwdGlvbkNyZWF0aW9uU3VjY2VlZGVkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdC5yZXBseSg0MTUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogRXZlbnRzXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICB9IH0sXG4gICAgICAgIHJlY2VpdmVSZXF1ZXN0OiB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogZnVuY3Rpb24gKHJlcXVlc3QpIHtcbiAgICAgICAgICAgICAgICAvLyBJU0MgUkVDRUlWRSBSRVFVRVNUXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gY29uZmlybVNlc3Npb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIC8qIGpzaGludCB2YWxpZHRoaXM6dHJ1ZSAqL1xuICAgICAgICAgICAgICAgICAgICB2YXIgY29udGVudFR5cGUsIGNvbnRlbnREaXNwO1xuICAgICAgICAgICAgICAgICAgICBTSVAuVGltZXJzLmNsZWFyVGltZW91dCh0aGlzLnRpbWVycy5hY2tUaW1lcik7XG4gICAgICAgICAgICAgICAgICAgIFNJUC5UaW1lcnMuY2xlYXJUaW1lb3V0KHRoaXMudGltZXJzLmludml0ZTJ4eFRpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSBDLlNUQVRVU19DT05GSVJNRUQ7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlID0gcmVxdWVzdC5nZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScpO1xuICAgICAgICAgICAgICAgICAgICBjb250ZW50RGlzcCA9IHJlcXVlc3QuZ2V0SGVhZGVyKCdDb250ZW50LURpc3Bvc2l0aW9uJyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb250ZW50RGlzcCAmJiBjb250ZW50RGlzcC50eXBlID09PSAncmVuZGVyJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJib2R5ID0gcmVxdWVzdC5ib2R5O1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJ0eXBlID0gY29udGVudFR5cGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdjb25maXJtZWQnLCByZXF1ZXN0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc3dpdGNoIChyZXF1ZXN0Lm1ldGhvZCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFNJUC5DLkNBTkNFTDpcbiAgICAgICAgICAgICAgICAgICAgICAgIC8qIFJGQzMyNjEgMTUgU3RhdGVzIHRoYXQgYSBVQVMgbWF5IGhhdmUgYWNjZXB0ZWQgYW4gaW52aXRhdGlvbiB3aGlsZSBhIENBTkNFTFxuICAgICAgICAgICAgICAgICAgICAgICAgICogd2FzIGluIHByb2dyZXNzIGFuZCB0aGF0IHRoZSBVQUMgTUFZIGNvbnRpbnVlIHdpdGggdGhlIHNlc3Npb24gZXN0YWJsaXNoZWQgYnlcbiAgICAgICAgICAgICAgICAgICAgICAgICAqIGFueSAyeHggcmVzcG9uc2UsIG9yIE1BWSB0ZXJtaW5hdGUgd2l0aCBCWUUuIFNJUCBkb2VzIGNvbnRpbnVlIHdpdGggdGhlXG4gICAgICAgICAgICAgICAgICAgICAgICAgKiBlc3RhYmxpc2hlZCBzZXNzaW9uLiBTbyB0aGUgQ0FOQ0VMIGlzIHByb2Nlc3NlZCBvbmx5IGlmIHRoZSBzZXNzaW9uIGlzIG5vdCB5ZXRcbiAgICAgICAgICAgICAgICAgICAgICAgICAqIGVzdGFibGlzaGVkLlxuICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgICAgICAgICAgICogVGVybWluYXRlIHRoZSB3aG9sZSBzZXNzaW9uIGluIGNhc2UgdGhlIHVzZXIgZGlkbid0IGFjY2VwdCAob3IgeWV0IHRvIHNlbmQgdGhlIGFuc3dlcikgbm9yIHJlamVjdCB0aGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAqcmVxdWVzdCBvcGVuaW5nIHRoZSBzZXNzaW9uLlxuICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMgPT09IEMuU1RBVFVTX1dBSVRJTkdfRk9SX0FOU1dFUiB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzID09PSBDLlNUQVRVU19XQUlUSU5HX0ZPUl9QUkFDSyB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzID09PSBDLlNUQVRVU19BTlNXRVJFRF9XQUlUSU5HX0ZPUl9QUkFDSyB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzID09PSBDLlNUQVRVU19FQVJMWV9NRURJQSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzID09PSBDLlNUQVRVU19BTlNXRVJFRCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gQy5TVEFUVVNfQ0FOQ0VMRUQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0LnJlcGx5KDQ4Nyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYW5jZWxlZChyZXF1ZXN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlamVjdGVkKHJlcXVlc3QsIFNJUC5DLmNhdXNlcy5DQU5DRUxFRCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mYWlsZWQocmVxdWVzdCwgU0lQLkMuY2F1c2VzLkNBTkNFTEVEKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRlcm1pbmF0ZWQocmVxdWVzdCwgU0lQLkMuY2F1c2VzLkNBTkNFTEVEKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFNJUC5DLkFDSzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cyA9PT0gQy5TVEFUVVNfV0FJVElOR19GT1JfQUNLKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlci5oYXNEZXNjcmlwdGlvbihyZXF1ZXN0LmdldEhlYWRlcignQ29udGVudC1UeXBlJykpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFDSyBjb250YWlucyBhbnN3ZXIgdG8gYW4gSU5WSVRFIHcvbyBTRFAgbmVnb3RpYXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYXNBbnN3ZXIgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIuc2V0RGVzY3JpcHRpb24ocmVxdWVzdC5ib2R5LCB0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJPcHRpb25zLCB0aGlzLm1vZGlmaWVycylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBDYXRjaCB0aGVuIC50aGVuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpcm1TZXNzaW9uLmJpbmQodGhpcyksIGZ1bmN0aW9uIG9uRmFpbHVyZShlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuKGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50ZXJtaW5hdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c0NvZGU6ICc0ODgnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYXNvblBocmFzZTogJ0JhZCBNZWRpYSBEZXNjcmlwdGlvbidcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mYWlsZWQocmVxdWVzdCwgU0lQLkMuY2F1c2VzLkJBRF9NRURJQV9ERVNDUklQVElPTik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRlcm1pbmF0ZWQocmVxdWVzdCwgU0lQLkMuY2F1c2VzLkJBRF9NRURJQV9ERVNDUklQVElPTik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maXJtU2Vzc2lvbi5hcHBseSh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBTSVAuQy5QUkFDSzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cyA9PT0gQy5TVEFUVVNfV0FJVElOR19GT1JfUFJBQ0sgfHwgdGhpcy5zdGF0dXMgPT09IEMuU1RBVFVTX0FOU1dFUkVEX1dBSVRJTkdfRk9SX1BSQUNLKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmhhc0Fuc3dlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIgPSB0aGlzLnNldHVwU2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ1Nlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXItY3JlYXRlZCcsIHRoaXMuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIuaGFzRGVzY3JpcHRpb24ocmVxdWVzdC5nZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYXNBbnN3ZXIgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyLnNldERlc2NyaXB0aW9uKHJlcXVlc3QuYm9keSwgdGhpcy5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyT3B0aW9ucywgdGhpcy5tb2RpZmllcnMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gb25TdWNjZXNzKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNJUC5UaW1lcnMuY2xlYXJUaW1lb3V0KHRoaXMudGltZXJzLnJlbDF4eFRpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTSVAuVGltZXJzLmNsZWFyVGltZW91dCh0aGlzLnRpbWVycy5wcmFja1RpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnJlcGx5KDIwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzID09PSBDLlNUQVRVU19BTlNXRVJFRF9XQUlUSU5HX0ZPUl9QUkFDSykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXR1cyA9IEMuU1RBVFVTX0VBUkxZX01FRElBO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFjY2VwdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXR1cyA9IEMuU1RBVFVTX0VBUkxZX01FRElBO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpLCBmdW5jdGlvbiBvbkZhaWx1cmUoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50ZXJtaW5hdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNDb2RlOiAnNDg4JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhc29uUGhyYXNlOiAnQmFkIE1lZGlhIERlc2NyaXB0aW9uJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmFpbGVkKHJlcXVlc3QsIFNJUC5DLmNhdXNlcy5CQURfTUVESUFfREVTQ1JJUFRJT04pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGVybWluYXRlZChyZXF1ZXN0LCBTSVAuQy5jYXVzZXMuQkFEX01FRElBX0RFU0NSSVBUSU9OKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRlcm1pbmF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZTogJzQ4OCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhc29uUGhyYXNlOiAnQmFkIE1lZGlhIERlc2NyaXB0aW9uJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZhaWxlZChyZXF1ZXN0LCBTSVAuQy5jYXVzZXMuQkFEX01FRElBX0RFU0NSSVBUSU9OKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGVybWluYXRlZChyZXF1ZXN0LCBTSVAuQy5jYXVzZXMuQkFEX01FRElBX0RFU0NSSVBUSU9OKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU0lQLlRpbWVycy5jbGVhclRpbWVvdXQodGhpcy50aW1lcnMucmVsMXh4VGltZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTSVAuVGltZXJzLmNsZWFyVGltZW91dCh0aGlzLnRpbWVycy5wcmFja1RpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5yZXBseSgyMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMgPT09IEMuU1RBVFVTX0FOU1dFUkVEX1dBSVRJTkdfRk9SX1BSQUNLKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXR1cyA9IEMuU1RBVFVTX0VBUkxZX01FRElBO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hY2NlcHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXR1cyA9IEMuU1RBVFVTX0VBUkxZX01FRElBO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuc3RhdHVzID09PSBDLlNUQVRVU19FQVJMWV9NRURJQSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3QucmVwbHkoMjAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgU2Vzc2lvbi5wcm90b3R5cGUucmVjZWl2ZVJlcXVlc3QuYXBwbHkodGhpcywgW3JlcXVlc3RdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSxcbiAgICAgICAgLy8gSW50ZXJuYWwgRnVuY3Rpb24gdG8gc2V0dXAgdGhlIGhhbmRsZXIgY29uc2lzdGVudGx5XG4gICAgICAgIHNldHVwU2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlcjogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJGYWN0b3J5KHRoaXMsIHRoaXMudWEuY29uZmlndXJhdGlvbi5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyRmFjdG9yeU9wdGlvbnMpO1xuICAgICAgICAgICAgfSB9LFxuICAgICAgICBvblRyYW5zcG9ydEVycm9yOiB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cyAhPT0gQy5TVEFUVVNfQ09ORklSTUVEICYmIHRoaXMuc3RhdHVzICE9PSBDLlNUQVRVU19URVJNSU5BVEVEKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmFpbGVkKG51bGwsIFNJUC5DLmNhdXNlcy5DT05ORUNUSU9OX0VSUk9SKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0sXG4gICAgICAgIG9uUmVxdWVzdFRpbWVvdXQ6IHsgd3JpdGFibGU6IHRydWUsIHZhbHVlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzID09PSBDLlNUQVRVU19DT05GSVJNRUQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50ZXJtaW5hdGVkKG51bGwsIFNJUC5DLmNhdXNlcy5SRVFVRVNUX1RJTUVPVVQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLnN0YXR1cyAhPT0gQy5TVEFUVVNfVEVSTUlOQVRFRCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZhaWxlZChudWxsLCBTSVAuQy5jYXVzZXMuUkVRVUVTVF9USU1FT1VUKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50ZXJtaW5hdGVkKG51bGwsIFNJUC5DLmNhdXNlcy5SRVFVRVNUX1RJTUVPVVQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfVxuICAgIH0pO1xuICAgIFNJUC5JbnZpdGVTZXJ2ZXJDb250ZXh0ID0gSW52aXRlU2VydmVyQ29udGV4dDtcbiAgICBJbnZpdGVDbGllbnRDb250ZXh0ID0gZnVuY3Rpb24gKHVhLCB0YXJnZXQsIG9wdGlvbnMsIG1vZGlmaWVycykge1xuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAgICAgdGhpcy5wYXNzZWRPcHRpb25zID0gb3B0aW9uczsgLy8gU2F2ZSBmb3IgbGF0ZXIgdG8gdXNlIHdpdGggcmVmZXJcbiAgICAgICAgb3B0aW9ucy5wYXJhbXMgPSBPYmplY3QuY3JlYXRlKG9wdGlvbnMucGFyYW1zIHx8IE9iamVjdC5wcm90b3R5cGUpO1xuICAgICAgICB2YXIgZXh0cmFIZWFkZXJzID0gKG9wdGlvbnMuZXh0cmFIZWFkZXJzIHx8IFtdKS5zbGljZSgpLCBzZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyRmFjdG9yeSA9IHVhLmNvbmZpZ3VyYXRpb24uc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlckZhY3Rvcnk7XG4gICAgICAgIHRoaXMuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlckZhY3RvcnlPcHRpb25zID0gdWEuY29uZmlndXJhdGlvbi5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyRmFjdG9yeU9wdGlvbnMgfHwge307XG4gICAgICAgIHRoaXMuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlck9wdGlvbnMgPSBvcHRpb25zLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJPcHRpb25zIHx8IHt9O1xuICAgICAgICB0aGlzLm1vZGlmaWVycyA9IG1vZGlmaWVycztcbiAgICAgICAgdGhpcy5pbnZpdGVXaXRob3V0U2RwID0gb3B0aW9ucy5pbnZpdGVXaXRob3V0U2RwIHx8IGZhbHNlO1xuICAgICAgICAvLyBTZXQgYW5vbnltb3VzIHByb3BlcnR5XG4gICAgICAgIHRoaXMuYW5vbnltb3VzID0gb3B0aW9ucy5hbm9ueW1vdXMgfHwgZmFsc2U7XG4gICAgICAgIC8vIEN1c3RvbSBkYXRhIHRvIGJlIHNlbnQgZWl0aGVyIGluIElOVklURSBvciBpbiBBQ0tcbiAgICAgICAgdGhpcy5yZW5kZXJib2R5ID0gb3B0aW9ucy5yZW5kZXJib2R5IHx8IG51bGw7XG4gICAgICAgIHRoaXMucmVuZGVydHlwZSA9IG9wdGlvbnMucmVuZGVydHlwZSB8fCAndGV4dC9wbGFpbic7XG4gICAgICAgIC8vIFNlc3Npb24gcGFyYW1ldGVyIGluaXRpYWxpemF0aW9uXG4gICAgICAgIHRoaXMuZnJvbV90YWcgPSBTSVAuVXRpbHMubmV3VGFnKCk7XG4gICAgICAgIG9wdGlvbnMucGFyYW1zLmZyb21fdGFnID0gdGhpcy5mcm9tX3RhZztcbiAgICAgICAgLyogRG8gbm90IGFkZCA7b2IgaW4gaW5pdGlhbCBmb3JtaW5nIGRpYWxvZyByZXF1ZXN0cyBpZiB0aGUgcmVnaXN0cmF0aW9uIG92ZXJcbiAgICAgICAgICogIHRoZSBjdXJyZW50IGNvbm5lY3Rpb24gZ290IGEgR1JVVSBVUkkuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNvbnRhY3QgPSB1YS5jb250YWN0LnRvU3RyaW5nKHtcbiAgICAgICAgICAgIGFub255bW91czogdGhpcy5hbm9ueW1vdXMsXG4gICAgICAgICAgICBvdXRib3VuZDogdGhpcy5hbm9ueW1vdXMgPyAhdWEuY29udGFjdC50ZW1wX2dydXUgOiAhdWEuY29udGFjdC5wdWJfZ3J1dVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKHRoaXMuYW5vbnltb3VzKSB7XG4gICAgICAgICAgICBvcHRpb25zLnBhcmFtcy5mcm9tX2Rpc3BsYXlOYW1lID0gJ0Fub255bW91cyc7XG4gICAgICAgICAgICBvcHRpb25zLnBhcmFtcy5mcm9tX3VyaSA9ICdzaXA6YW5vbnltb3VzQGFub255bW91cy5pbnZhbGlkJztcbiAgICAgICAgICAgIGV4dHJhSGVhZGVycy5wdXNoKCdQLVByZWZlcnJlZC1JZGVudGl0eTogJyArIHVhLmNvbmZpZ3VyYXRpb24udXJpLnRvU3RyaW5nKCkpO1xuICAgICAgICAgICAgZXh0cmFIZWFkZXJzLnB1c2goJ1ByaXZhY3k6IGlkJyk7XG4gICAgICAgIH1cbiAgICAgICAgZXh0cmFIZWFkZXJzLnB1c2goJ0NvbnRhY3Q6ICcgKyB0aGlzLmNvbnRhY3QpO1xuICAgICAgICBleHRyYUhlYWRlcnMucHVzaCgnQWxsb3c6ICcgKyBTSVAuVUEuQy5BTExPV0VEX01FVEhPRFMudG9TdHJpbmcoKSk7XG4gICAgICAgIGlmICh0aGlzLmludml0ZVdpdGhvdXRTZHAgJiYgdGhpcy5yZW5kZXJib2R5KSB7XG4gICAgICAgICAgICBleHRyYUhlYWRlcnMucHVzaCgnQ29udGVudC1UeXBlOiAnICsgdGhpcy5yZW5kZXJ0eXBlKTtcbiAgICAgICAgICAgIGV4dHJhSGVhZGVycy5wdXNoKCdDb250ZW50LURpc3Bvc2l0aW9uOiByZW5kZXI7aGFuZGxpbmc9b3B0aW9uYWwnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodWEuY29uZmlndXJhdGlvbi5yZWwxMDAgPT09IFNJUC5DLnN1cHBvcnRlZC5SRVFVSVJFRCkge1xuICAgICAgICAgICAgZXh0cmFIZWFkZXJzLnB1c2goJ1JlcXVpcmU6IDEwMHJlbCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh1YS5jb25maWd1cmF0aW9uLnJlcGxhY2VzID09PSBTSVAuQy5zdXBwb3J0ZWQuUkVRVUlSRUQpIHtcbiAgICAgICAgICAgIGV4dHJhSGVhZGVycy5wdXNoKCdSZXF1aXJlOiByZXBsYWNlcycpO1xuICAgICAgICB9XG4gICAgICAgIG9wdGlvbnMuZXh0cmFIZWFkZXJzID0gZXh0cmFIZWFkZXJzO1xuICAgICAgICBTSVAuVXRpbHMuYXVnbWVudCh0aGlzLCBTSVAuQ2xpZW50Q29udGV4dCwgW3VhLCBTSVAuQy5JTlZJVEUsIHRhcmdldCwgb3B0aW9uc10pO1xuICAgICAgICBTSVAuVXRpbHMuYXVnbWVudCh0aGlzLCBTSVAuU2Vzc2lvbiwgW3Nlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJGYWN0b3J5XSk7XG4gICAgICAgIC8vIENoZWNrIFNlc3Npb24gU3RhdHVzXG4gICAgICAgIGlmICh0aGlzLnN0YXR1cyAhPT0gQy5TVEFUVVNfTlVMTCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IFNJUC5FeGNlcHRpb25zLkludmFsaWRTdGF0ZUVycm9yKHRoaXMuc3RhdHVzKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBPdXRnb2luZ1Nlc3Npb24gc3BlY2lmaWMgcGFyYW1ldGVyc1xuICAgICAgICB0aGlzLmlzQ2FuY2VsZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5yZWNlaXZlZF8xMDAgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5tZXRob2QgPSBTSVAuQy5JTlZJVEU7XG4gICAgICAgIHRoaXMucmVjZWl2ZU5vbkludml0ZVJlc3BvbnNlID0gdGhpcy5yZWNlaXZlUmVzcG9uc2U7XG4gICAgICAgIHRoaXMucmVjZWl2ZVJlc3BvbnNlID0gdGhpcy5yZWNlaXZlSW52aXRlUmVzcG9uc2U7XG4gICAgICAgIHRoaXMubG9nZ2VyID0gdWEuZ2V0TG9nZ2VyKCdzaXAuaW52aXRlY2xpZW50Y29udGV4dCcpO1xuICAgICAgICB1YS5hcHBsaWNhbnRzW3RoaXNdID0gdGhpcztcbiAgICAgICAgdGhpcy5pZCA9IHRoaXMucmVxdWVzdC5jYWxsX2lkICsgdGhpcy5mcm9tX3RhZztcbiAgICAgICAgdGhpcy5vbkluZm8gPSBvcHRpb25zLm9uSW5mbztcbiAgICAgICAgdGhpcy5lcnJvckxpc3RlbmVyID0gdGhpcy5vblRyYW5zcG9ydEVycm9yLmJpbmQodGhpcyk7XG4gICAgICAgIHVhLnRyYW5zcG9ydC5vbigndHJhbnNwb3J0RXJyb3InLCB0aGlzLmVycm9yTGlzdGVuZXIpO1xuICAgIH07XG4gICAgSW52aXRlQ2xpZW50Q29udGV4dC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHt9LCB7XG4gICAgICAgIGludml0ZTogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICAgICAgLy9TYXZlIHRoZSBzZXNzaW9uIGludG8gdGhlIHVhIHNlc3Npb25zIGNvbGxlY3Rpb24uXG4gICAgICAgICAgICAgICAgLy9Ob3RlOiBwbGFjaW5nIGluIGNvbnN0cnVjdG9yIGJyZWFrcyBjYWxsIHRvIHJlcXVlc3QuY2FuY2VsIG9uIGNsb3NlLi4uIFVzZXIgZG9lcyBub3QgbmVlZCB0aGlzIGFueXdheVxuICAgICAgICAgICAgICAgIHRoaXMudWEuc2Vzc2lvbnNbdGhpcy5pZF0gPSB0aGlzO1xuICAgICAgICAgICAgICAgIC8vIFRoaXMgc2hvdWxkIGFsbG93IHRoZSBmdW5jdGlvbiB0byByZXR1cm4gc28gdGhhdCBsaXN0ZW5lcnMgY2FuIGJlIHNldCB1cCBmb3IgdGhlc2UgZXZlbnRzXG4gICAgICAgICAgICAgICAgU0lQLlV0aWxzLlByb21pc2UucmVzb2x2ZSgpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnZpdGVXaXRob3V0U2RwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL2p1c3Qgc2VuZCBhbiBpbnZpdGUgd2l0aCBubyBzZHAuLi5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdC5ib2R5ID0gc2VsZi5yZW5kZXJib2R5O1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSBDLlNUQVRVU19JTlZJVEVfU0VOVDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VuZCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9Jbml0aWFsaXplIE1lZGlhIFNlc3Npb25cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlciA9IHRoaXMuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlckZhY3RvcnkodGhpcywgdGhpcy5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyRmFjdG9yeU9wdGlvbnMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdTZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyLWNyZWF0ZWQnLCB0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyLmdldERlc2NyaXB0aW9uKHRoaXMuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlck9wdGlvbnMsIHRoaXMubW9kaWZpZXJzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIG9uU3VjY2VzcyhkZXNjcmlwdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWxmLmlzQ2FuY2VsZWQgfHwgc2VsZi5zdGF0dXMgPT09IEMuU1RBVFVTX1RFUk1JTkFURUQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhhc09mZmVyID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnJlcXVlc3QuYm9keSA9IGRlc2NyaXB0aW9uO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc3RhdHVzID0gQy5TVEFUVVNfSU5WSVRFX1NFTlQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiBvbkZhaWx1cmUoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVyciBpbnN0YW5jZW9mIFNJUC5FeGNlcHRpb25zLlNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJFcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZXJyLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZXJyLmVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGYuc3RhdHVzID09PSBDLlNUQVRVU19URVJNSU5BVEVEKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5mYWlsZWQobnVsbCwgU0lQLkMuY2F1c2VzLldFQlJUQ19FUlJPUik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50ZXJtaW5hdGVkKG51bGwsIFNJUC5DLmNhdXNlcy5XRUJSVENfRVJST1IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgfSB9LFxuICAgICAgICByZWNlaXZlSW52aXRlUmVzcG9uc2U6IHsgd3JpdGFibGU6IHRydWUsIHZhbHVlOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICB2YXIgY2F1c2UsIHNlc3Npb24gPSB0aGlzLCBpZCA9IHJlc3BvbnNlLmNhbGxfaWQgKyByZXNwb25zZS5mcm9tX3RhZyArIHJlc3BvbnNlLnRvX3RhZywgZXh0cmFIZWFkZXJzID0gW10sIG9wdGlvbnMgPSB7fTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMgPT09IEMuU1RBVFVTX1RFUk1JTkFURUQgfHwgcmVzcG9uc2UubWV0aG9kICE9PSBTSVAuQy5JTlZJVEUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kaWFsb2cgJiYgKHJlc3BvbnNlLnN0YXR1c19jb2RlID49IDIwMCAmJiByZXNwb25zZS5zdGF0dXNfY29kZSA8PSAyOTkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpZCAhPT0gdGhpcy5kaWFsb2cuaWQudG9TdHJpbmcoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmNyZWF0ZURpYWxvZyhyZXNwb25zZSwgJ1VBQycsIHRydWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KFwiYWNrXCIsIHJlc3BvbnNlLnRyYW5zYWN0aW9uLnNlbmRBQ0soeyBib2R5OiBTSVAuVXRpbHMuZ2VuZXJhdGVGYWtlU0RQKHJlc3BvbnNlLmJvZHkpIH0pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZWFybHlEaWFsb2dzW2lkXS5zZW5kUmVxdWVzdCh0aGlzLCBTSVAuQy5CWUUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLyogTk9URTogVGhpcyBmYWlscyBiZWNhdXNlIHRoZSBmb3JraW5nIHByb3h5IGRvZXMgbm90IHJlY29nbml6ZSB0aGF0IGFuIHVuYW5zd2VyYWJsZVxuICAgICAgICAgICAgICAgICAgICAgICAgICogbGVnIChkdWUgdG8gcGVlckNvbm5lY3Rpb24gbGltaXRhdGlvbnMpIGhhcyBiZWVuIGFuc3dlcmVkIGZpcnN0LiBJZiB5b3VyIGZvcmtpbmdcbiAgICAgICAgICAgICAgICAgICAgICAgICAqIHByb3h5IGRvZXMgbm90IGhhbmcgdXAgYWxsIHVuYW5zd2VyZWQgYnJhbmNoZXMgb24gdGhlIGZpcnN0IGJyYW5jaCBhbnN3ZXJlZCwgcmVtb3ZlIHRoaXMuXG4gICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cyAhPT0gQy5TVEFUVVNfQ09ORklSTUVEKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mYWlsZWQocmVzcG9uc2UsIFNJUC5DLmNhdXNlcy5XRUJSVENfRVJST1IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGVybWluYXRlZChyZXNwb25zZSwgU0lQLkMuY2F1c2VzLldFQlJUQ19FUlJPUik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5zdGF0dXMgPT09IEMuU1RBVFVTX0NPTkZJUk1FRCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KFwiYWNrXCIsIHJlc3BvbnNlLnRyYW5zYWN0aW9uLnNlbmRBQ0soKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoIXRoaXMuaGFzQW5zd2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpbnZpdGUgdy9vIHNkcCBpcyB3YWl0aW5nIGZvciBjYWxsYmFja1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9hbiBpbnZpdGUgd2l0aCBzZHAgbXVzdCBnbyBvbiwgYW5kIGhhc0Fuc3dlciBpcyB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlhbG9nICYmIHJlc3BvbnNlLnN0YXR1c19jb2RlIDwgMjAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgICAgICAgICAgRWFybHkgbWVkaWEgaGFzIGJlZW4gc2V0IHVwIHdpdGggYXQgbGVhc3Qgb25lIG90aGVyIGRpZmZlcmVudCBicmFuY2gsXG4gICAgICAgICAgICAgICAgICAgICAgYnV0IGEgZmluYWwgMnh4IHJlc3BvbnNlIGhhc24ndCBiZWVuIHJlY2VpdmVkXG4gICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpYWxvZy5wcmFja2VkLmluZGV4T2YocmVzcG9uc2UuZ2V0SGVhZGVyKCdyc2VxJykpICE9PSAtMSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMuZGlhbG9nLnByYWNrZWRbdGhpcy5kaWFsb2cucHJhY2tlZC5sZW5ndGggLSAxXSA+PSByZXNwb25zZS5nZXRIZWFkZXIoJ3JzZXEnKSAmJiB0aGlzLmRpYWxvZy5wcmFja2VkLmxlbmd0aCA+IDApKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmVhcmx5RGlhbG9nc1tpZF0gJiYgIXRoaXMuY3JlYXRlRGlhbG9nKHJlc3BvbnNlLCAnVUFDJywgdHJ1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5lYXJseURpYWxvZ3NbaWRdLnByYWNrZWQuaW5kZXhPZihyZXNwb25zZS5nZXRIZWFkZXIoJ3JzZXEnKSkgIT09IC0xIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAodGhpcy5lYXJseURpYWxvZ3NbaWRdLnByYWNrZWRbdGhpcy5lYXJseURpYWxvZ3NbaWRdLnByYWNrZWQubGVuZ3RoIC0gMV0gPj0gcmVzcG9uc2UuZ2V0SGVhZGVyKCdyc2VxJykgJiYgdGhpcy5lYXJseURpYWxvZ3NbaWRdLnByYWNrZWQubGVuZ3RoID4gMCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBleHRyYUhlYWRlcnMucHVzaCgnUkFjazogJyArIHJlc3BvbnNlLmdldEhlYWRlcigncnNlcScpICsgJyAnICsgcmVzcG9uc2UuZ2V0SGVhZGVyKCdjc2VxJykpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVhcmx5RGlhbG9nc1tpZF0ucHJhY2tlZC5wdXNoKHJlc3BvbnNlLmdldEhlYWRlcigncnNlcScpKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lYXJseURpYWxvZ3NbaWRdLnNlbmRSZXF1ZXN0KHRoaXMsIFNJUC5DLlBSQUNLLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBleHRyYUhlYWRlcnM6IGV4dHJhSGVhZGVycyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGJvZHk6IFNJUC5VdGlscy5nZW5lcmF0ZUZha2VTRFAocmVzcG9uc2UuYm9keSlcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gUHJvY2VlZCB0byBjYW5jZWxsYXRpb24gaWYgdGhlIHVzZXIgcmVxdWVzdGVkLlxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzQ2FuY2VsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1c19jb2RlID49IDEwMCAmJiByZXNwb25zZS5zdGF0dXNfY29kZSA8IDIwMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0LmNhbmNlbCh0aGlzLmNhbmNlbFJlYXNvbiwgZXh0cmFIZWFkZXJzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FuY2VsZWQobnVsbCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzX2NvZGUgPj0gMjAwICYmIHJlc3BvbnNlLnN0YXR1c19jb2RlIDwgMjk5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFjY2VwdEFuZFRlcm1pbmF0ZShyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ2J5ZScsIHRoaXMucmVxdWVzdCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzX2NvZGUgPj0gMzAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXVzZSA9IFNJUC5DLlJFQVNPTl9QSFJBU0VbcmVzcG9uc2Uuc3RhdHVzX2NvZGVdIHx8IFNJUC5DLmNhdXNlcy5DQU5DRUxFRDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVqZWN0ZWQocmVzcG9uc2UsIGNhdXNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmFpbGVkKHJlc3BvbnNlLCBjYXVzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRlcm1pbmF0ZWQocmVzcG9uc2UsIGNhdXNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHN3aXRjaCAodHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIC9eMTAwJC8udGVzdChyZXNwb25zZS5zdGF0dXNfY29kZSk6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlY2VpdmVkXzEwMCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ3Byb2dyZXNzJywgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgKC9eMVswLTldezJ9JC8udGVzdChyZXNwb25zZS5zdGF0dXNfY29kZSkpOlxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRG8gbm90aGluZyB3aXRoIDF4eCByZXNwb25zZXMgd2l0aG91dCBUbyB0YWcuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLnRvX3RhZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oJzF4eCByZXNwb25zZSByZWNlaXZlZCB3aXRob3V0IHRvIHRhZycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIEVhcmx5IERpYWxvZyBpZiAxWFggY29tZXMgd2l0aCBjb250YWN0XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuaGFzSGVhZGVyKCdjb250YWN0JykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBbiBlcnJvciBvbiBkaWFsb2cgY3JlYXRpb24gd2lsbCBmaXJlICdmYWlsZWQnIGV2ZW50XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmNyZWF0ZURpYWxvZyhyZXNwb25zZSwgJ1VBQycsIHRydWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gQy5TVEFUVVNfMVhYX1JFQ0VJVkVEO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmhhc0hlYWRlcignUC1Bc3NlcnRlZC1JZGVudGl0eScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hc3NlcnRlZElkZW50aXR5ID0gbmV3IFNJUC5OYW1lQWRkckhlYWRlci5wYXJzZShyZXNwb25zZS5nZXRIZWFkZXIoJ1AtQXNzZXJ0ZWQtSWRlbnRpdHknKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuaGFzSGVhZGVyKCdyZXF1aXJlJykgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5nZXRIZWFkZXIoJ3JlcXVpcmUnKS5pbmRleE9mKCcxMDByZWwnKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBEbyBub3RoaW5nIGlmIHRoaXMuZGlhbG9nIGlzIGFscmVhZHkgY29uZmlybWVkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlhbG9nIHx8ICF0aGlzLmVhcmx5RGlhbG9nc1tpZF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmVhcmx5RGlhbG9nc1tpZF0ucHJhY2tlZC5pbmRleE9mKHJlc3BvbnNlLmdldEhlYWRlcigncnNlcScpKSAhPT0gLTEgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMuZWFybHlEaWFsb2dzW2lkXS5wcmFja2VkW3RoaXMuZWFybHlEaWFsb2dzW2lkXS5wcmFja2VkLmxlbmd0aCAtIDFdID49IHJlc3BvbnNlLmdldEhlYWRlcigncnNlcScpICYmIHRoaXMuZWFybHlEaWFsb2dzW2lkXS5wcmFja2VkLmxlbmd0aCA+IDApKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogVGhpcyBtYXkgYmUgYnJva2VuLiBJdCBtYXkgaGF2ZSB0byBiZSBvbiB0aGUgZWFybHkgZGlhbG9nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyID0gdGhpcy5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyRmFjdG9yeSh0aGlzLCB0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJGYWN0b3J5T3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdTZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyLWNyZWF0ZWQnLCB0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyLmhhc0Rlc2NyaXB0aW9uKHJlc3BvbnNlLmdldEhlYWRlcignQ29udGVudC1UeXBlJykpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhSGVhZGVycy5wdXNoKCdSQWNrOiAnICsgcmVzcG9uc2UuZ2V0SGVhZGVyKCdyc2VxJykgKyAnICcgKyByZXNwb25zZS5nZXRIZWFkZXIoJ2NzZXEnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZWFybHlEaWFsb2dzW2lkXS5wcmFja2VkLnB1c2gocmVzcG9uc2UuZ2V0SGVhZGVyKCdyc2VxJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVhcmx5RGlhbG9nc1tpZF0uc2VuZFJlcXVlc3QodGhpcywgU0lQLkMuUFJBQ0ssIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhSGVhZGVyczogZXh0cmFIZWFkZXJzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ3Byb2dyZXNzJywgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLmhhc09mZmVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5jcmVhdGVEaWFsb2cocmVzcG9uc2UsICdVQUMnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYXNBbnN3ZXIgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpYWxvZy5wcmFja2VkLnB1c2gocmVzcG9uc2UuZ2V0SGVhZGVyKCdyc2VxJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIuc2V0RGVzY3JpcHRpb24ocmVzcG9uc2UuYm9keSwgdGhpcy5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyT3B0aW9ucywgdGhpcy5tb2RpZmllcnMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiBvblN1Y2Nlc3MoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRyYUhlYWRlcnMucHVzaCgnUkFjazogJyArIHJlc3BvbnNlLmdldEhlYWRlcigncnNlcScpICsgJyAnICsgcmVzcG9uc2UuZ2V0SGVhZGVyKCdjc2VxJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5zZW5kUmVxdWVzdChTSVAuQy5QUkFDSywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhSGVhZGVyczogZXh0cmFIZWFkZXJzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpdmVSZXNwb25zZTogZnVuY3Rpb24gKCkgeyB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb24uc3RhdHVzID0gQy5TVEFUVVNfRUFSTFlfTUVESUE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLmVtaXQoJ3Byb2dyZXNzJywgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiBvbkZhaWx1cmUoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5sb2dnZXIud2FybihlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb24uYWNjZXB0QW5kVGVybWluYXRlKHJlc3BvbnNlLCA0ODgsICdOb3QgQWNjZXB0YWJsZSBIZXJlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLmZhaWxlZChyZXNwb25zZSwgU0lQLkMuY2F1c2VzLkJBRF9NRURJQV9ERVNDUklQVElPTik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVhcmx5RGlhbG9nID0gdGhpcy5lYXJseURpYWxvZ3NbaWRdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWFybHlNZWRpYSA9IGVhcmx5RGlhbG9nLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIgPSB0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJGYWN0b3J5KHRoaXMsIHRoaXMuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlckZhY3RvcnlPcHRpb25zKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdTZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyLWNyZWF0ZWQnLCBlYXJseU1lZGlhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWFybHlEaWFsb2cucHJhY2tlZC5wdXNoKHJlc3BvbnNlLmdldEhlYWRlcigncnNlcScpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWFybHlNZWRpYS5zZXREZXNjcmlwdGlvbihyZXNwb25zZS5ib2R5LCBzZXNzaW9uLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJPcHRpb25zLCBzZXNzaW9uLm1vZGlmZXJzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZWFybHlNZWRpYS5nZXREZXNjcmlwdGlvbi5iaW5kKGVhcmx5TWVkaWEsIHNlc3Npb24uc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlck9wdGlvbnMsIHNlc3Npb24ubW9kaWZpZXJzKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIG9uU3VjY2VzcyhkZXNjcmlwdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0cmFIZWFkZXJzLnB1c2goJ1JBY2s6ICcgKyByZXNwb25zZS5nZXRIZWFkZXIoJ3JzZXEnKSArICcgJyArIHJlc3BvbnNlLmdldEhlYWRlcignY3NlcScpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVhcmx5RGlhbG9nLnNlbmRSZXF1ZXN0KHNlc3Npb24sIFNJUC5DLlBSQUNLLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0cmFIZWFkZXJzOiBleHRyYUhlYWRlcnMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9keTogZGVzY3JpcHRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5zdGF0dXMgPSBDLlNUQVRVU19FQVJMWV9NRURJQTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb24uZW1pdCgncHJvZ3Jlc3MnLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gb25GYWlsdXJlKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IFRoaXMgaXMgYSBiaXQgd29ua3lcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgU0lQLkV4Y2VwdGlvbnMuU2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlckVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWFybHlEaWFsb2cucHJhY2tlZC5wdXNoKHJlc3BvbnNlLmdldEhlYWRlcigncnNlcScpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2Vzc2lvbi5zdGF0dXMgPT09IEMuU1RBVFVTX1RFUk1JTkFURUQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLmZhaWxlZChudWxsLCBTSVAuQy5jYXVzZXMuV0VCUlRDX0VSUk9SKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLnRlcm1pbmF0ZWQobnVsbCwgU0lQLkMuY2F1c2VzLldFQlJUQ19FUlJPUik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlYXJseURpYWxvZy5wcmFja2VkLnNwbGljZShlYXJseURpYWxvZy5wcmFja2VkLmluZGV4T2YocmVzcG9uc2UuZ2V0SGVhZGVyKCdyc2VxJykpLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDb3VsZCBub3Qgc2V0IHJlbW90ZSBkZXNjcmlwdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb24ubG9nZ2VyLndhcm4oJ2ludmFsaWQgZGVzY3JpcHRpb24nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLmxvZ2dlci53YXJuKGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ3Byb2dyZXNzJywgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgL14yWzAtOV17Mn0kLy50ZXN0KHJlc3BvbnNlLnN0YXR1c19jb2RlKTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjc2VxID0gdGhpcy5yZXF1ZXN0LmNzZXEgKyAnICcgKyB0aGlzLnJlcXVlc3QubWV0aG9kO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNzZXEgIT09IHJlc3BvbnNlLmdldEhlYWRlcignY3NlcScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuaGFzSGVhZGVyKCdQLUFzc2VydGVkLUlkZW50aXR5JykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFzc2VydGVkSWRlbnRpdHkgPSBuZXcgU0lQLk5hbWVBZGRySGVhZGVyLnBhcnNlKHJlc3BvbnNlLmdldEhlYWRlcignUC1Bc3NlcnRlZC1JZGVudGl0eScpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cyA9PT0gQy5TVEFUVVNfRUFSTFlfTUVESUEgJiYgdGhpcy5kaWFsb2cpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXR1cyA9IEMuU1RBVFVTX0NPTkZJUk1FRDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0ge307XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVuZGVyYm9keSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRyYUhlYWRlcnMucHVzaCgnQ29udGVudC1UeXBlOiAnICsgdGhpcy5yZW5kZXJ0eXBlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5leHRyYUhlYWRlcnMgPSBleHRyYUhlYWRlcnM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYm9keSA9IHRoaXMucmVuZGVyYm9keTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KFwiYWNrXCIsIHJlc3BvbnNlLnRyYW5zYWN0aW9uLnNlbmRBQ0sob3B0aW9ucykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWNjZXB0ZWQocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRG8gbm90aGluZyBpZiB0aGlzLmRpYWxvZyBpcyBhbHJlYWR5IGNvbmZpcm1lZFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlhbG9nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIGFuIGludml0ZSB3aXRob3V0IHNkcFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmhhc09mZmVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZWFybHlEaWFsb2dzW2lkXSAmJiB0aGlzLmVhcmx5RGlhbG9nc1tpZF0uc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1JFVklTSVRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYXNPZmZlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGFzQW5zd2VyID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyID0gdGhpcy5lYXJseURpYWxvZ3NbaWRdLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5jcmVhdGVEaWFsb2cocmVzcG9uc2UsICdVQUMnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSBDLlNUQVRVU19DT05GSVJNRUQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdChcImFja1wiLCByZXNwb25zZS50cmFuc2FjdGlvbi5zZW5kQUNLKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFjY2VwdGVkKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlciA9IHRoaXMuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlckZhY3RvcnkodGhpcywgdGhpcy5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyRmFjdG9yeU9wdGlvbnMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ1Nlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXItY3JlYXRlZCcsIHRoaXMuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyLmhhc0Rlc2NyaXB0aW9uKHJlc3BvbnNlLmdldEhlYWRlcignQ29udGVudC1UeXBlJykpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFjY2VwdEFuZFRlcm1pbmF0ZShyZXNwb25zZSwgNDAwLCAnTWlzc2luZyBzZXNzaW9uIGRlc2NyaXB0aW9uJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZhaWxlZChyZXNwb25zZSwgU0lQLkMuY2F1c2VzLkJBRF9NRURJQV9ERVNDUklQVElPTik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuY3JlYXRlRGlhbG9nKHJlc3BvbnNlLCAnVUFDJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGFzT2ZmZXIgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIuc2V0RGVzY3JpcHRpb24ocmVzcG9uc2UuYm9keSwgdGhpcy5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyT3B0aW9ucywgdGhpcy5tb2RpZmllcnMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbih0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIuZ2V0RGVzY3JpcHRpb24uYmluZCh0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIsIHRoaXMuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlck9wdGlvbnMsIHRoaXMubW9kaWZpZXJzKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIG9uU3VjY2VzcyhkZXNjcmlwdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgbG9jYWxNZWRpYTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZXNzaW9uLmlzQ2FuY2VsZWQgfHwgc2Vzc2lvbi5zdGF0dXMgPT09IEMuU1RBVFVTX1RFUk1JTkFURUQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLnN0YXR1cyA9IEMuU1RBVFVTX0NPTkZJUk1FRDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb24uaGFzQW5zd2VyID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb24uZW1pdChcImFja1wiLCByZXNwb25zZS50cmFuc2FjdGlvbi5zZW5kQUNLKHsgYm9keTogZGVzY3JpcHRpb24gfSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5hY2NlcHRlZChyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gb25GYWlsdXJlKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgU0lQLkV4Y2VwdGlvbnMuU2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlckVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5sb2dnZXIud2FybignaW52YWxpZCBkZXNjcmlwdGlvbicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb24ubG9nZ2VyLndhcm4oZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogVGhpcyBtZXNzYWdlIGlzIGluY29uc2lzdGVudFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb24uYWNjZXB0QW5kVGVybWluYXRlKHJlc3BvbnNlLCA0ODgsICdJbnZhbGlkIHNlc3Npb24gZGVzY3JpcHRpb24nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLmZhaWxlZChyZXNwb25zZSwgU0lQLkMuY2F1c2VzLkJBRF9NRURJQV9ERVNDUklQVElPTik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuaGFzQW5zd2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVuZGVyYm9keSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRyYUhlYWRlcnMucHVzaCgnQ29udGVudC1UeXBlOiAnICsgc2Vzc2lvbi5yZW5kZXJ0eXBlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5leHRyYUhlYWRlcnMgPSBleHRyYUhlYWRlcnM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYm9keSA9IHRoaXMucmVuZGVyYm9keTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KFwiYWNrXCIsIHJlc3BvbnNlLnRyYW5zYWN0aW9uLnNlbmRBQ0sob3B0aW9ucykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIuaGFzRGVzY3JpcHRpb24ocmVzcG9uc2UuZ2V0SGVhZGVyKCdDb250ZW50LVR5cGUnKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hY2NlcHRBbmRUZXJtaW5hdGUocmVzcG9uc2UsIDQwMCwgJ01pc3Npbmcgc2Vzc2lvbiBkZXNjcmlwdGlvbicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZhaWxlZChyZXNwb25zZSwgU0lQLkMuY2F1c2VzLkJBRF9NRURJQV9ERVNDUklQVElPTik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuY3JlYXRlRGlhbG9nKHJlc3BvbnNlLCAnVUFDJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGFzQW5zd2VyID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIuc2V0RGVzY3JpcHRpb24ocmVzcG9uc2UuYm9keSwgdGhpcy5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyT3B0aW9ucywgdGhpcy5tb2RpZmllcnMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIG9uU3VjY2VzcygpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5zdGF0dXMgPSBDLlNUQVRVU19DT05GSVJNRUQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZXNzaW9uLnJlbmRlcmJvZHkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhSGVhZGVycy5wdXNoKCdDb250ZW50LVR5cGU6ICcgKyBzZXNzaW9uLnJlbmRlcnR5cGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5leHRyYUhlYWRlcnMgPSBleHRyYUhlYWRlcnM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmJvZHkgPSBzZXNzaW9uLnJlbmRlcmJvZHk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5lbWl0KFwiYWNrXCIsIHJlc3BvbnNlLnRyYW5zYWN0aW9uLnNlbmRBQ0sob3B0aW9ucykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLmFjY2VwdGVkKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiBvbkZhaWx1cmUoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLmxvZ2dlci53YXJuKGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLmFjY2VwdEFuZFRlcm1pbmF0ZShyZXNwb25zZSwgNDg4LCAnTm90IEFjY2VwdGFibGUgSGVyZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLmZhaWxlZChyZXNwb25zZSwgU0lQLkMuY2F1c2VzLkJBRF9NRURJQV9ERVNDUklQVElPTik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhdXNlID0gU0lQLlV0aWxzLnNpcEVycm9yQ2F1c2UocmVzcG9uc2Uuc3RhdHVzX2NvZGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWplY3RlZChyZXNwb25zZSwgY2F1c2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mYWlsZWQocmVzcG9uc2UsIGNhdXNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGVybWluYXRlZChyZXNwb25zZSwgY2F1c2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSxcbiAgICAgICAgY2FuY2VsOiB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAgICAgICAgICAgICBvcHRpb25zLmV4dHJhSGVhZGVycyA9IChvcHRpb25zLmV4dHJhSGVhZGVycyB8fCBbXSkuc2xpY2UoKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0NhbmNlbGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBTSVAuRXhjZXB0aW9ucy5JbnZhbGlkU3RhdGVFcnJvcignQ0FOQ0VMRUQnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gQ2hlY2sgU2Vzc2lvbiBTdGF0dXNcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMgPT09IEMuU1RBVFVTX1RFUk1JTkFURUQgfHwgdGhpcy5zdGF0dXMgPT09IEMuU1RBVFVTX0NPTkZJUk1FRCkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU0lQLkV4Y2VwdGlvbnMuSW52YWxpZFN0YXRlRXJyb3IodGhpcy5zdGF0dXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ2NhbmNlbGluZyBSVENTZXNzaW9uJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0NhbmNlbGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB2YXIgY2FuY2VsX3JlYXNvbiA9IFNJUC5VdGlscy5nZXRDYW5jZWxSZWFzb24ob3B0aW9ucy5zdGF0dXNfY29kZSwgb3B0aW9ucy5yZWFzb25fcGhyYXNlKTtcbiAgICAgICAgICAgICAgICAvLyBDaGVjayBTZXNzaW9uIFN0YXR1c1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cyA9PT0gQy5TVEFUVVNfTlVMTCB8fFxuICAgICAgICAgICAgICAgICAgICAodGhpcy5zdGF0dXMgPT09IEMuU1RBVFVTX0lOVklURV9TRU5UICYmICF0aGlzLnJlY2VpdmVkXzEwMCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYW5jZWxSZWFzb24gPSBjYW5jZWxfcmVhc29uO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLnN0YXR1cyA9PT0gQy5TVEFUVVNfSU5WSVRFX1NFTlQgfHxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMgPT09IEMuU1RBVFVTXzFYWF9SRUNFSVZFRCB8fFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXR1cyA9PT0gQy5TVEFUVVNfRUFSTFlfTUVESUEpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0LmNhbmNlbChjYW5jZWxfcmVhc29uLCBvcHRpb25zLmV4dHJhSGVhZGVycyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNhbmNlbGVkKCk7XG4gICAgICAgICAgICB9IH0sXG4gICAgICAgIHRlcm1pbmF0ZTogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzID09PSBDLlNUQVRVU19URVJNSU5BVEVEKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMgPT09IEMuU1RBVFVTX1dBSVRJTkdfRk9SX0FDSyB8fCB0aGlzLnN0YXR1cyA9PT0gQy5TVEFUVVNfQ09ORklSTUVEKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYnllKG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYW5jZWwob3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgfSB9LFxuICAgICAgICByZWNlaXZlUmVxdWVzdDogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uIChyZXF1ZXN0KSB7XG4gICAgICAgICAgICAgICAgLy8gSUNDIFJFQ0VJVkUgUkVRVUVTVFxuICAgICAgICAgICAgICAgIC8vIFJlamVjdCBDQU5DRUxzXG4gICAgICAgICAgICAgICAgaWYgKHJlcXVlc3QubWV0aG9kID09PSBTSVAuQy5DQU5DRUwpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzsgbWFrZSB0aGlzIGEgc3dpdGNoIHdoZW4gaXQgZ2V0cyBhZGRlZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocmVxdWVzdC5tZXRob2QgPT09IFNJUC5DLkFDSyAmJiB0aGlzLnN0YXR1cyA9PT0gQy5TVEFUVVNfV0FJVElOR19GT1JfQUNLKSB7XG4gICAgICAgICAgICAgICAgICAgIFNJUC5UaW1lcnMuY2xlYXJUaW1lb3V0KHRoaXMudGltZXJzLmFja1RpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgU0lQLlRpbWVycy5jbGVhclRpbWVvdXQodGhpcy50aW1lcnMuaW52aXRlMnh4VGltZXIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXR1cyA9IEMuU1RBVFVTX0NPTkZJUk1FRDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY2NlcHRlZCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gU2Vzc2lvbi5wcm90b3R5cGUucmVjZWl2ZVJlcXVlc3QuYXBwbHkodGhpcywgW3JlcXVlc3RdKTtcbiAgICAgICAgICAgIH0gfSxcbiAgICAgICAgb25UcmFuc3BvcnRFcnJvcjogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMgIT09IEMuU1RBVFVTX0NPTkZJUk1FRCAmJiB0aGlzLnN0YXR1cyAhPT0gQy5TVEFUVVNfVEVSTUlOQVRFRCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZhaWxlZChudWxsLCBTSVAuQy5jYXVzZXMuQ09OTkVDVElPTl9FUlJPUik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9LFxuICAgICAgICBvblJlcXVlc3RUaW1lb3V0OiB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cyA9PT0gQy5TVEFUVVNfQ09ORklSTUVEKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGVybWluYXRlZChudWxsLCBTSVAuQy5jYXVzZXMuUkVRVUVTVF9USU1FT1VUKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5zdGF0dXMgIT09IEMuU1RBVFVTX1RFUk1JTkFURUQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mYWlsZWQobnVsbCwgU0lQLkMuY2F1c2VzLlJFUVVFU1RfVElNRU9VVCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGVybWluYXRlZChudWxsLCBTSVAuQy5jYXVzZXMuUkVRVUVTVF9USU1FT1VUKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH1cbiAgICB9KTtcbiAgICBTSVAuSW52aXRlQ2xpZW50Q29udGV4dCA9IEludml0ZUNsaWVudENvbnRleHQ7XG4gICAgUmVmZXJDbGllbnRDb250ZXh0ID0gZnVuY3Rpb24gKHVhLCBhcHBsaWNhbnQsIHRhcmdldCwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgICAgICB0aGlzLmV4dHJhSGVhZGVycyA9ICh0aGlzLm9wdGlvbnMuZXh0cmFIZWFkZXJzIHx8IFtdKS5zbGljZSgpO1xuICAgICAgICBpZiAodWEgPT09IHVuZGVmaW5lZCB8fCBhcHBsaWNhbnQgPT09IHVuZGVmaW5lZCB8fCB0YXJnZXQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignTm90IGVub3VnaCBhcmd1bWVudHMnKTtcbiAgICAgICAgfVxuICAgICAgICBTSVAuVXRpbHMuYXVnbWVudCh0aGlzLCBTSVAuQ2xpZW50Q29udGV4dCwgW3VhLCBTSVAuQy5SRUZFUiwgYXBwbGljYW50LnJlbW90ZUlkZW50aXR5LnVyaS50b1N0cmluZygpLCBvcHRpb25zXSk7XG4gICAgICAgIHRoaXMuYXBwbGljYW50ID0gYXBwbGljYW50O1xuICAgICAgICB2YXIgd2l0aFJlcGxhY2VzID0gdGFyZ2V0IGluc3RhbmNlb2YgU0lQLkludml0ZVNlcnZlckNvbnRleHQgfHxcbiAgICAgICAgICAgIHRhcmdldCBpbnN0YW5jZW9mIFNJUC5JbnZpdGVDbGllbnRDb250ZXh0O1xuICAgICAgICBpZiAod2l0aFJlcGxhY2VzKSB7XG4gICAgICAgICAgICAvLyBBdHRlbmRlZCBUcmFuc2ZlclxuICAgICAgICAgICAgLy8gQWxsIG9mIHRoZXNlIGZpZWxkcyBzaG91bGQgYmUgZGVmaW5lZCBiYXNlZCBvbiB0aGUgY2hlY2sgYWJvdmVcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0ID0gJ1wiJyArIHRhcmdldC5yZW1vdGVJZGVudGl0eS5mcmllbmRseU5hbWUgKyAnXCIgJyArXG4gICAgICAgICAgICAgICAgJzwnICsgdGFyZ2V0LmRpYWxvZy5yZW1vdGVfdGFyZ2V0LnRvU3RyaW5nKCkgK1xuICAgICAgICAgICAgICAgICc/UmVwbGFjZXM9JyArIHRhcmdldC5kaWFsb2cuaWQuY2FsbF9pZCArXG4gICAgICAgICAgICAgICAgJyUzQnRvLXRhZyUzRCcgKyB0YXJnZXQuZGlhbG9nLmlkLnJlbW90ZV90YWcgK1xuICAgICAgICAgICAgICAgICclM0Jmcm9tLXRhZyUzRCcgKyB0YXJnZXQuZGlhbG9nLmlkLmxvY2FsX3RhZyArICc+JztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIEJsaW5kIFRyYW5zZmVyXG4gICAgICAgICAgICAvLyBSZWZlci1UbzogPHNpcDpib2JAZXhhbXBsZS5jb20+XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHRoaXMudGFyZ2V0ID0gU0lQLkdyYW1tYXIucGFyc2UodGFyZ2V0LCAnUmVmZXJfVG8nKS51cmkgfHwgdGFyZ2V0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhcIi5yZWZlcigpIGNhbm5vdCBwYXJzZSBSZWZlcl9UbyBmcm9tXCIsIHRhcmdldCk7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIuZGVidWcoXCIuLi5mYWxsaW5nIHRocm91Z2ggdG8gbm9ybWFsaXplVGFyZ2V0KClcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBDaGVjayB0YXJnZXQgdmFsaWRpdHlcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0ID0gdGhpcy51YS5ub3JtYWxpemVUYXJnZXQodGhpcy50YXJnZXQpO1xuICAgICAgICAgICAgaWYgKCF0aGlzLnRhcmdldCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0ludmFsaWQgdGFyZ2V0OiAnICsgdGFyZ2V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy51YSkge1xuICAgICAgICAgICAgdGhpcy5leHRyYUhlYWRlcnMucHVzaCgnUmVmZXJyZWQtQnk6IDwnICsgdGhpcy51YS5jb25maWd1cmF0aW9uLnVyaSArICc+Jyk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVE9ETzogQ2hlY2sgdGhhdCB0aGlzIGlzIGNvcnJlY3QgaXNjL2ljY1xuICAgICAgICB0aGlzLmV4dHJhSGVhZGVycy5wdXNoKCdDb250YWN0OiAnICsgYXBwbGljYW50LmNvbnRhY3QpO1xuICAgICAgICB0aGlzLmV4dHJhSGVhZGVycy5wdXNoKCdBbGxvdzogJyArIFNJUC5VQS5DLkFMTE9XRURfTUVUSE9EUy50b1N0cmluZygpKTtcbiAgICAgICAgdGhpcy5leHRyYUhlYWRlcnMucHVzaCgnUmVmZXItVG86ICcgKyB0aGlzLnRhcmdldCk7XG4gICAgICAgIHRoaXMuZXJyb3JMaXN0ZW5lciA9IHRoaXMub25UcmFuc3BvcnRFcnJvci5iaW5kKHRoaXMpO1xuICAgICAgICB1YS50cmFuc3BvcnQub24oJ3RyYW5zcG9ydEVycm9yJywgdGhpcy5lcnJvckxpc3RlbmVyKTtcbiAgICB9O1xuICAgIFJlZmVyQ2xpZW50Q29udGV4dC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHt9LCB7XG4gICAgICAgIHJlZmVyOiB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAgICAgICAgICAgICB2YXIgZXh0cmFIZWFkZXJzID0gKHRoaXMuZXh0cmFIZWFkZXJzIHx8IFtdKS5zbGljZSgpO1xuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmV4dHJhSGVhZGVycykge1xuICAgICAgICAgICAgICAgICAgICBleHRyYUhlYWRlcnMuY29uY2F0KG9wdGlvbnMuZXh0cmFIZWFkZXJzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5hcHBsaWNhbnQuc2VuZFJlcXVlc3QoU0lQLkMuUkVGRVIsIHtcbiAgICAgICAgICAgICAgICAgICAgZXh0cmFIZWFkZXJzOiB0aGlzLmV4dHJhSGVhZGVycyxcbiAgICAgICAgICAgICAgICAgICAgcmVjZWl2ZVJlc3BvbnNlOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgvXjFbMC05XXsyfSQvLnRlc3QocmVzcG9uc2Uuc3RhdHVzX2NvZGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdyZWZlclJlcXVlc3RQcm9ncmVzcycsIHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoL14yWzAtOV17Mn0kLy50ZXN0KHJlc3BvbnNlLnN0YXR1c19jb2RlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgncmVmZXJSZXF1ZXN0QWNjZXB0ZWQnLCB0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKC9eWzQtNl1bMC05XXsyfSQvLnRlc3QocmVzcG9uc2Uuc3RhdHVzX2NvZGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdyZWZlclJlcXVlc3RSZWplY3RlZCcsIHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMucmVjZWl2ZVJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5yZWNlaXZlUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcylcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH0gfSxcbiAgICAgICAgcmVjZWl2ZU5vdGlmeTogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uIChyZXF1ZXN0KSB7XG4gICAgICAgICAgICAgICAgLy8gSWYgd2UgY2FuIGNvcnJlY3RseSBoYW5kbGUgdGhpcywgdGhlbiB3ZSBuZWVkIHRvIHNlbmQgYSAyMDAgT0shXG4gICAgICAgICAgICAgICAgaWYgKHJlcXVlc3QuaGFzSGVhZGVyKCdDb250ZW50LVR5cGUnKSAmJiByZXF1ZXN0LmdldEhlYWRlcignQ29udGVudC1UeXBlJykuc2VhcmNoKC9ebWVzc2FnZVxcL3NpcGZyYWcvKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VCb2R5ID0gU0lQLkdyYW1tYXIucGFyc2UocmVxdWVzdC5ib2R5LCAnc2lwZnJhZycpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZUJvZHkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnJlcGx5KDQ4OSwgJ0JhZCBFdmVudCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAoL14xWzAtOV17Mn0kLy50ZXN0KG1lc3NhZ2VCb2R5LnN0YXR1c19jb2RlKSk6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdyZWZlclByb2dyZXNzJywgdGhpcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICgvXjJbMC05XXsyfSQvLnRlc3QobWVzc2FnZUJvZHkuc3RhdHVzX2NvZGUpKTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ3JlZmVyQWNjZXB0ZWQnLCB0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5hY3RpdmVBZnRlclRyYW5zZmVyICYmIHRoaXMuYXBwbGljYW50LnRlcm1pbmF0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGxpY2FudC50ZXJtaW5hdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgncmVmZXJSZWplY3RlZCcsIHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3QucmVwbHkoMjAwKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdub3RpZnknLCByZXF1ZXN0KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXF1ZXN0LnJlcGx5KDQ4OSwgJ0JhZCBFdmVudCcpO1xuICAgICAgICAgICAgfSB9XG4gICAgfSk7XG4gICAgU0lQLlJlZmVyQ2xpZW50Q29udGV4dCA9IFJlZmVyQ2xpZW50Q29udGV4dDtcbiAgICBSZWZlclNlcnZlckNvbnRleHQgPSBmdW5jdGlvbiAodWEsIHJlcXVlc3QpIHtcbiAgICAgICAgU0lQLlV0aWxzLmF1Z21lbnQodGhpcywgU0lQLlNlcnZlckNvbnRleHQsIFt1YSwgcmVxdWVzdF0pO1xuICAgICAgICB0aGlzLnVhID0gdWE7XG4gICAgICAgIHRoaXMuc3RhdHVzID0gQy5TVEFUVVNfSU5WSVRFX1JFQ0VJVkVEO1xuICAgICAgICB0aGlzLmZyb21fdGFnID0gcmVxdWVzdC5mcm9tX3RhZztcbiAgICAgICAgdGhpcy5pZCA9IHJlcXVlc3QuY2FsbF9pZCArIHRoaXMuZnJvbV90YWc7XG4gICAgICAgIHRoaXMucmVxdWVzdCA9IHJlcXVlc3Q7XG4gICAgICAgIHRoaXMuY29udGFjdCA9IHRoaXMudWEuY29udGFjdC50b1N0cmluZygpO1xuICAgICAgICB0aGlzLmxvZ2dlciA9IHVhLmdldExvZ2dlcignc2lwLnJlZmVyc2VydmVyY29udGV4dCcsIHRoaXMuaWQpO1xuICAgICAgICAvLyBSRkMgMzUxNSAyLjQuMVxuICAgICAgICBpZiAoIXRoaXMucmVxdWVzdC5oYXNIZWFkZXIoJ3JlZmVyLXRvJykpIHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ0ludmFsaWQgUkVGRVIgcGFja2V0LiBBIHJlZmVyLXRvIGhlYWRlciBpcyByZXF1aXJlZC4gUmVqZWN0aW5nIHJlZmVyLicpO1xuICAgICAgICAgICAgdGhpcy5yZWplY3QoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJlZmVyVG8gPSB0aGlzLnJlcXVlc3QucGFyc2VIZWFkZXIoJ3JlZmVyLXRvJyk7XG4gICAgICAgIC8vIFRPRE86IE11c3Qgc2V0IGV4cGlyYXRpb24gdGltZXIgYW5kIHNlbmQgMjAyIGlmIHRoZXJlIGlzIG5vIHJlc3BvbnNlIGJ5IHRoZW5cbiAgICAgICAgdGhpcy5yZWZlcnJlZFNlc3Npb24gPSB0aGlzLnVhLmZpbmRTZXNzaW9uKHJlcXVlc3QpO1xuICAgICAgICAvLyBOZWVkZWQgdG8gc2VuZCB0aGUgTk9USUZZJ3NcbiAgICAgICAgdGhpcy5jc2VxID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMDApO1xuICAgICAgICB0aGlzLmNhbGxfaWQgPSB0aGlzLnJlcXVlc3QuY2FsbF9pZDtcbiAgICAgICAgdGhpcy5mcm9tX3VyaSA9IHRoaXMucmVxdWVzdC50by51cmk7XG4gICAgICAgIHRoaXMuZnJvbV90YWcgPSB0aGlzLnJlcXVlc3QudG8ucGFyYW1ldGVycy50YWc7XG4gICAgICAgIHRoaXMucmVtb3RlX3RhcmdldCA9IHRoaXMucmVxdWVzdC5oZWFkZXJzLkNvbnRhY3RbMF0ucGFyc2VkLnVyaTtcbiAgICAgICAgdGhpcy50b191cmkgPSB0aGlzLnJlcXVlc3QuZnJvbS51cmk7XG4gICAgICAgIHRoaXMudG9fdGFnID0gdGhpcy5yZXF1ZXN0LmZyb21fdGFnO1xuICAgICAgICB0aGlzLnJvdXRlX3NldCA9IHRoaXMucmVxdWVzdC5nZXRIZWFkZXJzKCdyZWNvcmQtcm91dGUnKTtcbiAgICAgICAgdGhpcy5yZWNlaXZlTm9uSW52aXRlUmVzcG9uc2UgPSBmdW5jdGlvbiAoKSB7IH07XG4gICAgICAgIGlmICh0aGlzLnJlcXVlc3QuaGFzSGVhZGVyKCdyZWZlcnJlZC1ieScpKSB7XG4gICAgICAgICAgICB0aGlzLnJlZmVycmVkQnkgPSB0aGlzLnJlcXVlc3QuZ2V0SGVhZGVyKCdyZWZlcnJlZC1ieScpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnJlZmVyVG8udXJpLmhhc0hlYWRlcigncmVwbGFjZXMnKSkge1xuICAgICAgICAgICAgdGhpcy5yZXBsYWNlcyA9IHRoaXMucmVmZXJUby51cmkuZ2V0SGVhZGVyKCdyZXBsYWNlcycpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZXJyb3JMaXN0ZW5lciA9IHRoaXMub25UcmFuc3BvcnRFcnJvci5iaW5kKHRoaXMpO1xuICAgICAgICB1YS50cmFuc3BvcnQub24oJ3RyYW5zcG9ydEVycm9yJywgdGhpcy5lcnJvckxpc3RlbmVyKTtcbiAgICAgICAgdGhpcy5zdGF0dXMgPSBDLlNUQVRVU19XQUlUSU5HX0ZPUl9BTlNXRVI7XG4gICAgfTtcbiAgICBSZWZlclNlcnZlckNvbnRleHQucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSh7fSwge1xuICAgICAgICBwcm9ncmVzczogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMgIT09IEMuU1RBVFVTX1dBSVRJTkdfRk9SX0FOU1dFUikge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU0lQLkV4Y2VwdGlvbnMuSW52YWxpZFN0YXRlRXJyb3IodGhpcy5zdGF0dXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnJlcXVlc3QucmVwbHkoMTAwKTtcbiAgICAgICAgICAgIH0gfSxcbiAgICAgICAgcmVqZWN0OiB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMgPT09IEMuU1RBVFVTX1RFUk1JTkFURUQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNJUC5FeGNlcHRpb25zLkludmFsaWRTdGF0ZUVycm9yKHRoaXMuc3RhdHVzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKCdSZWplY3RpbmcgcmVmZXInKTtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXR1cyA9IEMuU1RBVFVTX1RFUk1JTkFURUQ7XG4gICAgICAgICAgICAgICAgU0lQLlNlcnZlckNvbnRleHQucHJvdG90eXBlLnJlamVjdC5jYWxsKHRoaXMsIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgncmVmZXJSZXF1ZXN0UmVqZWN0ZWQnLCB0aGlzKTtcbiAgICAgICAgICAgIH0gfSxcbiAgICAgICAgYWNjZXB0OiB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogZnVuY3Rpb24gKG9wdGlvbnMsIG1vZGlmaWVycykge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cyA9PT0gQy5TVEFUVVNfV0FJVElOR19GT1JfQU5TV0VSKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gQy5TVEFUVVNfQU5TV0VSRUQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU0lQLkV4Y2VwdGlvbnMuSW52YWxpZFN0YXRlRXJyb3IodGhpcy5zdGF0dXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnJlcXVlc3QucmVwbHkoMjAyLCAnQWNjZXB0ZWQnKTtcbiAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ3JlZmVyUmVxdWVzdEFjY2VwdGVkJywgdGhpcyk7XG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuZm9sbG93UmVmZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKCdBY2NlcHRlZCByZWZlciwgYXR0ZW1wdGluZyB0byBhdXRvbWF0aWNhbGx5IGZvbGxvdyBpdCcpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5yZWZlclRvLnVyaTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0YXJnZXQuc2NoZW1lLm1hdGNoKFwiXnNpcHM/JFwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ1NJUC5qcyBjYW4gb25seSBhdXRvbWF0aWNhbGx5IGZvbGxvdyBTSVAgcmVmZXIgdGFyZ2V0Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlamVjdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhciBpbnZpdGVPcHRpb25zID0gb3B0aW9ucy5pbnZpdGVPcHRpb25zIHx8IHt9O1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXh0cmFIZWFkZXJzID0gKGludml0ZU9wdGlvbnMuZXh0cmFIZWFkZXJzIHx8IFtdKS5zbGljZSgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5yZXBsYWNlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZGVjb2RlVVJJQ29tcG9uZW50IGlzIGEgaG9sZG92ZXIgZnJvbSAyYzA4NmViNC4gTm90IHN1cmUgdGhhdCBpdCBpcyBhY3R1YWxseSBuZWNlc3NhcnlcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhSGVhZGVycy5wdXNoKCdSZXBsYWNlczogJyArIGRlY29kZVVSSUNvbXBvbmVudCh0aGlzLnJlcGxhY2VzKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVmZXJyZWRCeSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXh0cmFIZWFkZXJzLnB1c2goJ1JlZmVycmVkLUJ5OiAnICsgdGhpcy5yZWZlcnJlZEJ5KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpbnZpdGVPcHRpb25zLmV4dHJhSGVhZGVycyA9IGV4dHJhSGVhZGVycztcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LmNsZWFySGVhZGVycygpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRhcmdldFNlc3Npb24gPSB0aGlzLnVhLmludml0ZSh0YXJnZXQsIGludml0ZU9wdGlvbnMsIG1vZGlmaWVycyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgncmVmZXJJbnZpdGVTZW50JywgdGhpcyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGFyZ2V0U2Vzc2lvbi5vbmNlKCdwcm9ncmVzcycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VuZE5vdGlmeSgnU0lQLzIuMCAxMDAgVHJ5aW5nJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ3JlZmVyUHJvZ3Jlc3MnLCB0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlZmVycmVkU2Vzc2lvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVmZXJyZWRTZXNzaW9uLmVtaXQoJ3JlZmVyUHJvZ3Jlc3MnLCB0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50YXJnZXRTZXNzaW9uLm9uY2UoJ2FjY2VwdGVkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKCdTdWNjZXNzZnVsbHkgZm9sbG93ZWQgdGhlIHJlZmVyJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbmROb3RpZnkoJ1NJUC8yLjAgMjAwIE9LJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ3JlZmVyQWNjZXB0ZWQnLCB0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlZmVycmVkU2Vzc2lvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVmZXJyZWRTZXNzaW9uLmVtaXQoJ3JlZmVyQWNjZXB0ZWQnLCB0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlZmVyRmFpbGVkID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMgPT09IEMuU1RBVFVTX1RFUk1JTkFURUQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47IC8vIE5vIHRocm93IGhlcmUgYmVjYXVzZSBpdCBpcyBwb3NzaWJsZSB0aGlzIGdldHMgY2FsbGVkIG11bHRpcGxlIHRpbWVzXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ1JlZmVyIHdhcyBub3Qgc3VjY2Vzc2Z1bC4gUmVzdW1pbmcgc2Vzc2lvbicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09PSA0MjkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ0FsZXJ0aW5nIHJlZmVycmVyIHRoYXQgaWRlbnRpdHkgaXMgcmVxdWlyZWQuJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZW5kTm90aWZ5KCdTSVAvMi4wIDQyOSBQcm92aWRlIFJlZmVycmVyIElkZW50aXR5Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZW5kTm90aWZ5KCdTSVAvMi4wIDYwMyBEZWNsaW5lZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gTXVzdCBjaGFuZ2UgdGhlIHN0YXR1cyBhZnRlciBzZW5kaW5nIHRoZSBmaW5hbCBOb3RpZnkgb3IgaXQgd2lsbCBub3Qgc2VuZCBkdWUgdG8gY2hlY2tcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gQy5TVEFUVVNfVEVSTUlOQVRFRDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgncmVmZXJSZWplY3RlZCcsIHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVmZXJyZWRTZXNzaW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWZlcnJlZFNlc3Npb24uZW1pdCgncmVmZXJSZWplY3RlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRhcmdldFNlc3Npb24ub25jZSgncmVqZWN0ZWQnLCByZWZlckZhaWxlZC5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50YXJnZXRTZXNzaW9uLm9uY2UoJ2ZhaWxlZCcsIHJlZmVyRmFpbGVkLmJpbmQodGhpcykpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKCdBY2NlcHRlZCByZWZlciwgYnV0IGRpZCBub3QgYXV0b21hdGljYWxseSBmb2xsb3cgaXQnKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZW5kTm90aWZ5KCdTSVAvMi4wIDIwMCBPSycpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ3JlZmVyQWNjZXB0ZWQnLCB0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVmZXJyZWRTZXNzaW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZmVycmVkU2Vzc2lvbi5lbWl0KCdyZWZlckFjY2VwdGVkJywgdGhpcyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0sXG4gICAgICAgIHNlbmROb3RpZnk6IHsgd3JpdGFibGU6IHRydWUsIHZhbHVlOiBmdW5jdGlvbiAoYm9keSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cyAhPT0gQy5TVEFUVVNfQU5TV0VSRUQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNJUC5FeGNlcHRpb25zLkludmFsaWRTdGF0ZUVycm9yKHRoaXMuc3RhdHVzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKFNJUC5HcmFtbWFyLnBhcnNlKGJvZHksICdzaXBmcmFnJykgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignc2lwZnJhZyBib2R5IGlzIHJlcXVpcmVkIHRvIHNlbmQgbm90aWZ5IGZvciByZWZlcicpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IG5ldyBTSVAuT3V0Z29pbmdSZXF1ZXN0KFNJUC5DLk5PVElGWSwgdGhpcy5yZW1vdGVfdGFyZ2V0LCB0aGlzLnVhLCB7XG4gICAgICAgICAgICAgICAgICAgIGNzZXE6IHRoaXMuY3NlcSArPSAxLFxuICAgICAgICAgICAgICAgICAgICBjYWxsX2lkOiB0aGlzLmNhbGxfaWQsXG4gICAgICAgICAgICAgICAgICAgIGZyb21fdXJpOiB0aGlzLmZyb21fdXJpLFxuICAgICAgICAgICAgICAgICAgICBmcm9tX3RhZzogdGhpcy5mcm9tX3RhZyxcbiAgICAgICAgICAgICAgICAgICAgdG9fdXJpOiB0aGlzLnRvX3VyaSxcbiAgICAgICAgICAgICAgICAgICAgdG9fdGFnOiB0aGlzLnRvX3RhZyxcbiAgICAgICAgICAgICAgICAgICAgcm91dGVfc2V0OiB0aGlzLnJvdXRlX3NldFxuICAgICAgICAgICAgICAgIH0sIFtcbiAgICAgICAgICAgICAgICAgICAgJ0V2ZW50OiByZWZlcicsXG4gICAgICAgICAgICAgICAgICAgICdTdWJzY3JpcHRpb24tU3RhdGU6IHRlcm1pbmF0ZWQnLFxuICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlOiBtZXNzYWdlL3NpcGZyYWcnXG4gICAgICAgICAgICAgICAgXSwgYm9keSk7XG4gICAgICAgICAgICAgICAgbmV3IFNJUC5SZXF1ZXN0U2VuZGVyKHtcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdDogcmVxdWVzdCxcbiAgICAgICAgICAgICAgICAgICAgb25SZXF1ZXN0VGltZW91dDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvblRyYW5zcG9ydEVycm9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHJlY2VpdmVSZXNwb25zZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgdGhpcy51YSkuc2VuZCgpO1xuICAgICAgICAgICAgfSB9XG4gICAgfSk7XG4gICAgU0lQLlJlZmVyU2VydmVyQ29udGV4dCA9IFJlZmVyU2VydmVyQ29udGV4dDtcbn07XG5cblxuLyoqKi8gfSksXG4vKiAyNCAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cInVzZSBzdHJpY3RcIjtcblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IERUTUZcbiAqL1xuLyoqXG4gKiBAY2xhc3MgRFRNRlxuICogQHBhcmFtIHtTSVAuU2Vzc2lvbn0gc2Vzc2lvblxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChTSVApIHtcbiAgICB2YXIgRFRNRiwgQyA9IHtcbiAgICAgICAgTUlOX0RVUkFUSU9OOiA3MCxcbiAgICAgICAgTUFYX0RVUkFUSU9OOiA2MDAwLFxuICAgICAgICBERUZBVUxUX0RVUkFUSU9OOiAxMDAsXG4gICAgICAgIE1JTl9JTlRFUl9UT05FX0dBUDogNTAsXG4gICAgICAgIERFRkFVTFRfSU5URVJfVE9ORV9HQVA6IDUwMFxuICAgIH07XG4gICAgRFRNRiA9IGZ1bmN0aW9uIChzZXNzaW9uLCB0b25lLCBvcHRpb25zKSB7XG4gICAgICAgIHZhciBkdXJhdGlvbiwgaW50ZXJUb25lR2FwO1xuICAgICAgICBpZiAodG9uZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdOb3QgZW5vdWdoIGFyZ3VtZW50cycpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubG9nZ2VyID0gc2Vzc2lvbi51YS5nZXRMb2dnZXIoJ3NpcC5pbnZpdGVjb250ZXh0LmR0bWYnLCBzZXNzaW9uLmlkKTtcbiAgICAgICAgdGhpcy5vd25lciA9IHNlc3Npb247XG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gbnVsbDtcbiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgICAgIGR1cmF0aW9uID0gb3B0aW9ucy5kdXJhdGlvbiB8fCBudWxsO1xuICAgICAgICBpbnRlclRvbmVHYXAgPSBvcHRpb25zLmludGVyVG9uZUdhcCB8fCBudWxsO1xuICAgICAgICAvLyBDaGVjayB0b25lIHR5cGVcbiAgICAgICAgaWYgKHR5cGVvZiB0b25lID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgdG9uZSA9IHRvbmUudG9VcHBlckNhc2UoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0eXBlb2YgdG9uZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIHRvbmUgPSB0b25lLnRvU3RyaW5nKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdJbnZhbGlkIHRvbmU6ICcgKyB0b25lKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBDaGVjayB0b25lIHZhbHVlXG4gICAgICAgIGlmICghdG9uZS5tYXRjaCgvXlswLTlBLUQjKl0kLykpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0ludmFsaWQgdG9uZTogJyArIHRvbmUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy50b25lID0gdG9uZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBDaGVjayBkdXJhdGlvblxuICAgICAgICBpZiAoZHVyYXRpb24gJiYgIVNJUC5VdGlscy5pc0RlY2ltYWwoZHVyYXRpb24pKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdJbnZhbGlkIHRvbmUgZHVyYXRpb246ICcgKyBkdXJhdGlvbik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIWR1cmF0aW9uKSB7XG4gICAgICAgICAgICBkdXJhdGlvbiA9IERUTUYuQy5ERUZBVUxUX0RVUkFUSU9OO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGR1cmF0aW9uIDwgRFRNRi5DLk1JTl9EVVJBVElPTikge1xuICAgICAgICAgICAgdGhpcy5sb2dnZXIud2FybignXCJkdXJhdGlvblwiIHZhbHVlIGlzIGxvd2VyIHRoYW4gdGhlIG1pbmltdW0gYWxsb3dlZCwgc2V0dGluZyBpdCB0byAnICsgRFRNRi5DLk1JTl9EVVJBVElPTiArICcgbWlsbGlzZWNvbmRzJyk7XG4gICAgICAgICAgICBkdXJhdGlvbiA9IERUTUYuQy5NSU5fRFVSQVRJT047XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZHVyYXRpb24gPiBEVE1GLkMuTUFYX0RVUkFUSU9OKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuKCdcImR1cmF0aW9uXCIgdmFsdWUgaXMgZ3JlYXRlciB0aGFuIHRoZSBtYXhpbXVtIGFsbG93ZWQsIHNldHRpbmcgaXQgdG8gJyArIERUTUYuQy5NQVhfRFVSQVRJT04gKyAnIG1pbGxpc2Vjb25kcycpO1xuICAgICAgICAgICAgZHVyYXRpb24gPSBEVE1GLkMuTUFYX0RVUkFUSU9OO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZHVyYXRpb24gPSBNYXRoLmFicyhkdXJhdGlvbik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5kdXJhdGlvbiA9IGR1cmF0aW9uO1xuICAgICAgICAvLyBDaGVjayBpbnRlclRvbmVHYXBcbiAgICAgICAgaWYgKGludGVyVG9uZUdhcCAmJiAhU0lQLlV0aWxzLmlzRGVjaW1hbChpbnRlclRvbmVHYXApKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdJbnZhbGlkIGludGVyVG9uZUdhcDogJyArIGludGVyVG9uZUdhcCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIWludGVyVG9uZUdhcCkge1xuICAgICAgICAgICAgaW50ZXJUb25lR2FwID0gRFRNRi5DLkRFRkFVTFRfSU5URVJfVE9ORV9HQVA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoaW50ZXJUb25lR2FwIDwgRFRNRi5DLk1JTl9JTlRFUl9UT05FX0dBUCkge1xuICAgICAgICAgICAgdGhpcy5sb2dnZXIud2FybignXCJpbnRlclRvbmVHYXBcIiB2YWx1ZSBpcyBsb3dlciB0aGFuIHRoZSBtaW5pbXVtIGFsbG93ZWQsIHNldHRpbmcgaXQgdG8gJyArIERUTUYuQy5NSU5fSU5URVJfVE9ORV9HQVAgKyAnIG1pbGxpc2Vjb25kcycpO1xuICAgICAgICAgICAgaW50ZXJUb25lR2FwID0gRFRNRi5DLk1JTl9JTlRFUl9UT05FX0dBUDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGludGVyVG9uZUdhcCA9IE1hdGguYWJzKGludGVyVG9uZUdhcCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5pbnRlclRvbmVHYXAgPSBpbnRlclRvbmVHYXA7XG4gICAgfTtcbiAgICBEVE1GLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoU0lQLkV2ZW50RW1pdHRlci5wcm90b3R5cGUpO1xuICAgIERUTUYucHJvdG90eXBlLnNlbmQgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICB2YXIgZXh0cmFIZWFkZXJzLCBib2R5ID0ge307XG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gJ291dGdvaW5nJztcbiAgICAgICAgLy8gQ2hlY2sgUlRDU2Vzc2lvbiBTdGF0dXNcbiAgICAgICAgaWYgKHRoaXMub3duZXIuc3RhdHVzICE9PSBTSVAuU2Vzc2lvbi5DLlNUQVRVU19DT05GSVJNRUQgJiZcbiAgICAgICAgICAgIHRoaXMub3duZXIuc3RhdHVzICE9PSBTSVAuU2Vzc2lvbi5DLlNUQVRVU19XQUlUSU5HX0ZPUl9BQ0spIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBTSVAuRXhjZXB0aW9ucy5JbnZhbGlkU3RhdGVFcnJvcih0aGlzLm93bmVyLnN0YXR1cyk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gR2V0IERUTUYgb3B0aW9uc1xuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAgICAgZXh0cmFIZWFkZXJzID0gb3B0aW9ucy5leHRyYUhlYWRlcnMgPyBvcHRpb25zLmV4dHJhSGVhZGVycy5zbGljZSgpIDogW107XG4gICAgICAgIGJvZHkuY29udGVudFR5cGUgPSAnYXBwbGljYXRpb24vZHRtZi1yZWxheSc7XG4gICAgICAgIGJvZHkuYm9keSA9IFwiU2lnbmFsPSBcIiArIHRoaXMudG9uZSArIFwiXFxyXFxuXCI7XG4gICAgICAgIGJvZHkuYm9keSArPSBcIkR1cmF0aW9uPSBcIiArIHRoaXMuZHVyYXRpb247XG4gICAgICAgIHRoaXMucmVxdWVzdCA9IHRoaXMub3duZXIuZGlhbG9nLnNlbmRSZXF1ZXN0KHRoaXMsIFNJUC5DLklORk8sIHtcbiAgICAgICAgICAgIGV4dHJhSGVhZGVyczogZXh0cmFIZWFkZXJzLFxuICAgICAgICAgICAgYm9keTogYm9keVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5vd25lci5lbWl0KCdkdG1mJywgdGhpcy5yZXF1ZXN0LCB0aGlzKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgRFRNRi5wcm90b3R5cGUucmVjZWl2ZVJlc3BvbnNlID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgIHZhciBjYXVzZTtcbiAgICAgICAgc3dpdGNoICh0cnVlKSB7XG4gICAgICAgICAgICBjYXNlIC9eMVswLTldezJ9JC8udGVzdChyZXNwb25zZS5zdGF0dXNfY29kZSk6XG4gICAgICAgICAgICAgICAgLy8gSWdub3JlIHByb3Zpc2lvbmFsIHJlc3BvbnNlcy5cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgL14yWzAtOV17Mn0kLy50ZXN0KHJlc3BvbnNlLnN0YXR1c19jb2RlKTpcbiAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ3N1Y2NlZWRlZCcsIHtcbiAgICAgICAgICAgICAgICAgICAgb3JpZ2luYXRvcjogJ3JlbW90ZScsXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlOiByZXNwb25zZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBjYXVzZSA9IFNJUC5VdGlscy5zaXBFcnJvckNhdXNlKHJlc3BvbnNlLnN0YXR1c19jb2RlKTtcbiAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ2ZhaWxlZCcsIHJlc3BvbnNlLCBjYXVzZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgRFRNRi5wcm90b3R5cGUub25SZXF1ZXN0VGltZW91dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5lbWl0KCdmYWlsZWQnLCBudWxsLCBTSVAuQy5jYXVzZXMuUkVRVUVTVF9USU1FT1VUKTtcbiAgICAgICAgdGhpcy5vd25lci5vblJlcXVlc3RUaW1lb3V0KCk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIERUTUYucHJvdG90eXBlLm9uVHJhbnNwb3J0RXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuZW1pdCgnZmFpbGVkJywgbnVsbCwgU0lQLkMuY2F1c2VzLkNPTk5FQ1RJT05fRVJST1IpO1xuICAgICAgICB0aGlzLm93bmVyLm9uVHJhbnNwb3J0RXJyb3IoKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgRFRNRi5wcm90b3R5cGUub25EaWFsb2dFcnJvciA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICB0aGlzLmVtaXQoJ2ZhaWxlZCcsIHJlc3BvbnNlLCBTSVAuQy5jYXVzZXMuRElBTE9HX0VSUk9SKTtcbiAgICAgICAgdGhpcy5vd25lci5vbkRpYWxvZ0Vycm9yKHJlc3BvbnNlKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgRFRNRi5wcm90b3R5cGUuaW5pdF9pbmNvbWluZyA9IGZ1bmN0aW9uIChyZXF1ZXN0KSB7XG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gJ2luY29taW5nJztcbiAgICAgICAgdGhpcy5yZXF1ZXN0ID0gcmVxdWVzdDtcbiAgICAgICAgcmVxdWVzdC5yZXBseSgyMDApO1xuICAgICAgICBpZiAoIXRoaXMudG9uZSB8fCAhdGhpcy5kdXJhdGlvbikge1xuICAgICAgICAgICAgdGhpcy5sb2dnZXIud2FybignaW52YWxpZCBJTkZPIERUTUYgcmVjZWl2ZWQsIGRpc2NhcmRlZCcpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5vd25lci5lbWl0KCdkdG1mJywgcmVxdWVzdCwgdGhpcyk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIERUTUYuQyA9IEM7XG4gICAgcmV0dXJuIERUTUY7XG59O1xuXG5cbi8qKiovIH0pLFxuLyogMjUgKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBTSVAgU3Vic2NyaWJlciAoU0lQLVNwZWNpZmljIEV2ZW50IE5vdGlmaWNhdGlvbnMgUkZDNjY2NSlcbiAqL1xuLyoqXG4gKiBAYXVnbWVudHMgU0lQXG4gKiBAY2xhc3MgQ2xhc3MgY3JlYXRpbmcgYSBTSVAgU3Vic2NyaXB0aW9uLlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChTSVApIHtcbiAgICBTSVAuU3Vic2NyaXB0aW9uID0gZnVuY3Rpb24gKHVhLCB0YXJnZXQsIGV2ZW50LCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSBPYmplY3QuY3JlYXRlKG9wdGlvbnMgfHwgT2JqZWN0LnByb3RvdHlwZSk7XG4gICAgICAgIHRoaXMuZXh0cmFIZWFkZXJzID0gb3B0aW9ucy5leHRyYUhlYWRlcnMgPSAob3B0aW9ucy5leHRyYUhlYWRlcnMgfHwgW10pLnNsaWNlKCk7XG4gICAgICAgIHRoaXMuaWQgPSBudWxsO1xuICAgICAgICB0aGlzLnN0YXRlID0gJ2luaXQnO1xuICAgICAgICBpZiAoIWV2ZW50KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdFdmVudCBuZWNlc3NhcnkgdG8gY3JlYXRlIGEgc3Vic2NyaXB0aW9uLicpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy9UT0RPOiBjaGVjayBmb3IgdmFsaWQgZXZlbnRzIGhlcmUgcHJvYmFibHkgbWFrZSBhIGxpc3QgaW4gU0lQLkM7IG9yIGxlYXZlIGl0IHVwIHRvIGFwcCB0byBjaGVjaz9cbiAgICAgICAgICAgIC8vVGhlIGNoZWNrIG1heSBuZWVkIHRvL3Nob3VsZCBwcm9iYWJseSBvY2N1ciBvbiB0aGUgb3RoZXIgc2lkZSxcbiAgICAgICAgICAgIHRoaXMuZXZlbnQgPSBldmVudDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMuZXhwaXJlcyAhPT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIHVhLmxvZ2dlci53YXJuKCdleHBpcmVzIG11c3QgYmUgYSBudW1iZXIuIFVzaW5nIGRlZmF1bHQgb2YgMzYwMC4nKTtcbiAgICAgICAgICAgIHRoaXMuZXhwaXJlcyA9IDM2MDA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmV4cGlyZXMgPSBvcHRpb25zLmV4cGlyZXM7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZXF1ZXN0ZWRFeHBpcmVzID0gdGhpcy5leHBpcmVzO1xuICAgICAgICBvcHRpb25zLmV4dHJhSGVhZGVycy5wdXNoKCdFdmVudDogJyArIHRoaXMuZXZlbnQpO1xuICAgICAgICBvcHRpb25zLmV4dHJhSGVhZGVycy5wdXNoKCdFeHBpcmVzOiAnICsgdGhpcy5leHBpcmVzKTtcbiAgICAgICAgaWYgKG9wdGlvbnMuYm9keSkge1xuICAgICAgICAgICAgdGhpcy5ib2R5ID0gb3B0aW9ucy5ib2R5O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY29udGFjdCA9IHVhLmNvbnRhY3QudG9TdHJpbmcoKTtcbiAgICAgICAgb3B0aW9ucy5leHRyYUhlYWRlcnMucHVzaCgnQ29udGFjdDogJyArIHRoaXMuY29udGFjdCk7XG4gICAgICAgIG9wdGlvbnMuZXh0cmFIZWFkZXJzLnB1c2goJ0FsbG93OiAnICsgU0lQLlVBLkMuQUxMT1dFRF9NRVRIT0RTLnRvU3RyaW5nKCkpO1xuICAgICAgICBTSVAuVXRpbHMuYXVnbWVudCh0aGlzLCBTSVAuQ2xpZW50Q29udGV4dCwgW3VhLCBTSVAuQy5TVUJTQ1JJQkUsIHRhcmdldCwgb3B0aW9uc10pO1xuICAgICAgICB0aGlzLmxvZ2dlciA9IHVhLmdldExvZ2dlcignc2lwLnN1YnNjcmlwdGlvbicpO1xuICAgICAgICB0aGlzLmRpYWxvZyA9IG51bGw7XG4gICAgICAgIHRoaXMudGltZXJzID0geyBOOiBudWxsLCBzdWJfZHVyYXRpb246IG51bGwgfTtcbiAgICAgICAgdGhpcy5lcnJvckNvZGVzID0gWzQwNCwgNDA1LCA0MTAsIDQxNiwgNDgwLCA0ODEsIDQ4MiwgNDgzLCA0ODQsIDQ4NSwgNDg5LCA1MDEsIDYwNF07XG4gICAgfTtcbiAgICBTSVAuU3Vic2NyaXB0aW9uLnByb3RvdHlwZSA9IHtcbiAgICAgICAgc3Vic2NyaWJlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgc3ViID0gdGhpcztcbiAgICAgICAgICAgIC8vdGhlc2Ugc3RhdGVzIHBvaW50IHRvIGFuIGV4aXN0aW5nIHN1YnNjcmlwdGlvbiwgbm8gc3Vic2NyaWJlIGlzIG5lY2Vzc2FyeVxuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUgPT09ICdhY3RpdmUnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZWZyZXNoKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLnN0YXRlID09PSAnbm90aWZ5X3dhaXQnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBTSVAuVGltZXJzLmNsZWFyVGltZW91dCh0aGlzLnRpbWVycy5zdWJfZHVyYXRpb24pO1xuICAgICAgICAgICAgU0lQLlRpbWVycy5jbGVhclRpbWVvdXQodGhpcy50aW1lcnMuTik7XG4gICAgICAgICAgICB0aGlzLnRpbWVycy5OID0gU0lQLlRpbWVycy5zZXRUaW1lb3V0KHN1Yi50aW1lcl9maXJlLmJpbmQoc3ViKSwgU0lQLlRpbWVycy5USU1FUl9OKTtcbiAgICAgICAgICAgIHRoaXMudWEuZWFybHlTdWJzY3JpcHRpb25zW3RoaXMucmVxdWVzdC5jYWxsX2lkICsgdGhpcy5yZXF1ZXN0LmZyb20ucGFyYW1ldGVycy50YWcgKyB0aGlzLmV2ZW50XSA9IHRoaXM7XG4gICAgICAgICAgICB0aGlzLnNlbmQoKTtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSAnbm90aWZ5X3dhaXQnO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG4gICAgICAgIHJlZnJlc2g6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlID09PSAndGVybWluYXRlZCcgfHwgdGhpcy5zdGF0ZSA9PT0gJ3BlbmRpbmcnIHx8IHRoaXMuc3RhdGUgPT09ICdub3RpZnlfd2FpdCcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmRpYWxvZy5zZW5kUmVxdWVzdCh0aGlzLCBTSVAuQy5TVUJTQ1JJQkUsIHtcbiAgICAgICAgICAgICAgICBleHRyYUhlYWRlcnM6IHRoaXMuZXh0cmFIZWFkZXJzLFxuICAgICAgICAgICAgICAgIGJvZHk6IHRoaXMuYm9keVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHJlY2VpdmVSZXNwb25zZTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICB2YXIgZXhwaXJlcywgc3ViID0gdGhpcywgY2F1c2UgPSBTSVAuVXRpbHMuZ2V0UmVhc29uUGhyYXNlKHJlc3BvbnNlLnN0YXR1c19jb2RlKTtcbiAgICAgICAgICAgIGlmICgodGhpcy5zdGF0ZSA9PT0gJ25vdGlmeV93YWl0JyAmJiByZXNwb25zZS5zdGF0dXNfY29kZSA+PSAzMDApIHx8XG4gICAgICAgICAgICAgICAgKHRoaXMuc3RhdGUgIT09ICdub3RpZnlfd2FpdCcgJiYgdGhpcy5lcnJvckNvZGVzLmluZGV4T2YocmVzcG9uc2Uuc3RhdHVzX2NvZGUpICE9PSAtMSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZhaWxlZChyZXNwb25zZSwgbnVsbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICgvXjJbMC05XXsyfSQvLnRlc3QocmVzcG9uc2Uuc3RhdHVzX2NvZGUpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdhY2NlcHRlZCcsIHJlc3BvbnNlLCBjYXVzZSk7XG4gICAgICAgICAgICAgICAgLy9BcyB3ZSBkb24ndCBzdXBwb3J0IFJGQyA1ODM5IG9yIG90aGVyIGV4dGVuc2lvbnMgd2hlcmUgdGhlIE5PVElGWSBpcyBvcHRpb25hbCwgdGltZXIgTiB3aWxsIG5vdCBiZSBjbGVhcmVkXG4gICAgICAgICAgICAgICAgLy9TSVAuVGltZXJzLmNsZWFyVGltZW91dCh0aGlzLnRpbWVycy5OKTtcbiAgICAgICAgICAgICAgICBleHBpcmVzID0gcmVzcG9uc2UuZ2V0SGVhZGVyKCdFeHBpcmVzJyk7XG4gICAgICAgICAgICAgICAgaWYgKGV4cGlyZXMgJiYgZXhwaXJlcyA8PSB0aGlzLnJlcXVlc3RlZEV4cGlyZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gUHJlc2VydmUgbmV3IGV4cGlyZXMgdmFsdWUgZm9yIHN1YnNlcXVlbnQgcmVxdWVzdHNcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5leHBpcmVzID0gZXhwaXJlcztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50aW1lcnMuc3ViX2R1cmF0aW9uID0gU0lQLlRpbWVycy5zZXRUaW1lb3V0KHN1Yi5yZWZyZXNoLmJpbmQoc3ViKSwgZXhwaXJlcyAqIDkwMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWV4cGlyZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ0V4cGlyZXMgaGVhZGVyIG1pc3NpbmcgaW4gYSAyMDAtY2xhc3MgcmVzcG9uc2UgdG8gU1VCU0NSSUJFJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZhaWxlZChyZXNwb25zZSwgU0lQLkMuRVhQSVJFU19IRUFERVJfTUlTU0lORyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuKCdFeHBpcmVzIGhlYWRlciBpbiBhIDIwMC1jbGFzcyByZXNwb25zZSB0byBTVUJTQ1JJQkUgd2l0aCBhIGhpZ2hlciB2YWx1ZSB0aGFuIHRoZSBvbmUgaW4gdGhlIHJlcXVlc3QnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmFpbGVkKHJlc3BvbnNlLCBTSVAuQy5JTlZBTElEX0VYUElSRVNfSEVBREVSKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1c0NvZGUgPiAzMDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ2ZhaWxlZCcsIHJlc3BvbnNlLCBjYXVzZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdyZWplY3RlZCcsIHJlc3BvbnNlLCBjYXVzZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHVuc3Vic2NyaWJlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgZXh0cmFIZWFkZXJzID0gW10sIHN1YiA9IHRoaXM7XG4gICAgICAgICAgICB0aGlzLnN0YXRlID0gJ3Rlcm1pbmF0ZWQnO1xuICAgICAgICAgICAgZXh0cmFIZWFkZXJzLnB1c2goJ0V2ZW50OiAnICsgdGhpcy5ldmVudCk7XG4gICAgICAgICAgICBleHRyYUhlYWRlcnMucHVzaCgnRXhwaXJlczogMCcpO1xuICAgICAgICAgICAgZXh0cmFIZWFkZXJzLnB1c2goJ0NvbnRhY3Q6ICcgKyB0aGlzLmNvbnRhY3QpO1xuICAgICAgICAgICAgZXh0cmFIZWFkZXJzLnB1c2goJ0FsbG93OiAnICsgU0lQLlVBLkMuQUxMT1dFRF9NRVRIT0RTLnRvU3RyaW5nKCkpO1xuICAgICAgICAgICAgLy9tYWtlcyBzdXJlIGV4cGlyZXMgaXNuJ3Qgc2V0LCBhbmQgb3RoZXIgdHlwaWNhbCByZXN1YnNjcmliZSBiZWhhdmlvclxuICAgICAgICAgICAgdGhpcy5yZWNlaXZlUmVzcG9uc2UgPSBmdW5jdGlvbiAoKSB7IH07XG4gICAgICAgICAgICB0aGlzLmRpYWxvZy5zZW5kUmVxdWVzdCh0aGlzLCB0aGlzLm1ldGhvZCwge1xuICAgICAgICAgICAgICAgIGV4dHJhSGVhZGVyczogZXh0cmFIZWFkZXJzLFxuICAgICAgICAgICAgICAgIGJvZHk6IHRoaXMuYm9keVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBTSVAuVGltZXJzLmNsZWFyVGltZW91dCh0aGlzLnRpbWVycy5zdWJfZHVyYXRpb24pO1xuICAgICAgICAgICAgU0lQLlRpbWVycy5jbGVhclRpbWVvdXQodGhpcy50aW1lcnMuTik7XG4gICAgICAgICAgICB0aGlzLnRpbWVycy5OID0gU0lQLlRpbWVycy5zZXRUaW1lb3V0KHN1Yi50aW1lcl9maXJlLmJpbmQoc3ViKSwgU0lQLlRpbWVycy5USU1FUl9OKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyoqXG4gICAgICAgICogQHByaXZhdGVcbiAgICAgICAgKi9cbiAgICAgICAgdGltZXJfZmlyZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUgPT09ICd0ZXJtaW5hdGVkJykge1xuICAgICAgICAgICAgICAgIHRoaXMudGVybWluYXRlRGlhbG9nKCk7XG4gICAgICAgICAgICAgICAgU0lQLlRpbWVycy5jbGVhclRpbWVvdXQodGhpcy50aW1lcnMuTik7XG4gICAgICAgICAgICAgICAgU0lQLlRpbWVycy5jbGVhclRpbWVvdXQodGhpcy50aW1lcnMuc3ViX2R1cmF0aW9uKTtcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy51YS5zdWJzY3JpcHRpb25zW3RoaXMuaWRdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5zdGF0ZSA9PT0gJ25vdGlmeV93YWl0JyB8fCB0aGlzLnN0YXRlID09PSAncGVuZGluZycpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlZnJlc2goKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgLyoqXG4gICAgICAgICogQHByaXZhdGVcbiAgICAgICAgKi9cbiAgICAgICAgY2xvc2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlID09PSAnbm90aWZ5X3dhaXQnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0ZSA9ICd0ZXJtaW5hdGVkJztcbiAgICAgICAgICAgICAgICBTSVAuVGltZXJzLmNsZWFyVGltZW91dCh0aGlzLnRpbWVycy5OKTtcbiAgICAgICAgICAgICAgICBTSVAuVGltZXJzLmNsZWFyVGltZW91dCh0aGlzLnRpbWVycy5zdWJfZHVyYXRpb24pO1xuICAgICAgICAgICAgICAgIHRoaXMucmVjZWl2ZVJlc3BvbnNlID0gZnVuY3Rpb24gKCkgeyB9O1xuICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnVhLmVhcmx5U3Vic2NyaXB0aW9uc1t0aGlzLnJlcXVlc3QuY2FsbF9pZCArIHRoaXMucmVxdWVzdC5mcm9tLnBhcmFtZXRlcnMudGFnICsgdGhpcy5ldmVudF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLnN0YXRlICE9PSAndGVybWluYXRlZCcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICovXG4gICAgICAgIGNyZWF0ZUNvbmZpcm1lZERpYWxvZzogZnVuY3Rpb24gKG1lc3NhZ2UsIHR5cGUpIHtcbiAgICAgICAgICAgIHZhciBkaWFsb2c7XG4gICAgICAgICAgICB0aGlzLnRlcm1pbmF0ZURpYWxvZygpO1xuICAgICAgICAgICAgZGlhbG9nID0gbmV3IFNJUC5EaWFsb2codGhpcywgbWVzc2FnZSwgdHlwZSk7XG4gICAgICAgICAgICBkaWFsb2cuaW52aXRlX3NlcW51bSA9IHRoaXMucmVxdWVzdC5jc2VxO1xuICAgICAgICAgICAgZGlhbG9nLmxvY2FsX3NlcW51bSA9IHRoaXMucmVxdWVzdC5jc2VxO1xuICAgICAgICAgICAgaWYgKCFkaWFsb2cuZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpYWxvZyA9IGRpYWxvZztcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIERpYWxvZyBub3QgY3JlYXRlZCBkdWUgdG8gYW4gZXJyb3JcbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgLyoqXG4gICAgICAgICogQHByaXZhdGVcbiAgICAgICAgKi9cbiAgICAgICAgdGVybWluYXRlRGlhbG9nOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5kaWFsb2cpIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy51YS5zdWJzY3JpcHRpb25zW3RoaXMuaWRdO1xuICAgICAgICAgICAgICAgIHRoaXMuZGlhbG9nLnRlcm1pbmF0ZSgpO1xuICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmRpYWxvZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgLyoqXG4gICAgICAgICogQHByaXZhdGVcbiAgICAgICAgKi9cbiAgICAgICAgcmVjZWl2ZVJlcXVlc3Q6IGZ1bmN0aW9uIChyZXF1ZXN0KSB7XG4gICAgICAgICAgICB2YXIgc3ViX3N0YXRlLCBzdWIgPSB0aGlzO1xuICAgICAgICAgICAgZnVuY3Rpb24gc2V0RXhwaXJlc1RpbWVvdXQoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHN1Yl9zdGF0ZS5leHBpcmVzKSB7XG4gICAgICAgICAgICAgICAgICAgIFNJUC5UaW1lcnMuY2xlYXJUaW1lb3V0KHN1Yi50aW1lcnMuc3ViX2R1cmF0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgc3ViX3N0YXRlLmV4cGlyZXMgPSBNYXRoLm1pbihzdWIuZXhwaXJlcywgTWF0aC5tYXgoc3ViX3N0YXRlLmV4cGlyZXMsIDApKTtcbiAgICAgICAgICAgICAgICAgICAgc3ViLnRpbWVycy5zdWJfZHVyYXRpb24gPSBTSVAuVGltZXJzLnNldFRpbWVvdXQoc3ViLnJlZnJlc2guYmluZChzdWIpLCBzdWJfc3RhdGUuZXhwaXJlcyAqIDkwMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCF0aGlzLm1hdGNoRXZlbnQocmVxdWVzdCkpIHsgLy9jaGVja3MgZXZlbnQgYW5kIHN1YnNjcmlwdGlvbl9zdGF0ZSBoZWFkZXJzXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5yZXBseSg0ODkpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghdGhpcy5kaWFsb2cpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jcmVhdGVDb25maXJtZWREaWFsb2cocmVxdWVzdCwgJ1VBUycpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaWQgPSB0aGlzLmRpYWxvZy5pZC50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy51YS5lYXJseVN1YnNjcmlwdGlvbnNbdGhpcy5yZXF1ZXN0LmNhbGxfaWQgKyB0aGlzLnJlcXVlc3QuZnJvbS5wYXJhbWV0ZXJzLnRhZyArIHRoaXMuZXZlbnRdO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVhLnN1YnNjcmlwdGlvbnNbdGhpcy5pZF0gPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICAvLyBVUERBVEUgUk9VVEUgU0VUIFRPIEJFIEJBQ0tXQVJEUyBDT01QQVRJQkxFP1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN1Yl9zdGF0ZSA9IHJlcXVlc3QucGFyc2VIZWFkZXIoJ1N1YnNjcmlwdGlvbi1TdGF0ZScpO1xuICAgICAgICAgICAgcmVxdWVzdC5yZXBseSgyMDAsIFNJUC5DLlJFQVNPTl8yMDApO1xuICAgICAgICAgICAgU0lQLlRpbWVycy5jbGVhclRpbWVvdXQodGhpcy50aW1lcnMuTik7XG4gICAgICAgICAgICB0aGlzLmVtaXQoJ25vdGlmeScsIHsgcmVxdWVzdDogcmVxdWVzdCB9KTtcbiAgICAgICAgICAgIC8vIGlmIHdlJ3ZlIHNldCBzdGF0ZSB0byB0ZXJtaW5hdGVkLCBubyBmdXJ0aGVyIHByb2Nlc3Npbmcgc2hvdWxkIHRha2UgcGxhY2VcbiAgICAgICAgICAgIC8vIGFuZCB3ZSBhcmUgb25seSBpbnRlcmVzdGVkIGluIGNsZWFuaW5nIHVwIGFmdGVyIHRoZSBhcHByb3ByaWF0ZSBOT1RJRllcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlID09PSAndGVybWluYXRlZCcpIHtcbiAgICAgICAgICAgICAgICBpZiAoc3ViX3N0YXRlLnN0YXRlID09PSAndGVybWluYXRlZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50ZXJtaW5hdGVEaWFsb2coKTtcbiAgICAgICAgICAgICAgICAgICAgU0lQLlRpbWVycy5jbGVhclRpbWVvdXQodGhpcy50aW1lcnMuTik7XG4gICAgICAgICAgICAgICAgICAgIFNJUC5UaW1lcnMuY2xlYXJUaW1lb3V0KHRoaXMudGltZXJzLnN1Yl9kdXJhdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnVhLnN1YnNjcmlwdGlvbnNbdGhpcy5pZF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN3aXRjaCAoc3ViX3N0YXRlLnN0YXRlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnYWN0aXZlJzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZSA9ICdhY3RpdmUnO1xuICAgICAgICAgICAgICAgICAgICBzZXRFeHBpcmVzVGltZW91dCgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdwZW5kaW5nJzpcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUgPT09ICdub3RpZnlfd2FpdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldEV4cGlyZXNUaW1lb3V0KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZSA9ICdwZW5kaW5nJztcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAndGVybWluYXRlZCc6XG4gICAgICAgICAgICAgICAgICAgIFNJUC5UaW1lcnMuY2xlYXJUaW1lb3V0KHRoaXMudGltZXJzLnN1Yl9kdXJhdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzdWJfc3RhdGUucmVhc29uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ3Rlcm1pbmF0aW5nIHN1YnNjcmlwdGlvbiB3aXRoIHJlYXNvbiAnICsgc3ViX3N0YXRlLnJlYXNvbik7XG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHN1Yl9zdGF0ZS5yZWFzb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdkZWFjdGl2YXRlZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAndGltZW91dCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdwcm9iYXRpb24nOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2dpdmV1cCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdWJfc3RhdGUucGFyYW1zICYmIHN1Yl9zdGF0ZS5wYXJhbXNbJ3JldHJ5LWFmdGVyJ10pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGltZXJzLnN1Yl9kdXJhdGlvbiA9IFNJUC5UaW1lcnMuc2V0VGltZW91dChzdWIuc3Vic2NyaWJlLmJpbmQoc3ViKSwgc3ViX3N0YXRlLnBhcmFtc1sncmV0cnktYWZ0ZXInXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdyZWplY3RlZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnbm9yZXNvdXJjZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnaW52YXJpYW50JzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZmFpbGVkOiBmdW5jdGlvbiAocmVzcG9uc2UsIGNhdXNlKSB7XG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICB0aGlzLmVtaXQoJ2ZhaWxlZCcsIHJlc3BvbnNlLCBjYXVzZSk7XG4gICAgICAgICAgICB0aGlzLmVtaXQoJ3JlamVjdGVkJywgcmVzcG9uc2UsIGNhdXNlKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuICAgICAgICBvbkRpYWxvZ0Vycm9yOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHRoaXMuZmFpbGVkKHJlc3BvbnNlLCBTSVAuQy5jYXVzZXMuRElBTE9HX0VSUk9SKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyoqXG4gICAgICAgICogQHByaXZhdGVcbiAgICAgICAgKi9cbiAgICAgICAgbWF0Y2hFdmVudDogZnVuY3Rpb24gKHJlcXVlc3QpIHtcbiAgICAgICAgICAgIHZhciBldmVudDtcbiAgICAgICAgICAgIC8vIENoZWNrIG1hbmRhdG9yeSBoZWFkZXIgRXZlbnRcbiAgICAgICAgICAgIGlmICghcmVxdWVzdC5oYXNIZWFkZXIoJ0V2ZW50JykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuKCdtaXNzaW5nIEV2ZW50IGhlYWRlcicpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIENoZWNrIG1hbmRhdG9yeSBoZWFkZXIgU3Vic2NyaXB0aW9uLVN0YXRlXG4gICAgICAgICAgICBpZiAoIXJlcXVlc3QuaGFzSGVhZGVyKCdTdWJzY3JpcHRpb24tU3RhdGUnKSkge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ21pc3NpbmcgU3Vic2NyaXB0aW9uLVN0YXRlIGhlYWRlcicpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIENoZWNrIHdoZXRoZXIgdGhlIGV2ZW50IGluIE5PVElGWSBtYXRjaGVzIHRoZSBldmVudCBpbiBTVUJTQ1JJQkVcbiAgICAgICAgICAgIGV2ZW50ID0gcmVxdWVzdC5wYXJzZUhlYWRlcignZXZlbnQnKS5ldmVudDtcbiAgICAgICAgICAgIGlmICh0aGlzLmV2ZW50ICE9PSBldmVudCkge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ2V2ZW50IG1hdGNoIGZhaWxlZCcpO1xuICAgICAgICAgICAgICAgIHJlcXVlc3QucmVwbHkoNDgxLCAnRXZlbnQgTWF0Y2ggRmFpbGVkJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xufTtcblxuXG4vKioqLyB9KSxcbi8qIDI2ICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblwidXNlIHN0cmljdFwiO1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgU0lQIFB1Ymxpc2ggKFNJUCBFeHRlbnNpb24gZm9yIEV2ZW50IFN0YXRlIFB1YmxpY2F0aW9uIFJGQzM5MDMpXG4gKi9cbi8qKlxuICogQGF1Z21lbnRzIFNJUFxuICogQGNsYXNzIENsYXNzIGNyZWF0aW5nIGEgU0lQIFB1Ymxpc2hDb250ZXh0LlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChTSVApIHtcbiAgICB2YXIgUHVibGlzaENvbnRleHQ7XG4gICAgUHVibGlzaENvbnRleHQgPSBmdW5jdGlvbiAodWEsIHRhcmdldCwgZXZlbnQsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KTtcbiAgICAgICAgdGhpcy5vcHRpb25zLmV4dHJhSGVhZGVycyA9IChvcHRpb25zLmV4dHJhSGVhZGVycyB8fCBbXSkuc2xpY2UoKTtcbiAgICAgICAgdGhpcy5vcHRpb25zLmNvbnRlbnRUeXBlID0gKG9wdGlvbnMuY29udGVudFR5cGUgfHwgJ3RleHQvcGxhaW4nKTtcbiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLmV4cGlyZXMgIT09ICdudW1iZXInIHx8IChvcHRpb25zLmV4cGlyZXMgJSAxKSAhPT0gMCkge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLmV4cGlyZXMgPSAzNjAwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLmV4cGlyZXMgPSBOdW1iZXIob3B0aW9ucy5leHBpcmVzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIChvcHRpb25zLnVucHVibGlzaE9uQ2xvc2UpICE9PSBcImJvb2xlYW5cIikge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLnVucHVibGlzaE9uQ2xvc2UgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLnVucHVibGlzaE9uQ2xvc2UgPSBvcHRpb25zLnVucHVibGlzaE9uQ2xvc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRhcmdldCA9PT0gdW5kZWZpbmVkIHx8IHRhcmdldCA9PT0gbnVsbCB8fCB0YXJnZXQgPT09ICcnKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgU0lQLkV4Y2VwdGlvbnMuTWV0aG9kUGFyYW1ldGVyRXJyb3IoJ1B1Ymxpc2gnLCAnVGFyZ2V0JywgdGFyZ2V0KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0ID0gdWEubm9ybWFsaXplVGFyZ2V0KHRhcmdldCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGV2ZW50ID09PSB1bmRlZmluZWQgfHwgZXZlbnQgPT09IG51bGwgfHwgZXZlbnQgPT09ICcnKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgU0lQLkV4Y2VwdGlvbnMuTWV0aG9kUGFyYW1ldGVyRXJyb3IoJ1B1Ymxpc2gnLCAnRXZlbnQnLCBldmVudCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmV2ZW50ID0gZXZlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQ2FsbCBwYXJlbnQgY29uc3RydWN0b3JcbiAgICAgICAgU0lQLkNsaWVudENvbnRleHQuY2FsbCh0aGlzLCB1YSwgU0lQLkMuUFVCTElTSCwgdGhpcy50YXJnZXQsIHRoaXMub3B0aW9ucyk7XG4gICAgICAgIHRoaXMubG9nZ2VyID0gdGhpcy51YS5nZXRMb2dnZXIoJ3NpcC5wdWJsaXNoJyk7XG4gICAgICAgIHRoaXMucHViUmVxdWVzdEJvZHkgPSBudWxsO1xuICAgICAgICB0aGlzLnB1YlJlcXVlc3RFeHBpcmVzID0gdGhpcy5vcHRpb25zLmV4cGlyZXM7XG4gICAgICAgIHRoaXMucHViUmVxdWVzdEV0YWcgPSBudWxsO1xuICAgICAgICB0aGlzLnB1Ymxpc2hfcmVmcmVzaF90aW1lciA9IG51bGw7XG4gICAgICAgIHVhLm9uKCd0cmFuc3BvcnRDcmVhdGVkJywgZnVuY3Rpb24gKHRyYW5zcG9ydCkge1xuICAgICAgICAgICAgdHJhbnNwb3J0Lm9uKCd0cmFuc3BvcnRFcnJvcicsIHRoaXMub25UcmFuc3BvcnRFcnJvci5iaW5kKHRoaXMpKTtcbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9O1xuICAgIC8vIEV4dGVuZCBDbGllbnRDb250ZXh0XG4gICAgUHVibGlzaENvbnRleHQucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShTSVAuQ2xpZW50Q29udGV4dC5wcm90b3R5cGUpO1xuICAgIC8vIFJlc3RvcmUgdGhlIGNsYXNzIGNvbnN0cnVjdG9yXG4gICAgUHVibGlzaENvbnRleHQucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gUHVibGlzaENvbnRleHQ7XG4gICAgLyoqXG4gICAgICogUHVibGlzaFxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IEV2ZW50IGJvZHkgdG8gcHVibGlzaCwgb3B0aW9uYWxcbiAgICAgKlxuICAgICAqL1xuICAgIFB1Ymxpc2hDb250ZXh0LnByb3RvdHlwZS5wdWJsaXNoID0gZnVuY3Rpb24gKGJvZHkpIHtcbiAgICAgICAgLy8gQ2xlYW4gdXAgYmVmb3JlIHRoZSBydW5cbiAgICAgICAgdGhpcy5yZXF1ZXN0ID0gbnVsbDtcbiAgICAgICAgU0lQLlRpbWVycy5jbGVhclRpbWVvdXQodGhpcy5wdWJsaXNoX3JlZnJlc2hfdGltZXIpO1xuICAgICAgICBpZiAoYm9keSAhPT0gdW5kZWZpbmVkICYmIGJvZHkgIT09IG51bGwgJiYgYm9keSAhPT0gJycpIHtcbiAgICAgICAgICAgIC8vIGlzIEluaXRhbCBvciBNb2RpZnkgcmVxdWVzdFxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLmJvZHkgPSBib2R5O1xuICAgICAgICAgICAgdGhpcy5wdWJSZXF1ZXN0Qm9keSA9IHRoaXMub3B0aW9ucy5ib2R5O1xuICAgICAgICAgICAgaWYgKHRoaXMucHViUmVxdWVzdEV4cGlyZXMgPT09IDApIHtcbiAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIEluaXRpYWwgcmVxdWVzdCBhZnRlciB1bnB1Ymxpc2hcbiAgICAgICAgICAgICAgICB0aGlzLnB1YlJlcXVlc3RFeHBpcmVzID0gdGhpcy5vcHRpb25zLmV4cGlyZXM7XG4gICAgICAgICAgICAgICAgdGhpcy5wdWJSZXF1ZXN0RXRhZyA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoISh0aGlzLnVhLnB1Ymxpc2hlcnNbdGhpcy50YXJnZXQudG9TdHJpbmcoKSArICc6JyArIHRoaXMuZXZlbnRdKSkge1xuICAgICAgICAgICAgICAgIHRoaXMudWEucHVibGlzaGVyc1t0aGlzLnRhcmdldC50b1N0cmluZygpICsgJzonICsgdGhpcy5ldmVudF0gPSB0aGlzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gVGhpcyBpcyBSZWZyZXNoIHJlcXVlc3RcbiAgICAgICAgICAgIHRoaXMucHViUmVxdWVzdEJvZHkgPSBudWxsO1xuICAgICAgICAgICAgaWYgKHRoaXMucHViUmVxdWVzdEV0YWcgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAvL1JlcXVlc3Qgbm90IHZhbGlkXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNJUC5FeGNlcHRpb25zLk1ldGhvZFBhcmFtZXRlckVycm9yKCdQdWJsaXNoJywgJ0JvZHknLCBib2R5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLnB1YlJlcXVlc3RFeHBpcmVzID09PSAwKSB7XG4gICAgICAgICAgICAgICAgLy9SZXF1ZXN0IG5vdCB2YWxpZFxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBTSVAuRXhjZXB0aW9ucy5NZXRob2RQYXJhbWV0ZXJFcnJvcignUHVibGlzaCcsICdFeHBpcmUnLCB0aGlzLnB1YlJlcXVlc3RFeHBpcmVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNlbmRQdWJsaXNoUmVxdWVzdCgpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogVW5wdWJsaXNoXG4gICAgICpcbiAgICAgKi9cbiAgICBQdWJsaXNoQ29udGV4dC5wcm90b3R5cGUudW5wdWJsaXNoID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyBDbGVhbiB1cCBiZWZvcmUgdGhlIHJ1blxuICAgICAgICB0aGlzLnJlcXVlc3QgPSBudWxsO1xuICAgICAgICBTSVAuVGltZXJzLmNsZWFyVGltZW91dCh0aGlzLnB1Ymxpc2hfcmVmcmVzaF90aW1lcik7XG4gICAgICAgIHRoaXMucHViUmVxdWVzdEJvZHkgPSBudWxsO1xuICAgICAgICB0aGlzLnB1YlJlcXVlc3RFeHBpcmVzID0gMDtcbiAgICAgICAgaWYgKHRoaXMucHViUmVxdWVzdEV0YWcgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuc2VuZFB1Ymxpc2hSZXF1ZXN0KCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIC8qKlxuICAgICAqIENsb3NlXG4gICAgICpcbiAgICAgKi9cbiAgICBQdWJsaXNoQ29udGV4dC5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vIFNlbmQgdW5wdWJsaXNoLCBpZiByZXF1ZXN0ZWRcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy51bnB1Ymxpc2hPbkNsb3NlKSB7XG4gICAgICAgICAgICB0aGlzLnVucHVibGlzaCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5yZXF1ZXN0ID0gbnVsbDtcbiAgICAgICAgICAgIFNJUC5UaW1lcnMuY2xlYXJUaW1lb3V0KHRoaXMucHVibGlzaF9yZWZyZXNoX3RpbWVyKTtcbiAgICAgICAgICAgIHRoaXMucHViUmVxdWVzdEJvZHkgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5wdWJSZXF1ZXN0RXhwaXJlcyA9IDA7XG4gICAgICAgICAgICB0aGlzLnB1YlJlcXVlc3RFdGFnID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy51YS5wdWJsaXNoZXJzW3RoaXMudGFyZ2V0LnRvU3RyaW5nKCkgKyAnOicgKyB0aGlzLmV2ZW50XSkge1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMudWEucHVibGlzaGVyc1t0aGlzLnRhcmdldC50b1N0cmluZygpICsgJzonICsgdGhpcy5ldmVudF07XG4gICAgICAgIH1cbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICpcbiAgICAgKi9cbiAgICBQdWJsaXNoQ29udGV4dC5wcm90b3R5cGUuc2VuZFB1Ymxpc2hSZXF1ZXN0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcmVxT3B0aW9ucztcbiAgICAgICAgcmVxT3B0aW9ucyA9IE9iamVjdC5jcmVhdGUodGhpcy5vcHRpb25zIHx8IE9iamVjdC5wcm90b3R5cGUpO1xuICAgICAgICByZXFPcHRpb25zLmV4dHJhSGVhZGVycyA9ICh0aGlzLm9wdGlvbnMuZXh0cmFIZWFkZXJzIHx8IFtdKS5zbGljZSgpO1xuICAgICAgICByZXFPcHRpb25zLmV4dHJhSGVhZGVycy5wdXNoKCdFdmVudDogJyArIHRoaXMuZXZlbnQpO1xuICAgICAgICByZXFPcHRpb25zLmV4dHJhSGVhZGVycy5wdXNoKCdFeHBpcmVzOiAnICsgdGhpcy5wdWJSZXF1ZXN0RXhwaXJlcyk7XG4gICAgICAgIGlmICh0aGlzLnB1YlJlcXVlc3RFdGFnICE9PSBudWxsKSB7XG4gICAgICAgICAgICByZXFPcHRpb25zLmV4dHJhSGVhZGVycy5wdXNoKCdTSVAtSWYtTWF0Y2g6ICcgKyB0aGlzLnB1YlJlcXVlc3RFdGFnKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJlcXVlc3QgPSBuZXcgU0lQLk91dGdvaW5nUmVxdWVzdChTSVAuQy5QVUJMSVNILCB0aGlzLnRhcmdldCwgdGhpcy51YSwgdGhpcy5vcHRpb25zLnBhcmFtcywgcmVxT3B0aW9ucy5leHRyYUhlYWRlcnMpO1xuICAgICAgICBpZiAodGhpcy5wdWJSZXF1ZXN0Qm9keSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5yZXF1ZXN0LmJvZHkgPSB7fTtcbiAgICAgICAgICAgIHRoaXMucmVxdWVzdC5ib2R5LmJvZHkgPSB0aGlzLnB1YlJlcXVlc3RCb2R5O1xuICAgICAgICAgICAgdGhpcy5yZXF1ZXN0LmJvZHkuY29udGVudFR5cGUgPSB0aGlzLm9wdGlvbnMuY29udGVudFR5cGU7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZW5kKCk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqXG4gICAgICovXG4gICAgUHVibGlzaENvbnRleHQucHJvdG90eXBlLnJlY2VpdmVSZXNwb25zZSA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICB2YXIgZXhwaXJlcywgbWluRXhwaXJlcywgY2F1c2UgPSBTSVAuVXRpbHMuZ2V0UmVhc29uUGhyYXNlKHJlc3BvbnNlLnN0YXR1c19jb2RlKTtcbiAgICAgICAgc3dpdGNoICh0cnVlKSB7XG4gICAgICAgICAgICBjYXNlIC9eMVswLTldezJ9JC8udGVzdChyZXNwb25zZS5zdGF0dXNfY29kZSk6XG4gICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdwcm9ncmVzcycsIHJlc3BvbnNlLCBjYXVzZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIC9eMlswLTldezJ9JC8udGVzdChyZXNwb25zZS5zdGF0dXNfY29kZSk6XG4gICAgICAgICAgICAgICAgLy8gU2V0IFNJUC1FdGFnXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmhhc0hlYWRlcignU0lQLUVUYWcnKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnB1YlJlcXVlc3RFdGFnID0gcmVzcG9uc2UuZ2V0SGVhZGVyKCdTSVAtRVRhZycpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIud2FybignU0lQLUVUYWcgaGVhZGVyIG1pc3NpbmcgaW4gYSAyMDAtY2xhc3MgcmVzcG9uc2UgdG8gUFVCTElTSCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgRXhwaXJlXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmhhc0hlYWRlcignRXhwaXJlcycpKSB7XG4gICAgICAgICAgICAgICAgICAgIGV4cGlyZXMgPSBOdW1iZXIocmVzcG9uc2UuZ2V0SGVhZGVyKCdFeHBpcmVzJykpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGV4cGlyZXMgPT09ICdudW1iZXInICYmIGV4cGlyZXMgPj0gMCAmJiBleHBpcmVzIDw9IHRoaXMucHViUmVxdWVzdEV4cGlyZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHViUmVxdWVzdEV4cGlyZXMgPSBleHBpcmVzO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIud2FybignQmFkIEV4cGlyZXMgaGVhZGVyIGluIGEgMjAwLWNsYXNzIHJlc3BvbnNlIHRvIFBVQkxJU0gnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIud2FybignRXhwaXJlcyBoZWFkZXIgbWlzc2luZyBpbiBhIDIwMC1jbGFzcyByZXNwb25zZSB0byBQVUJMSVNIJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnB1YlJlcXVlc3RFeHBpcmVzICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFNjaGVkdWxlIHJlZnJlc2hcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wdWJsaXNoX3JlZnJlc2hfdGltZXIgPSBTSVAuVGltZXJzLnNldFRpbWVvdXQodGhpcy5wdWJsaXNoLmJpbmQodGhpcyksIHRoaXMucHViUmVxdWVzdEV4cGlyZXMgKiA5MDApO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ3B1Ymxpc2hlZCcsIHJlc3BvbnNlLCBjYXVzZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ3VucHVibGlzaGVkJywgcmVzcG9uc2UsIGNhdXNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIC9eNDEyJC8udGVzdChyZXNwb25zZS5zdGF0dXNfY29kZSk6XG4gICAgICAgICAgICAgICAgLy8gNDEyIGNvZGUgbWVhbnMgbm8gbWF0Y2hpbmcgRVRhZyAtIHBvc3NpYmx5IHRoZSBQVUJMSVNIIGV4cGlyZWRcbiAgICAgICAgICAgICAgICAvLyBSZXN1Ym1pdCBhcyBuZXcgcmVxdWVzdCwgaWYgdGhlIGN1cnJlbnQgcmVxdWVzdCBpcyBub3QgYSBcInJlbW92ZVwiXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucHViUmVxdWVzdEV0YWcgIT09IG51bGwgJiYgdGhpcy5wdWJSZXF1ZXN0RXhwaXJlcyAhPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuKCc0MTIgcmVzcG9uc2UgdG8gUFVCTElTSCwgcmVjb3ZlcmluZycpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnB1YlJlcXVlc3RFdGFnID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdwcm9ncmVzcycsIHJlc3BvbnNlLCBjYXVzZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHVibGlzaCh0aGlzLm9wdGlvbnMuYm9keSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuKCc0MTIgcmVzcG9uc2UgdG8gUFVCTElTSCwgcmVjb3ZlcnkgZmFpbGVkJyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHViUmVxdWVzdEV4cGlyZXMgPSAwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ2ZhaWxlZCcsIHJlc3BvbnNlLCBjYXVzZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgndW5wdWJsaXNoZWQnLCByZXNwb25zZSwgY2F1c2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgL140MjMkLy50ZXN0KHJlc3BvbnNlLnN0YXR1c19jb2RlKTpcbiAgICAgICAgICAgICAgICAvLyA0MjMgY29kZSBtZWFucyB3ZSBuZWVkIHRvIGFkanVzdCB0aGUgRXhwaXJlcyBpbnRlcnZhbCB1cFxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnB1YlJlcXVlc3RFeHBpcmVzICE9PSAwICYmIHJlc3BvbnNlLmhhc0hlYWRlcignTWluLUV4cGlyZXMnKSkge1xuICAgICAgICAgICAgICAgICAgICBtaW5FeHBpcmVzID0gTnVtYmVyKHJlc3BvbnNlLmdldEhlYWRlcignTWluLUV4cGlyZXMnKSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbWluRXhwaXJlcyA9PT0gJ251bWJlcicgfHwgbWluRXhwaXJlcyA+IHRoaXMucHViUmVxdWVzdEV4cGlyZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oJzQyMyBjb2RlIGluIHJlc3BvbnNlIHRvIFBVQkxJU0gsIGFkanVzdGluZyB0aGUgRXhwaXJlcyB2YWx1ZSBhbmQgdHJ5aW5nIHRvIHJlY292ZXInKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHViUmVxdWVzdEV4cGlyZXMgPSBtaW5FeHBpcmVzO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdwcm9ncmVzcycsIHJlc3BvbnNlLCBjYXVzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnB1Ymxpc2godGhpcy5vcHRpb25zLmJvZHkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIud2FybignQmFkIDQyMyByZXNwb25zZSBNaW4tRXhwaXJlcyBoZWFkZXIgcmVjZWl2ZWQgZm9yIFBVQkxJU0gnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHViUmVxdWVzdEV4cGlyZXMgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdmYWlsZWQnLCByZXNwb25zZSwgY2F1c2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCd1bnB1Ymxpc2hlZCcsIHJlc3BvbnNlLCBjYXVzZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oJzQyMyByZXNwb25zZSB0byBQVUJMSVNILCByZWNvdmVyeSBmYWlsZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wdWJSZXF1ZXN0RXhwaXJlcyA9IDA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgnZmFpbGVkJywgcmVzcG9uc2UsIGNhdXNlKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCd1bnB1Ymxpc2hlZCcsIHJlc3BvbnNlLCBjYXVzZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aGlzLnB1YlJlcXVlc3RFeHBpcmVzID0gMDtcbiAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ2ZhaWxlZCcsIHJlc3BvbnNlLCBjYXVzZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5lbWl0KCd1bnB1Ymxpc2hlZCcsIHJlc3BvbnNlLCBjYXVzZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgLy8gRG8gdGhlIGNsZWFudXBcbiAgICAgICAgaWYgKHRoaXMucHViUmVxdWVzdEV4cGlyZXMgPT09IDApIHtcbiAgICAgICAgICAgIFNJUC5UaW1lcnMuY2xlYXJUaW1lb3V0KHRoaXMucHVibGlzaF9yZWZyZXNoX3RpbWVyKTtcbiAgICAgICAgICAgIHRoaXMucHViUmVxdWVzdEJvZHkgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5wdWJSZXF1ZXN0RXRhZyA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFB1Ymxpc2hDb250ZXh0LnByb3RvdHlwZS5vblJlcXVlc3RUaW1lb3V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBTSVAuQ2xpZW50Q29udGV4dC5wcm90b3R5cGUub25SZXF1ZXN0VGltZW91dC5jYWxsKHRoaXMpO1xuICAgICAgICB0aGlzLmVtaXQoJ3VucHVibGlzaGVkJywgbnVsbCwgU0lQLkMuY2F1c2VzLlJFUVVFU1RfVElNRU9VVCk7XG4gICAgfTtcbiAgICBQdWJsaXNoQ29udGV4dC5wcm90b3R5cGUub25UcmFuc3BvcnRFcnJvciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgU0lQLkNsaWVudENvbnRleHQucHJvdG90eXBlLm9uVHJhbnNwb3J0RXJyb3IuY2FsbCh0aGlzKTtcbiAgICAgICAgdGhpcy5lbWl0KCd1bnB1Ymxpc2hlZCcsIG51bGwsIFNJUC5DLmNhdXNlcy5DT05ORUNUSU9OX0VSUk9SKTtcbiAgICB9O1xuICAgIFNJUC5QdWJsaXNoQ29udGV4dCA9IFB1Ymxpc2hDb250ZXh0O1xufTtcblxuXG4vKioqLyB9KSxcbi8qIDI3ICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblwidXNlIHN0cmljdFwiO1xuLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovKGZ1bmN0aW9uKGdsb2JhbCkge1xuLyoqXG4gKiBAYXVnbWVudHMgU0lQXG4gKiBAY2xhc3MgQ2xhc3MgY3JlYXRpbmcgYSBTSVAgVXNlciBBZ2VudC5cbiAqIEBwYXJhbSB7ZnVuY3Rpb24gcmV0dXJuaW5nIFNJUC5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyfSBbY29uZmlndXJhdGlvbi5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyRmFjdG9yeV1cbiAqICAgICAgICBBIGZ1bmN0aW9uIHdpbGwgYmUgaW52b2tlZCBieSBlYWNoIG9mIHRoZSBVQSdzIFNlc3Npb25zIHRvIGJ1aWxkIHRoZSBzZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyIGZvciB0aGF0IFNlc3Npb24uXG4gKiAgICAgICAgSWYgbm8gKG9yIGEgZmFsc3kpIHZhbHVlIGlzIHByb3ZpZGVkLCBlYWNoIFNlc3Npb24gd2lsbCB1c2UgYSBkZWZhdWx0IChXZWJSVEMpIHNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIuXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IFtjb25maWd1cmF0aW9uLm1lZGlhXSBnZXRzIHBhc3NlZCB0byBTSVAuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlci5nZXREZXNjcmlwdGlvbiBhcyBtZWRpYUhpbnRcbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoU0lQLCBlbnZpcm9ubWVudCkge1xuICAgIHZhciBVQSwgQyA9IHtcbiAgICAgICAgLy8gVUEgc3RhdHVzIGNvZGVzXG4gICAgICAgIFNUQVRVU19JTklUOiAwLFxuICAgICAgICBTVEFUVVNfU1RBUlRJTkc6IDEsXG4gICAgICAgIFNUQVRVU19SRUFEWTogMixcbiAgICAgICAgU1RBVFVTX1VTRVJfQ0xPU0VEOiAzLFxuICAgICAgICBTVEFUVVNfTk9UX1JFQURZOiA0LFxuICAgICAgICAvLyBVQSBlcnJvciBjb2Rlc1xuICAgICAgICBDT05GSUdVUkFUSU9OX0VSUk9SOiAxLFxuICAgICAgICBORVRXT1JLX0VSUk9SOiAyLFxuICAgICAgICBBTExPV0VEX01FVEhPRFM6IFtcbiAgICAgICAgICAgICdBQ0snLFxuICAgICAgICAgICAgJ0NBTkNFTCcsXG4gICAgICAgICAgICAnSU5WSVRFJyxcbiAgICAgICAgICAgICdNRVNTQUdFJyxcbiAgICAgICAgICAgICdCWUUnLFxuICAgICAgICAgICAgJ09QVElPTlMnLFxuICAgICAgICAgICAgJ0lORk8nLFxuICAgICAgICAgICAgJ05PVElGWScsXG4gICAgICAgICAgICAnUkVGRVInXG4gICAgICAgIF0sXG4gICAgICAgIEFDQ0VQVEVEX0JPRFlfVFlQRVM6IFtcbiAgICAgICAgICAgICdhcHBsaWNhdGlvbi9zZHAnLFxuICAgICAgICAgICAgJ2FwcGxpY2F0aW9uL2R0bWYtcmVsYXknXG4gICAgICAgIF0sXG4gICAgICAgIE1BWF9GT1JXQVJEUzogNzAsXG4gICAgICAgIFRBR19MRU5HVEg6IDEwXG4gICAgfTtcbiAgICBVQSA9IGZ1bmN0aW9uIChjb25maWd1cmF0aW9uKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgLy8gSGVscGVyIGZ1bmN0aW9uIGZvciBmb3J3YXJkaW5nIGV2ZW50c1xuICAgICAgICBmdW5jdGlvbiBzZWxmRW1pdCh0eXBlKSB7XG4gICAgICAgICAgICAvL3JlZ2lzdHJhdGlvbkZhaWxlZCBoYW5kbGVyIGlzIGludm9rZWQgd2l0aCB0d28gYXJndW1lbnRzLiBBbGxvdyBldmVudCBoYW5kbGVycyB0byBiZSBpbnZva2VkIHdpdGggYSB2YXJpYWJsZSBuby4gb2YgYXJndW1lbnRzXG4gICAgICAgICAgICByZXR1cm4gc2VsZi5lbWl0LmJpbmQoc2VsZiwgdHlwZSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gU2V0IEFjY2VwdGVkIEJvZHkgVHlwZXNcbiAgICAgICAgQy5BQ0NFUFRFRF9CT0RZX1RZUEVTID0gQy5BQ0NFUFRFRF9CT0RZX1RZUEVTLnRvU3RyaW5nKCk7XG4gICAgICAgIHRoaXMubG9nID0gbmV3IFNJUC5Mb2dnZXJGYWN0b3J5KCk7XG4gICAgICAgIHRoaXMubG9nZ2VyID0gdGhpcy5nZXRMb2dnZXIoJ3NpcC51YScpO1xuICAgICAgICB0aGlzLmNhY2hlID0ge1xuICAgICAgICAgICAgY3JlZGVudGlhbHM6IHt9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY29uZmlndXJhdGlvbiA9IHt9O1xuICAgICAgICB0aGlzLmRpYWxvZ3MgPSB7fTtcbiAgICAgICAgLy9Vc2VyIGFjdGlvbnMgb3V0c2lkZSBhbnkgc2Vzc2lvbi9kaWFsb2cgKE1FU1NBR0UpXG4gICAgICAgIHRoaXMuYXBwbGljYW50cyA9IHt9O1xuICAgICAgICB0aGlzLmRhdGEgPSB7fTtcbiAgICAgICAgdGhpcy5zZXNzaW9ucyA9IHt9O1xuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMgPSB7fTtcbiAgICAgICAgdGhpcy5lYXJseVN1YnNjcmlwdGlvbnMgPSB7fTtcbiAgICAgICAgdGhpcy5wdWJsaXNoZXJzID0ge307XG4gICAgICAgIHRoaXMudHJhbnNwb3J0ID0gbnVsbDtcbiAgICAgICAgdGhpcy5jb250YWN0ID0gbnVsbDtcbiAgICAgICAgdGhpcy5zdGF0dXMgPSBDLlNUQVRVU19JTklUO1xuICAgICAgICB0aGlzLmVycm9yID0gbnVsbDtcbiAgICAgICAgdGhpcy50cmFuc2FjdGlvbnMgPSB7XG4gICAgICAgICAgICBuaXN0OiB7fSxcbiAgICAgICAgICAgIG5pY3Q6IHt9LFxuICAgICAgICAgICAgaXN0OiB7fSxcbiAgICAgICAgICAgIGljdDoge31cbiAgICAgICAgfTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcywge1xuICAgICAgICAgICAgdHJhbnNhY3Rpb25zQ291bnQ6IHtcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGUsIHRyYW5zYWN0aW9ucyA9IFsnbmlzdCcsICduaWN0JywgJ2lzdCcsICdpY3QnXSwgY291bnQgPSAwO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHR5cGUgaW4gdHJhbnNhY3Rpb25zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb3VudCArPSBPYmplY3Qua2V5cyh0aGlzLnRyYW5zYWN0aW9uc1t0cmFuc2FjdGlvbnNbdHlwZV1dKS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvdW50O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBuaWN0VHJhbnNhY3Rpb25zQ291bnQ6IHtcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHRoaXMudHJhbnNhY3Rpb25zWyduaWN0J10pLmxlbmd0aDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbmlzdFRyYW5zYWN0aW9uc0NvdW50OiB7XG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3Qua2V5cyh0aGlzLnRyYW5zYWN0aW9uc1snbmlzdCddKS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGljdFRyYW5zYWN0aW9uc0NvdW50OiB7XG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3Qua2V5cyh0aGlzLnRyYW5zYWN0aW9uc1snaWN0J10pLmxlbmd0aDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXN0VHJhbnNhY3Rpb25zQ291bnQ6IHtcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHRoaXMudHJhbnNhY3Rpb25zWydpc3QnXSkubGVuZ3RoO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBMb2FkIGNvbmZpZ3VyYXRpb25cbiAgICAgICAgICpcbiAgICAgICAgICogQHRocm93cyB7U0lQLkV4Y2VwdGlvbnMuQ29uZmlndXJhdGlvbkVycm9yfVxuICAgICAgICAgKiBAdGhyb3dzIHtUeXBlRXJyb3J9XG4gICAgICAgICAqL1xuICAgICAgICBpZiAoY29uZmlndXJhdGlvbiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb25maWd1cmF0aW9uID0ge307XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodHlwZW9mIGNvbmZpZ3VyYXRpb24gPT09ICdzdHJpbmcnIHx8IGNvbmZpZ3VyYXRpb24gaW5zdGFuY2VvZiBTdHJpbmcpIHtcbiAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24gPSB7XG4gICAgICAgICAgICAgICAgdXJpOiBjb25maWd1cmF0aW9uXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIC8vIEFwcGx5IGxvZyBjb25maWd1cmF0aW9uIGlmIHByZXNlbnRcbiAgICAgICAgaWYgKGNvbmZpZ3VyYXRpb24ubG9nKSB7XG4gICAgICAgICAgICBpZiAoY29uZmlndXJhdGlvbi5sb2cuaGFzT3duUHJvcGVydHkoJ2J1aWx0aW5FbmFibGVkJykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZy5idWlsdGluRW5hYmxlZCA9IGNvbmZpZ3VyYXRpb24ubG9nLmJ1aWx0aW5FbmFibGVkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNvbmZpZ3VyYXRpb24ubG9nLmhhc093blByb3BlcnR5KCdsZXZlbCcpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2cubGV2ZWwgPSBjb25maWd1cmF0aW9uLmxvZy5sZXZlbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjb25maWd1cmF0aW9uLmxvZy5oYXNPd25Qcm9wZXJ0eSgnY29ubmVjdG9yJykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZy5jb25uZWN0b3IgPSBjb25maWd1cmF0aW9uLmxvZy5jb25uZWN0b3I7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMubG9hZENvbmZpZyhjb25maWd1cmF0aW9uKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSBDLlNUQVRVU19OT1RfUkVBRFk7XG4gICAgICAgICAgICB0aGlzLmVycm9yID0gQy5DT05GSUdVUkFUSU9OX0VSUk9SO1xuICAgICAgICAgICAgdGhyb3cgZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBJbml0aWFsaXplIHJlZ2lzdGVyQ29udGV4dFxuICAgICAgICB0aGlzLnJlZ2lzdGVyQ29udGV4dCA9IG5ldyBTSVAuUmVnaXN0ZXJDb250ZXh0KHRoaXMpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyQ29udGV4dC5vbignZmFpbGVkJywgc2VsZkVtaXQoJ3JlZ2lzdHJhdGlvbkZhaWxlZCcpKTtcbiAgICAgICAgdGhpcy5yZWdpc3RlckNvbnRleHQub24oJ3JlZ2lzdGVyZWQnLCBzZWxmRW1pdCgncmVnaXN0ZXJlZCcpKTtcbiAgICAgICAgdGhpcy5yZWdpc3RlckNvbnRleHQub24oJ3VucmVnaXN0ZXJlZCcsIHNlbGZFbWl0KCd1bnJlZ2lzdGVyZWQnKSk7XG4gICAgICAgIGlmICh0aGlzLmNvbmZpZ3VyYXRpb24uYXV0b3N0YXJ0KSB7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0KCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFVBLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoU0lQLkV2ZW50RW1pdHRlci5wcm90b3R5cGUpO1xuICAgIC8vPT09PT09PT09PT09PT09PT1cbiAgICAvLyAgSGlnaCBMZXZlbCBBUElcbiAgICAvLz09PT09PT09PT09PT09PT09XG4gICAgVUEucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uLnJlZ2lzdGVyID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5yZWdpc3RlckNvbnRleHQucmVnaXN0ZXIob3B0aW9ucyk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogVW5yZWdpc3Rlci5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2FsbF0gdW5yZWdpc3RlciBhbGwgdXNlciBiaW5kaW5ncy5cbiAgICAgKlxuICAgICAqL1xuICAgIFVBLnByb3RvdHlwZS51bnJlZ2lzdGVyID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uLnJlZ2lzdGVyID0gZmFsc2U7XG4gICAgICAgIHZhciBjb250ZXh0ID0gdGhpcy5yZWdpc3RlckNvbnRleHQ7XG4gICAgICAgIHRoaXMudHJhbnNwb3J0LmFmdGVyQ29ubmVjdGVkKGNvbnRleHQudW5yZWdpc3Rlci5iaW5kKGNvbnRleHQsIG9wdGlvbnMpKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICBVQS5wcm90b3R5cGUuaXNSZWdpc3RlcmVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZWdpc3RlckNvbnRleHQucmVnaXN0ZXJlZDtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIE1ha2UgYW4gb3V0Z29pbmcgY2FsbC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0YXJnZXRcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gdmlld3NcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnMubWVkaWFdIGdldHMgcGFzc2VkIHRvIFNJUC5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyLmdldERlc2NyaXB0aW9uIGFzIG1lZGlhSGludFxuICAgICAqXG4gICAgICogQHRocm93cyB7VHlwZUVycm9yfVxuICAgICAqXG4gICAgICovXG4gICAgVUEucHJvdG90eXBlLmludml0ZSA9IGZ1bmN0aW9uICh0YXJnZXQsIG9wdGlvbnMsIG1vZGlmaWVycykge1xuICAgICAgICB2YXIgY29udGV4dCA9IG5ldyBTSVAuSW52aXRlQ2xpZW50Q29udGV4dCh0aGlzLCB0YXJnZXQsIG9wdGlvbnMsIG1vZGlmaWVycyk7XG4gICAgICAgIC8vIERlbGF5IHNlbmRpbmcgYWN0dWFsIGludml0ZSB1bnRpbCB0aGUgbmV4dCAndGljaycgaWYgd2UgYXJlIGFscmVhZHlcbiAgICAgICAgLy8gY29ubmVjdGVkLCBzbyB0aGF0IEFQSSBjb25zdW1lcnMgY2FuIHJlZ2lzdGVyIHRvIGV2ZW50cyBmaXJlZCBieSB0aGVcbiAgICAgICAgLy8gdGhlIHNlc3Npb24uXG4gICAgICAgIHRoaXMudHJhbnNwb3J0LmFmdGVyQ29ubmVjdGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnRleHQuaW52aXRlKCk7XG4gICAgICAgICAgICB0aGlzLmVtaXQoJ2ludml0ZVNlbnQnLCBjb250ZXh0KTtcbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgcmV0dXJuIGNvbnRleHQ7XG4gICAgfTtcbiAgICBVQS5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24gKHRhcmdldCwgZXZlbnQsIG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIHN1YiA9IG5ldyBTSVAuU3Vic2NyaXB0aW9uKHRoaXMsIHRhcmdldCwgZXZlbnQsIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLnRyYW5zcG9ydC5hZnRlckNvbm5lY3RlZChzdWIuc3Vic2NyaWJlLmJpbmQoc3ViKSk7XG4gICAgICAgIHJldHVybiBzdWI7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBTZW5kIFBVQkxJU0ggRXZlbnQgU3RhdGUgUHVibGljYXRpb24gKFJGQzM5MDMpXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdGFyZ2V0XG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50XG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGJvZHlcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdXG4gICAgICpcbiAgICAgKiBAdGhyb3dzIHtTSVAuRXhjZXB0aW9ucy5NZXRob2RQYXJhbWV0ZXJFcnJvcn1cbiAgICAgKlxuICAgICAqL1xuICAgIFVBLnByb3RvdHlwZS5wdWJsaXNoID0gZnVuY3Rpb24gKHRhcmdldCwgZXZlbnQsIGJvZHksIG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIHB1YiA9IG5ldyBTSVAuUHVibGlzaENvbnRleHQodGhpcywgdGFyZ2V0LCBldmVudCwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMudHJhbnNwb3J0LmFmdGVyQ29ubmVjdGVkKHB1Yi5wdWJsaXNoLmJpbmQocHViLCBib2R5KSk7XG4gICAgICAgIHJldHVybiBwdWI7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBTZW5kIGEgbWVzc2FnZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0YXJnZXRcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gYm9keVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cbiAgICAgKlxuICAgICAqIEB0aHJvd3Mge1R5cGVFcnJvcn1cbiAgICAgKlxuICAgICAqL1xuICAgIFVBLnByb3RvdHlwZS5tZXNzYWdlID0gZnVuY3Rpb24gKHRhcmdldCwgYm9keSwgb3B0aW9ucykge1xuICAgICAgICBpZiAoYm9keSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdOb3QgZW5vdWdoIGFyZ3VtZW50cycpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRoZXJlIGlzIG5vIE1lc3NhZ2UgbW9kdWxlLCBzbyBpdCBpcyBva2F5IHRoYXQgdGhlIFVBIGhhbmRsZXMgZGVmYXVsdHMgaGVyZS5cbiAgICAgICAgb3B0aW9ucyA9IE9iamVjdC5jcmVhdGUob3B0aW9ucyB8fCBPYmplY3QucHJvdG90eXBlKTtcbiAgICAgICAgb3B0aW9ucy5jb250ZW50VHlwZSB8fCAob3B0aW9ucy5jb250ZW50VHlwZSA9ICd0ZXh0L3BsYWluJyk7XG4gICAgICAgIG9wdGlvbnMuYm9keSA9IGJvZHk7XG4gICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3QoU0lQLkMuTUVTU0FHRSwgdGFyZ2V0LCBvcHRpb25zKTtcbiAgICB9O1xuICAgIFVBLnByb3RvdHlwZS5yZXF1ZXN0ID0gZnVuY3Rpb24gKG1ldGhvZCwgdGFyZ2V0LCBvcHRpb25zKSB7XG4gICAgICAgIHZhciByZXEgPSBuZXcgU0lQLkNsaWVudENvbnRleHQodGhpcywgbWV0aG9kLCB0YXJnZXQsIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLnRyYW5zcG9ydC5hZnRlckNvbm5lY3RlZChyZXEuc2VuZC5iaW5kKHJlcSkpO1xuICAgICAgICByZXR1cm4gcmVxO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogR3JhY2VmdWxseSBjbG9zZS5cbiAgICAgKlxuICAgICAqL1xuICAgIFVBLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgc2Vzc2lvbiwgc3Vic2NyaXB0aW9uLCBhcHBsaWNhbnQsIHB1Ymxpc2hlciwgdWEgPSB0aGlzO1xuICAgICAgICBmdW5jdGlvbiB0cmFuc2FjdGlvbnNMaXN0ZW5lcigpIHtcbiAgICAgICAgICAgIGlmICh1YS5uaXN0VHJhbnNhY3Rpb25zQ291bnQgPT09IDAgJiYgdWEubmljdFRyYW5zYWN0aW9uc0NvdW50ID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdWEucmVtb3ZlTGlzdGVuZXIoJ3RyYW5zYWN0aW9uRGVzdHJveWVkJywgdHJhbnNhY3Rpb25zTGlzdGVuZXIpO1xuICAgICAgICAgICAgICAgIHVhLnRyYW5zcG9ydC5kaXNjb25uZWN0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sb2dnZXIubG9nKCd1c2VyIHJlcXVlc3RlZCBjbG9zdXJlLi4uJyk7XG4gICAgICAgIGlmICh0aGlzLnN0YXR1cyA9PT0gQy5TVEFUVVNfVVNFUl9DTE9TRUQpIHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ1VBIGFscmVhZHkgY2xvc2VkJyk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgICAvLyBDbG9zZSByZWdpc3RlckNvbnRleHRcbiAgICAgICAgdGhpcy5sb2dnZXIubG9nKCdjbG9zaW5nIHJlZ2lzdGVyQ29udGV4dCcpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyQ29udGV4dC5jbG9zZSgpO1xuICAgICAgICAvLyBSdW4gIF90ZXJtaW5hdGVfIG9uIGV2ZXJ5IFNlc3Npb25cbiAgICAgICAgZm9yIChzZXNzaW9uIGluIHRoaXMuc2Vzc2lvbnMpIHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZygnY2xvc2luZyBzZXNzaW9uICcgKyBzZXNzaW9uKTtcbiAgICAgICAgICAgIHRoaXMuc2Vzc2lvbnNbc2Vzc2lvbl0udGVybWluYXRlKCk7XG4gICAgICAgIH1cbiAgICAgICAgLy9SdW4gX2Nsb3NlXyBvbiBldmVyeSBjb25maXJtZWQgU3Vic2NyaXB0aW9uXG4gICAgICAgIGZvciAoc3Vic2NyaXB0aW9uIGluIHRoaXMuc3Vic2NyaXB0aW9ucykge1xuICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKCd1bnN1YnNjcmliaW5nIGZyb20gc3Vic2NyaXB0aW9uICcgKyBzdWJzY3JpcHRpb24pO1xuICAgICAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zW3N1YnNjcmlwdGlvbl0uY2xvc2UoKTtcbiAgICAgICAgfVxuICAgICAgICAvL1J1biBfY2xvc2VfIG9uIGV2ZXJ5IGVhcmx5IFN1YnNjcmlwdGlvblxuICAgICAgICBmb3IgKHN1YnNjcmlwdGlvbiBpbiB0aGlzLmVhcmx5U3Vic2NyaXB0aW9ucykge1xuICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKCd1bnN1YnNjcmliaW5nIGZyb20gZWFybHkgc3Vic2NyaXB0aW9uICcgKyBzdWJzY3JpcHRpb24pO1xuICAgICAgICAgICAgdGhpcy5lYXJseVN1YnNjcmlwdGlvbnNbc3Vic2NyaXB0aW9uXS5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgICAgIC8vUnVuIF9jbG9zZV8gb24gZXZlcnkgUHVibGlzaGVyXG4gICAgICAgIGZvciAocHVibGlzaGVyIGluIHRoaXMucHVibGlzaGVycykge1xuICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKCd1bnB1Ymxpc2ggJyArIHB1Ymxpc2hlcik7XG4gICAgICAgICAgICB0aGlzLnB1Ymxpc2hlcnNbcHVibGlzaGVyXS5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFJ1biAgX2Nsb3NlXyBvbiBldmVyeSBhcHBsaWNhbnRcbiAgICAgICAgZm9yIChhcHBsaWNhbnQgaW4gdGhpcy5hcHBsaWNhbnRzKSB7XG4gICAgICAgICAgICB0aGlzLmFwcGxpY2FudHNbYXBwbGljYW50XS5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc3RhdHVzID0gQy5TVEFUVVNfVVNFUl9DTE9TRUQ7XG4gICAgICAgIC8qXG4gICAgICAgICAqIElmIHRoZSByZW1haW5pbmcgdHJhbnNhY3Rpb25zIGFyZSBhbGwgSU5WSVRFIHRyYW5zYWN0aW9ucywgdGhlcmUgaXMgbm8gbmVlZCB0b1xuICAgICAgICAgKiB3YWl0IGFueW1vcmUgYmVjYXVzZSBldmVyeSBzZXNzaW9uIGhhcyBhbHJlYWR5IGJlZW4gY2xvc2VkIGJ5IHRoaXMgbWV0aG9kLlxuICAgICAgICAgKiAtIGxvY2FsbHkgb3JpZ2luYXRlZCBzZXNzaW9ucyB3aGVyZSB0ZXJtaW5hdGVkIChDQU5DRUwgb3IgQllFKVxuICAgICAgICAgKiAtIHJlbW90ZWx5IG9yaWdpbmF0ZWQgc2Vzc2lvbnMgd2hlcmUgcmVqZWN0ZWQgKDRYWCkgb3IgdGVybWluYXRlZCAoQllFKVxuICAgICAgICAgKiBSZW1haW5pbmcgSU5WSVRFIHRyYW5zYWN0aW9ucyBiZWxvbmcgdGhvIHNlc3Npb25zIHRoYXQgd2hlcmUgYW5zd2VyZWQuIFRoaXMgYXJlIGluXG4gICAgICAgICAqICdhY2NlcHRlZCcgc3RhdGUgZHVlIHRvIHRpbWVycyAnTCcgYW5kICdNJyBkZWZpbmVkIGluIFtSRkMgNjAyNl1cbiAgICAgICAgICovXG4gICAgICAgIGlmICh0aGlzLm5pc3RUcmFuc2FjdGlvbnNDb3VudCA9PT0gMCAmJiB0aGlzLm5pY3RUcmFuc2FjdGlvbnNDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQuZGlzY29ubmVjdCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5vbigndHJhbnNhY3Rpb25EZXN0cm95ZWQnLCB0cmFuc2FjdGlvbnNMaXN0ZW5lcik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBlbnZpcm9ubWVudC5yZW1vdmVFdmVudExpc3RlbmVyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAvLyBHb29nbGUgQ2hyb21lIFBhY2thZ2VkIEFwcHMgZG9uJ3QgYWxsb3cgJ3VubG9hZCcgbGlzdGVuZXJzOlxuICAgICAgICAgICAgLy8gdW5sb2FkIGlzIG5vdCBhdmFpbGFibGUgaW4gcGFja2FnZWQgYXBwc1xuICAgICAgICAgICAgaWYgKCEoZ2xvYmFsLmNocm9tZSAmJiBnbG9iYWwuY2hyb21lLmFwcCAmJiBnbG9iYWwuY2hyb21lLmFwcC5ydW50aW1lKSkge1xuICAgICAgICAgICAgICAgIGVudmlyb25tZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3VubG9hZCcsIHRoaXMuZW52aXJvbkxpc3RlbmVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIENvbm5lY3QgdG8gdGhlIFdTIHNlcnZlciBpZiBzdGF0dXMgPSBTVEFUVVNfSU5JVC5cbiAgICAgKiBSZXN1bWUgVUEgYWZ0ZXIgYmVpbmcgY2xvc2VkLlxuICAgICAqXG4gICAgICovXG4gICAgVUEucHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyB2YXIgc2VydmVyO1xuICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ3VzZXIgcmVxdWVzdGVkIHN0YXJ0dXAuLi4nKTtcbiAgICAgICAgaWYgKHRoaXMuc3RhdHVzID09PSBDLlNUQVRVU19JTklUKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXR1cyA9IEMuU1RBVFVTX1NUQVJUSU5HO1xuICAgICAgICAgICAgaWYgKCF0aGlzLmNvbmZpZ3VyYXRpb24udHJhbnNwb3J0Q29uc3RydWN0b3IpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU0lQLkV4Y2VwdGlvbnMuVHJhbnNwb3J0RXJyb3IoXCJUcmFuc3BvcnQgY29uc3RydWN0b3Igbm90IHNldFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0ID0gbmV3IHRoaXMuY29uZmlndXJhdGlvbi50cmFuc3BvcnRDb25zdHJ1Y3Rvcih0aGlzLmdldExvZ2dlcignc2lwLnRyYW5zcG9ydCcpLCB0aGlzLmNvbmZpZ3VyYXRpb24udHJhbnNwb3J0T3B0aW9ucyk7XG4gICAgICAgICAgICB0aGlzLnNldFRyYW5zcG9ydExpc3RlbmVycygpO1xuICAgICAgICAgICAgdGhpcy5lbWl0KCd0cmFuc3BvcnRDcmVhdGVkJywgdGhpcy50cmFuc3BvcnQpO1xuICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQuY29ubmVjdCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMuc3RhdHVzID09PSBDLlNUQVRVU19VU0VSX0NMT1NFRCkge1xuICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKCdyZXN1bWluZycpO1xuICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSBDLlNUQVRVU19SRUFEWTtcbiAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0LmNvbm5lY3QoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLnN0YXR1cyA9PT0gQy5TVEFUVVNfU1RBUlRJTkcpIHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZygnVUEgaXMgaW4gU1RBUlRJTkcgc3RhdHVzLCBub3Qgb3BlbmluZyBuZXcgY29ubmVjdGlvbicpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMuc3RhdHVzID09PSBDLlNUQVRVU19SRUFEWSkge1xuICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKCdVQSBpcyBpbiBSRUFEWSBzdGF0dXMsIG5vdCByZXN1bWluZycpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0Nvbm5lY3Rpb24gaXMgZG93bi4gQXV0by1SZWNvdmVyeSBzeXN0ZW0gaXMgdHJ5aW5nIHRvIGNvbm5lY3QnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jb25maWd1cmF0aW9uLmF1dG9zdG9wICYmIHR5cGVvZiBlbnZpcm9ubWVudC5hZGRFdmVudExpc3RlbmVyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAvLyBHb29nbGUgQ2hyb21lIFBhY2thZ2VkIEFwcHMgZG9uJ3QgYWxsb3cgJ3VubG9hZCcgbGlzdGVuZXJzOlxuICAgICAgICAgICAgLy8gdW5sb2FkIGlzIG5vdCBhdmFpbGFibGUgaW4gcGFja2FnZWQgYXBwc1xuICAgICAgICAgICAgaWYgKCEoZ2xvYmFsLmNocm9tZSAmJiBnbG9iYWwuY2hyb21lLmFwcCAmJiBnbG9iYWwuY2hyb21lLmFwcC5ydW50aW1lKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZW52aXJvbkxpc3RlbmVyID0gdGhpcy5zdG9wLmJpbmQodGhpcyk7XG4gICAgICAgICAgICAgICAgZW52aXJvbm1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndW5sb2FkJywgdGhpcy5lbnZpcm9uTGlzdGVuZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogTm9ybWFsaXplIGEgc3RyaW5nIGludG8gYSB2YWxpZCBTSVAgcmVxdWVzdCBVUklcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0YXJnZXRcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtTSVAuVVJJfHVuZGVmaW5lZH1cbiAgICAgKi9cbiAgICBVQS5wcm90b3R5cGUubm9ybWFsaXplVGFyZ2V0ID0gZnVuY3Rpb24gKHRhcmdldCkge1xuICAgICAgICByZXR1cm4gU0lQLlV0aWxzLm5vcm1hbGl6ZVRhcmdldCh0YXJnZXQsIHRoaXMuY29uZmlndXJhdGlvbi5ob3N0cG9ydFBhcmFtcyk7XG4gICAgfTtcbiAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvLyAgUHJpdmF0ZSAoRm9yIGludGVybmFsIHVzZSlcbiAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBVQS5wcm90b3R5cGUuc2F2ZUNyZWRlbnRpYWxzID0gZnVuY3Rpb24gKGNyZWRlbnRpYWxzKSB7XG4gICAgICAgIHRoaXMuY2FjaGUuY3JlZGVudGlhbHNbY3JlZGVudGlhbHMucmVhbG1dID0gdGhpcy5jYWNoZS5jcmVkZW50aWFsc1tjcmVkZW50aWFscy5yZWFsbV0gfHwge307XG4gICAgICAgIHRoaXMuY2FjaGUuY3JlZGVudGlhbHNbY3JlZGVudGlhbHMucmVhbG1dW2NyZWRlbnRpYWxzLnVyaV0gPSBjcmVkZW50aWFscztcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICBVQS5wcm90b3R5cGUuZ2V0Q3JlZGVudGlhbHMgPSBmdW5jdGlvbiAocmVxdWVzdCkge1xuICAgICAgICB2YXIgcmVhbG0sIGNyZWRlbnRpYWxzO1xuICAgICAgICByZWFsbSA9IHJlcXVlc3QucnVyaS5ob3N0O1xuICAgICAgICBpZiAodGhpcy5jYWNoZS5jcmVkZW50aWFsc1tyZWFsbV0gJiYgdGhpcy5jYWNoZS5jcmVkZW50aWFsc1tyZWFsbV1bcmVxdWVzdC5ydXJpXSkge1xuICAgICAgICAgICAgY3JlZGVudGlhbHMgPSB0aGlzLmNhY2hlLmNyZWRlbnRpYWxzW3JlYWxtXVtyZXF1ZXN0LnJ1cmldO1xuICAgICAgICAgICAgY3JlZGVudGlhbHMubWV0aG9kID0gcmVxdWVzdC5tZXRob2Q7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNyZWRlbnRpYWxzO1xuICAgIH07XG4gICAgVUEucHJvdG90eXBlLmdldExvZ2dlciA9IGZ1bmN0aW9uIChjYXRlZ29yeSwgbGFiZWwpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubG9nLmdldExvZ2dlcihjYXRlZ29yeSwgbGFiZWwpO1xuICAgIH07XG4gICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvLyBFdmVudCBIYW5kbGVyc1xuICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgVUEucHJvdG90eXBlLm9uVHJhbnNwb3J0RXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLnN0YXR1cyA9PT0gQy5TVEFUVVNfVVNFUl9DTE9TRUQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMuZXJyb3IgfHwgdGhpcy5lcnJvciAhPT0gQy5ORVRXT1JLX0VSUk9SKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXR1cyA9IEMuU1RBVFVTX05PVF9SRUFEWTtcbiAgICAgICAgICAgIHRoaXMuZXJyb3IgPSBDLk5FVFdPUktfRVJST1I7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEhlbHBlciBmdW5jdGlvbi4gU2V0cyB0cmFuc3BvcnQgbGlzdGVuZXJzXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBVQS5wcm90b3R5cGUuc2V0VHJhbnNwb3J0TGlzdGVuZXJzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnRyYW5zcG9ydC5vbignY29ubmVjdGVkJywgdGhpcy5vblRyYW5zcG9ydENvbm5lY3RlZC5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy50cmFuc3BvcnQub24oJ21lc3NhZ2UnLCB0aGlzLm9uVHJhbnNwb3J0UmVjZWl2ZU1zZy5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy50cmFuc3BvcnQub24oJ3RyYW5zcG9ydEVycm9yJywgdGhpcy5vblRyYW5zcG9ydEVycm9yLmJpbmQodGhpcykpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogVHJhbnNwb3J0IGNvbm5lY3Rpb24gZXZlbnQuXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAZXZlbnRcbiAgICAgKiBAcGFyYW0ge1NJUC5UcmFuc3BvcnR9IHRyYW5zcG9ydC5cbiAgICAgKi9cbiAgICBVQS5wcm90b3R5cGUub25UcmFuc3BvcnRDb25uZWN0ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLmNvbmZpZ3VyYXRpb24ucmVnaXN0ZXIpIHtcbiAgICAgICAgICAgIHRoaXMuY29uZmlndXJhdGlvbi5hdXRoZW50aWNhdGlvbkZhY3RvcnkuaW5pdGlhbGl6ZSgpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVnaXN0ZXJDb250ZXh0Lm9uVHJhbnNwb3J0Q29ubmVjdGVkKCk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBUcmFuc3BvcnQgbWVzc2FnZSByZWNlaXB0IGV2ZW50LlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQGV2ZW50XG4gICAgICogQHBhcmFtIHtTdHJpbmd9IG1lc3NhZ2VcbiAgICAgKi9cbiAgICBVQS5wcm90b3R5cGUub25UcmFuc3BvcnRSZWNlaXZlTXNnID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICAgICAgdmFyIHRyYW5zYWN0aW9uO1xuICAgICAgICBtZXNzYWdlID0gU0lQLlBhcnNlci5wYXJzZU1lc3NhZ2UobWVzc2FnZSwgdGhpcyk7XG4gICAgICAgIGlmICh0aGlzLnN0YXR1cyA9PT0gU0lQLlVBLkMuU1RBVFVTX1VTRVJfQ0xPU0VEICYmIG1lc3NhZ2UgaW5zdGFuY2VvZiBTSVAuSW5jb21pbmdSZXF1ZXN0KSB7XG4gICAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuKCdVQSByZWNlaXZlZCBtZXNzYWdlIHdoZW4gc3RhdHVzID0gVVNFUl9DTE9TRUQgLSBhYm9ydGluZycpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIERvIHNvbWUgc2FuaXR5IGNoZWNrXG4gICAgICAgIGlmIChTSVAuc2FuaXR5Q2hlY2sobWVzc2FnZSwgdGhpcywgdGhpcy50cmFuc3BvcnQpKSB7XG4gICAgICAgICAgICBpZiAobWVzc2FnZSBpbnN0YW5jZW9mIFNJUC5JbmNvbWluZ1JlcXVlc3QpIHtcbiAgICAgICAgICAgICAgICBtZXNzYWdlLnRyYW5zcG9ydCA9IHRoaXMudHJhbnNwb3J0O1xuICAgICAgICAgICAgICAgIHRoaXMucmVjZWl2ZVJlcXVlc3QobWVzc2FnZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChtZXNzYWdlIGluc3RhbmNlb2YgU0lQLkluY29taW5nUmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAvKiBVbmlrZSBzdGF0ZWQgaW4gMTguMS4yLCBpZiBhIHJlc3BvbnNlIGRvZXMgbm90IG1hdGNoXG4gICAgICAgICAgICAgICAgKiBhbnkgdHJhbnNhY3Rpb24sIGl0IGlzIGRpc2NhcmRlZCBoZXJlIGFuZCBubyBwYXNzZWQgdG8gdGhlIGNvcmVcbiAgICAgICAgICAgICAgICAqIGluIG9yZGVyIHRvIGJlIGRpc2NhcmRlZCB0aGVyZS5cbiAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIHN3aXRjaCAobWVzc2FnZS5tZXRob2QpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBTSVAuQy5JTlZJVEU6XG4gICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbiA9IHRoaXMudHJhbnNhY3Rpb25zLmljdFttZXNzYWdlLnZpYV9icmFuY2hdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRyYW5zYWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb24ucmVjZWl2ZVJlc3BvbnNlKG1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgU0lQLkMuQUNLOlxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSnVzdCBpbiBjYXNlIDstKVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbiA9IHRoaXMudHJhbnNhY3Rpb25zLm5pY3RbbWVzc2FnZS52aWFfYnJhbmNoXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmFuc2FjdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uLnJlY2VpdmVSZXNwb25zZShtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgLyoqXG4gICAgICogbmV3IFRyYW5zYWN0aW9uXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge1NJUC5UcmFuc2FjdGlvbn0gdHJhbnNhY3Rpb24uXG4gICAgICovXG4gICAgVUEucHJvdG90eXBlLm5ld1RyYW5zYWN0aW9uID0gZnVuY3Rpb24gKHRyYW5zYWN0aW9uKSB7XG4gICAgICAgIHRoaXMudHJhbnNhY3Rpb25zW3RyYW5zYWN0aW9uLnR5cGVdW3RyYW5zYWN0aW9uLmlkXSA9IHRyYW5zYWN0aW9uO1xuICAgICAgICB0aGlzLmVtaXQoJ25ld1RyYW5zYWN0aW9uJywgeyB0cmFuc2FjdGlvbjogdHJhbnNhY3Rpb24gfSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBkZXN0cm95IFRyYW5zYWN0aW9uXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge1NJUC5UcmFuc2FjdGlvbn0gdHJhbnNhY3Rpb24uXG4gICAgICovXG4gICAgVUEucHJvdG90eXBlLmRlc3Ryb3lUcmFuc2FjdGlvbiA9IGZ1bmN0aW9uICh0cmFuc2FjdGlvbikge1xuICAgICAgICBkZWxldGUgdGhpcy50cmFuc2FjdGlvbnNbdHJhbnNhY3Rpb24udHlwZV1bdHJhbnNhY3Rpb24uaWRdO1xuICAgICAgICB0aGlzLmVtaXQoJ3RyYW5zYWN0aW9uRGVzdHJveWVkJywge1xuICAgICAgICAgICAgdHJhbnNhY3Rpb246IHRyYW5zYWN0aW9uXG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgLy8gcmVjZWl2ZVJlcXVlc3RcbiAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvKipcbiAgICAgKiBSZXF1ZXN0IHJlY2VwdGlvblxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtTSVAuSW5jb21pbmdSZXF1ZXN0fSByZXF1ZXN0LlxuICAgICAqL1xuICAgIFVBLnByb3RvdHlwZS5yZWNlaXZlUmVxdWVzdCA9IGZ1bmN0aW9uIChyZXF1ZXN0KSB7XG4gICAgICAgIHZhciBkaWFsb2csIHNlc3Npb24sIG1lc3NhZ2UsIGVhcmx5U3Vic2NyaXB0aW9uLCBtZXRob2QgPSByZXF1ZXN0Lm1ldGhvZCwgcmVwbGFjZXMsIHJlcGxhY2VkRGlhbG9nLCBzZWxmID0gdGhpcztcbiAgICAgICAgZnVuY3Rpb24gcnVyaU1hdGNoZXModXJpKSB7XG4gICAgICAgICAgICByZXR1cm4gdXJpICYmIHVyaS51c2VyID09PSByZXF1ZXN0LnJ1cmkudXNlcjtcbiAgICAgICAgfVxuICAgICAgICAvLyBDaGVjayB0aGF0IHJlcXVlc3QgVVJJIHBvaW50cyB0byB1c1xuICAgICAgICBpZiAoIShydXJpTWF0Y2hlcyh0aGlzLmNvbmZpZ3VyYXRpb24udXJpKSB8fFxuICAgICAgICAgICAgcnVyaU1hdGNoZXModGhpcy5jb250YWN0LnVyaSkgfHxcbiAgICAgICAgICAgIHJ1cmlNYXRjaGVzKHRoaXMuY29udGFjdC5wdWJfZ3J1dSkgfHxcbiAgICAgICAgICAgIHJ1cmlNYXRjaGVzKHRoaXMuY29udGFjdC50ZW1wX2dydXUpKSkge1xuICAgICAgICAgICAgdGhpcy5sb2dnZXIud2FybignUmVxdWVzdC1VUkkgZG9lcyBub3QgcG9pbnQgdG8gdXMnKTtcbiAgICAgICAgICAgIGlmIChyZXF1ZXN0Lm1ldGhvZCAhPT0gU0lQLkMuQUNLKSB7XG4gICAgICAgICAgICAgICAgcmVxdWVzdC5yZXBseV9zbCg0MDQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIENoZWNrIHJlcXVlc3QgVVJJIHNjaGVtZVxuICAgICAgICBpZiAocmVxdWVzdC5ydXJpLnNjaGVtZSA9PT0gU0lQLkMuU0lQUykge1xuICAgICAgICAgICAgcmVxdWVzdC5yZXBseV9zbCg0MTYpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIENoZWNrIHRyYW5zYWN0aW9uXG4gICAgICAgIGlmIChTSVAuVHJhbnNhY3Rpb25zLmNoZWNrVHJhbnNhY3Rpb24odGhpcywgcmVxdWVzdCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvKiBSRkMzMjYxIDEyLjIuMlxuICAgICAgICAgKiBSZXF1ZXN0cyB0aGF0IGRvIG5vdCBjaGFuZ2UgaW4gYW55IHdheSB0aGUgc3RhdGUgb2YgYSBkaWFsb2cgbWF5IGJlXG4gICAgICAgICAqIHJlY2VpdmVkIHdpdGhpbiBhIGRpYWxvZyAoZm9yIGV4YW1wbGUsIGFuIE9QVElPTlMgcmVxdWVzdCkuXG4gICAgICAgICAqIFRoZXkgYXJlIHByb2Nlc3NlZCBhcyBpZiB0aGV5IGhhZCBiZWVuIHJlY2VpdmVkIG91dHNpZGUgdGhlIGRpYWxvZy5cbiAgICAgICAgICovXG4gICAgICAgIGlmIChtZXRob2QgPT09IFNJUC5DLk9QVElPTlMpIHtcbiAgICAgICAgICAgIG5ldyBTSVAuVHJhbnNhY3Rpb25zLk5vbkludml0ZVNlcnZlclRyYW5zYWN0aW9uKHJlcXVlc3QsIHRoaXMpO1xuICAgICAgICAgICAgcmVxdWVzdC5yZXBseSgyMDAsIG51bGwsIFtcbiAgICAgICAgICAgICAgICAnQWxsb3c6ICcgKyBTSVAuVUEuQy5BTExPV0VEX01FVEhPRFMudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAnQWNjZXB0OiAnICsgQy5BQ0NFUFRFRF9CT0RZX1RZUEVTXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChtZXRob2QgPT09IFNJUC5DLk1FU1NBR0UpIHtcbiAgICAgICAgICAgIG1lc3NhZ2UgPSBuZXcgU0lQLlNlcnZlckNvbnRleHQodGhpcywgcmVxdWVzdCk7XG4gICAgICAgICAgICBtZXNzYWdlLmJvZHkgPSByZXF1ZXN0LmJvZHk7XG4gICAgICAgICAgICBtZXNzYWdlLmNvbnRlbnRfdHlwZSA9IHJlcXVlc3QuZ2V0SGVhZGVyKCdDb250ZW50LVR5cGUnKSB8fCAndGV4dC9wbGFpbic7XG4gICAgICAgICAgICByZXF1ZXN0LnJlcGx5KDIwMCwgbnVsbCk7XG4gICAgICAgICAgICB0aGlzLmVtaXQoJ21lc3NhZ2UnLCBtZXNzYWdlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChtZXRob2QgIT09IFNJUC5DLklOVklURSAmJlxuICAgICAgICAgICAgbWV0aG9kICE9PSBTSVAuQy5BQ0spIHtcbiAgICAgICAgICAgIC8vIExldCB0aG9zZSBtZXRob2RzIHBhc3MgdGhyb3VnaCB0byBub3JtYWwgcHJvY2Vzc2luZyBmb3Igbm93LlxuICAgICAgICAgICAgbmV3IFNJUC5TZXJ2ZXJDb250ZXh0KHRoaXMsIHJlcXVlc3QpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEluaXRpYWwgUmVxdWVzdFxuICAgICAgICBpZiAoIXJlcXVlc3QudG9fdGFnKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKG1ldGhvZCkge1xuICAgICAgICAgICAgICAgIGNhc2UgU0lQLkMuSU5WSVRFOlxuICAgICAgICAgICAgICAgICAgICByZXBsYWNlcyA9XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb24ucmVwbGFjZXMgIT09IFNJUC5DLnN1cHBvcnRlZC5VTlNVUFBPUlRFRCAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3QucGFyc2VIZWFkZXIoJ3JlcGxhY2VzJyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXBsYWNlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZWREaWFsb2cgPSB0aGlzLmRpYWxvZ3NbcmVwbGFjZXMuY2FsbF9pZCArIHJlcGxhY2VzLnJlcGxhY2VzX3RvX3RhZyArIHJlcGxhY2VzLnJlcGxhY2VzX2Zyb21fdGFnXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVwbGFjZWREaWFsb2cpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1JlcGxhY2VkIGhlYWRlciB3aXRob3V0IGEgbWF0Y2hpbmcgZGlhbG9nLCByZWplY3RcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnJlcGx5X3NsKDQ4MSwgbnVsbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocmVwbGFjZWREaWFsb2cub3duZXIuc3RhdHVzID09PSBTSVAuU2Vzc2lvbi5DLlNUQVRVU19URVJNSU5BVEVEKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5yZXBseV9zbCg2MDMsIG51bGwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlcGxhY2VkRGlhbG9nLnN0YXRlID09PSBTSVAuRGlhbG9nLkMuU1RBVFVTX0NPTkZJUk1FRCAmJiByZXBsYWNlcy5lYXJseV9vbmx5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5yZXBseV9zbCg0ODYsIG51bGwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uID0gbmV3IFNJUC5JbnZpdGVTZXJ2ZXJDb250ZXh0KHRoaXMsIHJlcXVlc3QpO1xuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLnJlcGxhY2VlID0gcmVwbGFjZWREaWFsb2cgJiYgcmVwbGFjZWREaWFsb2cub3duZXI7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuZW1pdCgnaW52aXRlJywgc2Vzc2lvbik7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgU0lQLkMuQllFOlxuICAgICAgICAgICAgICAgICAgICAvLyBPdXQgb2YgZGlhbG9nIEJZRSByZWNlaXZlZFxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnJlcGx5KDQ4MSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgU0lQLkMuQ0FOQ0VMOlxuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uID0gdGhpcy5maW5kU2Vzc2lvbihyZXF1ZXN0KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlc3Npb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb24ucmVjZWl2ZVJlcXVlc3QocmVxdWVzdCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuKCdyZWNlaXZlZCBDQU5DRUwgcmVxdWVzdCBmb3IgYSBub24gZXhpc3RlbnQgc2Vzc2lvbicpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgU0lQLkMuQUNLOlxuICAgICAgICAgICAgICAgICAgICAvKiBBYnNvcmIgaXQuXG4gICAgICAgICAgICAgICAgICAgICAqIEFDSyByZXF1ZXN0IHdpdGhvdXQgYSBjb3JyZXNwb25kaW5nIEludml0ZSBUcmFuc2FjdGlvblxuICAgICAgICAgICAgICAgICAgICAgKiBhbmQgd2l0aG91dCBUbyB0YWcuXG4gICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFNJUC5DLk5PVElGWTpcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY29uZmlndXJhdGlvbi5hbGxvd0xlZ2FjeU5vdGlmaWNhdGlvbnMgJiYgdGhpcy5saXN0ZW5lcnMoJ25vdGlmeScpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3QucmVwbHkoMjAwLCBudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZW1pdCgnbm90aWZ5JywgeyByZXF1ZXN0OiByZXF1ZXN0IH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5yZXBseSg0ODEsICdTdWJzY3JpcHRpb24gZG9lcyBub3QgZXhpc3QnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFNJUC5DLlJFRkVSOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ1JlY2VpdmVkIGFuIG91dCBvZiBkaWFsb2cgcmVmZXInKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY29uZmlndXJhdGlvbi5hbGxvd091dE9mRGlhbG9nUmVmZXJzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ0FsbG93IG91dCBvZiBkaWFsb2cgcmVmZXJzIGlzIGVuYWJsZWQgb24gdGhlIFVBJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVmZXJDb250ZXh0ID0gbmV3IFNJUC5SZWZlclNlcnZlckNvbnRleHQodGhpcywgcmVxdWVzdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaGFzUmVmZXJMaXN0ZW5lciA9IHRoaXMubGlzdGVuZXJzKCdvdXRPZkRpYWxvZ1JlZmVyUmVxdWVzdGVkJykubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhhc1JlZmVyTGlzdGVuZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ291dE9mRGlhbG9nUmVmZXJSZXF1ZXN0ZWQnLCByZWZlckNvbnRleHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKCdObyBvdXRPZkRpYWxvZ1JlZmVyUmVxdWVzdCBsaXN0ZW5lcnMsIGF1dG9tYXRpY2FsbHkgYWNjZXB0aW5nIGFuZCBmb2xsb3dpbmcgdGhlIG91dCBvZiBkaWFsb2cgcmVmZXInKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlckNvbnRleHQuYWNjZXB0KHsgZm9sbG93UmVmZXI6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnJlcGx5KDQwNSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3QucmVwbHkoNDA1KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gSW4tZGlhbG9nIHJlcXVlc3RcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBkaWFsb2cgPSB0aGlzLmZpbmREaWFsb2cocmVxdWVzdCk7XG4gICAgICAgICAgICBpZiAoZGlhbG9nKSB7XG4gICAgICAgICAgICAgICAgaWYgKG1ldGhvZCA9PT0gU0lQLkMuSU5WSVRFKSB7XG4gICAgICAgICAgICAgICAgICAgIG5ldyBTSVAuVHJhbnNhY3Rpb25zLkludml0ZVNlcnZlclRyYW5zYWN0aW9uKHJlcXVlc3QsIHRoaXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkaWFsb2cucmVjZWl2ZVJlcXVlc3QocmVxdWVzdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChtZXRob2QgPT09IFNJUC5DLk5PVElGWSkge1xuICAgICAgICAgICAgICAgIHNlc3Npb24gPSB0aGlzLmZpbmRTZXNzaW9uKHJlcXVlc3QpO1xuICAgICAgICAgICAgICAgIGVhcmx5U3Vic2NyaXB0aW9uID0gdGhpcy5maW5kRWFybHlTdWJzY3JpcHRpb24ocmVxdWVzdCk7XG4gICAgICAgICAgICAgICAgaWYgKHNlc3Npb24pIHtcbiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5yZWNlaXZlUmVxdWVzdChyZXF1ZXN0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZWFybHlTdWJzY3JpcHRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgZWFybHlTdWJzY3JpcHRpb24ucmVjZWl2ZVJlcXVlc3QocmVxdWVzdCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuKCdyZWNlaXZlZCBOT1RJRlkgcmVxdWVzdCBmb3IgYSBub24gZXhpc3RlbnQgc2Vzc2lvbiBvciBzdWJzY3JpcHRpb24nKTtcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5yZXBseSg0ODEsICdTdWJzY3JpcHRpb24gZG9lcyBub3QgZXhpc3QnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvKiBSRkMzMjYxIDEyLjIuMlxuICAgICAgICAgICAgICogUmVxdWVzdCB3aXRoIHRvIHRhZywgYnV0IG5vIG1hdGNoaW5nIGRpYWxvZyBmb3VuZC5cbiAgICAgICAgICAgICAqIEV4Y2VwdGlvbjogQUNLIGZvciBhbiBJbnZpdGUgcmVxdWVzdCBmb3Igd2hpY2ggYSBkaWFsb2cgaGFzIG5vdFxuICAgICAgICAgICAgICogYmVlbiBjcmVhdGVkLlxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAobWV0aG9kICE9PSBTSVAuQy5BQ0spIHtcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5yZXBseSg0ODEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgLy89PT09PT09PT09PT09PT09PVxuICAgIC8vIFV0aWxzXG4gICAgLy89PT09PT09PT09PT09PT09PVxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgc2Vzc2lvbiB0byB3aGljaCB0aGUgcmVxdWVzdCBiZWxvbmdzIHRvLCBpZiBhbnkuXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge1NJUC5JbmNvbWluZ1JlcXVlc3R9IHJlcXVlc3QuXG4gICAgICogQHJldHVybnMge1NJUC5PdXRnb2luZ1Nlc3Npb258U0lQLkluY29taW5nU2Vzc2lvbnxudWxsfVxuICAgICAqL1xuICAgIFVBLnByb3RvdHlwZS5maW5kU2Vzc2lvbiA9IGZ1bmN0aW9uIChyZXF1ZXN0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlc3Npb25zW3JlcXVlc3QuY2FsbF9pZCArIHJlcXVlc3QuZnJvbV90YWddIHx8XG4gICAgICAgICAgICB0aGlzLnNlc3Npb25zW3JlcXVlc3QuY2FsbF9pZCArIHJlcXVlc3QudG9fdGFnXSB8fFxuICAgICAgICAgICAgbnVsbDtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEdldCB0aGUgZGlhbG9nIHRvIHdoaWNoIHRoZSByZXF1ZXN0IGJlbG9uZ3MgdG8sIGlmIGFueS5cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7U0lQLkluY29taW5nUmVxdWVzdH1cbiAgICAgKiBAcmV0dXJucyB7U0lQLkRpYWxvZ3xudWxsfVxuICAgICAqL1xuICAgIFVBLnByb3RvdHlwZS5maW5kRGlhbG9nID0gZnVuY3Rpb24gKHJlcXVlc3QpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGlhbG9nc1tyZXF1ZXN0LmNhbGxfaWQgKyByZXF1ZXN0LmZyb21fdGFnICsgcmVxdWVzdC50b190YWddIHx8XG4gICAgICAgICAgICB0aGlzLmRpYWxvZ3NbcmVxdWVzdC5jYWxsX2lkICsgcmVxdWVzdC50b190YWcgKyByZXF1ZXN0LmZyb21fdGFnXSB8fFxuICAgICAgICAgICAgbnVsbDtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEdldCB0aGUgc3Vic2NyaXB0aW9uIHdoaWNoIGhhcyBub3QgYmVlbiBjb25maXJtZWQgdG8gd2hpY2ggdGhlIHJlcXVlc3QgYmVsb25ncyB0bywgaWYgYW55XG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge1NJUC5JbmNvbWluZ1JlcXVlc3R9XG4gICAgICogQHJldHVybnMge1NJUC5TdWJzY3JpcHRpb258bnVsbH1cbiAgICAgKi9cbiAgICBVQS5wcm90b3R5cGUuZmluZEVhcmx5U3Vic2NyaXB0aW9uID0gZnVuY3Rpb24gKHJlcXVlc3QpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZWFybHlTdWJzY3JpcHRpb25zW3JlcXVlc3QuY2FsbF9pZCArIHJlcXVlc3QudG9fdGFnICsgcmVxdWVzdC5nZXRIZWFkZXIoJ2V2ZW50JyldIHx8IG51bGw7XG4gICAgfTtcbiAgICBmdW5jdGlvbiBjaGVja0F1dGhlbnRpY2F0aW9uRmFjdG9yeShhdXRoZW50aWNhdGlvbkZhY3RvcnkpIHtcbiAgICAgICAgaWYgKCEoYXV0aGVudGljYXRpb25GYWN0b3J5IGluc3RhbmNlb2YgRnVuY3Rpb24pKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFhdXRoZW50aWNhdGlvbkZhY3RvcnkuaW5pdGlhbGl6ZSkge1xuICAgICAgICAgICAgYXV0aGVudGljYXRpb25GYWN0b3J5LmluaXRpYWxpemUgPSBmdW5jdGlvbiBpbml0aWFsaXplKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBTSVAuVXRpbHMuUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhdXRoZW50aWNhdGlvbkZhY3Rvcnk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbmZpZ3VyYXRpb24gbG9hZC5cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIHJldHVybnMge0Jvb2xlYW59XG4gICAgICovXG4gICAgVUEucHJvdG90eXBlLmxvYWRDb25maWcgPSBmdW5jdGlvbiAoY29uZmlndXJhdGlvbikge1xuICAgICAgICAvLyBTZXR0aW5ncyBhbmQgZGVmYXVsdCB2YWx1ZXNcbiAgICAgICAgdmFyIHBhcmFtZXRlciwgdmFsdWUsIGNoZWNrZWRfdmFsdWUsIGhvc3Rwb3J0UGFyYW1zLCByZWdpc3RyYXJTZXJ2ZXIsIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgLyogSG9zdCBhZGRyZXNzXG4gICAgICAgICAgICAqIFZhbHVlIHRvIGJlIHNldCBpbiBWaWEgc2VudF9ieSBhbmQgaG9zdCBwYXJ0IG9mIENvbnRhY3QgRlFETlxuICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHZpYUhvc3Q6IFNJUC5VdGlscy5jcmVhdGVSYW5kb21Ub2tlbigxMikgKyAnLmludmFsaWQnLFxuICAgICAgICAgICAgdXJpOiBuZXcgU0lQLlVSSSgnc2lwJywgJ2Fub255bW91cy4nICsgU0lQLlV0aWxzLmNyZWF0ZVJhbmRvbVRva2VuKDYpLCAnYW5vbnltb3VzLmludmFsaWQnLCBudWxsLCBudWxsKSxcbiAgICAgICAgICAgIC8vQ3VzdG9tIENvbmZpZ3VyYXRpb24gU2V0dGluZ3NcbiAgICAgICAgICAgIGN1c3RvbToge30sXG4gICAgICAgICAgICAvL0Rpc3BsYXkgbmFtZVxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICcnLFxuICAgICAgICAgICAgLy8gUGFzc3dvcmRcbiAgICAgICAgICAgIHBhc3N3b3JkOiBudWxsLFxuICAgICAgICAgICAgLy8gUmVnaXN0cmF0aW9uIHBhcmFtZXRlcnNcbiAgICAgICAgICAgIHJlZ2lzdGVyRXhwaXJlczogNjAwLFxuICAgICAgICAgICAgcmVnaXN0ZXI6IHRydWUsXG4gICAgICAgICAgICByZWdpc3RyYXJTZXJ2ZXI6IG51bGwsXG4gICAgICAgICAgICAvLyBUcmFuc3BvcnQgcmVsYXRlZCBwYXJhbWV0ZXJzXG4gICAgICAgICAgICB0cmFuc3BvcnRDb25zdHJ1Y3RvcjogX193ZWJwYWNrX3JlcXVpcmVfXygyOSkoU0lQKSxcbiAgICAgICAgICAgIHRyYW5zcG9ydE9wdGlvbnM6IHt9LFxuICAgICAgICAgICAgLy9zdHJpbmcgdG8gYmUgaW5zZXJ0ZWQgaW50byBVc2VyLUFnZW50IHJlcXVlc3QgaGVhZGVyXG4gICAgICAgICAgICB1c2VyQWdlbnRTdHJpbmc6IFNJUC5DLlVTRVJfQUdFTlQsXG4gICAgICAgICAgICAvLyBTZXNzaW9uIHBhcmFtZXRlcnNcbiAgICAgICAgICAgIG5vQW5zd2VyVGltZW91dDogNjAsXG4gICAgICAgICAgICAvLyBIYWNrc1xuICAgICAgICAgICAgaGFja1ZpYVRjcDogZmFsc2UsXG4gICAgICAgICAgICBoYWNrSXBJbkNvbnRhY3Q6IGZhbHNlLFxuICAgICAgICAgICAgaGFja1dzc0luVHJhbnNwb3J0OiBmYWxzZSxcbiAgICAgICAgICAgIGhhY2tBbGxvd1VucmVnaXN0ZXJlZE9wdGlvblRhZ3M6IGZhbHNlLFxuICAgICAgICAgICAgLy8gU2Vzc2lvbiBEZXNjcmlwdGlvbiBIYW5kbGVyIE9wdGlvbnNcbiAgICAgICAgICAgIHNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJGYWN0b3J5T3B0aW9uczoge1xuICAgICAgICAgICAgICAgIGNvbnN0cmFpbnRzOiB7fSxcbiAgICAgICAgICAgICAgICBwZWVyQ29ubmVjdGlvbk9wdGlvbnM6IHt9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29udGFjdE5hbWU6IFNJUC5VdGlscy5jcmVhdGVSYW5kb21Ub2tlbig4KSxcbiAgICAgICAgICAgIGNvbnRhY3RUcmFuc3BvcnQ6ICd3cycsXG4gICAgICAgICAgICBmb3JjZVJwb3J0OiBmYWxzZSxcbiAgICAgICAgICAgIC8vYXV0b3N0YXJ0aW5nXG4gICAgICAgICAgICBhdXRvc3RhcnQ6IHRydWUsXG4gICAgICAgICAgICBhdXRvc3RvcDogdHJ1ZSxcbiAgICAgICAgICAgIC8vUmVsaWFibGUgUHJvdmlzaW9uYWwgUmVzcG9uc2VzXG4gICAgICAgICAgICByZWwxMDA6IFNJUC5DLnN1cHBvcnRlZC5VTlNVUFBPUlRFRCxcbiAgICAgICAgICAgIC8vIERUTUYgdHlwZTogJ2luZm8nIG9yICdydHAnIChSRkMgNDczMylcbiAgICAgICAgICAgIC8vIFJUUCBQYXlsb2FkIFNwZWM6IGh0dHBzOi8vdG9vbHMuaWV0Zi5vcmcvaHRtbC9yZmM0NzMzXG4gICAgICAgICAgICAvLyBXZWJSVEMgQXVkaW8gU3BlYzogaHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzc4NzRcbiAgICAgICAgICAgIGR0bWZUeXBlOiBTSVAuQy5kdG1mVHlwZS5JTkZPLFxuICAgICAgICAgICAgLy8gUmVwbGFjZXMgaGVhZGVyIChSRkMgMzg5MSlcbiAgICAgICAgICAgIC8vIGh0dHA6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzM4OTFcbiAgICAgICAgICAgIHJlcGxhY2VzOiBTSVAuQy5zdXBwb3J0ZWQuVU5TVVBQT1JURUQsXG4gICAgICAgICAgICBzZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyRmFjdG9yeTogX193ZWJwYWNrX3JlcXVpcmVfXygzMCkoU0lQKS5kZWZhdWx0RmFjdG9yeSxcbiAgICAgICAgICAgIGF1dGhlbnRpY2F0aW9uRmFjdG9yeTogY2hlY2tBdXRoZW50aWNhdGlvbkZhY3RvcnkoZnVuY3Rpb24gYXV0aGVudGljYXRpb25GYWN0b3J5KHVhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTSVAuRGlnZXN0QXV0aGVudGljYXRpb24odWEpO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBhbGxvd0xlZ2FjeU5vdGlmaWNhdGlvbnM6IGZhbHNlLFxuICAgICAgICAgICAgYWxsb3dPdXRPZkRpYWxvZ1JlZmVyczogZmFsc2UsXG4gICAgICAgIH07XG4gICAgICAgIC8vIFByZS1Db25maWd1cmF0aW9uXG4gICAgICAgIGZ1bmN0aW9uIGFsaWFzVW5kZXJzY29yZWQocGFyYW1ldGVyLCBsb2dnZXIpIHtcbiAgICAgICAgICAgIHZhciB1bmRlcnNjb3JlZCA9IHBhcmFtZXRlci5yZXBsYWNlKC8oW2Etel1bQS1aXSkvZywgZnVuY3Rpb24gKG0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbVswXSArICdfJyArIG1bMV0udG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKHBhcmFtZXRlciA9PT0gdW5kZXJzY29yZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgaGFzUGFyYW1ldGVyID0gY29uZmlndXJhdGlvbi5oYXNPd25Qcm9wZXJ0eShwYXJhbWV0ZXIpO1xuICAgICAgICAgICAgaWYgKGNvbmZpZ3VyYXRpb24uaGFzT3duUHJvcGVydHkodW5kZXJzY29yZWQpKSB7XG4gICAgICAgICAgICAgICAgbG9nZ2VyLndhcm4odW5kZXJzY29yZWQgKyAnIGlzIGRlcHJlY2F0ZWQsIHBsZWFzZSB1c2UgJyArIHBhcmFtZXRlcik7XG4gICAgICAgICAgICAgICAgaWYgKGhhc1BhcmFtZXRlcikge1xuICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybihwYXJhbWV0ZXIgKyAnIG92ZXJyaWRpbmcgJyArIHVuZGVyc2NvcmVkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25maWd1cmF0aW9uW3BhcmFtZXRlcl0gPSBoYXNQYXJhbWV0ZXIgPyBjb25maWd1cmF0aW9uW3BhcmFtZXRlcl0gOiBjb25maWd1cmF0aW9uW3VuZGVyc2NvcmVkXTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgY29uZmlnQ2hlY2sgPSB0aGlzLmdldENvbmZpZ3VyYXRpb25DaGVjaygpO1xuICAgICAgICAvLyBDaGVjayBNYW5kYXRvcnkgcGFyYW1ldGVyc1xuICAgICAgICBmb3IgKHBhcmFtZXRlciBpbiBjb25maWdDaGVjay5tYW5kYXRvcnkpIHtcbiAgICAgICAgICAgIGFsaWFzVW5kZXJzY29yZWQocGFyYW1ldGVyLCB0aGlzLmxvZ2dlcik7XG4gICAgICAgICAgICBpZiAoIWNvbmZpZ3VyYXRpb24uaGFzT3duUHJvcGVydHkocGFyYW1ldGVyKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBTSVAuRXhjZXB0aW9ucy5Db25maWd1cmF0aW9uRXJyb3IocGFyYW1ldGVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhbHVlID0gY29uZmlndXJhdGlvbltwYXJhbWV0ZXJdO1xuICAgICAgICAgICAgICAgIGNoZWNrZWRfdmFsdWUgPSBjb25maWdDaGVjay5tYW5kYXRvcnlbcGFyYW1ldGVyXSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgaWYgKGNoZWNrZWRfdmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBzZXR0aW5nc1twYXJhbWV0ZXJdID0gY2hlY2tlZF92YWx1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBTSVAuRXhjZXB0aW9ucy5Db25maWd1cmF0aW9uRXJyb3IocGFyYW1ldGVyLCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIENoZWNrIE9wdGlvbmFsIHBhcmFtZXRlcnNcbiAgICAgICAgZm9yIChwYXJhbWV0ZXIgaW4gY29uZmlnQ2hlY2sub3B0aW9uYWwpIHtcbiAgICAgICAgICAgIGFsaWFzVW5kZXJzY29yZWQocGFyYW1ldGVyLCB0aGlzLmxvZ2dlcik7XG4gICAgICAgICAgICBpZiAoY29uZmlndXJhdGlvbi5oYXNPd25Qcm9wZXJ0eShwYXJhbWV0ZXIpKSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSBjb25maWd1cmF0aW9uW3BhcmFtZXRlcl07XG4gICAgICAgICAgICAgICAgLy8gSWYgdGhlIHBhcmFtZXRlciB2YWx1ZSBpcyBhbiBlbXB0eSBhcnJheSwgYnV0IHNob3VsZG4ndCBiZSwgYXBwbHkgaXRzIGRlZmF1bHQgdmFsdWUuXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgQXJyYXkgJiYgdmFsdWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgcGFyYW1ldGVyIHZhbHVlIGlzIG51bGwsIGVtcHR5IHN0cmluZywgb3IgdW5kZWZpbmVkIHRoZW4gYXBwbHkgaXRzIGRlZmF1bHQgdmFsdWUuXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSBcIlwiIHx8IHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIElmIGl0J3MgYSBudW1iZXIgd2l0aCBOYU4gdmFsdWUgdGhlbiBhbHNvIGFwcGx5IGl0cyBkZWZhdWx0IHZhbHVlLlxuICAgICAgICAgICAgICAgIC8vIE5PVEU6IEpTIGRvZXMgbm90IGFsbG93IFwidmFsdWUgPT09IE5hTlwiLCB0aGUgZm9sbG93aW5nIGRvZXMgdGhlIHdvcms6XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mICh2YWx1ZSkgPT09ICdudW1iZXInICYmIGlzTmFOKHZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2hlY2tlZF92YWx1ZSA9IGNvbmZpZ0NoZWNrLm9wdGlvbmFsW3BhcmFtZXRlcl0odmFsdWUpO1xuICAgICAgICAgICAgICAgIGlmIChjaGVja2VkX3ZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NbcGFyYW1ldGVyXSA9IGNoZWNrZWRfdmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU0lQLkV4Y2VwdGlvbnMuQ29uZmlndXJhdGlvbkVycm9yKHBhcmFtZXRlciwgdmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBQb3N0IENvbmZpZ3VyYXRpb24gUHJvY2Vzc1xuICAgICAgICAvLyBBbGxvdyBwYXNzaW5nIDAgbnVtYmVyIGFzIGRpc3BsYXlOYW1lLlxuICAgICAgICBpZiAoc2V0dGluZ3MuZGlzcGxheU5hbWUgPT09IDApIHtcbiAgICAgICAgICAgIHNldHRpbmdzLmRpc3BsYXlOYW1lID0gJzAnO1xuICAgICAgICB9XG4gICAgICAgIC8vIEluc3RhbmNlLWlkIGZvciBHUlVVXG4gICAgICAgIGlmICghc2V0dGluZ3MuaW5zdGFuY2VJZCkge1xuICAgICAgICAgICAgc2V0dGluZ3MuaW5zdGFuY2VJZCA9IFNJUC5VdGlscy5uZXdVVUlEKCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gc2lwanNJZCBpbnN0YW5jZSBwYXJhbWV0ZXIuIFN0YXRpYyByYW5kb20gdGFnIG9mIGxlbmd0aCA1XG4gICAgICAgIHNldHRpbmdzLnNpcGpzSWQgPSBTSVAuVXRpbHMuY3JlYXRlUmFuZG9tVG9rZW4oNSk7XG4gICAgICAgIC8vIFN0cmluZyBjb250YWluaW5nIHNldHRpbmdzLnVyaSB3aXRob3V0IHNjaGVtZSBhbmQgdXNlci5cbiAgICAgICAgaG9zdHBvcnRQYXJhbXMgPSBzZXR0aW5ncy51cmkuY2xvbmUoKTtcbiAgICAgICAgaG9zdHBvcnRQYXJhbXMudXNlciA9IG51bGw7XG4gICAgICAgIHNldHRpbmdzLmhvc3Rwb3J0UGFyYW1zID0gaG9zdHBvcnRQYXJhbXMudG9SYXcoKS5yZXBsYWNlKC9ec2lwOi9pLCAnJyk7XG4gICAgICAgIC8qIENoZWNrIHdoZXRoZXIgYXV0aG9yaXphdGlvblVzZXIgaXMgZXhwbGljaXRseSBkZWZpbmVkLlxuICAgICAgICAgKiBUYWtlICdzZXR0aW5ncy51cmkudXNlcicgdmFsdWUgaWYgbm90LlxuICAgICAgICAgKi9cbiAgICAgICAgaWYgKCFzZXR0aW5ncy5hdXRob3JpemF0aW9uVXNlcikge1xuICAgICAgICAgICAgc2V0dGluZ3MuYXV0aG9yaXphdGlvblVzZXIgPSBzZXR0aW5ncy51cmkudXNlcjtcbiAgICAgICAgfVxuICAgICAgICAvKiBJZiBubyAncmVnaXN0cmFyU2VydmVyJyBpcyBzZXQgdXNlIHRoZSAndXJpJyB2YWx1ZSB3aXRob3V0IHVzZXIgcG9ydGlvbi4gKi9cbiAgICAgICAgaWYgKCFzZXR0aW5ncy5yZWdpc3RyYXJTZXJ2ZXIpIHtcbiAgICAgICAgICAgIHJlZ2lzdHJhclNlcnZlciA9IHNldHRpbmdzLnVyaS5jbG9uZSgpO1xuICAgICAgICAgICAgcmVnaXN0cmFyU2VydmVyLnVzZXIgPSBudWxsO1xuICAgICAgICAgICAgc2V0dGluZ3MucmVnaXN0cmFyU2VydmVyID0gcmVnaXN0cmFyU2VydmVyO1xuICAgICAgICB9XG4gICAgICAgIC8vIFVzZXIgbm9BbnN3ZXJUaW1lb3V0XG4gICAgICAgIHNldHRpbmdzLm5vQW5zd2VyVGltZW91dCA9IHNldHRpbmdzLm5vQW5zd2VyVGltZW91dCAqIDEwMDA7XG4gICAgICAgIC8vIFZpYSBIb3N0XG4gICAgICAgIGlmIChzZXR0aW5ncy5oYWNrSXBJbkNvbnRhY3QpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygc2V0dGluZ3MuaGFja0lwSW5Db250YWN0ID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBzZXR0aW5ncy52aWFIb3N0ID0gU0lQLlV0aWxzLmdldFJhbmRvbVRlc3ROZXRJUCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHNldHRpbmdzLmhhY2tJcEluQ29udGFjdCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICBzZXR0aW5ncy52aWFIb3N0ID0gc2V0dGluZ3MuaGFja0lwSW5Db250YWN0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIENvbnRhY3QgdHJhbnNwb3J0IHBhcmFtZXRlclxuICAgICAgICBpZiAoc2V0dGluZ3MuaGFja1dzc0luVHJhbnNwb3J0KSB7XG4gICAgICAgICAgICBzZXR0aW5ncy5jb250YWN0VHJhbnNwb3J0ID0gJ3dzcyc7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jb250YWN0ID0ge1xuICAgICAgICAgICAgcHViX2dydXU6IG51bGwsXG4gICAgICAgICAgICB0ZW1wX2dydXU6IG51bGwsXG4gICAgICAgICAgICB1cmk6IG5ldyBTSVAuVVJJKCdzaXAnLCBzZXR0aW5ncy5jb250YWN0TmFtZSwgc2V0dGluZ3MudmlhSG9zdCwgbnVsbCwgeyB0cmFuc3BvcnQ6IHNldHRpbmdzLmNvbnRhY3RUcmFuc3BvcnQgfSksXG4gICAgICAgICAgICB0b1N0cmluZzogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAgICAgICAgICAgICB2YXIgYW5vbnltb3VzID0gb3B0aW9ucy5hbm9ueW1vdXMgfHwgbnVsbCwgb3V0Ym91bmQgPSBvcHRpb25zLm91dGJvdW5kIHx8IG51bGwsIGNvbnRhY3QgPSAnPCc7XG4gICAgICAgICAgICAgICAgaWYgKGFub255bW91cykge1xuICAgICAgICAgICAgICAgICAgICBjb250YWN0ICs9ICh0aGlzLnRlbXBfZ3J1dSB8fCAoJ3NpcDphbm9ueW1vdXNAYW5vbnltb3VzLmludmFsaWQ7dHJhbnNwb3J0PScgKyBzZXR0aW5ncy5jb250YWN0VHJhbnNwb3J0KSkudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRhY3QgKz0gKHRoaXMucHViX2dydXUgfHwgdGhpcy51cmkpLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChvdXRib3VuZCkge1xuICAgICAgICAgICAgICAgICAgICBjb250YWN0ICs9ICc7b2InO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb250YWN0ICs9ICc+JztcbiAgICAgICAgICAgICAgICByZXR1cm4gY29udGFjdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdmFyIHNrZWxldG9uID0ge307XG4gICAgICAgIC8vIEZpbGwgdGhlIHZhbHVlIG9mIHRoZSBjb25maWd1cmF0aW9uX3NrZWxldG9uXG4gICAgICAgIGZvciAocGFyYW1ldGVyIGluIHNldHRpbmdzKSB7XG4gICAgICAgICAgICBza2VsZXRvbltwYXJhbWV0ZXJdID0gc2V0dGluZ3NbcGFyYW1ldGVyXTtcbiAgICAgICAgfVxuICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMuY29uZmlndXJhdGlvbiwgc2tlbGV0b24pO1xuICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ2NvbmZpZ3VyYXRpb24gcGFyYW1ldGVycyBhZnRlciB2YWxpZGF0aW9uOicpO1xuICAgICAgICBmb3IgKHBhcmFtZXRlciBpbiBzZXR0aW5ncykge1xuICAgICAgICAgICAgc3dpdGNoIChwYXJhbWV0ZXIpIHtcbiAgICAgICAgICAgICAgICBjYXNlICd1cmknOlxuICAgICAgICAgICAgICAgIGNhc2UgJ3JlZ2lzdHJhclNlcnZlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlckZhY3RvcnknOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ8K3ICcgKyBwYXJhbWV0ZXIgKyAnOiAnICsgc2V0dGluZ3NbcGFyYW1ldGVyXSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ3Bhc3N3b3JkJzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKCfCtyAnICsgcGFyYW1ldGVyICsgJzogJyArICdOT1QgU0hPV04nKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAndHJhbnNwb3J0Q29uc3RydWN0b3InOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ8K3ICcgKyBwYXJhbWV0ZXIgKyAnOiAnICsgc2V0dGluZ3NbcGFyYW1ldGVyXS5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKCfCtyAnICsgcGFyYW1ldGVyICsgJzogJyArIEpTT04uc3RyaW5naWZ5KHNldHRpbmdzW3BhcmFtZXRlcl0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBDb25maWd1cmF0aW9uIGNoZWNrZXIuXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcmV0dXJuIHtCb29sZWFufVxuICAgICAqL1xuICAgIFVBLnByb3RvdHlwZS5nZXRDb25maWd1cmF0aW9uQ2hlY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBtYW5kYXRvcnk6IHt9LFxuICAgICAgICAgICAgb3B0aW9uYWw6IHtcbiAgICAgICAgICAgICAgICB1cmk6IGZ1bmN0aW9uICh1cmkpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcnNlZDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEoL15zaXA6L2kpLnRlc3QodXJpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXJpID0gU0lQLkMuU0lQICsgJzonICsgdXJpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHBhcnNlZCA9IFNJUC5VUkkucGFyc2UodXJpKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFwYXJzZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICghcGFyc2VkLnVzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZWQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRyYW5zcG9ydENvbnN0cnVjdG9yOiBmdW5jdGlvbiAodHJhbnNwb3J0Q29uc3RydWN0b3IpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRyYW5zcG9ydENvbnN0cnVjdG9yIGluc3RhbmNlb2YgRnVuY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cmFuc3BvcnRDb25zdHJ1Y3RvcjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdHJhbnNwb3J0T3B0aW9uczogZnVuY3Rpb24gKHRyYW5zcG9ydE9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB0cmFuc3BvcnRPcHRpb25zID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRyYW5zcG9ydE9wdGlvbnM7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGF1dGhvcml6YXRpb25Vc2VyOiBmdW5jdGlvbiAoYXV0aG9yaXphdGlvblVzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKFNJUC5HcmFtbWFyLnBhcnNlKCdcIicgKyBhdXRob3JpemF0aW9uVXNlciArICdcIicsICdxdW90ZWRfc3RyaW5nJykgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXV0aG9yaXphdGlvblVzZXI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiBmdW5jdGlvbiAoZGlzcGxheU5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKFNJUC5HcmFtbWFyLnBhcnNlKCdcIicgKyBkaXNwbGF5TmFtZSArICdcIicsICdkaXNwbGF5TmFtZScpID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRpc3BsYXlOYW1lO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkdG1mVHlwZTogZnVuY3Rpb24gKGR0bWZUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoZHRtZlR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgU0lQLkMuZHRtZlR5cGUuUlRQOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBTSVAuQy5kdG1mVHlwZS5SVFA7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFNJUC5DLmR0bWZUeXBlLklORk86XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBGYWxsIHRocm91Z2hcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNJUC5DLmR0bWZUeXBlLklORk87XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGhhY2tWaWFUY3A6IGZ1bmN0aW9uIChoYWNrVmlhVGNwKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgaGFja1ZpYVRjcCA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaGFja1ZpYVRjcDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaGFja0lwSW5Db250YWN0OiBmdW5jdGlvbiAoaGFja0lwSW5Db250YWN0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgaGFja0lwSW5Db250YWN0ID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBoYWNrSXBJbkNvbnRhY3Q7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIGhhY2tJcEluQ29udGFjdCA9PT0gJ3N0cmluZycgJiYgU0lQLkdyYW1tYXIucGFyc2UoaGFja0lwSW5Db250YWN0LCAnaG9zdCcpICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhhY2tJcEluQ29udGFjdDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaGFja1dzc0luVHJhbnNwb3J0OiBmdW5jdGlvbiAoaGFja1dzc0luVHJhbnNwb3J0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgaGFja1dzc0luVHJhbnNwb3J0ID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBoYWNrV3NzSW5UcmFuc3BvcnQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGhhY2tBbGxvd1VucmVnaXN0ZXJlZE9wdGlvblRhZ3M6IGZ1bmN0aW9uIChoYWNrQWxsb3dVbnJlZ2lzdGVyZWRPcHRpb25UYWdzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgaGFja0FsbG93VW5yZWdpc3RlcmVkT3B0aW9uVGFncyA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaGFja0FsbG93VW5yZWdpc3RlcmVkT3B0aW9uVGFncztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY29udGFjdFRyYW5zcG9ydDogZnVuY3Rpb24gKGNvbnRhY3RUcmFuc3BvcnQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjb250YWN0VHJhbnNwb3J0ID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRhY3RUcmFuc3BvcnQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGZvcmNlUnBvcnQ6IGZ1bmN0aW9uIChmb3JjZVJwb3J0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZm9yY2VScG9ydCA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm9yY2VScG9ydDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaW5zdGFuY2VJZDogZnVuY3Rpb24gKGluc3RhbmNlSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBpbnN0YW5jZUlkICE9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICgoL151dWlkOi9pLnRlc3QoaW5zdGFuY2VJZCkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZUlkID0gaW5zdGFuY2VJZC5zdWJzdHIoNSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKFNJUC5HcmFtbWFyLnBhcnNlKGluc3RhbmNlSWQsICd1dWlkJykgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW5zdGFuY2VJZDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgbm9BbnN3ZXJUaW1lb3V0OiBmdW5jdGlvbiAobm9BbnN3ZXJUaW1lb3V0KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKFNJUC5VdGlscy5pc0RlY2ltYWwobm9BbnN3ZXJUaW1lb3V0KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBOdW1iZXIobm9BbnN3ZXJUaW1lb3V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBmdW5jdGlvbiAocGFzc3dvcmQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFN0cmluZyhwYXNzd29yZCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICByZWwxMDA6IGZ1bmN0aW9uIChyZWwxMDApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlbDEwMCA9PT0gU0lQLkMuc3VwcG9ydGVkLlJFUVVJUkVEKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gU0lQLkMuc3VwcG9ydGVkLlJFUVVJUkVEO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlbDEwMCA9PT0gU0lQLkMuc3VwcG9ydGVkLlNVUFBPUlRFRCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNJUC5DLnN1cHBvcnRlZC5TVVBQT1JURUQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gU0lQLkMuc3VwcG9ydGVkLlVOU1VQUE9SVEVEO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICByZXBsYWNlczogZnVuY3Rpb24gKHJlcGxhY2VzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXBsYWNlcyA9PT0gU0lQLkMuc3VwcG9ydGVkLlJFUVVJUkVEKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gU0lQLkMuc3VwcG9ydGVkLlJFUVVJUkVEO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlcGxhY2VzID09PSBTSVAuQy5zdXBwb3J0ZWQuU1VQUE9SVEVEKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gU0lQLkMuc3VwcG9ydGVkLlNVUFBPUlRFRDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBTSVAuQy5zdXBwb3J0ZWQuVU5TVVBQT1JURUQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHJlZ2lzdGVyOiBmdW5jdGlvbiAocmVnaXN0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiByZWdpc3RlciA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVnaXN0ZXI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHJlZ2lzdGVyRXhwaXJlczogZnVuY3Rpb24gKHJlZ2lzdGVyRXhwaXJlcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGlmIChTSVAuVXRpbHMuaXNEZWNpbWFsKHJlZ2lzdGVyRXhwaXJlcykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gTnVtYmVyKHJlZ2lzdGVyRXhwaXJlcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICByZWdpc3RyYXJTZXJ2ZXI6IGZ1bmN0aW9uIChyZWdpc3RyYXJTZXJ2ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcnNlZDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiByZWdpc3RyYXJTZXJ2ZXIgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKCEvXnNpcDovaS50ZXN0KHJlZ2lzdHJhclNlcnZlcikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lzdHJhclNlcnZlciA9IFNJUC5DLlNJUCArICc6JyArIHJlZ2lzdHJhclNlcnZlcjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBwYXJzZWQgPSBTSVAuVVJJLnBhcnNlKHJlZ2lzdHJhclNlcnZlcik7XG4gICAgICAgICAgICAgICAgICAgIGlmICghcGFyc2VkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocGFyc2VkLnVzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZWQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHVzZXJBZ2VudFN0cmluZzogZnVuY3Rpb24gKHVzZXJBZ2VudFN0cmluZykge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHVzZXJBZ2VudFN0cmluZyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1c2VyQWdlbnRTdHJpbmc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGF1dG9zdGFydDogZnVuY3Rpb24gKGF1dG9zdGFydCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGF1dG9zdGFydCA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXV0b3N0YXJ0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBhdXRvc3RvcDogZnVuY3Rpb24gKGF1dG9zdG9wKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYXV0b3N0b3AgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGF1dG9zdG9wO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBzZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyRmFjdG9yeTogZnVuY3Rpb24gKHNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJGYWN0b3J5KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyRmFjdG9yeSBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlckZhY3Rvcnk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJGYWN0b3J5T3B0aW9uczogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnM7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGF1dGhlbnRpY2F0aW9uRmFjdG9yeTogY2hlY2tBdXRoZW50aWNhdGlvbkZhY3RvcnksXG4gICAgICAgICAgICAgICAgYWxsb3dMZWdhY3lOb3RpZmljYXRpb25zOiBmdW5jdGlvbiAoYWxsb3dMZWdhY3lOb3RpZmljYXRpb25zKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYWxsb3dMZWdhY3lOb3RpZmljYXRpb25zID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhbGxvd0xlZ2FjeU5vdGlmaWNhdGlvbnM7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGN1c3RvbTogZnVuY3Rpb24gKGN1c3RvbSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGN1c3RvbSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjdXN0b207XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNvbnRhY3ROYW1lOiBmdW5jdGlvbiAoY29udGFjdE5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjb250YWN0TmFtZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb250YWN0TmFtZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfTtcbiAgICBVQS5DID0gQztcbiAgICBTSVAuVUEgPSBVQTtcbn07XG5cbi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqL30uY2FsbCh0aGlzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKDI4KSkpXG5cbi8qKiovIH0pLFxuLyogMjggKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHtcblxudmFyIGc7XHJcblxyXG4vLyBUaGlzIHdvcmtzIGluIG5vbi1zdHJpY3QgbW9kZVxyXG5nID0gKGZ1bmN0aW9uKCkge1xyXG5cdHJldHVybiB0aGlzO1xyXG59KSgpO1xyXG5cclxudHJ5IHtcclxuXHQvLyBUaGlzIHdvcmtzIGlmIGV2YWwgaXMgYWxsb3dlZCAoc2VlIENTUClcclxuXHRnID0gZyB8fCBGdW5jdGlvbihcInJldHVybiB0aGlzXCIpKCkgfHwgKDEsIGV2YWwpKFwidGhpc1wiKTtcclxufSBjYXRjaCAoZSkge1xyXG5cdC8vIFRoaXMgd29ya3MgaWYgdGhlIHdpbmRvdyByZWZlcmVuY2UgaXMgYXZhaWxhYmxlXHJcblx0aWYgKHR5cGVvZiB3aW5kb3cgPT09IFwib2JqZWN0XCIpIGcgPSB3aW5kb3c7XHJcbn1cclxuXHJcbi8vIGcgY2FuIHN0aWxsIGJlIHVuZGVmaW5lZCwgYnV0IG5vdGhpbmcgdG8gZG8gYWJvdXQgaXQuLi5cclxuLy8gV2UgcmV0dXJuIHVuZGVmaW5lZCwgaW5zdGVhZCBvZiBub3RoaW5nIGhlcmUsIHNvIGl0J3NcclxuLy8gZWFzaWVyIHRvIGhhbmRsZSB0aGlzIGNhc2UuIGlmKCFnbG9iYWwpIHsgLi4ufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBnO1xyXG5cblxuLyoqKi8gfSksXG4vKiAyOSAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cInVzZSBzdHJpY3RcIjtcbi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihnbG9iYWwpIHtcbi8qKlxuICogQGZpbGVvdmVydmlldyBUcmFuc3BvcnRcbiAqL1xuLyoqXG4gKiBAYXVnbWVudHMgU0lQXG4gKiBAY2xhc3MgVHJhbnNwb3J0XG4gKiBAcGFyYW0ge09iamVjdH0gb3B0aW9uc1xuICovXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChTSVApIHtcbiAgICB2YXIgVHJhbnNwb3J0LCBDID0ge1xuICAgICAgICAvLyBUcmFuc3BvcnQgc3RhdHVzIGNvZGVzXG4gICAgICAgIFNUQVRVU19DT05ORUNUSU5HOiAwLFxuICAgICAgICBTVEFUVVNfT1BFTjogMSxcbiAgICAgICAgU1RBVFVTX0NMT1NJTkc6IDIsXG4gICAgICAgIFNUQVRVU19DTE9TRUQ6IDMsXG4gICAgfTtcbiAgICB2YXIgV2ViU29ja2V0ID0gKGdsb2JhbC53aW5kb3cgfHwgZ2xvYmFsKS5XZWJTb2NrZXQ7XG4gICAgLyoqXG4gICAgICogQ29tcHV0ZSBhbiBhbW91bnQgb2YgdGltZSBpbiBzZWNvbmRzIHRvIHdhaXQgYmVmb3JlIHNlbmRpbmcgYW5vdGhlclxuICAgICAqIGtlZXAtYWxpdmUuXG4gICAgICogQHJldHVybnMge051bWJlcn1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjb21wdXRlS2VlcEFsaXZlVGltZW91dCh1cHBlckJvdW5kKSB7XG4gICAgICAgIHZhciBsb3dlckJvdW5kID0gdXBwZXJCb3VuZCAqIDAuODtcbiAgICAgICAgcmV0dXJuIDEwMDAgKiAoTWF0aC5yYW5kb20oKSAqICh1cHBlckJvdW5kIC0gbG93ZXJCb3VuZCkgKyBsb3dlckJvdW5kKTtcbiAgICB9XG4gICAgVHJhbnNwb3J0ID0gZnVuY3Rpb24gKGxvZ2dlciwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gU0lQLlV0aWxzLmRlZmF1bHRPcHRpb25zKHt9LCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5sb2dnZXIgPSBsb2dnZXI7XG4gICAgICAgIHRoaXMud3MgPSBudWxsO1xuICAgICAgICB0aGlzLnNlcnZlciA9IG51bGw7XG4gICAgICAgIHRoaXMuY29ubmVjdGlvblByb21pc2UgPSBudWxsO1xuICAgICAgICB0aGlzLmNvbm5lY3REZWZlcnJlZFJlc29sdmUgPSBudWxsO1xuICAgICAgICB0aGlzLmNvbm5lY3Rpb25UaW1lb3V0ID0gbnVsbDtcbiAgICAgICAgdGhpcy5kaXNjb25uZWN0aW9uUHJvbWlzZSA9IG51bGw7XG4gICAgICAgIHRoaXMuZGlzY29ubmVjdERlZmVycmVkUmVzb2x2ZSA9IG51bGw7XG4gICAgICAgIHRoaXMuYm91bmRPbk9wZW4gPSBudWxsO1xuICAgICAgICB0aGlzLmJvdW5kT25NZXNzYWdlID0gbnVsbDtcbiAgICAgICAgdGhpcy5ib3VuZE9uQ2xvc2UgPSBudWxsO1xuICAgICAgICB0aGlzLmJvdW5kT25FcnJvciA9IG51bGw7XG4gICAgICAgIHRoaXMucmVjb25uZWN0aW9uQXR0ZW1wdHMgPSAwO1xuICAgICAgICB0aGlzLnJlY29ubmVjdFRpbWVyID0gbnVsbDtcbiAgICAgICAgLy8gS2VlcCBhbGl2ZVxuICAgICAgICB0aGlzLmtlZXBBbGl2ZUludGVydmFsID0gbnVsbDtcbiAgICAgICAgdGhpcy5rZWVwQWxpdmVEZWJvdW5jZVRpbWVvdXQgPSBudWxsO1xuICAgICAgICB0aGlzLnN0YXR1cyA9IEMuU1RBVFVTX0NPTk5FQ1RJTkc7XG4gICAgICAgIHRoaXMuY29uZmlndXJhdGlvbiA9IHt9O1xuICAgICAgICB0aGlzLmxvYWRDb25maWcob3B0aW9ucyk7XG4gICAgfTtcbiAgICBUcmFuc3BvcnQucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShTSVAuVHJhbnNwb3J0LnByb3RvdHlwZSwge1xuICAgICAgICAvKipcbiAgICAgICAgKlxuICAgICAgICAqIEByZXR1cm5zIHtCb29sZWFufVxuICAgICAgICAqL1xuICAgICAgICBpc0Nvbm5lY3RlZDogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uIGlzQ29ubmVjdGVkKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXR1cyA9PT0gQy5TVEFUVVNfT1BFTjtcbiAgICAgICAgICAgIH0gfSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNlbmQgYSBtZXNzYWdlLlxuICAgICAgICAgKiBAcGFyYW0ge1NJUC5PdXRnb2luZ1JlcXVlc3R8U3RyaW5nfSBtc2dcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxuICAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAgICAgICAgICovXG4gICAgICAgIHNlbmRQcm9taXNlOiB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogZnVuY3Rpb24gc2VuZFByb21pc2UobXNnLCBvcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnN0YXR1c0Fzc2VydChDLlNUQVRVU19PUEVOLCBvcHRpb25zLmZvcmNlKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uRXJyb3IoJ3VuYWJsZSB0byBzZW5kIG1lc3NhZ2UgLSBXZWJTb2NrZXQgbm90IG9wZW4nKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNJUC5VdGlscy5Qcm9taXNlLnJlamVjdCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IG1zZy50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLndzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbmZpZ3VyYXRpb24udHJhY2VTaXAgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZygnc2VuZGluZyBXZWJTb2NrZXQgbWVzc2FnZTpcXG5cXG4nICsgbWVzc2FnZSArICdcXG4nKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLndzLnNlbmQobWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBTSVAuVXRpbHMuUHJvbWlzZS5yZXNvbHZlKHsgbXNnOiBtZXNzYWdlIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkVycm9yKCd1bmFibGUgdG8gc2VuZCBtZXNzYWdlIC0gV2ViU29ja2V0IGRvZXMgbm90IGV4aXN0Jyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBTSVAuVXRpbHMuUHJvbWlzZS5yZWplY3QoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0sXG4gICAgICAgIC8qKlxuICAgICAgICAqIERpc2Nvbm5lY3Qgc29ja2V0LlxuICAgICAgICAqL1xuICAgICAgICBkaXNjb25uZWN0UHJvbWlzZTogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uIGRpc2Nvbm5lY3RQcm9taXNlKG9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXNjb25uZWN0aW9uUHJvbWlzZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kaXNjb25uZWN0aW9uUHJvbWlzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnN0YXR1c1RyYW5zaXRpb24oQy5TVEFUVVNfQ0xPU0lORywgb3B0aW9ucy5mb3JjZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNJUC5VdGlscy5Qcm9taXNlLnJlamVjdCgnRmFpbGVkIHN0YXR1cyB0cmFuc2l0aW9uIC0gYXR0ZW1wdGVkIHRvIGRpc2Nvbm5lY3QgYSBzb2NrZXQgdGhhdCB3YXMgbm90IG9wZW4nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5kaXNjb25uZWN0aW9uUHJvbWlzZSA9IG5ldyBTSVAuVXRpbHMuUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzY29ubmVjdERlZmVycmVkUmVzb2x2ZSA9IHJlc29sdmU7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlY29ubmVjdFRpbWVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBTSVAuVGltZXJzLmNsZWFyVGltZW91dCh0aGlzLnJlY29ubmVjdFRpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVjb25uZWN0VGltZXIgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLndzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0b3BTZW5kaW5nS2VlcEFsaXZlcygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKCdjbG9zaW5nIFdlYlNvY2tldCAnICsgdGhpcy5zZXJ2ZXIud3NfdXJpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMud3MuY2xvc2Uob3B0aW9ucy5jb2RlLCBvcHRpb25zLnJlYXNvbik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoJ0F0dGVtcHRlZCB0byBkaXNjb25uZWN0IGJ1dCB0aGUgd2Vic29ja2V0IGRvZXNuXFwndCBleGlzdCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kaXNjb25uZWN0aW9uUHJvbWlzZTtcbiAgICAgICAgICAgIH0gfSxcbiAgICAgICAgLyoqXG4gICAgICAgICogQ29ubmVjdCBzb2NrZXQuXG4gICAgICAgICovXG4gICAgICAgIGNvbm5lY3RQcm9taXNlOiB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogZnVuY3Rpb24gY29ubmVjdFByb21pc2Uob3B0aW9ucykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbm5lY3Rpb25Qcm9taXNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbm5lY3Rpb25Qcm9taXNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAgICAgICAgICAgICB0aGlzLnNlcnZlciA9IHRoaXMuc2VydmVyIHx8IHRoaXMuZ2V0TmV4dFdzU2VydmVyKG9wdGlvbnMuZm9yY2UpO1xuICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvblByb21pc2UgPSBuZXcgU0lQLlV0aWxzLlByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoKHRoaXMuc3RhdHVzID09PSBDLlNUQVRVU19PUEVOIHx8IHRoaXMuc3RhdHVzID09PSBDLlNUQVRVU19DTE9TSU5HKSAmJiAhb3B0aW9ucy5mb3JjZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIud2FybignV2ViU29ja2V0ICcgKyB0aGlzLnNlcnZlci53c191cmkgKyAnIGlzIGFscmVhZHkgY29ubmVjdGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoJ0ZhaWxlZCBzdGF0dXMgY2hlY2sgLSBhdHRlbXB0ZWQgdG8gb3BlbiBhIGNvbm5lY3Rpb24gYnV0IGFscmVhZHkgb3Blbi9jbG9zaW5nJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0RGVmZXJyZWRSZXNvbHZlID0gcmVzb2x2ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSBDLlNUQVRVU19DT05ORUNUSU5HO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ2Nvbm5lY3RpbmcgdG8gV2ViU29ja2V0ICcgKyB0aGlzLnNlcnZlci53c191cmkpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc3Bvc2VXcygpO1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy53cyA9IG5ldyBXZWJTb2NrZXQodGhpcy5zZXJ2ZXIud3NfdXJpLCAnc2lwJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMud3MgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSBDLlNUQVRVU19DTE9TRUQ7IC8vIGZvcmNlIHN0YXR1cyB0byBjbG9zZWQgaW4gZXJyb3IgY2FzZVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkVycm9yKCdlcnJvciBjb25uZWN0aW5nIHRvIFdlYlNvY2tldCAnICsgdGhpcy5zZXJ2ZXIud3NfdXJpICsgJzonICsgZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoJ0ZhaWxlZCB0byBjcmVhdGUgYSB3ZWJzb2NrZXQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMud3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCgnVW5leHBlY3RlZCBpbnN0YW5jZSB3ZWJzb2NrZXQgbm90IHNldCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvblRpbWVvdXQgPSBTSVAuVGltZXJzLnNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkVycm9yKCd0b29rIHRvbyBsb25nIHRvIGNvbm5lY3QgLSBleGNlZWRlZCB0aW1lIHNldCBpbiBjb25maWd1cmF0aW9uLmNvbm5lY3Rpb25UaW1lb3V0OiAnICsgdGhpcy5jb25maWd1cmF0aW9uLmNvbm5lY3Rpb25UaW1lb3V0ICsgJ3MnKTtcbiAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpLCB0aGlzLmNvbmZpZ3VyYXRpb24uY29ubmVjdGlvblRpbWVvdXQgKiAxMDAwKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ib3VuZE9uT3BlbiA9IHRoaXMub25PcGVuLmJpbmQodGhpcyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYm91bmRPbk1lc3NhZ2UgPSB0aGlzLm9uTWVzc2FnZS5iaW5kKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJvdW5kT25DbG9zZSA9IHRoaXMub25DbG9zZS5iaW5kKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJvdW5kT25FcnJvciA9IHRoaXMub25FcnJvci5iaW5kKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLndzLmFkZEV2ZW50TGlzdGVuZXIoJ29wZW4nLCB0aGlzLmJvdW5kT25PcGVuKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy53cy5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgdGhpcy5ib3VuZE9uTWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMud3MuYWRkRXZlbnRMaXN0ZW5lcignY2xvc2UnLCB0aGlzLmJvdW5kT25DbG9zZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMud3MuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCB0aGlzLmJvdW5kT25FcnJvcik7XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb25uZWN0aW9uUHJvbWlzZTtcbiAgICAgICAgICAgIH0gfSxcbiAgICAgICAgLy8gVHJhbnNwb3J0IEV2ZW50IEhhbmRsZXJzXG4gICAgICAgIC8qKlxuICAgICAgICAqIEBldmVudFxuICAgICAgICAqIEBwYXJhbSB7ZXZlbnR9IGVcbiAgICAgICAgKi9cbiAgICAgICAgb25PcGVuOiB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogZnVuY3Rpb24gb25PcGVuKCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gQy5TVEFUVVNfT1BFTjsgLy8gcXVpZXRseSBmb3JjZSBzdGF0dXMgdG8gb3BlblxuICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgnY29ubmVjdGVkJyk7XG4gICAgICAgICAgICAgICAgU0lQLlRpbWVycy5jbGVhclRpbWVvdXQodGhpcy5jb25uZWN0aW9uVGltZW91dCk7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKCdXZWJTb2NrZXQgJyArIHRoaXMuc2VydmVyLndzX3VyaSArICcgY29ubmVjdGVkJyk7XG4gICAgICAgICAgICAgICAgLy8gQ2xlYXIgcmVjb25uZWN0VGltZXIgc2luY2Ugd2UgYXJlIG5vdCBkaXNjb25uZWN0ZWRcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5yZWNvbm5lY3RUaW1lciAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBTSVAuVGltZXJzLmNsZWFyVGltZW91dCh0aGlzLnJlY29ubmVjdFRpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWNvbm5lY3RUaW1lciA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIFJlc2V0IHJlY29ubmVjdGlvbkF0dGVtcHRzXG4gICAgICAgICAgICAgICAgdGhpcy5yZWNvbm5lY3Rpb25BdHRlbXB0cyA9IDA7XG4gICAgICAgICAgICAgICAgLy8gUmVzZXQgZGlzY29ubmVjdGlvbiBwcm9taXNlIHNvIHdlIGNhbiBkaXNjb25uZWN0IGZyb20gYSBmcmVzaCBzdGF0ZVxuICAgICAgICAgICAgICAgIHRoaXMuZGlzY29ubmVjdGlvblByb21pc2UgPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzY29ubmVjdERlZmVycmVkUmVzb2x2ZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgLy8gU3RhcnQgc2VuZGluZyBrZWVwLWFsaXZlc1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRTZW5kaW5nS2VlcEFsaXZlcygpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbm5lY3REZWZlcnJlZFJlc29sdmUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0RGVmZXJyZWRSZXNvbHZlKHsgb3ZlcnJpZGVFdmVudDogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ1VuZXhwZWN0ZWQgd2Vic29ja2V0Lm9uT3BlbiB3aXRoIG5vIGNvbm5lY3REZWZlcnJlZFJlc29sdmUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0sXG4gICAgICAgIC8qKlxuICAgICAgICAqIEBldmVudFxuICAgICAgICAqIEBwYXJhbSB7ZXZlbnR9IGVcbiAgICAgICAgKi9cbiAgICAgICAgb25DbG9zZTogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uIG9uQ2xvc2UoZSkge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZygnV2ViU29ja2V0IGRpc2Nvbm5lY3RlZCAoY29kZTogJyArIGUuY29kZSArIChlLnJlYXNvbiA/ICd8IHJlYXNvbjogJyArIGUucmVhc29uIDogJycpICsgJyknKTtcbiAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ2Rpc2Nvbm5lY3RlZCcsIHsgY29kZTogZS5jb2RlLCByZWFzb246IGUucmVhc29uIH0pO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cyAhPT0gQy5TVEFUVVNfQ0xPU0lORykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuKCdXZWJTb2NrZXQgYWJydXB0IGRpc2Nvbm5lY3Rpb24nKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCd0cmFuc3BvcnRFcnJvcicpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnN0b3BTZW5kaW5nS2VlcEFsaXZlcygpO1xuICAgICAgICAgICAgICAgIC8vIENsZWFuIHVwIGNvbm5lY3Rpb24gdmFyaWFibGVzIHNvIHdlIGNhbiBjb25uZWN0IGFnYWluIGZyb20gYSBmcmVzaCBzdGF0ZVxuICAgICAgICAgICAgICAgIFNJUC5UaW1lcnMuY2xlYXJUaW1lb3V0KHRoaXMuY29ubmVjdGlvblRpbWVvdXQpO1xuICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvblRpbWVvdXQgPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvblByb21pc2UgPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdERlZmVycmVkUmVzb2x2ZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgLy8gQ2hlY2sgd2hldGhlciB0aGUgdXNlciByZXF1ZXN0ZWQgdG8gY2xvc2UuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlzY29ubmVjdERlZmVycmVkUmVzb2x2ZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc2Nvbm5lY3REZWZlcnJlZFJlc29sdmUoeyBvdmVycmlkZUV2ZW50OiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXR1c1RyYW5zaXRpb24oQy5TVEFUVVNfQ0xPU0VEKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXNjb25uZWN0RGVmZXJyZWRSZXNvbHZlID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnN0YXR1cyA9IEMuU1RBVFVTX0NMT1NFRDsgLy8gcXVpZXRseSBmb3JjZSBzdGF0dXMgdG8gY2xvc2VkXG4gICAgICAgICAgICAgICAgdGhpcy5yZWNvbm5lY3QoKTtcbiAgICAgICAgICAgIH0gfSxcbiAgICAgICAgLyoqXG4gICAgICAgICogUmVtb3ZlcyBldmVudCBsaXN0ZW5lcnMgYW5kIGNsZWFycyB0aGUgaW5zdGFuY2Ugd3NcbiAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAqIEBwYXJhbSB7ZXZlbnR9IGVcbiAgICAgICAgKi9cbiAgICAgICAgZGlzcG9zZVdzOiB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogZnVuY3Rpb24gZGlzcG9zZVdzKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLndzKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMud3MucmVtb3ZlRXZlbnRMaXN0ZW5lcignb3BlbicsIHRoaXMuYm91bmRPbk9wZW4pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLndzLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCB0aGlzLmJvdW5kT25NZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy53cy5yZW1vdmVFdmVudExpc3RlbmVyKCdjbG9zZScsIHRoaXMuYm91bmRPbkNsb3NlKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy53cy5yZW1vdmVFdmVudExpc3RlbmVyKCdlcnJvcicsIHRoaXMuYm91bmRPbkVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ib3VuZE9uT3BlbiA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYm91bmRPbk1lc3NhZ2UgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJvdW5kT25DbG9zZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYm91bmRPbkVycm9yID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy53cyA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9LFxuICAgICAgICAvKipcbiAgICAgICAgKiBAZXZlbnRcbiAgICAgICAgKiBAcGFyYW0ge2V2ZW50fSBlXG4gICAgICAgICovXG4gICAgICAgIG9uTWVzc2FnZTogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uIG9uTWVzc2FnZShlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBlLmRhdGE7XG4gICAgICAgICAgICAgICAgLy8gQ1JMRiBLZWVwIEFsaXZlIHJlc3BvbnNlIGZyb20gc2VydmVyLiBDbGVhciBvdXIga2VlcCBhbGl2ZSB0aW1lb3V0LlxuICAgICAgICAgICAgICAgIGlmICgvXihcXHJcXG4pKyQvLnRlc3QoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGVhcktlZXBBbGl2ZVRpbWVvdXQoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY29uZmlndXJhdGlvbi50cmFjZVNpcCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKCdyZWNlaXZlZCBXZWJTb2NrZXQgbWVzc2FnZSB3aXRoIENSTEYgS2VlcCBBbGl2ZSByZXNwb25zZScpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoIWRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIud2FybigncmVjZWl2ZWQgZW1wdHkgbWVzc2FnZSwgbWVzc2FnZSBkaXNjYXJkZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBXZWJTb2NrZXQgYmluYXJ5IG1lc3NhZ2UuXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIGRhdGEgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBuZXcgVWludDhBcnJheShkYXRhKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIud2FybigncmVjZWl2ZWQgV2ViU29ja2V0IGJpbmFyeSBtZXNzYWdlIGZhaWxlZCB0byBiZSBjb252ZXJ0ZWQgaW50byBzdHJpbmcsIG1lc3NhZ2UgZGlzY2FyZGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY29uZmlndXJhdGlvbi50cmFjZVNpcCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKCdyZWNlaXZlZCBXZWJTb2NrZXQgYmluYXJ5IG1lc3NhZ2U6XFxuXFxuJyArIGRhdGEgKyAnXFxuJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gV2ViU29ja2V0IHRleHQgbWVzc2FnZS5cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY29uZmlndXJhdGlvbi50cmFjZVNpcCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKCdyZWNlaXZlZCBXZWJTb2NrZXQgdGV4dCBtZXNzYWdlOlxcblxcbicgKyBkYXRhICsgJ1xcbicpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgnbWVzc2FnZScsIGRhdGEpO1xuICAgICAgICAgICAgfSB9LFxuICAgICAgICAvKipcbiAgICAgICAgKiBAZXZlbnRcbiAgICAgICAgKiBAcGFyYW0ge2V2ZW50fSBlXG4gICAgICAgICovXG4gICAgICAgIG9uRXJyb3I6IHsgd3JpdGFibGU6IHRydWUsIHZhbHVlOiBmdW5jdGlvbiBvbkVycm9yKGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuKCdUcmFuc3BvcnQgZXJyb3I6ICcgKyBlKTtcbiAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ3RyYW5zcG9ydEVycm9yJyk7XG4gICAgICAgICAgICB9IH0sXG4gICAgICAgIC8qKlxuICAgICAgICAqIFJlY29ubmVjdGlvbiBhdHRlbXB0IGxvZ2ljLlxuICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICovXG4gICAgICAgIHJlY29ubmVjdDogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uIHJlY29ubmVjdCgpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5yZWNvbm5lY3Rpb25BdHRlbXB0cyA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKCdSZWNvbm5lY3Rpb24gYXR0ZW1wdCAnICsgdGhpcy5yZWNvbm5lY3Rpb25BdHRlbXB0cyArICcgZmFpbGVkJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm5vQXZhaWxhYmxlU2VydmVycygpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ25vIGF2YWlsYWJsZSB3cyBzZXJ2ZXJzIGxlZnQgLSBnb2luZyB0byBjbG9zZWQgc3RhdGUnKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSBDLlNUQVRVU19DTE9TRUQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgnY2xvc2VkJyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVzZXRTZXJ2ZXJFcnJvclN0YXR1cygpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzQ29ubmVjdGVkKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIud2FybignYXR0ZW1wdGVkIHRvIHJlY29ubmVjdCB3aGlsZSBjb25uZWN0ZWQgLSBmb3JjaW5nIGRpc2Nvbm5lY3QnKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXNjb25uZWN0KHsgZm9yY2U6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMucmVjb25uZWN0aW9uQXR0ZW1wdHMgKz0gMTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5yZWNvbm5lY3Rpb25BdHRlbXB0cyA+IHRoaXMuY29uZmlndXJhdGlvbi5tYXhSZWNvbm5lY3Rpb25BdHRlbXB0cykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuKCdtYXhpbXVtIHJlY29ubmVjdGlvbiBhdHRlbXB0cyBmb3IgV2ViU29ja2V0ICcgKyB0aGlzLnNlcnZlci53c191cmkpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ3RyYW5zcG9ydCAnICsgdGhpcy5zZXJ2ZXIud3NfdXJpICsgJyBmYWlsZWQgfCBjb25uZWN0aW9uIHN0YXRlIHNldCB0byBcXCdlcnJvclxcJycpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlcnZlci5pc0Vycm9yID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCd0cmFuc3BvcnRFcnJvcicpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlcnZlciA9IHRoaXMuZ2V0TmV4dFdzU2VydmVyKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVjb25uZWN0aW9uQXR0ZW1wdHMgPSAwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlY29ubmVjdCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKCd0cnlpbmcgdG8gcmVjb25uZWN0IHRvIFdlYlNvY2tldCAnICsgdGhpcy5zZXJ2ZXIud3NfdXJpICsgJyAocmVjb25uZWN0aW9uIGF0dGVtcHQgJyArIHRoaXMucmVjb25uZWN0aW9uQXR0ZW1wdHMgKyAnKScpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlY29ubmVjdFRpbWVyID0gU0lQLlRpbWVycy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWNvbm5lY3RUaW1lciA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSwgKHRoaXMucmVjb25uZWN0aW9uQXR0ZW1wdHMgPT09IDEpID8gMCA6IHRoaXMuY29uZmlndXJhdGlvbi5yZWNvbm5lY3Rpb25UaW1lb3V0ICogMTAwMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9LFxuICAgICAgICAvKipcbiAgICAgICAgKiBSZXNldHMgdGhlIGVycm9yIHN0YXRlIG9mIGFsbCBzZXJ2ZXJzIGluIHRoZSBjb25maWd1cmF0aW9uXG4gICAgICAgICovXG4gICAgICAgIHJlc2V0U2VydmVyRXJyb3JTdGF0dXM6IHsgd3JpdGFibGU6IHRydWUsIHZhbHVlOiBmdW5jdGlvbiByZXNldFNlcnZlckVycm9yU3RhdHVzKCkge1xuICAgICAgICAgICAgICAgIHZhciBpZHgsIGxlbmd0aCA9IHRoaXMuY29uZmlndXJhdGlvbi53c1NlcnZlcnMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIGZvciAoaWR4ID0gMDsgaWR4IDwgbGVuZ3RoOyBpZHgrKykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb24ud3NTZXJ2ZXJzW2lkeF0uaXNFcnJvciA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSxcbiAgICAgICAgLyoqXG4gICAgICAgICogUmV0cmlldmUgdGhlIG5leHQgc2VydmVyIHRvIHdoaWNoIGNvbm5lY3QuXG4gICAgICAgICogQHByaXZhdGVcbiAgICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGZvcmNlIGFsbG93cyBieXBhc3Mgb2Ygc2VydmVyIGVycm9yIHN0YXR1cyBjaGVja2luZ1xuICAgICAgICAqIEByZXR1cm5zIHtPYmplY3R9IHdzU2VydmVyXG4gICAgICAgICovXG4gICAgICAgIGdldE5leHRXc1NlcnZlcjogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uIGdldE5leHRXc1NlcnZlcihmb3JjZSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm5vQXZhaWxhYmxlU2VydmVycygpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ2F0dGVtcHRlZCB0byBnZXQgbmV4dCB3cyBzZXJ2ZXIgYnV0IHRoZXJlIGFyZSBubyBhdmFpbGFibGUgd3Mgc2VydmVycyBsZWZ0Jyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gT3JkZXIgc2VydmVycyBieSB3ZWlnaHRcbiAgICAgICAgICAgICAgICB2YXIgaWR4LCBsZW5ndGgsIHdzU2VydmVyLCBjYW5kaWRhdGVzID0gW107XG4gICAgICAgICAgICAgICAgbGVuZ3RoID0gdGhpcy5jb25maWd1cmF0aW9uLndzU2VydmVycy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgZm9yIChpZHggPSAwOyBpZHggPCBsZW5ndGg7IGlkeCsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHdzU2VydmVyID0gdGhpcy5jb25maWd1cmF0aW9uLndzU2VydmVyc1tpZHhdO1xuICAgICAgICAgICAgICAgICAgICBpZiAod3NTZXJ2ZXIuaXNFcnJvciAmJiAhZm9yY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNhbmRpZGF0ZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYW5kaWRhdGVzLnB1c2god3NTZXJ2ZXIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHdzU2VydmVyLndlaWdodCA+IGNhbmRpZGF0ZXNbMF0ud2VpZ2h0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYW5kaWRhdGVzID0gW3dzU2VydmVyXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh3c1NlcnZlci53ZWlnaHQgPT09IGNhbmRpZGF0ZXNbMF0ud2VpZ2h0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYW5kaWRhdGVzLnB1c2god3NTZXJ2ZXIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlkeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGNhbmRpZGF0ZXMubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FuZGlkYXRlc1tpZHhdO1xuICAgICAgICAgICAgfSB9LFxuICAgICAgICAvKipcbiAgICAgICAgKiBDaGVja3MgYWxsIGNvbmZpZ3VyYXRpb24gc2VydmVycywgcmV0dXJucyB0cnVlIGlmIGFsbCBvZiB0aGVtIGhhdmUgaXNFcnJvcjogdHJ1ZSBhbmQgZmFsc2Ugb3RoZXJ3aXNlXG4gICAgICAgICogQHByaXZhdGVcbiAgICAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbn1cbiAgICAgICAgKi9cbiAgICAgICAgbm9BdmFpbGFibGVTZXJ2ZXJzOiB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogZnVuY3Rpb24gbm9BdmFpbGFibGVTZXJ2ZXJzKCkge1xuICAgICAgICAgICAgICAgIHZhciBzZXJ2ZXI7XG4gICAgICAgICAgICAgICAgZm9yIChzZXJ2ZXIgaW4gdGhpcy5jb25maWd1cmF0aW9uLndzU2VydmVycykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuY29uZmlndXJhdGlvbi53c1NlcnZlcnNbc2VydmVyXS5pc0Vycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9IH0sXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIEtlZXBBbGl2ZSBTdHVmZlxuICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvKipcbiAgICAgICAgICogU2VuZCBhIGtlZXAtYWxpdmUgKGEgZG91YmxlLUNSTEYgc2VxdWVuY2UpLlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIHNlbmRLZWVwQWxpdmU6IHsgd3JpdGFibGU6IHRydWUsIHZhbHVlOiBmdW5jdGlvbiBzZW5kS2VlcEFsaXZlKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmtlZXBBbGl2ZURlYm91bmNlVGltZW91dCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBXZSBhbHJlYWR5IGhhdmUgYW4gb3V0c3RhbmRpbmcga2VlcCBhbGl2ZSwgZG8gbm90IHNlbmQgYW5vdGhlci5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmtlZXBBbGl2ZURlYm91bmNlVGltZW91dCA9IFNJUC5UaW1lcnMuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgna2VlcEFsaXZlRGVib3VuY2VUaW1lb3V0Jyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJLZWVwQWxpdmVUaW1lb3V0KCk7XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpLCB0aGlzLmNvbmZpZ3VyYXRpb24ua2VlcEFsaXZlRGVib3VuY2UgKiAxMDAwKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zZW5kKCdcXHJcXG5cXHJcXG4nKTtcbiAgICAgICAgICAgIH0gfSxcbiAgICAgICAgY2xlYXJLZWVwQWxpdmVUaW1lb3V0OiB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogZnVuY3Rpb24gY2xlYXJLZWVwQWxpdmVUaW1lb3V0KCkge1xuICAgICAgICAgICAgICAgIFNJUC5UaW1lcnMuY2xlYXJUaW1lb3V0KHRoaXMua2VlcEFsaXZlRGVib3VuY2VUaW1lb3V0KTtcbiAgICAgICAgICAgICAgICB0aGlzLmtlZXBBbGl2ZURlYm91bmNlVGltZW91dCA9IG51bGw7XG4gICAgICAgICAgICB9IH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTdGFydCBzZW5kaW5nIGtlZXAtYWxpdmVzLlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgc3RhcnRTZW5kaW5nS2VlcEFsaXZlczogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uIHN0YXJ0U2VuZGluZ0tlZXBBbGl2ZXMoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY29uZmlndXJhdGlvbi5rZWVwQWxpdmVJbnRlcnZhbCAmJiAhdGhpcy5rZWVwQWxpdmVJbnRlcnZhbCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmtlZXBBbGl2ZUludGVydmFsID0gU0lQLlRpbWVycy5zZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbmRLZWVwQWxpdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRTZW5kaW5nS2VlcEFsaXZlcygpO1xuICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcyksIGNvbXB1dGVLZWVwQWxpdmVUaW1lb3V0KHRoaXMuY29uZmlndXJhdGlvbi5rZWVwQWxpdmVJbnRlcnZhbCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFN0b3Agc2VuZGluZyBrZWVwLWFsaXZlcy5cbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIHN0b3BTZW5kaW5nS2VlcEFsaXZlczogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uIHN0b3BTZW5kaW5nS2VlcEFsaXZlcygpIHtcbiAgICAgICAgICAgICAgICBTSVAuVGltZXJzLmNsZWFySW50ZXJ2YWwodGhpcy5rZWVwQWxpdmVJbnRlcnZhbCk7XG4gICAgICAgICAgICAgICAgU0lQLlRpbWVycy5jbGVhclRpbWVvdXQodGhpcy5rZWVwQWxpdmVEZWJvdW5jZVRpbWVvdXQpO1xuICAgICAgICAgICAgICAgIHRoaXMua2VlcEFsaXZlSW50ZXJ2YWwgPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMua2VlcEFsaXZlRGVib3VuY2VUaW1lb3V0ID0gbnVsbDtcbiAgICAgICAgICAgIH0gfSxcbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgLy8gU3RhdHVzIFN0dWZmXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8qKlxuICAgICAgICAqIENoZWNrcyBnaXZlbiBzdGF0dXMgYWdhaW5zdCBpbnN0YW5jZSBjdXJyZW50IHN0YXR1cy4gUmV0dXJucyB0cnVlIGlmIHRoZXkgbWF0Y2hcbiAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBzdGF0dXNcbiAgICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtmb3JjZV1cbiAgICAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbn1cbiAgICAgICAgKi9cbiAgICAgICAgc3RhdHVzQXNzZXJ0OiB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogZnVuY3Rpb24gc3RhdHVzQXNzZXJ0KHN0YXR1cywgZm9yY2UpIHtcbiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSB0aGlzLnN0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmb3JjZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIud2FybignQXR0ZW1wdGVkIHRvIGFzc2VydCAnICsgT2JqZWN0LmtleXMoQylbdGhpcy5zdGF0dXNdICsgJyBhcyAnICsgT2JqZWN0LmtleXMoQylbc3RhdHVzXSArICctIGNvbnRpbnVpbmcgd2l0aCBvcHRpb246IFxcJ2ZvcmNlXFwnJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ1RyaWVkIHRvIGFzc2VydCAnICsgT2JqZWN0LmtleXMoQylbc3RhdHVzXSArICcgYnV0IGlzIGN1cnJlbnRseSAnICsgT2JqZWN0LmtleXMoQylbdGhpcy5zdGF0dXNdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSxcbiAgICAgICAgLyoqXG4gICAgICAgICogVHJhbnNpdGlvbnMgdGhlIHN0YXR1cy4gQ2hlY2tzIGZvciBsZWdhbCB0cmFuc2l0aW9uIHZpYSBhc3NlcnRpb24gYmVmb3JlaGFuZFxuICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IHN0YXR1c1xuICAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2ZvcmNlXVxuICAgICAgICAqIEByZXR1cm5zIHtCb29sZWFufVxuICAgICAgICAqL1xuICAgICAgICBzdGF0dXNUcmFuc2l0aW9uOiB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogZnVuY3Rpb24gc3RhdHVzVHJhbnNpdGlvbihzdGF0dXMsIGZvcmNlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKCdBdHRlbXB0aW5nIHRvIHRyYW5zaXRpb24gc3RhdHVzIGZyb20gJyArIE9iamVjdC5rZXlzKEMpW3RoaXMuc3RhdHVzXSArICcgdG8gJyArIE9iamVjdC5rZXlzKEMpW3N0YXR1c10pO1xuICAgICAgICAgICAgICAgIGlmICgoc3RhdHVzID09PSBDLlNUQVRVU19PUEVOICYmIHRoaXMuc3RhdHVzQXNzZXJ0KEMuU1RBVFVTX0NPTk5FQ1RJTkcsIGZvcmNlKSkgfHxcbiAgICAgICAgICAgICAgICAgICAgKHN0YXR1cyA9PT0gQy5TVEFUVVNfQ0xPU0lORyAmJiB0aGlzLnN0YXR1c0Fzc2VydChDLlNUQVRVU19PUEVOLCBmb3JjZSkpIHx8XG4gICAgICAgICAgICAgICAgICAgIChzdGF0dXMgPT09IEMuU1RBVFVTX0NMT1NFRCAmJiB0aGlzLnN0YXR1c0Fzc2VydChDLlNUQVRVU19DTE9TSU5HLCBmb3JjZSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ1N0YXR1cyB0cmFuc2l0aW9uIGZhaWxlZCAtIHJlc3VsdDogbm8tb3AgLSByZWFzb246IGVpdGhlciBnYXZlIGFuIG5vbmV4aXN0ZW50IHN0YXR1cyBvciBhdHRlbXB0ZWQgaWxsZWdhbCB0cmFuc2l0aW9uJyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0sXG4gICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIENvbmZpZ3VyYXRpb24gSGFuZGxpbmdcbiAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENvbmZpZ3VyYXRpb24gbG9hZC5cbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogcmV0dXJucyB7Qm9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIGxvYWRDb25maWc6IHsgd3JpdGFibGU6IHRydWUsIHZhbHVlOiBmdW5jdGlvbiBsb2FkQ29uZmlnKGNvbmZpZ3VyYXRpb24pIHtcbiAgICAgICAgICAgICAgICB2YXIgcGFyYW1ldGVyLCB2YWx1ZSwgY2hlY2tlZF92YWx1ZSwgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgICAgIHdzU2VydmVyczogW3tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2hlbWU6ICdXU1MnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpcF91cmk6ICc8c2lwOmVkZ2Uuc2lwLm9uc2lwLmNvbTt0cmFuc3BvcnQ9d3M7bHI+JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3ZWlnaHQ6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd3NfdXJpOiAnd3NzOi8vZWRnZS5zaXAub25zaXAuY29tJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0Vycm9yOiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgfV0sXG4gICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25UaW1lb3V0OiA1LFxuICAgICAgICAgICAgICAgICAgICBtYXhSZWNvbm5lY3Rpb25BdHRlbXB0czogMyxcbiAgICAgICAgICAgICAgICAgICAgcmVjb25uZWN0aW9uVGltZW91dDogNCxcbiAgICAgICAgICAgICAgICAgICAga2VlcEFsaXZlSW50ZXJ2YWw6IDAsXG4gICAgICAgICAgICAgICAgICAgIGtlZXBBbGl2ZURlYm91bmNlOiAxMCxcbiAgICAgICAgICAgICAgICAgICAgLy8gTG9nZ2luZ1xuICAgICAgICAgICAgICAgICAgICB0cmFjZVNpcDogZmFsc2UsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAvLyBQcmUtQ29uZmlndXJhdGlvblxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGFsaWFzVW5kZXJzY29yZWQocGFyYW1ldGVyLCBsb2dnZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHVuZGVyc2NvcmVkID0gcGFyYW1ldGVyLnJlcGxhY2UoLyhbYS16XVtBLVpdKS9nLCBmdW5jdGlvbiAobSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1bMF0gKyAnXycgKyBtWzFdLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAocGFyYW1ldGVyID09PSB1bmRlcnNjb3JlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhciBoYXNQYXJhbWV0ZXIgPSBjb25maWd1cmF0aW9uLmhhc093blByb3BlcnR5KHBhcmFtZXRlcik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb25maWd1cmF0aW9uLmhhc093blByb3BlcnR5KHVuZGVyc2NvcmVkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm4odW5kZXJzY29yZWQgKyAnIGlzIGRlcHJlY2F0ZWQsIHBsZWFzZSB1c2UgJyArIHBhcmFtZXRlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFzUGFyYW1ldGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm4ocGFyYW1ldGVyICsgJyBvdmVycmlkaW5nICcgKyB1bmRlcnNjb3JlZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbltwYXJhbWV0ZXJdID0gaGFzUGFyYW1ldGVyID8gY29uZmlndXJhdGlvbltwYXJhbWV0ZXJdIDogY29uZmlndXJhdGlvblt1bmRlcnNjb3JlZF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBjb25maWdDaGVjayA9IHRoaXMuZ2V0Q29uZmlndXJhdGlvbkNoZWNrKCk7XG4gICAgICAgICAgICAgICAgLy8gQ2hlY2sgTWFuZGF0b3J5IHBhcmFtZXRlcnNcbiAgICAgICAgICAgICAgICBmb3IgKHBhcmFtZXRlciBpbiBjb25maWdDaGVjay5tYW5kYXRvcnkpIHtcbiAgICAgICAgICAgICAgICAgICAgYWxpYXNVbmRlcnNjb3JlZChwYXJhbWV0ZXIsIHRoaXMubG9nZ2VyKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjb25maWd1cmF0aW9uLmhhc093blByb3BlcnR5KHBhcmFtZXRlcikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBTSVAuRXhjZXB0aW9ucy5Db25maWd1cmF0aW9uRXJyb3IocGFyYW1ldGVyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY29uZmlndXJhdGlvbltwYXJhbWV0ZXJdO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZF92YWx1ZSA9IGNvbmZpZ0NoZWNrLm1hbmRhdG9yeVtwYXJhbWV0ZXJdKHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaGVja2VkX3ZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5nc1twYXJhbWV0ZXJdID0gY2hlY2tlZF92YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBTSVAuRXhjZXB0aW9ucy5Db25maWd1cmF0aW9uRXJyb3IocGFyYW1ldGVyLCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gQ2hlY2sgT3B0aW9uYWwgcGFyYW1ldGVyc1xuICAgICAgICAgICAgICAgIGZvciAocGFyYW1ldGVyIGluIGNvbmZpZ0NoZWNrLm9wdGlvbmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIGFsaWFzVW5kZXJzY29yZWQocGFyYW1ldGVyLCB0aGlzLmxvZ2dlcik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb25maWd1cmF0aW9uLmhhc093blByb3BlcnR5KHBhcmFtZXRlcikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY29uZmlndXJhdGlvbltwYXJhbWV0ZXJdO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIHBhcmFtZXRlciB2YWx1ZSBpcyBhbiBlbXB0eSBhcnJheSwgYnV0IHNob3VsZG4ndCBiZSwgYXBwbHkgaXRzIGRlZmF1bHQgdmFsdWUuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBBcnJheSAmJiB2YWx1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBwYXJhbWV0ZXIgdmFsdWUgaXMgbnVsbCwgZW1wdHkgc3RyaW5nLCBvciB1bmRlZmluZWQgdGhlbiBhcHBseSBpdHMgZGVmYXVsdCB2YWx1ZS5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gJycgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgaXQncyBhIG51bWJlciB3aXRoIE5hTiB2YWx1ZSB0aGVuIGFsc28gYXBwbHkgaXRzIGRlZmF1bHQgdmFsdWUuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBOT1RFOiBKUyBkb2VzIG5vdCBhbGxvdyBcInZhbHVlID09PSBOYU5cIiwgdGhlIGZvbGxvd2luZyBkb2VzIHRoZSB3b3JrOlxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mICh2YWx1ZSkgPT09ICdudW1iZXInICYmIGlzTmFOKHZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZF92YWx1ZSA9IGNvbmZpZ0NoZWNrLm9wdGlvbmFsW3BhcmFtZXRlcl0odmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoZWNrZWRfdmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzW3BhcmFtZXRlcl0gPSBjaGVja2VkX3ZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNJUC5FeGNlcHRpb25zLkNvbmZpZ3VyYXRpb25FcnJvcihwYXJhbWV0ZXIsIHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgc2tlbGV0b24gPSB7fTtcbiAgICAgICAgICAgICAgICAvLyBGaWxsIHRoZSB2YWx1ZSBvZiB0aGUgY29uZmlndXJhdGlvbl9za2VsZXRvblxuICAgICAgICAgICAgICAgIGZvciAocGFyYW1ldGVyIGluIHNldHRpbmdzKSB7XG4gICAgICAgICAgICAgICAgICAgIHNrZWxldG9uW3BhcmFtZXRlcl0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogc2V0dGluZ3NbcGFyYW1ldGVyXSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcy5jb25maWd1cmF0aW9uLCBza2VsZXRvbik7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKCdjb25maWd1cmF0aW9uIHBhcmFtZXRlcnMgYWZ0ZXIgdmFsaWRhdGlvbjonKTtcbiAgICAgICAgICAgICAgICBmb3IgKHBhcmFtZXRlciBpbiBzZXR0aW5ncykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ8K3ICcgKyBwYXJhbWV0ZXIgKyAnOiAnICsgSlNPTi5zdHJpbmdpZnkoc2V0dGluZ3NbcGFyYW1ldGVyXSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9IH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDb25maWd1cmF0aW9uIGNoZWNrZXIuXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEByZXR1cm4ge0Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICBnZXRDb25maWd1cmF0aW9uQ2hlY2s6IHsgd3JpdGFibGU6IHRydWUsIHZhbHVlOiBmdW5jdGlvbiBnZXRDb25maWd1cmF0aW9uQ2hlY2soKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgbWFuZGF0b3J5OiB7fSxcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9uYWw6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vTm90ZTogdGhpcyBmdW5jdGlvbiB1c2VkIHRvIGNhbGwgJ3RoaXMubG9nZ2VyLmVycm9yJyBidXQgY2FsbGluZyAndGhpcycgd2l0aCBhbnl0aGluZyBoZXJlIGlzIGludmFsaWRcbiAgICAgICAgICAgICAgICAgICAgICAgIHdzU2VydmVyczogZnVuY3Rpb24gKHdzU2VydmVycykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpZHgsIGxlbmd0aCwgdXJsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIEFsbG93IGRlZmluaW5nIHdzU2VydmVycyBwYXJhbWV0ZXIgYXM6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICogIFN0cmluZzogXCJob3N0XCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAgQXJyYXkgb2YgU3RyaW5nczogW1wiaG9zdDFcIiwgXCJob3N0MlwiXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqICBBcnJheSBvZiBPYmplY3RzOiBbe3dzX3VyaTpcImhvc3QxXCIsIHdlaWdodDoxfSwge3dzX3VyaTpcImhvc3QyXCIsIHdlaWdodDowfV1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAgQXJyYXkgb2YgT2JqZWN0cyBhbmQgU3RyaW5nczogW3t3c191cmk6XCJob3N0MVwifSwgXCJob3N0MlwiXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygd3NTZXJ2ZXJzID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3c1NlcnZlcnMgPSBbeyB3c191cmk6IHdzU2VydmVycyB9XTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAod3NTZXJ2ZXJzIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVuZ3RoID0gd3NTZXJ2ZXJzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpZHggPSAwOyBpZHggPCBsZW5ndGg7IGlkeCsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHdzU2VydmVyc1tpZHhdID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdzU2VydmVyc1tpZHhdID0geyB3c191cmk6IHdzU2VydmVyc1tpZHhdIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdzU2VydmVycy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZW5ndGggPSB3c1NlcnZlcnMubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaWR4ID0gMDsgaWR4IDwgbGVuZ3RoOyBpZHgrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXdzU2VydmVyc1tpZHhdLndzX3VyaSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3c1NlcnZlcnNbaWR4XS53ZWlnaHQgJiYgIU51bWJlcih3c1NlcnZlcnNbaWR4XS53ZWlnaHQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gU0lQLkdyYW1tYXIucGFyc2Uod3NTZXJ2ZXJzW2lkeF0ud3NfdXJpLCAnYWJzb2x1dGVVUkknKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVybCA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChbJ3dzcycsICd3cycsICd1ZHAnXS5pbmRleE9mKHVybC5zY2hlbWUpIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd3NTZXJ2ZXJzW2lkeF0uc2lwX3VyaSA9ICc8c2lwOicgKyB1cmwuaG9zdCArICh1cmwucG9ydCA/ICc6JyArIHVybC5wb3J0IDogJycpICsgJzt0cmFuc3BvcnQ9JyArIHVybC5zY2hlbWUucmVwbGFjZSgvXndzcyQvaSwgJ3dzJykgKyAnO2xyPic7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXdzU2VydmVyc1tpZHhdLndlaWdodCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdzU2VydmVyc1tpZHhdLndlaWdodCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3c1NlcnZlcnNbaWR4XS5pc0Vycm9yID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3c1NlcnZlcnNbaWR4XS5zY2hlbWUgPSB1cmwuc2NoZW1lLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdzU2VydmVycztcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBrZWVwQWxpdmVJbnRlcnZhbDogZnVuY3Rpb24gKGtlZXBBbGl2ZUludGVydmFsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChTSVAuVXRpbHMuaXNEZWNpbWFsKGtlZXBBbGl2ZUludGVydmFsKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IE51bWJlcihrZWVwQWxpdmVJbnRlcnZhbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBrZWVwQWxpdmVEZWJvdW5jZTogZnVuY3Rpb24gKGtlZXBBbGl2ZURlYm91bmNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChTSVAuVXRpbHMuaXNEZWNpbWFsKGtlZXBBbGl2ZURlYm91bmNlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IE51bWJlcihrZWVwQWxpdmVEZWJvdW5jZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB0cmFjZVNpcDogZnVuY3Rpb24gKHRyYWNlU2lwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB0cmFjZVNpcCA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cmFjZVNpcDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvblRpbWVvdXQ6IGZ1bmN0aW9uIChjb25uZWN0aW9uVGltZW91dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoU0lQLlV0aWxzLmlzRGVjaW1hbChjb25uZWN0aW9uVGltZW91dCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBOdW1iZXIoY29ubmVjdGlvblRpbWVvdXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4UmVjb25uZWN0aW9uQXR0ZW1wdHM6IGZ1bmN0aW9uIChtYXhSZWNvbm5lY3Rpb25BdHRlbXB0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoU0lQLlV0aWxzLmlzRGVjaW1hbChtYXhSZWNvbm5lY3Rpb25BdHRlbXB0cykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBOdW1iZXIobWF4UmVjb25uZWN0aW9uQXR0ZW1wdHMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlY29ubmVjdGlvblRpbWVvdXQ6IGZ1bmN0aW9uIChyZWNvbm5lY3Rpb25UaW1lb3V0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChTSVAuVXRpbHMuaXNEZWNpbWFsKHJlY29ubmVjdGlvblRpbWVvdXQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gTnVtYmVyKHJlY29ubmVjdGlvblRpbWVvdXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSB9XG4gICAgfSk7XG4gICAgVHJhbnNwb3J0LkMgPSBDO1xuICAgIFNJUC5XZWIuVHJhbnNwb3J0ID0gVHJhbnNwb3J0O1xuICAgIHJldHVybiBUcmFuc3BvcnQ7XG59O1xuXG4vKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi99LmNhbGwodGhpcywgX193ZWJwYWNrX3JlcXVpcmVfXygyOCkpKVxuXG4vKioqLyB9KSxcbi8qIDMwICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblwidXNlIHN0cmljdFwiO1xuLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovKGZ1bmN0aW9uKGdsb2JhbCkge1xuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IFNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJcbiAqL1xuLyogU2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlclxuICogQGNsYXNzIFBlZXJDb25uZWN0aW9uIGhlbHBlciBDbGFzcy5cbiAqIEBwYXJhbSB7U0lQLlNlc3Npb259IHNlc3Npb25cbiAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoU0lQKSB7XG4gICAgLy8gQ29uc3RydWN0b3JcbiAgICB2YXIgU2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlciA9IGZ1bmN0aW9uIChsb2dnZXIsIG9ic2VydmVyLCBvcHRpb25zKSB7XG4gICAgICAgIC8vIFRPRE86IFZhbGlkYXRlIHRoZSBvcHRpb25zXG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgICAgIHRoaXMubG9nZ2VyID0gbG9nZ2VyO1xuICAgICAgICB0aGlzLm9ic2VydmVyID0gb2JzZXJ2ZXI7XG4gICAgICAgIHRoaXMuZHRtZlNlbmRlciA9IG51bGw7XG4gICAgICAgIHRoaXMuc2hvdWxkQWNxdWlyZU1lZGlhID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5DT05URU5UX1RZUEUgPSAnYXBwbGljYXRpb24vc2RwJztcbiAgICAgICAgdGhpcy5DID0ge307XG4gICAgICAgIHRoaXMuQy5ESVJFQ1RJT04gPSB7XG4gICAgICAgICAgICBOVUxMOiBudWxsLFxuICAgICAgICAgICAgU0VORFJFQ1Y6IFwic2VuZHJlY3ZcIixcbiAgICAgICAgICAgIFNFTkRPTkxZOiBcInNlbmRvbmx5XCIsXG4gICAgICAgICAgICBSRUNWT05MWTogXCJyZWN2b25seVwiLFxuICAgICAgICAgICAgSU5BQ1RJVkU6IFwiaW5hY3RpdmVcIlxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ1Nlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJPcHRpb25zOiAnICsgSlNPTi5zdHJpbmdpZnkodGhpcy5vcHRpb25zKSk7XG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gdGhpcy5DLkRJUkVDVElPTi5OVUxMO1xuICAgICAgICB0aGlzLm1vZGlmaWVycyA9IHRoaXMub3B0aW9ucy5tb2RpZmllcnMgfHwgW107XG4gICAgICAgIGlmICghQXJyYXkuaXNBcnJheSh0aGlzLm1vZGlmaWVycykpIHtcbiAgICAgICAgICAgIHRoaXMubW9kaWZpZXJzID0gW3RoaXMubW9kaWZpZXJzXTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgZW52aXJvbm1lbnQgPSBnbG9iYWwud2luZG93IHx8IGdsb2JhbDtcbiAgICAgICAgdGhpcy5XZWJSVEMgPSB7XG4gICAgICAgICAgICBNZWRpYVN0cmVhbTogZW52aXJvbm1lbnQuTWVkaWFTdHJlYW0sXG4gICAgICAgICAgICBnZXRVc2VyTWVkaWE6IGVudmlyb25tZW50Lm5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhLmJpbmQoZW52aXJvbm1lbnQubmF2aWdhdG9yLm1lZGlhRGV2aWNlcyksXG4gICAgICAgICAgICBSVENQZWVyQ29ubmVjdGlvbjogZW52aXJvbm1lbnQuUlRDUGVlckNvbm5lY3Rpb25cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5pY2VHYXRoZXJpbmdEZWZlcnJlZCA9IG51bGw7XG4gICAgICAgIHRoaXMuaWNlR2F0aGVyaW5nVGltZW91dCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmljZUdhdGhlcmluZ1RpbWVyID0gbnVsbDtcbiAgICAgICAgdGhpcy5pbml0UGVlckNvbm5lY3Rpb24odGhpcy5vcHRpb25zLnBlZXJDb25uZWN0aW9uT3B0aW9ucyk7XG4gICAgICAgIHRoaXMuY29uc3RyYWludHMgPSB0aGlzLmNoZWNrQW5kRGVmYXVsdENvbnN0cmFpbnRzKHRoaXMub3B0aW9ucy5jb25zdHJhaW50cyk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge1NJUC5TZXNzaW9ufSBzZXNzaW9uXG4gICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxuICAgICAqL1xuICAgIFNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIuZGVmYXVsdEZhY3RvcnkgPSBmdW5jdGlvbiBkZWZhdWx0RmFjdG9yeShzZXNzaW9uLCBvcHRpb25zKSB7XG4gICAgICAgIHZhciBsb2dnZXIgPSBzZXNzaW9uLnVhLmdldExvZ2dlcignc2lwLmludml0ZWNvbnRleHQuc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlcicsIHNlc3Npb24uaWQpO1xuICAgICAgICB2YXIgU2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlck9ic2VydmVyID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMSk7XG4gICAgICAgIHZhciBvYnNlcnZlciA9IG5ldyBTZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyT2JzZXJ2ZXIoc2Vzc2lvbiwgb3B0aW9ucyk7XG4gICAgICAgIHJldHVybiBuZXcgU2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlcihsb2dnZXIsIG9ic2VydmVyLCBvcHRpb25zKTtcbiAgICB9O1xuICAgIFNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShTSVAuU2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlci5wcm90b3R5cGUsIHtcbiAgICAgICAgLy8gRnVuY3Rpb25zIHRoZSBzZXNzc2lvbiBjYW4gdXNlXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEZXN0cnVjdG9yXG4gICAgICAgICAqL1xuICAgICAgICBjbG9zZTogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ2Nsb3NpbmcgUGVlckNvbm5lY3Rpb24nKTtcbiAgICAgICAgICAgICAgICAvLyBoYXZlIHRvIGNoZWNrIHNpZ25hbGluZ1N0YXRlIHNpbmNlIHRoaXMuY2xvc2UoKSBnZXRzIGNhbGxlZCBtdWx0aXBsZSB0aW1lc1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnBlZXJDb25uZWN0aW9uICYmIHRoaXMucGVlckNvbm5lY3Rpb24uc2lnbmFsaW5nU3RhdGUgIT09ICdjbG9zZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnBlZXJDb25uZWN0aW9uLmdldFNlbmRlcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGVlckNvbm5lY3Rpb24uZ2V0U2VuZGVycygpLmZvckVhY2goZnVuY3Rpb24gKHNlbmRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZW5kZXIudHJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZGVyLnRyYWNrLnN0b3AoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ1VzaW5nIGdldExvY2FsU3RyZWFtcyB3aGljaCBpcyBkZXByZWNhdGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBlZXJDb25uZWN0aW9uLmdldExvY2FsU3RyZWFtcygpLmZvckVhY2goZnVuY3Rpb24gKHN0cmVhbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmVhbS5nZXRUcmFja3MoKS5mb3JFYWNoKGZ1bmN0aW9uICh0cmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFjay5zdG9wKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wZWVyQ29ubmVjdGlvbi5nZXRSZWNlaXZlcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGVlckNvbm5lY3Rpb24uZ2V0UmVjZWl2ZXJzKCkuZm9yRWFjaChmdW5jdGlvbiAocmVjZWl2ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVjZWl2ZXIudHJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjZWl2ZXIudHJhY2suc3RvcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIud2FybignVXNpbmcgZ2V0UmVtb3RlU3RyZWFtcyB3aGljaCBpcyBkZXByZWNhdGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBlZXJDb25uZWN0aW9uLmdldFJlbW90ZVN0cmVhbXMoKS5mb3JFYWNoKGZ1bmN0aW9uIChzdHJlYW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJlYW0uZ2V0VHJhY2tzKCkuZm9yRWFjaChmdW5jdGlvbiAodHJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhY2suc3RvcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNldEljZUdhdGhlcmluZ0NvbXBsZXRlKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGVlckNvbm5lY3Rpb24uY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHZXRzIHRoZSBsb2NhbCBkZXNjcmlwdGlvbiBmcm9tIHRoZSB1bmRlcmx5aW5nIG1lZGlhIGltcGxlbWVudGF0aW9uXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gT3B0aW9ucyBvYmplY3QgdG8gYmUgdXNlZCBieSBnZXREZXNjcmlwdGlvblxuICAgICAgICAgKiBAcGFyYW0ge01lZGlhU3RyZWFtQ29uc3RyYWludHN9IFtvcHRpb25zLmNvbnN0cmFpbnRzXSBNZWRpYVN0cmVhbUNvbnN0cmFpbnRzIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9NZWRpYVN0cmVhbUNvbnN0cmFpbnRzXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9ucy5wZWVyQ29ubmVjdGlvbk9wdGlvbnNdIElmIHRoaXMgaXMgc2V0IGl0IHdpbGwgcmVjcmVhdGUgdGhlIHBlZXIgY29ubmVjdGlvbiB3aXRoIHRoZSBuZXcgb3B0aW9uc1xuICAgICAgICAgKiBAcGFyYW0ge0FycmF5fSBbbW9kaWZpZXJzXSBBcnJheSB3aXRoIG9uZSB0aW1lIHVzZSBkZXNjcmlwdGlvbiBtb2RpZmllcnNcbiAgICAgICAgICogQHJldHVybnMge1Byb21pc2V9IFByb21pc2UgdGhhdCByZXNvbHZlcyB3aXRoIHRoZSBsb2NhbCBkZXNjcmlwdGlvbiB0byBiZSB1c2VkIGZvciB0aGUgc2Vzc2lvblxuICAgICAgICAgKi9cbiAgICAgICAgZ2V0RGVzY3JpcHRpb246IHsgd3JpdGFibGU6IHRydWUsIHZhbHVlOiBmdW5jdGlvbiAob3B0aW9ucywgbW9kaWZpZXJzKSB7XG4gICAgICAgICAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMucGVlckNvbm5lY3Rpb25PcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5pdFBlZXJDb25uZWN0aW9uKG9wdGlvbnMucGVlckNvbm5lY3Rpb25PcHRpb25zKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gTWVyZ2UgcGFzc2VkIGNvbnN0cmFpbnRzIHdpdGggc2F2ZWQgY29uc3RyYWludHMgYW5kIHNhdmVcbiAgICAgICAgICAgICAgICB2YXIgbmV3Q29uc3RyYWludHMgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmNvbnN0cmFpbnRzLCBvcHRpb25zLmNvbnN0cmFpbnRzKTtcbiAgICAgICAgICAgICAgICBuZXdDb25zdHJhaW50cyA9IHRoaXMuY2hlY2tBbmREZWZhdWx0Q29uc3RyYWludHMobmV3Q29uc3RyYWludHMpO1xuICAgICAgICAgICAgICAgIGlmIChKU09OLnN0cmluZ2lmeShuZXdDb25zdHJhaW50cykgIT09IEpTT04uc3RyaW5naWZ5KHRoaXMuY29uc3RyYWludHMpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29uc3RyYWludHMgPSBuZXdDb25zdHJhaW50cztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG91bGRBY3F1aXJlTWVkaWEgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBtb2RpZmllcnMgPSBtb2RpZmllcnMgfHwgW107XG4gICAgICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KG1vZGlmaWVycykpIHtcbiAgICAgICAgICAgICAgICAgICAgbW9kaWZpZXJzID0gW21vZGlmaWVyc107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG1vZGlmaWVycyA9IG1vZGlmaWVycy5jb25jYXQodGhpcy5tb2RpZmllcnMpO1xuICAgICAgICAgICAgICAgIHJldHVybiBTSVAuVXRpbHMuUHJvbWlzZS5yZXNvbHZlKClcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zaG91bGRBY3F1aXJlTWVkaWEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmFjcXVpcmUodGhpcy5jb25zdHJhaW50cykudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG91bGRBY3F1aXJlTWVkaWEgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlT2ZmZXJPckFuc3dlcihvcHRpb25zLlJUQ09mZmVyT3B0aW9ucywgbW9kaWZpZXJzKTtcbiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkZXNjcmlwdGlvbikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ2dldERlc2NyaXB0aW9uJywgZGVzY3JpcHRpb24pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgYm9keTogZGVzY3JpcHRpb24uc2RwLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGU6IHRoaXMuQ09OVEVOVF9UWVBFXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgIH0gfSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENoZWNrIGlmIHRoZSBTZXNzaW9uIERlc2NyaXB0aW9uIEhhbmRsZXIgY2FuIGhhbmRsZSB0aGUgQ29udGVudC1UeXBlIGRlc2NyaWJlZCBieSBhIFNJUCBNZXNzYWdlXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjb250ZW50VHlwZSBUaGUgY29udGVudCB0eXBlIHRoYXQgaXMgaW4gdGhlIFNJUCBNZXNzYWdlXG4gICAgICAgICAqIEByZXR1cm5zIHtib29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgaGFzRGVzY3JpcHRpb246IHsgd3JpdGFibGU6IHRydWUsIHZhbHVlOiBmdW5jdGlvbiBoYXNEZXNjcmlwdGlvbihjb250ZW50VHlwZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjb250ZW50VHlwZSA9PT0gdGhpcy5DT05URU5UX1RZUEU7XG4gICAgICAgICAgICB9IH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbW9kaWZpZXIgdGhhdCBzaG91bGQgYmUgdXNlZCB3aGVuIHRoZSBzZXNzaW9uIHdvdWxkIGxpa2UgdG8gcGxhY2UgdGhlIGNhbGwgb24gaG9sZFxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3NkcF0gVGhlIGRlc2NyaXB0aW9uIHRoYXQgd2lsbCBiZSBtb2RpZmllZFxuICAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX0gUHJvbWlzZSB0aGF0IHJlc29sdmVzIHdpdGggbW9kaWZpZWQgU0RQXG4gICAgICAgICAqL1xuICAgICAgICBob2xkTW9kaWZpZXI6IHsgd3JpdGFibGU6IHRydWUsIHZhbHVlOiBmdW5jdGlvbiBob2xkTW9kaWZpZXIoZGVzY3JpcHRpb24pIHtcbiAgICAgICAgICAgICAgICBpZiAoISgvYT0oc2VuZHJlY3Z8c2VuZG9ubHl8cmVjdm9ubHl8aW5hY3RpdmUpLykudGVzdChkZXNjcmlwdGlvbi5zZHApKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uLnNkcCA9IGRlc2NyaXB0aW9uLnNkcC5yZXBsYWNlKC8obT1bXlxccl0qXFxyXFxuKS9nLCAnJDFhPXNlbmRvbmx5XFxyXFxuJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbi5zZHAgPSBkZXNjcmlwdGlvbi5zZHAucmVwbGFjZSgvYT1zZW5kcmVjdlxcclxcbi9nLCAnYT1zZW5kb25seVxcclxcbicpO1xuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbi5zZHAgPSBkZXNjcmlwdGlvbi5zZHAucmVwbGFjZSgvYT1yZWN2b25seVxcclxcbi9nLCAnYT1pbmFjdGl2ZVxcclxcbicpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gU0lQLlV0aWxzLlByb21pc2UucmVzb2x2ZShkZXNjcmlwdGlvbik7XG4gICAgICAgICAgICB9IH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXQgdGhlIHJlbW90ZSBkZXNjcmlwdGlvbiB0byB0aGUgdW5kZXJseWluZyBtZWRpYSBpbXBsZW1lbnRhdGlvblxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gc2Vzc2lvbkRlc2NyaXB0aW9uIFRoZSBkZXNjcmlwdGlvbiBwcm92aWRlZCBieSBhIFNJUCBtZXNzYWdlIHRvIGJlIHNldCBvbiB0aGUgbWVkaWEgaW1wbGVtZW50YXRpb25cbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSBPcHRpb25zIG9iamVjdCB0byBiZSB1c2VkIGJ5IGdldERlc2NyaXB0aW9uXG4gICAgICAgICAqIEBwYXJhbSB7TWVkaWFTdHJlYW1Db25zdHJhaW50c30gW29wdGlvbnMuY29uc3RyYWludHNdIE1lZGlhU3RyZWFtQ29uc3RyYWludHMgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL01lZGlhU3RyZWFtQ29uc3RyYWludHNcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zLnBlZXJDb25uZWN0aW9uT3B0aW9uc10gSWYgdGhpcyBpcyBzZXQgaXQgd2lsbCByZWNyZWF0ZSB0aGUgcGVlciBjb25uZWN0aW9uIHdpdGggdGhlIG5ldyBvcHRpb25zXG4gICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IFttb2RpZmllcnNdIEFycmF5IHdpdGggb25lIHRpbWUgdXNlIGRlc2NyaXB0aW9uIG1vZGlmaWVyc1xuICAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX0gUHJvbWlzZSB0aGF0IHJlc29sdmVzIG9uY2UgdGhlIGRlc2NyaXB0aW9uIGlzIHNldFxuICAgICAgICAgKi9cbiAgICAgICAgc2V0RGVzY3JpcHRpb246IHsgd3JpdGFibGU6IHRydWUsIHZhbHVlOiBmdW5jdGlvbiBzZXREZXNjcmlwdGlvbihzZXNzaW9uRGVzY3JpcHRpb24sIG9wdGlvbnMsIG1vZGlmaWVycykge1xuICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnBlZXJDb25uZWN0aW9uT3B0aW9ucykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmluaXRQZWVyQ29ubmVjdGlvbihvcHRpb25zLnBlZXJDb25uZWN0aW9uT3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG1vZGlmaWVycyA9IG1vZGlmaWVycyB8fCBbXTtcbiAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkobW9kaWZpZXJzKSkge1xuICAgICAgICAgICAgICAgICAgICBtb2RpZmllcnMgPSBbbW9kaWZpZXJzXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbW9kaWZpZXJzID0gbW9kaWZpZXJzLmNvbmNhdCh0aGlzLm1vZGlmaWVycyk7XG4gICAgICAgICAgICAgICAgdmFyIGRlc2NyaXB0aW9uID0ge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiB0aGlzLmhhc09mZmVyKCdsb2NhbCcpID8gJ2Fuc3dlcicgOiAnb2ZmZXInLFxuICAgICAgICAgICAgICAgICAgICBzZHA6IHNlc3Npb25EZXNjcmlwdGlvblxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgcmV0dXJuIFNJUC5VdGlscy5Qcm9taXNlLnJlc29sdmUoKVxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIE1lZGlhIHNob3VsZCBiZSBhY3F1aXJlZCBpbiBnZXREZXNjcmlwdGlvbiB1bmxlc3Mgd2UgbmVlZCB0byBkbyBpdCBzb29uZXIgZm9yIHNvbWUgcmVhc29uIChGRjYxKylcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2hvdWxkQWNxdWlyZU1lZGlhICYmIHRoaXMub3B0aW9ucy5hbHdheXNBY3F1aXJlTWVkaWFGaXJzdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWNxdWlyZSh0aGlzLmNvbnN0cmFpbnRzKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3VsZEFjcXVpcmVNZWRpYSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSlcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gU0lQLlV0aWxzLnJlZHVjZVByb21pc2VzKG1vZGlmaWVycywgZGVzY3JpcHRpb24pO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIFNJUC5FeGNlcHRpb25zLlNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJFcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSBuZXcgU0lQLkV4Y2VwdGlvbnMuU2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlckVycm9yKFwic2V0RGVzY3JpcHRpb25cIiwgZSwgXCJUaGUgbW9kaWZpZXJzIGRpZCBub3QgcmVzb2x2ZSBzdWNjZXNzZnVsbHlcIik7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmxvZ2dlci5lcnJvcihlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5lbWl0KCdwZWVyQ29ubmVjdGlvbi1zZXRSZW1vdGVEZXNjcmlwdGlvbkZhaWxlZCcsIGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKG1vZGlmaWVkRGVzY3JpcHRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5lbWl0KCdzZXREZXNjcmlwdGlvbicsIG1vZGlmaWVkRGVzY3JpcHRpb24pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5wZWVyQ29ubmVjdGlvbi5zZXRSZW1vdGVEZXNjcmlwdGlvbihtb2RpZmllZERlc2NyaXB0aW9uKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBTSVAuRXhjZXB0aW9ucy5TZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgdGhlIG9yaWdpbmFsIFNEUCBmb3IgdmlkZW8sIGFuZCBlbnN1cmUgdGhhdCB3ZSBoYXZlIHdhbnQgdG8gZG8gYXVkaW8gZmFsbGJhY2tcbiAgICAgICAgICAgICAgICAgICAgaWYgKCgvXm09dmlkZW8uKyQvZ20pLnRlc3Qoc2Vzc2lvbkRlc2NyaXB0aW9uKSAmJiAhb3B0aW9ucy5kaXNhYmxlQXVkaW9GYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRG8gbm90IHRyeSB0byBhdWRpbyBmYWxsYmFjayBhZ2FpblxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kaXNhYmxlQXVkaW9GYWxsYmFjayA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgdmlkZW8gZmlyc3QsIHRoZW4gZG8gdGhlIG90aGVyIG1vZGlmaWVyc1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLnNldERlc2NyaXB0aW9uKHNlc3Npb25EZXNjcmlwdGlvbiwgb3B0aW9ucywgW1NJUC5XZWIuTW9kaWZpZXJzLnN0cmlwVmlkZW9dLmNvbmNhdChtb2RpZmllcnMpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSBuZXcgU0lQLkV4Y2VwdGlvbnMuU2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlckVycm9yKFwic2V0RGVzY3JpcHRpb25cIiwgZSk7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmxvZ2dlci5lcnJvcihlcnJvci5lcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmVtaXQoJ3BlZXJDb25uZWN0aW9uLXNldFJlbW90ZURlc2NyaXB0aW9uRmFpbGVkJywgZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiBzZXRSZW1vdGVEZXNjcmlwdGlvblN1Y2Nlc3MoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWxmLnBlZXJDb25uZWN0aW9uLmdldFJlY2VpdmVycykge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5lbWl0KCdzZXRSZW1vdGVEZXNjcmlwdGlvbicsIHNlbGYucGVlckNvbm5lY3Rpb24uZ2V0UmVjZWl2ZXJzKCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5lbWl0KCdzZXRSZW1vdGVEZXNjcmlwdGlvbicsIHNlbGYucGVlckNvbm5lY3Rpb24uZ2V0UmVtb3RlU3RyZWFtcygpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBzZWxmLmVtaXQoJ2NvbmZpcm1lZCcsIHNlbGYpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSB9LFxuICAgICAgICAvKipcbiAgICAgICAgICogU2VuZCBEVE1GIHZpYSBSVFAgKFJGQyA0NzMzKVxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gdG9uZXMgQSBzdHJpbmcgY29udGFpbmluZyBEVE1GIGRpZ2l0c1xuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdIE9wdGlvbnMgb2JqZWN0IHRvIGJlIHVzZWQgYnkgc2VuZER0bWZcbiAgICAgICAgICogQHJldHVybnMge2Jvb2xlYW59IHRydWUgaWYgRFRNRiBzZW5kIGlzIHN1Y2Nlc3NmdWwsIGZhbHNlIG90aGVyd2lzZVxuICAgICAgICAgKi9cbiAgICAgICAgc2VuZER0bWY6IHsgd3JpdGFibGU6IHRydWUsIHZhbHVlOiBmdW5jdGlvbiBzZW5kRHRtZih0b25lcywgb3B0aW9ucykge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5kdG1mU2VuZGVyICYmIHRoaXMuaGFzQnJvd3NlckdldFNlbmRlclN1cHBvcnQoKSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2VuZGVycyA9IHRoaXMucGVlckNvbm5lY3Rpb24uZ2V0U2VuZGVycygpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2VuZGVycy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmR0bWZTZW5kZXIgPSBzZW5kZXJzWzBdLmR0bWY7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmR0bWZTZW5kZXIgJiYgdGhpcy5oYXNCcm93c2VyVHJhY2tTdXBwb3J0KCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0cmVhbXMgPSB0aGlzLnBlZXJDb25uZWN0aW9uLmdldExvY2FsU3RyZWFtcygpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc3RyZWFtcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXVkaW9UcmFja3MgPSBzdHJlYW1zWzBdLmdldEF1ZGlvVHJhY2tzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXVkaW9UcmFja3MubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZHRtZlNlbmRlciA9IHRoaXMucGVlckNvbm5lY3Rpb24uY3JlYXRlRFRNRlNlbmRlcihhdWRpb1RyYWNrc1swXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmR0bWZTZW5kZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmR0bWZTZW5kZXIuaW5zZXJ0RFRNRih0b25lcywgb3B0aW9ucy5kdXJhdGlvbiwgb3B0aW9ucy5pbnRlclRvbmVHYXApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZS50eXBlID09PSBcIkludmFsaWRTdGF0ZUVycm9yXCIgfHwgZS50eXBlID09PSBcIkludmFsaWRDaGFyYWN0ZXJFcnJvclwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5lcnJvcihlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKCdEVE1GIHNlbnQgdmlhIFJUUDogJyArIHRvbmVzLnRvU3RyaW5nKCkpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSB9LFxuICAgICAgICBnZXREaXJlY3Rpb246IHsgd3JpdGFibGU6IHRydWUsIHZhbHVlOiBmdW5jdGlvbiBnZXREaXJlY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGlyZWN0aW9uO1xuICAgICAgICAgICAgfSB9LFxuICAgICAgICAvLyBJbnRlcm5hbCBmdW5jdGlvbnNcbiAgICAgICAgY3JlYXRlT2ZmZXJPckFuc3dlcjogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZU9mZmVyT3JBbnN3ZXIoUlRDT2ZmZXJPcHRpb25zLCBtb2RpZmllcnMpIHtcbiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgICAgICB2YXIgbWV0aG9kTmFtZTtcbiAgICAgICAgICAgICAgICB2YXIgcGMgPSB0aGlzLnBlZXJDb25uZWN0aW9uO1xuICAgICAgICAgICAgICAgIFJUQ09mZmVyT3B0aW9ucyA9IFJUQ09mZmVyT3B0aW9ucyB8fCB7fTtcbiAgICAgICAgICAgICAgICBtZXRob2ROYW1lID0gc2VsZi5oYXNPZmZlcigncmVtb3RlJykgPyAnY3JlYXRlQW5zd2VyJyA6ICdjcmVhdGVPZmZlcic7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBjW21ldGhvZE5hbWVdKFJUQ09mZmVyT3B0aW9ucylcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgU0lQLkV4Y2VwdGlvbnMuU2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlckVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvciA9IG5ldyBTSVAuRXhjZXB0aW9ucy5TZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyRXJyb3IoXCJjcmVhdGVPZmZlck9yQW5zd2VyXCIsIGUsICdwZWVyQ29ubmVjdGlvbi0nICsgbWV0aG9kTmFtZSArICdGYWlsZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuZW1pdCgncGVlckNvbm5lY3Rpb24tJyArIG1ldGhvZE5hbWUgKyAnRmFpbGVkJywgZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoc2RwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBTSVAuVXRpbHMucmVkdWNlUHJvbWlzZXMobW9kaWZpZXJzLCBzZWxmLmNyZWF0ZVJUQ1Nlc3Npb25EZXNjcmlwdGlvbkluaXQoc2RwKSk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHNkcCkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnJlc2V0SWNlR2F0aGVyaW5nQ29tcGxldGUoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBjLnNldExvY2FsRGVzY3JpcHRpb24oc2RwKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBTSVAuRXhjZXB0aW9ucy5TZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yID0gbmV3IFNJUC5FeGNlcHRpb25zLlNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJFcnJvcihcImNyZWF0ZU9mZmVyT3JBbnN3ZXJcIiwgZSwgJ3BlZXJDb25uZWN0aW9uLVNldExvY2FsRGVzY3JpcHRpb25GYWlsZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuZW1pdCgncGVlckNvbm5lY3Rpb24tU2V0TG9jYWxEZXNjcmlwdGlvbkZhaWxlZCcsIGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gb25TZXRMb2NhbERlc2NyaXB0aW9uU3VjY2VzcygpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYud2FpdEZvckljZUdhdGhlcmluZ0NvbXBsZXRlKCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gcmVhZHlTdWNjZXNzKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbG9jYWxEZXNjcmlwdGlvbiA9IHNlbGYuY3JlYXRlUlRDU2Vzc2lvbkRlc2NyaXB0aW9uSW5pdChzZWxmLnBlZXJDb25uZWN0aW9uLmxvY2FsRGVzY3JpcHRpb24pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gU0lQLlV0aWxzLnJlZHVjZVByb21pc2VzKG1vZGlmaWVycywgbG9jYWxEZXNjcmlwdGlvbik7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGxvY2FsRGVzY3JpcHRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXREaXJlY3Rpb24obG9jYWxEZXNjcmlwdGlvbi5zZHApO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbG9jYWxEZXNjcmlwdGlvbjtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBTSVAuRXhjZXB0aW9ucy5TZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yID0gbmV3IFNJUC5FeGNlcHRpb25zLlNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJFcnJvcihcImNyZWF0ZU9mZmVyT3JBbnN3ZXJcIiwgZSk7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmxvZ2dlci5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSB9LFxuICAgICAgICAvLyBDcmVhdGVzIGFuIFJUQ1Nlc3Npb25EZXNjcmlwdGlvbkluaXQgZnJvbSBhbiBSVENTZXNzaW9uRGVzY3JpcHRpb25cbiAgICAgICAgY3JlYXRlUlRDU2Vzc2lvbkRlc2NyaXB0aW9uSW5pdDogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZVJUQ1Nlc3Npb25EZXNjcmlwdGlvbkluaXQoUlRDU2Vzc2lvbkRlc2NyaXB0aW9uKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogUlRDU2Vzc2lvbkRlc2NyaXB0aW9uLnR5cGUsXG4gICAgICAgICAgICAgICAgICAgIHNkcDogUlRDU2Vzc2lvbkRlc2NyaXB0aW9uLnNkcFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9IH0sXG4gICAgICAgIGFkZERlZmF1bHRJY2VDaGVja2luZ1RpbWVvdXQ6IHsgd3JpdGFibGU6IHRydWUsIHZhbHVlOiBmdW5jdGlvbiBhZGREZWZhdWx0SWNlQ2hlY2tpbmdUaW1lb3V0KHBlZXJDb25uZWN0aW9uT3B0aW9ucykge1xuICAgICAgICAgICAgICAgIGlmIChwZWVyQ29ubmVjdGlvbk9wdGlvbnMuaWNlQ2hlY2tpbmdUaW1lb3V0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcGVlckNvbm5lY3Rpb25PcHRpb25zLmljZUNoZWNraW5nVGltZW91dCA9IDUwMDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBwZWVyQ29ubmVjdGlvbk9wdGlvbnM7XG4gICAgICAgICAgICB9IH0sXG4gICAgICAgIGFkZERlZmF1bHRJY2VTZXJ2ZXJzOiB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogZnVuY3Rpb24gYWRkRGVmYXVsdEljZVNlcnZlcnMocnRjQ29uZmlndXJhdGlvbikge1xuICAgICAgICAgICAgICAgIGlmICghcnRjQ29uZmlndXJhdGlvbi5pY2VTZXJ2ZXJzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJ0Y0NvbmZpZ3VyYXRpb24uaWNlU2VydmVycyA9IFt7IHVybHM6ICdzdHVuOnN0dW4ubC5nb29nbGUuY29tOjE5MzAyJyB9XTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJ0Y0NvbmZpZ3VyYXRpb247XG4gICAgICAgICAgICB9IH0sXG4gICAgICAgIGNoZWNrQW5kRGVmYXVsdENvbnN0cmFpbnRzOiB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogZnVuY3Rpb24gY2hlY2tBbmREZWZhdWx0Q29uc3RyYWludHMoY29uc3RyYWludHMpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGVmYXVsdENvbnN0cmFpbnRzID0geyBhdWRpbzogdHJ1ZSwgdmlkZW86ICF0aGlzLm9wdGlvbnMuYWx3YXlzQWNxdWlyZU1lZGlhRmlyc3QgfTtcbiAgICAgICAgICAgICAgICBjb25zdHJhaW50cyA9IGNvbnN0cmFpbnRzIHx8IGRlZmF1bHRDb25zdHJhaW50cztcbiAgICAgICAgICAgICAgICAvLyBFbXB0eSBvYmplY3QgY2hlY2tcbiAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMoY29uc3RyYWludHMpLmxlbmd0aCA9PT0gMCAmJiBjb25zdHJhaW50cy5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWZhdWx0Q29uc3RyYWludHM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBjb25zdHJhaW50cztcbiAgICAgICAgICAgIH0gfSxcbiAgICAgICAgaGFzQnJvd3NlclRyYWNrU3VwcG9ydDogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uIGhhc0Jyb3dzZXJUcmFja1N1cHBvcnQoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4odGhpcy5wZWVyQ29ubmVjdGlvbi5hZGRUcmFjayk7XG4gICAgICAgICAgICB9IH0sXG4gICAgICAgIGhhc0Jyb3dzZXJHZXRTZW5kZXJTdXBwb3J0OiB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogZnVuY3Rpb24gaGFzQnJvd3NlckdldFNlbmRlclN1cHBvcnQoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4odGhpcy5wZWVyQ29ubmVjdGlvbi5nZXRTZW5kZXJzKTtcbiAgICAgICAgICAgIH0gfSxcbiAgICAgICAgaW5pdFBlZXJDb25uZWN0aW9uOiB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogZnVuY3Rpb24gaW5pdFBlZXJDb25uZWN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgICAgICAgICAgICAgb3B0aW9ucyA9IHRoaXMuYWRkRGVmYXVsdEljZUNoZWNraW5nVGltZW91dChvcHRpb25zKTtcbiAgICAgICAgICAgICAgICBvcHRpb25zLnJ0Y0NvbmZpZ3VyYXRpb24gPSBvcHRpb25zLnJ0Y0NvbmZpZ3VyYXRpb24gfHwge307XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5ydGNDb25maWd1cmF0aW9uID0gdGhpcy5hZGREZWZhdWx0SWNlU2VydmVycyhvcHRpb25zLnJ0Y0NvbmZpZ3VyYXRpb24pO1xuICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZygnaW5pdFBlZXJDb25uZWN0aW9uJyk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucGVlckNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKCdBbHJlYWR5IGhhdmUgYSBwZWVyIGNvbm5lY3Rpb24gZm9yIHRoaXMgc2Vzc2lvbi4gVGVhcmluZyBkb3duLicpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc2V0SWNlR2F0aGVyaW5nQ29tcGxldGUoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wZWVyQ29ubmVjdGlvbi5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnBlZXJDb25uZWN0aW9uID0gbmV3IHRoaXMuV2ViUlRDLlJUQ1BlZXJDb25uZWN0aW9uKG9wdGlvbnMucnRjQ29uZmlndXJhdGlvbik7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKCdOZXcgcGVlciBjb25uZWN0aW9uIGNyZWF0ZWQnKTtcbiAgICAgICAgICAgICAgICBpZiAoJ29udHJhY2snIGluIHRoaXMucGVlckNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wZWVyQ29ubmVjdGlvbi5hZGRFdmVudExpc3RlbmVyKCd0cmFjaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coJ3RyYWNrIGFkZGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm9ic2VydmVyLnRyYWNrQWRkZWQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZW1pdCgnYWRkVHJhY2snLCBlKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuKCdVc2luZyBvbmFkZHN0cmVhbSB3aGljaCBpcyBkZXByZWNhdGVkJyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGVlckNvbm5lY3Rpb24ub25hZGRzdHJlYW0gPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKCdzdHJlYW0gYWRkZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZW1pdCgnYWRkU3RyZWFtJywgZSk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMucGVlckNvbm5lY3Rpb24ub25pY2VjYW5kaWRhdGUgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmVtaXQoJ2ljZUNhbmRpZGF0ZScsIGUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZS5jYW5kaWRhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZygnSUNFIGNhbmRpZGF0ZSByZWNlaXZlZDogJyArIChlLmNhbmRpZGF0ZS5jYW5kaWRhdGUgPT09IG51bGwgPyBudWxsIDogZS5jYW5kaWRhdGUuY2FuZGlkYXRlLnRyaW0oKSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGUuY2FuZGlkYXRlID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpbmRpY2F0ZXMgdGhlIGVuZCBvZiBjYW5kaWRhdGUgZ2F0aGVyaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coJ0lDRSBjYW5kaWRhdGUgZ2F0aGVyaW5nIGNvbXBsZXRlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRyaWdnZXJJY2VHYXRoZXJpbmdDb21wbGV0ZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB0aGlzLnBlZXJDb25uZWN0aW9uLm9uaWNlZ2F0aGVyaW5nc3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZygnUlRDSWNlR2F0aGVyaW5nU3RhdGUgY2hhbmdlZDogJyArIHRoaXMuaWNlR2F0aGVyaW5nU3RhdGUpO1xuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHRoaXMuaWNlR2F0aGVyaW5nU3RhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2dhdGhlcmluZyc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5lbWl0KCdpY2VHYXRoZXJpbmcnLCB0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXNlbGYuaWNlR2F0aGVyaW5nVGltZXIgJiYgb3B0aW9ucy5pY2VDaGVja2luZ1RpbWVvdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5pY2VHYXRoZXJpbmdUaW1lb3V0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaWNlR2F0aGVyaW5nVGltZXIgPSBTSVAuVGltZXJzLnNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKCdSVENJY2VDaGVja2luZyBUaW1lb3V0IFRyaWdnZXJlZCBhZnRlciAnICsgb3B0aW9ucy5pY2VDaGVja2luZ1RpbWVvdXQgKyAnIG1pbGxpc2Vjb25kcycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5pY2VHYXRoZXJpbmdUaW1lb3V0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudHJpZ2dlckljZUdhdGhlcmluZ0NvbXBsZXRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIG9wdGlvbnMuaWNlQ2hlY2tpbmdUaW1lb3V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdjb21wbGV0ZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50cmlnZ2VySWNlR2F0aGVyaW5nQ29tcGxldGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdGhpcy5wZWVyQ29ubmVjdGlvbi5vbmljZWNvbm5lY3Rpb25zdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0YXRlRXZlbnQ7XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodGhpcy5pY2VDb25uZWN0aW9uU3RhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ25ldyc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVFdmVudCA9ICdpY2VDb25uZWN0aW9uJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2NoZWNraW5nJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUV2ZW50ID0gJ2ljZUNvbm5lY3Rpb25DaGVja2luZyc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdjb25uZWN0ZWQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlRXZlbnQgPSAnaWNlQ29ubmVjdGlvbkNvbm5lY3RlZCc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdjb21wbGV0ZWQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlRXZlbnQgPSAnaWNlQ29ubmVjdGlvbkNvbXBsZXRlZCc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdmYWlsZWQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlRXZlbnQgPSAnaWNlQ29ubmVjdGlvbkZhaWxlZCc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdkaXNjb25uZWN0ZWQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlRXZlbnQgPSAnaWNlQ29ubmVjdGlvbkRpc2Nvbm5lY3RlZCc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdjbG9zZWQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlRXZlbnQgPSAnaWNlQ29ubmVjdGlvbkNsb3NlZCc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm4oJ1Vua25vd24gaWNlQ29ubmVjdGlvbiBzdGF0ZTonLCB0aGlzLmljZUNvbm5lY3Rpb25TdGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuZW1pdChzdGF0ZUV2ZW50LCB0aGlzKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSB9LFxuICAgICAgICBhY3F1aXJlOiB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogZnVuY3Rpb24gYWNxdWlyZShjb25zdHJhaW50cykge1xuICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgLy8gRGVmYXVsdCBhdWRpbyAmIHZpZGVvIHRvIHRydWVcbiAgICAgICAgICAgICAgICBjb25zdHJhaW50cyA9IHRoaXMuY2hlY2tBbmREZWZhdWx0Q29uc3RyYWludHMoY29uc3RyYWludHMpO1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU0lQLlV0aWxzLlByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgICAgICAgKiBNYWtlIHRoZSBjYWxsIGFzeW5jaHJvbm91cywgc28gdGhhdCBJQ0NzIGhhdmUgYSBjaGFuY2VcbiAgICAgICAgICAgICAgICAgICAgICogdG8gZGVmaW5lIGNhbGxiYWNrcyB0byBgdXNlck1lZGlhUmVxdWVzdGBcbiAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZygnYWNxdWlyaW5nIGxvY2FsIG1lZGlhJyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgndXNlck1lZGlhUmVxdWVzdCcsIGNvbnN0cmFpbnRzKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnN0cmFpbnRzLmF1ZGlvIHx8IGNvbnN0cmFpbnRzLnZpZGVvKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLldlYlJUQy5nZXRVc2VyTWVkaWEoY29uc3RyYWludHMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHN0cmVhbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9ic2VydmVyLnRyYWNrQWRkZWQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ3VzZXJNZWRpYScsIHN0cmVhbXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3RyZWFtcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpLmNhdGNoKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCd1c2VyTWVkaWFGYWlsZWQnLCBlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gTG9jYWwgc3RyZWFtcyB3ZXJlIGV4cGxpY2l0bHkgZXhjbHVkZWQuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKFtdKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSlcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IFRoaXMgcHJvcG9nYXRlcyBkb3dud2FyZHNcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBTSVAuRXhjZXB0aW9ucy5TZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yID0gbmV3IFNJUC5FeGNlcHRpb25zLlNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJFcnJvcihcImFjcXVpcmVcIiwgZSwgXCJ1bmFibGUgdG8gYWNxdWlyZSBzdHJlYW1zXCIpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5sb2dnZXIuZXJyb3IoZXJyb3IubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmxvZ2dlci5lcnJvcihlcnJvci5lcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIGFjcXVpcmVTdWNjZWVkZWQoc3RyZWFtcykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ2FjcXVpcmVkIGxvY2FsIG1lZGlhIHN0cmVhbXMnKTtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBvbGQgdHJhY2tzXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wZWVyQ29ubmVjdGlvbi5yZW1vdmVUcmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGVlckNvbm5lY3Rpb24uZ2V0U2VuZGVycygpLmZvckVhY2goZnVuY3Rpb24gKHNlbmRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBlZXJDb25uZWN0aW9uLnJlbW92ZVRyYWNrKHNlbmRlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RyZWFtcztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNJUC5VdGlscy5Qcm9taXNlLnJlamVjdChlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSlcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgU0lQLkV4Y2VwdGlvbnMuU2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlckVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvciA9IG5ldyBTSVAuRXhjZXB0aW9ucy5TZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyRXJyb3IoXCJhY3F1aXJlXCIsIGUsIFwiZXJyb3IgcmVtb3Zpbmcgc3RyZWFtc1wiKTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMubG9nZ2VyLmVycm9yKGVycm9yLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5sb2dnZXIuZXJyb3IoZXJyb3IuZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiBhZGRTdHJlYW1zKHN0cmVhbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmVhbXMgPSBbXS5jb25jYXQoc3RyZWFtcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJlYW1zLmZvckVhY2goZnVuY3Rpb24gKHN0cmVhbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnBlZXJDb25uZWN0aW9uLmFkZFRyYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmVhbS5nZXRUcmFja3MoKS5mb3JFYWNoKGZ1bmN0aW9uICh0cmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wZWVyQ29ubmVjdGlvbi5hZGRUcmFjayh0cmFjaywgc3RyZWFtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaHJvbWUgNTkgZG9lcyBub3Qgc3VwcG9ydCBhZGRUcmFja1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBlZXJDb25uZWN0aW9uLmFkZFN0cmVhbShzdHJlYW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gU0lQLlV0aWxzLlByb21pc2UucmVqZWN0KGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBTSVAuVXRpbHMuUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKVxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBTSVAuRXhjZXB0aW9ucy5TZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yID0gbmV3IFNJUC5FeGNlcHRpb25zLlNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJFcnJvcihcImFjcXVpcmVcIiwgZSwgXCJlcnJvciBhZGRpbmcgc3RyZWFtXCIpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5sb2dnZXIuZXJyb3IoZXJyb3IubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmxvZ2dlci5lcnJvcihlcnJvci5lcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSB9LFxuICAgICAgICBoYXNPZmZlcjogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uIGhhc09mZmVyKHdoZXJlKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9mZmVyU3RhdGUgPSAnaGF2ZS0nICsgd2hlcmUgKyAnLW9mZmVyJztcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wZWVyQ29ubmVjdGlvbi5zaWduYWxpbmdTdGF0ZSA9PT0gb2ZmZXJTdGF0ZTtcbiAgICAgICAgICAgIH0gfSxcbiAgICAgICAgLy8gSUNFIGdhdGhlcmluZyBzdGF0ZSBoYW5kbGluZ1xuICAgICAgICBpc0ljZUdhdGhlcmluZ0NvbXBsZXRlOiB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogZnVuY3Rpb24gaXNJY2VHYXRoZXJpbmdDb21wbGV0ZSgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wZWVyQ29ubmVjdGlvbi5pY2VHYXRoZXJpbmdTdGF0ZSA9PT0gJ2NvbXBsZXRlJyB8fCB0aGlzLmljZUdhdGhlcmluZ1RpbWVvdXQ7XG4gICAgICAgICAgICB9IH0sXG4gICAgICAgIHJlc2V0SWNlR2F0aGVyaW5nQ29tcGxldGU6IHsgd3JpdGFibGU6IHRydWUsIHZhbHVlOiBmdW5jdGlvbiByZXNldEljZUdhdGhlcmluZ0NvbXBsZXRlKCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaWNlR2F0aGVyaW5nVGltZW91dCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmljZUdhdGhlcmluZ1RpbWVyKSB7XG4gICAgICAgICAgICAgICAgICAgIFNJUC5UaW1lcnMuY2xlYXJUaW1lb3V0KHRoaXMuaWNlR2F0aGVyaW5nVGltZXIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmljZUdhdGhlcmluZ1RpbWVyID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWNlR2F0aGVyaW5nRGVmZXJyZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pY2VHYXRoZXJpbmdEZWZlcnJlZC5yZWplY3QoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pY2VHYXRoZXJpbmdEZWZlcnJlZCA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9LFxuICAgICAgICBzZXREaXJlY3Rpb246IHsgd3JpdGFibGU6IHRydWUsIHZhbHVlOiBmdW5jdGlvbiBzZXREaXJlY3Rpb24oc2RwKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1hdGNoID0gc2RwLm1hdGNoKC9hPShzZW5kcmVjdnxzZW5kb25seXxyZWN2b25seXxpbmFjdGl2ZSkvKTtcbiAgICAgICAgICAgICAgICBpZiAobWF0Y2ggPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSB0aGlzLkMuRElSRUNUSU9OLk5VTEw7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub2JzZXJ2ZXIuZGlyZWN0aW9uQ2hhbmdlZCgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBkaXJlY3Rpb24gPSBtYXRjaFsxXTtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGRpcmVjdGlvbikge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIHRoaXMuQy5ESVJFQ1RJT04uU0VORFJFQ1Y6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgdGhpcy5DLkRJUkVDVElPTi5TRU5ET05MWTpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSB0aGlzLkMuRElSRUNUSU9OLlJFQ1ZPTkxZOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIHRoaXMuQy5ESVJFQ1RJT04uSU5BQ1RJVkU6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IGRpcmVjdGlvbjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSB0aGlzLkMuRElSRUNUSU9OLk5VTEw7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5vYnNlcnZlci5kaXJlY3Rpb25DaGFuZ2VkKCk7XG4gICAgICAgICAgICB9IH0sXG4gICAgICAgIHRyaWdnZXJJY2VHYXRoZXJpbmdDb21wbGV0ZTogeyB3cml0YWJsZTogdHJ1ZSwgdmFsdWU6IGZ1bmN0aW9uIHRyaWdnZXJJY2VHYXRoZXJpbmdDb21wbGV0ZSgpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0ljZUdhdGhlcmluZ0NvbXBsZXRlKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdpY2VHYXRoZXJpbmdDb21wbGV0ZScsIHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pY2VHYXRoZXJpbmdUaW1lcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgU0lQLlRpbWVycy5jbGVhclRpbWVvdXQodGhpcy5pY2VHYXRoZXJpbmdUaW1lcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmljZUdhdGhlcmluZ1RpbWVyID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pY2VHYXRoZXJpbmdEZWZlcnJlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pY2VHYXRoZXJpbmdEZWZlcnJlZC5yZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmljZUdhdGhlcmluZ0RlZmVycmVkID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSxcbiAgICAgICAgd2FpdEZvckljZUdhdGhlcmluZ0NvbXBsZXRlOiB7IHdyaXRhYmxlOiB0cnVlLCB2YWx1ZTogZnVuY3Rpb24gd2FpdEZvckljZUdhdGhlcmluZ0NvbXBsZXRlKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzSWNlR2F0aGVyaW5nQ29tcGxldGUoKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gU0lQLlV0aWxzLlByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICghdGhpcy5pc0ljZUdhdGhlcmluZ0RlZmVycmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaWNlR2F0aGVyaW5nRGVmZXJyZWQgPSBTSVAuVXRpbHMuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaWNlR2F0aGVyaW5nRGVmZXJyZWQucHJvbWlzZTtcbiAgICAgICAgICAgIH0gfVxuICAgIH0pO1xuICAgIHJldHVybiBTZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyO1xufTtcblxuLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovfS5jYWxsKHRoaXMsIF9fd2VicGFja19yZXF1aXJlX18oMjgpKSlcblxuLyoqKi8gfSksXG4vKiAzMSAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cInVzZSBzdHJpY3RcIjtcblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IFNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJPYnNlcnZlclxuICovXG4vKiBTZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyT2JzZXJ2ZXJcbiAqIEBjbGFzcyBTZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyIE9ic2VydmVyIENsYXNzLlxuICogQHBhcmFtIHtTSVAuU2Vzc2lvbn0gc2Vzc2lvblxuICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxuICovXG4vLyBDb25zdHJ1Y3RvclxudmFyIFNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJPYnNlcnZlciA9IGZ1bmN0aW9uIChzZXNzaW9uLCBvcHRpb25zKSB7XG4gICAgdGhpcy5zZXNzaW9uID0gc2Vzc2lvbiB8fCB7fTtcbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xufTtcblNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJPYnNlcnZlci5wcm90b3R5cGUgPSB7XG4gICAgdHJhY2tBZGRlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnNlc3Npb24uZW1pdCgndHJhY2tBZGRlZCcpO1xuICAgIH0sXG4gICAgZGlyZWN0aW9uQ2hhbmdlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnNlc3Npb24uZW1pdCgnZGlyZWN0aW9uQ2hhbmdlZCcpO1xuICAgIH0sXG59O1xubW9kdWxlLmV4cG9ydHMgPSBTZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyT2JzZXJ2ZXI7XG5cblxuLyoqKi8gfSksXG4vKiAzMiAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cInVzZSBzdHJpY3RcIjtcblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IEluY29taW5nIFNJUCBNZXNzYWdlIFNhbml0eSBDaGVja1xuICovXG4vKipcbiAqIFNJUCBtZXNzYWdlIHNhbml0eSBjaGVjay5cbiAqIEBhdWdtZW50cyBTSVBcbiAqIEBmdW5jdGlvblxuICogQHBhcmFtIHtTSVAuSW5jb21pbmdNZXNzYWdlfSBtZXNzYWdlXG4gKiBAcGFyYW0ge1NJUC5VQX0gdWFcbiAqIEBwYXJhbSB7U0lQLlRyYW5zcG9ydH0gdHJhbnNwb3J0XG4gKiBAcmV0dXJucyB7Qm9vbGVhbn1cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoU0lQKSB7XG4gICAgdmFyIHNhbml0eUNoZWNrLCByZXF1ZXN0cyA9IFtdLCByZXNwb25zZXMgPSBbXSwgYWxsID0gW107XG4gICAgLy8gUmVwbHlcbiAgICBmdW5jdGlvbiByZXBseShzdGF0dXNfY29kZSwgbWVzc2FnZSwgdHJhbnNwb3J0KSB7XG4gICAgICAgIHZhciB0bywgcmVzcG9uc2UgPSBTSVAuVXRpbHMuYnVpbGRTdGF0dXNMaW5lKHN0YXR1c19jb2RlKSwgdmlhcyA9IG1lc3NhZ2UuZ2V0SGVhZGVycygndmlhJyksIGxlbmd0aCA9IHZpYXMubGVuZ3RoLCBpZHggPSAwO1xuICAgICAgICBmb3IgKGlkeDsgaWR4IDwgbGVuZ3RoOyBpZHgrKykge1xuICAgICAgICAgICAgcmVzcG9uc2UgKz0gXCJWaWE6IFwiICsgdmlhc1tpZHhdICsgXCJcXHJcXG5cIjtcbiAgICAgICAgfVxuICAgICAgICB0byA9IG1lc3NhZ2UuZ2V0SGVhZGVyKCdUbycpO1xuICAgICAgICBpZiAoIW1lc3NhZ2UudG9fdGFnKSB7XG4gICAgICAgICAgICB0byArPSAnO3RhZz0nICsgU0lQLlV0aWxzLm5ld1RhZygpO1xuICAgICAgICB9XG4gICAgICAgIHJlc3BvbnNlICs9IFwiVG86IFwiICsgdG8gKyBcIlxcclxcblwiO1xuICAgICAgICByZXNwb25zZSArPSBcIkZyb206IFwiICsgbWVzc2FnZS5nZXRIZWFkZXIoJ0Zyb20nKSArIFwiXFxyXFxuXCI7XG4gICAgICAgIHJlc3BvbnNlICs9IFwiQ2FsbC1JRDogXCIgKyBtZXNzYWdlLmNhbGxfaWQgKyBcIlxcclxcblwiO1xuICAgICAgICByZXNwb25zZSArPSBcIkNTZXE6IFwiICsgbWVzc2FnZS5jc2VxICsgXCIgXCIgKyBtZXNzYWdlLm1ldGhvZCArIFwiXFxyXFxuXCI7XG4gICAgICAgIHJlc3BvbnNlICs9IFwiXFxyXFxuXCI7XG4gICAgICAgIHRyYW5zcG9ydC5zZW5kKHJlc3BvbnNlKTtcbiAgICB9XG4gICAgLypcbiAgICAgKiBTYW5pdHkgQ2hlY2sgZm9yIGluY29taW5nIE1lc3NhZ2VzXG4gICAgICpcbiAgICAgKiBSZXF1ZXN0czpcbiAgICAgKiAgLSBfcmZjMzI2MV84XzJfMl8xXyBSZWNlaXZlIGEgUmVxdWVzdCB3aXRoIGEgbm9uIHN1cHBvcnRlZCBVUkkgc2NoZW1lXG4gICAgICogIC0gX3JmYzMyNjFfMTZfM180XyBSZWNlaXZlIGEgUmVxdWVzdCBhbHJlYWR5IHNlbnQgYnkgdXNcbiAgICAgKiAgIERvZXMgbm90IGxvb2sgYXQgdmlhIHNlbnQtYnkgYnV0IGF0IHNpcGpzSWQsIHdoaWNoIGlzIGluc2VydGVkIGFzXG4gICAgICogICBhIHByZWZpeCBpbiBhbGwgaW5pdGlhbCByZXF1ZXN0cyBnZW5lcmF0ZWQgYnkgdGhlIHVhXG4gICAgICogIC0gX3JmYzMyNjFfMThfM19yZXF1ZXN0XyBCb2R5IENvbnRlbnQtTGVuZ3RoXG4gICAgICogIC0gX3JmYzMyNjFfOF8yXzJfMl8gTWVyZ2VkIFJlcXVlc3RzXG4gICAgICpcbiAgICAgKiBSZXNwb25zZXM6XG4gICAgICogIC0gX3JmYzMyNjFfOF8xXzNfM18gTXVsdGlwbGUgVmlhIGhlYWRlcnNcbiAgICAgKiAgLSBfcmZjMzI2MV8xOF8xXzJfIHNlbnQtYnkgbWlzbWF0Y2hcbiAgICAgKiAgLSBfcmZjMzI2MV8xOF8zX3Jlc3BvbnNlXyBCb2R5IENvbnRlbnQtTGVuZ3RoXG4gICAgICpcbiAgICAgKiBBbGw6XG4gICAgICogIC0gTWluaW11bSBoZWFkZXJzIGluIGEgU0lQIG1lc3NhZ2VcbiAgICAgKi9cbiAgICAvLyBTYW5pdHkgQ2hlY2sgZnVuY3Rpb25zIGZvciByZXF1ZXN0c1xuICAgIGZ1bmN0aW9uIHJmYzMyNjFfOF8yXzJfMShtZXNzYWdlLCB1YSwgdHJhbnNwb3J0KSB7XG4gICAgICAgIGlmICghbWVzc2FnZS5ydXJpIHx8IG1lc3NhZ2UucnVyaS5zY2hlbWUgIT09ICdzaXAnKSB7XG4gICAgICAgICAgICByZXBseSg0MTYsIG1lc3NhZ2UsIHRyYW5zcG9ydCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZnVuY3Rpb24gcmZjMzI2MV8xNl8zXzQobWVzc2FnZSwgdWEsIHRyYW5zcG9ydCkge1xuICAgICAgICBpZiAoIW1lc3NhZ2UudG9fdGFnKSB7XG4gICAgICAgICAgICBpZiAobWVzc2FnZS5jYWxsX2lkLnN1YnN0cigwLCA1KSA9PT0gdWEuY29uZmlndXJhdGlvbi5zaXBqc0lkKSB7XG4gICAgICAgICAgICAgICAgcmVwbHkoNDgyLCBtZXNzYWdlLCB0cmFuc3BvcnQpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBmdW5jdGlvbiByZmMzMjYxXzE4XzNfcmVxdWVzdChtZXNzYWdlLCB1YSwgdHJhbnNwb3J0KSB7XG4gICAgICAgIHZhciBsZW4gPSBTSVAuVXRpbHMuc3RyX3V0ZjhfbGVuZ3RoKG1lc3NhZ2UuYm9keSksIGNvbnRlbnRMZW5ndGggPSBtZXNzYWdlLmdldEhlYWRlcignY29udGVudC1sZW5ndGgnKTtcbiAgICAgICAgaWYgKGxlbiA8IGNvbnRlbnRMZW5ndGgpIHtcbiAgICAgICAgICAgIHJlcGx5KDQwMCwgbWVzc2FnZSwgdHJhbnNwb3J0KTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBmdW5jdGlvbiByZmMzMjYxXzhfMl8yXzIobWVzc2FnZSwgdWEsIHRyYW5zcG9ydCkge1xuICAgICAgICB2YXIgdHIsIGlkeCwgZnJvbVRhZyA9IG1lc3NhZ2UuZnJvbV90YWcsIGNhbGxfaWQgPSBtZXNzYWdlLmNhbGxfaWQsIGNzZXEgPSBtZXNzYWdlLmNzZXE7XG4gICAgICAgIGlmICghbWVzc2FnZS50b190YWcpIHtcbiAgICAgICAgICAgIGlmIChtZXNzYWdlLm1ldGhvZCA9PT0gU0lQLkMuSU5WSVRFKSB7XG4gICAgICAgICAgICAgICAgdHIgPSB1YS50cmFuc2FjdGlvbnMuaXN0W21lc3NhZ2UudmlhX2JyYW5jaF07XG4gICAgICAgICAgICAgICAgaWYgKHRyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoaWR4IGluIHVhLnRyYW5zYWN0aW9ucy5pc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyID0gdWEudHJhbnNhY3Rpb25zLmlzdFtpZHhdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRyLnJlcXVlc3QuZnJvbV90YWcgPT09IGZyb21UYWcgJiYgdHIucmVxdWVzdC5jYWxsX2lkID09PSBjYWxsX2lkICYmIHRyLnJlcXVlc3QuY3NlcSA9PT0gY3NlcSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGx5KDQ4MiwgbWVzc2FnZSwgdHJhbnNwb3J0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0ciA9IHVhLnRyYW5zYWN0aW9ucy5uaXN0W21lc3NhZ2UudmlhX2JyYW5jaF07XG4gICAgICAgICAgICAgICAgaWYgKHRyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoaWR4IGluIHVhLnRyYW5zYWN0aW9ucy5uaXN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ciA9IHVhLnRyYW5zYWN0aW9ucy5uaXN0W2lkeF07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHIucmVxdWVzdC5mcm9tX3RhZyA9PT0gZnJvbVRhZyAmJiB0ci5yZXF1ZXN0LmNhbGxfaWQgPT09IGNhbGxfaWQgJiYgdHIucmVxdWVzdC5jc2VxID09PSBjc2VxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwbHkoNDgyLCBtZXNzYWdlLCB0cmFuc3BvcnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyBTYW5pdHkgQ2hlY2sgZnVuY3Rpb25zIGZvciByZXNwb25zZXNcbiAgICBmdW5jdGlvbiByZmMzMjYxXzhfMV8zXzMobWVzc2FnZSwgdWEpIHtcbiAgICAgICAgaWYgKG1lc3NhZ2UuZ2V0SGVhZGVycygndmlhJykubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgdWEuZ2V0TG9nZ2VyKCdzaXAuc2FuaXR5Y2hlY2snKS53YXJuKCdNb3JlIHRoYW4gb25lIFZpYSBoZWFkZXIgZmllbGQgcHJlc2VudCBpbiB0aGUgcmVzcG9uc2UuIERyb3BwaW5nIHRoZSByZXNwb25zZScpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGZ1bmN0aW9uIHJmYzMyNjFfMThfMV8yKG1lc3NhZ2UsIHVhKSB7XG4gICAgICAgIHZhciB2aWFIb3N0ID0gdWEuY29uZmlndXJhdGlvbi52aWFIb3N0O1xuICAgICAgICBpZiAobWVzc2FnZS52aWEuaG9zdCAhPT0gdmlhSG9zdCB8fCBtZXNzYWdlLnZpYS5wb3J0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHVhLmdldExvZ2dlcignc2lwLnNhbml0eWNoZWNrJykud2FybignVmlhIHNlbnQtYnkgaW4gdGhlIHJlc3BvbnNlIGRvZXMgbm90IG1hdGNoIFVBIFZpYSBob3N0IHZhbHVlLiBEcm9wcGluZyB0aGUgcmVzcG9uc2UnKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBmdW5jdGlvbiByZmMzMjYxXzE4XzNfcmVzcG9uc2UobWVzc2FnZSwgdWEpIHtcbiAgICAgICAgdmFyIGxlbiA9IFNJUC5VdGlscy5zdHJfdXRmOF9sZW5ndGgobWVzc2FnZS5ib2R5KSwgY29udGVudExlbmd0aCA9IG1lc3NhZ2UuZ2V0SGVhZGVyKCdjb250ZW50LWxlbmd0aCcpO1xuICAgICAgICBpZiAobGVuIDwgY29udGVudExlbmd0aCkge1xuICAgICAgICAgICAgdWEuZ2V0TG9nZ2VyKCdzaXAuc2FuaXR5Y2hlY2snKS53YXJuKCdNZXNzYWdlIGJvZHkgbGVuZ3RoIGlzIGxvd2VyIHRoYW4gdGhlIHZhbHVlIGluIENvbnRlbnQtTGVuZ3RoIGhlYWRlciBmaWVsZC4gRHJvcHBpbmcgdGhlIHJlc3BvbnNlJyk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gU2FuaXR5IENoZWNrIGZ1bmN0aW9ucyBmb3IgcmVxdWVzdHMgYW5kIHJlc3BvbnNlc1xuICAgIGZ1bmN0aW9uIG1pbmltdW1IZWFkZXJzKG1lc3NhZ2UsIHVhKSB7XG4gICAgICAgIHZhciBtYW5kYXRvcnlIZWFkZXJzID0gWydmcm9tJywgJ3RvJywgJ2NhbGxfaWQnLCAnY3NlcScsICd2aWEnXSwgaWR4ID0gbWFuZGF0b3J5SGVhZGVycy5sZW5ndGg7XG4gICAgICAgIHdoaWxlIChpZHgtLSkge1xuICAgICAgICAgICAgaWYgKCFtZXNzYWdlLmhhc0hlYWRlcihtYW5kYXRvcnlIZWFkZXJzW2lkeF0pKSB7XG4gICAgICAgICAgICAgICAgdWEuZ2V0TG9nZ2VyKCdzaXAuc2FuaXR5Y2hlY2snKS53YXJuKCdNaXNzaW5nIG1hbmRhdG9yeSBoZWFkZXIgZmllbGQgOiAnICsgbWFuZGF0b3J5SGVhZGVyc1tpZHhdICsgJy4gRHJvcHBpbmcgdGhlIHJlc3BvbnNlJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJlcXVlc3RzLnB1c2gocmZjMzI2MV84XzJfMl8xKTtcbiAgICByZXF1ZXN0cy5wdXNoKHJmYzMyNjFfMTZfM180KTtcbiAgICByZXF1ZXN0cy5wdXNoKHJmYzMyNjFfMThfM19yZXF1ZXN0KTtcbiAgICByZXF1ZXN0cy5wdXNoKHJmYzMyNjFfOF8yXzJfMik7XG4gICAgcmVzcG9uc2VzLnB1c2gocmZjMzI2MV84XzFfM18zKTtcbiAgICByZXNwb25zZXMucHVzaChyZmMzMjYxXzE4XzFfMik7XG4gICAgcmVzcG9uc2VzLnB1c2gocmZjMzI2MV8xOF8zX3Jlc3BvbnNlKTtcbiAgICBhbGwucHVzaChtaW5pbXVtSGVhZGVycyk7XG4gICAgc2FuaXR5Q2hlY2sgPSBmdW5jdGlvbiAobWVzc2FnZSwgdWEsIHRyYW5zcG9ydCkge1xuICAgICAgICB2YXIgbGVuLCBwYXNzO1xuICAgICAgICBsZW4gPSBhbGwubGVuZ3RoO1xuICAgICAgICB3aGlsZSAobGVuLS0pIHtcbiAgICAgICAgICAgIHBhc3MgPSBhbGxbbGVuXShtZXNzYWdlLCB1YSwgdHJhbnNwb3J0KTtcbiAgICAgICAgICAgIGlmIChwYXNzID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAobWVzc2FnZSBpbnN0YW5jZW9mIFNJUC5JbmNvbWluZ1JlcXVlc3QpIHtcbiAgICAgICAgICAgIGxlbiA9IHJlcXVlc3RzLmxlbmd0aDtcbiAgICAgICAgICAgIHdoaWxlIChsZW4tLSkge1xuICAgICAgICAgICAgICAgIHBhc3MgPSByZXF1ZXN0c1tsZW5dKG1lc3NhZ2UsIHVhLCB0cmFuc3BvcnQpO1xuICAgICAgICAgICAgICAgIGlmIChwYXNzID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG1lc3NhZ2UgaW5zdGFuY2VvZiBTSVAuSW5jb21pbmdSZXNwb25zZSkge1xuICAgICAgICAgICAgbGVuID0gcmVzcG9uc2VzLmxlbmd0aDtcbiAgICAgICAgICAgIHdoaWxlIChsZW4tLSkge1xuICAgICAgICAgICAgICAgIHBhc3MgPSByZXNwb25zZXNbbGVuXShtZXNzYWdlLCB1YSwgdHJhbnNwb3J0KTtcbiAgICAgICAgICAgICAgICBpZiAocGFzcyA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvL0V2ZXJ5dGhpbmcgaXMgT0tcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfTtcbiAgICBTSVAuc2FuaXR5Q2hlY2sgPSBzYW5pdHlDaGVjaztcbn07XG5cblxuLyoqKi8gfSksXG4vKiAzMyAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cInVzZSBzdHJpY3RcIjtcblxudmFyIG1kNSA9IF9fd2VicGFja19yZXF1aXJlX18oMzQpO1xuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IFNJUCBEaWdlc3QgQXV0aGVudGljYXRpb25cbiAqL1xuLyoqXG4gKiBTSVAgRGlnZXN0IEF1dGhlbnRpY2F0aW9uLlxuICogQGF1Z21lbnRzIFNJUC5cbiAqIEBmdW5jdGlvbiBEaWdlc3QgQXV0aGVudGljYXRpb25cbiAqIEBwYXJhbSB7U0lQLlVBfSB1YVxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChVdGlscykge1xuICAgIHZhciBEaWdlc3RBdXRoZW50aWNhdGlvbjtcbiAgICBEaWdlc3RBdXRoZW50aWNhdGlvbiA9IGZ1bmN0aW9uICh1YSkge1xuICAgICAgICB0aGlzLmxvZ2dlciA9IHVhLmdldExvZ2dlcignc2lwanMuZGlnZXN0YXV0aGVudGljYXRpb24nKTtcbiAgICAgICAgdGhpcy51c2VybmFtZSA9IHVhLmNvbmZpZ3VyYXRpb24uYXV0aG9yaXphdGlvblVzZXI7XG4gICAgICAgIHRoaXMucGFzc3dvcmQgPSB1YS5jb25maWd1cmF0aW9uLnBhc3N3b3JkO1xuICAgICAgICB0aGlzLmNub25jZSA9IG51bGw7XG4gICAgICAgIHRoaXMubmMgPSAwO1xuICAgICAgICB0aGlzLm5jSGV4ID0gJzAwMDAwMDAwJztcbiAgICAgICAgdGhpcy5yZXNwb25zZSA9IG51bGw7XG4gICAgfTtcbiAgICAvKipcbiAgICAqIFBlcmZvcm1zIERpZ2VzdCBhdXRoZW50aWNhdGlvbiBnaXZlbiBhIFNJUCByZXF1ZXN0IGFuZCB0aGUgY2hhbGxlbmdlXG4gICAgKiByZWNlaXZlZCBpbiBhIHJlc3BvbnNlIHRvIHRoYXQgcmVxdWVzdC5cbiAgICAqIFJldHVybnMgdHJ1ZSBpZiBjcmVkZW50aWFscyB3ZXJlIHN1Y2Nlc3NmdWxseSBnZW5lcmF0ZWQsIGZhbHNlIG90aGVyd2lzZS5cbiAgICAqXG4gICAgKiBAcGFyYW0ge1NJUC5PdXRnb2luZ1JlcXVlc3R9IHJlcXVlc3RcbiAgICAqIEBwYXJhbSB7T2JqZWN0fSBjaGFsbGVuZ2VcbiAgICAqL1xuICAgIERpZ2VzdEF1dGhlbnRpY2F0aW9uLnByb3RvdHlwZS5hdXRoZW50aWNhdGUgPSBmdW5jdGlvbiAocmVxdWVzdCwgY2hhbGxlbmdlKSB7XG4gICAgICAgIC8vIEluc3BlY3QgYW5kIHZhbGlkYXRlIHRoZSBjaGFsbGVuZ2UuXG4gICAgICAgIHRoaXMuYWxnb3JpdGhtID0gY2hhbGxlbmdlLmFsZ29yaXRobTtcbiAgICAgICAgdGhpcy5yZWFsbSA9IGNoYWxsZW5nZS5yZWFsbTtcbiAgICAgICAgdGhpcy5ub25jZSA9IGNoYWxsZW5nZS5ub25jZTtcbiAgICAgICAgdGhpcy5vcGFxdWUgPSBjaGFsbGVuZ2Uub3BhcXVlO1xuICAgICAgICB0aGlzLnN0YWxlID0gY2hhbGxlbmdlLnN0YWxlO1xuICAgICAgICBpZiAodGhpcy5hbGdvcml0aG0pIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmFsZ29yaXRobSAhPT0gJ01ENScpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuKCdjaGFsbGVuZ2Ugd2l0aCBEaWdlc3QgYWxnb3JpdGhtIGRpZmZlcmVudCB0aGFuIFwiTUQ1XCIsIGF1dGhlbnRpY2F0aW9uIGFib3J0ZWQnKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmFsZ29yaXRobSA9ICdNRDUnO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5yZWFsbSkge1xuICAgICAgICAgICAgdGhpcy5sb2dnZXIud2FybignY2hhbGxlbmdlIHdpdGhvdXQgRGlnZXN0IHJlYWxtLCBhdXRoZW50aWNhdGlvbiBhYm9ydGVkJyk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLm5vbmNlKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuKCdjaGFsbGVuZ2Ugd2l0aG91dCBEaWdlc3Qgbm9uY2UsIGF1dGhlbnRpY2F0aW9uIGFib3J0ZWQnKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICAvLyAncW9wJyBjYW4gY29udGFpbiBhIGxpc3Qgb2YgdmFsdWVzIChBcnJheSkuIExldCdzIGNob29zZSBqdXN0IG9uZS5cbiAgICAgICAgaWYgKGNoYWxsZW5nZS5xb3ApIHtcbiAgICAgICAgICAgIGlmIChjaGFsbGVuZ2UucW9wLmluZGV4T2YoJ2F1dGgnKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5xb3AgPSAnYXV0aCc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjaGFsbGVuZ2UucW9wLmluZGV4T2YoJ2F1dGgtaW50JykgPiAtMSkge1xuICAgICAgICAgICAgICAgIHRoaXMucW9wID0gJ2F1dGgtaW50JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSAncW9wJyBpcyBwcmVzZW50IGJ1dCBkb2VzIG5vdCBjb250YWluICdhdXRoJyBvciAnYXV0aC1pbnQnLCBzbyBhYm9ydCBoZXJlLlxuICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ2NoYWxsZW5nZSB3aXRob3V0IERpZ2VzdCBxb3AgZGlmZmVyZW50IHRoYW4gXCJhdXRoXCIgb3IgXCJhdXRoLWludFwiLCBhdXRoZW50aWNhdGlvbiBhYm9ydGVkJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5xb3AgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIC8vIEZpbGwgb3RoZXIgYXR0cmlidXRlcy5cbiAgICAgICAgdGhpcy5tZXRob2QgPSByZXF1ZXN0Lm1ldGhvZDtcbiAgICAgICAgdGhpcy51cmkgPSByZXF1ZXN0LnJ1cmk7XG4gICAgICAgIHRoaXMuY25vbmNlID0gVXRpbHMuY3JlYXRlUmFuZG9tVG9rZW4oMTIpO1xuICAgICAgICB0aGlzLm5jICs9IDE7XG4gICAgICAgIHRoaXMudXBkYXRlTmNIZXgoKTtcbiAgICAgICAgLy8gbmMtdmFsdWUgPSA4TEhFWC4gTWF4IHZhbHVlID0gJ0ZGRkZGRkZGJy5cbiAgICAgICAgaWYgKHRoaXMubmMgPT09IDQyOTQ5NjcyOTYpIHtcbiAgICAgICAgICAgIHRoaXMubmMgPSAxO1xuICAgICAgICAgICAgdGhpcy5uY0hleCA9ICcwMDAwMDAwMSc7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBEaWdlc3QgXCJyZXNwb25zZVwiIHZhbHVlLlxuICAgICAgICB0aGlzLmNhbGN1bGF0ZVJlc3BvbnNlKCk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG4gICAgLyoqXG4gICAgKiBHZW5lcmF0ZSBEaWdlc3QgJ3Jlc3BvbnNlJyB2YWx1ZS5cbiAgICAqIEBwcml2YXRlXG4gICAgKi9cbiAgICBEaWdlc3RBdXRoZW50aWNhdGlvbi5wcm90b3R5cGUuY2FsY3VsYXRlUmVzcG9uc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBoYTEsIGhhMjtcbiAgICAgICAgLy8gSEExID0gTUQ1KEExKSA9IE1ENSh1c2VybmFtZTpyZWFsbTpwYXNzd29yZClcbiAgICAgICAgaGExID0gbWQ1KHRoaXMudXNlcm5hbWUgKyBcIjpcIiArIHRoaXMucmVhbG0gKyBcIjpcIiArIHRoaXMucGFzc3dvcmQpO1xuICAgICAgICBpZiAodGhpcy5xb3AgPT09ICdhdXRoJykge1xuICAgICAgICAgICAgLy8gSEEyID0gTUQ1KEEyKSA9IE1ENShtZXRob2Q6ZGlnZXN0VVJJKVxuICAgICAgICAgICAgaGEyID0gbWQ1KHRoaXMubWV0aG9kICsgXCI6XCIgKyB0aGlzLnVyaSk7XG4gICAgICAgICAgICAvLyByZXNwb25zZSA9IE1ENShIQTE6bm9uY2U6bm9uY2VDb3VudDpjcmVkZW50aWFsc05vbmNlOnFvcDpIQTIpXG4gICAgICAgICAgICB0aGlzLnJlc3BvbnNlID0gbWQ1KGhhMSArIFwiOlwiICsgdGhpcy5ub25jZSArIFwiOlwiICsgdGhpcy5uY0hleCArIFwiOlwiICsgdGhpcy5jbm9uY2UgKyBcIjphdXRoOlwiICsgaGEyKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLnFvcCA9PT0gJ2F1dGgtaW50Jykge1xuICAgICAgICAgICAgLy8gSEEyID0gTUQ1KEEyKSA9IE1ENShtZXRob2Q6ZGlnZXN0VVJJOk1ENShlbnRpdHlCb2R5KSlcbiAgICAgICAgICAgIGhhMiA9IG1kNSh0aGlzLm1ldGhvZCArIFwiOlwiICsgdGhpcy51cmkgKyBcIjpcIiArIG1kNSh0aGlzLmJvZHkgPyB0aGlzLmJvZHkgOiBcIlwiKSk7XG4gICAgICAgICAgICAvLyByZXNwb25zZSA9IE1ENShIQTE6bm9uY2U6bm9uY2VDb3VudDpjcmVkZW50aWFsc05vbmNlOnFvcDpIQTIpXG4gICAgICAgICAgICB0aGlzLnJlc3BvbnNlID0gbWQ1KGhhMSArIFwiOlwiICsgdGhpcy5ub25jZSArIFwiOlwiICsgdGhpcy5uY0hleCArIFwiOlwiICsgdGhpcy5jbm9uY2UgKyBcIjphdXRoLWludDpcIiArIGhhMik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5xb3AgPT09IG51bGwpIHtcbiAgICAgICAgICAgIC8vIEhBMiA9IE1ENShBMikgPSBNRDUobWV0aG9kOmRpZ2VzdFVSSSlcbiAgICAgICAgICAgIGhhMiA9IG1kNSh0aGlzLm1ldGhvZCArIFwiOlwiICsgdGhpcy51cmkpO1xuICAgICAgICAgICAgLy8gcmVzcG9uc2UgPSBNRDUoSEExOm5vbmNlOkhBMilcbiAgICAgICAgICAgIHRoaXMucmVzcG9uc2UgPSBtZDUoaGExICsgXCI6XCIgKyB0aGlzLm5vbmNlICsgXCI6XCIgKyBoYTIpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICAvKipcbiAgICAqIFJldHVybiB0aGUgUHJveHktQXV0aG9yaXphdGlvbiBvciBXV1ctQXV0aG9yaXphdGlvbiBoZWFkZXIgdmFsdWUuXG4gICAgKi9cbiAgICBEaWdlc3RBdXRoZW50aWNhdGlvbi5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBhdXRoX3BhcmFtcyA9IFtdO1xuICAgICAgICBpZiAoIXRoaXMucmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigncmVzcG9uc2UgZmllbGQgZG9lcyBub3QgZXhpc3QsIGNhbm5vdCBnZW5lcmF0ZSBBdXRob3JpemF0aW9uIGhlYWRlcicpO1xuICAgICAgICB9XG4gICAgICAgIGF1dGhfcGFyYW1zLnB1c2goJ2FsZ29yaXRobT0nICsgdGhpcy5hbGdvcml0aG0pO1xuICAgICAgICBhdXRoX3BhcmFtcy5wdXNoKCd1c2VybmFtZT1cIicgKyB0aGlzLnVzZXJuYW1lICsgJ1wiJyk7XG4gICAgICAgIGF1dGhfcGFyYW1zLnB1c2goJ3JlYWxtPVwiJyArIHRoaXMucmVhbG0gKyAnXCInKTtcbiAgICAgICAgYXV0aF9wYXJhbXMucHVzaCgnbm9uY2U9XCInICsgdGhpcy5ub25jZSArICdcIicpO1xuICAgICAgICBhdXRoX3BhcmFtcy5wdXNoKCd1cmk9XCInICsgdGhpcy51cmkgKyAnXCInKTtcbiAgICAgICAgYXV0aF9wYXJhbXMucHVzaCgncmVzcG9uc2U9XCInICsgdGhpcy5yZXNwb25zZSArICdcIicpO1xuICAgICAgICBpZiAodGhpcy5vcGFxdWUpIHtcbiAgICAgICAgICAgIGF1dGhfcGFyYW1zLnB1c2goJ29wYXF1ZT1cIicgKyB0aGlzLm9wYXF1ZSArICdcIicpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnFvcCkge1xuICAgICAgICAgICAgYXV0aF9wYXJhbXMucHVzaCgncW9wPScgKyB0aGlzLnFvcCk7XG4gICAgICAgICAgICBhdXRoX3BhcmFtcy5wdXNoKCdjbm9uY2U9XCInICsgdGhpcy5jbm9uY2UgKyAnXCInKTtcbiAgICAgICAgICAgIGF1dGhfcGFyYW1zLnB1c2goJ25jPScgKyB0aGlzLm5jSGV4KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gJ0RpZ2VzdCAnICsgYXV0aF9wYXJhbXMuam9pbignLCAnKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICogR2VuZXJhdGUgdGhlICduYycgdmFsdWUgYXMgcmVxdWlyZWQgYnkgRGlnZXN0IGluIHRoaXMubmNIZXggYnkgcmVhZGluZyB0aGlzLm5jLlxuICAgICogQHByaXZhdGVcbiAgICAqL1xuICAgIERpZ2VzdEF1dGhlbnRpY2F0aW9uLnByb3RvdHlwZS51cGRhdGVOY0hleCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGhleCA9IE51bWJlcih0aGlzLm5jKS50b1N0cmluZygxNik7XG4gICAgICAgIHRoaXMubmNIZXggPSAnMDAwMDAwMDAnLnN1YnN0cigwLCA4IC0gaGV4Lmxlbmd0aCkgKyBoZXg7XG4gICAgfTtcbiAgICByZXR1cm4gRGlnZXN0QXV0aGVudGljYXRpb247XG59O1xuXG5cbi8qKiovIH0pLFxuLyogMzQgKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuOyhmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkge1xuXHRpZiAodHJ1ZSkge1xuXHRcdC8vIENvbW1vbkpTXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzID0gZmFjdG9yeShfX3dlYnBhY2tfcmVxdWlyZV9fKDM1KSk7XG5cdH1cblx0ZWxzZSB7fVxufSh0aGlzLCBmdW5jdGlvbiAoQ3J5cHRvSlMpIHtcblxuXHQoZnVuY3Rpb24gKE1hdGgpIHtcblx0ICAgIC8vIFNob3J0Y3V0c1xuXHQgICAgdmFyIEMgPSBDcnlwdG9KUztcblx0ICAgIHZhciBDX2xpYiA9IEMubGliO1xuXHQgICAgdmFyIFdvcmRBcnJheSA9IENfbGliLldvcmRBcnJheTtcblx0ICAgIHZhciBIYXNoZXIgPSBDX2xpYi5IYXNoZXI7XG5cdCAgICB2YXIgQ19hbGdvID0gQy5hbGdvO1xuXG5cdCAgICAvLyBDb25zdGFudHMgdGFibGVcblx0ICAgIHZhciBUID0gW107XG5cblx0ICAgIC8vIENvbXB1dGUgY29uc3RhbnRzXG5cdCAgICAoZnVuY3Rpb24gKCkge1xuXHQgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNjQ7IGkrKykge1xuXHQgICAgICAgICAgICBUW2ldID0gKE1hdGguYWJzKE1hdGguc2luKGkgKyAxKSkgKiAweDEwMDAwMDAwMCkgfCAwO1xuXHQgICAgICAgIH1cblx0ICAgIH0oKSk7XG5cblx0ICAgIC8qKlxuXHQgICAgICogTUQ1IGhhc2ggYWxnb3JpdGhtLlxuXHQgICAgICovXG5cdCAgICB2YXIgTUQ1ID0gQ19hbGdvLk1ENSA9IEhhc2hlci5leHRlbmQoe1xuXHQgICAgICAgIF9kb1Jlc2V0OiBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICAgIHRoaXMuX2hhc2ggPSBuZXcgV29yZEFycmF5LmluaXQoW1xuXHQgICAgICAgICAgICAgICAgMHg2NzQ1MjMwMSwgMHhlZmNkYWI4OSxcblx0ICAgICAgICAgICAgICAgIDB4OThiYWRjZmUsIDB4MTAzMjU0NzZcblx0ICAgICAgICAgICAgXSk7XG5cdCAgICAgICAgfSxcblxuXHQgICAgICAgIF9kb1Byb2Nlc3NCbG9jazogZnVuY3Rpb24gKE0sIG9mZnNldCkge1xuXHQgICAgICAgICAgICAvLyBTd2FwIGVuZGlhblxuXHQgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDE2OyBpKyspIHtcblx0ICAgICAgICAgICAgICAgIC8vIFNob3J0Y3V0c1xuXHQgICAgICAgICAgICAgICAgdmFyIG9mZnNldF9pID0gb2Zmc2V0ICsgaTtcblx0ICAgICAgICAgICAgICAgIHZhciBNX29mZnNldF9pID0gTVtvZmZzZXRfaV07XG5cblx0ICAgICAgICAgICAgICAgIE1bb2Zmc2V0X2ldID0gKFxuXHQgICAgICAgICAgICAgICAgICAgICgoKE1fb2Zmc2V0X2kgPDwgOCkgIHwgKE1fb2Zmc2V0X2kgPj4+IDI0KSkgJiAweDAwZmYwMGZmKSB8XG5cdCAgICAgICAgICAgICAgICAgICAgKCgoTV9vZmZzZXRfaSA8PCAyNCkgfCAoTV9vZmZzZXRfaSA+Pj4gOCkpICAmIDB4ZmYwMGZmMDApXG5cdCAgICAgICAgICAgICAgICApO1xuXHQgICAgICAgICAgICB9XG5cblx0ICAgICAgICAgICAgLy8gU2hvcnRjdXRzXG5cdCAgICAgICAgICAgIHZhciBIID0gdGhpcy5faGFzaC53b3JkcztcblxuXHQgICAgICAgICAgICB2YXIgTV9vZmZzZXRfMCAgPSBNW29mZnNldCArIDBdO1xuXHQgICAgICAgICAgICB2YXIgTV9vZmZzZXRfMSAgPSBNW29mZnNldCArIDFdO1xuXHQgICAgICAgICAgICB2YXIgTV9vZmZzZXRfMiAgPSBNW29mZnNldCArIDJdO1xuXHQgICAgICAgICAgICB2YXIgTV9vZmZzZXRfMyAgPSBNW29mZnNldCArIDNdO1xuXHQgICAgICAgICAgICB2YXIgTV9vZmZzZXRfNCAgPSBNW29mZnNldCArIDRdO1xuXHQgICAgICAgICAgICB2YXIgTV9vZmZzZXRfNSAgPSBNW29mZnNldCArIDVdO1xuXHQgICAgICAgICAgICB2YXIgTV9vZmZzZXRfNiAgPSBNW29mZnNldCArIDZdO1xuXHQgICAgICAgICAgICB2YXIgTV9vZmZzZXRfNyAgPSBNW29mZnNldCArIDddO1xuXHQgICAgICAgICAgICB2YXIgTV9vZmZzZXRfOCAgPSBNW29mZnNldCArIDhdO1xuXHQgICAgICAgICAgICB2YXIgTV9vZmZzZXRfOSAgPSBNW29mZnNldCArIDldO1xuXHQgICAgICAgICAgICB2YXIgTV9vZmZzZXRfMTAgPSBNW29mZnNldCArIDEwXTtcblx0ICAgICAgICAgICAgdmFyIE1fb2Zmc2V0XzExID0gTVtvZmZzZXQgKyAxMV07XG5cdCAgICAgICAgICAgIHZhciBNX29mZnNldF8xMiA9IE1bb2Zmc2V0ICsgMTJdO1xuXHQgICAgICAgICAgICB2YXIgTV9vZmZzZXRfMTMgPSBNW29mZnNldCArIDEzXTtcblx0ICAgICAgICAgICAgdmFyIE1fb2Zmc2V0XzE0ID0gTVtvZmZzZXQgKyAxNF07XG5cdCAgICAgICAgICAgIHZhciBNX29mZnNldF8xNSA9IE1bb2Zmc2V0ICsgMTVdO1xuXG5cdCAgICAgICAgICAgIC8vIFdvcmtpbmcgdmFyaWFsYmVzXG5cdCAgICAgICAgICAgIHZhciBhID0gSFswXTtcblx0ICAgICAgICAgICAgdmFyIGIgPSBIWzFdO1xuXHQgICAgICAgICAgICB2YXIgYyA9IEhbMl07XG5cdCAgICAgICAgICAgIHZhciBkID0gSFszXTtcblxuXHQgICAgICAgICAgICAvLyBDb21wdXRhdGlvblxuXHQgICAgICAgICAgICBhID0gRkYoYSwgYiwgYywgZCwgTV9vZmZzZXRfMCwgIDcsICBUWzBdKTtcblx0ICAgICAgICAgICAgZCA9IEZGKGQsIGEsIGIsIGMsIE1fb2Zmc2V0XzEsICAxMiwgVFsxXSk7XG5cdCAgICAgICAgICAgIGMgPSBGRihjLCBkLCBhLCBiLCBNX29mZnNldF8yLCAgMTcsIFRbMl0pO1xuXHQgICAgICAgICAgICBiID0gRkYoYiwgYywgZCwgYSwgTV9vZmZzZXRfMywgIDIyLCBUWzNdKTtcblx0ICAgICAgICAgICAgYSA9IEZGKGEsIGIsIGMsIGQsIE1fb2Zmc2V0XzQsICA3LCAgVFs0XSk7XG5cdCAgICAgICAgICAgIGQgPSBGRihkLCBhLCBiLCBjLCBNX29mZnNldF81LCAgMTIsIFRbNV0pO1xuXHQgICAgICAgICAgICBjID0gRkYoYywgZCwgYSwgYiwgTV9vZmZzZXRfNiwgIDE3LCBUWzZdKTtcblx0ICAgICAgICAgICAgYiA9IEZGKGIsIGMsIGQsIGEsIE1fb2Zmc2V0XzcsICAyMiwgVFs3XSk7XG5cdCAgICAgICAgICAgIGEgPSBGRihhLCBiLCBjLCBkLCBNX29mZnNldF84LCAgNywgIFRbOF0pO1xuXHQgICAgICAgICAgICBkID0gRkYoZCwgYSwgYiwgYywgTV9vZmZzZXRfOSwgIDEyLCBUWzldKTtcblx0ICAgICAgICAgICAgYyA9IEZGKGMsIGQsIGEsIGIsIE1fb2Zmc2V0XzEwLCAxNywgVFsxMF0pO1xuXHQgICAgICAgICAgICBiID0gRkYoYiwgYywgZCwgYSwgTV9vZmZzZXRfMTEsIDIyLCBUWzExXSk7XG5cdCAgICAgICAgICAgIGEgPSBGRihhLCBiLCBjLCBkLCBNX29mZnNldF8xMiwgNywgIFRbMTJdKTtcblx0ICAgICAgICAgICAgZCA9IEZGKGQsIGEsIGIsIGMsIE1fb2Zmc2V0XzEzLCAxMiwgVFsxM10pO1xuXHQgICAgICAgICAgICBjID0gRkYoYywgZCwgYSwgYiwgTV9vZmZzZXRfMTQsIDE3LCBUWzE0XSk7XG5cdCAgICAgICAgICAgIGIgPSBGRihiLCBjLCBkLCBhLCBNX29mZnNldF8xNSwgMjIsIFRbMTVdKTtcblxuXHQgICAgICAgICAgICBhID0gR0coYSwgYiwgYywgZCwgTV9vZmZzZXRfMSwgIDUsICBUWzE2XSk7XG5cdCAgICAgICAgICAgIGQgPSBHRyhkLCBhLCBiLCBjLCBNX29mZnNldF82LCAgOSwgIFRbMTddKTtcblx0ICAgICAgICAgICAgYyA9IEdHKGMsIGQsIGEsIGIsIE1fb2Zmc2V0XzExLCAxNCwgVFsxOF0pO1xuXHQgICAgICAgICAgICBiID0gR0coYiwgYywgZCwgYSwgTV9vZmZzZXRfMCwgIDIwLCBUWzE5XSk7XG5cdCAgICAgICAgICAgIGEgPSBHRyhhLCBiLCBjLCBkLCBNX29mZnNldF81LCAgNSwgIFRbMjBdKTtcblx0ICAgICAgICAgICAgZCA9IEdHKGQsIGEsIGIsIGMsIE1fb2Zmc2V0XzEwLCA5LCAgVFsyMV0pO1xuXHQgICAgICAgICAgICBjID0gR0coYywgZCwgYSwgYiwgTV9vZmZzZXRfMTUsIDE0LCBUWzIyXSk7XG5cdCAgICAgICAgICAgIGIgPSBHRyhiLCBjLCBkLCBhLCBNX29mZnNldF80LCAgMjAsIFRbMjNdKTtcblx0ICAgICAgICAgICAgYSA9IEdHKGEsIGIsIGMsIGQsIE1fb2Zmc2V0XzksICA1LCAgVFsyNF0pO1xuXHQgICAgICAgICAgICBkID0gR0coZCwgYSwgYiwgYywgTV9vZmZzZXRfMTQsIDksICBUWzI1XSk7XG5cdCAgICAgICAgICAgIGMgPSBHRyhjLCBkLCBhLCBiLCBNX29mZnNldF8zLCAgMTQsIFRbMjZdKTtcblx0ICAgICAgICAgICAgYiA9IEdHKGIsIGMsIGQsIGEsIE1fb2Zmc2V0XzgsICAyMCwgVFsyN10pO1xuXHQgICAgICAgICAgICBhID0gR0coYSwgYiwgYywgZCwgTV9vZmZzZXRfMTMsIDUsICBUWzI4XSk7XG5cdCAgICAgICAgICAgIGQgPSBHRyhkLCBhLCBiLCBjLCBNX29mZnNldF8yLCAgOSwgIFRbMjldKTtcblx0ICAgICAgICAgICAgYyA9IEdHKGMsIGQsIGEsIGIsIE1fb2Zmc2V0XzcsICAxNCwgVFszMF0pO1xuXHQgICAgICAgICAgICBiID0gR0coYiwgYywgZCwgYSwgTV9vZmZzZXRfMTIsIDIwLCBUWzMxXSk7XG5cblx0ICAgICAgICAgICAgYSA9IEhIKGEsIGIsIGMsIGQsIE1fb2Zmc2V0XzUsICA0LCAgVFszMl0pO1xuXHQgICAgICAgICAgICBkID0gSEgoZCwgYSwgYiwgYywgTV9vZmZzZXRfOCwgIDExLCBUWzMzXSk7XG5cdCAgICAgICAgICAgIGMgPSBISChjLCBkLCBhLCBiLCBNX29mZnNldF8xMSwgMTYsIFRbMzRdKTtcblx0ICAgICAgICAgICAgYiA9IEhIKGIsIGMsIGQsIGEsIE1fb2Zmc2V0XzE0LCAyMywgVFszNV0pO1xuXHQgICAgICAgICAgICBhID0gSEgoYSwgYiwgYywgZCwgTV9vZmZzZXRfMSwgIDQsICBUWzM2XSk7XG5cdCAgICAgICAgICAgIGQgPSBISChkLCBhLCBiLCBjLCBNX29mZnNldF80LCAgMTEsIFRbMzddKTtcblx0ICAgICAgICAgICAgYyA9IEhIKGMsIGQsIGEsIGIsIE1fb2Zmc2V0XzcsICAxNiwgVFszOF0pO1xuXHQgICAgICAgICAgICBiID0gSEgoYiwgYywgZCwgYSwgTV9vZmZzZXRfMTAsIDIzLCBUWzM5XSk7XG5cdCAgICAgICAgICAgIGEgPSBISChhLCBiLCBjLCBkLCBNX29mZnNldF8xMywgNCwgIFRbNDBdKTtcblx0ICAgICAgICAgICAgZCA9IEhIKGQsIGEsIGIsIGMsIE1fb2Zmc2V0XzAsICAxMSwgVFs0MV0pO1xuXHQgICAgICAgICAgICBjID0gSEgoYywgZCwgYSwgYiwgTV9vZmZzZXRfMywgIDE2LCBUWzQyXSk7XG5cdCAgICAgICAgICAgIGIgPSBISChiLCBjLCBkLCBhLCBNX29mZnNldF82LCAgMjMsIFRbNDNdKTtcblx0ICAgICAgICAgICAgYSA9IEhIKGEsIGIsIGMsIGQsIE1fb2Zmc2V0XzksICA0LCAgVFs0NF0pO1xuXHQgICAgICAgICAgICBkID0gSEgoZCwgYSwgYiwgYywgTV9vZmZzZXRfMTIsIDExLCBUWzQ1XSk7XG5cdCAgICAgICAgICAgIGMgPSBISChjLCBkLCBhLCBiLCBNX29mZnNldF8xNSwgMTYsIFRbNDZdKTtcblx0ICAgICAgICAgICAgYiA9IEhIKGIsIGMsIGQsIGEsIE1fb2Zmc2V0XzIsICAyMywgVFs0N10pO1xuXG5cdCAgICAgICAgICAgIGEgPSBJSShhLCBiLCBjLCBkLCBNX29mZnNldF8wLCAgNiwgIFRbNDhdKTtcblx0ICAgICAgICAgICAgZCA9IElJKGQsIGEsIGIsIGMsIE1fb2Zmc2V0XzcsICAxMCwgVFs0OV0pO1xuXHQgICAgICAgICAgICBjID0gSUkoYywgZCwgYSwgYiwgTV9vZmZzZXRfMTQsIDE1LCBUWzUwXSk7XG5cdCAgICAgICAgICAgIGIgPSBJSShiLCBjLCBkLCBhLCBNX29mZnNldF81LCAgMjEsIFRbNTFdKTtcblx0ICAgICAgICAgICAgYSA9IElJKGEsIGIsIGMsIGQsIE1fb2Zmc2V0XzEyLCA2LCAgVFs1Ml0pO1xuXHQgICAgICAgICAgICBkID0gSUkoZCwgYSwgYiwgYywgTV9vZmZzZXRfMywgIDEwLCBUWzUzXSk7XG5cdCAgICAgICAgICAgIGMgPSBJSShjLCBkLCBhLCBiLCBNX29mZnNldF8xMCwgMTUsIFRbNTRdKTtcblx0ICAgICAgICAgICAgYiA9IElJKGIsIGMsIGQsIGEsIE1fb2Zmc2V0XzEsICAyMSwgVFs1NV0pO1xuXHQgICAgICAgICAgICBhID0gSUkoYSwgYiwgYywgZCwgTV9vZmZzZXRfOCwgIDYsICBUWzU2XSk7XG5cdCAgICAgICAgICAgIGQgPSBJSShkLCBhLCBiLCBjLCBNX29mZnNldF8xNSwgMTAsIFRbNTddKTtcblx0ICAgICAgICAgICAgYyA9IElJKGMsIGQsIGEsIGIsIE1fb2Zmc2V0XzYsICAxNSwgVFs1OF0pO1xuXHQgICAgICAgICAgICBiID0gSUkoYiwgYywgZCwgYSwgTV9vZmZzZXRfMTMsIDIxLCBUWzU5XSk7XG5cdCAgICAgICAgICAgIGEgPSBJSShhLCBiLCBjLCBkLCBNX29mZnNldF80LCAgNiwgIFRbNjBdKTtcblx0ICAgICAgICAgICAgZCA9IElJKGQsIGEsIGIsIGMsIE1fb2Zmc2V0XzExLCAxMCwgVFs2MV0pO1xuXHQgICAgICAgICAgICBjID0gSUkoYywgZCwgYSwgYiwgTV9vZmZzZXRfMiwgIDE1LCBUWzYyXSk7XG5cdCAgICAgICAgICAgIGIgPSBJSShiLCBjLCBkLCBhLCBNX29mZnNldF85LCAgMjEsIFRbNjNdKTtcblxuXHQgICAgICAgICAgICAvLyBJbnRlcm1lZGlhdGUgaGFzaCB2YWx1ZVxuXHQgICAgICAgICAgICBIWzBdID0gKEhbMF0gKyBhKSB8IDA7XG5cdCAgICAgICAgICAgIEhbMV0gPSAoSFsxXSArIGIpIHwgMDtcblx0ICAgICAgICAgICAgSFsyXSA9IChIWzJdICsgYykgfCAwO1xuXHQgICAgICAgICAgICBIWzNdID0gKEhbM10gKyBkKSB8IDA7XG5cdCAgICAgICAgfSxcblxuXHQgICAgICAgIF9kb0ZpbmFsaXplOiBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICAgIC8vIFNob3J0Y3V0c1xuXHQgICAgICAgICAgICB2YXIgZGF0YSA9IHRoaXMuX2RhdGE7XG5cdCAgICAgICAgICAgIHZhciBkYXRhV29yZHMgPSBkYXRhLndvcmRzO1xuXG5cdCAgICAgICAgICAgIHZhciBuQml0c1RvdGFsID0gdGhpcy5fbkRhdGFCeXRlcyAqIDg7XG5cdCAgICAgICAgICAgIHZhciBuQml0c0xlZnQgPSBkYXRhLnNpZ0J5dGVzICogODtcblxuXHQgICAgICAgICAgICAvLyBBZGQgcGFkZGluZ1xuXHQgICAgICAgICAgICBkYXRhV29yZHNbbkJpdHNMZWZ0ID4+PiA1XSB8PSAweDgwIDw8ICgyNCAtIG5CaXRzTGVmdCAlIDMyKTtcblxuXHQgICAgICAgICAgICB2YXIgbkJpdHNUb3RhbEggPSBNYXRoLmZsb29yKG5CaXRzVG90YWwgLyAweDEwMDAwMDAwMCk7XG5cdCAgICAgICAgICAgIHZhciBuQml0c1RvdGFsTCA9IG5CaXRzVG90YWw7XG5cdCAgICAgICAgICAgIGRhdGFXb3Jkc1soKChuQml0c0xlZnQgKyA2NCkgPj4+IDkpIDw8IDQpICsgMTVdID0gKFxuXHQgICAgICAgICAgICAgICAgKCgobkJpdHNUb3RhbEggPDwgOCkgIHwgKG5CaXRzVG90YWxIID4+PiAyNCkpICYgMHgwMGZmMDBmZikgfFxuXHQgICAgICAgICAgICAgICAgKCgobkJpdHNUb3RhbEggPDwgMjQpIHwgKG5CaXRzVG90YWxIID4+PiA4KSkgICYgMHhmZjAwZmYwMClcblx0ICAgICAgICAgICAgKTtcblx0ICAgICAgICAgICAgZGF0YVdvcmRzWygoKG5CaXRzTGVmdCArIDY0KSA+Pj4gOSkgPDwgNCkgKyAxNF0gPSAoXG5cdCAgICAgICAgICAgICAgICAoKChuQml0c1RvdGFsTCA8PCA4KSAgfCAobkJpdHNUb3RhbEwgPj4+IDI0KSkgJiAweDAwZmYwMGZmKSB8XG5cdCAgICAgICAgICAgICAgICAoKChuQml0c1RvdGFsTCA8PCAyNCkgfCAobkJpdHNUb3RhbEwgPj4+IDgpKSAgJiAweGZmMDBmZjAwKVxuXHQgICAgICAgICAgICApO1xuXG5cdCAgICAgICAgICAgIGRhdGEuc2lnQnl0ZXMgPSAoZGF0YVdvcmRzLmxlbmd0aCArIDEpICogNDtcblxuXHQgICAgICAgICAgICAvLyBIYXNoIGZpbmFsIGJsb2Nrc1xuXHQgICAgICAgICAgICB0aGlzLl9wcm9jZXNzKCk7XG5cblx0ICAgICAgICAgICAgLy8gU2hvcnRjdXRzXG5cdCAgICAgICAgICAgIHZhciBoYXNoID0gdGhpcy5faGFzaDtcblx0ICAgICAgICAgICAgdmFyIEggPSBoYXNoLndvcmRzO1xuXG5cdCAgICAgICAgICAgIC8vIFN3YXAgZW5kaWFuXG5cdCAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNDsgaSsrKSB7XG5cdCAgICAgICAgICAgICAgICAvLyBTaG9ydGN1dFxuXHQgICAgICAgICAgICAgICAgdmFyIEhfaSA9IEhbaV07XG5cblx0ICAgICAgICAgICAgICAgIEhbaV0gPSAoKChIX2kgPDwgOCkgIHwgKEhfaSA+Pj4gMjQpKSAmIDB4MDBmZjAwZmYpIHxcblx0ICAgICAgICAgICAgICAgICAgICAgICAoKChIX2kgPDwgMjQpIHwgKEhfaSA+Pj4gOCkpICAmIDB4ZmYwMGZmMDApO1xuXHQgICAgICAgICAgICB9XG5cblx0ICAgICAgICAgICAgLy8gUmV0dXJuIGZpbmFsIGNvbXB1dGVkIGhhc2hcblx0ICAgICAgICAgICAgcmV0dXJuIGhhc2g7XG5cdCAgICAgICAgfSxcblxuXHQgICAgICAgIGNsb25lOiBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICAgIHZhciBjbG9uZSA9IEhhc2hlci5jbG9uZS5jYWxsKHRoaXMpO1xuXHQgICAgICAgICAgICBjbG9uZS5faGFzaCA9IHRoaXMuX2hhc2guY2xvbmUoKTtcblxuXHQgICAgICAgICAgICByZXR1cm4gY2xvbmU7XG5cdCAgICAgICAgfVxuXHQgICAgfSk7XG5cblx0ICAgIGZ1bmN0aW9uIEZGKGEsIGIsIGMsIGQsIHgsIHMsIHQpIHtcblx0ICAgICAgICB2YXIgbiA9IGEgKyAoKGIgJiBjKSB8ICh+YiAmIGQpKSArIHggKyB0O1xuXHQgICAgICAgIHJldHVybiAoKG4gPDwgcykgfCAobiA+Pj4gKDMyIC0gcykpKSArIGI7XG5cdCAgICB9XG5cblx0ICAgIGZ1bmN0aW9uIEdHKGEsIGIsIGMsIGQsIHgsIHMsIHQpIHtcblx0ICAgICAgICB2YXIgbiA9IGEgKyAoKGIgJiBkKSB8IChjICYgfmQpKSArIHggKyB0O1xuXHQgICAgICAgIHJldHVybiAoKG4gPDwgcykgfCAobiA+Pj4gKDMyIC0gcykpKSArIGI7XG5cdCAgICB9XG5cblx0ICAgIGZ1bmN0aW9uIEhIKGEsIGIsIGMsIGQsIHgsIHMsIHQpIHtcblx0ICAgICAgICB2YXIgbiA9IGEgKyAoYiBeIGMgXiBkKSArIHggKyB0O1xuXHQgICAgICAgIHJldHVybiAoKG4gPDwgcykgfCAobiA+Pj4gKDMyIC0gcykpKSArIGI7XG5cdCAgICB9XG5cblx0ICAgIGZ1bmN0aW9uIElJKGEsIGIsIGMsIGQsIHgsIHMsIHQpIHtcblx0ICAgICAgICB2YXIgbiA9IGEgKyAoYyBeIChiIHwgfmQpKSArIHggKyB0O1xuXHQgICAgICAgIHJldHVybiAoKG4gPDwgcykgfCAobiA+Pj4gKDMyIC0gcykpKSArIGI7XG5cdCAgICB9XG5cblx0ICAgIC8qKlxuXHQgICAgICogU2hvcnRjdXQgZnVuY3Rpb24gdG8gdGhlIGhhc2hlcidzIG9iamVjdCBpbnRlcmZhY2UuXG5cdCAgICAgKlxuXHQgICAgICogQHBhcmFtIHtXb3JkQXJyYXl8c3RyaW5nfSBtZXNzYWdlIFRoZSBtZXNzYWdlIHRvIGhhc2guXG5cdCAgICAgKlxuXHQgICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgaGFzaC5cblx0ICAgICAqXG5cdCAgICAgKiBAc3RhdGljXG5cdCAgICAgKlxuXHQgICAgICogQGV4YW1wbGVcblx0ICAgICAqXG5cdCAgICAgKiAgICAgdmFyIGhhc2ggPSBDcnlwdG9KUy5NRDUoJ21lc3NhZ2UnKTtcblx0ICAgICAqICAgICB2YXIgaGFzaCA9IENyeXB0b0pTLk1ENSh3b3JkQXJyYXkpO1xuXHQgICAgICovXG5cdCAgICBDLk1ENSA9IEhhc2hlci5fY3JlYXRlSGVscGVyKE1ENSk7XG5cblx0ICAgIC8qKlxuXHQgICAgICogU2hvcnRjdXQgZnVuY3Rpb24gdG8gdGhlIEhNQUMncyBvYmplY3QgaW50ZXJmYWNlLlxuXHQgICAgICpcblx0ICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gbWVzc2FnZSBUaGUgbWVzc2FnZSB0byBoYXNoLlxuXHQgICAgICogQHBhcmFtIHtXb3JkQXJyYXl8c3RyaW5nfSBrZXkgVGhlIHNlY3JldCBrZXkuXG5cdCAgICAgKlxuXHQgICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgSE1BQy5cblx0ICAgICAqXG5cdCAgICAgKiBAc3RhdGljXG5cdCAgICAgKlxuXHQgICAgICogQGV4YW1wbGVcblx0ICAgICAqXG5cdCAgICAgKiAgICAgdmFyIGhtYWMgPSBDcnlwdG9KUy5IbWFjTUQ1KG1lc3NhZ2UsIGtleSk7XG5cdCAgICAgKi9cblx0ICAgIEMuSG1hY01ENSA9IEhhc2hlci5fY3JlYXRlSG1hY0hlbHBlcihNRDUpO1xuXHR9KE1hdGgpKTtcblxuXG5cdHJldHVybiBDcnlwdG9KUy5NRDU7XG5cbn0pKTtcblxuLyoqKi8gfSksXG4vKiAzNSAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG47KGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7XG5cdGlmICh0cnVlKSB7XG5cdFx0Ly8gQ29tbW9uSlNcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHMgPSBmYWN0b3J5KCk7XG5cdH1cblx0ZWxzZSB7fVxufSh0aGlzLCBmdW5jdGlvbiAoKSB7XG5cblx0LyoqXG5cdCAqIENyeXB0b0pTIGNvcmUgY29tcG9uZW50cy5cblx0ICovXG5cdHZhciBDcnlwdG9KUyA9IENyeXB0b0pTIHx8IChmdW5jdGlvbiAoTWF0aCwgdW5kZWZpbmVkKSB7XG5cdCAgICAvKlxuXHQgICAgICogTG9jYWwgcG9seWZpbCBvZiBPYmplY3QuY3JlYXRlXG5cdCAgICAgKi9cblx0ICAgIHZhciBjcmVhdGUgPSBPYmplY3QuY3JlYXRlIHx8IChmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgZnVuY3Rpb24gRigpIHt9O1xuXG5cdCAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChvYmopIHtcblx0ICAgICAgICAgICAgdmFyIHN1YnR5cGU7XG5cblx0ICAgICAgICAgICAgRi5wcm90b3R5cGUgPSBvYmo7XG5cblx0ICAgICAgICAgICAgc3VidHlwZSA9IG5ldyBGKCk7XG5cblx0ICAgICAgICAgICAgRi5wcm90b3R5cGUgPSBudWxsO1xuXG5cdCAgICAgICAgICAgIHJldHVybiBzdWJ0eXBlO1xuXHQgICAgICAgIH07XG5cdCAgICB9KCkpXG5cblx0ICAgIC8qKlxuXHQgICAgICogQ3J5cHRvSlMgbmFtZXNwYWNlLlxuXHQgICAgICovXG5cdCAgICB2YXIgQyA9IHt9O1xuXG5cdCAgICAvKipcblx0ICAgICAqIExpYnJhcnkgbmFtZXNwYWNlLlxuXHQgICAgICovXG5cdCAgICB2YXIgQ19saWIgPSBDLmxpYiA9IHt9O1xuXG5cdCAgICAvKipcblx0ICAgICAqIEJhc2Ugb2JqZWN0IGZvciBwcm90b3R5cGFsIGluaGVyaXRhbmNlLlxuXHQgICAgICovXG5cdCAgICB2YXIgQmFzZSA9IENfbGliLkJhc2UgPSAoZnVuY3Rpb24gKCkge1xuXG5cblx0ICAgICAgICByZXR1cm4ge1xuXHQgICAgICAgICAgICAvKipcblx0ICAgICAgICAgICAgICogQ3JlYXRlcyBhIG5ldyBvYmplY3QgdGhhdCBpbmhlcml0cyBmcm9tIHRoaXMgb2JqZWN0LlxuXHQgICAgICAgICAgICAgKlxuXHQgICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gb3ZlcnJpZGVzIFByb3BlcnRpZXMgdG8gY29weSBpbnRvIHRoZSBuZXcgb2JqZWN0LlxuXHQgICAgICAgICAgICAgKlxuXHQgICAgICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IFRoZSBuZXcgb2JqZWN0LlxuXHQgICAgICAgICAgICAgKlxuXHQgICAgICAgICAgICAgKiBAc3RhdGljXG5cdCAgICAgICAgICAgICAqXG5cdCAgICAgICAgICAgICAqIEBleGFtcGxlXG5cdCAgICAgICAgICAgICAqXG5cdCAgICAgICAgICAgICAqICAgICB2YXIgTXlUeXBlID0gQ3J5cHRvSlMubGliLkJhc2UuZXh0ZW5kKHtcblx0ICAgICAgICAgICAgICogICAgICAgICBmaWVsZDogJ3ZhbHVlJyxcblx0ICAgICAgICAgICAgICpcblx0ICAgICAgICAgICAgICogICAgICAgICBtZXRob2Q6IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICAgICAgICogICAgICAgICB9XG5cdCAgICAgICAgICAgICAqICAgICB9KTtcblx0ICAgICAgICAgICAgICovXG5cdCAgICAgICAgICAgIGV4dGVuZDogZnVuY3Rpb24gKG92ZXJyaWRlcykge1xuXHQgICAgICAgICAgICAgICAgLy8gU3Bhd25cblx0ICAgICAgICAgICAgICAgIHZhciBzdWJ0eXBlID0gY3JlYXRlKHRoaXMpO1xuXG5cdCAgICAgICAgICAgICAgICAvLyBBdWdtZW50XG5cdCAgICAgICAgICAgICAgICBpZiAob3ZlcnJpZGVzKSB7XG5cdCAgICAgICAgICAgICAgICAgICAgc3VidHlwZS5taXhJbihvdmVycmlkZXMpO1xuXHQgICAgICAgICAgICAgICAgfVxuXG5cdCAgICAgICAgICAgICAgICAvLyBDcmVhdGUgZGVmYXVsdCBpbml0aWFsaXplclxuXHQgICAgICAgICAgICAgICAgaWYgKCFzdWJ0eXBlLmhhc093blByb3BlcnR5KCdpbml0JykgfHwgdGhpcy5pbml0ID09PSBzdWJ0eXBlLmluaXQpIHtcblx0ICAgICAgICAgICAgICAgICAgICBzdWJ0eXBlLmluaXQgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICAgICAgICAgICAgICAgIHN1YnR5cGUuJHN1cGVyLmluaXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcblx0ICAgICAgICAgICAgICAgICAgICB9O1xuXHQgICAgICAgICAgICAgICAgfVxuXG5cdCAgICAgICAgICAgICAgICAvLyBJbml0aWFsaXplcidzIHByb3RvdHlwZSBpcyB0aGUgc3VidHlwZSBvYmplY3Rcblx0ICAgICAgICAgICAgICAgIHN1YnR5cGUuaW5pdC5wcm90b3R5cGUgPSBzdWJ0eXBlO1xuXG5cdCAgICAgICAgICAgICAgICAvLyBSZWZlcmVuY2Ugc3VwZXJ0eXBlXG5cdCAgICAgICAgICAgICAgICBzdWJ0eXBlLiRzdXBlciA9IHRoaXM7XG5cblx0ICAgICAgICAgICAgICAgIHJldHVybiBzdWJ0eXBlO1xuXHQgICAgICAgICAgICB9LFxuXG5cdCAgICAgICAgICAgIC8qKlxuXHQgICAgICAgICAgICAgKiBFeHRlbmRzIHRoaXMgb2JqZWN0IGFuZCBydW5zIHRoZSBpbml0IG1ldGhvZC5cblx0ICAgICAgICAgICAgICogQXJndW1lbnRzIHRvIGNyZWF0ZSgpIHdpbGwgYmUgcGFzc2VkIHRvIGluaXQoKS5cblx0ICAgICAgICAgICAgICpcblx0ICAgICAgICAgICAgICogQHJldHVybiB7T2JqZWN0fSBUaGUgbmV3IG9iamVjdC5cblx0ICAgICAgICAgICAgICpcblx0ICAgICAgICAgICAgICogQHN0YXRpY1xuXHQgICAgICAgICAgICAgKlxuXHQgICAgICAgICAgICAgKiBAZXhhbXBsZVxuXHQgICAgICAgICAgICAgKlxuXHQgICAgICAgICAgICAgKiAgICAgdmFyIGluc3RhbmNlID0gTXlUeXBlLmNyZWF0ZSgpO1xuXHQgICAgICAgICAgICAgKi9cblx0ICAgICAgICAgICAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICAgICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzLmV4dGVuZCgpO1xuXHQgICAgICAgICAgICAgICAgaW5zdGFuY2UuaW5pdC5hcHBseShpbnN0YW5jZSwgYXJndW1lbnRzKTtcblxuXHQgICAgICAgICAgICAgICAgcmV0dXJuIGluc3RhbmNlO1xuXHQgICAgICAgICAgICB9LFxuXG5cdCAgICAgICAgICAgIC8qKlxuXHQgICAgICAgICAgICAgKiBJbml0aWFsaXplcyBhIG5ld2x5IGNyZWF0ZWQgb2JqZWN0LlxuXHQgICAgICAgICAgICAgKiBPdmVycmlkZSB0aGlzIG1ldGhvZCB0byBhZGQgc29tZSBsb2dpYyB3aGVuIHlvdXIgb2JqZWN0cyBhcmUgY3JlYXRlZC5cblx0ICAgICAgICAgICAgICpcblx0ICAgICAgICAgICAgICogQGV4YW1wbGVcblx0ICAgICAgICAgICAgICpcblx0ICAgICAgICAgICAgICogICAgIHZhciBNeVR5cGUgPSBDcnlwdG9KUy5saWIuQmFzZS5leHRlbmQoe1xuXHQgICAgICAgICAgICAgKiAgICAgICAgIGluaXQ6IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICAgICAgICogICAgICAgICAgICAgLy8gLi4uXG5cdCAgICAgICAgICAgICAqICAgICAgICAgfVxuXHQgICAgICAgICAgICAgKiAgICAgfSk7XG5cdCAgICAgICAgICAgICAqL1xuXHQgICAgICAgICAgICBpbml0OiBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICAgIH0sXG5cblx0ICAgICAgICAgICAgLyoqXG5cdCAgICAgICAgICAgICAqIENvcGllcyBwcm9wZXJ0aWVzIGludG8gdGhpcyBvYmplY3QuXG5cdCAgICAgICAgICAgICAqXG5cdCAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBwcm9wZXJ0aWVzIFRoZSBwcm9wZXJ0aWVzIHRvIG1peCBpbi5cblx0ICAgICAgICAgICAgICpcblx0ICAgICAgICAgICAgICogQGV4YW1wbGVcblx0ICAgICAgICAgICAgICpcblx0ICAgICAgICAgICAgICogICAgIE15VHlwZS5taXhJbih7XG5cdCAgICAgICAgICAgICAqICAgICAgICAgZmllbGQ6ICd2YWx1ZSdcblx0ICAgICAgICAgICAgICogICAgIH0pO1xuXHQgICAgICAgICAgICAgKi9cblx0ICAgICAgICAgICAgbWl4SW46IGZ1bmN0aW9uIChwcm9wZXJ0aWVzKSB7XG5cdCAgICAgICAgICAgICAgICBmb3IgKHZhciBwcm9wZXJ0eU5hbWUgaW4gcHJvcGVydGllcykge1xuXHQgICAgICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzLmhhc093blByb3BlcnR5KHByb3BlcnR5TmFtZSkpIHtcblx0ICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1twcm9wZXJ0eU5hbWVdID0gcHJvcGVydGllc1twcm9wZXJ0eU5hbWVdO1xuXHQgICAgICAgICAgICAgICAgICAgIH1cblx0ICAgICAgICAgICAgICAgIH1cblxuXHQgICAgICAgICAgICAgICAgLy8gSUUgd29uJ3QgY29weSB0b1N0cmluZyB1c2luZyB0aGUgbG9vcCBhYm92ZVxuXHQgICAgICAgICAgICAgICAgaWYgKHByb3BlcnRpZXMuaGFzT3duUHJvcGVydHkoJ3RvU3RyaW5nJykpIHtcblx0ICAgICAgICAgICAgICAgICAgICB0aGlzLnRvU3RyaW5nID0gcHJvcGVydGllcy50b1N0cmluZztcblx0ICAgICAgICAgICAgICAgIH1cblx0ICAgICAgICAgICAgfSxcblxuXHQgICAgICAgICAgICAvKipcblx0ICAgICAgICAgICAgICogQ3JlYXRlcyBhIGNvcHkgb2YgdGhpcyBvYmplY3QuXG5cdCAgICAgICAgICAgICAqXG5cdCAgICAgICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gVGhlIGNsb25lLlxuXHQgICAgICAgICAgICAgKlxuXHQgICAgICAgICAgICAgKiBAZXhhbXBsZVxuXHQgICAgICAgICAgICAgKlxuXHQgICAgICAgICAgICAgKiAgICAgdmFyIGNsb25lID0gaW5zdGFuY2UuY2xvbmUoKTtcblx0ICAgICAgICAgICAgICovXG5cdCAgICAgICAgICAgIGNsb25lOiBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pbml0LnByb3RvdHlwZS5leHRlbmQodGhpcyk7XG5cdCAgICAgICAgICAgIH1cblx0ICAgICAgICB9O1xuXHQgICAgfSgpKTtcblxuXHQgICAgLyoqXG5cdCAgICAgKiBBbiBhcnJheSBvZiAzMi1iaXQgd29yZHMuXG5cdCAgICAgKlxuXHQgICAgICogQHByb3BlcnR5IHtBcnJheX0gd29yZHMgVGhlIGFycmF5IG9mIDMyLWJpdCB3b3Jkcy5cblx0ICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBzaWdCeXRlcyBUaGUgbnVtYmVyIG9mIHNpZ25pZmljYW50IGJ5dGVzIGluIHRoaXMgd29yZCBhcnJheS5cblx0ICAgICAqL1xuXHQgICAgdmFyIFdvcmRBcnJheSA9IENfbGliLldvcmRBcnJheSA9IEJhc2UuZXh0ZW5kKHtcblx0ICAgICAgICAvKipcblx0ICAgICAgICAgKiBJbml0aWFsaXplcyBhIG5ld2x5IGNyZWF0ZWQgd29yZCBhcnJheS5cblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IHdvcmRzIChPcHRpb25hbCkgQW4gYXJyYXkgb2YgMzItYml0IHdvcmRzLlxuXHQgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBzaWdCeXRlcyAoT3B0aW9uYWwpIFRoZSBudW1iZXIgb2Ygc2lnbmlmaWNhbnQgYnl0ZXMgaW4gdGhlIHdvcmRzLlxuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogQGV4YW1wbGVcblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqICAgICB2YXIgd29yZEFycmF5ID0gQ3J5cHRvSlMubGliLldvcmRBcnJheS5jcmVhdGUoKTtcblx0ICAgICAgICAgKiAgICAgdmFyIHdvcmRBcnJheSA9IENyeXB0b0pTLmxpYi5Xb3JkQXJyYXkuY3JlYXRlKFsweDAwMDEwMjAzLCAweDA0MDUwNjA3XSk7XG5cdCAgICAgICAgICogICAgIHZhciB3b3JkQXJyYXkgPSBDcnlwdG9KUy5saWIuV29yZEFycmF5LmNyZWF0ZShbMHgwMDAxMDIwMywgMHgwNDA1MDYwN10sIDYpO1xuXHQgICAgICAgICAqL1xuXHQgICAgICAgIGluaXQ6IGZ1bmN0aW9uICh3b3Jkcywgc2lnQnl0ZXMpIHtcblx0ICAgICAgICAgICAgd29yZHMgPSB0aGlzLndvcmRzID0gd29yZHMgfHwgW107XG5cblx0ICAgICAgICAgICAgaWYgKHNpZ0J5dGVzICE9IHVuZGVmaW5lZCkge1xuXHQgICAgICAgICAgICAgICAgdGhpcy5zaWdCeXRlcyA9IHNpZ0J5dGVzO1xuXHQgICAgICAgICAgICB9IGVsc2Uge1xuXHQgICAgICAgICAgICAgICAgdGhpcy5zaWdCeXRlcyA9IHdvcmRzLmxlbmd0aCAqIDQ7XG5cdCAgICAgICAgICAgIH1cblx0ICAgICAgICB9LFxuXG5cdCAgICAgICAgLyoqXG5cdCAgICAgICAgICogQ29udmVydHMgdGhpcyB3b3JkIGFycmF5IHRvIGEgc3RyaW5nLlxuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogQHBhcmFtIHtFbmNvZGVyfSBlbmNvZGVyIChPcHRpb25hbCkgVGhlIGVuY29kaW5nIHN0cmF0ZWd5IHRvIHVzZS4gRGVmYXVsdDogQ3J5cHRvSlMuZW5jLkhleFxuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgc3RyaW5naWZpZWQgd29yZCBhcnJheS5cblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqIEBleGFtcGxlXG5cdCAgICAgICAgICpcblx0ICAgICAgICAgKiAgICAgdmFyIHN0cmluZyA9IHdvcmRBcnJheSArICcnO1xuXHQgICAgICAgICAqICAgICB2YXIgc3RyaW5nID0gd29yZEFycmF5LnRvU3RyaW5nKCk7XG5cdCAgICAgICAgICogICAgIHZhciBzdHJpbmcgPSB3b3JkQXJyYXkudG9TdHJpbmcoQ3J5cHRvSlMuZW5jLlV0ZjgpO1xuXHQgICAgICAgICAqL1xuXHQgICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbiAoZW5jb2Rlcikge1xuXHQgICAgICAgICAgICByZXR1cm4gKGVuY29kZXIgfHwgSGV4KS5zdHJpbmdpZnkodGhpcyk7XG5cdCAgICAgICAgfSxcblxuXHQgICAgICAgIC8qKlxuXHQgICAgICAgICAqIENvbmNhdGVuYXRlcyBhIHdvcmQgYXJyYXkgdG8gdGhpcyB3b3JkIGFycmF5LlxuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogQHBhcmFtIHtXb3JkQXJyYXl9IHdvcmRBcnJheSBUaGUgd29yZCBhcnJheSB0byBhcHBlbmQuXG5cdCAgICAgICAgICpcblx0ICAgICAgICAgKiBAcmV0dXJuIHtXb3JkQXJyYXl9IFRoaXMgd29yZCBhcnJheS5cblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqIEBleGFtcGxlXG5cdCAgICAgICAgICpcblx0ICAgICAgICAgKiAgICAgd29yZEFycmF5MS5jb25jYXQod29yZEFycmF5Mik7XG5cdCAgICAgICAgICovXG5cdCAgICAgICAgY29uY2F0OiBmdW5jdGlvbiAod29yZEFycmF5KSB7XG5cdCAgICAgICAgICAgIC8vIFNob3J0Y3V0c1xuXHQgICAgICAgICAgICB2YXIgdGhpc1dvcmRzID0gdGhpcy53b3Jkcztcblx0ICAgICAgICAgICAgdmFyIHRoYXRXb3JkcyA9IHdvcmRBcnJheS53b3Jkcztcblx0ICAgICAgICAgICAgdmFyIHRoaXNTaWdCeXRlcyA9IHRoaXMuc2lnQnl0ZXM7XG5cdCAgICAgICAgICAgIHZhciB0aGF0U2lnQnl0ZXMgPSB3b3JkQXJyYXkuc2lnQnl0ZXM7XG5cblx0ICAgICAgICAgICAgLy8gQ2xhbXAgZXhjZXNzIGJpdHNcblx0ICAgICAgICAgICAgdGhpcy5jbGFtcCgpO1xuXG5cdCAgICAgICAgICAgIC8vIENvbmNhdFxuXHQgICAgICAgICAgICBpZiAodGhpc1NpZ0J5dGVzICUgNCkge1xuXHQgICAgICAgICAgICAgICAgLy8gQ29weSBvbmUgYnl0ZSBhdCBhIHRpbWVcblx0ICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhhdFNpZ0J5dGVzOyBpKyspIHtcblx0ICAgICAgICAgICAgICAgICAgICB2YXIgdGhhdEJ5dGUgPSAodGhhdFdvcmRzW2kgPj4+IDJdID4+PiAoMjQgLSAoaSAlIDQpICogOCkpICYgMHhmZjtcblx0ICAgICAgICAgICAgICAgICAgICB0aGlzV29yZHNbKHRoaXNTaWdCeXRlcyArIGkpID4+PiAyXSB8PSB0aGF0Qnl0ZSA8PCAoMjQgLSAoKHRoaXNTaWdCeXRlcyArIGkpICUgNCkgKiA4KTtcblx0ICAgICAgICAgICAgICAgIH1cblx0ICAgICAgICAgICAgfSBlbHNlIHtcblx0ICAgICAgICAgICAgICAgIC8vIENvcHkgb25lIHdvcmQgYXQgYSB0aW1lXG5cdCAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoYXRTaWdCeXRlczsgaSArPSA0KSB7XG5cdCAgICAgICAgICAgICAgICAgICAgdGhpc1dvcmRzWyh0aGlzU2lnQnl0ZXMgKyBpKSA+Pj4gMl0gPSB0aGF0V29yZHNbaSA+Pj4gMl07XG5cdCAgICAgICAgICAgICAgICB9XG5cdCAgICAgICAgICAgIH1cblx0ICAgICAgICAgICAgdGhpcy5zaWdCeXRlcyArPSB0aGF0U2lnQnl0ZXM7XG5cblx0ICAgICAgICAgICAgLy8gQ2hhaW5hYmxlXG5cdCAgICAgICAgICAgIHJldHVybiB0aGlzO1xuXHQgICAgICAgIH0sXG5cblx0ICAgICAgICAvKipcblx0ICAgICAgICAgKiBSZW1vdmVzIGluc2lnbmlmaWNhbnQgYml0cy5cblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqIEBleGFtcGxlXG5cdCAgICAgICAgICpcblx0ICAgICAgICAgKiAgICAgd29yZEFycmF5LmNsYW1wKCk7XG5cdCAgICAgICAgICovXG5cdCAgICAgICAgY2xhbXA6IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICAgICAgLy8gU2hvcnRjdXRzXG5cdCAgICAgICAgICAgIHZhciB3b3JkcyA9IHRoaXMud29yZHM7XG5cdCAgICAgICAgICAgIHZhciBzaWdCeXRlcyA9IHRoaXMuc2lnQnl0ZXM7XG5cblx0ICAgICAgICAgICAgLy8gQ2xhbXBcblx0ICAgICAgICAgICAgd29yZHNbc2lnQnl0ZXMgPj4+IDJdICY9IDB4ZmZmZmZmZmYgPDwgKDMyIC0gKHNpZ0J5dGVzICUgNCkgKiA4KTtcblx0ICAgICAgICAgICAgd29yZHMubGVuZ3RoID0gTWF0aC5jZWlsKHNpZ0J5dGVzIC8gNCk7XG5cdCAgICAgICAgfSxcblxuXHQgICAgICAgIC8qKlxuXHQgICAgICAgICAqIENyZWF0ZXMgYSBjb3B5IG9mIHRoaXMgd29yZCBhcnJheS5cblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIGNsb25lLlxuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogQGV4YW1wbGVcblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqICAgICB2YXIgY2xvbmUgPSB3b3JkQXJyYXkuY2xvbmUoKTtcblx0ICAgICAgICAgKi9cblx0ICAgICAgICBjbG9uZTogZnVuY3Rpb24gKCkge1xuXHQgICAgICAgICAgICB2YXIgY2xvbmUgPSBCYXNlLmNsb25lLmNhbGwodGhpcyk7XG5cdCAgICAgICAgICAgIGNsb25lLndvcmRzID0gdGhpcy53b3Jkcy5zbGljZSgwKTtcblxuXHQgICAgICAgICAgICByZXR1cm4gY2xvbmU7XG5cdCAgICAgICAgfSxcblxuXHQgICAgICAgIC8qKlxuXHQgICAgICAgICAqIENyZWF0ZXMgYSB3b3JkIGFycmF5IGZpbGxlZCB3aXRoIHJhbmRvbSBieXRlcy5cblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBuQnl0ZXMgVGhlIG51bWJlciBvZiByYW5kb20gYnl0ZXMgdG8gZ2VuZXJhdGUuXG5cdCAgICAgICAgICpcblx0ICAgICAgICAgKiBAcmV0dXJuIHtXb3JkQXJyYXl9IFRoZSByYW5kb20gd29yZCBhcnJheS5cblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqIEBzdGF0aWNcblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqIEBleGFtcGxlXG5cdCAgICAgICAgICpcblx0ICAgICAgICAgKiAgICAgdmFyIHdvcmRBcnJheSA9IENyeXB0b0pTLmxpYi5Xb3JkQXJyYXkucmFuZG9tKDE2KTtcblx0ICAgICAgICAgKi9cblx0ICAgICAgICByYW5kb206IGZ1bmN0aW9uIChuQnl0ZXMpIHtcblx0ICAgICAgICAgICAgdmFyIHdvcmRzID0gW107XG5cblx0ICAgICAgICAgICAgdmFyIHIgPSAoZnVuY3Rpb24gKG1fdykge1xuXHQgICAgICAgICAgICAgICAgdmFyIG1fdyA9IG1fdztcblx0ICAgICAgICAgICAgICAgIHZhciBtX3ogPSAweDNhZGU2OGIxO1xuXHQgICAgICAgICAgICAgICAgdmFyIG1hc2sgPSAweGZmZmZmZmZmO1xuXG5cdCAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuXHQgICAgICAgICAgICAgICAgICAgIG1feiA9ICgweDkwNjkgKiAobV96ICYgMHhGRkZGKSArIChtX3ogPj4gMHgxMCkpICYgbWFzaztcblx0ICAgICAgICAgICAgICAgICAgICBtX3cgPSAoMHg0NjUwICogKG1fdyAmIDB4RkZGRikgKyAobV93ID4+IDB4MTApKSAmIG1hc2s7XG5cdCAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9ICgobV96IDw8IDB4MTApICsgbV93KSAmIG1hc2s7XG5cdCAgICAgICAgICAgICAgICAgICAgcmVzdWx0IC89IDB4MTAwMDAwMDAwO1xuXHQgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAwLjU7XG5cdCAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdCAqIChNYXRoLnJhbmRvbSgpID4gLjUgPyAxIDogLTEpO1xuXHQgICAgICAgICAgICAgICAgfVxuXHQgICAgICAgICAgICB9KTtcblxuXHQgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgcmNhY2hlOyBpIDwgbkJ5dGVzOyBpICs9IDQpIHtcblx0ICAgICAgICAgICAgICAgIHZhciBfciA9IHIoKHJjYWNoZSB8fCBNYXRoLnJhbmRvbSgpKSAqIDB4MTAwMDAwMDAwKTtcblxuXHQgICAgICAgICAgICAgICAgcmNhY2hlID0gX3IoKSAqIDB4M2FkZTY3Yjc7XG5cdCAgICAgICAgICAgICAgICB3b3Jkcy5wdXNoKChfcigpICogMHgxMDAwMDAwMDApIHwgMCk7XG5cdCAgICAgICAgICAgIH1cblxuXHQgICAgICAgICAgICByZXR1cm4gbmV3IFdvcmRBcnJheS5pbml0KHdvcmRzLCBuQnl0ZXMpO1xuXHQgICAgICAgIH1cblx0ICAgIH0pO1xuXG5cdCAgICAvKipcblx0ICAgICAqIEVuY29kZXIgbmFtZXNwYWNlLlxuXHQgICAgICovXG5cdCAgICB2YXIgQ19lbmMgPSBDLmVuYyA9IHt9O1xuXG5cdCAgICAvKipcblx0ICAgICAqIEhleCBlbmNvZGluZyBzdHJhdGVneS5cblx0ICAgICAqL1xuXHQgICAgdmFyIEhleCA9IENfZW5jLkhleCA9IHtcblx0ICAgICAgICAvKipcblx0ICAgICAgICAgKiBDb252ZXJ0cyBhIHdvcmQgYXJyYXkgdG8gYSBoZXggc3RyaW5nLlxuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogQHBhcmFtIHtXb3JkQXJyYXl9IHdvcmRBcnJheSBUaGUgd29yZCBhcnJheS5cblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIGhleCBzdHJpbmcuXG5cdCAgICAgICAgICpcblx0ICAgICAgICAgKiBAc3RhdGljXG5cdCAgICAgICAgICpcblx0ICAgICAgICAgKiBAZXhhbXBsZVxuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogICAgIHZhciBoZXhTdHJpbmcgPSBDcnlwdG9KUy5lbmMuSGV4LnN0cmluZ2lmeSh3b3JkQXJyYXkpO1xuXHQgICAgICAgICAqL1xuXHQgICAgICAgIHN0cmluZ2lmeTogZnVuY3Rpb24gKHdvcmRBcnJheSkge1xuXHQgICAgICAgICAgICAvLyBTaG9ydGN1dHNcblx0ICAgICAgICAgICAgdmFyIHdvcmRzID0gd29yZEFycmF5LndvcmRzO1xuXHQgICAgICAgICAgICB2YXIgc2lnQnl0ZXMgPSB3b3JkQXJyYXkuc2lnQnl0ZXM7XG5cblx0ICAgICAgICAgICAgLy8gQ29udmVydFxuXHQgICAgICAgICAgICB2YXIgaGV4Q2hhcnMgPSBbXTtcblx0ICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaWdCeXRlczsgaSsrKSB7XG5cdCAgICAgICAgICAgICAgICB2YXIgYml0ZSA9ICh3b3Jkc1tpID4+PiAyXSA+Pj4gKDI0IC0gKGkgJSA0KSAqIDgpKSAmIDB4ZmY7XG5cdCAgICAgICAgICAgICAgICBoZXhDaGFycy5wdXNoKChiaXRlID4+PiA0KS50b1N0cmluZygxNikpO1xuXHQgICAgICAgICAgICAgICAgaGV4Q2hhcnMucHVzaCgoYml0ZSAmIDB4MGYpLnRvU3RyaW5nKDE2KSk7XG5cdCAgICAgICAgICAgIH1cblxuXHQgICAgICAgICAgICByZXR1cm4gaGV4Q2hhcnMuam9pbignJyk7XG5cdCAgICAgICAgfSxcblxuXHQgICAgICAgIC8qKlxuXHQgICAgICAgICAqIENvbnZlcnRzIGEgaGV4IHN0cmluZyB0byBhIHdvcmQgYXJyYXkuXG5cdCAgICAgICAgICpcblx0ICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gaGV4U3RyIFRoZSBoZXggc3RyaW5nLlxuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgd29yZCBhcnJheS5cblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqIEBzdGF0aWNcblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqIEBleGFtcGxlXG5cdCAgICAgICAgICpcblx0ICAgICAgICAgKiAgICAgdmFyIHdvcmRBcnJheSA9IENyeXB0b0pTLmVuYy5IZXgucGFyc2UoaGV4U3RyaW5nKTtcblx0ICAgICAgICAgKi9cblx0ICAgICAgICBwYXJzZTogZnVuY3Rpb24gKGhleFN0cikge1xuXHQgICAgICAgICAgICAvLyBTaG9ydGN1dFxuXHQgICAgICAgICAgICB2YXIgaGV4U3RyTGVuZ3RoID0gaGV4U3RyLmxlbmd0aDtcblxuXHQgICAgICAgICAgICAvLyBDb252ZXJ0XG5cdCAgICAgICAgICAgIHZhciB3b3JkcyA9IFtdO1xuXHQgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhleFN0ckxlbmd0aDsgaSArPSAyKSB7XG5cdCAgICAgICAgICAgICAgICB3b3Jkc1tpID4+PiAzXSB8PSBwYXJzZUludChoZXhTdHIuc3Vic3RyKGksIDIpLCAxNikgPDwgKDI0IC0gKGkgJSA4KSAqIDQpO1xuXHQgICAgICAgICAgICB9XG5cblx0ICAgICAgICAgICAgcmV0dXJuIG5ldyBXb3JkQXJyYXkuaW5pdCh3b3JkcywgaGV4U3RyTGVuZ3RoIC8gMik7XG5cdCAgICAgICAgfVxuXHQgICAgfTtcblxuXHQgICAgLyoqXG5cdCAgICAgKiBMYXRpbjEgZW5jb2Rpbmcgc3RyYXRlZ3kuXG5cdCAgICAgKi9cblx0ICAgIHZhciBMYXRpbjEgPSBDX2VuYy5MYXRpbjEgPSB7XG5cdCAgICAgICAgLyoqXG5cdCAgICAgICAgICogQ29udmVydHMgYSB3b3JkIGFycmF5IHRvIGEgTGF0aW4xIHN0cmluZy5cblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fSB3b3JkQXJyYXkgVGhlIHdvcmQgYXJyYXkuXG5cdCAgICAgICAgICpcblx0ICAgICAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBMYXRpbjEgc3RyaW5nLlxuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogQHN0YXRpY1xuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogQGV4YW1wbGVcblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqICAgICB2YXIgbGF0aW4xU3RyaW5nID0gQ3J5cHRvSlMuZW5jLkxhdGluMS5zdHJpbmdpZnkod29yZEFycmF5KTtcblx0ICAgICAgICAgKi9cblx0ICAgICAgICBzdHJpbmdpZnk6IGZ1bmN0aW9uICh3b3JkQXJyYXkpIHtcblx0ICAgICAgICAgICAgLy8gU2hvcnRjdXRzXG5cdCAgICAgICAgICAgIHZhciB3b3JkcyA9IHdvcmRBcnJheS53b3Jkcztcblx0ICAgICAgICAgICAgdmFyIHNpZ0J5dGVzID0gd29yZEFycmF5LnNpZ0J5dGVzO1xuXG5cdCAgICAgICAgICAgIC8vIENvbnZlcnRcblx0ICAgICAgICAgICAgdmFyIGxhdGluMUNoYXJzID0gW107XG5cdCAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2lnQnl0ZXM7IGkrKykge1xuXHQgICAgICAgICAgICAgICAgdmFyIGJpdGUgPSAod29yZHNbaSA+Pj4gMl0gPj4+ICgyNCAtIChpICUgNCkgKiA4KSkgJiAweGZmO1xuXHQgICAgICAgICAgICAgICAgbGF0aW4xQ2hhcnMucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKGJpdGUpKTtcblx0ICAgICAgICAgICAgfVxuXG5cdCAgICAgICAgICAgIHJldHVybiBsYXRpbjFDaGFycy5qb2luKCcnKTtcblx0ICAgICAgICB9LFxuXG5cdCAgICAgICAgLyoqXG5cdCAgICAgICAgICogQ29udmVydHMgYSBMYXRpbjEgc3RyaW5nIHRvIGEgd29yZCBhcnJheS5cblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBsYXRpbjFTdHIgVGhlIExhdGluMSBzdHJpbmcuXG5cdCAgICAgICAgICpcblx0ICAgICAgICAgKiBAcmV0dXJuIHtXb3JkQXJyYXl9IFRoZSB3b3JkIGFycmF5LlxuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogQHN0YXRpY1xuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogQGV4YW1wbGVcblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqICAgICB2YXIgd29yZEFycmF5ID0gQ3J5cHRvSlMuZW5jLkxhdGluMS5wYXJzZShsYXRpbjFTdHJpbmcpO1xuXHQgICAgICAgICAqL1xuXHQgICAgICAgIHBhcnNlOiBmdW5jdGlvbiAobGF0aW4xU3RyKSB7XG5cdCAgICAgICAgICAgIC8vIFNob3J0Y3V0XG5cdCAgICAgICAgICAgIHZhciBsYXRpbjFTdHJMZW5ndGggPSBsYXRpbjFTdHIubGVuZ3RoO1xuXG5cdCAgICAgICAgICAgIC8vIENvbnZlcnRcblx0ICAgICAgICAgICAgdmFyIHdvcmRzID0gW107XG5cdCAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGF0aW4xU3RyTGVuZ3RoOyBpKyspIHtcblx0ICAgICAgICAgICAgICAgIHdvcmRzW2kgPj4+IDJdIHw9IChsYXRpbjFTdHIuY2hhckNvZGVBdChpKSAmIDB4ZmYpIDw8ICgyNCAtIChpICUgNCkgKiA4KTtcblx0ICAgICAgICAgICAgfVxuXG5cdCAgICAgICAgICAgIHJldHVybiBuZXcgV29yZEFycmF5LmluaXQod29yZHMsIGxhdGluMVN0ckxlbmd0aCk7XG5cdCAgICAgICAgfVxuXHQgICAgfTtcblxuXHQgICAgLyoqXG5cdCAgICAgKiBVVEYtOCBlbmNvZGluZyBzdHJhdGVneS5cblx0ICAgICAqL1xuXHQgICAgdmFyIFV0ZjggPSBDX2VuYy5VdGY4ID0ge1xuXHQgICAgICAgIC8qKlxuXHQgICAgICAgICAqIENvbnZlcnRzIGEgd29yZCBhcnJheSB0byBhIFVURi04IHN0cmluZy5cblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fSB3b3JkQXJyYXkgVGhlIHdvcmQgYXJyYXkuXG5cdCAgICAgICAgICpcblx0ICAgICAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBVVEYtOCBzdHJpbmcuXG5cdCAgICAgICAgICpcblx0ICAgICAgICAgKiBAc3RhdGljXG5cdCAgICAgICAgICpcblx0ICAgICAgICAgKiBAZXhhbXBsZVxuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogICAgIHZhciB1dGY4U3RyaW5nID0gQ3J5cHRvSlMuZW5jLlV0Zjguc3RyaW5naWZ5KHdvcmRBcnJheSk7XG5cdCAgICAgICAgICovXG5cdCAgICAgICAgc3RyaW5naWZ5OiBmdW5jdGlvbiAod29yZEFycmF5KSB7XG5cdCAgICAgICAgICAgIHRyeSB7XG5cdCAgICAgICAgICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KGVzY2FwZShMYXRpbjEuc3RyaW5naWZ5KHdvcmRBcnJheSkpKTtcblx0ICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuXHQgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNYWxmb3JtZWQgVVRGLTggZGF0YScpO1xuXHQgICAgICAgICAgICB9XG5cdCAgICAgICAgfSxcblxuXHQgICAgICAgIC8qKlxuXHQgICAgICAgICAqIENvbnZlcnRzIGEgVVRGLTggc3RyaW5nIHRvIGEgd29yZCBhcnJheS5cblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1dGY4U3RyIFRoZSBVVEYtOCBzdHJpbmcuXG5cdCAgICAgICAgICpcblx0ICAgICAgICAgKiBAcmV0dXJuIHtXb3JkQXJyYXl9IFRoZSB3b3JkIGFycmF5LlxuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogQHN0YXRpY1xuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogQGV4YW1wbGVcblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqICAgICB2YXIgd29yZEFycmF5ID0gQ3J5cHRvSlMuZW5jLlV0ZjgucGFyc2UodXRmOFN0cmluZyk7XG5cdCAgICAgICAgICovXG5cdCAgICAgICAgcGFyc2U6IGZ1bmN0aW9uICh1dGY4U3RyKSB7XG5cdCAgICAgICAgICAgIHJldHVybiBMYXRpbjEucGFyc2UodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KHV0ZjhTdHIpKSk7XG5cdCAgICAgICAgfVxuXHQgICAgfTtcblxuXHQgICAgLyoqXG5cdCAgICAgKiBBYnN0cmFjdCBidWZmZXJlZCBibG9jayBhbGdvcml0aG0gdGVtcGxhdGUuXG5cdCAgICAgKlxuXHQgICAgICogVGhlIHByb3BlcnR5IGJsb2NrU2l6ZSBtdXN0IGJlIGltcGxlbWVudGVkIGluIGEgY29uY3JldGUgc3VidHlwZS5cblx0ICAgICAqXG5cdCAgICAgKiBAcHJvcGVydHkge251bWJlcn0gX21pbkJ1ZmZlclNpemUgVGhlIG51bWJlciBvZiBibG9ja3MgdGhhdCBzaG91bGQgYmUga2VwdCB1bnByb2Nlc3NlZCBpbiB0aGUgYnVmZmVyLiBEZWZhdWx0OiAwXG5cdCAgICAgKi9cblx0ICAgIHZhciBCdWZmZXJlZEJsb2NrQWxnb3JpdGhtID0gQ19saWIuQnVmZmVyZWRCbG9ja0FsZ29yaXRobSA9IEJhc2UuZXh0ZW5kKHtcblx0ICAgICAgICAvKipcblx0ICAgICAgICAgKiBSZXNldHMgdGhpcyBibG9jayBhbGdvcml0aG0ncyBkYXRhIGJ1ZmZlciB0byBpdHMgaW5pdGlhbCBzdGF0ZS5cblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqIEBleGFtcGxlXG5cdCAgICAgICAgICpcblx0ICAgICAgICAgKiAgICAgYnVmZmVyZWRCbG9ja0FsZ29yaXRobS5yZXNldCgpO1xuXHQgICAgICAgICAqL1xuXHQgICAgICAgIHJlc2V0OiBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICAgIC8vIEluaXRpYWwgdmFsdWVzXG5cdCAgICAgICAgICAgIHRoaXMuX2RhdGEgPSBuZXcgV29yZEFycmF5LmluaXQoKTtcblx0ICAgICAgICAgICAgdGhpcy5fbkRhdGFCeXRlcyA9IDA7XG5cdCAgICAgICAgfSxcblxuXHQgICAgICAgIC8qKlxuXHQgICAgICAgICAqIEFkZHMgbmV3IGRhdGEgdG8gdGhpcyBibG9jayBhbGdvcml0aG0ncyBidWZmZXIuXG5cdCAgICAgICAgICpcblx0ICAgICAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IGRhdGEgVGhlIGRhdGEgdG8gYXBwZW5kLiBTdHJpbmdzIGFyZSBjb252ZXJ0ZWQgdG8gYSBXb3JkQXJyYXkgdXNpbmcgVVRGLTguXG5cdCAgICAgICAgICpcblx0ICAgICAgICAgKiBAZXhhbXBsZVxuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogICAgIGJ1ZmZlcmVkQmxvY2tBbGdvcml0aG0uX2FwcGVuZCgnZGF0YScpO1xuXHQgICAgICAgICAqICAgICBidWZmZXJlZEJsb2NrQWxnb3JpdGhtLl9hcHBlbmQod29yZEFycmF5KTtcblx0ICAgICAgICAgKi9cblx0ICAgICAgICBfYXBwZW5kOiBmdW5jdGlvbiAoZGF0YSkge1xuXHQgICAgICAgICAgICAvLyBDb252ZXJ0IHN0cmluZyB0byBXb3JkQXJyYXksIGVsc2UgYXNzdW1lIFdvcmRBcnJheSBhbHJlYWR5XG5cdCAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YSA9PSAnc3RyaW5nJykge1xuXHQgICAgICAgICAgICAgICAgZGF0YSA9IFV0ZjgucGFyc2UoZGF0YSk7XG5cdCAgICAgICAgICAgIH1cblxuXHQgICAgICAgICAgICAvLyBBcHBlbmRcblx0ICAgICAgICAgICAgdGhpcy5fZGF0YS5jb25jYXQoZGF0YSk7XG5cdCAgICAgICAgICAgIHRoaXMuX25EYXRhQnl0ZXMgKz0gZGF0YS5zaWdCeXRlcztcblx0ICAgICAgICB9LFxuXG5cdCAgICAgICAgLyoqXG5cdCAgICAgICAgICogUHJvY2Vzc2VzIGF2YWlsYWJsZSBkYXRhIGJsb2Nrcy5cblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqIFRoaXMgbWV0aG9kIGludm9rZXMgX2RvUHJvY2Vzc0Jsb2NrKG9mZnNldCksIHdoaWNoIG11c3QgYmUgaW1wbGVtZW50ZWQgYnkgYSBjb25jcmV0ZSBzdWJ0eXBlLlxuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogQHBhcmFtIHtib29sZWFufSBkb0ZsdXNoIFdoZXRoZXIgYWxsIGJsb2NrcyBhbmQgcGFydGlhbCBibG9ja3Mgc2hvdWxkIGJlIHByb2Nlc3NlZC5cblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIHByb2Nlc3NlZCBkYXRhLlxuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogQGV4YW1wbGVcblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqICAgICB2YXIgcHJvY2Vzc2VkRGF0YSA9IGJ1ZmZlcmVkQmxvY2tBbGdvcml0aG0uX3Byb2Nlc3MoKTtcblx0ICAgICAgICAgKiAgICAgdmFyIHByb2Nlc3NlZERhdGEgPSBidWZmZXJlZEJsb2NrQWxnb3JpdGhtLl9wcm9jZXNzKCEhJ2ZsdXNoJyk7XG5cdCAgICAgICAgICovXG5cdCAgICAgICAgX3Byb2Nlc3M6IGZ1bmN0aW9uIChkb0ZsdXNoKSB7XG5cdCAgICAgICAgICAgIC8vIFNob3J0Y3V0c1xuXHQgICAgICAgICAgICB2YXIgZGF0YSA9IHRoaXMuX2RhdGE7XG5cdCAgICAgICAgICAgIHZhciBkYXRhV29yZHMgPSBkYXRhLndvcmRzO1xuXHQgICAgICAgICAgICB2YXIgZGF0YVNpZ0J5dGVzID0gZGF0YS5zaWdCeXRlcztcblx0ICAgICAgICAgICAgdmFyIGJsb2NrU2l6ZSA9IHRoaXMuYmxvY2tTaXplO1xuXHQgICAgICAgICAgICB2YXIgYmxvY2tTaXplQnl0ZXMgPSBibG9ja1NpemUgKiA0O1xuXG5cdCAgICAgICAgICAgIC8vIENvdW50IGJsb2NrcyByZWFkeVxuXHQgICAgICAgICAgICB2YXIgbkJsb2Nrc1JlYWR5ID0gZGF0YVNpZ0J5dGVzIC8gYmxvY2tTaXplQnl0ZXM7XG5cdCAgICAgICAgICAgIGlmIChkb0ZsdXNoKSB7XG5cdCAgICAgICAgICAgICAgICAvLyBSb3VuZCB1cCB0byBpbmNsdWRlIHBhcnRpYWwgYmxvY2tzXG5cdCAgICAgICAgICAgICAgICBuQmxvY2tzUmVhZHkgPSBNYXRoLmNlaWwobkJsb2Nrc1JlYWR5KTtcblx0ICAgICAgICAgICAgfSBlbHNlIHtcblx0ICAgICAgICAgICAgICAgIC8vIFJvdW5kIGRvd24gdG8gaW5jbHVkZSBvbmx5IGZ1bGwgYmxvY2tzLFxuXHQgICAgICAgICAgICAgICAgLy8gbGVzcyB0aGUgbnVtYmVyIG9mIGJsb2NrcyB0aGF0IG11c3QgcmVtYWluIGluIHRoZSBidWZmZXJcblx0ICAgICAgICAgICAgICAgIG5CbG9ja3NSZWFkeSA9IE1hdGgubWF4KChuQmxvY2tzUmVhZHkgfCAwKSAtIHRoaXMuX21pbkJ1ZmZlclNpemUsIDApO1xuXHQgICAgICAgICAgICB9XG5cblx0ICAgICAgICAgICAgLy8gQ291bnQgd29yZHMgcmVhZHlcblx0ICAgICAgICAgICAgdmFyIG5Xb3Jkc1JlYWR5ID0gbkJsb2Nrc1JlYWR5ICogYmxvY2tTaXplO1xuXG5cdCAgICAgICAgICAgIC8vIENvdW50IGJ5dGVzIHJlYWR5XG5cdCAgICAgICAgICAgIHZhciBuQnl0ZXNSZWFkeSA9IE1hdGgubWluKG5Xb3Jkc1JlYWR5ICogNCwgZGF0YVNpZ0J5dGVzKTtcblxuXHQgICAgICAgICAgICAvLyBQcm9jZXNzIGJsb2Nrc1xuXHQgICAgICAgICAgICBpZiAobldvcmRzUmVhZHkpIHtcblx0ICAgICAgICAgICAgICAgIGZvciAodmFyIG9mZnNldCA9IDA7IG9mZnNldCA8IG5Xb3Jkc1JlYWR5OyBvZmZzZXQgKz0gYmxvY2tTaXplKSB7XG5cdCAgICAgICAgICAgICAgICAgICAgLy8gUGVyZm9ybSBjb25jcmV0ZS1hbGdvcml0aG0gbG9naWNcblx0ICAgICAgICAgICAgICAgICAgICB0aGlzLl9kb1Byb2Nlc3NCbG9jayhkYXRhV29yZHMsIG9mZnNldCk7XG5cdCAgICAgICAgICAgICAgICB9XG5cblx0ICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBwcm9jZXNzZWQgd29yZHNcblx0ICAgICAgICAgICAgICAgIHZhciBwcm9jZXNzZWRXb3JkcyA9IGRhdGFXb3Jkcy5zcGxpY2UoMCwgbldvcmRzUmVhZHkpO1xuXHQgICAgICAgICAgICAgICAgZGF0YS5zaWdCeXRlcyAtPSBuQnl0ZXNSZWFkeTtcblx0ICAgICAgICAgICAgfVxuXG5cdCAgICAgICAgICAgIC8vIFJldHVybiBwcm9jZXNzZWQgd29yZHNcblx0ICAgICAgICAgICAgcmV0dXJuIG5ldyBXb3JkQXJyYXkuaW5pdChwcm9jZXNzZWRXb3JkcywgbkJ5dGVzUmVhZHkpO1xuXHQgICAgICAgIH0sXG5cblx0ICAgICAgICAvKipcblx0ICAgICAgICAgKiBDcmVhdGVzIGEgY29weSBvZiB0aGlzIG9iamVjdC5cblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gVGhlIGNsb25lLlxuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogQGV4YW1wbGVcblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqICAgICB2YXIgY2xvbmUgPSBidWZmZXJlZEJsb2NrQWxnb3JpdGhtLmNsb25lKCk7XG5cdCAgICAgICAgICovXG5cdCAgICAgICAgY2xvbmU6IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICAgICAgdmFyIGNsb25lID0gQmFzZS5jbG9uZS5jYWxsKHRoaXMpO1xuXHQgICAgICAgICAgICBjbG9uZS5fZGF0YSA9IHRoaXMuX2RhdGEuY2xvbmUoKTtcblxuXHQgICAgICAgICAgICByZXR1cm4gY2xvbmU7XG5cdCAgICAgICAgfSxcblxuXHQgICAgICAgIF9taW5CdWZmZXJTaXplOiAwXG5cdCAgICB9KTtcblxuXHQgICAgLyoqXG5cdCAgICAgKiBBYnN0cmFjdCBoYXNoZXIgdGVtcGxhdGUuXG5cdCAgICAgKlxuXHQgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IGJsb2NrU2l6ZSBUaGUgbnVtYmVyIG9mIDMyLWJpdCB3b3JkcyB0aGlzIGhhc2hlciBvcGVyYXRlcyBvbi4gRGVmYXVsdDogMTYgKDUxMiBiaXRzKVxuXHQgICAgICovXG5cdCAgICB2YXIgSGFzaGVyID0gQ19saWIuSGFzaGVyID0gQnVmZmVyZWRCbG9ja0FsZ29yaXRobS5leHRlbmQoe1xuXHQgICAgICAgIC8qKlxuXHQgICAgICAgICAqIENvbmZpZ3VyYXRpb24gb3B0aW9ucy5cblx0ICAgICAgICAgKi9cblx0ICAgICAgICBjZmc6IEJhc2UuZXh0ZW5kKCksXG5cblx0ICAgICAgICAvKipcblx0ICAgICAgICAgKiBJbml0aWFsaXplcyBhIG5ld2x5IGNyZWF0ZWQgaGFzaGVyLlxuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyAoT3B0aW9uYWwpIFRoZSBjb25maWd1cmF0aW9uIG9wdGlvbnMgdG8gdXNlIGZvciB0aGlzIGhhc2ggY29tcHV0YXRpb24uXG5cdCAgICAgICAgICpcblx0ICAgICAgICAgKiBAZXhhbXBsZVxuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogICAgIHZhciBoYXNoZXIgPSBDcnlwdG9KUy5hbGdvLlNIQTI1Ni5jcmVhdGUoKTtcblx0ICAgICAgICAgKi9cblx0ICAgICAgICBpbml0OiBmdW5jdGlvbiAoY2ZnKSB7XG5cdCAgICAgICAgICAgIC8vIEFwcGx5IGNvbmZpZyBkZWZhdWx0c1xuXHQgICAgICAgICAgICB0aGlzLmNmZyA9IHRoaXMuY2ZnLmV4dGVuZChjZmcpO1xuXG5cdCAgICAgICAgICAgIC8vIFNldCBpbml0aWFsIHZhbHVlc1xuXHQgICAgICAgICAgICB0aGlzLnJlc2V0KCk7XG5cdCAgICAgICAgfSxcblxuXHQgICAgICAgIC8qKlxuXHQgICAgICAgICAqIFJlc2V0cyB0aGlzIGhhc2hlciB0byBpdHMgaW5pdGlhbCBzdGF0ZS5cblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqIEBleGFtcGxlXG5cdCAgICAgICAgICpcblx0ICAgICAgICAgKiAgICAgaGFzaGVyLnJlc2V0KCk7XG5cdCAgICAgICAgICovXG5cdCAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICAgICAgLy8gUmVzZXQgZGF0YSBidWZmZXJcblx0ICAgICAgICAgICAgQnVmZmVyZWRCbG9ja0FsZ29yaXRobS5yZXNldC5jYWxsKHRoaXMpO1xuXG5cdCAgICAgICAgICAgIC8vIFBlcmZvcm0gY29uY3JldGUtaGFzaGVyIGxvZ2ljXG5cdCAgICAgICAgICAgIHRoaXMuX2RvUmVzZXQoKTtcblx0ICAgICAgICB9LFxuXG5cdCAgICAgICAgLyoqXG5cdCAgICAgICAgICogVXBkYXRlcyB0aGlzIGhhc2hlciB3aXRoIGEgbWVzc2FnZS5cblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gbWVzc2FnZVVwZGF0ZSBUaGUgbWVzc2FnZSB0byBhcHBlbmQuXG5cdCAgICAgICAgICpcblx0ICAgICAgICAgKiBAcmV0dXJuIHtIYXNoZXJ9IFRoaXMgaGFzaGVyLlxuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogQGV4YW1wbGVcblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqICAgICBoYXNoZXIudXBkYXRlKCdtZXNzYWdlJyk7XG5cdCAgICAgICAgICogICAgIGhhc2hlci51cGRhdGUod29yZEFycmF5KTtcblx0ICAgICAgICAgKi9cblx0ICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uIChtZXNzYWdlVXBkYXRlKSB7XG5cdCAgICAgICAgICAgIC8vIEFwcGVuZFxuXHQgICAgICAgICAgICB0aGlzLl9hcHBlbmQobWVzc2FnZVVwZGF0ZSk7XG5cblx0ICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBoYXNoXG5cdCAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3MoKTtcblxuXHQgICAgICAgICAgICAvLyBDaGFpbmFibGVcblx0ICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG5cdCAgICAgICAgfSxcblxuXHQgICAgICAgIC8qKlxuXHQgICAgICAgICAqIEZpbmFsaXplcyB0aGUgaGFzaCBjb21wdXRhdGlvbi5cblx0ICAgICAgICAgKiBOb3RlIHRoYXQgdGhlIGZpbmFsaXplIG9wZXJhdGlvbiBpcyBlZmZlY3RpdmVseSBhIGRlc3RydWN0aXZlLCByZWFkLW9uY2Ugb3BlcmF0aW9uLlxuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogQHBhcmFtIHtXb3JkQXJyYXl8c3RyaW5nfSBtZXNzYWdlVXBkYXRlIChPcHRpb25hbCkgQSBmaW5hbCBtZXNzYWdlIHVwZGF0ZS5cblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIGhhc2guXG5cdCAgICAgICAgICpcblx0ICAgICAgICAgKiBAZXhhbXBsZVxuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogICAgIHZhciBoYXNoID0gaGFzaGVyLmZpbmFsaXplKCk7XG5cdCAgICAgICAgICogICAgIHZhciBoYXNoID0gaGFzaGVyLmZpbmFsaXplKCdtZXNzYWdlJyk7XG5cdCAgICAgICAgICogICAgIHZhciBoYXNoID0gaGFzaGVyLmZpbmFsaXplKHdvcmRBcnJheSk7XG5cdCAgICAgICAgICovXG5cdCAgICAgICAgZmluYWxpemU6IGZ1bmN0aW9uIChtZXNzYWdlVXBkYXRlKSB7XG5cdCAgICAgICAgICAgIC8vIEZpbmFsIG1lc3NhZ2UgdXBkYXRlXG5cdCAgICAgICAgICAgIGlmIChtZXNzYWdlVXBkYXRlKSB7XG5cdCAgICAgICAgICAgICAgICB0aGlzLl9hcHBlbmQobWVzc2FnZVVwZGF0ZSk7XG5cdCAgICAgICAgICAgIH1cblxuXHQgICAgICAgICAgICAvLyBQZXJmb3JtIGNvbmNyZXRlLWhhc2hlciBsb2dpY1xuXHQgICAgICAgICAgICB2YXIgaGFzaCA9IHRoaXMuX2RvRmluYWxpemUoKTtcblxuXHQgICAgICAgICAgICByZXR1cm4gaGFzaDtcblx0ICAgICAgICB9LFxuXG5cdCAgICAgICAgYmxvY2tTaXplOiA1MTIvMzIsXG5cblx0ICAgICAgICAvKipcblx0ICAgICAgICAgKiBDcmVhdGVzIGEgc2hvcnRjdXQgZnVuY3Rpb24gdG8gYSBoYXNoZXIncyBvYmplY3QgaW50ZXJmYWNlLlxuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogQHBhcmFtIHtIYXNoZXJ9IGhhc2hlciBUaGUgaGFzaGVyIHRvIGNyZWF0ZSBhIGhlbHBlciBmb3IuXG5cdCAgICAgICAgICpcblx0ICAgICAgICAgKiBAcmV0dXJuIHtGdW5jdGlvbn0gVGhlIHNob3J0Y3V0IGZ1bmN0aW9uLlxuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogQHN0YXRpY1xuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogQGV4YW1wbGVcblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqICAgICB2YXIgU0hBMjU2ID0gQ3J5cHRvSlMubGliLkhhc2hlci5fY3JlYXRlSGVscGVyKENyeXB0b0pTLmFsZ28uU0hBMjU2KTtcblx0ICAgICAgICAgKi9cblx0ICAgICAgICBfY3JlYXRlSGVscGVyOiBmdW5jdGlvbiAoaGFzaGVyKSB7XG5cdCAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAobWVzc2FnZSwgY2ZnKSB7XG5cdCAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGhhc2hlci5pbml0KGNmZykuZmluYWxpemUobWVzc2FnZSk7XG5cdCAgICAgICAgICAgIH07XG5cdCAgICAgICAgfSxcblxuXHQgICAgICAgIC8qKlxuXHQgICAgICAgICAqIENyZWF0ZXMgYSBzaG9ydGN1dCBmdW5jdGlvbiB0byB0aGUgSE1BQydzIG9iamVjdCBpbnRlcmZhY2UuXG5cdCAgICAgICAgICpcblx0ICAgICAgICAgKiBAcGFyYW0ge0hhc2hlcn0gaGFzaGVyIFRoZSBoYXNoZXIgdG8gdXNlIGluIHRoaXMgSE1BQyBoZWxwZXIuXG5cdCAgICAgICAgICpcblx0ICAgICAgICAgKiBAcmV0dXJuIHtGdW5jdGlvbn0gVGhlIHNob3J0Y3V0IGZ1bmN0aW9uLlxuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogQHN0YXRpY1xuXHQgICAgICAgICAqXG5cdCAgICAgICAgICogQGV4YW1wbGVcblx0ICAgICAgICAgKlxuXHQgICAgICAgICAqICAgICB2YXIgSG1hY1NIQTI1NiA9IENyeXB0b0pTLmxpYi5IYXNoZXIuX2NyZWF0ZUhtYWNIZWxwZXIoQ3J5cHRvSlMuYWxnby5TSEEyNTYpO1xuXHQgICAgICAgICAqL1xuXHQgICAgICAgIF9jcmVhdGVIbWFjSGVscGVyOiBmdW5jdGlvbiAoaGFzaGVyKSB7XG5cdCAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAobWVzc2FnZSwga2V5KSB7XG5cdCAgICAgICAgICAgICAgICByZXR1cm4gbmV3IENfYWxnby5ITUFDLmluaXQoaGFzaGVyLCBrZXkpLmZpbmFsaXplKG1lc3NhZ2UpO1xuXHQgICAgICAgICAgICB9O1xuXHQgICAgICAgIH1cblx0ICAgIH0pO1xuXG5cdCAgICAvKipcblx0ICAgICAqIEFsZ29yaXRobSBuYW1lc3BhY2UuXG5cdCAgICAgKi9cblx0ICAgIHZhciBDX2FsZ28gPSBDLmFsZ28gPSB7fTtcblxuXHQgICAgcmV0dXJuIEM7XG5cdH0oTWF0aCkpO1xuXG5cblx0cmV0dXJuIENyeXB0b0pTO1xuXG59KSk7XG5cbi8qKiovIH0pLFxuLyogMzYgKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciBHcmFtbWFyID0gX193ZWJwYWNrX3JlcXVpcmVfXygzNyk7XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChTSVApIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBwYXJzZTogZnVuY3Rpb24gcGFyc2VDdXN0b20oaW5wdXQsIHN0YXJ0UnVsZSkge1xuICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB7IHN0YXJ0UnVsZTogc3RhcnRSdWxlLCBTSVA6IFNJUCB9O1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBHcmFtbWFyLnBhcnNlKGlucHV0LCBvcHRpb25zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5kYXRhID0gLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gb3B0aW9ucy5kYXRhO1xuICAgICAgICB9XG4gICAgfTtcbn07XG5cblxuLyoqKi8gfSksXG4vKiAzNyAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cInVzZSBzdHJpY3RcIjtcbi8qXG4gKiBHZW5lcmF0ZWQgYnkgUEVHLmpzIDAuMTAuMC5cbiAqXG4gKiBodHRwOi8vcGVnanMub3JnL1xuICovXG5cblxuXG5mdW5jdGlvbiBwZWckc3ViY2xhc3MoY2hpbGQsIHBhcmVudCkge1xuICBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH1cbiAgY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlO1xuICBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpO1xufVxuXG5mdW5jdGlvbiBwZWckU3ludGF4RXJyb3IobWVzc2FnZSwgZXhwZWN0ZWQsIGZvdW5kLCBsb2NhdGlvbikge1xuICB0aGlzLm1lc3NhZ2UgID0gbWVzc2FnZTtcbiAgdGhpcy5leHBlY3RlZCA9IGV4cGVjdGVkO1xuICB0aGlzLmZvdW5kICAgID0gZm91bmQ7XG4gIHRoaXMubG9jYXRpb24gPSBsb2NhdGlvbjtcbiAgdGhpcy5uYW1lICAgICA9IFwiU3ludGF4RXJyb3JcIjtcblxuICBpZiAodHlwZW9mIEVycm9yLmNhcHR1cmVTdGFja1RyYWNlID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSh0aGlzLCBwZWckU3ludGF4RXJyb3IpO1xuICB9XG59XG5cbnBlZyRzdWJjbGFzcyhwZWckU3ludGF4RXJyb3IsIEVycm9yKTtcblxucGVnJFN5bnRheEVycm9yLmJ1aWxkTWVzc2FnZSA9IGZ1bmN0aW9uKGV4cGVjdGVkLCBmb3VuZCkge1xuICB2YXIgREVTQ1JJQkVfRVhQRUNUQVRJT05fRk5TID0ge1xuICAgICAgICBsaXRlcmFsOiBmdW5jdGlvbihleHBlY3RhdGlvbikge1xuICAgICAgICAgIHJldHVybiBcIlxcXCJcIiArIGxpdGVyYWxFc2NhcGUoZXhwZWN0YXRpb24udGV4dCkgKyBcIlxcXCJcIjtcbiAgICAgICAgfSxcblxuICAgICAgICBcImNsYXNzXCI6IGZ1bmN0aW9uKGV4cGVjdGF0aW9uKSB7XG4gICAgICAgICAgdmFyIGVzY2FwZWRQYXJ0cyA9IFwiXCIsXG4gICAgICAgICAgICAgIGk7XG5cbiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZXhwZWN0YXRpb24ucGFydHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGVzY2FwZWRQYXJ0cyArPSBleHBlY3RhdGlvbi5wYXJ0c1tpXSBpbnN0YW5jZW9mIEFycmF5XG4gICAgICAgICAgICAgID8gY2xhc3NFc2NhcGUoZXhwZWN0YXRpb24ucGFydHNbaV1bMF0pICsgXCItXCIgKyBjbGFzc0VzY2FwZShleHBlY3RhdGlvbi5wYXJ0c1tpXVsxXSlcbiAgICAgICAgICAgICAgOiBjbGFzc0VzY2FwZShleHBlY3RhdGlvbi5wYXJ0c1tpXSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIFwiW1wiICsgKGV4cGVjdGF0aW9uLmludmVydGVkID8gXCJeXCIgOiBcIlwiKSArIGVzY2FwZWRQYXJ0cyArIFwiXVwiO1xuICAgICAgICB9LFxuXG4gICAgICAgIGFueTogZnVuY3Rpb24oZXhwZWN0YXRpb24pIHtcbiAgICAgICAgICByZXR1cm4gXCJhbnkgY2hhcmFjdGVyXCI7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZW5kOiBmdW5jdGlvbihleHBlY3RhdGlvbikge1xuICAgICAgICAgIHJldHVybiBcImVuZCBvZiBpbnB1dFwiO1xuICAgICAgICB9LFxuXG4gICAgICAgIG90aGVyOiBmdW5jdGlvbihleHBlY3RhdGlvbikge1xuICAgICAgICAgIHJldHVybiBleHBlY3RhdGlvbi5kZXNjcmlwdGlvbjtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICBmdW5jdGlvbiBoZXgoY2gpIHtcbiAgICByZXR1cm4gY2guY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikudG9VcHBlckNhc2UoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGxpdGVyYWxFc2NhcGUocykge1xuICAgIHJldHVybiBzXG4gICAgICAucmVwbGFjZSgvXFxcXC9nLCAnXFxcXFxcXFwnKVxuICAgICAgLnJlcGxhY2UoL1wiL2csICAnXFxcXFwiJylcbiAgICAgIC5yZXBsYWNlKC9cXDAvZywgJ1xcXFwwJylcbiAgICAgIC5yZXBsYWNlKC9cXHQvZywgJ1xcXFx0JylcbiAgICAgIC5yZXBsYWNlKC9cXG4vZywgJ1xcXFxuJylcbiAgICAgIC5yZXBsYWNlKC9cXHIvZywgJ1xcXFxyJylcbiAgICAgIC5yZXBsYWNlKC9bXFx4MDAtXFx4MEZdL2csICAgICAgICAgIGZ1bmN0aW9uKGNoKSB7IHJldHVybiAnXFxcXHgwJyArIGhleChjaCk7IH0pXG4gICAgICAucmVwbGFjZSgvW1xceDEwLVxceDFGXFx4N0YtXFx4OUZdL2csIGZ1bmN0aW9uKGNoKSB7IHJldHVybiAnXFxcXHgnICArIGhleChjaCk7IH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gY2xhc3NFc2NhcGUocykge1xuICAgIHJldHVybiBzXG4gICAgICAucmVwbGFjZSgvXFxcXC9nLCAnXFxcXFxcXFwnKVxuICAgICAgLnJlcGxhY2UoL1xcXS9nLCAnXFxcXF0nKVxuICAgICAgLnJlcGxhY2UoL1xcXi9nLCAnXFxcXF4nKVxuICAgICAgLnJlcGxhY2UoLy0vZywgICdcXFxcLScpXG4gICAgICAucmVwbGFjZSgvXFwwL2csICdcXFxcMCcpXG4gICAgICAucmVwbGFjZSgvXFx0L2csICdcXFxcdCcpXG4gICAgICAucmVwbGFjZSgvXFxuL2csICdcXFxcbicpXG4gICAgICAucmVwbGFjZSgvXFxyL2csICdcXFxccicpXG4gICAgICAucmVwbGFjZSgvW1xceDAwLVxceDBGXS9nLCAgICAgICAgICBmdW5jdGlvbihjaCkgeyByZXR1cm4gJ1xcXFx4MCcgKyBoZXgoY2gpOyB9KVxuICAgICAgLnJlcGxhY2UoL1tcXHgxMC1cXHgxRlxceDdGLVxceDlGXS9nLCBmdW5jdGlvbihjaCkgeyByZXR1cm4gJ1xcXFx4JyAgKyBoZXgoY2gpOyB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGRlc2NyaWJlRXhwZWN0YXRpb24oZXhwZWN0YXRpb24pIHtcbiAgICByZXR1cm4gREVTQ1JJQkVfRVhQRUNUQVRJT05fRk5TW2V4cGVjdGF0aW9uLnR5cGVdKGV4cGVjdGF0aW9uKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGRlc2NyaWJlRXhwZWN0ZWQoZXhwZWN0ZWQpIHtcbiAgICB2YXIgZGVzY3JpcHRpb25zID0gbmV3IEFycmF5KGV4cGVjdGVkLmxlbmd0aCksXG4gICAgICAgIGksIGo7XG5cbiAgICBmb3IgKGkgPSAwOyBpIDwgZXhwZWN0ZWQubGVuZ3RoOyBpKyspIHtcbiAgICAgIGRlc2NyaXB0aW9uc1tpXSA9IGRlc2NyaWJlRXhwZWN0YXRpb24oZXhwZWN0ZWRbaV0pO1xuICAgIH1cblxuICAgIGRlc2NyaXB0aW9ucy5zb3J0KCk7XG5cbiAgICBpZiAoZGVzY3JpcHRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgIGZvciAoaSA9IDEsIGogPSAxOyBpIDwgZGVzY3JpcHRpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChkZXNjcmlwdGlvbnNbaSAtIDFdICE9PSBkZXNjcmlwdGlvbnNbaV0pIHtcbiAgICAgICAgICBkZXNjcmlwdGlvbnNbal0gPSBkZXNjcmlwdGlvbnNbaV07XG4gICAgICAgICAgaisrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBkZXNjcmlwdGlvbnMubGVuZ3RoID0gajtcbiAgICB9XG5cbiAgICBzd2l0Y2ggKGRlc2NyaXB0aW9ucy5sZW5ndGgpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgcmV0dXJuIGRlc2NyaXB0aW9uc1swXTtcblxuICAgICAgY2FzZSAyOlxuICAgICAgICByZXR1cm4gZGVzY3JpcHRpb25zWzBdICsgXCIgb3IgXCIgKyBkZXNjcmlwdGlvbnNbMV07XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBkZXNjcmlwdGlvbnMuc2xpY2UoMCwgLTEpLmpvaW4oXCIsIFwiKVxuICAgICAgICAgICsgXCIsIG9yIFwiXG4gICAgICAgICAgKyBkZXNjcmlwdGlvbnNbZGVzY3JpcHRpb25zLmxlbmd0aCAtIDFdO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGRlc2NyaWJlRm91bmQoZm91bmQpIHtcbiAgICByZXR1cm4gZm91bmQgPyBcIlxcXCJcIiArIGxpdGVyYWxFc2NhcGUoZm91bmQpICsgXCJcXFwiXCIgOiBcImVuZCBvZiBpbnB1dFwiO1xuICB9XG5cbiAgcmV0dXJuIFwiRXhwZWN0ZWQgXCIgKyBkZXNjcmliZUV4cGVjdGVkKGV4cGVjdGVkKSArIFwiIGJ1dCBcIiArIGRlc2NyaWJlRm91bmQoZm91bmQpICsgXCIgZm91bmQuXCI7XG59O1xuXG5mdW5jdGlvbiBwZWckcGFyc2UoaW5wdXQsIG9wdGlvbnMpIHtcbiAgb3B0aW9ucyA9IG9wdGlvbnMgIT09IHZvaWQgMCA/IG9wdGlvbnMgOiB7fTtcblxuICB2YXIgcGVnJEZBSUxFRCA9IHt9LFxuXG4gICAgICBwZWckc3RhcnRSdWxlSW5kaWNlcyA9IHsgQ29udGFjdDogMTE5LCBOYW1lX0FkZHJfSGVhZGVyOiAxNTYsIFJlY29yZF9Sb3V0ZTogMTc2LCBSZXF1ZXN0X1Jlc3BvbnNlOiA4MSwgU0lQX1VSSTogNDUsIFN1YnNjcmlwdGlvbl9TdGF0ZTogMTg2LCBTdXBwb3J0ZWQ6IDE5MSwgUmVxdWlyZTogMTgyLCBWaWE6IDE5NCwgYWJzb2x1dGVVUkk6IDg0LCBDYWxsX0lEOiAxMTgsIENvbnRlbnRfRGlzcG9zaXRpb246IDEzMCwgQ29udGVudF9MZW5ndGg6IDEzNSwgQ29udGVudF9UeXBlOiAxMzYsIENTZXE6IDE0NiwgZGlzcGxheU5hbWU6IDEyMiwgRXZlbnQ6IDE0OSwgRnJvbTogMTUxLCBob3N0OiA1MiwgTWF4X0ZvcndhcmRzOiAxNTQsIE1pbl9TRTogMjEzLCBQcm94eV9BdXRoZW50aWNhdGU6IDE1NywgcXVvdGVkX3N0cmluZzogNDAsIFJlZmVyX1RvOiAxNzgsIFJlcGxhY2VzOiAxNzksIFNlc3Npb25fRXhwaXJlczogMjEwLCBzdHVuX1VSSTogMjE3LCBUbzogMTkyLCB0dXJuX1VSSTogMjIzLCB1dWlkOiAyMjYsIFdXV19BdXRoZW50aWNhdGU6IDIwOSwgY2hhbGxlbmdlOiAxNTgsIHNpcGZyYWc6IDIzMCwgUmVmZXJyZWRfQnk6IDIzMSB9LFxuICAgICAgcGVnJHN0YXJ0UnVsZUluZGV4ICAgPSAxMTksXG5cbiAgICAgIHBlZyRjb25zdHMgPSBbXG4gICAgICAgIFwiXFxyXFxuXCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJcXHJcXG5cIiwgZmFsc2UpLFxuICAgICAgICAvXlswLTldLyxcbiAgICAgICAgcGVnJGNsYXNzRXhwZWN0YXRpb24oW1tcIjBcIiwgXCI5XCJdXSwgZmFsc2UsIGZhbHNlKSxcbiAgICAgICAgL15bYS16QS1aXS8sXG4gICAgICAgIHBlZyRjbGFzc0V4cGVjdGF0aW9uKFtbXCJhXCIsIFwielwiXSwgW1wiQVwiLCBcIlpcIl1dLCBmYWxzZSwgZmFsc2UpLFxuICAgICAgICAvXlswLTlhLWZBLUZdLyxcbiAgICAgICAgcGVnJGNsYXNzRXhwZWN0YXRpb24oW1tcIjBcIiwgXCI5XCJdLCBbXCJhXCIsIFwiZlwiXSwgW1wiQVwiLCBcIkZcIl1dLCBmYWxzZSwgZmFsc2UpLFxuICAgICAgICAvXltcXDAtXFx4RkZdLyxcbiAgICAgICAgcGVnJGNsYXNzRXhwZWN0YXRpb24oW1tcIlxcMFwiLCBcIlxceEZGXCJdXSwgZmFsc2UsIGZhbHNlKSxcbiAgICAgICAgL15bXCJdLyxcbiAgICAgICAgcGVnJGNsYXNzRXhwZWN0YXRpb24oW1wiXFxcIlwiXSwgZmFsc2UsIGZhbHNlKSxcbiAgICAgICAgXCIgXCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCIgXCIsIGZhbHNlKSxcbiAgICAgICAgXCJcXHRcIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcIlxcdFwiLCBmYWxzZSksXG4gICAgICAgIC9eW2EtekEtWjAtOV0vLFxuICAgICAgICBwZWckY2xhc3NFeHBlY3RhdGlvbihbW1wiYVwiLCBcInpcIl0sIFtcIkFcIiwgXCJaXCJdLCBbXCIwXCIsIFwiOVwiXV0sIGZhbHNlLCBmYWxzZSksXG4gICAgICAgIFwiO1wiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiO1wiLCBmYWxzZSksXG4gICAgICAgIFwiL1wiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiL1wiLCBmYWxzZSksXG4gICAgICAgIFwiP1wiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiP1wiLCBmYWxzZSksXG4gICAgICAgIFwiOlwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiOlwiLCBmYWxzZSksXG4gICAgICAgIFwiQFwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiQFwiLCBmYWxzZSksXG4gICAgICAgIFwiJlwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiJlwiLCBmYWxzZSksXG4gICAgICAgIFwiPVwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiPVwiLCBmYWxzZSksXG4gICAgICAgIFwiK1wiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiK1wiLCBmYWxzZSksXG4gICAgICAgIFwiJFwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiJFwiLCBmYWxzZSksXG4gICAgICAgIFwiLFwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiLFwiLCBmYWxzZSksXG4gICAgICAgIFwiLVwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiLVwiLCBmYWxzZSksXG4gICAgICAgIFwiX1wiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiX1wiLCBmYWxzZSksXG4gICAgICAgIFwiLlwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiLlwiLCBmYWxzZSksXG4gICAgICAgIFwiIVwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiIVwiLCBmYWxzZSksXG4gICAgICAgIFwiflwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiflwiLCBmYWxzZSksXG4gICAgICAgIFwiKlwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiKlwiLCBmYWxzZSksXG4gICAgICAgIFwiJ1wiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiJ1wiLCBmYWxzZSksXG4gICAgICAgIFwiKFwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiKFwiLCBmYWxzZSksXG4gICAgICAgIFwiKVwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiKVwiLCBmYWxzZSksXG4gICAgICAgIFwiJVwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiJVwiLCBmYWxzZSksXG4gICAgICAgIGZ1bmN0aW9uKCkge3JldHVybiBcIiBcIjsgfSxcbiAgICAgICAgZnVuY3Rpb24oKSB7cmV0dXJuICc6JzsgfSxcbiAgICAgICAgL15bIS1+XS8sXG4gICAgICAgIHBlZyRjbGFzc0V4cGVjdGF0aW9uKFtbXCIhXCIsIFwiflwiXV0sIGZhbHNlLCBmYWxzZSksXG4gICAgICAgIC9eW1xceDgwLVxcdUZGRkZdLyxcbiAgICAgICAgcGVnJGNsYXNzRXhwZWN0YXRpb24oW1tcIlxceDgwXCIsIFwiXFx1RkZGRlwiXV0sIGZhbHNlLCBmYWxzZSksXG4gICAgICAgIC9eW1xceDgwLVxceEJGXS8sXG4gICAgICAgIHBlZyRjbGFzc0V4cGVjdGF0aW9uKFtbXCJcXHg4MFwiLCBcIlxceEJGXCJdXSwgZmFsc2UsIGZhbHNlKSxcbiAgICAgICAgL15bYS1mXS8sXG4gICAgICAgIHBlZyRjbGFzc0V4cGVjdGF0aW9uKFtbXCJhXCIsIFwiZlwiXV0sIGZhbHNlLCBmYWxzZSksXG4gICAgICAgIFwiYFwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiYFwiLCBmYWxzZSksXG4gICAgICAgIFwiPFwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiPFwiLCBmYWxzZSksXG4gICAgICAgIFwiPlwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiPlwiLCBmYWxzZSksXG4gICAgICAgIFwiXFxcXFwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiXFxcXFwiLCBmYWxzZSksXG4gICAgICAgIFwiW1wiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiW1wiLCBmYWxzZSksXG4gICAgICAgIFwiXVwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiXVwiLCBmYWxzZSksXG4gICAgICAgIFwie1wiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwie1wiLCBmYWxzZSksXG4gICAgICAgIFwifVwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwifVwiLCBmYWxzZSksXG4gICAgICAgIGZ1bmN0aW9uKCkge3JldHVybiBcIipcIjsgfSxcbiAgICAgICAgZnVuY3Rpb24oKSB7cmV0dXJuIFwiL1wiOyB9LFxuICAgICAgICBmdW5jdGlvbigpIHtyZXR1cm4gXCI9XCI7IH0sXG4gICAgICAgIGZ1bmN0aW9uKCkge3JldHVybiBcIihcIjsgfSxcbiAgICAgICAgZnVuY3Rpb24oKSB7cmV0dXJuIFwiKVwiOyB9LFxuICAgICAgICBmdW5jdGlvbigpIHtyZXR1cm4gXCI+XCI7IH0sXG4gICAgICAgIGZ1bmN0aW9uKCkge3JldHVybiBcIjxcIjsgfSxcbiAgICAgICAgZnVuY3Rpb24oKSB7cmV0dXJuIFwiLFwiOyB9LFxuICAgICAgICBmdW5jdGlvbigpIHtyZXR1cm4gXCI7XCI7IH0sXG4gICAgICAgIGZ1bmN0aW9uKCkge3JldHVybiBcIjpcIjsgfSxcbiAgICAgICAgZnVuY3Rpb24oKSB7cmV0dXJuIFwiXFxcIlwiOyB9LFxuICAgICAgICAvXlshLSddLyxcbiAgICAgICAgcGVnJGNsYXNzRXhwZWN0YXRpb24oW1tcIiFcIiwgXCInXCJdXSwgZmFsc2UsIGZhbHNlKSxcbiAgICAgICAgL15bKi1bXS8sXG4gICAgICAgIHBlZyRjbGFzc0V4cGVjdGF0aW9uKFtbXCIqXCIsIFwiW1wiXV0sIGZhbHNlLCBmYWxzZSksXG4gICAgICAgIC9eW1xcXS1+XS8sXG4gICAgICAgIHBlZyRjbGFzc0V4cGVjdGF0aW9uKFtbXCJdXCIsIFwiflwiXV0sIGZhbHNlLCBmYWxzZSksXG4gICAgICAgIGZ1bmN0aW9uKGNvbnRlbnRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb250ZW50czsgfSxcbiAgICAgICAgL15bIy1bXS8sXG4gICAgICAgIHBlZyRjbGFzc0V4cGVjdGF0aW9uKFtbXCIjXCIsIFwiW1wiXV0sIGZhbHNlLCBmYWxzZSksXG4gICAgICAgIC9eW1xcMC1cXHRdLyxcbiAgICAgICAgcGVnJGNsYXNzRXhwZWN0YXRpb24oW1tcIlxcMFwiLCBcIlxcdFwiXV0sIGZhbHNlLCBmYWxzZSksXG4gICAgICAgIC9eW1xceDBCLVxcZl0vLFxuICAgICAgICBwZWckY2xhc3NFeHBlY3RhdGlvbihbW1wiXFx4MEJcIiwgXCJcXGZcIl1dLCBmYWxzZSwgZmFsc2UpLFxuICAgICAgICAvXltcXHgwRS1cXHg3Rl0vLFxuICAgICAgICBwZWckY2xhc3NFeHBlY3RhdGlvbihbW1wiXFx4MEVcIiwgXCJcXHg3RlwiXV0sIGZhbHNlLCBmYWxzZSksXG4gICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmRhdGEudXJpID0gbmV3IG9wdGlvbnMuU0lQLlVSSShvcHRpb25zLmRhdGEuc2NoZW1lLCBvcHRpb25zLmRhdGEudXNlciwgb3B0aW9ucy5kYXRhLmhvc3QsIG9wdGlvbnMuZGF0YS5wb3J0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIG9wdGlvbnMuZGF0YS5zY2hlbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBvcHRpb25zLmRhdGEudXNlcjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIG9wdGlvbnMuZGF0YS5ob3N0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgb3B0aW9ucy5kYXRhLmhvc3RfdHlwZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIG9wdGlvbnMuZGF0YS5wb3J0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YS51cmkgPSBuZXcgb3B0aW9ucy5TSVAuVVJJKG9wdGlvbnMuZGF0YS5zY2hlbWUsIG9wdGlvbnMuZGF0YS51c2VyLCBvcHRpb25zLmRhdGEuaG9zdCwgb3B0aW9ucy5kYXRhLnBvcnQsIG9wdGlvbnMuZGF0YS51cmlfcGFyYW1zLCBvcHRpb25zLmRhdGEudXJpX2hlYWRlcnMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgb3B0aW9ucy5kYXRhLnNjaGVtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIG9wdGlvbnMuZGF0YS51c2VyO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgb3B0aW9ucy5kYXRhLmhvc3Q7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBvcHRpb25zLmRhdGEuaG9zdF90eXBlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgb3B0aW9ucy5kYXRhLnBvcnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBvcHRpb25zLmRhdGEudXJpX3BhcmFtcztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5zdGFydFJ1bGUgPT09ICdTSVBfVVJJJykgeyBvcHRpb25zLmRhdGEgPSBvcHRpb25zLmRhdGEudXJpO31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgIFwic2lwc1wiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwic2lwc1wiLCB0cnVlKSxcbiAgICAgICAgXCJzaXBcIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcInNpcFwiLCB0cnVlKSxcbiAgICAgICAgZnVuY3Rpb24odXJpX3NjaGVtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YS5zY2hlbWUgPSB1cmlfc2NoZW1lOyB9LFxuICAgICAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmRhdGEudXNlciA9IGRlY29kZVVSSUNvbXBvbmVudCh0ZXh0KCkuc2xpY2UoMCwgLTEpKTt9LFxuICAgICAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmRhdGEucGFzc3dvcmQgPSB0ZXh0KCk7IH0sXG4gICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YS5ob3N0ID0gdGV4dCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmRhdGEuaG9zdDsgfSxcbiAgICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YS5ob3N0X3R5cGUgPSAnZG9tYWluJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRleHQoKTsgfSxcbiAgICAgICAgL15bYS16QS1aMC05X1xcLV0vLFxuICAgICAgICBwZWckY2xhc3NFeHBlY3RhdGlvbihbW1wiYVwiLCBcInpcIl0sIFtcIkFcIiwgXCJaXCJdLCBbXCIwXCIsIFwiOVwiXSwgXCJfXCIsIFwiLVwiXSwgZmFsc2UsIGZhbHNlKSxcbiAgICAgICAgL15bYS16QS1aMC05XFwtXS8sXG4gICAgICAgIHBlZyRjbGFzc0V4cGVjdGF0aW9uKFtbXCJhXCIsIFwielwiXSwgW1wiQVwiLCBcIlpcIl0sIFtcIjBcIiwgXCI5XCJdLCBcIi1cIl0sIGZhbHNlLCBmYWxzZSksXG4gICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YS5ob3N0X3R5cGUgPSAnSVB2Nic7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRleHQoKTsgfSxcbiAgICAgICAgXCI6OlwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiOjpcIiwgZmFsc2UpLFxuICAgICAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kYXRhLmhvc3RfdHlwZSA9ICdJUHY2JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRleHQoKTsgfSxcbiAgICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kYXRhLmhvc3RfdHlwZSA9ICdJUHY0JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGV4dCgpOyB9LFxuICAgICAgICBcIjI1XCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCIyNVwiLCBmYWxzZSksXG4gICAgICAgIC9eWzAtNV0vLFxuICAgICAgICBwZWckY2xhc3NFeHBlY3RhdGlvbihbW1wiMFwiLCBcIjVcIl1dLCBmYWxzZSwgZmFsc2UpLFxuICAgICAgICBcIjJcIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcIjJcIiwgZmFsc2UpLFxuICAgICAgICAvXlswLTRdLyxcbiAgICAgICAgcGVnJGNsYXNzRXhwZWN0YXRpb24oW1tcIjBcIiwgXCI0XCJdXSwgZmFsc2UsIGZhbHNlKSxcbiAgICAgICAgXCIxXCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCIxXCIsIGZhbHNlKSxcbiAgICAgICAgL15bMS05XS8sXG4gICAgICAgIHBlZyRjbGFzc0V4cGVjdGF0aW9uKFtbXCIxXCIsIFwiOVwiXV0sIGZhbHNlLCBmYWxzZSksXG4gICAgICAgIGZ1bmN0aW9uKHBvcnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3J0ID0gcGFyc2VJbnQocG9ydC5qb2luKCcnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kYXRhLnBvcnQgPSBwb3J0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwb3J0OyB9LFxuICAgICAgICBcInRyYW5zcG9ydD1cIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcInRyYW5zcG9ydD1cIiwgdHJ1ZSksXG4gICAgICAgIFwidWRwXCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJ1ZHBcIiwgdHJ1ZSksXG4gICAgICAgIFwidGNwXCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJ0Y3BcIiwgdHJ1ZSksXG4gICAgICAgIFwic2N0cFwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwic2N0cFwiLCB0cnVlKSxcbiAgICAgICAgXCJ0bHNcIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcInRsc1wiLCB0cnVlKSxcbiAgICAgICAgZnVuY3Rpb24odHJhbnNwb3J0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZighb3B0aW9ucy5kYXRhLnVyaV9wYXJhbXMpIG9wdGlvbnMuZGF0YS51cmlfcGFyYW1zPXt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kYXRhLnVyaV9wYXJhbXNbJ3RyYW5zcG9ydCddID0gdHJhbnNwb3J0LnRvTG93ZXJDYXNlKCk7IH0sXG4gICAgICAgIFwidXNlcj1cIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcInVzZXI9XCIsIHRydWUpLFxuICAgICAgICBcInBob25lXCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJwaG9uZVwiLCB0cnVlKSxcbiAgICAgICAgXCJpcFwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiaXBcIiwgdHJ1ZSksXG4gICAgICAgIGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFvcHRpb25zLmRhdGEudXJpX3BhcmFtcykgb3B0aW9ucy5kYXRhLnVyaV9wYXJhbXM9e307XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmRhdGEudXJpX3BhcmFtc1sndXNlciddID0gdXNlci50b0xvd2VyQ2FzZSgpOyB9LFxuICAgICAgICBcIm1ldGhvZD1cIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcIm1ldGhvZD1cIiwgdHJ1ZSksXG4gICAgICAgIGZ1bmN0aW9uKG1ldGhvZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoIW9wdGlvbnMuZGF0YS51cmlfcGFyYW1zKSBvcHRpb25zLmRhdGEudXJpX3BhcmFtcz17fTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YS51cmlfcGFyYW1zWydtZXRob2QnXSA9IG1ldGhvZDsgfSxcbiAgICAgICAgXCJ0dGw9XCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJ0dGw9XCIsIHRydWUpLFxuICAgICAgICBmdW5jdGlvbih0dGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFvcHRpb25zLmRhdGEucGFyYW1zKSBvcHRpb25zLmRhdGEucGFyYW1zPXt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kYXRhLnBhcmFtc1sndHRsJ10gPSB0dGw7IH0sXG4gICAgICAgIFwibWFkZHI9XCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJtYWRkcj1cIiwgdHJ1ZSksXG4gICAgICAgIGZ1bmN0aW9uKG1hZGRyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZighb3B0aW9ucy5kYXRhLnVyaV9wYXJhbXMpIG9wdGlvbnMuZGF0YS51cmlfcGFyYW1zPXt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kYXRhLnVyaV9wYXJhbXNbJ21hZGRyJ10gPSBtYWRkcjsgfSxcbiAgICAgICAgXCJsclwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwibHJcIiwgdHJ1ZSksXG4gICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoIW9wdGlvbnMuZGF0YS51cmlfcGFyYW1zKSBvcHRpb25zLmRhdGEudXJpX3BhcmFtcz17fTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YS51cmlfcGFyYW1zWydsciddID0gdW5kZWZpbmVkOyB9LFxuICAgICAgICBmdW5jdGlvbihwYXJhbSwgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFvcHRpb25zLmRhdGEudXJpX3BhcmFtcykgb3B0aW9ucy5kYXRhLnVyaV9wYXJhbXMgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWVbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmRhdGEudXJpX3BhcmFtc1twYXJhbS50b0xvd2VyQ2FzZSgpXSA9IHZhbHVlO30sXG4gICAgICAgIGZ1bmN0aW9uKGhuYW1lLCBodmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhuYW1lID0gaG5hbWUuam9pbignJykudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGh2YWx1ZSA9IGh2YWx1ZS5qb2luKCcnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFvcHRpb25zLmRhdGEudXJpX2hlYWRlcnMpIG9wdGlvbnMuZGF0YS51cmlfaGVhZGVycyA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zLmRhdGEudXJpX2hlYWRlcnNbaG5hbWVdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YS51cmlfaGVhZGVyc1tobmFtZV0gPSBbaHZhbHVlXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YS51cmlfaGVhZGVyc1tobmFtZV0ucHVzaChodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfX0sXG4gICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbG90cyBvZiB0ZXN0cyBmYWlsIGlmIHRoaXMgaXNuJ3QgZ3VhcmRlZC4uLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuc3RhcnRSdWxlID09PSAnUmVmZXJfVG8nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YS51cmkgPSBuZXcgb3B0aW9ucy5TSVAuVVJJKG9wdGlvbnMuZGF0YS5zY2hlbWUsIG9wdGlvbnMuZGF0YS51c2VyLCBvcHRpb25zLmRhdGEuaG9zdCwgb3B0aW9ucy5kYXRhLnBvcnQsIG9wdGlvbnMuZGF0YS51cmlfcGFyYW1zLCBvcHRpb25zLmRhdGEudXJpX2hlYWRlcnMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgb3B0aW9ucy5kYXRhLnNjaGVtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIG9wdGlvbnMuZGF0YS51c2VyO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgb3B0aW9ucy5kYXRhLmhvc3Q7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBvcHRpb25zLmRhdGEuaG9zdF90eXBlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgb3B0aW9ucy5kYXRhLnBvcnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBvcHRpb25zLmRhdGEudXJpX3BhcmFtcztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICBcIi8vXCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCIvL1wiLCBmYWxzZSksXG4gICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YS5zY2hlbWU9IHRleHQoKTsgfSxcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcIlNJUFwiLCB0cnVlKSxcbiAgICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kYXRhLnNpcF92ZXJzaW9uID0gdGV4dCgpOyB9LFxuICAgICAgICBcIklOVklURVwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiSU5WSVRFXCIsIGZhbHNlKSxcbiAgICAgICAgXCJBQ0tcIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcIkFDS1wiLCBmYWxzZSksXG4gICAgICAgIFwiVlhBQ0hcIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcIlZYQUNIXCIsIGZhbHNlKSxcbiAgICAgICAgXCJPUFRJT05TXCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJPUFRJT05TXCIsIGZhbHNlKSxcbiAgICAgICAgXCJCWUVcIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcIkJZRVwiLCBmYWxzZSksXG4gICAgICAgIFwiQ0FOQ0VMXCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJDQU5DRUxcIiwgZmFsc2UpLFxuICAgICAgICBcIlJFR0lTVEVSXCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJSRUdJU1RFUlwiLCBmYWxzZSksXG4gICAgICAgIFwiU1VCU0NSSUJFXCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJTVUJTQ1JJQkVcIiwgZmFsc2UpLFxuICAgICAgICBcIk5PVElGWVwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiTk9USUZZXCIsIGZhbHNlKSxcbiAgICAgICAgXCJSRUZFUlwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiUkVGRVJcIiwgZmFsc2UpLFxuICAgICAgICBcIlBVQkxJU0hcIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcIlBVQkxJU0hcIiwgZmFsc2UpLFxuICAgICAgICBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YS5tZXRob2QgPSB0ZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnMuZGF0YS5tZXRob2Q7IH0sXG4gICAgICAgIGZ1bmN0aW9uKHN0YXR1c19jb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YS5zdGF0dXNfY29kZSA9IHBhcnNlSW50KHN0YXR1c19jb2RlLmpvaW4oJycpKTsgfSxcbiAgICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YS5yZWFzb25fcGhyYXNlID0gdGV4dCgpOyB9LFxuICAgICAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmRhdGEgPSB0ZXh0KCk7IH0sXG4gICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWR4LCBsZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlbmd0aCA9IG9wdGlvbnMuZGF0YS5tdWx0aV9oZWFkZXIubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGlkeCA9IDA7IGlkeCA8IGxlbmd0aDsgaWR4KyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5kYXRhLm11bHRpX2hlYWRlcltpZHhdLnBhcnNlZCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kYXRhID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5kYXRhICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kYXRhID0gb3B0aW9ucy5kYXRhLm11bHRpX2hlYWRlcjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmRhdGEgPSAtMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfX0sXG4gICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaGVhZGVyO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZighb3B0aW9ucy5kYXRhLm11bHRpX2hlYWRlcikgb3B0aW9ucy5kYXRhLm11bHRpX2hlYWRlciA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlciA9IG5ldyBvcHRpb25zLlNJUC5OYW1lQWRkckhlYWRlcihvcHRpb25zLmRhdGEudXJpLCBvcHRpb25zLmRhdGEuZGlzcGxheU5hbWUsIG9wdGlvbnMuZGF0YS5wYXJhbXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBvcHRpb25zLmRhdGEudXJpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBvcHRpb25zLmRhdGEuZGlzcGxheU5hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIG9wdGlvbnMuZGF0YS5wYXJhbXM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2goZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlciA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kYXRhLm11bHRpX2hlYWRlci5wdXNoKCB7ICdwb3NpdGlvbic6IHBlZyRjdXJyUG9zLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdvZmZzZXQnOiBsb2NhdGlvbigpLnN0YXJ0Lm9mZnNldCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncGFyc2VkJzogaGVhZGVyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO30sXG4gICAgICAgIGZ1bmN0aW9uKGRpc3BsYXlOYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lID0gdGV4dCgpLnRyaW0oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRpc3BsYXlOYW1lWzBdID09PSAnXFxcIicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZSA9IGRpc3BsYXlOYW1lLnN1YnN0cmluZygxLCBkaXNwbGF5TmFtZS5sZW5ndGgtMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kYXRhLmRpc3BsYXlOYW1lID0gZGlzcGxheU5hbWU7IH0sXG4gICAgICAgIFwicVwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwicVwiLCB0cnVlKSxcbiAgICAgICAgZnVuY3Rpb24ocSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZighb3B0aW9ucy5kYXRhLnBhcmFtcykgb3B0aW9ucy5kYXRhLnBhcmFtcyA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmRhdGEucGFyYW1zWydxJ10gPSBxOyB9LFxuICAgICAgICBcImV4cGlyZXNcIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcImV4cGlyZXNcIiwgdHJ1ZSksXG4gICAgICAgIGZ1bmN0aW9uKGV4cGlyZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoIW9wdGlvbnMuZGF0YS5wYXJhbXMpIG9wdGlvbnMuZGF0YS5wYXJhbXMgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kYXRhLnBhcmFtc1snZXhwaXJlcyddID0gZXhwaXJlczsgfSxcbiAgICAgICAgZnVuY3Rpb24oZGVsdGFfc2Vjb25kcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQoZGVsdGFfc2Vjb25kcy5qb2luKCcnKSk7IH0sXG4gICAgICAgIFwiMFwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiMFwiLCBmYWxzZSksXG4gICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdCh0ZXh0KCkpOyB9LFxuICAgICAgICBmdW5jdGlvbihwYXJhbSwgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoIW9wdGlvbnMuZGF0YS5wYXJhbXMpIG9wdGlvbnMuZGF0YS5wYXJhbXMgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YS5wYXJhbXNbcGFyYW0udG9Mb3dlckNhc2UoKV0gPSB2YWx1ZTt9LFxuICAgICAgICBcInJlbmRlclwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwicmVuZGVyXCIsIHRydWUpLFxuICAgICAgICBcInNlc3Npb25cIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcInNlc3Npb25cIiwgdHJ1ZSksXG4gICAgICAgIFwiaWNvblwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiaWNvblwiLCB0cnVlKSxcbiAgICAgICAgXCJhbGVydFwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiYWxlcnRcIiwgdHJ1ZSksXG4gICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuc3RhcnRSdWxlID09PSAnQ29udGVudF9EaXNwb3NpdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kYXRhLnR5cGUgPSB0ZXh0KCkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICBcImhhbmRsaW5nXCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJoYW5kbGluZ1wiLCB0cnVlKSxcbiAgICAgICAgXCJvcHRpb25hbFwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwib3B0aW9uYWxcIiwgdHJ1ZSksXG4gICAgICAgIFwicmVxdWlyZWRcIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcInJlcXVpcmVkXCIsIHRydWUpLFxuICAgICAgICBmdW5jdGlvbihsZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kYXRhID0gcGFyc2VJbnQobGVuZ3RoLmpvaW4oJycpKTsgfSxcbiAgICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YSA9IHRleHQoKTsgfSxcbiAgICAgICAgXCJ0ZXh0XCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJ0ZXh0XCIsIHRydWUpLFxuICAgICAgICBcImltYWdlXCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJpbWFnZVwiLCB0cnVlKSxcbiAgICAgICAgXCJhdWRpb1wiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiYXVkaW9cIiwgdHJ1ZSksXG4gICAgICAgIFwidmlkZW9cIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcInZpZGVvXCIsIHRydWUpLFxuICAgICAgICBcImFwcGxpY2F0aW9uXCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJhcHBsaWNhdGlvblwiLCB0cnVlKSxcbiAgICAgICAgXCJtZXNzYWdlXCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJtZXNzYWdlXCIsIHRydWUpLFxuICAgICAgICBcIm11bHRpcGFydFwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwibXVsdGlwYXJ0XCIsIHRydWUpLFxuICAgICAgICBcIngtXCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJ4LVwiLCB0cnVlKSxcbiAgICAgICAgZnVuY3Rpb24oY3NlcV92YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmRhdGEudmFsdWU9cGFyc2VJbnQoY3NlcV92YWx1ZS5qb2luKCcnKSk7IH0sXG4gICAgICAgIGZ1bmN0aW9uKGV4cGlyZXMpIHtvcHRpb25zLmRhdGEgPSBleHBpcmVzOyB9LFxuICAgICAgICBmdW5jdGlvbihldmVudF90eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kYXRhLmV2ZW50ID0gZXZlbnRfdHlwZS50b0xvd2VyQ2FzZSgpOyB9LFxuICAgICAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWcgPSBvcHRpb25zLmRhdGEudGFnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmRhdGEgPSBuZXcgb3B0aW9ucy5TSVAuTmFtZUFkZHJIZWFkZXIob3B0aW9ucy5kYXRhLnVyaSwgb3B0aW9ucy5kYXRhLmRpc3BsYXlOYW1lLCBvcHRpb25zLmRhdGEucGFyYW1zKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhZykge29wdGlvbnMuZGF0YS5zZXRQYXJhbSgndGFnJyx0YWcpfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgXCJ0YWdcIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcInRhZ1wiLCB0cnVlKSxcbiAgICAgICAgZnVuY3Rpb24odGFnKSB7b3B0aW9ucy5kYXRhLnRhZyA9IHRhZzsgfSxcbiAgICAgICAgZnVuY3Rpb24oZm9yd2FyZHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kYXRhID0gcGFyc2VJbnQoZm9yd2FyZHMuam9pbignJykpOyB9LFxuICAgICAgICBmdW5jdGlvbihtaW5fZXhwaXJlcykge29wdGlvbnMuZGF0YSA9IG1pbl9leHBpcmVzOyB9LFxuICAgICAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kYXRhID0gbmV3IG9wdGlvbnMuU0lQLk5hbWVBZGRySGVhZGVyKG9wdGlvbnMuZGF0YS51cmksIG9wdGlvbnMuZGF0YS5kaXNwbGF5TmFtZSwgb3B0aW9ucy5kYXRhLnBhcmFtcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICBcImRpZ2VzdFwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiRGlnZXN0XCIsIHRydWUpLFxuICAgICAgICBcInJlYWxtXCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJyZWFsbVwiLCB0cnVlKSxcbiAgICAgICAgZnVuY3Rpb24ocmVhbG0pIHsgb3B0aW9ucy5kYXRhLnJlYWxtID0gcmVhbG07IH0sXG4gICAgICAgIFwiZG9tYWluXCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJkb21haW5cIiwgdHJ1ZSksXG4gICAgICAgIFwibm9uY2VcIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcIm5vbmNlXCIsIHRydWUpLFxuICAgICAgICBmdW5jdGlvbihub25jZSkgeyBvcHRpb25zLmRhdGEubm9uY2U9bm9uY2U7IH0sXG4gICAgICAgIFwib3BhcXVlXCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJvcGFxdWVcIiwgdHJ1ZSksXG4gICAgICAgIGZ1bmN0aW9uKG9wYXF1ZSkgeyBvcHRpb25zLmRhdGEub3BhcXVlPW9wYXF1ZTsgfSxcbiAgICAgICAgXCJzdGFsZVwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwic3RhbGVcIiwgdHJ1ZSksXG4gICAgICAgIFwidHJ1ZVwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwidHJ1ZVwiLCB0cnVlKSxcbiAgICAgICAgZnVuY3Rpb24oKSB7IG9wdGlvbnMuZGF0YS5zdGFsZT10cnVlOyB9LFxuICAgICAgICBcImZhbHNlXCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJmYWxzZVwiLCB0cnVlKSxcbiAgICAgICAgZnVuY3Rpb24oKSB7IG9wdGlvbnMuZGF0YS5zdGFsZT1mYWxzZTsgfSxcbiAgICAgICAgXCJhbGdvcml0aG1cIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcImFsZ29yaXRobVwiLCB0cnVlKSxcbiAgICAgICAgXCJtZDVcIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcIk1ENVwiLCB0cnVlKSxcbiAgICAgICAgXCJtZDUtc2Vzc1wiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiTUQ1LXNlc3NcIiwgdHJ1ZSksXG4gICAgICAgIGZ1bmN0aW9uKGFsZ29yaXRobSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kYXRhLmFsZ29yaXRobT1hbGdvcml0aG0udG9VcHBlckNhc2UoKTsgfSxcbiAgICAgICAgXCJxb3BcIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcInFvcFwiLCB0cnVlKSxcbiAgICAgICAgXCJhdXRoLWludFwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiYXV0aC1pbnRcIiwgdHJ1ZSksXG4gICAgICAgIFwiYXV0aFwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiYXV0aFwiLCB0cnVlKSxcbiAgICAgICAgZnVuY3Rpb24ocW9wX3ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YS5xb3AgfHwgKG9wdGlvbnMuZGF0YS5xb3A9W10pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmRhdGEucW9wLnB1c2gocW9wX3ZhbHVlLnRvTG93ZXJDYXNlKCkpOyB9LFxuICAgICAgICBmdW5jdGlvbihyYWNrX3ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YS52YWx1ZT1wYXJzZUludChyYWNrX3ZhbHVlLmpvaW4oJycpKTsgfSxcbiAgICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpZHgsIGxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbGVuZ3RoID0gb3B0aW9ucy5kYXRhLm11bHRpX2hlYWRlci5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaWR4ID0gMDsgaWR4IDwgbGVuZ3RoOyBpZHgrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmRhdGEubXVsdGlfaGVhZGVyW2lkeF0ucGFyc2VkID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmRhdGEgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmRhdGEgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmRhdGEgPSBvcHRpb25zLmRhdGEubXVsdGlfaGVhZGVyO1xuICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YSA9IC0xO1xuICAgICAgICAgICAgICAgICAgICAgICAgICB9fSxcbiAgICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBoZWFkZXI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFvcHRpb25zLmRhdGEubXVsdGlfaGVhZGVyKSBvcHRpb25zLmRhdGEubXVsdGlfaGVhZGVyID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyID0gbmV3IG9wdGlvbnMuU0lQLk5hbWVBZGRySGVhZGVyKG9wdGlvbnMuZGF0YS51cmksIG9wdGlvbnMuZGF0YS5kaXNwbGF5TmFtZSwgb3B0aW9ucy5kYXRhLnBhcmFtcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIG9wdGlvbnMuZGF0YS51cmk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIG9wdGlvbnMuZGF0YS5kaXNwbGF5TmFtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgb3B0aW9ucy5kYXRhLnBhcmFtcztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmRhdGEubXVsdGlfaGVhZGVyLnB1c2goIHsgJ3Bvc2l0aW9uJzogcGVnJGN1cnJQb3MsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ29mZnNldCc6IGxvY2F0aW9uKCkuc3RhcnQub2Zmc2V0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwYXJzZWQnOiBoZWFkZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7fSxcbiAgICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kYXRhID0gbmV3IG9wdGlvbnMuU0lQLk5hbWVBZGRySGVhZGVyKG9wdGlvbnMuZGF0YS51cmksIG9wdGlvbnMuZGF0YS5kaXNwbGF5TmFtZSwgb3B0aW9ucy5kYXRhLnBhcmFtcyk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEob3B0aW9ucy5kYXRhLnJlcGxhY2VzX2Zyb21fdGFnICYmIG9wdGlvbnMuZGF0YS5yZXBsYWNlc190b190YWcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YSA9IC0xO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kYXRhID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsX2lkOiBvcHRpb25zLmRhdGFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgXCJmcm9tLXRhZ1wiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiZnJvbS10YWdcIiwgdHJ1ZSksXG4gICAgICAgIGZ1bmN0aW9uKGZyb21fdGFnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmRhdGEucmVwbGFjZXNfZnJvbV90YWcgPSBmcm9tX3RhZztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICBcInRvLXRhZ1wiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwidG8tdGFnXCIsIHRydWUpLFxuICAgICAgICBmdW5jdGlvbih0b190YWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YS5yZXBsYWNlc190b190YWcgPSB0b190YWc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgXCJlYXJseS1vbmx5XCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJlYXJseS1vbmx5XCIsIHRydWUpLFxuICAgICAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YS5lYXJseV9vbmx5ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbihoZWFkLCByKSB7cmV0dXJuIHI7fSxcbiAgICAgICAgZnVuY3Rpb24oaGVhZCwgdGFpbCkgeyByZXR1cm4gbGlzdChoZWFkLCB0YWlsKTsgfSxcbiAgICAgICAgZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnN0YXJ0UnVsZSA9PT0gJ1JlcXVpcmUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YSA9IHZhbHVlIHx8IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uKHJzZXFfdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kYXRhLnZhbHVlPXBhcnNlSW50KHJzZXFfdmFsdWUuam9pbignJykpOyB9LFxuICAgICAgICBcImFjdGl2ZVwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiYWN0aXZlXCIsIHRydWUpLFxuICAgICAgICBcInBlbmRpbmdcIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcInBlbmRpbmdcIiwgdHJ1ZSksXG4gICAgICAgIFwidGVybWluYXRlZFwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwidGVybWluYXRlZFwiLCB0cnVlKSxcbiAgICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YS5zdGF0ZSA9IHRleHQoKTsgfSxcbiAgICAgICAgXCJyZWFzb25cIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcInJlYXNvblwiLCB0cnVlKSxcbiAgICAgICAgZnVuY3Rpb24ocmVhc29uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcmVhc29uICE9PSAndW5kZWZpbmVkJykgb3B0aW9ucy5kYXRhLnJlYXNvbiA9IHJlYXNvbjsgfSxcbiAgICAgICAgZnVuY3Rpb24oZXhwaXJlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGV4cGlyZXMgIT09ICd1bmRlZmluZWQnKSBvcHRpb25zLmRhdGEuZXhwaXJlcyA9IGV4cGlyZXM7IH0sXG4gICAgICAgIFwicmV0cnlfYWZ0ZXJcIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcInJldHJ5X2FmdGVyXCIsIHRydWUpLFxuICAgICAgICBmdW5jdGlvbihyZXRyeV9hZnRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHJldHJ5X2FmdGVyICE9PSAndW5kZWZpbmVkJykgb3B0aW9ucy5kYXRhLnJldHJ5X2FmdGVyID0gcmV0cnlfYWZ0ZXI7IH0sXG4gICAgICAgIFwiZGVhY3RpdmF0ZWRcIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcImRlYWN0aXZhdGVkXCIsIHRydWUpLFxuICAgICAgICBcInByb2JhdGlvblwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwicHJvYmF0aW9uXCIsIHRydWUpLFxuICAgICAgICBcInJlamVjdGVkXCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJyZWplY3RlZFwiLCB0cnVlKSxcbiAgICAgICAgXCJ0aW1lb3V0XCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJ0aW1lb3V0XCIsIHRydWUpLFxuICAgICAgICBcImdpdmV1cFwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiZ2l2ZXVwXCIsIHRydWUpLFxuICAgICAgICBcIm5vcmVzb3VyY2VcIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcIm5vcmVzb3VyY2VcIiwgdHJ1ZSksXG4gICAgICAgIFwiaW52YXJpYW50XCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJpbnZhcmlhbnRcIiwgdHJ1ZSksXG4gICAgICAgIGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5zdGFydFJ1bGUgPT09ICdTdXBwb3J0ZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YSA9IHZhbHVlIHx8IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWcgPSBvcHRpb25zLmRhdGEudGFnO1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kYXRhID0gbmV3IG9wdGlvbnMuU0lQLk5hbWVBZGRySGVhZGVyKG9wdGlvbnMuZGF0YS51cmksIG9wdGlvbnMuZGF0YS5kaXNwbGF5TmFtZSwgb3B0aW9ucy5kYXRhLnBhcmFtcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFnKSB7b3B0aW9ucy5kYXRhLnNldFBhcmFtKCd0YWcnLHRhZyl9XG4gICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgXCJ0dGxcIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcInR0bFwiLCB0cnVlKSxcbiAgICAgICAgZnVuY3Rpb24odmlhX3R0bF92YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kYXRhLnR0bCA9IHZpYV90dGxfdmFsdWU7IH0sXG4gICAgICAgIFwibWFkZHJcIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcIm1hZGRyXCIsIHRydWUpLFxuICAgICAgICBmdW5jdGlvbih2aWFfbWFkZHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YS5tYWRkciA9IHZpYV9tYWRkcjsgfSxcbiAgICAgICAgXCJyZWNlaXZlZFwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwicmVjZWl2ZWRcIiwgdHJ1ZSksXG4gICAgICAgIGZ1bmN0aW9uKHZpYV9yZWNlaXZlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kYXRhLnJlY2VpdmVkID0gdmlhX3JlY2VpdmVkOyB9LFxuICAgICAgICBcImJyYW5jaFwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiYnJhbmNoXCIsIHRydWUpLFxuICAgICAgICBmdW5jdGlvbih2aWFfYnJhbmNoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmRhdGEuYnJhbmNoID0gdmlhX2JyYW5jaDsgfSxcbiAgICAgICAgXCJycG9ydFwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwicnBvcnRcIiwgdHJ1ZSksXG4gICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mIHJlc3BvbnNlX3BvcnQgIT09ICd1bmRlZmluZWQnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmRhdGEucnBvcnQgPSByZXNwb25zZV9wb3J0LmpvaW4oJycpOyB9LFxuICAgICAgICBmdW5jdGlvbih2aWFfcHJvdG9jb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YS5wcm90b2NvbCA9IHZpYV9wcm90b2NvbDsgfSxcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcIlVEUFwiLCB0cnVlKSxcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcIlRDUFwiLCB0cnVlKSxcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcIlRMU1wiLCB0cnVlKSxcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcIlNDVFBcIiwgdHJ1ZSksXG4gICAgICAgIGZ1bmN0aW9uKHZpYV90cmFuc3BvcnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YS50cmFuc3BvcnQgPSB2aWFfdHJhbnNwb3J0OyB9LFxuICAgICAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YS5ob3N0ID0gdGV4dCgpOyB9LFxuICAgICAgICBmdW5jdGlvbih2aWFfc2VudF9ieV9wb3J0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmRhdGEucG9ydCA9IHBhcnNlSW50KHZpYV9zZW50X2J5X3BvcnQuam9pbignJykpOyB9LFxuICAgICAgICBmdW5jdGlvbih0dGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUludCh0dGwuam9pbignJykpOyB9LFxuICAgICAgICBmdW5jdGlvbihkZWx0YVNlY29uZHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnN0YXJ0UnVsZSA9PT0gJ1Nlc3Npb25fRXhwaXJlcycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5kYXRhLmRlbHRhU2Vjb25kcyA9IGRlbHRhU2Vjb25kcztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICBcInJlZnJlc2hlclwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwicmVmcmVzaGVyXCIsIGZhbHNlKSxcbiAgICAgICAgXCJ1YXNcIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcInVhc1wiLCBmYWxzZSksXG4gICAgICAgIFwidWFjXCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJ1YWNcIiwgZmFsc2UpLFxuICAgICAgICBmdW5jdGlvbihlbmRwb2ludCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuc3RhcnRSdWxlID09PSAnU2Vzc2lvbl9FeHBpcmVzJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmRhdGEucmVmcmVzaGVyID0gZW5kcG9pbnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24oZGVsdGFTZWNvbmRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5zdGFydFJ1bGUgPT09ICdNaW5fU0UnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YSA9IGRlbHRhU2Vjb25kcztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICBcInN0dW5zXCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJzdHVuc1wiLCB0cnVlKSxcbiAgICAgICAgXCJzdHVuXCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJzdHVuXCIsIHRydWUpLFxuICAgICAgICBmdW5jdGlvbihzY2hlbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YS5zY2hlbWUgPSBzY2hlbWU7IH0sXG4gICAgICAgIGZ1bmN0aW9uKGhvc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YS5ob3N0ID0gaG9zdDsgfSxcbiAgICAgICAgXCI/dHJhbnNwb3J0PVwiLFxuICAgICAgICBwZWckbGl0ZXJhbEV4cGVjdGF0aW9uKFwiP3RyYW5zcG9ydD1cIiwgZmFsc2UpLFxuICAgICAgICBcInR1cm5zXCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJ0dXJuc1wiLCB0cnVlKSxcbiAgICAgICAgXCJ0dXJuXCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJ0dXJuXCIsIHRydWUpLFxuICAgICAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGF0YS50cmFuc3BvcnQgPSB0cmFuc3BvcnQ7IH0sXG4gICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmRhdGEgPSB0ZXh0KCk7IH0sXG4gICAgICAgIFwiUmVmZXJyZWQtQnlcIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcIlJlZmVycmVkLUJ5XCIsIGZhbHNlKSxcbiAgICAgICAgXCJiXCIsXG4gICAgICAgIHBlZyRsaXRlcmFsRXhwZWN0YXRpb24oXCJiXCIsIGZhbHNlKSxcbiAgICAgICAgXCJjaWRcIixcbiAgICAgICAgcGVnJGxpdGVyYWxFeHBlY3RhdGlvbihcImNpZFwiLCBmYWxzZSlcbiAgICAgIF0sXG5cbiAgICAgIHBlZyRieXRlY29kZSA9IFtcbiAgICAgICAgcGVnJGRlY29kZShcIjIgXFxcIlxcXCI2IDchXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiNFxcXCJcXFwiXFxcIjUhNyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCI0JFxcXCJcXFwiNSE3JVwiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIjQmXFxcIlxcXCI1ITcnXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiOycuIyAmOyhcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCI0KFxcXCJcXFwiNSE3KVwiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIjQqXFxcIlxcXCI1ITcrXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiMixcXFwiXFxcIjYsNy1cIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIyLlxcXCJcXFwiNi43L1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIjQwXFxcIlxcXCI1ITcxXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiMjJcXFwiXFxcIjYyNzMuXFx4ODkgJjI0XFxcIlxcXCI2NDc1Ln0gJjI2XFxcIlxcXCI2Njc3LnEgJjI4XFxcIlxcXCI2ODc5LmUgJjI6XFxcIlxcXCI2Ojc7LlkgJjI8XFxcIlxcXCI2PDc9Lk0gJjI+XFxcIlxcXCI2Pjc/LkEgJjJAXFxcIlxcXCI2QDdBLjUgJjJCXFxcIlxcXCI2QjdDLikgJjJEXFxcIlxcXCI2RDdFXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiOykuIyAmOyxcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIyRlxcXCJcXFwiNkY3Ry59ICYySFxcXCJcXFwiNkg3SS5xICYySlxcXCJcXFwiNko3Sy5lICYyTFxcXCJcXFwiNkw3TS5ZICYyTlxcXCJcXFwiNk43Ty5NICYyUFxcXCJcXFwiNlA3US5BICYyUlxcXCJcXFwiNlI3Uy41ICYyVFxcXCJcXFwiNlQ3VS4pICYyVlxcXCJcXFwiNlY3V1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiUlMlhcXFwiXFxcIjZYN1kvNSM7Iy8sJDsjLyMkKyMpKCMnIyhcXFwiJyMmJyMvXFxcIiEmLClcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlJSQ7JDAjKjskJi8sIzsgLyMkK1xcXCIpKFxcXCInIyYnIy5cXFwiICZcXFwiLz0jJDskLyYjMCMqOyQmJiYjLyckOFxcXCI6WlxcXCIgKShcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCI7Li5cXFwiICZcXFwiXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJSQ7Jy4jICY7KDApKjsnLiMgJjsoJi8/IzI4XFxcIlxcXCI2ODc5LzAkOy8vJyQ4IzpbIyApKCMnIyhcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlJSQ7Mi8mIzAjKjsyJiYmIy9nIyQlJDsuMCMqOy4mLywjOzIvIyQrXFxcIikoXFxcIicjJicjMD0qJSQ7LjAjKjsuJi8sIzsyLyMkK1xcXCIpKFxcXCInIyYnIyYvIyQrXFxcIikoXFxcIicjJicjL1xcXCIhJiwpXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiNFxcXFxcXFwiXFxcIjUhN10uIyAmOzNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCI0XlxcXCJcXFwiNSE3X1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIjRgXFxcIlxcXCI1ITdhXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiOyEuKSAmNGJcXFwiXFxcIjUhN2NcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlJDspLlxceDk1ICYyRlxcXCJcXFwiNkY3Ry5cXHg4OSAmMkpcXFwiXFxcIjZKN0sufSAmMkxcXFwiXFxcIjZMN00ucSAmMlhcXFwiXFxcIjZYN1kuZSAmMlBcXFwiXFxcIjZQN1EuWSAmMkhcXFwiXFxcIjZIN0kuTSAmMkBcXFwiXFxcIjZAN0EuQSAmMmRcXFwiXFxcIjZkN2UuNSAmMlJcXFwiXFxcIjZSN1MuKSAmMk5cXFwiXFxcIjZON08vXFx4OUUjMFxceDlCKjspLlxceDk1ICYyRlxcXCJcXFwiNkY3Ry5cXHg4OSAmMkpcXFwiXFxcIjZKN0sufSAmMkxcXFwiXFxcIjZMN00ucSAmMlhcXFwiXFxcIjZYN1kuZSAmMlBcXFwiXFxcIjZQN1EuWSAmMkhcXFwiXFxcIjZIN0kuTSAmMkBcXFwiXFxcIjZAN0EuQSAmMmRcXFwiXFxcIjZkN2UuNSAmMlJcXFwiXFxcIjZSN1MuKSAmMk5cXFwiXFxcIjZON08mJiYjL1xcXCIhJiwpXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJSQ7KS5cXHg4OSAmMkZcXFwiXFxcIjZGN0cufSAmMkxcXFwiXFxcIjZMN00ucSAmMlhcXFwiXFxcIjZYN1kuZSAmMlBcXFwiXFxcIjZQN1EuWSAmMkhcXFwiXFxcIjZIN0kuTSAmMkBcXFwiXFxcIjZAN0EuQSAmMmRcXFwiXFxcIjZkN2UuNSAmMlJcXFwiXFxcIjZSN1MuKSAmMk5cXFwiXFxcIjZON08vXFx4OTIjMFxceDhGKjspLlxceDg5ICYyRlxcXCJcXFwiNkY3Ry59ICYyTFxcXCJcXFwiNkw3TS5xICYyWFxcXCJcXFwiNlg3WS5lICYyUFxcXCJcXFwiNlA3US5ZICYySFxcXCJcXFwiNkg3SS5NICYyQFxcXCJcXFwiNkA3QS5BICYyZFxcXCJcXFwiNmQ3ZS41ICYyUlxcXCJcXFwiNlI3Uy4pICYyTlxcXCJcXFwiNk43TyYmJiMvXFxcIiEmLClcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIyVFxcXCJcXFwiNlQ3VS5cXHhFMyAmMlZcXFwiXFxcIjZWN1cuXFx4RDcgJjJmXFxcIlxcXCI2ZjdnLlxceENCICYyaFxcXCJcXFwiNmg3aS5cXHhCRiAmMjpcXFwiXFxcIjY6NzsuXFx4QjMgJjJEXFxcIlxcXCI2RDdFLlxceEE3ICYyMlxcXCJcXFwiNjI3My5cXHg5QiAmMjhcXFwiXFxcIjY4NzkuXFx4OEYgJjJqXFxcIlxcXCI2ajdrLlxceDgzICY7Ji59ICYyNFxcXCJcXFwiNjQ3NS5xICYybFxcXCJcXFwiNmw3bS5lICYyblxcXCJcXFwiNm43by5ZICYyNlxcXCJcXFwiNjY3Ny5NICYyPlxcXCJcXFwiNj43Py5BICYycFxcXCJcXFwiNnA3cS41ICYyclxcXCJcXFwiNnI3cy4pICY7Jy4jICY7KFwiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiUkOykuXFx1MDEyQiAmMkZcXFwiXFxcIjZGN0cuXFx1MDExRiAmMkpcXFwiXFxcIjZKN0suXFx1MDExMyAmMkxcXFwiXFxcIjZMN00uXFx1MDEwNyAmMlhcXFwiXFxcIjZYN1kuXFx4RkIgJjJQXFxcIlxcXCI2UDdRLlxceEVGICYySFxcXCJcXFwiNkg3SS5cXHhFMyAmMkBcXFwiXFxcIjZAN0EuXFx4RDcgJjJkXFxcIlxcXCI2ZDdlLlxceENCICYyUlxcXCJcXFwiNlI3Uy5cXHhCRiAmMk5cXFwiXFxcIjZON08uXFx4QjMgJjJUXFxcIlxcXCI2VDdVLlxceEE3ICYyVlxcXCJcXFwiNlY3Vy5cXHg5QiAmMmZcXFwiXFxcIjZmN2cuXFx4OEYgJjJoXFxcIlxcXCI2aDdpLlxceDgzICYyOFxcXCJcXFwiNjg3OS53ICYyalxcXCJcXFwiNmo3ay5rICY7Ji5lICYyNFxcXCJcXFwiNjQ3NS5ZICYybFxcXCJcXFwiNmw3bS5NICYyblxcXCJcXFwiNm43by5BICYyNlxcXCJcXFwiNjY3Ny41ICYycFxcXCJcXFwiNnA3cS4pICYyclxcXCJcXFwiNnI3cy9cXHUwMTM0IzBcXHUwMTMxKjspLlxcdTAxMkIgJjJGXFxcIlxcXCI2RjdHLlxcdTAxMUYgJjJKXFxcIlxcXCI2SjdLLlxcdTAxMTMgJjJMXFxcIlxcXCI2TDdNLlxcdTAxMDcgJjJYXFxcIlxcXCI2WDdZLlxceEZCICYyUFxcXCJcXFwiNlA3US5cXHhFRiAmMkhcXFwiXFxcIjZIN0kuXFx4RTMgJjJAXFxcIlxcXCI2QDdBLlxceEQ3ICYyZFxcXCJcXFwiNmQ3ZS5cXHhDQiAmMlJcXFwiXFxcIjZSN1MuXFx4QkYgJjJOXFxcIlxcXCI2TjdPLlxceEIzICYyVFxcXCJcXFwiNlQ3VS5cXHhBNyAmMlZcXFwiXFxcIjZWN1cuXFx4OUIgJjJmXFxcIlxcXCI2ZjdnLlxceDhGICYyaFxcXCJcXFwiNmg3aS5cXHg4MyAmMjhcXFwiXFxcIjY4NzkudyAmMmpcXFwiXFxcIjZqN2suayAmOyYuZSAmMjRcXFwiXFxcIjY0NzUuWSAmMmxcXFwiXFxcIjZsN20uTSAmMm5cXFwiXFxcIjZuN28uQSAmMjZcXFwiXFxcIjY2NzcuNSAmMnBcXFwiXFxcIjZwN3EuKSAmMnJcXFwiXFxcIjZyN3MmJiYjL1xcXCIhJiwpXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTsvLz8jMlBcXFwiXFxcIjZQN1EvMCQ7Ly8nJDgjOnQjICkoIycjKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiU7Ly8/IzI0XFxcIlxcXCI2NDc1LzAkOy8vJyQ4Izp1IyApKCMnIyhcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlOy8vPyMyPlxcXCJcXFwiNj43Py8wJDsvLyckOCM6diMgKSgjJyMoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTsvLz8jMlRcXFwiXFxcIjZUN1UvMCQ7Ly8nJDgjOncjICkoIycjKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiU7Ly8/IzJWXFxcIlxcXCI2VjdXLzAkOy8vJyQ4Izp4IyApKCMnIyhcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlMmhcXFwiXFxcIjZoN2kvMCM7Ly8nJDhcXFwiOnlcXFwiICkoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTsvLzYjMmZcXFwiXFxcIjZmN2cvJyQ4XFxcIjp6XFxcIiApKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiU7Ly8/IzJEXFxcIlxcXCI2RDdFLzAkOy8vJyQ4Izp7IyApKCMnIyhcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlOy8vPyMyMlxcXCJcXFwiNjI3My8wJDsvLyckOCM6fCMgKSgjJyMoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTsvLz8jMjhcXFwiXFxcIjY4NzkvMCQ7Ly8nJDgjOn0jICkoIycjKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiU7Ly8wIzsmLyckOFxcXCI6flxcXCIgKShcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlOyYvMCM7Ly8nJDhcXFwiOn5cXFwiICkoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTs9L1QjJDtHLikgJjtLLiMgJjtGMC8qO0cuKSAmO0suIyAmO0YmLywkOz4vIyQrIykoIycjKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIjRcXHg3RlxcXCJcXFwiNSE3XFx4ODAuQSAmNFxceDgxXFxcIlxcXCI1ITdcXHg4Mi41ICY0XFx4ODNcXFwiXFxcIjUhN1xceDg0LikgJjszLiMgJjsuXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJSU7Ly9RIzsmL0gkJDtKLiMgJjtLMCkqO0ouIyAmO0smLywkOyYvIyQrJCkoJCcjKCMnIyhcXFwiJyMmJyMvXFxcIiEmLClcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlOy8vXSM7Ji9UJCUkO0ouIyAmO0swKSo7Si4jICY7SyYvXFxcIiEmLCkvMSQ7Ji8oJDgkOlxceDg1JCEhKSgkJyMoIycjKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIjsuLkcgJjJMXFxcIlxcXCI2TDdNLjsgJjRcXHg4NlxcXCJcXFwiNSE3XFx4ODcuLyAmNFxceDgzXFxcIlxcXCI1ITdcXHg4NC4jICY7M1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiUyalxcXCJcXFwiNmo3ay9KIzRcXHg4OFxcXCJcXFwiNSE3XFx4ODkuNSAmNFxceDhBXFxcIlxcXCI1ITdcXHg4Qi4pICY0XFx4OENcXFwiXFxcIjUhN1xceDhELyMkK1xcXCIpKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiU7Ti9NIzI4XFxcIlxcXCI2ODc5Lz4kO08uXFxcIiAmXFxcIi8wJDtTLyckOCQ6XFx4OEUkICkoJCcjKCMnIyhcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlO04vZCMyOFxcXCJcXFwiNjg3OS9VJDtPLlxcXCIgJlxcXCIvRyQ7Uy8+JDtfLzUkO2wuXFxcIiAmXFxcIi8nJDgmOlxceDhGJiApKCYnIyglJyMoJCcjKCMnIyhcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlM1xceDkwXFxcIlxcXCI1JDdcXHg5MS4pICYzXFx4OTJcXFwiXFxcIjUjN1xceDkzLycgOCE6XFx4OTQhISApXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTtQL10jJTI4XFxcIlxcXCI2ODc5LywjO1IvIyQrXFxcIikoXFxcIicjJicjLlxcXCIgJlxcXCIvNiQyOlxcXCJcXFwiNjo3Oy8nJDgjOlxceDk1IyApKCMnIyhcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIkOysuKSAmOy0uIyAmO1EvMiMwLyo7Ky4pICY7LS4jICY7USYmJiNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIyPFxcXCJcXFwiNjw3PS5xICYyPlxcXCJcXFwiNj43Py5lICYyQFxcXCJcXFwiNkA3QS5ZICYyQlxcXCJcXFwiNkI3Qy5NICYyRFxcXCJcXFwiNkQ3RS5BICYyMlxcXCJcXFwiNjI3My41ICYyNlxcXCJcXFwiNjY3Ny4pICYyNFxcXCJcXFwiNjQ3NVwiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiUkOysuXyAmOy0uWSAmMjxcXFwiXFxcIjY8Nz0uTSAmMj5cXFwiXFxcIjY+Nz8uQSAmMkBcXFwiXFxcIjZAN0EuNSAmMkJcXFwiXFxcIjZCN0MuKSAmMkRcXFwiXFxcIjZEN0UwZSo7Ky5fICY7LS5ZICYyPFxcXCJcXFwiNjw3PS5NICYyPlxcXCJcXFwiNj43Py5BICYyQFxcXCJcXFwiNkA3QS41ICYyQlxcXCJcXFwiNkI3Qy4pICYyRFxcXCJcXFwiNkQ3RSYvJiA4ITpcXHg5NiEgKVwiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiU7VC9KIyUyOFxcXCJcXFwiNjg3OS8sIzteLyMkK1xcXCIpKFxcXCInIyYnIy5cXFwiICZcXFwiLyMkK1xcXCIpKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiU7VS4pICY7XFxcXC4jICY7WC8mIDghOlxceDk3ISApXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJSQlO1YvMiMySlxcXCJcXFwiNko3Sy8jJCtcXFwiKShcXFwiJyMmJyMwPColO1YvMiMySlxcXCJcXFwiNko3Sy8jJCtcXFwiKShcXFwiJyMmJyMmL0QjO1cvOyQySlxcXCJcXFwiNko3Sy5cXFwiICZcXFwiLyckOCM6XFx4OTgjICkoIycjKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiQ0XFx4OTlcXFwiXFxcIjUhN1xceDlBLywjMCkqNFxceDk5XFxcIlxcXCI1ITdcXHg5QSYmJiNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlNCRcXFwiXFxcIjUhNyUvPyMkNFxceDlCXFxcIlxcXCI1ITdcXHg5QzApKjRcXHg5QlxcXCJcXFwiNSE3XFx4OUMmLyMkK1xcXCIpKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiUybFxcXCJcXFwiNmw3bS8/IztZLzYkMm5cXFwiXFxcIjZuN28vJyQ4IzpcXHg5RCMgKSgjJyMoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJSU7Wi9cXHhCMyMyOFxcXCJcXFwiNjg3OS9cXHhBNCQ7Wi9cXHg5QiQyOFxcXCJcXFwiNjg3OS9cXHg4QyQ7Wi9cXHg4MyQyOFxcXCJcXFwiNjg3OS90JDtaL2skMjhcXFwiXFxcIjY4NzkvXFxcXCQ7Wi9TJDI4XFxcIlxcXCI2ODc5L0QkO1ovOyQyOFxcXCJcXFwiNjg3OS8sJDtbLyMkKy0pKC0nIygsJyMoKycjKConIygpJyMoKCcjKCcnIygmJyMoJScjKCQnIygjJyMoXFxcIicjJicjLlxcdTA3OTAgJiUyXFx4OUVcXFwiXFxcIjZcXHg5RTdcXHg5Ri9cXHhBNCM7Wi9cXHg5QiQyOFxcXCJcXFwiNjg3OS9cXHg4QyQ7Wi9cXHg4MyQyOFxcXCJcXFwiNjg3OS90JDtaL2skMjhcXFwiXFxcIjY4NzkvXFxcXCQ7Wi9TJDI4XFxcIlxcXCI2ODc5L0QkO1ovOyQyOFxcXCJcXFwiNjg3OS8sJDtbLyMkKywpKCwnIygrJyMoKicjKCknIygoJyMoJycjKCYnIyglJyMoJCcjKCMnIyhcXFwiJyMmJyMuXFx1MDZGOSAmJTJcXHg5RVxcXCJcXFwiNlxceDlFN1xceDlGL1xceDhDIztaL1xceDgzJDI4XFxcIlxcXCI2ODc5L3QkO1ovayQyOFxcXCJcXFwiNjg3OS9cXFxcJDtaL1MkMjhcXFwiXFxcIjY4NzkvRCQ7Wi87JDI4XFxcIlxcXCI2ODc5LywkO1svIyQrKikoKicjKCknIygoJyMoJycjKCYnIyglJyMoJCcjKCMnIyhcXFwiJyMmJyMuXFx1MDY3QSAmJTJcXHg5RVxcXCJcXFwiNlxceDlFN1xceDlGL3QjO1ovayQyOFxcXCJcXFwiNjg3OS9cXFxcJDtaL1MkMjhcXFwiXFxcIjY4NzkvRCQ7Wi87JDI4XFxcIlxcXCI2ODc5LywkO1svIyQrKCkoKCcjKCcnIygmJyMoJScjKCQnIygjJyMoXFxcIicjJicjLlxcdTA2MTMgJiUyXFx4OUVcXFwiXFxcIjZcXHg5RTdcXHg5Ri9cXFxcIztaL1MkMjhcXFwiXFxcIjY4NzkvRCQ7Wi87JDI4XFxcIlxcXCI2ODc5LywkO1svIyQrJikoJicjKCUnIygkJyMoIycjKFxcXCInIyYnIy5cXHUwNUM0ICYlMlxceDlFXFxcIlxcXCI2XFx4OUU3XFx4OUYvRCM7Wi87JDI4XFxcIlxcXCI2ODc5LywkO1svIyQrJCkoJCcjKCMnIyhcXFwiJyMmJyMuXFx1MDU4RCAmJTJcXHg5RVxcXCJcXFwiNlxceDlFN1xceDlGLywjO1svIyQrXFxcIikoXFxcIicjJicjLlxcdTA1NkUgJiUyXFx4OUVcXFwiXFxcIjZcXHg5RTdcXHg5Ri8sIztaLyMkK1xcXCIpKFxcXCInIyYnIy5cXHUwNTRGICYlO1ovXFx4OUIjMlxceDlFXFxcIlxcXCI2XFx4OUU3XFx4OUYvXFx4OEMkO1ovXFx4ODMkMjhcXFwiXFxcIjY4NzkvdCQ7Wi9rJDI4XFxcIlxcXCI2ODc5L1xcXFwkO1ovUyQyOFxcXCJcXFwiNjg3OS9EJDtaLzskMjhcXFwiXFxcIjY4NzkvLCQ7Wy8jJCsrKSgrJyMoKicjKCknIygoJyMoJycjKCYnIyglJyMoJCcjKCMnIyhcXFwiJyMmJyMuXFx1MDRDNyAmJTtaL1xceEFBIyUyOFxcXCJcXFwiNjg3OS8sIztaLyMkK1xcXCIpKFxcXCInIyYnIy5cXFwiICZcXFwiL1xceDgzJDJcXHg5RVxcXCJcXFwiNlxceDlFN1xceDlGL3QkO1ovayQyOFxcXCJcXFwiNjg3OS9cXFxcJDtaL1MkMjhcXFwiXFxcIjY4NzkvRCQ7Wi87JDI4XFxcIlxcXCI2ODc5LywkO1svIyQrKikoKicjKCknIygoJyMoJycjKCYnIyglJyMoJCcjKCMnIyhcXFwiJyMmJyMuXFx1MDQzMCAmJTtaL1xceEI5IyUyOFxcXCJcXFwiNjg3OS8sIztaLyMkK1xcXCIpKFxcXCInIyYnIy5cXFwiICZcXFwiL1xceDkyJCUyOFxcXCJcXFwiNjg3OS8sIztaLyMkK1xcXCIpKFxcXCInIyYnIy5cXFwiICZcXFwiL2skMlxceDlFXFxcIlxcXCI2XFx4OUU3XFx4OUYvXFxcXCQ7Wi9TJDI4XFxcIlxcXCI2ODc5L0QkO1ovOyQyOFxcXCJcXFwiNjg3OS8sJDtbLyMkKykpKCknIygoJyMoJycjKCYnIyglJyMoJCcjKCMnIyhcXFwiJyMmJyMuXFx1MDM4QSAmJTtaL1xceEM4IyUyOFxcXCJcXFwiNjg3OS8sIztaLyMkK1xcXCIpKFxcXCInIyYnIy5cXFwiICZcXFwiL1xceEExJCUyOFxcXCJcXFwiNjg3OS8sIztaLyMkK1xcXCIpKFxcXCInIyYnIy5cXFwiICZcXFwiL3okJTI4XFxcIlxcXCI2ODc5LywjO1ovIyQrXFxcIikoXFxcIicjJicjLlxcXCIgJlxcXCIvUyQyXFx4OUVcXFwiXFxcIjZcXHg5RTdcXHg5Ri9EJDtaLzskMjhcXFwiXFxcIjY4NzkvLCQ7Wy8jJCsoKSgoJyMoJycjKCYnIyglJyMoJCcjKCMnIyhcXFwiJyMmJyMuXFx1MDJENSAmJTtaL1xceEQ3IyUyOFxcXCJcXFwiNjg3OS8sIztaLyMkK1xcXCIpKFxcXCInIyYnIy5cXFwiICZcXFwiL1xceEIwJCUyOFxcXCJcXFwiNjg3OS8sIztaLyMkK1xcXCIpKFxcXCInIyYnIy5cXFwiICZcXFwiL1xceDg5JCUyOFxcXCJcXFwiNjg3OS8sIztaLyMkK1xcXCIpKFxcXCInIyYnIy5cXFwiICZcXFwiL2IkJTI4XFxcIlxcXCI2ODc5LywjO1ovIyQrXFxcIikoXFxcIicjJicjLlxcXCIgJlxcXCIvOyQyXFx4OUVcXFwiXFxcIjZcXHg5RTdcXHg5Ri8sJDtbLyMkKycpKCcnIygmJyMoJScjKCQnIygjJyMoXFxcIicjJicjLlxcdTAyMTEgJiU7Wi9cXHhGRSMlMjhcXFwiXFxcIjY4NzkvLCM7Wi8jJCtcXFwiKShcXFwiJyMmJyMuXFxcIiAmXFxcIi9cXHhENyQlMjhcXFwiXFxcIjY4NzkvLCM7Wi8jJCtcXFwiKShcXFwiJyMmJyMuXFxcIiAmXFxcIi9cXHhCMCQlMjhcXFwiXFxcIjY4NzkvLCM7Wi8jJCtcXFwiKShcXFwiJyMmJyMuXFxcIiAmXFxcIi9cXHg4OSQlMjhcXFwiXFxcIjY4NzkvLCM7Wi8jJCtcXFwiKShcXFwiJyMmJyMuXFxcIiAmXFxcIi9iJCUyOFxcXCJcXFwiNjg3OS8sIztaLyMkK1xcXCIpKFxcXCInIyYnIy5cXFwiICZcXFwiLzskMlxceDlFXFxcIlxcXCI2XFx4OUU3XFx4OUYvLCQ7Wi8jJCsoKSgoJyMoJycjKCYnIyglJyMoJCcjKCMnIyhcXFwiJyMmJyMuXFx1MDEyNiAmJTtaL1xcdTAxMUMjJTI4XFxcIlxcXCI2ODc5LywjO1ovIyQrXFxcIikoXFxcIicjJicjLlxcXCIgJlxcXCIvXFx4RjUkJTI4XFxcIlxcXCI2ODc5LywjO1ovIyQrXFxcIikoXFxcIicjJicjLlxcXCIgJlxcXCIvXFx4Q0UkJTI4XFxcIlxcXCI2ODc5LywjO1ovIyQrXFxcIikoXFxcIicjJicjLlxcXCIgJlxcXCIvXFx4QTckJTI4XFxcIlxcXCI2ODc5LywjO1ovIyQrXFxcIikoXFxcIicjJicjLlxcXCIgJlxcXCIvXFx4ODAkJTI4XFxcIlxcXCI2ODc5LywjO1ovIyQrXFxcIikoXFxcIicjJicjLlxcXCIgJlxcXCIvWSQlMjhcXFwiXFxcIjY4NzkvLCM7Wi8jJCtcXFwiKShcXFwiJyMmJyMuXFxcIiAmXFxcIi8yJDJcXHg5RVxcXCJcXFwiNlxceDlFN1xceDlGLyMkKygpKCgnIygnJyMoJicjKCUnIygkJyMoIycjKFxcXCInIyYnIy8mIDghOlxceEEwISApXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTsjL00jOyMuXFxcIiAmXFxcIi8/JDsjLlxcXCIgJlxcXCIvMSQ7Iy5cXFwiICZcXFwiLyMkKyQpKCQnIygjJyMoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTtaLzsjMjhcXFwiXFxcIjY4NzkvLCQ7Wi8jJCsjKSgjJyMoXFxcIicjJicjLiMgJjtcXFxcXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTtdL28jMkpcXFwiXFxcIjZKN0svYCQ7XS9XJDJKXFxcIlxcXCI2SjdLL0gkO10vPyQySlxcXCJcXFwiNko3Sy8wJDtdLyckOCc6XFx4QTEnICkoJycjKCYnIyglJyMoJCcjKCMnIyhcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlMlxceEEyXFxcIlxcXCI2XFx4QTI3XFx4QTMvMiM0XFx4QTRcXFwiXFxcIjUhN1xceEE1LyMkK1xcXCIpKFxcXCInIyYnIy5cXHg5OCAmJTJcXHhBNlxcXCJcXFwiNlxceEE2N1xceEE3LzsjNFxceEE4XFxcIlxcXCI1ITdcXHhBOS8sJDshLyMkKyMpKCMnIyhcXFwiJyMmJyMuaiAmJTJcXHhBQVxcXCJcXFwiNlxceEFBN1xceEFCLzUjOyEvLCQ7IS8jJCsjKSgjJyMoXFxcIicjJicjLkIgJiU0XFx4QUNcXFwiXFxcIjUhN1xceEFELywjOyEvIyQrXFxcIikoXFxcIicjJicjLiMgJjshXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJSU7IS5cXFwiICZcXFwiL1sjOyEuXFxcIiAmXFxcIi9NJDshLlxcXCIgJlxcXCIvPyQ7IS5cXFwiICZcXFwiLzEkOyEuXFxcIiAmXFxcIi8jJCslKSglJyMoJCcjKCMnIyhcXFwiJyMmJyMvJyA4ITpcXHhBRSEhIClcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIkJTIyXFxcIlxcXCI2MjczLywjO2AvIyQrXFxcIikoXFxcIicjJicjMDwqJTIyXFxcIlxcXCI2MjczLywjO2AvIyQrXFxcIikoXFxcIicjJicjJlwiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIjthLkEgJjtiLjsgJjtjLjUgJjtkLi8gJjtlLikgJjtmLiMgJjtnXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTNcXHhBRlxcXCJcXFwiNSo3XFx4QjAvYSMzXFx4QjFcXFwiXFxcIjUjN1xceEIyLkcgJjNcXHhCM1xcXCJcXFwiNSM3XFx4QjQuOyAmM1xceEI1XFxcIlxcXCI1JDdcXHhCNi4vICYzXFx4QjdcXFwiXFxcIjUjN1xceEI4LiMgJjs2LygkOFxcXCI6XFx4QjlcXFwiISApKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiUzXFx4QkFcXFwiXFxcIjUlN1xceEJCL0kjM1xceEJDXFxcIlxcXCI1JTdcXHhCRC4vICYzXFx4QkVcXFwiXFxcIjVcXFwiN1xceEJGLiMgJjs2LygkOFxcXCI6XFx4QzBcXFwiISApKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiUzXFx4QzFcXFwiXFxcIjUnN1xceEMyLzEjO1xceDkwLygkOFxcXCI6XFx4QzNcXFwiISApKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiUzXFx4QzRcXFwiXFxcIjUkN1xceEM1LzEjO1xceEYwLygkOFxcXCI6XFx4QzZcXFwiISApKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiUzXFx4QzdcXFwiXFxcIjUmN1xceEM4LzEjO1QvKCQ4XFxcIjpcXHhDOVxcXCIhICkoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTNcXHhDQVxcXCJcXFwiNVxcXCI3XFx4Q0IvTiMlMj5cXFwiXFxcIjY+Nz8vLCM7Ni8jJCtcXFwiKShcXFwiJyMmJyMuXFxcIiAmXFxcIi8nJDhcXFwiOlxceENDXFxcIiApKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiU7aC9QIyUyPlxcXCJcXFwiNj43Py8sIztpLyMkK1xcXCIpKFxcXCInIyYnIy5cXFwiICZcXFwiLykkOFxcXCI6XFx4Q0RcXFwiXFxcIiEgKShcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlJDtqLyYjMCMqO2omJiYjL1xcXCIhJiwpXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJSQ7ai8mIzAjKjtqJiYmIy9cXFwiISYsKVwiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIjtrLikgJjsrLiMgJjstXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiMmxcXFwiXFxcIjZsN20uZSAmMm5cXFwiXFxcIjZuN28uWSAmMjRcXFwiXFxcIjY0NzUuTSAmMjhcXFwiXFxcIjY4NzkuQSAmMjxcXFwiXFxcIjY8Nz0uNSAmMkBcXFwiXFxcIjZAN0EuKSAmMkJcXFwiXFxcIjZCN0NcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlMjZcXFwiXFxcIjY2NzcvbiM7bS9lJCQlMjxcXFwiXFxcIjY8Nz0vLCM7bS8jJCtcXFwiKShcXFwiJyMmJyMwPColMjxcXFwiXFxcIjY8Nz0vLCM7bS8jJCtcXFwiKShcXFwiJyMmJyMmLyMkKyMpKCMnIyhcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlO24vQSMyPlxcXCJcXFwiNj43Py8yJDtvLykkOCM6XFx4Q0UjXFxcIlxcXCIgKSgjJyMoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJDtwLikgJjsrLiMgJjstLzIjMC8qO3AuKSAmOysuIyAmOy0mJiYjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJDtwLikgJjsrLiMgJjstMC8qO3AuKSAmOysuIyAmOy0mXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiMmxcXFwiXFxcIjZsN20uZSAmMm5cXFwiXFxcIjZuN28uWSAmMjRcXFwiXFxcIjY0NzUuTSAmMjZcXFwiXFxcIjY2NzcuQSAmMjhcXFwiXFxcIjY4NzkuNSAmMkBcXFwiXFxcIjZAN0EuKSAmMkJcXFwiXFxcIjZCN0NcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCI7XFx4OTEuIyAmO3JcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlO1xceDkwL0cjOycvPiQ7cy81JDsnLywkO1xceDg0LyMkKyUpKCUnIygkJyMoIycjKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIjtNLiMgJjt0XCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTtcXHg3Ri9FIzI4XFxcIlxcXCI2ODc5LzYkO3UuIyAmO3gvJyQ4IzpcXHhDRiMgKSgjJyMoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTt2LiMgJjt3L0ojJTI2XFxcIlxcXCI2Njc3LywjO1xceDgzLyMkK1xcXCIpKFxcXCInIyYnIy5cXFwiICZcXFwiLyMkK1xcXCIpKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiUyXFx4RDBcXFwiXFxcIjZcXHhEMDdcXHhEMS86IztcXHg4MC8xJDt3LlxcXCIgJlxcXCIvIyQrIykoIycjKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiUyNFxcXCJcXFwiNjQ3NS8sIzt7LyMkK1xcXCIpKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiU7ei8zIyQ7eTAjKjt5Ji8jJCtcXFwiKShcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCI7Ki4pICY7Ky4jICY7LVwiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIjsrLlxceDhGICY7LS5cXHg4OSAmMjJcXFwiXFxcIjYyNzMufSAmMjZcXFwiXFxcIjY2NzcucSAmMjhcXFwiXFxcIjY4NzkuZSAmMjpcXFwiXFxcIjY6NzsuWSAmMjxcXFwiXFxcIjY8Nz0uTSAmMj5cXFwiXFxcIjY+Nz8uQSAmMkBcXFwiXFxcIjZAN0EuNSAmMkJcXFwiXFxcIjZCN0MuKSAmMkRcXFwiXFxcIjZEN0VcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlO3wvZSMkJTI0XFxcIlxcXCI2NDc1LywjO3wvIyQrXFxcIikoXFxcIicjJicjMDwqJTI0XFxcIlxcXCI2NDc1LywjO3wvIyQrXFxcIikoXFxcIicjJicjJi8jJCtcXFwiKShcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlJDt+MCMqO34mL2UjJCUyMlxcXCJcXFwiNjI3My8sIzt9LyMkK1xcXCIpKFxcXCInIyYnIzA8KiUyMlxcXCJcXFwiNjI3My8sIzt9LyMkK1xcXCIpKFxcXCInIyYnIyYvIyQrXFxcIikoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJDt+MCMqO34mXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiOysudyAmOy0ucSAmMjhcXFwiXFxcIjY4NzkuZSAmMjpcXFwiXFxcIjY6NzsuWSAmMjxcXFwiXFxcIjY8Nz0uTSAmMj5cXFwiXFxcIjY+Nz8uQSAmMkBcXFwiXFxcIjZAN0EuNSAmMkJcXFwiXFxcIjZCN0MuKSAmMkRcXFwiXFxcIjZEN0VcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlJTtcXFwiL1xceDg3IyQ7XFxcIi5HICY7IS5BICYyQFxcXCJcXFwiNkA3QS41ICYyRlxcXCJcXFwiNkY3Ry4pICYySlxcXCJcXFwiNko3SzBNKjtcXFwiLkcgJjshLkEgJjJAXFxcIlxcXCI2QDdBLjUgJjJGXFxcIlxcXCI2RjdHLikgJjJKXFxcIlxcXCI2SjdLJi8jJCtcXFwiKShcXFwiJyMmJyMvJiA4ITpcXHhEMiEgKVwiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIjtcXHg4MS4jICY7XFx4ODJcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlJTtPLzIjMjpcXFwiXFxcIjY6NzsvIyQrXFxcIikoXFxcIicjJicjLlxcXCIgJlxcXCIvLCM7Uy8jJCtcXFwiKShcXFwiJyMmJyMuXFxcIiAmXFxcIlwiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiQ7Ky5cXHg4MyAmOy0ufSAmMkJcXFwiXFxcIjZCN0MucSAmMkRcXFwiXFxcIjZEN0UuZSAmMjJcXFwiXFxcIjYyNzMuWSAmMjhcXFwiXFxcIjY4NzkuTSAmMjpcXFwiXFxcIjY6NzsuQSAmMjxcXFwiXFxcIjY8Nz0uNSAmMj5cXFwiXFxcIjY+Nz8uKSAmMkBcXFwiXFxcIjZAN0EvXFx4OEMjMFxceDg5KjsrLlxceDgzICY7LS59ICYyQlxcXCJcXFwiNkI3Qy5xICYyRFxcXCJcXFwiNkQ3RS5lICYyMlxcXCJcXFwiNjI3My5ZICYyOFxcXCJcXFwiNjg3OS5NICYyOlxcXCJcXFwiNjo3Oy5BICYyPFxcXCJcXFwiNjw3PS41ICYyPlxcXCJcXFwiNj43Py4pICYyQFxcXCJcXFwiNkA3QSYmJiNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIkO3kwIyo7eSZcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlM1xceDkyXFxcIlxcXCI1IzdcXHhEMy9xIzI0XFxcIlxcXCI2NDc1L2IkJDshLyYjMCMqOyEmJiYjL0wkMkpcXFwiXFxcIjZKN0svPSQkOyEvJiMwIyo7ISYmJiMvJyQ4JTpcXHhENCUgKSglJyMoJCcjKCMnIyhcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIyXFx4RDVcXFwiXFxcIjZcXHhENTdcXHhENlwiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIjJcXHhEN1xcXCJcXFwiNlxceEQ3N1xceEQ4XCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiMlxceEQ5XFxcIlxcXCI2XFx4RDk3XFx4REFcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIyXFx4REJcXFwiXFxcIjZcXHhEQjdcXHhEQ1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIjJcXHhERFxcXCJcXFwiNlxceEREN1xceERFXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiMlxceERGXFxcIlxcXCI2XFx4REY3XFx4RTBcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIyXFx4RTFcXFwiXFxcIjZcXHhFMTdcXHhFMlwiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIjJcXHhFM1xcXCJcXFwiNlxceEUzN1xceEU0XCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiMlxceEU1XFxcIlxcXCI2XFx4RTU3XFx4RTZcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIyXFx4RTdcXFwiXFxcIjZcXHhFNzdcXHhFOFwiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIjJcXHhFOVxcXCJcXFwiNlxceEU5N1xceEVBXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTtcXHg4NS5ZICY7XFx4ODYuUyAmO1xceDg4Lk0gJjtcXHg4OS5HICY7XFx4OEEuQSAmO1xceDhCLjsgJjtcXHg4Qy41ICY7XFx4OEYuLyAmO1xceDhELikgJjtcXHg4RS4jICY7Ni8mIDghOlxceEVCISApXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTtcXHg4NC9HIzsnLz4kO1xceDkyLzUkOycvLCQ7XFx4OTQvIyQrJSkoJScjKCQnIygjJyMoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTtcXHg5My8nIDghOlxceEVDISEgKVwiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiU7IS81IzshLywkOyEvIyQrIykoIycjKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiUkOyouQSAmOysuOyAmOy0uNSAmOzMuLyAmOzQuKSAmOycuIyAmOygwRyo7Ki5BICY7Ky47ICY7LS41ICY7My4vICY7NC4pICY7Jy4jICY7KCYvJiA4ITpcXHhFRCEgKVwiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiU7XFx4QjYvWSMkJTtBLywjO1xceEI2LyMkK1xcXCIpKFxcXCInIyYnIzA2KiU7QS8sIztcXHhCNi8jJCtcXFwiKShcXFwiJyMmJyMmLyMkK1xcXCIpKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiU7OS9OIyUyOlxcXCJcXFwiNjo3Oy8sIzs5LyMkK1xcXCIpKFxcXCInIyYnIy5cXFwiICZcXFwiLyckOFxcXCI6XFx4RUVcXFwiICkoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTs6LmMgJiU7XFx4OTgvWSMkJTtBLywjO1xceDk4LyMkK1xcXCIpKFxcXCInIyYnIzA2KiU7QS8sIztcXHg5OC8jJCtcXFwiKShcXFwiJyMmJyMmLyMkK1xcXCIpKFxcXCInIyYnIy8mIDghOlxceEVGISApXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTtMLiMgJjtcXHg5OS9dIyQlO0IvLCM7XFx4OUIvIyQrXFxcIikoXFxcIicjJicjMDYqJTtCLywjO1xceDlCLyMkK1xcXCIpKFxcXCInIyYnIyYvJyQ4XFxcIjpcXHhGMFxcXCIgKShcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlO1xceDlBLlxcXCIgJlxcXCIvPiM7QC81JDtNLywkOz8vIyQrJCkoJCcjKCMnIyhcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlJTs2L1kjJCU7Li8sIzs2LyMkK1xcXCIpKFxcXCInIyYnIzA2KiU7Li8sIzs2LyMkK1xcXCIpKFxcXCInIyYnIyYvIyQrXFxcIikoXFxcIicjJicjLiMgJjtILycgOCE6XFx4RjEhISApXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiO1xceDlDLikgJjtcXHg5RC4jICY7XFx4QTBcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlM1xceEYyXFxcIlxcXCI1ITdcXHhGMy86Izs8LzEkO1xceDlGLygkOCM6XFx4RjQjISApKCMnIyhcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlM1xceEY1XFxcIlxcXCI1JzdcXHhGNi86Izs8LzEkO1xceDlFLygkOCM6XFx4RjcjISApKCMnIyhcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlJDshLyYjMCMqOyEmJiYjLycgOCE6XFx4RjghISApXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTJcXHhGOVxcXCJcXFwiNlxceEY5N1xceEZBL28jJTJKXFxcIlxcXCI2SjdLL00jOyEuXFxcIiAmXFxcIi8/JDshLlxcXCIgJlxcXCIvMSQ7IS5cXFwiICZcXFwiLyMkKyQpKCQnIygjJyMoXFxcIicjJicjLlxcXCIgJlxcXCIvJyQ4XFxcIjpcXHhGQlxcXCIgKShcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlOzYvSiMlOzwvLCM7XFx4QTEvIyQrXFxcIikoXFxcIicjJicjLlxcXCIgJlxcXCIvKSQ4XFxcIjpcXHhGQ1xcXCJcXFwiISApKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIjs2LikgJjtULiMgJjtIXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTtcXHhBMy9ZIyQlO0IvLCM7XFx4QTQvIyQrXFxcIikoXFxcIicjJicjMDYqJTtCLywjO1xceEE0LyMkK1xcXCIpKFxcXCInIyYnIyYvIyQrXFxcIikoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTNcXHhGRFxcXCJcXFwiNSY3XFx4RkUuRyAmM1xceEZGXFxcIlxcXCI1JzdcXHUwMTAwLjsgJjNcXHUwMTAxXFxcIlxcXCI1JDdcXHUwMTAyLi8gJjNcXHUwMTAzXFxcIlxcXCI1JTdcXHUwMTA0LiMgJjs2LyYgOCE6XFx1MDEwNSEgKVwiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIjtcXHhBNS4jICY7XFx4QTBcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlM1xcdTAxMDZcXFwiXFxcIjUoN1xcdTAxMDcvTSM7PC9EJDNcXHUwMTA4XFxcIlxcXCI1KDdcXHUwMTA5Li8gJjNcXHUwMTBBXFxcIlxcXCI1KDdcXHUwMTBCLiMgJjs2LyMkKyMpKCMnIyhcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlOzYvWSMkJTtBLywjOzYvIyQrXFxcIikoXFxcIicjJicjMDYqJTtBLywjOzYvIyQrXFxcIikoXFxcIicjJicjJi8jJCtcXFwiKShcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlJDshLyYjMCMqOyEmJiYjLycgOCE6XFx1MDEwQyEhIClcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlO1xceEE5LyYgOCE6XFx1MDEwRCEgKVwiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiU7XFx4QUEvayM7Oy9iJDtcXHhBRi9ZJCQlO0IvLCM7XFx4QjAvIyQrXFxcIikoXFxcIicjJicjMDYqJTtCLywjO1xceEIwLyMkK1xcXCIpKFxcXCInIyYnIyYvIyQrJCkoJCcjKCMnIyhcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCI7XFx4QUIuIyAmO1xceEFDXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiM1xcdTAxMEVcXFwiXFxcIjUkN1xcdTAxMEYuUyAmM1xcdTAxMTBcXFwiXFxcIjUlN1xcdTAxMTEuRyAmM1xcdTAxMTJcXFwiXFxcIjUlN1xcdTAxMTMuOyAmM1xcdTAxMTRcXFwiXFxcIjUlN1xcdTAxMTUuLyAmM1xcdTAxMTZcXFwiXFxcIjUrN1xcdTAxMTcuIyAmO1xceEFEXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiM1xcdTAxMThcXFwiXFxcIjUnN1xcdTAxMTkuLyAmM1xcdTAxMUFcXFwiXFxcIjUpN1xcdTAxMUIuIyAmO1xceEFEXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiOzYuIyAmO1xceEFFXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTNcXHUwMTFDXFxcIlxcXCI1XFxcIjdcXHUwMTFELywjOzYvIyQrXFxcIikoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiO1xceEFELiMgJjs2XCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTs2LzUjOzwvLCQ7XFx4QjEvIyQrIykoIycjKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIjs2LiMgJjtIXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTtcXHhCMy81IzsuLywkO1xceDkwLyMkKyMpKCMnIyhcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlJDshLyYjMCMqOyEmJiYjLycgOCE6XFx1MDExRSEhIClcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlO1xceDlFLycgOCE6XFx1MDExRiEhIClcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlO1xceEI2L14jJCU7Qi8sIztcXHhBMC8jJCtcXFwiKShcXFwiJyMmJyMwNiolO0IvLCM7XFx4QTAvIyQrXFxcIikoXFxcIicjJicjJi8oJDhcXFwiOlxcdTAxMjBcXFwiISEpKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiUlOzcvZSMkJTJKXFxcIlxcXCI2SjdLLywjOzcvIyQrXFxcIikoXFxcIicjJicjMDwqJTJKXFxcIlxcXCI2SjdLLywjOzcvIyQrXFxcIikoXFxcIicjJicjJi8jJCtcXFwiKShcXFwiJyMmJyMvXFxcIiEmLClcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlO0wuIyAmO1xceDk5L10jJCU7Qi8sIztcXHhCOC8jJCtcXFwiKShcXFwiJyMmJyMwNiolO0IvLCM7XFx4QjgvIyQrXFxcIikoXFxcIicjJicjJi8nJDhcXFwiOlxcdTAxMjFcXFwiICkoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiO1xceEI5LiMgJjtcXHhBMFwiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiUzXFx1MDEyMlxcXCJcXFwiNSM3XFx1MDEyMy86Izs8LzEkOzYvKCQ4IzpcXHUwMTI0IyEgKSgjJyMoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJSQ7IS8mIzAjKjshJiYmIy8nIDghOlxcdTAxMjUhISApXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTtcXHg5RS8nIDghOlxcdTAxMjYhISApXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJSQ7XFx4OUEwIyo7XFx4OUEmL3gjO0AvbyQ7TS9mJDs/L10kJCU7Qi8sIztcXHhBMC8jJCtcXFwiKShcXFwiJyMmJyMwNiolO0IvLCM7XFx4QTAvIyQrXFxcIikoXFxcIicjJicjJi8nJDglOlxcdTAxMjclICkoJScjKCQnIygjJyMoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiO1xceEJFXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTNcXHUwMTI4XFxcIlxcXCI1JjdcXHUwMTI5L2sjOy4vYiQ7XFx4QzEvWSQkJTtBLywjO1xceEMxLyMkK1xcXCIpKFxcXCInIyYnIzA2KiU7QS8sIztcXHhDMS8jJCtcXFwiKShcXFwiJyMmJyMmLyMkKyQpKCQnIygjJyMoXFxcIicjJicjLiMgJjtcXHhCRlwiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiU7Ni9rIzsuL2IkO1xceEMwL1kkJCU7QS8sIztcXHhDMC8jJCtcXFwiKShcXFwiJyMmJyMwNiolO0EvLCM7XFx4QzAvIyQrXFxcIikoXFxcIicjJicjJi8jJCskKSgkJyMoIycjKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiU7Ni87Izs8LzIkOzYuIyAmO0gvIyQrIykoIycjKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIjtcXHhDMi5HICY7XFx4QzQuQSAmO1xceEM2LjsgJjtcXHhDOC41ICY7XFx4QzkuLyAmO1xceENBLikgJjtcXHhDQi4jICY7XFx4QzBcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlM1xcdTAxMkFcXFwiXFxcIjUlN1xcdTAxMkIvNSM7PC8sJDtcXHhDMy8jJCsjKSgjJyMoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTtJLycgOCE6XFx1MDEyQyEhIClcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlM1xcdTAxMkRcXFwiXFxcIjUmN1xcdTAxMkUvXFx4OTcjOzwvXFx4OEUkO0QvXFx4ODUkO1xceEM1L3wkJCUkOycvJiMwIyo7JyYmJiMvLCM7XFx4QzUvIyQrXFxcIikoXFxcIicjJicjMEMqJSQ7Jy8mIzAjKjsnJiYmIy8sIztcXHhDNS8jJCtcXFwiKShcXFwiJyMmJyMmLywkO0UvIyQrJikoJicjKCUnIygkJyMoIycjKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIjt0LiMgJjt3XCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTNcXHUwMTJGXFxcIlxcXCI1JTdcXHUwMTMwLzUjOzwvLCQ7XFx4QzcvIyQrIykoIycjKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiU7SS8nIDghOlxcdTAxMzEhISApXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTNcXHUwMTMyXFxcIlxcXCI1JjdcXHUwMTMzLzojOzwvMSQ7SS8oJDgjOlxcdTAxMzQjISApKCMnIyhcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlM1xcdTAxMzVcXFwiXFxcIjUlN1xcdTAxMzYvXSM7PC9UJCUzXFx1MDEzN1xcXCJcXFwiNSQ3XFx1MDEzOC8mIDghOlxcdTAxMzkhICkuNCAmJTNcXHUwMTNBXFxcIlxcXCI1JTdcXHUwMTNCLyYgOCE6XFx1MDEzQyEgKS8jJCsjKSgjJyMoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTNcXHUwMTNEXFxcIlxcXCI1KTdcXHUwMTNFL1IjOzwvSSQzXFx1MDEzRlxcXCJcXFwiNSM3XFx1MDE0MC4vICYzXFx1MDE0MVxcXCJcXFwiNSg3XFx1MDE0Mi4jICY7Ni8oJDgjOlxcdTAxNDMjISApKCMnIyhcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlM1xcdTAxNDRcXFwiXFxcIjUjN1xcdTAxNDUvXFx4OTMjOzwvXFx4OEEkO0QvXFx4ODEkJTtcXHhDQy9lIyQlMkRcXFwiXFxcIjZEN0UvLCM7XFx4Q0MvIyQrXFxcIikoXFxcIicjJicjMDwqJTJEXFxcIlxcXCI2RDdFLywjO1xceENDLyMkK1xcXCIpKFxcXCInIyYnIyYvIyQrXFxcIikoXFxcIicjJicjLywkO0UvIyQrJSkoJScjKCQnIygjJyMoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTNcXHUwMTQ2XFxcIlxcXCI1KDdcXHUwMTQ3Li8gJjNcXHUwMTQ4XFxcIlxcXCI1JDdcXHUwMTQ5LiMgJjs2LycgOCE6XFx1MDE0QSEhIClcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlOzYvWSMkJTtBLywjOzYvIyQrXFxcIikoXFxcIicjJicjMDYqJTtBLywjOzYvIyQrXFxcIikoXFxcIicjJicjJi8jJCtcXFwiKShcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlO1xceENGL0cjOy4vPiQ7XFx4Q0YvNSQ7Li8sJDtcXHg5MC8jJCslKSglJyMoJCcjKCMnIyhcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlJDshLyYjMCMqOyEmJiYjLycgOCE6XFx1MDE0QiEhIClcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlO1xceEQxL10jJCU7QS8sIztcXHhEMS8jJCtcXFwiKShcXFwiJyMmJyMwNiolO0EvLCM7XFx4RDEvIyQrXFxcIikoXFxcIicjJicjJi8nJDhcXFwiOlxcdTAxNENcXFwiICkoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTtcXHg5OS9dIyQlO0IvLCM7XFx4QTAvIyQrXFxcIikoXFxcIicjJicjMDYqJTtCLywjO1xceEEwLyMkK1xcXCIpKFxcXCInIyYnIyYvJyQ4XFxcIjpcXHUwMTREXFxcIiApKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiU7TC5PICY7XFx4OTkuSSAmJTtALlxcXCIgJlxcXCIvOiM7dC8xJDs/LlxcXCIgJlxcXCIvIyQrIykoIycjKFxcXCInIyYnIy9dIyQlO0IvLCM7XFx4QTAvIyQrXFxcIikoXFxcIicjJicjMDYqJTtCLywjO1xceEEwLyMkK1xcXCIpKFxcXCInIyYnIyYvJyQ4XFxcIjpcXHUwMTRFXFxcIiApKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiU7XFx4RDQvXSMkJTtCLywjO1xceEQ1LyMkK1xcXCIpKFxcXCInIyYnIzA2KiU7Qi8sIztcXHhENS8jJCtcXFwiKShcXFwiJyMmJyMmLyckOFxcXCI6XFx1MDE0RlxcXCIgKShcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlO1xceDk2LyYgOCE6XFx1MDE1MCEgKVwiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiUzXFx1MDE1MVxcXCJcXFwiNSg3XFx1MDE1Mi86Izs8LzEkOzYvKCQ4IzpcXHUwMTUzIyEgKSgjJyMoXFxcIicjJicjLmcgJiUzXFx1MDE1NFxcXCJcXFwiNSY3XFx1MDE1NS86Izs8LzEkOzYvKCQ4IzpcXHUwMTU2IyEgKSgjJyMoXFxcIicjJicjLjogJiUzXFx1MDE1N1xcXCJcXFwiNSo3XFx1MDE1OC8mIDghOlxcdTAxNTkhICkuIyAmO1xceEEwXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJSU7Ni9rIyQlO0EvMiM7Ni8pJDhcXFwiOlxcdTAxNUFcXFwiXFxcIiQgKShcXFwiJyMmJyMwPColO0EvMiM7Ni8pJDhcXFwiOlxcdTAxNUFcXFwiXFxcIiQgKShcXFwiJyMmJyMmLykkOFxcXCI6XFx1MDE1QlxcXCJcXFwiISApKFxcXCInIyYnIy5cXFwiICZcXFwiLycgOCE6XFx1MDE1QyEhIClcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlO1xceEQ4L1kjJCU7QS8sIztcXHhEOC8jJCtcXFwiKShcXFwiJyMmJyMwNiolO0EvLCM7XFx4RDgvIyQrXFxcIikoXFxcIicjJicjJi8jJCtcXFwiKShcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlO1xceDk5L1kjJCU7Qi8sIztcXHhBMC8jJCtcXFwiKShcXFwiJyMmJyMwNiolO0IvLCM7XFx4QTAvIyQrXFxcIikoXFxcIicjJicjJi8jJCtcXFwiKShcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlJDshLyYjMCMqOyEmJiYjLycgOCE6XFx1MDE1RCEhIClcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlO1xceERCL1kjJCU7Qi8sIztcXHhEQy8jJCtcXFwiKShcXFwiJyMmJyMwNiolO0IvLCM7XFx4REMvIyQrXFxcIikoXFxcIicjJicjJi8jJCtcXFwiKShcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlM1xcdTAxNUVcXFwiXFxcIjUmN1xcdTAxNUYuOyAmM1xcdTAxNjBcXFwiXFxcIjUnN1xcdTAxNjEuLyAmM1xcdTAxNjJcXFwiXFxcIjUqN1xcdTAxNjMuIyAmOzYvJiA4ITpcXHUwMTY0ISApXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTNcXHUwMTY1XFxcIlxcXCI1JjdcXHUwMTY2LzojOzwvMSQ7XFx4REQvKCQ4IzpcXHUwMTY3IyEgKSgjJyMoXFxcIicjJicjLn0gJiUzXFx4RjVcXFwiXFxcIjUnN1xceEY2LzojOzwvMSQ7XFx4OUUvKCQ4IzpcXHUwMTY4IyEgKSgjJyMoXFxcIicjJicjLlAgJiUzXFx1MDE2OVxcXCJcXFwiNSs3XFx1MDE2QS86Izs8LzEkO1xceDlFLygkOCM6XFx1MDE2QiMhICkoIycjKFxcXCInIyYnIy4jICY7XFx4QTBcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIzXFx1MDE2Q1xcXCJcXFwiNSs3XFx1MDE2RC5rICYzXFx1MDE2RVxcXCJcXFwiNSk3XFx1MDE2Ri5fICYzXFx1MDE3MFxcXCJcXFwiNSg3XFx1MDE3MS5TICYzXFx1MDE3MlxcXCJcXFwiNSc3XFx1MDE3My5HICYzXFx1MDE3NFxcXCJcXFwiNSY3XFx1MDE3NS47ICYzXFx1MDE3NlxcXCJcXFwiNSo3XFx1MDE3Ny4vICYzXFx1MDE3OFxcXCJcXFwiNSk3XFx1MDE3OS4jICY7NlwiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIjsxLlxcXCIgJlxcXCJcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlJTs2L2sjJCU7QS8yIzs2LykkOFxcXCI6XFx1MDE1QVxcXCJcXFwiJCApKFxcXCInIyYnIzA8KiU7QS8yIzs2LykkOFxcXCI6XFx1MDE1QVxcXCJcXFwiJCApKFxcXCInIyYnIyYvKSQ4XFxcIjpcXHUwMTVCXFxcIlxcXCIhICkoXFxcIicjJicjLlxcXCIgJlxcXCIvJyA4ITpcXHUwMTdBISEgKVwiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiU7TC4jICY7XFx4OTkvXSMkJTtCLywjO1xceEUxLyMkK1xcXCIpKFxcXCInIyYnIzA2KiU7Qi8sIztcXHhFMS8jJCtcXFwiKShcXFwiJyMmJyMmLyckOFxcXCI6XFx1MDE3QlxcXCIgKShcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCI7XFx4QjkuIyAmO1xceEEwXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTtcXHhFMy9ZIyQlO0EvLCM7XFx4RTMvIyQrXFxcIikoXFxcIicjJicjMDYqJTtBLywjO1xceEUzLyMkK1xcXCIpKFxcXCInIyYnIyYvIyQrXFxcIikoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTtcXHhFQS9rIzsuL2IkO1xceEVEL1kkJCU7Qi8sIztcXHhFNC8jJCtcXFwiKShcXFwiJyMmJyMwNiolO0IvLCM7XFx4RTQvIyQrXFxcIikoXFxcIicjJicjJi8jJCskKSgkJyMoIycjKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIjtcXHhFNS47ICY7XFx4RTYuNSAmO1xceEU3Li8gJjtcXHhFOC4pICY7XFx4RTkuIyAmO1xceEEwXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTNcXHUwMTdDXFxcIlxcXCI1IzdcXHUwMTdELzojOzwvMSQ7XFx4RjAvKCQ4IzpcXHUwMTdFIyEgKSgjJyMoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTNcXHUwMTdGXFxcIlxcXCI1JTdcXHUwMTgwLzojOzwvMSQ7VC8oJDgjOlxcdTAxODEjISApKCMnIyhcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlM1xcdTAxODJcXFwiXFxcIjUoN1xcdTAxODMvRiM7PC89JDtcXFxcLikgJjtZLiMgJjtYLygkOCM6XFx1MDE4NCMhICkoIycjKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiUzXFx1MDE4NVxcXCJcXFwiNSY3XFx1MDE4Ni86Izs8LzEkOzYvKCQ4IzpcXHUwMTg3IyEgKSgjJyMoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTNcXHUwMTg4XFxcIlxcXCI1JTdcXHUwMTg5L08jJTs8LzMjJDshMCMqOyEmLyMkK1xcXCIpKFxcXCInIyYnIy5cXFwiICZcXFwiLyckOFxcXCI6XFx1MDE4QVxcXCIgKShcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlO1xceEVCL0cjOzsvPiQ7Ni81JDs7LywkO1xceEVDLyMkKyUpKCUnIygkJyMoIycjKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiUzXFx4OTJcXFwiXFxcIjUjN1xceEQzLiMgJjs2LycgOCE6XFx1MDE4QiEhIClcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlM1xceEIxXFxcIlxcXCI1IzdcXHUwMThDLkcgJjNcXHhCM1xcXCJcXFwiNSM3XFx1MDE4RC47ICYzXFx4QjdcXFwiXFxcIjUjN1xcdTAxOEUuLyAmM1xceEI1XFxcIlxcXCI1JDdcXHUwMThGLiMgJjs2LycgOCE6XFx1MDE5MCEhIClcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlO1xceEVFL0QjJTtDLywjO1xceEVGLyMkK1xcXCIpKFxcXCInIyYnIy5cXFwiICZcXFwiLyMkK1xcXCIpKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiU7VS4pICY7XFxcXC4jICY7WC8mIDghOlxcdTAxOTEhIClcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlJTshLlxcXCIgJlxcXCIvWyM7IS5cXFwiICZcXFwiL00kOyEuXFxcIiAmXFxcIi8/JDshLlxcXCIgJlxcXCIvMSQ7IS5cXFwiICZcXFwiLyMkKyUpKCUnIygkJyMoIycjKFxcXCInIyYnIy8nIDghOlxcdTAxOTIhISApXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJSU7IS8/IzshLlxcXCIgJlxcXCIvMSQ7IS5cXFwiICZcXFwiLyMkKyMpKCMnIyhcXFwiJyMmJyMvJyA4ITpcXHUwMTkzISEgKVwiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIjtcXHhCRVwiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiU7XFx4OUUvXiMkJTtCLywjO1xceEYzLyMkK1xcXCIpKFxcXCInIyYnIzA2KiU7Qi8sIztcXHhGMy8jJCtcXFwiKShcXFwiJyMmJyMmLygkOFxcXCI6XFx1MDE5NFxcXCIhISkoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiO1xceEY0LiMgJjtcXHhBMFwiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiUyXFx1MDE5NVxcXCJcXFwiNlxcdTAxOTU3XFx1MDE5Ni9MIzs8L0MkMlxcdTAxOTdcXFwiXFxcIjZcXHUwMTk3N1xcdTAxOTguKSAmMlxcdTAxOTlcXFwiXFxcIjZcXHUwMTk5N1xcdTAxOUEvKCQ4IzpcXHUwMTlCIyEgKSgjJyMoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTtcXHg5RS9eIyQlO0IvLCM7XFx4QTAvIyQrXFxcIikoXFxcIicjJicjMDYqJTtCLywjO1xceEEwLyMkK1xcXCIpKFxcXCInIyYnIyYvKCQ4XFxcIjpcXHUwMTlDXFxcIiEhKShcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlOzYvNSM7MC8sJDtcXHhGNy8jJCsjKSgjJyMoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJDsyLikgJjs0LiMgJjsuMC8qOzIuKSAmOzQuIyAmOy4mXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJDslMCMqOyUmXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTtcXHhGQS87IzI4XFxcIlxcXCI2ODc5LywkO1xceEZCLyMkKyMpKCMnIyhcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlM1xcdTAxOURcXFwiXFxcIjUlN1xcdTAxOUUuKSAmM1xcdTAxOUZcXFwiXFxcIjUkN1xcdTAxQTAvJyA4ITpcXHUwMUExISEgKVwiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiU7XFx4RkMvSiMlMjhcXFwiXFxcIjY4NzkvLCM7Xi8jJCtcXFwiKShcXFwiJyMmJyMuXFxcIiAmXFxcIi8jJCtcXFwiKShcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlO1xcXFwuKSAmO1guIyAmO1xceDgyLycgOCE6XFx1MDFBMiEhIClcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCI7XFxcIi5TICY7IS5NICYyRlxcXCJcXFwiNkY3Ry5BICYySlxcXCJcXFwiNko3Sy41ICYySFxcXCJcXFwiNkg3SS4pICYyTlxcXCJcXFwiNk43T1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIjJMXFxcIlxcXCI2TDdNLlxceDk1ICYyQlxcXCJcXFwiNkI3Qy5cXHg4OSAmMjxcXFwiXFxcIjY8Nz0ufSAmMlJcXFwiXFxcIjZSN1MucSAmMlRcXFwiXFxcIjZUN1UuZSAmMlZcXFwiXFxcIjZWN1cuWSAmMlBcXFwiXFxcIjZQN1EuTSAmMkBcXFwiXFxcIjZAN0EuQSAmMkRcXFwiXFxcIjZEN0UuNSAmMjJcXFwiXFxcIjYyNzMuKSAmMj5cXFwiXFxcIjY+Nz9cIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlO1xcdTAxMDAvYiMyOFxcXCJcXFwiNjg3OS9TJDtcXHhGQi9KJCUyXFx1MDFBM1xcXCJcXFwiNlxcdTAxQTM3XFx1MDFBNC8sIztcXHhFQy8jJCtcXFwiKShcXFwiJyMmJyMuXFxcIiAmXFxcIi8jJCskKSgkJyMoIycjKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiUzXFx1MDFBNVxcXCJcXFwiNSU3XFx1MDFBNi4pICYzXFx1MDFBN1xcXCJcXFwiNSQ3XFx1MDFBOC8nIDghOlxcdTAxQTEhISApXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTtcXHhFQy9PIzNcXHhCMVxcXCJcXFwiNSM3XFx4QjIuNiAmM1xceEIzXFxcIlxcXCI1IzdcXHhCNC4qICYkOyswIyo7KyYvJyQ4XFxcIjpcXHUwMUE5XFxcIiApKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiU7XFx1MDEwNC9cXHg4NyMyRlxcXCJcXFwiNkY3Ry94JDtcXHUwMTAzL28kMkZcXFwiXFxcIjZGN0cvYCQ7XFx1MDEwMy9XJDJGXFxcIlxcXCI2RjdHL0gkO1xcdTAxMDMvPyQyRlxcXCJcXFwiNkY3Ry8wJDtcXHUwMTA1LyckOCk6XFx1MDFBQSkgKSgpJyMoKCcjKCcnIygmJyMoJScjKCQnIygjJyMoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTsjLz4jOyMvNSQ7Iy8sJDsjLyMkKyQpKCQnIygjJyMoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTtcXHUwMTAzLywjO1xcdTAxMDMvIyQrXFxcIikoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTtcXHUwMTAzLzUjO1xcdTAxMDMvLCQ7XFx1MDEwMy8jJCsjKSgjJyMoXFxcIicjJicjXCIpLFxuICAgICAgICBwZWckZGVjb2RlKFwiJTtcXHg4NC9VIzsnL0wkO1xceDkyL0MkOycvOiQ7XFx4OTAvMSQ7IC5cXFwiICZcXFwiLyMkKyYpKCYnIyglJyMoJCcjKCMnIyhcXFwiJyMmJyNcIiksXG4gICAgICAgIHBlZyRkZWNvZGUoXCIlMlxcdTAxQUJcXFwiXFxcIjZcXHUwMUFCN1xcdTAxQUMuKSAmMlxcdTAxQURcXFwiXFxcIjZcXHUwMUFEN1xcdTAxQUUvdyM7MC9uJDtcXHUwMTA4L2UkJCU7Qi8yIztcXHUwMTA5LiMgJjtcXHhBMC8jJCtcXFwiKShcXFwiJyMmJyMwPColO0IvMiM7XFx1MDEwOS4jICY7XFx4QTAvIyQrXFxcIikoXFxcIicjJicjJi8jJCskKSgkJyMoIycjKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIjtcXHg5OS4jICY7TFwiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiUyXFx1MDFBRlxcXCJcXFwiNlxcdTAxQUY3XFx1MDFCMC81Izs8LywkO1xcdTAxMEEvIyQrIykoIycjKFxcXCInIyYnI1wiKSxcbiAgICAgICAgcGVnJGRlY29kZShcIiU7RC9TIzssL0okMjpcXFwiXFxcIjY6NzsvOyQ7LC4jICY7VC8sJDtFLyMkKyUpKCUnIygkJyMoIycjKFxcXCInIyYnI1wiKVxuICAgICAgXSxcblxuICAgICAgcGVnJGN1cnJQb3MgICAgICAgICAgPSAwLFxuICAgICAgcGVnJHNhdmVkUG9zICAgICAgICAgPSAwLFxuICAgICAgcGVnJHBvc0RldGFpbHNDYWNoZSAgPSBbeyBsaW5lOiAxLCBjb2x1bW46IDEgfV0sXG4gICAgICBwZWckbWF4RmFpbFBvcyAgICAgICA9IDAsXG4gICAgICBwZWckbWF4RmFpbEV4cGVjdGVkICA9IFtdLFxuICAgICAgcGVnJHNpbGVudEZhaWxzICAgICAgPSAwLFxuXG4gICAgICBwZWckcmVzdWx0O1xuXG4gIGlmIChcInN0YXJ0UnVsZVwiIGluIG9wdGlvbnMpIHtcbiAgICBpZiAoIShvcHRpb25zLnN0YXJ0UnVsZSBpbiBwZWckc3RhcnRSdWxlSW5kaWNlcykpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbid0IHN0YXJ0IHBhcnNpbmcgZnJvbSBydWxlIFxcXCJcIiArIG9wdGlvbnMuc3RhcnRSdWxlICsgXCJcXFwiLlwiKTtcbiAgICB9XG5cbiAgICBwZWckc3RhcnRSdWxlSW5kZXggPSBwZWckc3RhcnRSdWxlSW5kaWNlc1tvcHRpb25zLnN0YXJ0UnVsZV07XG4gIH1cblxuICBmdW5jdGlvbiB0ZXh0KCkge1xuICAgIHJldHVybiBpbnB1dC5zdWJzdHJpbmcocGVnJHNhdmVkUG9zLCBwZWckY3VyclBvcyk7XG4gIH1cblxuICBmdW5jdGlvbiBsb2NhdGlvbigpIHtcbiAgICByZXR1cm4gcGVnJGNvbXB1dGVMb2NhdGlvbihwZWckc2F2ZWRQb3MsIHBlZyRjdXJyUG9zKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGV4cGVjdGVkKGRlc2NyaXB0aW9uLCBsb2NhdGlvbikge1xuICAgIGxvY2F0aW9uID0gbG9jYXRpb24gIT09IHZvaWQgMCA/IGxvY2F0aW9uIDogcGVnJGNvbXB1dGVMb2NhdGlvbihwZWckc2F2ZWRQb3MsIHBlZyRjdXJyUG9zKVxuXG4gICAgdGhyb3cgcGVnJGJ1aWxkU3RydWN0dXJlZEVycm9yKFxuICAgICAgW3BlZyRvdGhlckV4cGVjdGF0aW9uKGRlc2NyaXB0aW9uKV0sXG4gICAgICBpbnB1dC5zdWJzdHJpbmcocGVnJHNhdmVkUG9zLCBwZWckY3VyclBvcyksXG4gICAgICBsb2NhdGlvblxuICAgICk7XG4gIH1cblxuICBmdW5jdGlvbiBlcnJvcihtZXNzYWdlLCBsb2NhdGlvbikge1xuICAgIGxvY2F0aW9uID0gbG9jYXRpb24gIT09IHZvaWQgMCA/IGxvY2F0aW9uIDogcGVnJGNvbXB1dGVMb2NhdGlvbihwZWckc2F2ZWRQb3MsIHBlZyRjdXJyUG9zKVxuXG4gICAgdGhyb3cgcGVnJGJ1aWxkU2ltcGxlRXJyb3IobWVzc2FnZSwgbG9jYXRpb24pO1xuICB9XG5cbiAgZnVuY3Rpb24gcGVnJGxpdGVyYWxFeHBlY3RhdGlvbih0ZXh0LCBpZ25vcmVDYXNlKSB7XG4gICAgcmV0dXJuIHsgdHlwZTogXCJsaXRlcmFsXCIsIHRleHQ6IHRleHQsIGlnbm9yZUNhc2U6IGlnbm9yZUNhc2UgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBlZyRjbGFzc0V4cGVjdGF0aW9uKHBhcnRzLCBpbnZlcnRlZCwgaWdub3JlQ2FzZSkge1xuICAgIHJldHVybiB7IHR5cGU6IFwiY2xhc3NcIiwgcGFydHM6IHBhcnRzLCBpbnZlcnRlZDogaW52ZXJ0ZWQsIGlnbm9yZUNhc2U6IGlnbm9yZUNhc2UgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBlZyRhbnlFeHBlY3RhdGlvbigpIHtcbiAgICByZXR1cm4geyB0eXBlOiBcImFueVwiIH07XG4gIH1cblxuICBmdW5jdGlvbiBwZWckZW5kRXhwZWN0YXRpb24oKSB7XG4gICAgcmV0dXJuIHsgdHlwZTogXCJlbmRcIiB9O1xuICB9XG5cbiAgZnVuY3Rpb24gcGVnJG90aGVyRXhwZWN0YXRpb24oZGVzY3JpcHRpb24pIHtcbiAgICByZXR1cm4geyB0eXBlOiBcIm90aGVyXCIsIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiB9O1xuICB9XG5cbiAgZnVuY3Rpb24gcGVnJGNvbXB1dGVQb3NEZXRhaWxzKHBvcykge1xuICAgIHZhciBkZXRhaWxzID0gcGVnJHBvc0RldGFpbHNDYWNoZVtwb3NdLCBwO1xuXG4gICAgaWYgKGRldGFpbHMpIHtcbiAgICAgIHJldHVybiBkZXRhaWxzO1xuICAgIH0gZWxzZSB7XG4gICAgICBwID0gcG9zIC0gMTtcbiAgICAgIHdoaWxlICghcGVnJHBvc0RldGFpbHNDYWNoZVtwXSkge1xuICAgICAgICBwLS07XG4gICAgICB9XG5cbiAgICAgIGRldGFpbHMgPSBwZWckcG9zRGV0YWlsc0NhY2hlW3BdO1xuICAgICAgZGV0YWlscyA9IHtcbiAgICAgICAgbGluZTogICBkZXRhaWxzLmxpbmUsXG4gICAgICAgIGNvbHVtbjogZGV0YWlscy5jb2x1bW5cbiAgICAgIH07XG5cbiAgICAgIHdoaWxlIChwIDwgcG9zKSB7XG4gICAgICAgIGlmIChpbnB1dC5jaGFyQ29kZUF0KHApID09PSAxMCkge1xuICAgICAgICAgIGRldGFpbHMubGluZSsrO1xuICAgICAgICAgIGRldGFpbHMuY29sdW1uID0gMTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkZXRhaWxzLmNvbHVtbisrO1xuICAgICAgICB9XG5cbiAgICAgICAgcCsrO1xuICAgICAgfVxuXG4gICAgICBwZWckcG9zRGV0YWlsc0NhY2hlW3Bvc10gPSBkZXRhaWxzO1xuICAgICAgcmV0dXJuIGRldGFpbHM7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcGVnJGNvbXB1dGVMb2NhdGlvbihzdGFydFBvcywgZW5kUG9zKSB7XG4gICAgdmFyIHN0YXJ0UG9zRGV0YWlscyA9IHBlZyRjb21wdXRlUG9zRGV0YWlscyhzdGFydFBvcyksXG4gICAgICAgIGVuZFBvc0RldGFpbHMgICA9IHBlZyRjb21wdXRlUG9zRGV0YWlscyhlbmRQb3MpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN0YXJ0OiB7XG4gICAgICAgIG9mZnNldDogc3RhcnRQb3MsXG4gICAgICAgIGxpbmU6ICAgc3RhcnRQb3NEZXRhaWxzLmxpbmUsXG4gICAgICAgIGNvbHVtbjogc3RhcnRQb3NEZXRhaWxzLmNvbHVtblxuICAgICAgfSxcbiAgICAgIGVuZDoge1xuICAgICAgICBvZmZzZXQ6IGVuZFBvcyxcbiAgICAgICAgbGluZTogICBlbmRQb3NEZXRhaWxzLmxpbmUsXG4gICAgICAgIGNvbHVtbjogZW5kUG9zRGV0YWlscy5jb2x1bW5cbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gcGVnJGZhaWwoZXhwZWN0ZWQpIHtcbiAgICBpZiAocGVnJGN1cnJQb3MgPCBwZWckbWF4RmFpbFBvcykgeyByZXR1cm47IH1cblxuICAgIGlmIChwZWckY3VyclBvcyA+IHBlZyRtYXhGYWlsUG9zKSB7XG4gICAgICBwZWckbWF4RmFpbFBvcyA9IHBlZyRjdXJyUG9zO1xuICAgICAgcGVnJG1heEZhaWxFeHBlY3RlZCA9IFtdO1xuICAgIH1cblxuICAgIHBlZyRtYXhGYWlsRXhwZWN0ZWQucHVzaChleHBlY3RlZCk7XG4gIH1cblxuICBmdW5jdGlvbiBwZWckYnVpbGRTaW1wbGVFcnJvcihtZXNzYWdlLCBsb2NhdGlvbikge1xuICAgIHJldHVybiBuZXcgcGVnJFN5bnRheEVycm9yKG1lc3NhZ2UsIG51bGwsIG51bGwsIGxvY2F0aW9uKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBlZyRidWlsZFN0cnVjdHVyZWRFcnJvcihleHBlY3RlZCwgZm91bmQsIGxvY2F0aW9uKSB7XG4gICAgcmV0dXJuIG5ldyBwZWckU3ludGF4RXJyb3IoXG4gICAgICBwZWckU3ludGF4RXJyb3IuYnVpbGRNZXNzYWdlKGV4cGVjdGVkLCBmb3VuZCksXG4gICAgICBleHBlY3RlZCxcbiAgICAgIGZvdW5kLFxuICAgICAgbG9jYXRpb25cbiAgICApO1xuICB9XG5cbiAgZnVuY3Rpb24gcGVnJGRlY29kZShzKSB7XG4gICAgdmFyIGJjID0gbmV3IEFycmF5KHMubGVuZ3RoKSwgaTtcblxuICAgIGZvciAoaSA9IDA7IGkgPCBzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBiY1tpXSA9IHMuY2hhckNvZGVBdChpKSAtIDMyO1xuICAgIH1cblxuICAgIHJldHVybiBiYztcbiAgfVxuXG4gIGZ1bmN0aW9uIHBlZyRwYXJzZVJ1bGUoaW5kZXgpIHtcbiAgICB2YXIgYmMgICAgPSBwZWckYnl0ZWNvZGVbaW5kZXhdLFxuICAgICAgICBpcCAgICA9IDAsXG4gICAgICAgIGlwcyAgID0gW10sXG4gICAgICAgIGVuZCAgID0gYmMubGVuZ3RoLFxuICAgICAgICBlbmRzICA9IFtdLFxuICAgICAgICBzdGFjayA9IFtdLFxuICAgICAgICBwYXJhbXMsIGk7XG5cbiAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgd2hpbGUgKGlwIDwgZW5kKSB7XG4gICAgICAgIHN3aXRjaCAoYmNbaXBdKSB7XG4gICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgc3RhY2sucHVzaChwZWckY29uc3RzW2JjW2lwICsgMV1dKTtcbiAgICAgICAgICAgIGlwICs9IDI7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgIHN0YWNrLnB1c2godm9pZCAwKTtcbiAgICAgICAgICAgIGlwKys7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgIHN0YWNrLnB1c2gobnVsbCk7XG4gICAgICAgICAgICBpcCsrO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICBzdGFjay5wdXNoKHBlZyRGQUlMRUQpO1xuICAgICAgICAgICAgaXArKztcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgc3RhY2sucHVzaChbXSk7XG4gICAgICAgICAgICBpcCsrO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICBzdGFjay5wdXNoKHBlZyRjdXJyUG9zKTtcbiAgICAgICAgICAgIGlwKys7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgNjpcbiAgICAgICAgICAgIHN0YWNrLnBvcCgpO1xuICAgICAgICAgICAgaXArKztcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSA3OlxuICAgICAgICAgICAgcGVnJGN1cnJQb3MgPSBzdGFjay5wb3AoKTtcbiAgICAgICAgICAgIGlwKys7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgODpcbiAgICAgICAgICAgIHN0YWNrLmxlbmd0aCAtPSBiY1tpcCArIDFdO1xuICAgICAgICAgICAgaXAgKz0gMjtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSA5OlxuICAgICAgICAgICAgc3RhY2suc3BsaWNlKC0yLCAxKTtcbiAgICAgICAgICAgIGlwKys7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgMTA6XG4gICAgICAgICAgICBzdGFja1tzdGFjay5sZW5ndGggLSAyXS5wdXNoKHN0YWNrLnBvcCgpKTtcbiAgICAgICAgICAgIGlwKys7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgMTE6XG4gICAgICAgICAgICBzdGFjay5wdXNoKHN0YWNrLnNwbGljZShzdGFjay5sZW5ndGggLSBiY1tpcCArIDFdLCBiY1tpcCArIDFdKSk7XG4gICAgICAgICAgICBpcCArPSAyO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIDEyOlxuICAgICAgICAgICAgc3RhY2sucHVzaChpbnB1dC5zdWJzdHJpbmcoc3RhY2sucG9wKCksIHBlZyRjdXJyUG9zKSk7XG4gICAgICAgICAgICBpcCsrO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIDEzOlxuICAgICAgICAgICAgZW5kcy5wdXNoKGVuZCk7XG4gICAgICAgICAgICBpcHMucHVzaChpcCArIDMgKyBiY1tpcCArIDFdICsgYmNbaXAgKyAyXSk7XG5cbiAgICAgICAgICAgIGlmIChzdGFja1tzdGFjay5sZW5ndGggLSAxXSkge1xuICAgICAgICAgICAgICBlbmQgPSBpcCArIDMgKyBiY1tpcCArIDFdO1xuICAgICAgICAgICAgICBpcCArPSAzO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgZW5kID0gaXAgKyAzICsgYmNbaXAgKyAxXSArIGJjW2lwICsgMl07XG4gICAgICAgICAgICAgIGlwICs9IDMgKyBiY1tpcCArIDFdO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgMTQ6XG4gICAgICAgICAgICBlbmRzLnB1c2goZW5kKTtcbiAgICAgICAgICAgIGlwcy5wdXNoKGlwICsgMyArIGJjW2lwICsgMV0gKyBiY1tpcCArIDJdKTtcblxuICAgICAgICAgICAgaWYgKHN0YWNrW3N0YWNrLmxlbmd0aCAtIDFdID09PSBwZWckRkFJTEVEKSB7XG4gICAgICAgICAgICAgIGVuZCA9IGlwICsgMyArIGJjW2lwICsgMV07XG4gICAgICAgICAgICAgIGlwICs9IDM7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBlbmQgPSBpcCArIDMgKyBiY1tpcCArIDFdICsgYmNbaXAgKyAyXTtcbiAgICAgICAgICAgICAgaXAgKz0gMyArIGJjW2lwICsgMV07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSAxNTpcbiAgICAgICAgICAgIGVuZHMucHVzaChlbmQpO1xuICAgICAgICAgICAgaXBzLnB1c2goaXAgKyAzICsgYmNbaXAgKyAxXSArIGJjW2lwICsgMl0pO1xuXG4gICAgICAgICAgICBpZiAoc3RhY2tbc3RhY2subGVuZ3RoIC0gMV0gIT09IHBlZyRGQUlMRUQpIHtcbiAgICAgICAgICAgICAgZW5kID0gaXAgKyAzICsgYmNbaXAgKyAxXTtcbiAgICAgICAgICAgICAgaXAgKz0gMztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGVuZCA9IGlwICsgMyArIGJjW2lwICsgMV0gKyBiY1tpcCArIDJdO1xuICAgICAgICAgICAgICBpcCArPSAzICsgYmNbaXAgKyAxXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIDE2OlxuICAgICAgICAgICAgaWYgKHN0YWNrW3N0YWNrLmxlbmd0aCAtIDFdICE9PSBwZWckRkFJTEVEKSB7XG4gICAgICAgICAgICAgIGVuZHMucHVzaChlbmQpO1xuICAgICAgICAgICAgICBpcHMucHVzaChpcCk7XG5cbiAgICAgICAgICAgICAgZW5kID0gaXAgKyAyICsgYmNbaXAgKyAxXTtcbiAgICAgICAgICAgICAgaXAgKz0gMjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGlwICs9IDIgKyBiY1tpcCArIDFdO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgMTc6XG4gICAgICAgICAgICBlbmRzLnB1c2goZW5kKTtcbiAgICAgICAgICAgIGlwcy5wdXNoKGlwICsgMyArIGJjW2lwICsgMV0gKyBiY1tpcCArIDJdKTtcblxuICAgICAgICAgICAgaWYgKGlucHV0Lmxlbmd0aCA+IHBlZyRjdXJyUG9zKSB7XG4gICAgICAgICAgICAgIGVuZCA9IGlwICsgMyArIGJjW2lwICsgMV07XG4gICAgICAgICAgICAgIGlwICs9IDM7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBlbmQgPSBpcCArIDMgKyBiY1tpcCArIDFdICsgYmNbaXAgKyAyXTtcbiAgICAgICAgICAgICAgaXAgKz0gMyArIGJjW2lwICsgMV07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSAxODpcbiAgICAgICAgICAgIGVuZHMucHVzaChlbmQpO1xuICAgICAgICAgICAgaXBzLnB1c2goaXAgKyA0ICsgYmNbaXAgKyAyXSArIGJjW2lwICsgM10pO1xuXG4gICAgICAgICAgICBpZiAoaW5wdXQuc3Vic3RyKHBlZyRjdXJyUG9zLCBwZWckY29uc3RzW2JjW2lwICsgMV1dLmxlbmd0aCkgPT09IHBlZyRjb25zdHNbYmNbaXAgKyAxXV0pIHtcbiAgICAgICAgICAgICAgZW5kID0gaXAgKyA0ICsgYmNbaXAgKyAyXTtcbiAgICAgICAgICAgICAgaXAgKz0gNDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGVuZCA9IGlwICsgNCArIGJjW2lwICsgMl0gKyBiY1tpcCArIDNdO1xuICAgICAgICAgICAgICBpcCArPSA0ICsgYmNbaXAgKyAyXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIDE5OlxuICAgICAgICAgICAgZW5kcy5wdXNoKGVuZCk7XG4gICAgICAgICAgICBpcHMucHVzaChpcCArIDQgKyBiY1tpcCArIDJdICsgYmNbaXAgKyAzXSk7XG5cbiAgICAgICAgICAgIGlmIChpbnB1dC5zdWJzdHIocGVnJGN1cnJQb3MsIHBlZyRjb25zdHNbYmNbaXAgKyAxXV0ubGVuZ3RoKS50b0xvd2VyQ2FzZSgpID09PSBwZWckY29uc3RzW2JjW2lwICsgMV1dKSB7XG4gICAgICAgICAgICAgIGVuZCA9IGlwICsgNCArIGJjW2lwICsgMl07XG4gICAgICAgICAgICAgIGlwICs9IDQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBlbmQgPSBpcCArIDQgKyBiY1tpcCArIDJdICsgYmNbaXAgKyAzXTtcbiAgICAgICAgICAgICAgaXAgKz0gNCArIGJjW2lwICsgMl07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSAyMDpcbiAgICAgICAgICAgIGVuZHMucHVzaChlbmQpO1xuICAgICAgICAgICAgaXBzLnB1c2goaXAgKyA0ICsgYmNbaXAgKyAyXSArIGJjW2lwICsgM10pO1xuXG4gICAgICAgICAgICBpZiAocGVnJGNvbnN0c1tiY1tpcCArIDFdXS50ZXN0KGlucHV0LmNoYXJBdChwZWckY3VyclBvcykpKSB7XG4gICAgICAgICAgICAgIGVuZCA9IGlwICsgNCArIGJjW2lwICsgMl07XG4gICAgICAgICAgICAgIGlwICs9IDQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBlbmQgPSBpcCArIDQgKyBiY1tpcCArIDJdICsgYmNbaXAgKyAzXTtcbiAgICAgICAgICAgICAgaXAgKz0gNCArIGJjW2lwICsgMl07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSAyMTpcbiAgICAgICAgICAgIHN0YWNrLnB1c2goaW5wdXQuc3Vic3RyKHBlZyRjdXJyUG9zLCBiY1tpcCArIDFdKSk7XG4gICAgICAgICAgICBwZWckY3VyclBvcyArPSBiY1tpcCArIDFdO1xuICAgICAgICAgICAgaXAgKz0gMjtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSAyMjpcbiAgICAgICAgICAgIHN0YWNrLnB1c2gocGVnJGNvbnN0c1tiY1tpcCArIDFdXSk7XG4gICAgICAgICAgICBwZWckY3VyclBvcyArPSBwZWckY29uc3RzW2JjW2lwICsgMV1dLmxlbmd0aDtcbiAgICAgICAgICAgIGlwICs9IDI7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgMjM6XG4gICAgICAgICAgICBzdGFjay5wdXNoKHBlZyRGQUlMRUQpO1xuICAgICAgICAgICAgaWYgKHBlZyRzaWxlbnRGYWlscyA9PT0gMCkge1xuICAgICAgICAgICAgICBwZWckZmFpbChwZWckY29uc3RzW2JjW2lwICsgMV1dKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlwICs9IDI7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgMjQ6XG4gICAgICAgICAgICBwZWckc2F2ZWRQb3MgPSBzdGFja1tzdGFjay5sZW5ndGggLSAxIC0gYmNbaXAgKyAxXV07XG4gICAgICAgICAgICBpcCArPSAyO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIDI1OlxuICAgICAgICAgICAgcGVnJHNhdmVkUG9zID0gcGVnJGN1cnJQb3M7XG4gICAgICAgICAgICBpcCsrO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIDI2OlxuICAgICAgICAgICAgcGFyYW1zID0gYmMuc2xpY2UoaXAgKyA0LCBpcCArIDQgKyBiY1tpcCArIDNdKTtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBiY1tpcCArIDNdOyBpKyspIHtcbiAgICAgICAgICAgICAgcGFyYW1zW2ldID0gc3RhY2tbc3RhY2subGVuZ3RoIC0gMSAtIHBhcmFtc1tpXV07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHN0YWNrLnNwbGljZShcbiAgICAgICAgICAgICAgc3RhY2subGVuZ3RoIC0gYmNbaXAgKyAyXSxcbiAgICAgICAgICAgICAgYmNbaXAgKyAyXSxcbiAgICAgICAgICAgICAgcGVnJGNvbnN0c1tiY1tpcCArIDFdXS5hcHBseShudWxsLCBwYXJhbXMpXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBpcCArPSA0ICsgYmNbaXAgKyAzXTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSAyNzpcbiAgICAgICAgICAgIHN0YWNrLnB1c2gocGVnJHBhcnNlUnVsZShiY1tpcCArIDFdKSk7XG4gICAgICAgICAgICBpcCArPSAyO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIDI4OlxuICAgICAgICAgICAgcGVnJHNpbGVudEZhaWxzKys7XG4gICAgICAgICAgICBpcCsrO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIDI5OlxuICAgICAgICAgICAgcGVnJHNpbGVudEZhaWxzLS07XG4gICAgICAgICAgICBpcCsrO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBvcGNvZGU6IFwiICsgYmNbaXBdICsgXCIuXCIpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChlbmRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZW5kID0gZW5kcy5wb3AoKTtcbiAgICAgICAgaXAgPSBpcHMucG9wKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gc3RhY2tbMF07XG4gIH1cblxuXG4gICAgb3B0aW9ucy5kYXRhID0ge307IC8vIE9iamVjdCB0byB3aGljaCBoZWFkZXIgYXR0cmlidXRlcyB3aWxsIGJlIGFzc2lnbmVkIGR1cmluZyBwYXJzaW5nXG5cbiAgICBmdW5jdGlvbiBsaXN0IChoZWFkLCB0YWlsKSB7XG4gICAgICByZXR1cm4gW2hlYWRdLmNvbmNhdCh0YWlsKTtcbiAgICB9XG5cblxuICBwZWckcmVzdWx0ID0gcGVnJHBhcnNlUnVsZShwZWckc3RhcnRSdWxlSW5kZXgpO1xuXG4gIGlmIChwZWckcmVzdWx0ICE9PSBwZWckRkFJTEVEICYmIHBlZyRjdXJyUG9zID09PSBpbnB1dC5sZW5ndGgpIHtcbiAgICByZXR1cm4gcGVnJHJlc3VsdDtcbiAgfSBlbHNlIHtcbiAgICBpZiAocGVnJHJlc3VsdCAhPT0gcGVnJEZBSUxFRCAmJiBwZWckY3VyclBvcyA8IGlucHV0Lmxlbmd0aCkge1xuICAgICAgcGVnJGZhaWwocGVnJGVuZEV4cGVjdGF0aW9uKCkpO1xuICAgIH1cblxuICAgIHRocm93IHBlZyRidWlsZFN0cnVjdHVyZWRFcnJvcihcbiAgICAgIHBlZyRtYXhGYWlsRXhwZWN0ZWQsXG4gICAgICBwZWckbWF4RmFpbFBvcyA8IGlucHV0Lmxlbmd0aCA/IGlucHV0LmNoYXJBdChwZWckbWF4RmFpbFBvcykgOiBudWxsLFxuICAgICAgcGVnJG1heEZhaWxQb3MgPCBpbnB1dC5sZW5ndGhcbiAgICAgICAgPyBwZWckY29tcHV0ZUxvY2F0aW9uKHBlZyRtYXhGYWlsUG9zLCBwZWckbWF4RmFpbFBvcyArIDEpXG4gICAgICAgIDogcGVnJGNvbXB1dGVMb2NhdGlvbihwZWckbWF4RmFpbFBvcywgcGVnJG1heEZhaWxQb3MpXG4gICAgKTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgU3ludGF4RXJyb3I6IHBlZyRTeW50YXhFcnJvcixcbiAgcGFyc2U6ICAgICAgIHBlZyRwYXJzZVxufTtcblxuXG4vKioqLyB9KSxcbi8qIDM4ICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblwidXNlIHN0cmljdFwiO1xuLyoqXG4gKiBAbmFtZSBTSVBcbiAqIEBuYW1lc3BhY2VcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChTSVApIHtcbiAgICB2YXIgTW9kaWZpZXJzO1xuICAgIGZ1bmN0aW9uIHN0cmlwUGF5bG9hZChzZHAsIHBheWxvYWQpIHtcbiAgICAgICAgdmFyIGk7XG4gICAgICAgIHZhciBtZWRpYV9kZXNjcyA9IFtdO1xuICAgICAgICB2YXIgY3VycmVudF9tZWRpYV9kZXNjO1xuICAgICAgICB2YXIgbGluZXMgPSBzZHAuc3BsaXQoL1xcclxcbi8pO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGluZXMubGVuZ3RoOykge1xuICAgICAgICAgICAgdmFyIGxpbmUgPSBsaW5lc1tpXTtcbiAgICAgICAgICAgIGlmICgvXm09KD86YXVkaW98dmlkZW8pLy50ZXN0KGxpbmUpKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudF9tZWRpYV9kZXNjID0ge1xuICAgICAgICAgICAgICAgICAgICBpbmRleDogaSxcbiAgICAgICAgICAgICAgICAgICAgc3RyaXBwZWQ6IFtdXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBtZWRpYV9kZXNjcy5wdXNoKGN1cnJlbnRfbWVkaWFfZGVzYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50X21lZGlhX2Rlc2MpIHtcbiAgICAgICAgICAgICAgICB2YXIgcnRwbWFwID0gL15hPXJ0cG1hcDooXFxkKykgKFteL10rKVxcLy8uZXhlYyhsaW5lKTtcbiAgICAgICAgICAgICAgICBpZiAocnRwbWFwICYmIHBheWxvYWQgPT09IHJ0cG1hcFsyXSkge1xuICAgICAgICAgICAgICAgICAgICBsaW5lcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfbWVkaWFfZGVzYy5zdHJpcHBlZC5wdXNoKHJ0cG1hcFsxXSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOyAvLyBEb24ndCBpbmNyZW1lbnQgJ2knXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaSsrO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBtZWRpYV9kZXNjcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIG1saW5lID0gbGluZXNbbWVkaWFfZGVzY3NbaV0uaW5kZXhdLnNwbGl0KCcgJyk7XG4gICAgICAgICAgICAvLyBJZ25vcmUgdGhlIGZpcnN0IDMgcGFyYW1ldGVycyBvZiB0aGUgbWxpbmUuIFRoZSBjb2RlYyBpbmZvcm1hdGlvbiBpcyBhZnRlciB0aGF0XG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMzsgaiA8IG1saW5lLmxlbmd0aDspIHtcbiAgICAgICAgICAgICAgICBpZiAobWVkaWFfZGVzY3NbaV0uc3RyaXBwZWQuaW5kZXhPZihtbGluZVtqXSkgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIG1saW5lLnNwbGljZShqLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGorKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxpbmVzW21lZGlhX2Rlc2NzW2ldLmluZGV4XSA9IG1saW5lLmpvaW4oJyAnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbGluZXMuam9pbignXFxyXFxuJyk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHN0cmlwTWVkaWFEZXNjcmlwdGlvbihzZHAsIGRlc2NyaXB0aW9uKSB7XG4gICAgICAgIHZhciBkZXNjcmlwdGlvblJlZ0V4cCA9IG5ldyBSZWdFeHAoXCJtPVwiICsgZGVzY3JpcHRpb24gKyBcIi4qJFwiLCBcImdtXCIpO1xuICAgICAgICB2YXIgZ3JvdXBSZWdFeHAgPSBuZXcgUmVnRXhwKFwiXmE9Z3JvdXA6LiokXCIsIFwiZ21cIik7XG4gICAgICAgIGlmIChkZXNjcmlwdGlvblJlZ0V4cC50ZXN0KHNkcCkpIHtcbiAgICAgICAgICAgIHZhciBtaWRMaW5lVG9SZW1vdmVfMTtcbiAgICAgICAgICAgIHNkcCA9IHNkcC5zcGxpdCgvXm09L2dtKS5maWx0ZXIoZnVuY3Rpb24gKHNlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICBpZiAoc2VjdGlvbi5zdWJzdHIoMCwgZGVzY3JpcHRpb24ubGVuZ3RoKSA9PT0gZGVzY3JpcHRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgbWlkTGluZVRvUmVtb3ZlXzEgPSBzZWN0aW9uLm1hdGNoKC9eYT1taWQ6LiokL2dtKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1pZExpbmVUb1JlbW92ZV8xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtaWRMaW5lVG9SZW1vdmVfMSA9IG1pZExpbmVUb1JlbW92ZV8xWzBdLm1hdGNoKC86LiskL2cpWzBdLnN1YnN0cigxKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSkuam9pbignbT0nKTtcbiAgICAgICAgICAgIHZhciBncm91cExpbmUgPSBzZHAubWF0Y2goZ3JvdXBSZWdFeHApO1xuICAgICAgICAgICAgaWYgKGdyb3VwTGluZSAmJiBncm91cExpbmUubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgZ3JvdXBMaW5lID0gZ3JvdXBMaW5lWzBdO1xuICAgICAgICAgICAgICAgIHZhciBncm91cFJlZ0V4cFJlcGxhY2UgPSBuZXcgUmVnRXhwKFwiXFwgKlwiICsgbWlkTGluZVRvUmVtb3ZlXzEgKyBcIlteXFwgXSpcIiwgXCJnXCIpO1xuICAgICAgICAgICAgICAgIGdyb3VwTGluZSA9IGdyb3VwTGluZS5yZXBsYWNlKGdyb3VwUmVnRXhwUmVwbGFjZSwgXCJcIik7XG4gICAgICAgICAgICAgICAgc2RwID0gc2RwLnNwbGl0KGdyb3VwUmVnRXhwKS5qb2luKGdyb3VwTGluZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHNkcDtcbiAgICB9XG4gICAgTW9kaWZpZXJzID0ge1xuICAgICAgICBzdHJpcFRjcENhbmRpZGF0ZXM6IGZ1bmN0aW9uIChkZXNjcmlwdGlvbikge1xuICAgICAgICAgICAgZGVzY3JpcHRpb24uc2RwID0gZGVzY3JpcHRpb24uc2RwLnJlcGxhY2UoL15hPWNhbmRpZGF0ZTpcXGQrIFxcZCsgdGNwIC4qP1xcclxcbi9pbWcsIFwiXCIpO1xuICAgICAgICAgICAgcmV0dXJuIFNJUC5VdGlscy5Qcm9taXNlLnJlc29sdmUoZGVzY3JpcHRpb24pO1xuICAgICAgICB9LFxuICAgICAgICBzdHJpcFRlbGVwaG9uZUV2ZW50OiBmdW5jdGlvbiAoZGVzY3JpcHRpb24pIHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uLnNkcCA9IHN0cmlwUGF5bG9hZChkZXNjcmlwdGlvbi5zZHAsICd0ZWxlcGhvbmUtZXZlbnQnKTtcbiAgICAgICAgICAgIHJldHVybiBTSVAuVXRpbHMuUHJvbWlzZS5yZXNvbHZlKGRlc2NyaXB0aW9uKTtcbiAgICAgICAgfSxcbiAgICAgICAgY2xlYW5KaXRzaVNkcEltYWdlYXR0cjogZnVuY3Rpb24gKGRlc2NyaXB0aW9uKSB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbi5zZHAgPSBkZXNjcmlwdGlvbi5zZHAucmVwbGFjZSgvXihhPWltYWdlYXR0cjouKj8pKHh8eSk9XFxbMC0vZ20sIFwiJDEkMj1bMTpcIik7XG4gICAgICAgICAgICByZXR1cm4gU0lQLlV0aWxzLlByb21pc2UucmVzb2x2ZShkZXNjcmlwdGlvbik7XG4gICAgICAgIH0sXG4gICAgICAgIHN0cmlwRzcyMjogZnVuY3Rpb24gKGRlc2NyaXB0aW9uKSB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbi5zZHAgPSBzdHJpcFBheWxvYWQoZGVzY3JpcHRpb24uc2RwLCAnRzcyMicpO1xuICAgICAgICAgICAgcmV0dXJuIFNJUC5VdGlscy5Qcm9taXNlLnJlc29sdmUoZGVzY3JpcHRpb24pO1xuICAgICAgICB9LFxuICAgICAgICBzdHJpcFJ0cFBheWxvYWQ6IGZ1bmN0aW9uIChwYXlsb2FkKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGRlc2NyaXB0aW9uKSB7XG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb24uc2RwID0gc3RyaXBQYXlsb2FkKGRlc2NyaXB0aW9uLnNkcCwgcGF5bG9hZCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFNJUC5VdGlscy5Qcm9taXNlLnJlc29sdmUoZGVzY3JpcHRpb24pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSxcbiAgICAgICAgc3RyaXBWaWRlbzogZnVuY3Rpb24gKGRlc2NyaXB0aW9uKSB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbi5zZHAgPSBzdHJpcE1lZGlhRGVzY3JpcHRpb24oZGVzY3JpcHRpb24uc2RwLCBcInZpZGVvXCIpO1xuICAgICAgICAgICAgcmV0dXJuIFNJUC5VdGlscy5Qcm9taXNlLnJlc29sdmUoZGVzY3JpcHRpb24pO1xuICAgICAgICB9LFxuICAgICAgICBhZGRNaWRMaW5lczogZnVuY3Rpb24gKGRlc2NyaXB0aW9uKSB7XG4gICAgICAgICAgICB2YXIgc2RwID0gZGVzY3JpcHRpb24uc2RwO1xuICAgICAgICAgICAgaWYgKHNkcC5zZWFyY2goL15hPW1pZC4qJC9nbSkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1saW5lc18xID0gc2RwLm1hdGNoKC9ebT0uKiQvZ20pO1xuICAgICAgICAgICAgICAgIHNkcCA9IHNkcC5zcGxpdCgvXm09LiokL2dtKTtcbiAgICAgICAgICAgICAgICBtbGluZXNfMS5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtLCBpZHgpIHtcbiAgICAgICAgICAgICAgICAgICAgbWxpbmVzXzFbaWR4XSA9IGVsZW0gKyAnXFxuYT1taWQ6JyArIGlkeDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBzZHAuZm9yRWFjaChmdW5jdGlvbiAoZWxlbSwgaWR4KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtbGluZXNfMVtpZHhdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZHBbaWR4XSA9IGVsZW0gKyBtbGluZXNfMVtpZHhdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc2RwID0gc2RwLmpvaW4oJycpO1xuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uLnNkcCA9IHNkcDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBTSVAuVXRpbHMuUHJvbWlzZS5yZXNvbHZlKGRlc2NyaXB0aW9uKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIE1vZGlmaWVycztcbn07XG5cblxuLyoqKi8gfSksXG4vKiAzOSAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cInVzZSBzdHJpY3RcIjtcbi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihnbG9iYWwpIHtcbi8qKlxuICogQGZpbGVvdmVydmlldyBTaW1wbGVcbiAqL1xuLyogU2ltcGxlXG4gKiBAY2xhc3MgU2ltcGxlXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKFNJUCkge1xuICAgIHZhciBDID0ge1xuICAgICAgICBTVEFUVVNfTlVMTDogMCxcbiAgICAgICAgU1RBVFVTX05FVzogMSxcbiAgICAgICAgU1RBVFVTX0NPTk5FQ1RJTkc6IDIsXG4gICAgICAgIFNUQVRVU19DT05ORUNURUQ6IDMsXG4gICAgICAgIFNUQVRVU19DT01QTEVURUQ6IDRcbiAgICB9O1xuICAgIC8qXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnNcbiAgICAgKi9cbiAgICB2YXIgU2ltcGxlID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgLypcbiAgICAgICAgICogIHtcbiAgICAgICAgICogICAgbWVkaWE6IHtcbiAgICAgICAgICogICAgICByZW1vdGU6IHtcbiAgICAgICAgICogICAgICAgIGF1ZGlvOiA8RE9NIGVsZW1lbnQ+LFxuICAgICAgICAgKiAgICAgICAgdmlkZW86IDxET00gZWxlbWVudD5cbiAgICAgICAgICogICAgICB9LFxuICAgICAgICAgKiAgICAgIGxvY2FsOiB7XG4gICAgICAgICAqICAgICAgICB2aWRlbzogPERPTSBlbGVtZW50PlxuICAgICAgICAgKiAgICAgIH1cbiAgICAgICAgICogICAgfSxcbiAgICAgICAgICogICAgdWE6IHtcbiAgICAgICAgICogICAgICAgPFVBIENvbmZpZ3VyYXRpb24gT3B0aW9ucz5cbiAgICAgICAgICogICAgfVxuICAgICAgICAgKiAgfVxuICAgICAgICAgKi9cbiAgICAgICAgaWYgKG9wdGlvbnMubWVkaWEucmVtb3RlLnZpZGVvKSB7XG4gICAgICAgICAgICB0aGlzLnZpZGVvID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudmlkZW8gPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5tZWRpYS5yZW1vdGUuYXVkaW8pIHtcbiAgICAgICAgICAgIHRoaXMuYXVkaW8gPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5hdWRpbyA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5hdWRpbyAmJiAhdGhpcy52aWRlbykge1xuICAgICAgICAgICAgLy8gTmVlZCB0byBkbyBhdCBsZWFzdCBhdWRpbyBvciB2aWRlb1xuICAgICAgICAgICAgLy8gRXJyb3JcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQXQgbGVhc3Qgb25lIHJlbW90ZSBhdWRpbyBvciB2aWRlbyBlbGVtZW50IGlzIHJlcXVpcmVkIGZvciBTaW1wbGUuJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICAgICAgLy8gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNzk0NDQ2MC9kZXRlY3Qtc2FmYXJpLWJyb3dzZXJcbiAgICAgICAgdmFyIGJyb3dzZXJVYSA9IGdsb2JhbC5uYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIHZhciBpc1NhZmFyaSA9IGZhbHNlO1xuICAgICAgICB2YXIgaXNGaXJlZm94ID0gZmFsc2U7XG4gICAgICAgIGlmIChicm93c2VyVWEuaW5kZXhPZignc2FmYXJpJykgPiAtMSAmJiBicm93c2VyVWEuaW5kZXhPZignY2hyb21lJykgPCAwKSB7XG4gICAgICAgICAgICBpc1NhZmFyaSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoYnJvd3NlclVhLmluZGV4T2YoJ2ZpcmVmb3gnKSA+IC0xICYmIGJyb3dzZXJVYS5pbmRleE9mKCdjaHJvbWUnKSA8IDApIHtcbiAgICAgICAgICAgIGlzRmlyZWZveCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJGYWN0b3J5T3B0aW9ucyA9IHt9O1xuICAgICAgICBpZiAoaXNTYWZhcmkpIHtcbiAgICAgICAgICAgIHNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJGYWN0b3J5T3B0aW9ucy5tb2RpZmllcnMgPSBbU0lQLldlYi5Nb2RpZmllcnMuc3RyaXBHNzIyXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNGaXJlZm94KSB7XG4gICAgICAgICAgICBzZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyRmFjdG9yeU9wdGlvbnMuYWx3YXlzQWNxdWlyZU1lZGlhRmlyc3QgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5vcHRpb25zLnVhLnVyaSkge1xuICAgICAgICAgICAgdGhpcy5hbm9ueW1vdXMgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudWEgPSBuZXcgU0lQLlVBKHtcbiAgICAgICAgICAgIC8vIFVzZXIgQ29uZmlndXJhYmxlIE9wdGlvbnNcbiAgICAgICAgICAgIHVyaTogdGhpcy5vcHRpb25zLnVhLnVyaSxcbiAgICAgICAgICAgIGF1dGhvcml6YXRpb25Vc2VyOiB0aGlzLm9wdGlvbnMudWEuYXV0aG9yaXphdGlvblVzZXIsXG4gICAgICAgICAgICBwYXNzd29yZDogdGhpcy5vcHRpb25zLnVhLnBhc3N3b3JkLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6IHRoaXMub3B0aW9ucy51YS5kaXNwbGF5TmFtZSxcbiAgICAgICAgICAgIC8vIFVuZG9jdW1lbnRlZCBcIkFkdmFuY2VkXCIgT3B0aW9uc1xuICAgICAgICAgICAgdXNlckFnZW50U3RyaW5nOiB0aGlzLm9wdGlvbnMudWEudXNlckFnZW50U3RyaW5nLFxuICAgICAgICAgICAgLy8gRml4ZWQgT3B0aW9uc1xuICAgICAgICAgICAgcmVnaXN0ZXI6IHRydWUsXG4gICAgICAgICAgICBzZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyRmFjdG9yeU9wdGlvbnM6IHNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJGYWN0b3J5T3B0aW9ucyxcbiAgICAgICAgICAgIHRyYW5zcG9ydE9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICB0cmFjZVNpcDogdGhpcy5vcHRpb25zLnVhLnRyYWNlU2lwLFxuICAgICAgICAgICAgICAgIHdzU2VydmVyczogdGhpcy5vcHRpb25zLnVhLndzU2VydmVyc1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IEMuU1RBVFVTX05VTEw7XG4gICAgICAgIHRoaXMubG9nZ2VyID0gdGhpcy51YS5nZXRMb2dnZXIoJ3NpcC5zaW1wbGUnKTtcbiAgICAgICAgdGhpcy51YS5vbigncmVnaXN0ZXJlZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuZW1pdCgncmVnaXN0ZXJlZCcsIHRoaXMudWEpO1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLnVhLm9uKCd1bnJlZ2lzdGVyZWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLmVtaXQoJ3VucmVnaXN0ZXJlZCcsIHRoaXMudWEpO1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLnVhLm9uKCdmYWlsZWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLmVtaXQoJ3VucmVnaXN0ZXJlZCcsIHRoaXMudWEpO1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLnVhLm9uKCdpbnZpdGUnLCBmdW5jdGlvbiAoc2Vzc2lvbikge1xuICAgICAgICAgICAgLy8gSWYgdGhlcmUgaXMgYWxyZWFkeSBhbiBhY3RpdmUgc2Vzc2lvbiByZWplY3QgdGhlIGluY29taW5nIHNlc3Npb25cbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSBDLlNUQVRVU19OVUxMICYmIHRoaXMuc3RhdGUgIT09IEMuU1RBVFVTX0NPTVBMRVRFRCkge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ1JlamVjdGluZyBpbmNvbWluZyBjYWxsLiBTaW1wbGUgb25seSBzdXBwb3J0cyAxIGNhbGwgYXQgYSB0aW1lJyk7XG4gICAgICAgICAgICAgICAgc2Vzc2lvbi5yZWplY3QoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnNlc3Npb24gPSBzZXNzaW9uO1xuICAgICAgICAgICAgdGhpcy5zZXR1cFNlc3Npb24oKTtcbiAgICAgICAgICAgIHRoaXMuZW1pdCgncmluZ2luZycsIHRoaXMuc2Vzc2lvbik7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMudWEub24oJ21lc3NhZ2UnLCBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgICAgICAgICAgdGhpcy5lbWl0KCdtZXNzYWdlJywgbWVzc2FnZSk7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgU2ltcGxlLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoU0lQLkV2ZW50RW1pdHRlci5wcm90b3R5cGUpO1xuICAgIFNpbXBsZS5DID0gQztcbiAgICAvLyBQdWJsaWNcbiAgICBTaW1wbGUucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiAoZGVzdGluYXRpb24pIHtcbiAgICAgICAgaWYgKCF0aGlzLnVhIHx8ICF0aGlzLmNoZWNrUmVnaXN0cmF0aW9uKCkpIHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ0EgcmVnaXN0ZXJlZCBVQSBpcyByZXF1aXJlZCBmb3IgY2FsbGluZycpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSBDLlNUQVRVU19OVUxMICYmIHRoaXMuc3RhdGUgIT09IEMuU1RBVFVTX0NPTVBMRVRFRCkge1xuICAgICAgICAgICAgdGhpcy5sb2dnZXIud2FybignQ2Fubm90IG1ha2UgbW9yZSB0aGFuIGEgc2luZ2xlIGNhbGwgd2l0aCBTaW1wbGUnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBTYWZhcmkgaGFjaywgYmVjYXVzZSB5b3UgY2Fubm90IGNhbGwgLnBsYXkoKSBmcm9tIGEgbm9uIHVzZXIgYWN0aW9uXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMubWVkaWEucmVtb3RlLmF1ZGlvKSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMubWVkaWEucmVtb3RlLmF1ZGlvLmF1dG9wbGF5ID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLm1lZGlhLnJlbW90ZS52aWRlbykge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLm1lZGlhLnJlbW90ZS52aWRlby5hdXRvcGxheSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5tZWRpYS5sb2NhbCAmJiB0aGlzLm9wdGlvbnMubWVkaWEubG9jYWwudmlkZW8pIHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5tZWRpYS5sb2NhbC52aWRlby5hdXRvcGxheSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMubWVkaWEubG9jYWwudmlkZW8udm9sdW1lID0gMDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNlc3Npb24gPSB0aGlzLnVhLmludml0ZShkZXN0aW5hdGlvbiwge1xuICAgICAgICAgICAgc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlck9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICBjb25zdHJhaW50czoge1xuICAgICAgICAgICAgICAgICAgICBhdWRpbzogdGhpcy5hdWRpbyxcbiAgICAgICAgICAgICAgICAgICAgdmlkZW86IHRoaXMudmlkZW9cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnNldHVwU2Vzc2lvbigpO1xuICAgICAgICByZXR1cm4gdGhpcy5zZXNzaW9uO1xuICAgIH07XG4gICAgU2ltcGxlLnByb3RvdHlwZS5hbnN3ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSBDLlNUQVRVU19ORVcgJiYgdGhpcy5zdGF0ZSAhPT0gQy5TVEFUVVNfQ09OTkVDVElORykge1xuICAgICAgICAgICAgdGhpcy5sb2dnZXIud2FybignTm8gY2FsbCB0byBhbnN3ZXInKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBTYWZhcmkgaGFjaywgYmVjYXVzZSB5b3UgY2Fubm90IGNhbGwgLnBsYXkoKSBmcm9tIGEgbm9uIHVzZXIgYWN0aW9uXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMubWVkaWEucmVtb3RlLmF1ZGlvKSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMubWVkaWEucmVtb3RlLmF1ZGlvLmF1dG9wbGF5ID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLm1lZGlhLnJlbW90ZS52aWRlbykge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLm1lZGlhLnJlbW90ZS52aWRlby5hdXRvcGxheSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuc2Vzc2lvbi5hY2NlcHQoe1xuICAgICAgICAgICAgc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlck9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICBjb25zdHJhaW50czoge1xuICAgICAgICAgICAgICAgICAgICBhdWRpbzogdGhpcy5hdWRpbyxcbiAgICAgICAgICAgICAgICAgICAgdmlkZW86IHRoaXMudmlkZW9cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBlbWl0IGNhbGwgaXMgYWN0aXZlXG4gICAgfTtcbiAgICBTaW1wbGUucHJvdG90eXBlLnJlamVjdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUgIT09IEMuU1RBVFVTX05FVyAmJiB0aGlzLnN0YXRlICE9PSBDLlNUQVRVU19DT05ORUNUSU5HKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuKCdDYWxsIGlzIGFscmVhZHkgYW5zd2VyZWQnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5zZXNzaW9uLnJlamVjdCgpO1xuICAgIH07XG4gICAgU2ltcGxlLnByb3RvdHlwZS5oYW5ndXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSBDLlNUQVRVU19DT05ORUNURUQgJiYgdGhpcy5zdGF0ZSAhPT0gQy5TVEFUVVNfQ09OTkVDVElORyAmJiB0aGlzLnN0YXRlICE9PSBDLlNUQVRVU19ORVcpIHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ05vIGFjdGl2ZSBjYWxsIHRvIGhhbmcgdXAgb24nKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5zdGF0ZSAhPT0gQy5TVEFUVVNfQ09OTkVDVEVEKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zZXNzaW9uLmNhbmNlbCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2Vzc2lvbi5ieWUoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgU2ltcGxlLnByb3RvdHlwZS5ob2xkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZSAhPT0gQy5TVEFUVVNfQ09OTkVDVEVEIHx8IHRoaXMuc2Vzc2lvbi5sb2NhbF9ob2xkKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuKCdDYW5ub3QgcHV0IGNhbGwgb24gaG9sZCcpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubXV0ZSgpO1xuICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ1BsYWNpbmcgc2Vzc2lvbiBvbiBob2xkJyk7XG4gICAgICAgIHJldHVybiB0aGlzLnNlc3Npb24uaG9sZCgpO1xuICAgIH07XG4gICAgU2ltcGxlLnByb3RvdHlwZS51bmhvbGQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSBDLlNUQVRVU19DT05ORUNURUQgfHwgIXRoaXMuc2Vzc2lvbi5sb2NhbF9ob2xkKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuKCdDYW5ub3QgdW5ob2xkIGEgY2FsbCB0aGF0IGlzIG5vdCBvbiBob2xkJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy51bm11dGUoKTtcbiAgICAgICAgdGhpcy5sb2dnZXIubG9nKCdQbGFjaW5nIGNhbGwgb2ZmIGhvbGQnKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2Vzc2lvbi51bmhvbGQoKTtcbiAgICB9O1xuICAgIFNpbXBsZS5wcm90b3R5cGUubXV0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUgIT09IEMuU1RBVFVTX0NPTk5FQ1RFRCkge1xuICAgICAgICAgICAgdGhpcy5sb2dnZXIud2FybignQW4gYWNpdHZlIGNhbGwgaXMgcmVxdWlyZWQgdG8gbXV0ZSBhdWRpbycpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubG9nZ2VyLmxvZygnTXV0aW5nIEF1ZGlvJyk7XG4gICAgICAgIHRoaXMudG9nZ2xlTXV0ZSh0cnVlKTtcbiAgICAgICAgdGhpcy5lbWl0KCdtdXRlJywgdGhpcyk7XG4gICAgfTtcbiAgICBTaW1wbGUucHJvdG90eXBlLnVubXV0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUgIT09IEMuU1RBVFVTX0NPTk5FQ1RFRCkge1xuICAgICAgICAgICAgdGhpcy5sb2dnZXIud2FybignQW4gYWN0aXZlIGNhbGwgaXMgcmVxdWlyZWQgdG8gdW5tdXRlIGF1ZGlvJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sb2dnZXIubG9nKCdVbm11dGluZyBBdWRpbycpO1xuICAgICAgICB0aGlzLnRvZ2dsZU11dGUoZmFsc2UpO1xuICAgICAgICB0aGlzLmVtaXQoJ3VubXV0ZScsIHRoaXMpO1xuICAgIH07XG4gICAgU2ltcGxlLnByb3RvdHlwZS5zZW5kRFRNRiA9IGZ1bmN0aW9uICh0b25lKSB7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSBDLlNUQVRVU19DT05ORUNURUQpIHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ0FuIGFjdGl2ZSBjYWxsIGlzIHJlcXVpcmVkIHRvIHNlbmQgYSBEVE1GIHRvbmUnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ1NlbmRpbmcgRFRNRiB0b25lOiAnICsgdG9uZSk7XG4gICAgICAgIHRoaXMuc2Vzc2lvbi5kdG1mKHRvbmUpO1xuICAgIH07XG4gICAgU2ltcGxlLnByb3RvdHlwZS5tZXNzYWdlID0gZnVuY3Rpb24gKGRlc3RpbmF0aW9uLCBtZXNzYWdlKSB7XG4gICAgICAgIGlmICghdGhpcy51YSB8fCAhdGhpcy5jaGVja1JlZ2lzdHJhdGlvbigpKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuKCdBIHJlZ2lzdGVyZWQgVUEgaXMgcmVxdWlyZWQgdG8gc2VuZCBhIG1lc3NhZ2UnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWRlc3RpbmF0aW9uIHx8ICFtZXNzYWdlKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuKCdBIGRlc3RpbmF0aW9uIGFuZCBtZXNzYWdlIGFyZSByZXF1aXJlZCB0byBzZW5kIGEgbWVzc2FnZScpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudWEubWVzc2FnZShkZXN0aW5hdGlvbiwgbWVzc2FnZSk7XG4gICAgfTtcbiAgICAvLyBQcml2YXRlIEhlbHBlcnNcbiAgICBTaW1wbGUucHJvdG90eXBlLmNoZWNrUmVnaXN0cmF0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gKHRoaXMuYW5vbnltb3VzIHx8ICh0aGlzLnVhICYmIHRoaXMudWEuaXNSZWdpc3RlcmVkKCkpKTtcbiAgICB9O1xuICAgIFNpbXBsZS5wcm90b3R5cGUuc2V0dXBSZW1vdGVNZWRpYSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gSWYgdGhlcmUgaXMgYSB2aWRlbyB0cmFjaywgaXQgd2lsbCBhdHRhY2ggdGhlIHZpZGVvIGFuZCBhdWRpbyB0byB0aGUgc2FtZSBlbGVtZW50XG4gICAgICAgIHZhciBwYyA9IHRoaXMuc2Vzc2lvbi5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyLnBlZXJDb25uZWN0aW9uO1xuICAgICAgICB2YXIgcmVtb3RlU3RyZWFtO1xuICAgICAgICBpZiAocGMuZ2V0UmVjZWl2ZXJzKSB7XG4gICAgICAgICAgICByZW1vdGVTdHJlYW0gPSBuZXcgZ2xvYmFsLndpbmRvdy5NZWRpYVN0cmVhbSgpO1xuICAgICAgICAgICAgcGMuZ2V0UmVjZWl2ZXJzKCkuZm9yRWFjaChmdW5jdGlvbiAocmVjZWl2ZXIpIHtcbiAgICAgICAgICAgICAgICB2YXIgdHJhY2sgPSByZWNlaXZlci50cmFjaztcbiAgICAgICAgICAgICAgICBpZiAodHJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgcmVtb3RlU3RyZWFtLmFkZFRyYWNrKHRyYWNrKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJlbW90ZVN0cmVhbSA9IHBjLmdldFJlbW90ZVN0cmVhbXMoKVswXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy52aWRlbykge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLm1lZGlhLnJlbW90ZS52aWRlby5zcmNPYmplY3QgPSByZW1vdGVTdHJlYW07XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMubWVkaWEucmVtb3RlLnZpZGVvLnBsYXkoKS5jYXRjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKCdwbGF5IHdhcyByZWplY3RlZCcpO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLmF1ZGlvKSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMubWVkaWEucmVtb3RlLmF1ZGlvLnNyY09iamVjdCA9IHJlbW90ZVN0cmVhbTtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5tZWRpYS5yZW1vdGUuYXVkaW8ucGxheSgpLmNhdGNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ3BsYXkgd2FzIHJlamVjdGVkJyk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBTaW1wbGUucHJvdG90eXBlLnNldHVwTG9jYWxNZWRpYSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMudmlkZW8gJiYgdGhpcy5vcHRpb25zLm1lZGlhLmxvY2FsICYmIHRoaXMub3B0aW9ucy5tZWRpYS5sb2NhbC52aWRlbykge1xuICAgICAgICAgICAgdmFyIHBjID0gdGhpcy5zZXNzaW9uLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIucGVlckNvbm5lY3Rpb247XG4gICAgICAgICAgICB2YXIgbG9jYWxTdHJlYW07XG4gICAgICAgICAgICBpZiAocGMuZ2V0U2VuZGVycykge1xuICAgICAgICAgICAgICAgIGxvY2FsU3RyZWFtID0gbmV3IGdsb2JhbC53aW5kb3cuTWVkaWFTdHJlYW0oKTtcbiAgICAgICAgICAgICAgICBwYy5nZXRTZW5kZXJzKCkuZm9yRWFjaChmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0cmFjayA9IHNlbmRlci50cmFjaztcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRyYWNrICYmIHRyYWNrLmtpbmQgPT09ICd2aWRlbycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RyZWFtLmFkZFRyYWNrKHRyYWNrKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbG9jYWxTdHJlYW0gPSBwYy5nZXRMb2NhbFN0cmVhbXMoKVswXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5tZWRpYS5sb2NhbC52aWRlby5zcmNPYmplY3QgPSBsb2NhbFN0cmVhbTtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5tZWRpYS5sb2NhbC52aWRlby52b2x1bWUgPSAwO1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLm1lZGlhLmxvY2FsLnZpZGVvLnBsYXkoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgU2ltcGxlLnByb3RvdHlwZS5jbGVhbnVwTWVkaWEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLnZpZGVvKSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMubWVkaWEucmVtb3RlLnZpZGVvLnNyY09iamVjdCA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMubWVkaWEucmVtb3RlLnZpZGVvLnBhdXNlKCk7XG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLm1lZGlhLmxvY2FsICYmIHRoaXMub3B0aW9ucy5tZWRpYS5sb2NhbC52aWRlbykge1xuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5tZWRpYS5sb2NhbC52aWRlby5zcmNPYmplY3QgPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5tZWRpYS5sb2NhbC52aWRlby5wYXVzZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmF1ZGlvKSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMubWVkaWEucmVtb3RlLmF1ZGlvLnNyY09iamVjdCA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMubWVkaWEucmVtb3RlLmF1ZGlvLnBhdXNlKCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFNpbXBsZS5wcm90b3R5cGUuc2V0dXBTZXNzaW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnN0YXRlID0gQy5TVEFUVVNfTkVXO1xuICAgICAgICB0aGlzLmVtaXQoJ25ldycsIHRoaXMuc2Vzc2lvbik7XG4gICAgICAgIHRoaXMuc2Vzc2lvbi5vbigncHJvZ3Jlc3MnLCB0aGlzLm9uUHJvZ3Jlc3MuYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMuc2Vzc2lvbi5vbignYWNjZXB0ZWQnLCB0aGlzLm9uQWNjZXB0ZWQuYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMuc2Vzc2lvbi5vbigncmVqZWN0ZWQnLCB0aGlzLm9uRW5kZWQuYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMuc2Vzc2lvbi5vbignZmFpbGVkJywgdGhpcy5vbkZhaWxlZC5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5zZXNzaW9uLm9uKCd0ZXJtaW5hdGVkJywgdGhpcy5vbkVuZGVkLmJpbmQodGhpcykpO1xuICAgIH07XG4gICAgU2ltcGxlLnByb3RvdHlwZS5kZXN0cm95TWVkaWEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuc2Vzc2lvbi5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyLmNsb3NlKCk7XG4gICAgfTtcbiAgICBTaW1wbGUucHJvdG90eXBlLnRvZ2dsZU11dGUgPSBmdW5jdGlvbiAobXV0ZSkge1xuICAgICAgICB2YXIgcGMgPSB0aGlzLnNlc3Npb24uc2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlci5wZWVyQ29ubmVjdGlvbjtcbiAgICAgICAgaWYgKHBjLmdldFNlbmRlcnMpIHtcbiAgICAgICAgICAgIHBjLmdldFNlbmRlcnMoKS5mb3JFYWNoKGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2VuZGVyLnRyYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbmRlci50cmFjay5lbmFibGVkID0gIW11dGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBwYy5nZXRMb2NhbFN0cmVhbXMoKS5mb3JFYWNoKGZ1bmN0aW9uIChzdHJlYW0pIHtcbiAgICAgICAgICAgICAgICBzdHJlYW0uZ2V0QXVkaW9UcmFja3MoKS5mb3JFYWNoKGZ1bmN0aW9uICh0cmFjaykge1xuICAgICAgICAgICAgICAgICAgICB0cmFjay5lbmFibGVkID0gIW11dGU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc3RyZWFtLmdldFZpZGVvVHJhY2tzKCkuZm9yRWFjaChmdW5jdGlvbiAodHJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgdHJhY2suZW5hYmxlZCA9ICFtdXRlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFNpbXBsZS5wcm90b3R5cGUub25BY2NlcHRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IEMuU1RBVFVTX0NPTk5FQ1RFRDtcbiAgICAgICAgdGhpcy5lbWl0KCdjb25uZWN0ZWQnLCB0aGlzLnNlc3Npb24pO1xuICAgICAgICB0aGlzLnNldHVwTG9jYWxNZWRpYSgpO1xuICAgICAgICB0aGlzLnNldHVwUmVtb3RlTWVkaWEoKTtcbiAgICAgICAgdGhpcy5zZXNzaW9uLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXIub24oJ2FkZFRyYWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKCdBIHRyYWNrIGhhcyBiZWVuIGFkZGVkLCB0cmlnZ2VyaW5nIG5ldyByZW1vdGVNZWRpYSBzZXR1cCcpO1xuICAgICAgICAgICAgdGhpcy5zZXR1cFJlbW90ZU1lZGlhKCk7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMuc2Vzc2lvbi5zZXNzaW9uRGVzY3JpcHRpb25IYW5kbGVyLm9uKCdhZGRTdHJlYW0nLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ0Egc3RyZWFtIGhhcyBiZWVuIGFkZGVkLCB0cmlnZ2VyIG5ldyByZW1vdGVNZWRpYSBzZXR1cCcpO1xuICAgICAgICAgICAgdGhpcy5zZXR1cFJlbW90ZU1lZGlhKCk7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMuc2Vzc2lvbi5vbignaG9sZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuZW1pdCgnaG9sZCcsIHRoaXMuc2Vzc2lvbik7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMuc2Vzc2lvbi5vbigndW5ob2xkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5lbWl0KCd1bmhvbGQnLCB0aGlzLnNlc3Npb24pO1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLnNlc3Npb24ub24oJ2R0bWYnLCBmdW5jdGlvbiAodG9uZSkge1xuICAgICAgICAgICAgdGhpcy5lbWl0KCdkdG1mJywgdG9uZSk7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMuc2Vzc2lvbi5vbignYnllJywgdGhpcy5vbkVuZGVkLmJpbmQodGhpcykpO1xuICAgIH07XG4gICAgU2ltcGxlLnByb3RvdHlwZS5vblByb2dyZXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnN0YXRlID0gQy5TVEFUVVNfQ09OTkVDVElORztcbiAgICAgICAgdGhpcy5lbWl0KCdjb25uZWN0aW5nJywgdGhpcy5zZXNzaW9uKTtcbiAgICB9O1xuICAgIFNpbXBsZS5wcm90b3R5cGUub25GYWlsZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMub25FbmRlZCgpO1xuICAgIH07XG4gICAgU2ltcGxlLnByb3RvdHlwZS5vbkVuZGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnN0YXRlID0gQy5TVEFUVVNfQ09NUExFVEVEO1xuICAgICAgICB0aGlzLmVtaXQoJ2VuZGVkJywgdGhpcy5zZXNzaW9uKTtcbiAgICAgICAgdGhpcy5jbGVhbnVwTWVkaWEoKTtcbiAgICB9O1xuICAgIHJldHVybiBTaW1wbGU7XG59O1xuXG4vKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi99LmNhbGwodGhpcywgX193ZWJwYWNrX3JlcXVpcmVfXygyOCkpKVxuXG4vKioqLyB9KSxcbi8qIDQwICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblwidXNlIHN0cmljdFwiO1xuLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovKGZ1bmN0aW9uKGdsb2JhbCkge1xudmFyIHRvcGxldmVsID0gZ2xvYmFsLndpbmRvdyB8fCBnbG9iYWw7XG5mdW5jdGlvbiBnZXRQcmVmaXhlZFByb3BlcnR5KG9iamVjdCwgbmFtZSkge1xuICAgIGlmIChvYmplY3QgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBjYXBpdGFsaXplZE5hbWUgPSBuYW1lLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgbmFtZS5zbGljZSgxKTtcbiAgICB2YXIgcHJlZml4ZWROYW1lcyA9IFtuYW1lLCAnd2Via2l0JyArIGNhcGl0YWxpemVkTmFtZSwgJ21veicgKyBjYXBpdGFsaXplZE5hbWVdO1xuICAgIGZvciAodmFyIGkgaW4gcHJlZml4ZWROYW1lcykge1xuICAgICAgICB2YXIgcHJvcGVydHkgPSBvYmplY3RbcHJlZml4ZWROYW1lc1tpXV07XG4gICAgICAgIGlmIChwcm9wZXJ0eSkge1xuICAgICAgICAgICAgcmV0dXJuIHByb3BlcnR5LmJpbmQob2JqZWN0KTtcbiAgICAgICAgfVxuICAgIH1cbn1cbm1vZHVsZS5leHBvcnRzID0ge1xuICAgIFdlYlNvY2tldDogdG9wbGV2ZWwuV2ViU29ja2V0LFxuICAgIFRyYW5zcG9ydDogX193ZWJwYWNrX3JlcXVpcmVfXygxMCksXG4gICAgb3BlbjogdG9wbGV2ZWwub3BlbixcbiAgICBQcm9taXNlOiB0b3BsZXZlbC5Qcm9taXNlLFxuICAgIHRpbWVyczogdG9wbGV2ZWwsXG4gICAgLy8gQ29uc29sZSBpcyBub3QgZGVmaW5lZCBpbiBFQ01BU2NyaXB0LCBzbyBqdXN0IGluIGNhc2UuLi5cbiAgICBjb25zb2xlOiB0b3BsZXZlbC5jb25zb2xlIHx8IHtcbiAgICAgICAgZGVidWc6IGZ1bmN0aW9uICgpIHsgfSxcbiAgICAgICAgbG9nOiBmdW5jdGlvbiAoKSB7IH0sXG4gICAgICAgIHdhcm46IGZ1bmN0aW9uICgpIHsgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHsgfVxuICAgIH0sXG4gICAgYWRkRXZlbnRMaXN0ZW5lcjogZ2V0UHJlZml4ZWRQcm9wZXJ0eSh0b3BsZXZlbCwgJ2FkZEV2ZW50TGlzdGVuZXInKSxcbiAgICByZW1vdmVFdmVudExpc3RlbmVyOiBnZXRQcmVmaXhlZFByb3BlcnR5KHRvcGxldmVsLCAncmVtb3ZlRXZlbnRMaXN0ZW5lcicpXG59O1xuXG4vKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi99LmNhbGwodGhpcywgX193ZWJwYWNrX3JlcXVpcmVfXygyOCkpKVxuXG4vKioqLyB9KVxuLyoqKioqKi8gXSk7XG59KTsiLCIvKiogQGxpY2Vuc2UgUmVhY3QgdjE2LjYuMFxuICogcmVhY3QucHJvZHVjdGlvbi5taW4uanNcbiAqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqL1xuXG4ndXNlIHN0cmljdCc7dmFyIGs9cmVxdWlyZShcIm9iamVjdC1hc3NpZ25cIiksbj1cImZ1bmN0aW9uXCI9PT10eXBlb2YgU3ltYm9sJiZTeW1ib2wuZm9yLHA9bj9TeW1ib2wuZm9yKFwicmVhY3QuZWxlbWVudFwiKTo2MDEwMyxxPW4/U3ltYm9sLmZvcihcInJlYWN0LnBvcnRhbFwiKTo2MDEwNixyPW4/U3ltYm9sLmZvcihcInJlYWN0LmZyYWdtZW50XCIpOjYwMTA3LHQ9bj9TeW1ib2wuZm9yKFwicmVhY3Quc3RyaWN0X21vZGVcIik6NjAxMDgsdT1uP1N5bWJvbC5mb3IoXCJyZWFjdC5wcm9maWxlclwiKTo2MDExNCx2PW4/U3ltYm9sLmZvcihcInJlYWN0LnByb3ZpZGVyXCIpOjYwMTA5LHc9bj9TeW1ib2wuZm9yKFwicmVhY3QuY29udGV4dFwiKTo2MDExMCx4PW4/U3ltYm9sLmZvcihcInJlYWN0LmNvbmN1cnJlbnRfbW9kZVwiKTo2MDExMSx5PW4/U3ltYm9sLmZvcihcInJlYWN0LmZvcndhcmRfcmVmXCIpOjYwMTEyLHo9bj9TeW1ib2wuZm9yKFwicmVhY3Quc3VzcGVuc2VcIik6NjAxMTMsQT1uP1N5bWJvbC5mb3IoXCJyZWFjdC5tZW1vXCIpOlxuNjAxMTUsQj1uP1N5bWJvbC5mb3IoXCJyZWFjdC5sYXp5XCIpOjYwMTE2LEM9XCJmdW5jdGlvblwiPT09dHlwZW9mIFN5bWJvbCYmU3ltYm9sLml0ZXJhdG9yO2Z1bmN0aW9uIGFhKGEsYixlLGMsZCxnLGgsZil7aWYoIWEpe2E9dm9pZCAwO2lmKHZvaWQgMD09PWIpYT1FcnJvcihcIk1pbmlmaWVkIGV4Y2VwdGlvbiBvY2N1cnJlZDsgdXNlIHRoZSBub24tbWluaWZpZWQgZGV2IGVudmlyb25tZW50IGZvciB0aGUgZnVsbCBlcnJvciBtZXNzYWdlIGFuZCBhZGRpdGlvbmFsIGhlbHBmdWwgd2FybmluZ3MuXCIpO2Vsc2V7dmFyIGw9W2UsYyxkLGcsaCxmXSxtPTA7YT1FcnJvcihiLnJlcGxhY2UoLyVzL2csZnVuY3Rpb24oKXtyZXR1cm4gbFttKytdfSkpO2EubmFtZT1cIkludmFyaWFudCBWaW9sYXRpb25cIn1hLmZyYW1lc1RvUG9wPTE7dGhyb3cgYTt9fVxuZnVuY3Rpb24gRChhKXtmb3IodmFyIGI9YXJndW1lbnRzLmxlbmd0aC0xLGU9XCJodHRwczovL3JlYWN0anMub3JnL2RvY3MvZXJyb3ItZGVjb2Rlci5odG1sP2ludmFyaWFudD1cIithLGM9MDtjPGI7YysrKWUrPVwiJmFyZ3NbXT1cIitlbmNvZGVVUklDb21wb25lbnQoYXJndW1lbnRzW2MrMV0pO2FhKCExLFwiTWluaWZpZWQgUmVhY3QgZXJyb3IgI1wiK2ErXCI7IHZpc2l0ICVzIGZvciB0aGUgZnVsbCBtZXNzYWdlIG9yIHVzZSB0aGUgbm9uLW1pbmlmaWVkIGRldiBlbnZpcm9ubWVudCBmb3IgZnVsbCBlcnJvcnMgYW5kIGFkZGl0aW9uYWwgaGVscGZ1bCB3YXJuaW5ncy4gXCIsZSl9dmFyIEU9e2lzTW91bnRlZDpmdW5jdGlvbigpe3JldHVybiExfSxlbnF1ZXVlRm9yY2VVcGRhdGU6ZnVuY3Rpb24oKXt9LGVucXVldWVSZXBsYWNlU3RhdGU6ZnVuY3Rpb24oKXt9LGVucXVldWVTZXRTdGF0ZTpmdW5jdGlvbigpe319LEY9e307XG5mdW5jdGlvbiBHKGEsYixlKXt0aGlzLnByb3BzPWE7dGhpcy5jb250ZXh0PWI7dGhpcy5yZWZzPUY7dGhpcy51cGRhdGVyPWV8fEV9Ry5wcm90b3R5cGUuaXNSZWFjdENvbXBvbmVudD17fTtHLnByb3RvdHlwZS5zZXRTdGF0ZT1mdW5jdGlvbihhLGIpe1wib2JqZWN0XCIhPT10eXBlb2YgYSYmXCJmdW5jdGlvblwiIT09dHlwZW9mIGEmJm51bGwhPWE/RChcIjg1XCIpOnZvaWQgMDt0aGlzLnVwZGF0ZXIuZW5xdWV1ZVNldFN0YXRlKHRoaXMsYSxiLFwic2V0U3RhdGVcIil9O0cucHJvdG90eXBlLmZvcmNlVXBkYXRlPWZ1bmN0aW9uKGEpe3RoaXMudXBkYXRlci5lbnF1ZXVlRm9yY2VVcGRhdGUodGhpcyxhLFwiZm9yY2VVcGRhdGVcIil9O2Z1bmN0aW9uIEgoKXt9SC5wcm90b3R5cGU9Ry5wcm90b3R5cGU7ZnVuY3Rpb24gSShhLGIsZSl7dGhpcy5wcm9wcz1hO3RoaXMuY29udGV4dD1iO3RoaXMucmVmcz1GO3RoaXMudXBkYXRlcj1lfHxFfXZhciBKPUkucHJvdG90eXBlPW5ldyBIO1xuSi5jb25zdHJ1Y3Rvcj1JO2soSixHLnByb3RvdHlwZSk7Si5pc1B1cmVSZWFjdENvbXBvbmVudD0hMDt2YXIgSz17Y3VycmVudDpudWxsLGN1cnJlbnREaXNwYXRjaGVyOm51bGx9LEw9T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSxNPXtrZXk6ITAscmVmOiEwLF9fc2VsZjohMCxfX3NvdXJjZTohMH07XG5mdW5jdGlvbiBOKGEsYixlKXt2YXIgYz12b2lkIDAsZD17fSxnPW51bGwsaD1udWxsO2lmKG51bGwhPWIpZm9yKGMgaW4gdm9pZCAwIT09Yi5yZWYmJihoPWIucmVmKSx2b2lkIDAhPT1iLmtleSYmKGc9XCJcIitiLmtleSksYilMLmNhbGwoYixjKSYmIU0uaGFzT3duUHJvcGVydHkoYykmJihkW2NdPWJbY10pO3ZhciBmPWFyZ3VtZW50cy5sZW5ndGgtMjtpZigxPT09ZilkLmNoaWxkcmVuPWU7ZWxzZSBpZigxPGYpe2Zvcih2YXIgbD1BcnJheShmKSxtPTA7bTxmO20rKylsW21dPWFyZ3VtZW50c1ttKzJdO2QuY2hpbGRyZW49bH1pZihhJiZhLmRlZmF1bHRQcm9wcylmb3IoYyBpbiBmPWEuZGVmYXVsdFByb3BzLGYpdm9pZCAwPT09ZFtjXSYmKGRbY109ZltjXSk7cmV0dXJueyQkdHlwZW9mOnAsdHlwZTphLGtleTpnLHJlZjpoLHByb3BzOmQsX293bmVyOksuY3VycmVudH19XG5mdW5jdGlvbiBiYShhLGIpe3JldHVybnskJHR5cGVvZjpwLHR5cGU6YS50eXBlLGtleTpiLHJlZjphLnJlZixwcm9wczphLnByb3BzLF9vd25lcjphLl9vd25lcn19ZnVuY3Rpb24gTyhhKXtyZXR1cm5cIm9iamVjdFwiPT09dHlwZW9mIGEmJm51bGwhPT1hJiZhLiQkdHlwZW9mPT09cH1mdW5jdGlvbiBlc2NhcGUoYSl7dmFyIGI9e1wiPVwiOlwiPTBcIixcIjpcIjpcIj0yXCJ9O3JldHVyblwiJFwiKyhcIlwiK2EpLnJlcGxhY2UoL1s9Ol0vZyxmdW5jdGlvbihhKXtyZXR1cm4gYlthXX0pfXZhciBQPS9cXC8rL2csUT1bXTtmdW5jdGlvbiBSKGEsYixlLGMpe2lmKFEubGVuZ3RoKXt2YXIgZD1RLnBvcCgpO2QucmVzdWx0PWE7ZC5rZXlQcmVmaXg9YjtkLmZ1bmM9ZTtkLmNvbnRleHQ9YztkLmNvdW50PTA7cmV0dXJuIGR9cmV0dXJue3Jlc3VsdDphLGtleVByZWZpeDpiLGZ1bmM6ZSxjb250ZXh0OmMsY291bnQ6MH19XG5mdW5jdGlvbiBTKGEpe2EucmVzdWx0PW51bGw7YS5rZXlQcmVmaXg9bnVsbDthLmZ1bmM9bnVsbDthLmNvbnRleHQ9bnVsbDthLmNvdW50PTA7MTA+US5sZW5ndGgmJlEucHVzaChhKX1cbmZ1bmN0aW9uIFQoYSxiLGUsYyl7dmFyIGQ9dHlwZW9mIGE7aWYoXCJ1bmRlZmluZWRcIj09PWR8fFwiYm9vbGVhblwiPT09ZClhPW51bGw7dmFyIGc9ITE7aWYobnVsbD09PWEpZz0hMDtlbHNlIHN3aXRjaChkKXtjYXNlIFwic3RyaW5nXCI6Y2FzZSBcIm51bWJlclwiOmc9ITA7YnJlYWs7Y2FzZSBcIm9iamVjdFwiOnN3aXRjaChhLiQkdHlwZW9mKXtjYXNlIHA6Y2FzZSBxOmc9ITB9fWlmKGcpcmV0dXJuIGUoYyxhLFwiXCI9PT1iP1wiLlwiK1UoYSwwKTpiKSwxO2c9MDtiPVwiXCI9PT1iP1wiLlwiOmIrXCI6XCI7aWYoQXJyYXkuaXNBcnJheShhKSlmb3IodmFyIGg9MDtoPGEubGVuZ3RoO2grKyl7ZD1hW2hdO3ZhciBmPWIrVShkLGgpO2crPVQoZCxmLGUsYyl9ZWxzZSBpZihudWxsPT09YXx8XCJvYmplY3RcIiE9PXR5cGVvZiBhP2Y9bnVsbDooZj1DJiZhW0NdfHxhW1wiQEBpdGVyYXRvclwiXSxmPVwiZnVuY3Rpb25cIj09PXR5cGVvZiBmP2Y6bnVsbCksXCJmdW5jdGlvblwiPT09dHlwZW9mIGYpZm9yKGE9Zi5jYWxsKGEpLGg9XG4wOyEoZD1hLm5leHQoKSkuZG9uZTspZD1kLnZhbHVlLGY9YitVKGQsaCsrKSxnKz1UKGQsZixlLGMpO2Vsc2VcIm9iamVjdFwiPT09ZCYmKGU9XCJcIithLEQoXCIzMVwiLFwiW29iamVjdCBPYmplY3RdXCI9PT1lP1wib2JqZWN0IHdpdGgga2V5cyB7XCIrT2JqZWN0LmtleXMoYSkuam9pbihcIiwgXCIpK1wifVwiOmUsXCJcIikpO3JldHVybiBnfWZ1bmN0aW9uIFYoYSxiLGUpe3JldHVybiBudWxsPT1hPzA6VChhLFwiXCIsYixlKX1mdW5jdGlvbiBVKGEsYil7cmV0dXJuXCJvYmplY3RcIj09PXR5cGVvZiBhJiZudWxsIT09YSYmbnVsbCE9YS5rZXk/ZXNjYXBlKGEua2V5KTpiLnRvU3RyaW5nKDM2KX1mdW5jdGlvbiBjYShhLGIpe2EuZnVuYy5jYWxsKGEuY29udGV4dCxiLGEuY291bnQrKyl9XG5mdW5jdGlvbiBkYShhLGIsZSl7dmFyIGM9YS5yZXN1bHQsZD1hLmtleVByZWZpeDthPWEuZnVuYy5jYWxsKGEuY29udGV4dCxiLGEuY291bnQrKyk7QXJyYXkuaXNBcnJheShhKT9XKGEsYyxlLGZ1bmN0aW9uKGEpe3JldHVybiBhfSk6bnVsbCE9YSYmKE8oYSkmJihhPWJhKGEsZCsoIWEua2V5fHxiJiZiLmtleT09PWEua2V5P1wiXCI6KFwiXCIrYS5rZXkpLnJlcGxhY2UoUCxcIiQmL1wiKStcIi9cIikrZSkpLGMucHVzaChhKSl9ZnVuY3Rpb24gVyhhLGIsZSxjLGQpe3ZhciBnPVwiXCI7bnVsbCE9ZSYmKGc9KFwiXCIrZSkucmVwbGFjZShQLFwiJCYvXCIpK1wiL1wiKTtiPVIoYixnLGMsZCk7VihhLGRhLGIpO1MoYil9XG52YXIgWD17Q2hpbGRyZW46e21hcDpmdW5jdGlvbihhLGIsZSl7aWYobnVsbD09YSlyZXR1cm4gYTt2YXIgYz1bXTtXKGEsYyxudWxsLGIsZSk7cmV0dXJuIGN9LGZvckVhY2g6ZnVuY3Rpb24oYSxiLGUpe2lmKG51bGw9PWEpcmV0dXJuIGE7Yj1SKG51bGwsbnVsbCxiLGUpO1YoYSxjYSxiKTtTKGIpfSxjb3VudDpmdW5jdGlvbihhKXtyZXR1cm4gVihhLGZ1bmN0aW9uKCl7cmV0dXJuIG51bGx9LG51bGwpfSx0b0FycmF5OmZ1bmN0aW9uKGEpe3ZhciBiPVtdO1coYSxiLG51bGwsZnVuY3Rpb24oYSl7cmV0dXJuIGF9KTtyZXR1cm4gYn0sb25seTpmdW5jdGlvbihhKXtPKGEpP3ZvaWQgMDpEKFwiMTQzXCIpO3JldHVybiBhfX0sY3JlYXRlUmVmOmZ1bmN0aW9uKCl7cmV0dXJue2N1cnJlbnQ6bnVsbH19LENvbXBvbmVudDpHLFB1cmVDb21wb25lbnQ6SSxjcmVhdGVDb250ZXh0OmZ1bmN0aW9uKGEsYil7dm9pZCAwPT09YiYmKGI9bnVsbCk7YT17JCR0eXBlb2Y6dyxfY2FsY3VsYXRlQ2hhbmdlZEJpdHM6Yixcbl9jdXJyZW50VmFsdWU6YSxfY3VycmVudFZhbHVlMjphLFByb3ZpZGVyOm51bGwsQ29uc3VtZXI6bnVsbH07YS5Qcm92aWRlcj17JCR0eXBlb2Y6dixfY29udGV4dDphfTtyZXR1cm4gYS5Db25zdW1lcj1hfSxmb3J3YXJkUmVmOmZ1bmN0aW9uKGEpe3JldHVybnskJHR5cGVvZjp5LHJlbmRlcjphfX0sbGF6eTpmdW5jdGlvbihhKXtyZXR1cm57JCR0eXBlb2Y6QixfY3RvcjphLF9zdGF0dXM6LTEsX3Jlc3VsdDpudWxsfX0sbWVtbzpmdW5jdGlvbihhLGIpe3JldHVybnskJHR5cGVvZjpBLHR5cGU6YSxjb21wYXJlOnZvaWQgMD09PWI/bnVsbDpifX0sRnJhZ21lbnQ6cixTdHJpY3RNb2RlOnQsdW5zdGFibGVfQ29uY3VycmVudE1vZGU6eCxTdXNwZW5zZTp6LHVuc3RhYmxlX1Byb2ZpbGVyOnUsY3JlYXRlRWxlbWVudDpOLGNsb25lRWxlbWVudDpmdW5jdGlvbihhLGIsZSl7bnVsbD09PWF8fHZvaWQgMD09PWE/RChcIjI2N1wiLGEpOnZvaWQgMDt2YXIgYz12b2lkIDAsZD1rKHt9LGEucHJvcHMpLFxuZz1hLmtleSxoPWEucmVmLGY9YS5fb3duZXI7aWYobnVsbCE9Yil7dm9pZCAwIT09Yi5yZWYmJihoPWIucmVmLGY9Sy5jdXJyZW50KTt2b2lkIDAhPT1iLmtleSYmKGc9XCJcIitiLmtleSk7dmFyIGw9dm9pZCAwO2EudHlwZSYmYS50eXBlLmRlZmF1bHRQcm9wcyYmKGw9YS50eXBlLmRlZmF1bHRQcm9wcyk7Zm9yKGMgaW4gYilMLmNhbGwoYixjKSYmIU0uaGFzT3duUHJvcGVydHkoYykmJihkW2NdPXZvaWQgMD09PWJbY10mJnZvaWQgMCE9PWw/bFtjXTpiW2NdKX1jPWFyZ3VtZW50cy5sZW5ndGgtMjtpZigxPT09YylkLmNoaWxkcmVuPWU7ZWxzZSBpZigxPGMpe2w9QXJyYXkoYyk7Zm9yKHZhciBtPTA7bTxjO20rKylsW21dPWFyZ3VtZW50c1ttKzJdO2QuY2hpbGRyZW49bH1yZXR1cm57JCR0eXBlb2Y6cCx0eXBlOmEudHlwZSxrZXk6ZyxyZWY6aCxwcm9wczpkLF9vd25lcjpmfX0sY3JlYXRlRmFjdG9yeTpmdW5jdGlvbihhKXt2YXIgYj1OLmJpbmQobnVsbCxhKTtiLnR5cGU9YTtyZXR1cm4gYn0sXG5pc1ZhbGlkRWxlbWVudDpPLHZlcnNpb246XCIxNi42LjBcIixfX1NFQ1JFVF9JTlRFUk5BTFNfRE9fTk9UX1VTRV9PUl9ZT1VfV0lMTF9CRV9GSVJFRDp7UmVhY3RDdXJyZW50T3duZXI6Syxhc3NpZ246a319LFk9e2RlZmF1bHQ6WH0sWj1ZJiZYfHxZO21vZHVsZS5leHBvcnRzPVouZGVmYXVsdHx8WjtcbiIsIi8qKiBAbGljZW5zZSBSZWFjdCB2MTYuNi4wXG4gKiByZWFjdC1kb20ucHJvZHVjdGlvbi5taW4uanNcbiAqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqL1xuXG4vKlxuIE1vZGVybml6ciAzLjAuMHByZSAoQ3VzdG9tIEJ1aWxkKSB8IE1JVFxuKi9cbid1c2Ugc3RyaWN0Jzt2YXIgYWE9cmVxdWlyZShcInJlYWN0XCIpLG49cmVxdWlyZShcIm9iamVjdC1hc3NpZ25cIiksZGE9cmVxdWlyZShcInNjaGVkdWxlclwiKTtmdW5jdGlvbiBlYShhLGIsYyxkLGUsZixnLGgpe2lmKCFhKXthPXZvaWQgMDtpZih2b2lkIDA9PT1iKWE9RXJyb3IoXCJNaW5pZmllZCBleGNlcHRpb24gb2NjdXJyZWQ7IHVzZSB0aGUgbm9uLW1pbmlmaWVkIGRldiBlbnZpcm9ubWVudCBmb3IgdGhlIGZ1bGwgZXJyb3IgbWVzc2FnZSBhbmQgYWRkaXRpb25hbCBoZWxwZnVsIHdhcm5pbmdzLlwiKTtlbHNle3ZhciBrPVtjLGQsZSxmLGcsaF0sbD0wO2E9RXJyb3IoYi5yZXBsYWNlKC8lcy9nLGZ1bmN0aW9uKCl7cmV0dXJuIGtbbCsrXX0pKTthLm5hbWU9XCJJbnZhcmlhbnQgVmlvbGF0aW9uXCJ9YS5mcmFtZXNUb1BvcD0xO3Rocm93IGE7fX1cbmZ1bmN0aW9uIHIoYSl7Zm9yKHZhciBiPWFyZ3VtZW50cy5sZW5ndGgtMSxjPVwiaHR0cHM6Ly9yZWFjdGpzLm9yZy9kb2NzL2Vycm9yLWRlY29kZXIuaHRtbD9pbnZhcmlhbnQ9XCIrYSxkPTA7ZDxiO2QrKyljKz1cIiZhcmdzW109XCIrZW5jb2RlVVJJQ29tcG9uZW50KGFyZ3VtZW50c1tkKzFdKTtlYSghMSxcIk1pbmlmaWVkIFJlYWN0IGVycm9yICNcIithK1wiOyB2aXNpdCAlcyBmb3IgdGhlIGZ1bGwgbWVzc2FnZSBvciB1c2UgdGhlIG5vbi1taW5pZmllZCBkZXYgZW52aXJvbm1lbnQgZm9yIGZ1bGwgZXJyb3JzIGFuZCBhZGRpdGlvbmFsIGhlbHBmdWwgd2FybmluZ3MuIFwiLGMpfWFhP3ZvaWQgMDpyKFwiMjI3XCIpO2Z1bmN0aW9uIGZhKGEsYixjLGQsZSxmLGcsaCxrKXt2YXIgbD1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMyk7dHJ5e2IuYXBwbHkoYyxsKX1jYXRjaChtKXt0aGlzLm9uRXJyb3IobSl9fVxudmFyIGhhPSExLGlhPW51bGwsamE9ITEsa2E9bnVsbCxsYT17b25FcnJvcjpmdW5jdGlvbihhKXtoYT0hMDtpYT1hfX07ZnVuY3Rpb24gbWEoYSxiLGMsZCxlLGYsZyxoLGspe2hhPSExO2lhPW51bGw7ZmEuYXBwbHkobGEsYXJndW1lbnRzKX1mdW5jdGlvbiBuYShhLGIsYyxkLGUsZixnLGgsayl7bWEuYXBwbHkodGhpcyxhcmd1bWVudHMpO2lmKGhhKXtpZihoYSl7dmFyIGw9aWE7aGE9ITE7aWE9bnVsbH1lbHNlIHIoXCIxOThcIiksbD12b2lkIDA7amF8fChqYT0hMCxrYT1sKX19dmFyIG9hPW51bGwscGE9e307XG5mdW5jdGlvbiBxYSgpe2lmKG9hKWZvcih2YXIgYSBpbiBwYSl7dmFyIGI9cGFbYV0sYz1vYS5pbmRleE9mKGEpOy0xPGM/dm9pZCAwOnIoXCI5NlwiLGEpO2lmKCFyYVtjXSl7Yi5leHRyYWN0RXZlbnRzP3ZvaWQgMDpyKFwiOTdcIixhKTtyYVtjXT1iO2M9Yi5ldmVudFR5cGVzO2Zvcih2YXIgZCBpbiBjKXt2YXIgZT12b2lkIDA7dmFyIGY9Y1tkXSxnPWIsaD1kO3NhLmhhc093blByb3BlcnR5KGgpP3IoXCI5OVwiLGgpOnZvaWQgMDtzYVtoXT1mO3ZhciBrPWYucGhhc2VkUmVnaXN0cmF0aW9uTmFtZXM7aWYoayl7Zm9yKGUgaW4gaylrLmhhc093blByb3BlcnR5KGUpJiZ0YShrW2VdLGcsaCk7ZT0hMH1lbHNlIGYucmVnaXN0cmF0aW9uTmFtZT8odGEoZi5yZWdpc3RyYXRpb25OYW1lLGcsaCksZT0hMCk6ZT0hMTtlP3ZvaWQgMDpyKFwiOThcIixkLGEpfX19fVxuZnVuY3Rpb24gdGEoYSxiLGMpe3VhW2FdP3IoXCIxMDBcIixhKTp2b2lkIDA7dWFbYV09Yjt2YVthXT1iLmV2ZW50VHlwZXNbY10uZGVwZW5kZW5jaWVzfXZhciByYT1bXSxzYT17fSx1YT17fSx2YT17fSx3YT1udWxsLHhhPW51bGwseWE9bnVsbDtmdW5jdGlvbiB6YShhLGIsYyxkKXtiPWEudHlwZXx8XCJ1bmtub3duLWV2ZW50XCI7YS5jdXJyZW50VGFyZ2V0PXlhKGQpO25hKGIsYyx2b2lkIDAsYSk7YS5jdXJyZW50VGFyZ2V0PW51bGx9ZnVuY3Rpb24gQWEoYSxiKXtudWxsPT1iP3IoXCIzMFwiKTp2b2lkIDA7aWYobnVsbD09YSlyZXR1cm4gYjtpZihBcnJheS5pc0FycmF5KGEpKXtpZihBcnJheS5pc0FycmF5KGIpKXJldHVybiBhLnB1c2guYXBwbHkoYSxiKSxhO2EucHVzaChiKTtyZXR1cm4gYX1yZXR1cm4gQXJyYXkuaXNBcnJheShiKT9bYV0uY29uY2F0KGIpOlthLGJdfVxuZnVuY3Rpb24gQmEoYSxiLGMpe0FycmF5LmlzQXJyYXkoYSk/YS5mb3JFYWNoKGIsYyk6YSYmYi5jYWxsKGMsYSl9dmFyIENhPW51bGw7ZnVuY3Rpb24gRGEoYSxiKXtpZihhKXt2YXIgYz1hLl9kaXNwYXRjaExpc3RlbmVycyxkPWEuX2Rpc3BhdGNoSW5zdGFuY2VzO2lmKEFycmF5LmlzQXJyYXkoYykpZm9yKHZhciBlPTA7ZTxjLmxlbmd0aCYmIWEuaXNQcm9wYWdhdGlvblN0b3BwZWQoKTtlKyspemEoYSxiLGNbZV0sZFtlXSk7ZWxzZSBjJiZ6YShhLGIsYyxkKTthLl9kaXNwYXRjaExpc3RlbmVycz1udWxsO2EuX2Rpc3BhdGNoSW5zdGFuY2VzPW51bGw7YS5pc1BlcnNpc3RlbnQoKXx8YS5jb25zdHJ1Y3Rvci5yZWxlYXNlKGEpfX1mdW5jdGlvbiBFYShhKXtyZXR1cm4gRGEoYSwhMCl9ZnVuY3Rpb24gRmEoYSl7cmV0dXJuIERhKGEsITEpfVxudmFyIEdhPXtpbmplY3RFdmVudFBsdWdpbk9yZGVyOmZ1bmN0aW9uKGEpe29hP3IoXCIxMDFcIik6dm9pZCAwO29hPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGEpO3FhKCl9LGluamVjdEV2ZW50UGx1Z2luc0J5TmFtZTpmdW5jdGlvbihhKXt2YXIgYj0hMSxjO2ZvcihjIGluIGEpaWYoYS5oYXNPd25Qcm9wZXJ0eShjKSl7dmFyIGQ9YVtjXTtwYS5oYXNPd25Qcm9wZXJ0eShjKSYmcGFbY109PT1kfHwocGFbY10/cihcIjEwMlwiLGMpOnZvaWQgMCxwYVtjXT1kLGI9ITApfWImJnFhKCl9fTtcbmZ1bmN0aW9uIEhhKGEsYil7dmFyIGM9YS5zdGF0ZU5vZGU7aWYoIWMpcmV0dXJuIG51bGw7dmFyIGQ9d2EoYyk7aWYoIWQpcmV0dXJuIG51bGw7Yz1kW2JdO2E6c3dpdGNoKGIpe2Nhc2UgXCJvbkNsaWNrXCI6Y2FzZSBcIm9uQ2xpY2tDYXB0dXJlXCI6Y2FzZSBcIm9uRG91YmxlQ2xpY2tcIjpjYXNlIFwib25Eb3VibGVDbGlja0NhcHR1cmVcIjpjYXNlIFwib25Nb3VzZURvd25cIjpjYXNlIFwib25Nb3VzZURvd25DYXB0dXJlXCI6Y2FzZSBcIm9uTW91c2VNb3ZlXCI6Y2FzZSBcIm9uTW91c2VNb3ZlQ2FwdHVyZVwiOmNhc2UgXCJvbk1vdXNlVXBcIjpjYXNlIFwib25Nb3VzZVVwQ2FwdHVyZVwiOihkPSFkLmRpc2FibGVkKXx8KGE9YS50eXBlLGQ9IShcImJ1dHRvblwiPT09YXx8XCJpbnB1dFwiPT09YXx8XCJzZWxlY3RcIj09PWF8fFwidGV4dGFyZWFcIj09PWEpKTthPSFkO2JyZWFrIGE7ZGVmYXVsdDphPSExfWlmKGEpcmV0dXJuIG51bGw7YyYmXCJmdW5jdGlvblwiIT09dHlwZW9mIGM/cihcIjIzMVwiLGIsdHlwZW9mIGMpOnZvaWQgMDtcbnJldHVybiBjfWZ1bmN0aW9uIElhKGEsYil7bnVsbCE9PWEmJihDYT1BYShDYSxhKSk7YT1DYTtDYT1udWxsO2lmKGEmJihiP0JhKGEsRWEpOkJhKGEsRmEpLENhP3IoXCI5NVwiKTp2b2lkIDAsamEpKXRocm93IGI9a2EsamE9ITEsa2E9bnVsbCxiO312YXIgS2E9TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiksTGE9XCJfX3JlYWN0SW50ZXJuYWxJbnN0YW5jZSRcIitLYSxNYT1cIl9fcmVhY3RFdmVudEhhbmRsZXJzJFwiK0thO2Z1bmN0aW9uIE5hKGEpe2lmKGFbTGFdKXJldHVybiBhW0xhXTtmb3IoOyFhW0xhXTspaWYoYS5wYXJlbnROb2RlKWE9YS5wYXJlbnROb2RlO2Vsc2UgcmV0dXJuIG51bGw7YT1hW0xhXTtyZXR1cm4gNT09PWEudGFnfHw2PT09YS50YWc/YTpudWxsfWZ1bmN0aW9uIE9hKGEpe2E9YVtMYV07cmV0dXJuIWF8fDUhPT1hLnRhZyYmNiE9PWEudGFnP251bGw6YX1cbmZ1bmN0aW9uIFBhKGEpe2lmKDU9PT1hLnRhZ3x8Nj09PWEudGFnKXJldHVybiBhLnN0YXRlTm9kZTtyKFwiMzNcIil9ZnVuY3Rpb24gUWEoYSl7cmV0dXJuIGFbTWFdfHxudWxsfWZ1bmN0aW9uIFJhKGEpe2RvIGE9YS5yZXR1cm47d2hpbGUoYSYmNSE9PWEudGFnKTtyZXR1cm4gYT9hOm51bGx9ZnVuY3Rpb24gU2EoYSxiLGMpe2lmKGI9SGEoYSxjLmRpc3BhdGNoQ29uZmlnLnBoYXNlZFJlZ2lzdHJhdGlvbk5hbWVzW2JdKSljLl9kaXNwYXRjaExpc3RlbmVycz1BYShjLl9kaXNwYXRjaExpc3RlbmVycyxiKSxjLl9kaXNwYXRjaEluc3RhbmNlcz1BYShjLl9kaXNwYXRjaEluc3RhbmNlcyxhKX1cbmZ1bmN0aW9uIFRhKGEpe2lmKGEmJmEuZGlzcGF0Y2hDb25maWcucGhhc2VkUmVnaXN0cmF0aW9uTmFtZXMpe2Zvcih2YXIgYj1hLl90YXJnZXRJbnN0LGM9W107YjspYy5wdXNoKGIpLGI9UmEoYik7Zm9yKGI9Yy5sZW5ndGg7MDxiLS07KVNhKGNbYl0sXCJjYXB0dXJlZFwiLGEpO2ZvcihiPTA7YjxjLmxlbmd0aDtiKyspU2EoY1tiXSxcImJ1YmJsZWRcIixhKX19ZnVuY3Rpb24gVWEoYSxiLGMpe2EmJmMmJmMuZGlzcGF0Y2hDb25maWcucmVnaXN0cmF0aW9uTmFtZSYmKGI9SGEoYSxjLmRpc3BhdGNoQ29uZmlnLnJlZ2lzdHJhdGlvbk5hbWUpKSYmKGMuX2Rpc3BhdGNoTGlzdGVuZXJzPUFhKGMuX2Rpc3BhdGNoTGlzdGVuZXJzLGIpLGMuX2Rpc3BhdGNoSW5zdGFuY2VzPUFhKGMuX2Rpc3BhdGNoSW5zdGFuY2VzLGEpKX1mdW5jdGlvbiBWYShhKXthJiZhLmRpc3BhdGNoQ29uZmlnLnJlZ2lzdHJhdGlvbk5hbWUmJlVhKGEuX3RhcmdldEluc3QsbnVsbCxhKX1cbmZ1bmN0aW9uIFdhKGEpe0JhKGEsVGEpfXZhciBYYT0hKFwidW5kZWZpbmVkXCI9PT10eXBlb2Ygd2luZG93fHwhd2luZG93LmRvY3VtZW50fHwhd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQpO2Z1bmN0aW9uIFlhKGEsYil7dmFyIGM9e307Y1thLnRvTG93ZXJDYXNlKCldPWIudG9Mb3dlckNhc2UoKTtjW1wiV2Via2l0XCIrYV09XCJ3ZWJraXRcIitiO2NbXCJNb3pcIithXT1cIm1velwiK2I7cmV0dXJuIGN9dmFyIFphPXthbmltYXRpb25lbmQ6WWEoXCJBbmltYXRpb25cIixcIkFuaW1hdGlvbkVuZFwiKSxhbmltYXRpb25pdGVyYXRpb246WWEoXCJBbmltYXRpb25cIixcIkFuaW1hdGlvbkl0ZXJhdGlvblwiKSxhbmltYXRpb25zdGFydDpZYShcIkFuaW1hdGlvblwiLFwiQW5pbWF0aW9uU3RhcnRcIiksdHJhbnNpdGlvbmVuZDpZYShcIlRyYW5zaXRpb25cIixcIlRyYW5zaXRpb25FbmRcIil9LCRhPXt9LGFiPXt9O1xuWGEmJihhYj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLnN0eWxlLFwiQW5pbWF0aW9uRXZlbnRcImluIHdpbmRvd3x8KGRlbGV0ZSBaYS5hbmltYXRpb25lbmQuYW5pbWF0aW9uLGRlbGV0ZSBaYS5hbmltYXRpb25pdGVyYXRpb24uYW5pbWF0aW9uLGRlbGV0ZSBaYS5hbmltYXRpb25zdGFydC5hbmltYXRpb24pLFwiVHJhbnNpdGlvbkV2ZW50XCJpbiB3aW5kb3d8fGRlbGV0ZSBaYS50cmFuc2l0aW9uZW5kLnRyYW5zaXRpb24pO2Z1bmN0aW9uIGJiKGEpe2lmKCRhW2FdKXJldHVybiAkYVthXTtpZighWmFbYV0pcmV0dXJuIGE7dmFyIGI9WmFbYV0sYztmb3IoYyBpbiBiKWlmKGIuaGFzT3duUHJvcGVydHkoYykmJmMgaW4gYWIpcmV0dXJuICRhW2FdPWJbY107cmV0dXJuIGF9XG52YXIgY2I9YmIoXCJhbmltYXRpb25lbmRcIiksaWI9YmIoXCJhbmltYXRpb25pdGVyYXRpb25cIiksamI9YmIoXCJhbmltYXRpb25zdGFydFwiKSxrYj1iYihcInRyYW5zaXRpb25lbmRcIiksbGI9XCJhYm9ydCBjYW5wbGF5IGNhbnBsYXl0aHJvdWdoIGR1cmF0aW9uY2hhbmdlIGVtcHRpZWQgZW5jcnlwdGVkIGVuZGVkIGVycm9yIGxvYWRlZGRhdGEgbG9hZGVkbWV0YWRhdGEgbG9hZHN0YXJ0IHBhdXNlIHBsYXkgcGxheWluZyBwcm9ncmVzcyByYXRlY2hhbmdlIHNlZWtlZCBzZWVraW5nIHN0YWxsZWQgc3VzcGVuZCB0aW1ldXBkYXRlIHZvbHVtZWNoYW5nZSB3YWl0aW5nXCIuc3BsaXQoXCIgXCIpLG1iPW51bGwsbmI9bnVsbCxvYj1udWxsO1xuZnVuY3Rpb24gcGIoKXtpZihvYilyZXR1cm4gb2I7dmFyIGEsYj1uYixjPWIubGVuZ3RoLGQsZT1cInZhbHVlXCJpbiBtYj9tYi52YWx1ZTptYi50ZXh0Q29udGVudCxmPWUubGVuZ3RoO2ZvcihhPTA7YTxjJiZiW2FdPT09ZVthXTthKyspO3ZhciBnPWMtYTtmb3IoZD0xO2Q8PWcmJmJbYy1kXT09PWVbZi1kXTtkKyspO3JldHVybiBvYj1lLnNsaWNlKGEsMTxkPzEtZDp2b2lkIDApfWZ1bmN0aW9uIHFiKCl7cmV0dXJuITB9ZnVuY3Rpb24gcmIoKXtyZXR1cm4hMX1cbmZ1bmN0aW9uIHkoYSxiLGMsZCl7dGhpcy5kaXNwYXRjaENvbmZpZz1hO3RoaXMuX3RhcmdldEluc3Q9Yjt0aGlzLm5hdGl2ZUV2ZW50PWM7YT10aGlzLmNvbnN0cnVjdG9yLkludGVyZmFjZTtmb3IodmFyIGUgaW4gYSlhLmhhc093blByb3BlcnR5KGUpJiYoKGI9YVtlXSk/dGhpc1tlXT1iKGMpOlwidGFyZ2V0XCI9PT1lP3RoaXMudGFyZ2V0PWQ6dGhpc1tlXT1jW2VdKTt0aGlzLmlzRGVmYXVsdFByZXZlbnRlZD0obnVsbCE9Yy5kZWZhdWx0UHJldmVudGVkP2MuZGVmYXVsdFByZXZlbnRlZDohMT09PWMucmV0dXJuVmFsdWUpP3FiOnJiO3RoaXMuaXNQcm9wYWdhdGlvblN0b3BwZWQ9cmI7cmV0dXJuIHRoaXN9XG5uKHkucHJvdG90eXBlLHtwcmV2ZW50RGVmYXVsdDpmdW5jdGlvbigpe3RoaXMuZGVmYXVsdFByZXZlbnRlZD0hMDt2YXIgYT10aGlzLm5hdGl2ZUV2ZW50O2EmJihhLnByZXZlbnREZWZhdWx0P2EucHJldmVudERlZmF1bHQoKTpcInVua25vd25cIiE9PXR5cGVvZiBhLnJldHVyblZhbHVlJiYoYS5yZXR1cm5WYWx1ZT0hMSksdGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQ9cWIpfSxzdG9wUHJvcGFnYXRpb246ZnVuY3Rpb24oKXt2YXIgYT10aGlzLm5hdGl2ZUV2ZW50O2EmJihhLnN0b3BQcm9wYWdhdGlvbj9hLnN0b3BQcm9wYWdhdGlvbigpOlwidW5rbm93blwiIT09dHlwZW9mIGEuY2FuY2VsQnViYmxlJiYoYS5jYW5jZWxCdWJibGU9ITApLHRoaXMuaXNQcm9wYWdhdGlvblN0b3BwZWQ9cWIpfSxwZXJzaXN0OmZ1bmN0aW9uKCl7dGhpcy5pc1BlcnNpc3RlbnQ9cWJ9LGlzUGVyc2lzdGVudDpyYixkZXN0cnVjdG9yOmZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5jb25zdHJ1Y3Rvci5JbnRlcmZhY2UsXG5iO2ZvcihiIGluIGEpdGhpc1tiXT1udWxsO3RoaXMubmF0aXZlRXZlbnQ9dGhpcy5fdGFyZ2V0SW5zdD10aGlzLmRpc3BhdGNoQ29uZmlnPW51bGw7dGhpcy5pc1Byb3BhZ2F0aW9uU3RvcHBlZD10aGlzLmlzRGVmYXVsdFByZXZlbnRlZD1yYjt0aGlzLl9kaXNwYXRjaEluc3RhbmNlcz10aGlzLl9kaXNwYXRjaExpc3RlbmVycz1udWxsfX0pO3kuSW50ZXJmYWNlPXt0eXBlOm51bGwsdGFyZ2V0Om51bGwsY3VycmVudFRhcmdldDpmdW5jdGlvbigpe3JldHVybiBudWxsfSxldmVudFBoYXNlOm51bGwsYnViYmxlczpudWxsLGNhbmNlbGFibGU6bnVsbCx0aW1lU3RhbXA6ZnVuY3Rpb24oYSl7cmV0dXJuIGEudGltZVN0YW1wfHxEYXRlLm5vdygpfSxkZWZhdWx0UHJldmVudGVkOm51bGwsaXNUcnVzdGVkOm51bGx9O1xueS5leHRlbmQ9ZnVuY3Rpb24oYSl7ZnVuY3Rpb24gYigpe31mdW5jdGlvbiBjKCl7cmV0dXJuIGQuYXBwbHkodGhpcyxhcmd1bWVudHMpfXZhciBkPXRoaXM7Yi5wcm90b3R5cGU9ZC5wcm90b3R5cGU7dmFyIGU9bmV3IGI7bihlLGMucHJvdG90eXBlKTtjLnByb3RvdHlwZT1lO2MucHJvdG90eXBlLmNvbnN0cnVjdG9yPWM7Yy5JbnRlcmZhY2U9bih7fSxkLkludGVyZmFjZSxhKTtjLmV4dGVuZD1kLmV4dGVuZDtzYihjKTtyZXR1cm4gY307c2IoeSk7ZnVuY3Rpb24gdGIoYSxiLGMsZCl7aWYodGhpcy5ldmVudFBvb2wubGVuZ3RoKXt2YXIgZT10aGlzLmV2ZW50UG9vbC5wb3AoKTt0aGlzLmNhbGwoZSxhLGIsYyxkKTtyZXR1cm4gZX1yZXR1cm4gbmV3IHRoaXMoYSxiLGMsZCl9ZnVuY3Rpb24gdWIoYSl7YSBpbnN0YW5jZW9mIHRoaXM/dm9pZCAwOnIoXCIyNzlcIik7YS5kZXN0cnVjdG9yKCk7MTA+dGhpcy5ldmVudFBvb2wubGVuZ3RoJiZ0aGlzLmV2ZW50UG9vbC5wdXNoKGEpfVxuZnVuY3Rpb24gc2IoYSl7YS5ldmVudFBvb2w9W107YS5nZXRQb29sZWQ9dGI7YS5yZWxlYXNlPXVifXZhciB2Yj15LmV4dGVuZCh7ZGF0YTpudWxsfSksd2I9eS5leHRlbmQoe2RhdGE6bnVsbH0pLHhiPVs5LDEzLDI3LDMyXSx5Yj1YYSYmXCJDb21wb3NpdGlvbkV2ZW50XCJpbiB3aW5kb3csemI9bnVsbDtYYSYmXCJkb2N1bWVudE1vZGVcImluIGRvY3VtZW50JiYoemI9ZG9jdW1lbnQuZG9jdW1lbnRNb2RlKTtcbnZhciBBYj1YYSYmXCJUZXh0RXZlbnRcImluIHdpbmRvdyYmIXpiLEJiPVhhJiYoIXlifHx6YiYmODx6YiYmMTE+PXpiKSxDYj1TdHJpbmcuZnJvbUNoYXJDb2RlKDMyKSxEYj17YmVmb3JlSW5wdXQ6e3BoYXNlZFJlZ2lzdHJhdGlvbk5hbWVzOntidWJibGVkOlwib25CZWZvcmVJbnB1dFwiLGNhcHR1cmVkOlwib25CZWZvcmVJbnB1dENhcHR1cmVcIn0sZGVwZW5kZW5jaWVzOltcImNvbXBvc2l0aW9uZW5kXCIsXCJrZXlwcmVzc1wiLFwidGV4dElucHV0XCIsXCJwYXN0ZVwiXX0sY29tcG9zaXRpb25FbmQ6e3BoYXNlZFJlZ2lzdHJhdGlvbk5hbWVzOntidWJibGVkOlwib25Db21wb3NpdGlvbkVuZFwiLGNhcHR1cmVkOlwib25Db21wb3NpdGlvbkVuZENhcHR1cmVcIn0sZGVwZW5kZW5jaWVzOlwiYmx1ciBjb21wb3NpdGlvbmVuZCBrZXlkb3duIGtleXByZXNzIGtleXVwIG1vdXNlZG93blwiLnNwbGl0KFwiIFwiKX0sY29tcG9zaXRpb25TdGFydDp7cGhhc2VkUmVnaXN0cmF0aW9uTmFtZXM6e2J1YmJsZWQ6XCJvbkNvbXBvc2l0aW9uU3RhcnRcIixcbmNhcHR1cmVkOlwib25Db21wb3NpdGlvblN0YXJ0Q2FwdHVyZVwifSxkZXBlbmRlbmNpZXM6XCJibHVyIGNvbXBvc2l0aW9uc3RhcnQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBtb3VzZWRvd25cIi5zcGxpdChcIiBcIil9LGNvbXBvc2l0aW9uVXBkYXRlOntwaGFzZWRSZWdpc3RyYXRpb25OYW1lczp7YnViYmxlZDpcIm9uQ29tcG9zaXRpb25VcGRhdGVcIixjYXB0dXJlZDpcIm9uQ29tcG9zaXRpb25VcGRhdGVDYXB0dXJlXCJ9LGRlcGVuZGVuY2llczpcImJsdXIgY29tcG9zaXRpb251cGRhdGUga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBtb3VzZWRvd25cIi5zcGxpdChcIiBcIil9fSxFYj0hMTtcbmZ1bmN0aW9uIEZiKGEsYil7c3dpdGNoKGEpe2Nhc2UgXCJrZXl1cFwiOnJldHVybi0xIT09eGIuaW5kZXhPZihiLmtleUNvZGUpO2Nhc2UgXCJrZXlkb3duXCI6cmV0dXJuIDIyOSE9PWIua2V5Q29kZTtjYXNlIFwia2V5cHJlc3NcIjpjYXNlIFwibW91c2Vkb3duXCI6Y2FzZSBcImJsdXJcIjpyZXR1cm4hMDtkZWZhdWx0OnJldHVybiExfX1mdW5jdGlvbiBHYihhKXthPWEuZGV0YWlsO3JldHVyblwib2JqZWN0XCI9PT10eXBlb2YgYSYmXCJkYXRhXCJpbiBhP2EuZGF0YTpudWxsfXZhciBIYj0hMTtmdW5jdGlvbiBLYihhLGIpe3N3aXRjaChhKXtjYXNlIFwiY29tcG9zaXRpb25lbmRcIjpyZXR1cm4gR2IoYik7Y2FzZSBcImtleXByZXNzXCI6aWYoMzIhPT1iLndoaWNoKXJldHVybiBudWxsO0ViPSEwO3JldHVybiBDYjtjYXNlIFwidGV4dElucHV0XCI6cmV0dXJuIGE9Yi5kYXRhLGE9PT1DYiYmRWI/bnVsbDphO2RlZmF1bHQ6cmV0dXJuIG51bGx9fVxuZnVuY3Rpb24gTGIoYSxiKXtpZihIYilyZXR1cm5cImNvbXBvc2l0aW9uZW5kXCI9PT1hfHwheWImJkZiKGEsYik/KGE9cGIoKSxvYj1uYj1tYj1udWxsLEhiPSExLGEpOm51bGw7c3dpdGNoKGEpe2Nhc2UgXCJwYXN0ZVwiOnJldHVybiBudWxsO2Nhc2UgXCJrZXlwcmVzc1wiOmlmKCEoYi5jdHJsS2V5fHxiLmFsdEtleXx8Yi5tZXRhS2V5KXx8Yi5jdHJsS2V5JiZiLmFsdEtleSl7aWYoYi5jaGFyJiYxPGIuY2hhci5sZW5ndGgpcmV0dXJuIGIuY2hhcjtpZihiLndoaWNoKXJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKGIud2hpY2gpfXJldHVybiBudWxsO2Nhc2UgXCJjb21wb3NpdGlvbmVuZFwiOnJldHVybiBCYiYmXCJrb1wiIT09Yi5sb2NhbGU/bnVsbDpiLmRhdGE7ZGVmYXVsdDpyZXR1cm4gbnVsbH19XG52YXIgTWI9e2V2ZW50VHlwZXM6RGIsZXh0cmFjdEV2ZW50czpmdW5jdGlvbihhLGIsYyxkKXt2YXIgZT12b2lkIDA7dmFyIGY9dm9pZCAwO2lmKHliKWI6e3N3aXRjaChhKXtjYXNlIFwiY29tcG9zaXRpb25zdGFydFwiOmU9RGIuY29tcG9zaXRpb25TdGFydDticmVhayBiO2Nhc2UgXCJjb21wb3NpdGlvbmVuZFwiOmU9RGIuY29tcG9zaXRpb25FbmQ7YnJlYWsgYjtjYXNlIFwiY29tcG9zaXRpb251cGRhdGVcIjplPURiLmNvbXBvc2l0aW9uVXBkYXRlO2JyZWFrIGJ9ZT12b2lkIDB9ZWxzZSBIYj9GYihhLGMpJiYoZT1EYi5jb21wb3NpdGlvbkVuZCk6XCJrZXlkb3duXCI9PT1hJiYyMjk9PT1jLmtleUNvZGUmJihlPURiLmNvbXBvc2l0aW9uU3RhcnQpO2U/KEJiJiZcImtvXCIhPT1jLmxvY2FsZSYmKEhifHxlIT09RGIuY29tcG9zaXRpb25TdGFydD9lPT09RGIuY29tcG9zaXRpb25FbmQmJkhiJiYoZj1wYigpKToobWI9ZCxuYj1cInZhbHVlXCJpbiBtYj9tYi52YWx1ZTptYi50ZXh0Q29udGVudCxIYj1cbiEwKSksZT12Yi5nZXRQb29sZWQoZSxiLGMsZCksZj9lLmRhdGE9ZjooZj1HYihjKSxudWxsIT09ZiYmKGUuZGF0YT1mKSksV2EoZSksZj1lKTpmPW51bGw7KGE9QWI/S2IoYSxjKTpMYihhLGMpKT8oYj13Yi5nZXRQb29sZWQoRGIuYmVmb3JlSW5wdXQsYixjLGQpLGIuZGF0YT1hLFdhKGIpKTpiPW51bGw7cmV0dXJuIG51bGw9PT1mP2I6bnVsbD09PWI/ZjpbZixiXX19LE5iPW51bGwsT2I9bnVsbCxQYj1udWxsO2Z1bmN0aW9uIFZiKGEpe2lmKGE9eGEoYSkpe1wiZnVuY3Rpb25cIiE9PXR5cGVvZiBOYj9yKFwiMjgwXCIpOnZvaWQgMDt2YXIgYj13YShhLnN0YXRlTm9kZSk7TmIoYS5zdGF0ZU5vZGUsYS50eXBlLGIpfX1mdW5jdGlvbiBXYihhKXtPYj9QYj9QYi5wdXNoKGEpOlBiPVthXTpPYj1hfWZ1bmN0aW9uIFhiKCl7aWYoT2Ipe3ZhciBhPU9iLGI9UGI7UGI9T2I9bnVsbDtWYihhKTtpZihiKWZvcihhPTA7YTxiLmxlbmd0aDthKyspVmIoYlthXSl9fVxuZnVuY3Rpb24gWWIoYSxiKXtyZXR1cm4gYShiKX1mdW5jdGlvbiBaYihhLGIsYyl7cmV0dXJuIGEoYixjKX1mdW5jdGlvbiAkYigpe312YXIgYWM9ITE7ZnVuY3Rpb24gYmMoYSxiKXtpZihhYylyZXR1cm4gYShiKTthYz0hMDt0cnl7cmV0dXJuIFliKGEsYil9ZmluYWxseXtpZihhYz0hMSxudWxsIT09T2J8fG51bGwhPT1QYikkYigpLFhiKCl9fXZhciBjYz17Y29sb3I6ITAsZGF0ZTohMCxkYXRldGltZTohMCxcImRhdGV0aW1lLWxvY2FsXCI6ITAsZW1haWw6ITAsbW9udGg6ITAsbnVtYmVyOiEwLHBhc3N3b3JkOiEwLHJhbmdlOiEwLHNlYXJjaDohMCx0ZWw6ITAsdGV4dDohMCx0aW1lOiEwLHVybDohMCx3ZWVrOiEwfTtmdW5jdGlvbiBkYyhhKXt2YXIgYj1hJiZhLm5vZGVOYW1lJiZhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7cmV0dXJuXCJpbnB1dFwiPT09Yj8hIWNjW2EudHlwZV06XCJ0ZXh0YXJlYVwiPT09Yj8hMDohMX1cbmZ1bmN0aW9uIGVjKGEpe2E9YS50YXJnZXR8fGEuc3JjRWxlbWVudHx8d2luZG93O2EuY29ycmVzcG9uZGluZ1VzZUVsZW1lbnQmJihhPWEuY29ycmVzcG9uZGluZ1VzZUVsZW1lbnQpO3JldHVybiAzPT09YS5ub2RlVHlwZT9hLnBhcmVudE5vZGU6YX1mdW5jdGlvbiBmYyhhKXtpZighWGEpcmV0dXJuITE7YT1cIm9uXCIrYTt2YXIgYj1hIGluIGRvY3VtZW50O2J8fChiPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiksYi5zZXRBdHRyaWJ1dGUoYSxcInJldHVybjtcIiksYj1cImZ1bmN0aW9uXCI9PT10eXBlb2YgYlthXSk7cmV0dXJuIGJ9ZnVuY3Rpb24gZ2MoYSl7dmFyIGI9YS50eXBlO3JldHVybihhPWEubm9kZU5hbWUpJiZcImlucHV0XCI9PT1hLnRvTG93ZXJDYXNlKCkmJihcImNoZWNrYm94XCI9PT1ifHxcInJhZGlvXCI9PT1iKX1cbmZ1bmN0aW9uIGhjKGEpe3ZhciBiPWdjKGEpP1wiY2hlY2tlZFwiOlwidmFsdWVcIixjPU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoYS5jb25zdHJ1Y3Rvci5wcm90b3R5cGUsYiksZD1cIlwiK2FbYl07aWYoIWEuaGFzT3duUHJvcGVydHkoYikmJlwidW5kZWZpbmVkXCIhPT10eXBlb2YgYyYmXCJmdW5jdGlvblwiPT09dHlwZW9mIGMuZ2V0JiZcImZ1bmN0aW9uXCI9PT10eXBlb2YgYy5zZXQpe3ZhciBlPWMuZ2V0LGY9Yy5zZXQ7T2JqZWN0LmRlZmluZVByb3BlcnR5KGEsYix7Y29uZmlndXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiBlLmNhbGwodGhpcyl9LHNldDpmdW5jdGlvbihhKXtkPVwiXCIrYTtmLmNhbGwodGhpcyxhKX19KTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYSxiLHtlbnVtZXJhYmxlOmMuZW51bWVyYWJsZX0pO3JldHVybntnZXRWYWx1ZTpmdW5jdGlvbigpe3JldHVybiBkfSxzZXRWYWx1ZTpmdW5jdGlvbihhKXtkPVwiXCIrYX0sc3RvcFRyYWNraW5nOmZ1bmN0aW9uKCl7YS5fdmFsdWVUcmFja2VyPVxubnVsbDtkZWxldGUgYVtiXX19fX1mdW5jdGlvbiBpYyhhKXthLl92YWx1ZVRyYWNrZXJ8fChhLl92YWx1ZVRyYWNrZXI9aGMoYSkpfWZ1bmN0aW9uIGpjKGEpe2lmKCFhKXJldHVybiExO3ZhciBiPWEuX3ZhbHVlVHJhY2tlcjtpZighYilyZXR1cm4hMDt2YXIgYz1iLmdldFZhbHVlKCk7dmFyIGQ9XCJcIjthJiYoZD1nYyhhKT9hLmNoZWNrZWQ/XCJ0cnVlXCI6XCJmYWxzZVwiOmEudmFsdWUpO2E9ZDtyZXR1cm4gYSE9PWM/KGIuc2V0VmFsdWUoYSksITApOiExfVxudmFyIGtjPWFhLl9fU0VDUkVUX0lOVEVSTkFMU19ET19OT1RfVVNFX09SX1lPVV9XSUxMX0JFX0ZJUkVELGxjPS9eKC4qKVtcXFxcXFwvXS8sRD1cImZ1bmN0aW9uXCI9PT10eXBlb2YgU3ltYm9sJiZTeW1ib2wuZm9yLG1jPUQ/U3ltYm9sLmZvcihcInJlYWN0LmVsZW1lbnRcIik6NjAxMDMsbmM9RD9TeW1ib2wuZm9yKFwicmVhY3QucG9ydGFsXCIpOjYwMTA2LG9jPUQ/U3ltYm9sLmZvcihcInJlYWN0LmZyYWdtZW50XCIpOjYwMTA3LHBjPUQ/U3ltYm9sLmZvcihcInJlYWN0LnN0cmljdF9tb2RlXCIpOjYwMTA4LHFjPUQ/U3ltYm9sLmZvcihcInJlYWN0LnByb2ZpbGVyXCIpOjYwMTE0LHJjPUQ/U3ltYm9sLmZvcihcInJlYWN0LnByb3ZpZGVyXCIpOjYwMTA5LHNjPUQ/U3ltYm9sLmZvcihcInJlYWN0LmNvbnRleHRcIik6NjAxMTAsdGM9RD9TeW1ib2wuZm9yKFwicmVhY3QuY29uY3VycmVudF9tb2RlXCIpOjYwMTExLHVjPUQ/U3ltYm9sLmZvcihcInJlYWN0LmZvcndhcmRfcmVmXCIpOjYwMTEyLHZjPUQ/U3ltYm9sLmZvcihcInJlYWN0LnN1c3BlbnNlXCIpOlxuNjAxMTMsd2M9RD9TeW1ib2wuZm9yKFwicmVhY3QubWVtb1wiKTo2MDExNSx4Yz1EP1N5bWJvbC5mb3IoXCJyZWFjdC5sYXp5XCIpOjYwMTE2LHljPVwiZnVuY3Rpb25cIj09PXR5cGVvZiBTeW1ib2wmJlN5bWJvbC5pdGVyYXRvcjtmdW5jdGlvbiB6YyhhKXtpZihudWxsPT09YXx8XCJvYmplY3RcIiE9PXR5cGVvZiBhKXJldHVybiBudWxsO2E9eWMmJmFbeWNdfHxhW1wiQEBpdGVyYXRvclwiXTtyZXR1cm5cImZ1bmN0aW9uXCI9PT10eXBlb2YgYT9hOm51bGx9XG5mdW5jdGlvbiBBYyhhKXtpZihudWxsPT1hKXJldHVybiBudWxsO2lmKFwiZnVuY3Rpb25cIj09PXR5cGVvZiBhKXJldHVybiBhLmRpc3BsYXlOYW1lfHxhLm5hbWV8fG51bGw7aWYoXCJzdHJpbmdcIj09PXR5cGVvZiBhKXJldHVybiBhO3N3aXRjaChhKXtjYXNlIHRjOnJldHVyblwiQ29uY3VycmVudE1vZGVcIjtjYXNlIG9jOnJldHVyblwiRnJhZ21lbnRcIjtjYXNlIG5jOnJldHVyblwiUG9ydGFsXCI7Y2FzZSBxYzpyZXR1cm5cIlByb2ZpbGVyXCI7Y2FzZSBwYzpyZXR1cm5cIlN0cmljdE1vZGVcIjtjYXNlIHZjOnJldHVyblwiU3VzcGVuc2VcIn1pZihcIm9iamVjdFwiPT09dHlwZW9mIGEpc3dpdGNoKGEuJCR0eXBlb2Ype2Nhc2Ugc2M6cmV0dXJuXCJDb250ZXh0LkNvbnN1bWVyXCI7Y2FzZSByYzpyZXR1cm5cIkNvbnRleHQuUHJvdmlkZXJcIjtjYXNlIHVjOnZhciBiPWEucmVuZGVyO2I9Yi5kaXNwbGF5TmFtZXx8Yi5uYW1lfHxcIlwiO3JldHVybiBhLmRpc3BsYXlOYW1lfHwoXCJcIiE9PWI/XCJGb3J3YXJkUmVmKFwiK2IrXG5cIilcIjpcIkZvcndhcmRSZWZcIik7Y2FzZSB3YzpyZXR1cm4gQWMoYS50eXBlKTtjYXNlIHhjOmlmKGE9MT09PWEuX3N0YXR1cz9hLl9yZXN1bHQ6bnVsbClyZXR1cm4gQWMoYSl9cmV0dXJuIG51bGx9ZnVuY3Rpb24gQmMoYSl7dmFyIGI9XCJcIjtkb3thOnN3aXRjaChhLnRhZyl7Y2FzZSAyOmNhc2UgMTY6Y2FzZSAwOmNhc2UgMTpjYXNlIDU6Y2FzZSA4OnZhciBjPWEuX2RlYnVnT3duZXIsZD1hLl9kZWJ1Z1NvdXJjZSxlPUFjKGEudHlwZSk7dmFyIGY9bnVsbDtjJiYoZj1BYyhjLnR5cGUpKTtjPWU7ZT1cIlwiO2Q/ZT1cIiAoYXQgXCIrZC5maWxlTmFtZS5yZXBsYWNlKGxjLFwiXCIpK1wiOlwiK2QubGluZU51bWJlcitcIilcIjpmJiYoZT1cIiAoY3JlYXRlZCBieSBcIitmK1wiKVwiKTtmPVwiXFxuICAgIGluIFwiKyhjfHxcIlVua25vd25cIikrZTticmVhayBhO2RlZmF1bHQ6Zj1cIlwifWIrPWY7YT1hLnJldHVybn13aGlsZShhKTtyZXR1cm4gYn1cbnZhciBDYz0vXls6QS1aX2EtelxcdTAwQzAtXFx1MDBENlxcdTAwRDgtXFx1MDBGNlxcdTAwRjgtXFx1MDJGRlxcdTAzNzAtXFx1MDM3RFxcdTAzN0YtXFx1MUZGRlxcdTIwMEMtXFx1MjAwRFxcdTIwNzAtXFx1MjE4RlxcdTJDMDAtXFx1MkZFRlxcdTMwMDEtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZGRF1bOkEtWl9hLXpcXHUwMEMwLVxcdTAwRDZcXHUwMEQ4LVxcdTAwRjZcXHUwMEY4LVxcdTAyRkZcXHUwMzcwLVxcdTAzN0RcXHUwMzdGLVxcdTFGRkZcXHUyMDBDLVxcdTIwMERcXHUyMDcwLVxcdTIxOEZcXHUyQzAwLVxcdTJGRUZcXHUzMDAxLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRkRcXC0uMC05XFx1MDBCN1xcdTAzMDAtXFx1MDM2RlxcdTIwM0YtXFx1MjA0MF0qJC8sRGM9T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSxFYz17fSxGYz17fTtcbmZ1bmN0aW9uIEdjKGEpe2lmKERjLmNhbGwoRmMsYSkpcmV0dXJuITA7aWYoRGMuY2FsbChFYyxhKSlyZXR1cm4hMTtpZihDYy50ZXN0KGEpKXJldHVybiBGY1thXT0hMDtFY1thXT0hMDtyZXR1cm4hMX1mdW5jdGlvbiBIYyhhLGIsYyxkKXtpZihudWxsIT09YyYmMD09PWMudHlwZSlyZXR1cm4hMTtzd2l0Y2godHlwZW9mIGIpe2Nhc2UgXCJmdW5jdGlvblwiOmNhc2UgXCJzeW1ib2xcIjpyZXR1cm4hMDtjYXNlIFwiYm9vbGVhblwiOmlmKGQpcmV0dXJuITE7aWYobnVsbCE9PWMpcmV0dXJuIWMuYWNjZXB0c0Jvb2xlYW5zO2E9YS50b0xvd2VyQ2FzZSgpLnNsaWNlKDAsNSk7cmV0dXJuXCJkYXRhLVwiIT09YSYmXCJhcmlhLVwiIT09YTtkZWZhdWx0OnJldHVybiExfX1cbmZ1bmN0aW9uIEljKGEsYixjLGQpe2lmKG51bGw9PT1ifHxcInVuZGVmaW5lZFwiPT09dHlwZW9mIGJ8fEhjKGEsYixjLGQpKXJldHVybiEwO2lmKGQpcmV0dXJuITE7aWYobnVsbCE9PWMpc3dpdGNoKGMudHlwZSl7Y2FzZSAzOnJldHVybiFiO2Nhc2UgNDpyZXR1cm4hMT09PWI7Y2FzZSA1OnJldHVybiBpc05hTihiKTtjYXNlIDY6cmV0dXJuIGlzTmFOKGIpfHwxPmJ9cmV0dXJuITF9ZnVuY3Rpb24gRihhLGIsYyxkLGUpe3RoaXMuYWNjZXB0c0Jvb2xlYW5zPTI9PT1ifHwzPT09Ynx8ND09PWI7dGhpcy5hdHRyaWJ1dGVOYW1lPWQ7dGhpcy5hdHRyaWJ1dGVOYW1lc3BhY2U9ZTt0aGlzLm11c3RVc2VQcm9wZXJ0eT1jO3RoaXMucHJvcGVydHlOYW1lPWE7dGhpcy50eXBlPWJ9dmFyIEc9e307XG5cImNoaWxkcmVuIGRhbmdlcm91c2x5U2V0SW5uZXJIVE1MIGRlZmF1bHRWYWx1ZSBkZWZhdWx0Q2hlY2tlZCBpbm5lckhUTUwgc3VwcHJlc3NDb250ZW50RWRpdGFibGVXYXJuaW5nIHN1cHByZXNzSHlkcmF0aW9uV2FybmluZyBzdHlsZVwiLnNwbGl0KFwiIFwiKS5mb3JFYWNoKGZ1bmN0aW9uKGEpe0dbYV09bmV3IEYoYSwwLCExLGEsbnVsbCl9KTtbW1wiYWNjZXB0Q2hhcnNldFwiLFwiYWNjZXB0LWNoYXJzZXRcIl0sW1wiY2xhc3NOYW1lXCIsXCJjbGFzc1wiXSxbXCJodG1sRm9yXCIsXCJmb3JcIl0sW1wiaHR0cEVxdWl2XCIsXCJodHRwLWVxdWl2XCJdXS5mb3JFYWNoKGZ1bmN0aW9uKGEpe3ZhciBiPWFbMF07R1tiXT1uZXcgRihiLDEsITEsYVsxXSxudWxsKX0pO1tcImNvbnRlbnRFZGl0YWJsZVwiLFwiZHJhZ2dhYmxlXCIsXCJzcGVsbENoZWNrXCIsXCJ2YWx1ZVwiXS5mb3JFYWNoKGZ1bmN0aW9uKGEpe0dbYV09bmV3IEYoYSwyLCExLGEudG9Mb3dlckNhc2UoKSxudWxsKX0pO1xuW1wiYXV0b1JldmVyc2VcIixcImV4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWRcIixcImZvY3VzYWJsZVwiLFwicHJlc2VydmVBbHBoYVwiXS5mb3JFYWNoKGZ1bmN0aW9uKGEpe0dbYV09bmV3IEYoYSwyLCExLGEsbnVsbCl9KTtcImFsbG93RnVsbFNjcmVlbiBhc3luYyBhdXRvRm9jdXMgYXV0b1BsYXkgY29udHJvbHMgZGVmYXVsdCBkZWZlciBkaXNhYmxlZCBmb3JtTm9WYWxpZGF0ZSBoaWRkZW4gbG9vcCBub01vZHVsZSBub1ZhbGlkYXRlIG9wZW4gcGxheXNJbmxpbmUgcmVhZE9ubHkgcmVxdWlyZWQgcmV2ZXJzZWQgc2NvcGVkIHNlYW1sZXNzIGl0ZW1TY29wZVwiLnNwbGl0KFwiIFwiKS5mb3JFYWNoKGZ1bmN0aW9uKGEpe0dbYV09bmV3IEYoYSwzLCExLGEudG9Mb3dlckNhc2UoKSxudWxsKX0pO1tcImNoZWNrZWRcIixcIm11bHRpcGxlXCIsXCJtdXRlZFwiLFwic2VsZWN0ZWRcIl0uZm9yRWFjaChmdW5jdGlvbihhKXtHW2FdPW5ldyBGKGEsMywhMCxhLG51bGwpfSk7XG5bXCJjYXB0dXJlXCIsXCJkb3dubG9hZFwiXS5mb3JFYWNoKGZ1bmN0aW9uKGEpe0dbYV09bmV3IEYoYSw0LCExLGEsbnVsbCl9KTtbXCJjb2xzXCIsXCJyb3dzXCIsXCJzaXplXCIsXCJzcGFuXCJdLmZvckVhY2goZnVuY3Rpb24oYSl7R1thXT1uZXcgRihhLDYsITEsYSxudWxsKX0pO1tcInJvd1NwYW5cIixcInN0YXJ0XCJdLmZvckVhY2goZnVuY3Rpb24oYSl7R1thXT1uZXcgRihhLDUsITEsYS50b0xvd2VyQ2FzZSgpLG51bGwpfSk7dmFyIE1jPS9bXFwtOl0oW2Etel0pL2c7ZnVuY3Rpb24gTmMoYSl7cmV0dXJuIGFbMV0udG9VcHBlckNhc2UoKX1cblwiYWNjZW50LWhlaWdodCBhbGlnbm1lbnQtYmFzZWxpbmUgYXJhYmljLWZvcm0gYmFzZWxpbmUtc2hpZnQgY2FwLWhlaWdodCBjbGlwLXBhdGggY2xpcC1ydWxlIGNvbG9yLWludGVycG9sYXRpb24gY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzIGNvbG9yLXByb2ZpbGUgY29sb3ItcmVuZGVyaW5nIGRvbWluYW50LWJhc2VsaW5lIGVuYWJsZS1iYWNrZ3JvdW5kIGZpbGwtb3BhY2l0eSBmaWxsLXJ1bGUgZmxvb2QtY29sb3IgZmxvb2Qtb3BhY2l0eSBmb250LWZhbWlseSBmb250LXNpemUgZm9udC1zaXplLWFkanVzdCBmb250LXN0cmV0Y2ggZm9udC1zdHlsZSBmb250LXZhcmlhbnQgZm9udC13ZWlnaHQgZ2x5cGgtbmFtZSBnbHlwaC1vcmllbnRhdGlvbi1ob3Jpem9udGFsIGdseXBoLW9yaWVudGF0aW9uLXZlcnRpY2FsIGhvcml6LWFkdi14IGhvcml6LW9yaWdpbi14IGltYWdlLXJlbmRlcmluZyBsZXR0ZXItc3BhY2luZyBsaWdodGluZy1jb2xvciBtYXJrZXItZW5kIG1hcmtlci1taWQgbWFya2VyLXN0YXJ0IG92ZXJsaW5lLXBvc2l0aW9uIG92ZXJsaW5lLXRoaWNrbmVzcyBwYWludC1vcmRlciBwYW5vc2UtMSBwb2ludGVyLWV2ZW50cyByZW5kZXJpbmctaW50ZW50IHNoYXBlLXJlbmRlcmluZyBzdG9wLWNvbG9yIHN0b3Atb3BhY2l0eSBzdHJpa2V0aHJvdWdoLXBvc2l0aW9uIHN0cmlrZXRocm91Z2gtdGhpY2tuZXNzIHN0cm9rZS1kYXNoYXJyYXkgc3Ryb2tlLWRhc2hvZmZzZXQgc3Ryb2tlLWxpbmVjYXAgc3Ryb2tlLWxpbmVqb2luIHN0cm9rZS1taXRlcmxpbWl0IHN0cm9rZS1vcGFjaXR5IHN0cm9rZS13aWR0aCB0ZXh0LWFuY2hvciB0ZXh0LWRlY29yYXRpb24gdGV4dC1yZW5kZXJpbmcgdW5kZXJsaW5lLXBvc2l0aW9uIHVuZGVybGluZS10aGlja25lc3MgdW5pY29kZS1iaWRpIHVuaWNvZGUtcmFuZ2UgdW5pdHMtcGVyLWVtIHYtYWxwaGFiZXRpYyB2LWhhbmdpbmcgdi1pZGVvZ3JhcGhpYyB2LW1hdGhlbWF0aWNhbCB2ZWN0b3ItZWZmZWN0IHZlcnQtYWR2LXkgdmVydC1vcmlnaW4teCB2ZXJ0LW9yaWdpbi15IHdvcmQtc3BhY2luZyB3cml0aW5nLW1vZGUgeG1sbnM6eGxpbmsgeC1oZWlnaHRcIi5zcGxpdChcIiBcIikuZm9yRWFjaChmdW5jdGlvbihhKXt2YXIgYj1hLnJlcGxhY2UoTWMsXG5OYyk7R1tiXT1uZXcgRihiLDEsITEsYSxudWxsKX0pO1wieGxpbms6YWN0dWF0ZSB4bGluazphcmNyb2xlIHhsaW5rOmhyZWYgeGxpbms6cm9sZSB4bGluazpzaG93IHhsaW5rOnRpdGxlIHhsaW5rOnR5cGVcIi5zcGxpdChcIiBcIikuZm9yRWFjaChmdW5jdGlvbihhKXt2YXIgYj1hLnJlcGxhY2UoTWMsTmMpO0dbYl09bmV3IEYoYiwxLCExLGEsXCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rXCIpfSk7W1wieG1sOmJhc2VcIixcInhtbDpsYW5nXCIsXCJ4bWw6c3BhY2VcIl0uZm9yRWFjaChmdW5jdGlvbihhKXt2YXIgYj1hLnJlcGxhY2UoTWMsTmMpO0dbYl09bmV3IEYoYiwxLCExLGEsXCJodHRwOi8vd3d3LnczLm9yZy9YTUwvMTk5OC9uYW1lc3BhY2VcIil9KTtHLnRhYkluZGV4PW5ldyBGKFwidGFiSW5kZXhcIiwxLCExLFwidGFiaW5kZXhcIixudWxsKTtcbmZ1bmN0aW9uIE9jKGEsYixjLGQpe3ZhciBlPUcuaGFzT3duUHJvcGVydHkoYik/R1tiXTpudWxsO3ZhciBmPW51bGwhPT1lPzA9PT1lLnR5cGU6ZD8hMTohKDI8Yi5sZW5ndGgpfHxcIm9cIiE9PWJbMF0mJlwiT1wiIT09YlswXXx8XCJuXCIhPT1iWzFdJiZcIk5cIiE9PWJbMV0/ITE6ITA7Znx8KEljKGIsYyxlLGQpJiYoYz1udWxsKSxkfHxudWxsPT09ZT9HYyhiKSYmKG51bGw9PT1jP2EucmVtb3ZlQXR0cmlidXRlKGIpOmEuc2V0QXR0cmlidXRlKGIsXCJcIitjKSk6ZS5tdXN0VXNlUHJvcGVydHk/YVtlLnByb3BlcnR5TmFtZV09bnVsbD09PWM/Mz09PWUudHlwZT8hMTpcIlwiOmM6KGI9ZS5hdHRyaWJ1dGVOYW1lLGQ9ZS5hdHRyaWJ1dGVOYW1lc3BhY2UsbnVsbD09PWM/YS5yZW1vdmVBdHRyaWJ1dGUoYik6KGU9ZS50eXBlLGM9Mz09PWV8fDQ9PT1lJiYhMD09PWM/XCJcIjpcIlwiK2MsZD9hLnNldEF0dHJpYnV0ZU5TKGQsYixjKTphLnNldEF0dHJpYnV0ZShiLGMpKSkpfVxuZnVuY3Rpb24gUGMoYSl7c3dpdGNoKHR5cGVvZiBhKXtjYXNlIFwiYm9vbGVhblwiOmNhc2UgXCJudW1iZXJcIjpjYXNlIFwib2JqZWN0XCI6Y2FzZSBcInN0cmluZ1wiOmNhc2UgXCJ1bmRlZmluZWRcIjpyZXR1cm4gYTtkZWZhdWx0OnJldHVyblwiXCJ9fWZ1bmN0aW9uIFFjKGEsYil7dmFyIGM9Yi5jaGVja2VkO3JldHVybiBuKHt9LGIse2RlZmF1bHRDaGVja2VkOnZvaWQgMCxkZWZhdWx0VmFsdWU6dm9pZCAwLHZhbHVlOnZvaWQgMCxjaGVja2VkOm51bGwhPWM/YzphLl93cmFwcGVyU3RhdGUuaW5pdGlhbENoZWNrZWR9KX1cbmZ1bmN0aW9uIFJjKGEsYil7dmFyIGM9bnVsbD09Yi5kZWZhdWx0VmFsdWU/XCJcIjpiLmRlZmF1bHRWYWx1ZSxkPW51bGwhPWIuY2hlY2tlZD9iLmNoZWNrZWQ6Yi5kZWZhdWx0Q2hlY2tlZDtjPVBjKG51bGwhPWIudmFsdWU/Yi52YWx1ZTpjKTthLl93cmFwcGVyU3RhdGU9e2luaXRpYWxDaGVja2VkOmQsaW5pdGlhbFZhbHVlOmMsY29udHJvbGxlZDpcImNoZWNrYm94XCI9PT1iLnR5cGV8fFwicmFkaW9cIj09PWIudHlwZT9udWxsIT1iLmNoZWNrZWQ6bnVsbCE9Yi52YWx1ZX19ZnVuY3Rpb24gU2MoYSxiKXtiPWIuY2hlY2tlZDtudWxsIT1iJiZPYyhhLFwiY2hlY2tlZFwiLGIsITEpfVxuZnVuY3Rpb24gVGMoYSxiKXtTYyhhLGIpO3ZhciBjPVBjKGIudmFsdWUpLGQ9Yi50eXBlO2lmKG51bGwhPWMpaWYoXCJudW1iZXJcIj09PWQpe2lmKDA9PT1jJiZcIlwiPT09YS52YWx1ZXx8YS52YWx1ZSE9YylhLnZhbHVlPVwiXCIrY31lbHNlIGEudmFsdWUhPT1cIlwiK2MmJihhLnZhbHVlPVwiXCIrYyk7ZWxzZSBpZihcInN1Ym1pdFwiPT09ZHx8XCJyZXNldFwiPT09ZCl7YS5yZW1vdmVBdHRyaWJ1dGUoXCJ2YWx1ZVwiKTtyZXR1cm59Yi5oYXNPd25Qcm9wZXJ0eShcInZhbHVlXCIpP1VjKGEsYi50eXBlLGMpOmIuaGFzT3duUHJvcGVydHkoXCJkZWZhdWx0VmFsdWVcIikmJlVjKGEsYi50eXBlLFBjKGIuZGVmYXVsdFZhbHVlKSk7bnVsbD09Yi5jaGVja2VkJiZudWxsIT1iLmRlZmF1bHRDaGVja2VkJiYoYS5kZWZhdWx0Q2hlY2tlZD0hIWIuZGVmYXVsdENoZWNrZWQpfVxuZnVuY3Rpb24gYmQoYSxiLGMpe2lmKGIuaGFzT3duUHJvcGVydHkoXCJ2YWx1ZVwiKXx8Yi5oYXNPd25Qcm9wZXJ0eShcImRlZmF1bHRWYWx1ZVwiKSl7dmFyIGQ9Yi50eXBlO2lmKCEoXCJzdWJtaXRcIiE9PWQmJlwicmVzZXRcIiE9PWR8fHZvaWQgMCE9PWIudmFsdWUmJm51bGwhPT1iLnZhbHVlKSlyZXR1cm47Yj1cIlwiK2EuX3dyYXBwZXJTdGF0ZS5pbml0aWFsVmFsdWU7Y3x8Yj09PWEudmFsdWV8fChhLnZhbHVlPWIpO2EuZGVmYXVsdFZhbHVlPWJ9Yz1hLm5hbWU7XCJcIiE9PWMmJihhLm5hbWU9XCJcIik7YS5kZWZhdWx0Q2hlY2tlZD0hYS5kZWZhdWx0Q2hlY2tlZDthLmRlZmF1bHRDaGVja2VkPSEhYS5fd3JhcHBlclN0YXRlLmluaXRpYWxDaGVja2VkO1wiXCIhPT1jJiYoYS5uYW1lPWMpfVxuZnVuY3Rpb24gVWMoYSxiLGMpe2lmKFwibnVtYmVyXCIhPT1ifHxhLm93bmVyRG9jdW1lbnQuYWN0aXZlRWxlbWVudCE9PWEpbnVsbD09Yz9hLmRlZmF1bHRWYWx1ZT1cIlwiK2EuX3dyYXBwZXJTdGF0ZS5pbml0aWFsVmFsdWU6YS5kZWZhdWx0VmFsdWUhPT1cIlwiK2MmJihhLmRlZmF1bHRWYWx1ZT1cIlwiK2MpfXZhciBjZD17Y2hhbmdlOntwaGFzZWRSZWdpc3RyYXRpb25OYW1lczp7YnViYmxlZDpcIm9uQ2hhbmdlXCIsY2FwdHVyZWQ6XCJvbkNoYW5nZUNhcHR1cmVcIn0sZGVwZW5kZW5jaWVzOlwiYmx1ciBjaGFuZ2UgY2xpY2sgZm9jdXMgaW5wdXQga2V5ZG93biBrZXl1cCBzZWxlY3Rpb25jaGFuZ2VcIi5zcGxpdChcIiBcIil9fTtmdW5jdGlvbiBkZChhLGIsYyl7YT15LmdldFBvb2xlZChjZC5jaGFuZ2UsYSxiLGMpO2EudHlwZT1cImNoYW5nZVwiO1diKGMpO1dhKGEpO3JldHVybiBhfXZhciBlZD1udWxsLGZkPW51bGw7ZnVuY3Rpb24gZ2QoYSl7SWEoYSwhMSl9XG5mdW5jdGlvbiBoZChhKXt2YXIgYj1QYShhKTtpZihqYyhiKSlyZXR1cm4gYX1mdW5jdGlvbiBpZChhLGIpe2lmKFwiY2hhbmdlXCI9PT1hKXJldHVybiBifXZhciBqZD0hMTtYYSYmKGpkPWZjKFwiaW5wdXRcIikmJighZG9jdW1lbnQuZG9jdW1lbnRNb2RlfHw5PGRvY3VtZW50LmRvY3VtZW50TW9kZSkpO2Z1bmN0aW9uIGtkKCl7ZWQmJihlZC5kZXRhY2hFdmVudChcIm9ucHJvcGVydHljaGFuZ2VcIixsZCksZmQ9ZWQ9bnVsbCl9ZnVuY3Rpb24gbGQoYSl7XCJ2YWx1ZVwiPT09YS5wcm9wZXJ0eU5hbWUmJmhkKGZkKSYmKGE9ZGQoZmQsYSxlYyhhKSksYmMoZ2QsYSkpfWZ1bmN0aW9uIG1kKGEsYixjKXtcImZvY3VzXCI9PT1hPyhrZCgpLGVkPWIsZmQ9YyxlZC5hdHRhY2hFdmVudChcIm9ucHJvcGVydHljaGFuZ2VcIixsZCkpOlwiYmx1clwiPT09YSYma2QoKX1mdW5jdGlvbiBuZChhKXtpZihcInNlbGVjdGlvbmNoYW5nZVwiPT09YXx8XCJrZXl1cFwiPT09YXx8XCJrZXlkb3duXCI9PT1hKXJldHVybiBoZChmZCl9XG5mdW5jdGlvbiBvZChhLGIpe2lmKFwiY2xpY2tcIj09PWEpcmV0dXJuIGhkKGIpfWZ1bmN0aW9uIHBkKGEsYil7aWYoXCJpbnB1dFwiPT09YXx8XCJjaGFuZ2VcIj09PWEpcmV0dXJuIGhkKGIpfVxudmFyIHFkPXtldmVudFR5cGVzOmNkLF9pc0lucHV0RXZlbnRTdXBwb3J0ZWQ6amQsZXh0cmFjdEV2ZW50czpmdW5jdGlvbihhLGIsYyxkKXt2YXIgZT1iP1BhKGIpOndpbmRvdyxmPXZvaWQgMCxnPXZvaWQgMCxoPWUubm9kZU5hbWUmJmUubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtcInNlbGVjdFwiPT09aHx8XCJpbnB1dFwiPT09aCYmXCJmaWxlXCI9PT1lLnR5cGU/Zj1pZDpkYyhlKT9qZD9mPXBkOihmPW5kLGc9bWQpOihoPWUubm9kZU5hbWUpJiZcImlucHV0XCI9PT1oLnRvTG93ZXJDYXNlKCkmJihcImNoZWNrYm94XCI9PT1lLnR5cGV8fFwicmFkaW9cIj09PWUudHlwZSkmJihmPW9kKTtpZihmJiYoZj1mKGEsYikpKXJldHVybiBkZChmLGMsZCk7ZyYmZyhhLGUsYik7XCJibHVyXCI9PT1hJiYoYT1lLl93cmFwcGVyU3RhdGUpJiZhLmNvbnRyb2xsZWQmJlwibnVtYmVyXCI9PT1lLnR5cGUmJlVjKGUsXCJudW1iZXJcIixlLnZhbHVlKX19LHJkPXkuZXh0ZW5kKHt2aWV3Om51bGwsZGV0YWlsOm51bGx9KSxzZD17QWx0OlwiYWx0S2V5XCIsXG5Db250cm9sOlwiY3RybEtleVwiLE1ldGE6XCJtZXRhS2V5XCIsU2hpZnQ6XCJzaGlmdEtleVwifTtmdW5jdGlvbiB0ZChhKXt2YXIgYj10aGlzLm5hdGl2ZUV2ZW50O3JldHVybiBiLmdldE1vZGlmaWVyU3RhdGU/Yi5nZXRNb2RpZmllclN0YXRlKGEpOihhPXNkW2FdKT8hIWJbYV06ITF9ZnVuY3Rpb24gdWQoKXtyZXR1cm4gdGR9XG52YXIgdmQ9MCx3ZD0wLHhkPSExLHlkPSExLHpkPXJkLmV4dGVuZCh7c2NyZWVuWDpudWxsLHNjcmVlblk6bnVsbCxjbGllbnRYOm51bGwsY2xpZW50WTpudWxsLHBhZ2VYOm51bGwscGFnZVk6bnVsbCxjdHJsS2V5Om51bGwsc2hpZnRLZXk6bnVsbCxhbHRLZXk6bnVsbCxtZXRhS2V5Om51bGwsZ2V0TW9kaWZpZXJTdGF0ZTp1ZCxidXR0b246bnVsbCxidXR0b25zOm51bGwscmVsYXRlZFRhcmdldDpmdW5jdGlvbihhKXtyZXR1cm4gYS5yZWxhdGVkVGFyZ2V0fHwoYS5mcm9tRWxlbWVudD09PWEuc3JjRWxlbWVudD9hLnRvRWxlbWVudDphLmZyb21FbGVtZW50KX0sbW92ZW1lbnRYOmZ1bmN0aW9uKGEpe2lmKFwibW92ZW1lbnRYXCJpbiBhKXJldHVybiBhLm1vdmVtZW50WDt2YXIgYj12ZDt2ZD1hLnNjcmVlblg7cmV0dXJuIHhkP1wibW91c2Vtb3ZlXCI9PT1hLnR5cGU/YS5zY3JlZW5YLWI6MDooeGQ9ITAsMCl9LG1vdmVtZW50WTpmdW5jdGlvbihhKXtpZihcIm1vdmVtZW50WVwiaW4gYSlyZXR1cm4gYS5tb3ZlbWVudFk7XG52YXIgYj13ZDt3ZD1hLnNjcmVlblk7cmV0dXJuIHlkP1wibW91c2Vtb3ZlXCI9PT1hLnR5cGU/YS5zY3JlZW5ZLWI6MDooeWQ9ITAsMCl9fSksQWQ9emQuZXh0ZW5kKHtwb2ludGVySWQ6bnVsbCx3aWR0aDpudWxsLGhlaWdodDpudWxsLHByZXNzdXJlOm51bGwsdGFuZ2VudGlhbFByZXNzdXJlOm51bGwsdGlsdFg6bnVsbCx0aWx0WTpudWxsLHR3aXN0Om51bGwscG9pbnRlclR5cGU6bnVsbCxpc1ByaW1hcnk6bnVsbH0pLEJkPXttb3VzZUVudGVyOntyZWdpc3RyYXRpb25OYW1lOlwib25Nb3VzZUVudGVyXCIsZGVwZW5kZW5jaWVzOltcIm1vdXNlb3V0XCIsXCJtb3VzZW92ZXJcIl19LG1vdXNlTGVhdmU6e3JlZ2lzdHJhdGlvbk5hbWU6XCJvbk1vdXNlTGVhdmVcIixkZXBlbmRlbmNpZXM6W1wibW91c2VvdXRcIixcIm1vdXNlb3ZlclwiXX0scG9pbnRlckVudGVyOntyZWdpc3RyYXRpb25OYW1lOlwib25Qb2ludGVyRW50ZXJcIixkZXBlbmRlbmNpZXM6W1wicG9pbnRlcm91dFwiLFwicG9pbnRlcm92ZXJcIl19LHBvaW50ZXJMZWF2ZTp7cmVnaXN0cmF0aW9uTmFtZTpcIm9uUG9pbnRlckxlYXZlXCIsXG5kZXBlbmRlbmNpZXM6W1wicG9pbnRlcm91dFwiLFwicG9pbnRlcm92ZXJcIl19fSxDZD17ZXZlbnRUeXBlczpCZCxleHRyYWN0RXZlbnRzOmZ1bmN0aW9uKGEsYixjLGQpe3ZhciBlPVwibW91c2VvdmVyXCI9PT1hfHxcInBvaW50ZXJvdmVyXCI9PT1hLGY9XCJtb3VzZW91dFwiPT09YXx8XCJwb2ludGVyb3V0XCI9PT1hO2lmKGUmJihjLnJlbGF0ZWRUYXJnZXR8fGMuZnJvbUVsZW1lbnQpfHwhZiYmIWUpcmV0dXJuIG51bGw7ZT1kLndpbmRvdz09PWQ/ZDooZT1kLm93bmVyRG9jdW1lbnQpP2UuZGVmYXVsdFZpZXd8fGUucGFyZW50V2luZG93OndpbmRvdztmPyhmPWIsYj0oYj1jLnJlbGF0ZWRUYXJnZXR8fGMudG9FbGVtZW50KT9OYShiKTpudWxsKTpmPW51bGw7aWYoZj09PWIpcmV0dXJuIG51bGw7dmFyIGc9dm9pZCAwLGg9dm9pZCAwLGs9dm9pZCAwLGw9dm9pZCAwO2lmKFwibW91c2VvdXRcIj09PWF8fFwibW91c2VvdmVyXCI9PT1hKWc9emQsaD1CZC5tb3VzZUxlYXZlLGs9QmQubW91c2VFbnRlcixsPVwibW91c2VcIjtcbmVsc2UgaWYoXCJwb2ludGVyb3V0XCI9PT1hfHxcInBvaW50ZXJvdmVyXCI9PT1hKWc9QWQsaD1CZC5wb2ludGVyTGVhdmUsaz1CZC5wb2ludGVyRW50ZXIsbD1cInBvaW50ZXJcIjt2YXIgbT1udWxsPT1mP2U6UGEoZik7ZT1udWxsPT1iP2U6UGEoYik7YT1nLmdldFBvb2xlZChoLGYsYyxkKTthLnR5cGU9bCtcImxlYXZlXCI7YS50YXJnZXQ9bTthLnJlbGF0ZWRUYXJnZXQ9ZTtjPWcuZ2V0UG9vbGVkKGssYixjLGQpO2MudHlwZT1sK1wiZW50ZXJcIjtjLnRhcmdldD1lO2MucmVsYXRlZFRhcmdldD1tO2Q9YjtpZihmJiZkKWE6e2I9ZjtlPWQ7bD0wO2ZvcihnPWI7ZztnPVJhKGcpKWwrKztnPTA7Zm9yKGs9ZTtrO2s9UmEoaykpZysrO2Zvcig7MDxsLWc7KWI9UmEoYiksbC0tO2Zvcig7MDxnLWw7KWU9UmEoZSksZy0tO2Zvcig7bC0tOyl7aWYoYj09PWV8fGI9PT1lLmFsdGVybmF0ZSlicmVhayBhO2I9UmEoYik7ZT1SYShlKX1iPW51bGx9ZWxzZSBiPW51bGw7ZT1iO2ZvcihiPVtdO2YmJmYhPT1lOyl7bD1cbmYuYWx0ZXJuYXRlO2lmKG51bGwhPT1sJiZsPT09ZSlicmVhaztiLnB1c2goZik7Zj1SYShmKX1mb3IoZj1bXTtkJiZkIT09ZTspe2w9ZC5hbHRlcm5hdGU7aWYobnVsbCE9PWwmJmw9PT1lKWJyZWFrO2YucHVzaChkKTtkPVJhKGQpfWZvcihkPTA7ZDxiLmxlbmd0aDtkKyspVWEoYltkXSxcImJ1YmJsZWRcIixhKTtmb3IoZD1mLmxlbmd0aDswPGQtLTspVWEoZltkXSxcImNhcHR1cmVkXCIsYyk7cmV0dXJuW2EsY119fSxEZD1PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5O2Z1bmN0aW9uIEVkKGEsYil7cmV0dXJuIGE9PT1iPzAhPT1hfHwwIT09Ynx8MS9hPT09MS9iOmEhPT1hJiZiIT09Yn1cbmZ1bmN0aW9uIEZkKGEsYil7aWYoRWQoYSxiKSlyZXR1cm4hMDtpZihcIm9iamVjdFwiIT09dHlwZW9mIGF8fG51bGw9PT1hfHxcIm9iamVjdFwiIT09dHlwZW9mIGJ8fG51bGw9PT1iKXJldHVybiExO3ZhciBjPU9iamVjdC5rZXlzKGEpLGQ9T2JqZWN0LmtleXMoYik7aWYoYy5sZW5ndGghPT1kLmxlbmd0aClyZXR1cm4hMTtmb3IoZD0wO2Q8Yy5sZW5ndGg7ZCsrKWlmKCFEZC5jYWxsKGIsY1tkXSl8fCFFZChhW2NbZF1dLGJbY1tkXV0pKXJldHVybiExO3JldHVybiEwfWZ1bmN0aW9uIEdkKGEpe3ZhciBiPWE7aWYoYS5hbHRlcm5hdGUpZm9yKDtiLnJldHVybjspYj1iLnJldHVybjtlbHNle2lmKDAhPT0oYi5lZmZlY3RUYWcmMikpcmV0dXJuIDE7Zm9yKDtiLnJldHVybjspaWYoYj1iLnJldHVybiwwIT09KGIuZWZmZWN0VGFnJjIpKXJldHVybiAxfXJldHVybiAzPT09Yi50YWc/MjozfWZ1bmN0aW9uIEhkKGEpezIhPT1HZChhKT9yKFwiMTg4XCIpOnZvaWQgMH1cbmZ1bmN0aW9uIElkKGEpe3ZhciBiPWEuYWx0ZXJuYXRlO2lmKCFiKXJldHVybiBiPUdkKGEpLDM9PT1iP3IoXCIxODhcIik6dm9pZCAwLDE9PT1iP251bGw6YTtmb3IodmFyIGM9YSxkPWI7Oyl7dmFyIGU9Yy5yZXR1cm4sZj1lP2UuYWx0ZXJuYXRlOm51bGw7aWYoIWV8fCFmKWJyZWFrO2lmKGUuY2hpbGQ9PT1mLmNoaWxkKXtmb3IodmFyIGc9ZS5jaGlsZDtnOyl7aWYoZz09PWMpcmV0dXJuIEhkKGUpLGE7aWYoZz09PWQpcmV0dXJuIEhkKGUpLGI7Zz1nLnNpYmxpbmd9cihcIjE4OFwiKX1pZihjLnJldHVybiE9PWQucmV0dXJuKWM9ZSxkPWY7ZWxzZXtnPSExO2Zvcih2YXIgaD1lLmNoaWxkO2g7KXtpZihoPT09Yyl7Zz0hMDtjPWU7ZD1mO2JyZWFrfWlmKGg9PT1kKXtnPSEwO2Q9ZTtjPWY7YnJlYWt9aD1oLnNpYmxpbmd9aWYoIWcpe2ZvcihoPWYuY2hpbGQ7aDspe2lmKGg9PT1jKXtnPSEwO2M9ZjtkPWU7YnJlYWt9aWYoaD09PWQpe2c9ITA7ZD1mO2M9ZTticmVha31oPWguc2libGluZ31nP1xudm9pZCAwOnIoXCIxODlcIil9fWMuYWx0ZXJuYXRlIT09ZD9yKFwiMTkwXCIpOnZvaWQgMH0zIT09Yy50YWc/cihcIjE4OFwiKTp2b2lkIDA7cmV0dXJuIGMuc3RhdGVOb2RlLmN1cnJlbnQ9PT1jP2E6Yn1mdW5jdGlvbiBKZChhKXthPUlkKGEpO2lmKCFhKXJldHVybiBudWxsO2Zvcih2YXIgYj1hOzspe2lmKDU9PT1iLnRhZ3x8Nj09PWIudGFnKXJldHVybiBiO2lmKGIuY2hpbGQpYi5jaGlsZC5yZXR1cm49YixiPWIuY2hpbGQ7ZWxzZXtpZihiPT09YSlicmVhaztmb3IoOyFiLnNpYmxpbmc7KXtpZighYi5yZXR1cm58fGIucmV0dXJuPT09YSlyZXR1cm4gbnVsbDtiPWIucmV0dXJufWIuc2libGluZy5yZXR1cm49Yi5yZXR1cm47Yj1iLnNpYmxpbmd9fXJldHVybiBudWxsfVxudmFyIEtkPXkuZXh0ZW5kKHthbmltYXRpb25OYW1lOm51bGwsZWxhcHNlZFRpbWU6bnVsbCxwc2V1ZG9FbGVtZW50Om51bGx9KSxMZD15LmV4dGVuZCh7Y2xpcGJvYXJkRGF0YTpmdW5jdGlvbihhKXtyZXR1cm5cImNsaXBib2FyZERhdGFcImluIGE/YS5jbGlwYm9hcmREYXRhOndpbmRvdy5jbGlwYm9hcmREYXRhfX0pLE1kPXJkLmV4dGVuZCh7cmVsYXRlZFRhcmdldDpudWxsfSk7ZnVuY3Rpb24gTmQoYSl7dmFyIGI9YS5rZXlDb2RlO1wiY2hhckNvZGVcImluIGE/KGE9YS5jaGFyQ29kZSwwPT09YSYmMTM9PT1iJiYoYT0xMykpOmE9YjsxMD09PWEmJihhPTEzKTtyZXR1cm4gMzI8PWF8fDEzPT09YT9hOjB9XG52YXIgT2Q9e0VzYzpcIkVzY2FwZVwiLFNwYWNlYmFyOlwiIFwiLExlZnQ6XCJBcnJvd0xlZnRcIixVcDpcIkFycm93VXBcIixSaWdodDpcIkFycm93UmlnaHRcIixEb3duOlwiQXJyb3dEb3duXCIsRGVsOlwiRGVsZXRlXCIsV2luOlwiT1NcIixNZW51OlwiQ29udGV4dE1lbnVcIixBcHBzOlwiQ29udGV4dE1lbnVcIixTY3JvbGw6XCJTY3JvbGxMb2NrXCIsTW96UHJpbnRhYmxlS2V5OlwiVW5pZGVudGlmaWVkXCJ9LFBkPXs4OlwiQmFja3NwYWNlXCIsOTpcIlRhYlwiLDEyOlwiQ2xlYXJcIiwxMzpcIkVudGVyXCIsMTY6XCJTaGlmdFwiLDE3OlwiQ29udHJvbFwiLDE4OlwiQWx0XCIsMTk6XCJQYXVzZVwiLDIwOlwiQ2Fwc0xvY2tcIiwyNzpcIkVzY2FwZVwiLDMyOlwiIFwiLDMzOlwiUGFnZVVwXCIsMzQ6XCJQYWdlRG93blwiLDM1OlwiRW5kXCIsMzY6XCJIb21lXCIsMzc6XCJBcnJvd0xlZnRcIiwzODpcIkFycm93VXBcIiwzOTpcIkFycm93UmlnaHRcIiw0MDpcIkFycm93RG93blwiLDQ1OlwiSW5zZXJ0XCIsNDY6XCJEZWxldGVcIiwxMTI6XCJGMVwiLDExMzpcIkYyXCIsMTE0OlwiRjNcIiwxMTU6XCJGNFwiLFxuMTE2OlwiRjVcIiwxMTc6XCJGNlwiLDExODpcIkY3XCIsMTE5OlwiRjhcIiwxMjA6XCJGOVwiLDEyMTpcIkYxMFwiLDEyMjpcIkYxMVwiLDEyMzpcIkYxMlwiLDE0NDpcIk51bUxvY2tcIiwxNDU6XCJTY3JvbGxMb2NrXCIsMjI0OlwiTWV0YVwifSxRZD1yZC5leHRlbmQoe2tleTpmdW5jdGlvbihhKXtpZihhLmtleSl7dmFyIGI9T2RbYS5rZXldfHxhLmtleTtpZihcIlVuaWRlbnRpZmllZFwiIT09YilyZXR1cm4gYn1yZXR1cm5cImtleXByZXNzXCI9PT1hLnR5cGU/KGE9TmQoYSksMTM9PT1hP1wiRW50ZXJcIjpTdHJpbmcuZnJvbUNoYXJDb2RlKGEpKTpcImtleWRvd25cIj09PWEudHlwZXx8XCJrZXl1cFwiPT09YS50eXBlP1BkW2Eua2V5Q29kZV18fFwiVW5pZGVudGlmaWVkXCI6XCJcIn0sbG9jYXRpb246bnVsbCxjdHJsS2V5Om51bGwsc2hpZnRLZXk6bnVsbCxhbHRLZXk6bnVsbCxtZXRhS2V5Om51bGwscmVwZWF0Om51bGwsbG9jYWxlOm51bGwsZ2V0TW9kaWZpZXJTdGF0ZTp1ZCxjaGFyQ29kZTpmdW5jdGlvbihhKXtyZXR1cm5cImtleXByZXNzXCI9PT1cbmEudHlwZT9OZChhKTowfSxrZXlDb2RlOmZ1bmN0aW9uKGEpe3JldHVyblwia2V5ZG93blwiPT09YS50eXBlfHxcImtleXVwXCI9PT1hLnR5cGU/YS5rZXlDb2RlOjB9LHdoaWNoOmZ1bmN0aW9uKGEpe3JldHVyblwia2V5cHJlc3NcIj09PWEudHlwZT9OZChhKTpcImtleWRvd25cIj09PWEudHlwZXx8XCJrZXl1cFwiPT09YS50eXBlP2Eua2V5Q29kZTowfX0pLFJkPXpkLmV4dGVuZCh7ZGF0YVRyYW5zZmVyOm51bGx9KSxTZD1yZC5leHRlbmQoe3RvdWNoZXM6bnVsbCx0YXJnZXRUb3VjaGVzOm51bGwsY2hhbmdlZFRvdWNoZXM6bnVsbCxhbHRLZXk6bnVsbCxtZXRhS2V5Om51bGwsY3RybEtleTpudWxsLHNoaWZ0S2V5Om51bGwsZ2V0TW9kaWZpZXJTdGF0ZTp1ZH0pLFRkPXkuZXh0ZW5kKHtwcm9wZXJ0eU5hbWU6bnVsbCxlbGFwc2VkVGltZTpudWxsLHBzZXVkb0VsZW1lbnQ6bnVsbH0pLFVkPXpkLmV4dGVuZCh7ZGVsdGFYOmZ1bmN0aW9uKGEpe3JldHVyblwiZGVsdGFYXCJpbiBhP2EuZGVsdGFYOlwid2hlZWxEZWx0YVhcImluXG5hPy1hLndoZWVsRGVsdGFYOjB9LGRlbHRhWTpmdW5jdGlvbihhKXtyZXR1cm5cImRlbHRhWVwiaW4gYT9hLmRlbHRhWTpcIndoZWVsRGVsdGFZXCJpbiBhPy1hLndoZWVsRGVsdGFZOlwid2hlZWxEZWx0YVwiaW4gYT8tYS53aGVlbERlbHRhOjB9LGRlbHRhWjpudWxsLGRlbHRhTW9kZTpudWxsfSksVmQ9W1tcImFib3J0XCIsXCJhYm9ydFwiXSxbY2IsXCJhbmltYXRpb25FbmRcIl0sW2liLFwiYW5pbWF0aW9uSXRlcmF0aW9uXCJdLFtqYixcImFuaW1hdGlvblN0YXJ0XCJdLFtcImNhbnBsYXlcIixcImNhblBsYXlcIl0sW1wiY2FucGxheXRocm91Z2hcIixcImNhblBsYXlUaHJvdWdoXCJdLFtcImRyYWdcIixcImRyYWdcIl0sW1wiZHJhZ2VudGVyXCIsXCJkcmFnRW50ZXJcIl0sW1wiZHJhZ2V4aXRcIixcImRyYWdFeGl0XCJdLFtcImRyYWdsZWF2ZVwiLFwiZHJhZ0xlYXZlXCJdLFtcImRyYWdvdmVyXCIsXCJkcmFnT3ZlclwiXSxbXCJkdXJhdGlvbmNoYW5nZVwiLFwiZHVyYXRpb25DaGFuZ2VcIl0sW1wiZW1wdGllZFwiLFwiZW1wdGllZFwiXSxbXCJlbmNyeXB0ZWRcIixcImVuY3J5cHRlZFwiXSxcbltcImVuZGVkXCIsXCJlbmRlZFwiXSxbXCJlcnJvclwiLFwiZXJyb3JcIl0sW1wiZ290cG9pbnRlcmNhcHR1cmVcIixcImdvdFBvaW50ZXJDYXB0dXJlXCJdLFtcImxvYWRcIixcImxvYWRcIl0sW1wibG9hZGVkZGF0YVwiLFwibG9hZGVkRGF0YVwiXSxbXCJsb2FkZWRtZXRhZGF0YVwiLFwibG9hZGVkTWV0YWRhdGFcIl0sW1wibG9hZHN0YXJ0XCIsXCJsb2FkU3RhcnRcIl0sW1wibG9zdHBvaW50ZXJjYXB0dXJlXCIsXCJsb3N0UG9pbnRlckNhcHR1cmVcIl0sW1wibW91c2Vtb3ZlXCIsXCJtb3VzZU1vdmVcIl0sW1wibW91c2VvdXRcIixcIm1vdXNlT3V0XCJdLFtcIm1vdXNlb3ZlclwiLFwibW91c2VPdmVyXCJdLFtcInBsYXlpbmdcIixcInBsYXlpbmdcIl0sW1wicG9pbnRlcm1vdmVcIixcInBvaW50ZXJNb3ZlXCJdLFtcInBvaW50ZXJvdXRcIixcInBvaW50ZXJPdXRcIl0sW1wicG9pbnRlcm92ZXJcIixcInBvaW50ZXJPdmVyXCJdLFtcInByb2dyZXNzXCIsXCJwcm9ncmVzc1wiXSxbXCJzY3JvbGxcIixcInNjcm9sbFwiXSxbXCJzZWVraW5nXCIsXCJzZWVraW5nXCJdLFtcInN0YWxsZWRcIixcInN0YWxsZWRcIl0sXG5bXCJzdXNwZW5kXCIsXCJzdXNwZW5kXCJdLFtcInRpbWV1cGRhdGVcIixcInRpbWVVcGRhdGVcIl0sW1widG9nZ2xlXCIsXCJ0b2dnbGVcIl0sW1widG91Y2htb3ZlXCIsXCJ0b3VjaE1vdmVcIl0sW2tiLFwidHJhbnNpdGlvbkVuZFwiXSxbXCJ3YWl0aW5nXCIsXCJ3YWl0aW5nXCJdLFtcIndoZWVsXCIsXCJ3aGVlbFwiXV0sV2Q9e30sWGQ9e307ZnVuY3Rpb24gWWQoYSxiKXt2YXIgYz1hWzBdO2E9YVsxXTt2YXIgZD1cIm9uXCIrKGFbMF0udG9VcHBlckNhc2UoKSthLnNsaWNlKDEpKTtiPXtwaGFzZWRSZWdpc3RyYXRpb25OYW1lczp7YnViYmxlZDpkLGNhcHR1cmVkOmQrXCJDYXB0dXJlXCJ9LGRlcGVuZGVuY2llczpbY10saXNJbnRlcmFjdGl2ZTpifTtXZFthXT1iO1hkW2NdPWJ9XG5bW1wiYmx1clwiLFwiYmx1clwiXSxbXCJjYW5jZWxcIixcImNhbmNlbFwiXSxbXCJjbGlja1wiLFwiY2xpY2tcIl0sW1wiY2xvc2VcIixcImNsb3NlXCJdLFtcImNvbnRleHRtZW51XCIsXCJjb250ZXh0TWVudVwiXSxbXCJjb3B5XCIsXCJjb3B5XCJdLFtcImN1dFwiLFwiY3V0XCJdLFtcImF1eGNsaWNrXCIsXCJhdXhDbGlja1wiXSxbXCJkYmxjbGlja1wiLFwiZG91YmxlQ2xpY2tcIl0sW1wiZHJhZ2VuZFwiLFwiZHJhZ0VuZFwiXSxbXCJkcmFnc3RhcnRcIixcImRyYWdTdGFydFwiXSxbXCJkcm9wXCIsXCJkcm9wXCJdLFtcImZvY3VzXCIsXCJmb2N1c1wiXSxbXCJpbnB1dFwiLFwiaW5wdXRcIl0sW1wiaW52YWxpZFwiLFwiaW52YWxpZFwiXSxbXCJrZXlkb3duXCIsXCJrZXlEb3duXCJdLFtcImtleXByZXNzXCIsXCJrZXlQcmVzc1wiXSxbXCJrZXl1cFwiLFwia2V5VXBcIl0sW1wibW91c2Vkb3duXCIsXCJtb3VzZURvd25cIl0sW1wibW91c2V1cFwiLFwibW91c2VVcFwiXSxbXCJwYXN0ZVwiLFwicGFzdGVcIl0sW1wicGF1c2VcIixcInBhdXNlXCJdLFtcInBsYXlcIixcInBsYXlcIl0sW1wicG9pbnRlcmNhbmNlbFwiLFwicG9pbnRlckNhbmNlbFwiXSxcbltcInBvaW50ZXJkb3duXCIsXCJwb2ludGVyRG93blwiXSxbXCJwb2ludGVydXBcIixcInBvaW50ZXJVcFwiXSxbXCJyYXRlY2hhbmdlXCIsXCJyYXRlQ2hhbmdlXCJdLFtcInJlc2V0XCIsXCJyZXNldFwiXSxbXCJzZWVrZWRcIixcInNlZWtlZFwiXSxbXCJzdWJtaXRcIixcInN1Ym1pdFwiXSxbXCJ0b3VjaGNhbmNlbFwiLFwidG91Y2hDYW5jZWxcIl0sW1widG91Y2hlbmRcIixcInRvdWNoRW5kXCJdLFtcInRvdWNoc3RhcnRcIixcInRvdWNoU3RhcnRcIl0sW1widm9sdW1lY2hhbmdlXCIsXCJ2b2x1bWVDaGFuZ2VcIl1dLmZvckVhY2goZnVuY3Rpb24oYSl7WWQoYSwhMCl9KTtWZC5mb3JFYWNoKGZ1bmN0aW9uKGEpe1lkKGEsITEpfSk7XG52YXIgWmQ9e2V2ZW50VHlwZXM6V2QsaXNJbnRlcmFjdGl2ZVRvcExldmVsRXZlbnRUeXBlOmZ1bmN0aW9uKGEpe2E9WGRbYV07cmV0dXJuIHZvaWQgMCE9PWEmJiEwPT09YS5pc0ludGVyYWN0aXZlfSxleHRyYWN0RXZlbnRzOmZ1bmN0aW9uKGEsYixjLGQpe3ZhciBlPVhkW2FdO2lmKCFlKXJldHVybiBudWxsO3N3aXRjaChhKXtjYXNlIFwia2V5cHJlc3NcIjppZigwPT09TmQoYykpcmV0dXJuIG51bGw7Y2FzZSBcImtleWRvd25cIjpjYXNlIFwia2V5dXBcIjphPVFkO2JyZWFrO2Nhc2UgXCJibHVyXCI6Y2FzZSBcImZvY3VzXCI6YT1NZDticmVhaztjYXNlIFwiY2xpY2tcIjppZigyPT09Yy5idXR0b24pcmV0dXJuIG51bGw7Y2FzZSBcImF1eGNsaWNrXCI6Y2FzZSBcImRibGNsaWNrXCI6Y2FzZSBcIm1vdXNlZG93blwiOmNhc2UgXCJtb3VzZW1vdmVcIjpjYXNlIFwibW91c2V1cFwiOmNhc2UgXCJtb3VzZW91dFwiOmNhc2UgXCJtb3VzZW92ZXJcIjpjYXNlIFwiY29udGV4dG1lbnVcIjphPXpkO2JyZWFrO2Nhc2UgXCJkcmFnXCI6Y2FzZSBcImRyYWdlbmRcIjpjYXNlIFwiZHJhZ2VudGVyXCI6Y2FzZSBcImRyYWdleGl0XCI6Y2FzZSBcImRyYWdsZWF2ZVwiOmNhc2UgXCJkcmFnb3ZlclwiOmNhc2UgXCJkcmFnc3RhcnRcIjpjYXNlIFwiZHJvcFwiOmE9XG5SZDticmVhaztjYXNlIFwidG91Y2hjYW5jZWxcIjpjYXNlIFwidG91Y2hlbmRcIjpjYXNlIFwidG91Y2htb3ZlXCI6Y2FzZSBcInRvdWNoc3RhcnRcIjphPVNkO2JyZWFrO2Nhc2UgY2I6Y2FzZSBpYjpjYXNlIGpiOmE9S2Q7YnJlYWs7Y2FzZSBrYjphPVRkO2JyZWFrO2Nhc2UgXCJzY3JvbGxcIjphPXJkO2JyZWFrO2Nhc2UgXCJ3aGVlbFwiOmE9VWQ7YnJlYWs7Y2FzZSBcImNvcHlcIjpjYXNlIFwiY3V0XCI6Y2FzZSBcInBhc3RlXCI6YT1MZDticmVhaztjYXNlIFwiZ290cG9pbnRlcmNhcHR1cmVcIjpjYXNlIFwibG9zdHBvaW50ZXJjYXB0dXJlXCI6Y2FzZSBcInBvaW50ZXJjYW5jZWxcIjpjYXNlIFwicG9pbnRlcmRvd25cIjpjYXNlIFwicG9pbnRlcm1vdmVcIjpjYXNlIFwicG9pbnRlcm91dFwiOmNhc2UgXCJwb2ludGVyb3ZlclwiOmNhc2UgXCJwb2ludGVydXBcIjphPUFkO2JyZWFrO2RlZmF1bHQ6YT15fWI9YS5nZXRQb29sZWQoZSxiLGMsZCk7V2EoYik7cmV0dXJuIGJ9fSwkZD1aZC5pc0ludGVyYWN0aXZlVG9wTGV2ZWxFdmVudFR5cGUsXG5hZT1bXTtmdW5jdGlvbiBiZShhKXt2YXIgYj1hLnRhcmdldEluc3QsYz1iO2Rve2lmKCFjKXthLmFuY2VzdG9ycy5wdXNoKGMpO2JyZWFrfXZhciBkO2ZvcihkPWM7ZC5yZXR1cm47KWQ9ZC5yZXR1cm47ZD0zIT09ZC50YWc/bnVsbDpkLnN0YXRlTm9kZS5jb250YWluZXJJbmZvO2lmKCFkKWJyZWFrO2EuYW5jZXN0b3JzLnB1c2goYyk7Yz1OYShkKX13aGlsZShjKTtmb3IoYz0wO2M8YS5hbmNlc3RvcnMubGVuZ3RoO2MrKyl7Yj1hLmFuY2VzdG9yc1tjXTt2YXIgZT1lYyhhLm5hdGl2ZUV2ZW50KTtkPWEudG9wTGV2ZWxUeXBlO2Zvcih2YXIgZj1hLm5hdGl2ZUV2ZW50LGc9bnVsbCxoPTA7aDxyYS5sZW5ndGg7aCsrKXt2YXIgaz1yYVtoXTtrJiYoaz1rLmV4dHJhY3RFdmVudHMoZCxiLGYsZSkpJiYoZz1BYShnLGspKX1JYShnLCExKX19dmFyIGNlPSEwO1xuZnVuY3Rpb24gSChhLGIpe2lmKCFiKXJldHVybiBudWxsO3ZhciBjPSgkZChhKT9kZTplZSkuYmluZChudWxsLGEpO2IuYWRkRXZlbnRMaXN0ZW5lcihhLGMsITEpfWZ1bmN0aW9uIGdlKGEsYil7aWYoIWIpcmV0dXJuIG51bGw7dmFyIGM9KCRkKGEpP2RlOmVlKS5iaW5kKG51bGwsYSk7Yi5hZGRFdmVudExpc3RlbmVyKGEsYywhMCl9ZnVuY3Rpb24gZGUoYSxiKXtaYihlZSxhLGIpfVxuZnVuY3Rpb24gZWUoYSxiKXtpZihjZSl7dmFyIGM9ZWMoYik7Yz1OYShjKTtudWxsPT09Y3x8XCJudW1iZXJcIiE9PXR5cGVvZiBjLnRhZ3x8Mj09PUdkKGMpfHwoYz1udWxsKTtpZihhZS5sZW5ndGgpe3ZhciBkPWFlLnBvcCgpO2QudG9wTGV2ZWxUeXBlPWE7ZC5uYXRpdmVFdmVudD1iO2QudGFyZ2V0SW5zdD1jO2E9ZH1lbHNlIGE9e3RvcExldmVsVHlwZTphLG5hdGl2ZUV2ZW50OmIsdGFyZ2V0SW5zdDpjLGFuY2VzdG9yczpbXX07dHJ5e2JjKGJlLGEpfWZpbmFsbHl7YS50b3BMZXZlbFR5cGU9bnVsbCxhLm5hdGl2ZUV2ZW50PW51bGwsYS50YXJnZXRJbnN0PW51bGwsYS5hbmNlc3RvcnMubGVuZ3RoPTAsMTA+YWUubGVuZ3RoJiZhZS5wdXNoKGEpfX19dmFyIGhlPXt9LGllPTAsamU9XCJfcmVhY3RMaXN0ZW5lcnNJRFwiKyhcIlwiK01hdGgucmFuZG9tKCkpLnNsaWNlKDIpO1xuZnVuY3Rpb24ga2UoYSl7T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGEsamUpfHwoYVtqZV09aWUrKyxoZVthW2plXV09e30pO3JldHVybiBoZVthW2plXV19ZnVuY3Rpb24gbGUoYSl7YT1hfHwoXCJ1bmRlZmluZWRcIiE9PXR5cGVvZiBkb2N1bWVudD9kb2N1bWVudDp2b2lkIDApO2lmKFwidW5kZWZpbmVkXCI9PT10eXBlb2YgYSlyZXR1cm4gbnVsbDt0cnl7cmV0dXJuIGEuYWN0aXZlRWxlbWVudHx8YS5ib2R5fWNhdGNoKGIpe3JldHVybiBhLmJvZHl9fWZ1bmN0aW9uIG1lKGEpe2Zvcig7YSYmYS5maXJzdENoaWxkOylhPWEuZmlyc3RDaGlsZDtyZXR1cm4gYX1cbmZ1bmN0aW9uIG5lKGEsYil7dmFyIGM9bWUoYSk7YT0wO2Zvcih2YXIgZDtjOyl7aWYoMz09PWMubm9kZVR5cGUpe2Q9YStjLnRleHRDb250ZW50Lmxlbmd0aDtpZihhPD1iJiZkPj1iKXJldHVybntub2RlOmMsb2Zmc2V0OmItYX07YT1kfWE6e2Zvcig7Yzspe2lmKGMubmV4dFNpYmxpbmcpe2M9Yy5uZXh0U2libGluZzticmVhayBhfWM9Yy5wYXJlbnROb2RlfWM9dm9pZCAwfWM9bWUoYyl9fWZ1bmN0aW9uIG9lKGEsYil7cmV0dXJuIGEmJmI/YT09PWI/ITA6YSYmMz09PWEubm9kZVR5cGU/ITE6YiYmMz09PWIubm9kZVR5cGU/b2UoYSxiLnBhcmVudE5vZGUpOlwiY29udGFpbnNcImluIGE/YS5jb250YWlucyhiKTphLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uPyEhKGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oYikmMTYpOiExOiExfVxuZnVuY3Rpb24gcGUoKXtmb3IodmFyIGE9d2luZG93LGI9bGUoKTtiIGluc3RhbmNlb2YgYS5IVE1MSUZyYW1lRWxlbWVudDspe3RyeXthPWIuY29udGVudERvY3VtZW50LmRlZmF1bHRWaWV3fWNhdGNoKGMpe2JyZWFrfWI9bGUoYS5kb2N1bWVudCl9cmV0dXJuIGJ9ZnVuY3Rpb24gcWUoYSl7dmFyIGI9YSYmYS5ub2RlTmFtZSYmYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO3JldHVybiBiJiYoXCJpbnB1dFwiPT09YiYmKFwidGV4dFwiPT09YS50eXBlfHxcInNlYXJjaFwiPT09YS50eXBlfHxcInRlbFwiPT09YS50eXBlfHxcInVybFwiPT09YS50eXBlfHxcInBhc3N3b3JkXCI9PT1hLnR5cGUpfHxcInRleHRhcmVhXCI9PT1ifHxcInRydWVcIj09PWEuY29udGVudEVkaXRhYmxlKX1cbnZhciByZT1YYSYmXCJkb2N1bWVudE1vZGVcImluIGRvY3VtZW50JiYxMT49ZG9jdW1lbnQuZG9jdW1lbnRNb2RlLHNlPXtzZWxlY3Q6e3BoYXNlZFJlZ2lzdHJhdGlvbk5hbWVzOntidWJibGVkOlwib25TZWxlY3RcIixjYXB0dXJlZDpcIm9uU2VsZWN0Q2FwdHVyZVwifSxkZXBlbmRlbmNpZXM6XCJibHVyIGNvbnRleHRtZW51IGRyYWdlbmQgZm9jdXMga2V5ZG93biBrZXl1cCBtb3VzZWRvd24gbW91c2V1cCBzZWxlY3Rpb25jaGFuZ2VcIi5zcGxpdChcIiBcIil9fSx0ZT1udWxsLHVlPW51bGwsSGU9bnVsbCxJZT0hMTtcbmZ1bmN0aW9uIEplKGEsYil7dmFyIGM9Yi53aW5kb3c9PT1iP2IuZG9jdW1lbnQ6OT09PWIubm9kZVR5cGU/YjpiLm93bmVyRG9jdW1lbnQ7aWYoSWV8fG51bGw9PXRlfHx0ZSE9PWxlKGMpKXJldHVybiBudWxsO2M9dGU7XCJzZWxlY3Rpb25TdGFydFwiaW4gYyYmcWUoYyk/Yz17c3RhcnQ6Yy5zZWxlY3Rpb25TdGFydCxlbmQ6Yy5zZWxlY3Rpb25FbmR9OihjPShjLm93bmVyRG9jdW1lbnQmJmMub3duZXJEb2N1bWVudC5kZWZhdWx0Vmlld3x8d2luZG93KS5nZXRTZWxlY3Rpb24oKSxjPXthbmNob3JOb2RlOmMuYW5jaG9yTm9kZSxhbmNob3JPZmZzZXQ6Yy5hbmNob3JPZmZzZXQsZm9jdXNOb2RlOmMuZm9jdXNOb2RlLGZvY3VzT2Zmc2V0OmMuZm9jdXNPZmZzZXR9KTtyZXR1cm4gSGUmJkZkKEhlLGMpP251bGw6KEhlPWMsYT15LmdldFBvb2xlZChzZS5zZWxlY3QsdWUsYSxiKSxhLnR5cGU9XCJzZWxlY3RcIixhLnRhcmdldD10ZSxXYShhKSxhKX1cbnZhciBLZT17ZXZlbnRUeXBlczpzZSxleHRyYWN0RXZlbnRzOmZ1bmN0aW9uKGEsYixjLGQpe3ZhciBlPWQud2luZG93PT09ZD9kLmRvY3VtZW50Ojk9PT1kLm5vZGVUeXBlP2Q6ZC5vd25lckRvY3VtZW50LGY7aWYoIShmPSFlKSl7YTp7ZT1rZShlKTtmPXZhLm9uU2VsZWN0O2Zvcih2YXIgZz0wO2c8Zi5sZW5ndGg7ZysrKXt2YXIgaD1mW2ddO2lmKCFlLmhhc093blByb3BlcnR5KGgpfHwhZVtoXSl7ZT0hMTticmVhayBhfX1lPSEwfWY9IWV9aWYoZilyZXR1cm4gbnVsbDtlPWI/UGEoYik6d2luZG93O3N3aXRjaChhKXtjYXNlIFwiZm9jdXNcIjppZihkYyhlKXx8XCJ0cnVlXCI9PT1lLmNvbnRlbnRFZGl0YWJsZSl0ZT1lLHVlPWIsSGU9bnVsbDticmVhaztjYXNlIFwiYmx1clwiOkhlPXVlPXRlPW51bGw7YnJlYWs7Y2FzZSBcIm1vdXNlZG93blwiOkllPSEwO2JyZWFrO2Nhc2UgXCJjb250ZXh0bWVudVwiOmNhc2UgXCJtb3VzZXVwXCI6Y2FzZSBcImRyYWdlbmRcIjpyZXR1cm4gSWU9ITEsSmUoYyxkKTtjYXNlIFwic2VsZWN0aW9uY2hhbmdlXCI6aWYocmUpYnJlYWs7XG5jYXNlIFwia2V5ZG93blwiOmNhc2UgXCJrZXl1cFwiOnJldHVybiBKZShjLGQpfXJldHVybiBudWxsfX07R2EuaW5qZWN0RXZlbnRQbHVnaW5PcmRlcihcIlJlc3BvbmRlckV2ZW50UGx1Z2luIFNpbXBsZUV2ZW50UGx1Z2luIEVudGVyTGVhdmVFdmVudFBsdWdpbiBDaGFuZ2VFdmVudFBsdWdpbiBTZWxlY3RFdmVudFBsdWdpbiBCZWZvcmVJbnB1dEV2ZW50UGx1Z2luXCIuc3BsaXQoXCIgXCIpKTt3YT1RYTt4YT1PYTt5YT1QYTtHYS5pbmplY3RFdmVudFBsdWdpbnNCeU5hbWUoe1NpbXBsZUV2ZW50UGx1Z2luOlpkLEVudGVyTGVhdmVFdmVudFBsdWdpbjpDZCxDaGFuZ2VFdmVudFBsdWdpbjpxZCxTZWxlY3RFdmVudFBsdWdpbjpLZSxCZWZvcmVJbnB1dEV2ZW50UGx1Z2luOk1ifSk7ZnVuY3Rpb24gTGUoYSl7dmFyIGI9XCJcIjthYS5DaGlsZHJlbi5mb3JFYWNoKGEsZnVuY3Rpb24oYSl7bnVsbCE9YSYmKGIrPWEpfSk7cmV0dXJuIGJ9XG5mdW5jdGlvbiBNZShhLGIpe2E9bih7Y2hpbGRyZW46dm9pZCAwfSxiKTtpZihiPUxlKGIuY2hpbGRyZW4pKWEuY2hpbGRyZW49YjtyZXR1cm4gYX1mdW5jdGlvbiBOZShhLGIsYyxkKXthPWEub3B0aW9ucztpZihiKXtiPXt9O2Zvcih2YXIgZT0wO2U8Yy5sZW5ndGg7ZSsrKWJbXCIkXCIrY1tlXV09ITA7Zm9yKGM9MDtjPGEubGVuZ3RoO2MrKyllPWIuaGFzT3duUHJvcGVydHkoXCIkXCIrYVtjXS52YWx1ZSksYVtjXS5zZWxlY3RlZCE9PWUmJihhW2NdLnNlbGVjdGVkPWUpLGUmJmQmJihhW2NdLmRlZmF1bHRTZWxlY3RlZD0hMCl9ZWxzZXtjPVwiXCIrUGMoYyk7Yj1udWxsO2ZvcihlPTA7ZTxhLmxlbmd0aDtlKyspe2lmKGFbZV0udmFsdWU9PT1jKXthW2VdLnNlbGVjdGVkPSEwO2QmJihhW2VdLmRlZmF1bHRTZWxlY3RlZD0hMCk7cmV0dXJufW51bGwhPT1ifHxhW2VdLmRpc2FibGVkfHwoYj1hW2VdKX1udWxsIT09YiYmKGIuc2VsZWN0ZWQ9ITApfX1cbmZ1bmN0aW9uIE9lKGEsYil7bnVsbCE9Yi5kYW5nZXJvdXNseVNldElubmVySFRNTD9yKFwiOTFcIik6dm9pZCAwO3JldHVybiBuKHt9LGIse3ZhbHVlOnZvaWQgMCxkZWZhdWx0VmFsdWU6dm9pZCAwLGNoaWxkcmVuOlwiXCIrYS5fd3JhcHBlclN0YXRlLmluaXRpYWxWYWx1ZX0pfWZ1bmN0aW9uIFBlKGEsYil7dmFyIGM9Yi52YWx1ZTtudWxsPT1jJiYoYz1iLmRlZmF1bHRWYWx1ZSxiPWIuY2hpbGRyZW4sbnVsbCE9YiYmKG51bGwhPWM/cihcIjkyXCIpOnZvaWQgMCxBcnJheS5pc0FycmF5KGIpJiYoMT49Yi5sZW5ndGg/dm9pZCAwOnIoXCI5M1wiKSxiPWJbMF0pLGM9YiksbnVsbD09YyYmKGM9XCJcIikpO2EuX3dyYXBwZXJTdGF0ZT17aW5pdGlhbFZhbHVlOlBjKGMpfX1cbmZ1bmN0aW9uIFFlKGEsYil7dmFyIGM9UGMoYi52YWx1ZSksZD1QYyhiLmRlZmF1bHRWYWx1ZSk7bnVsbCE9YyYmKGM9XCJcIitjLGMhPT1hLnZhbHVlJiYoYS52YWx1ZT1jKSxudWxsPT1iLmRlZmF1bHRWYWx1ZSYmYS5kZWZhdWx0VmFsdWUhPT1jJiYoYS5kZWZhdWx0VmFsdWU9YykpO251bGwhPWQmJihhLmRlZmF1bHRWYWx1ZT1cIlwiK2QpfWZ1bmN0aW9uIFJlKGEpe3ZhciBiPWEudGV4dENvbnRlbnQ7Yj09PWEuX3dyYXBwZXJTdGF0ZS5pbml0aWFsVmFsdWUmJihhLnZhbHVlPWIpfXZhciBTZT17aHRtbDpcImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWxcIixtYXRobWw6XCJodHRwOi8vd3d3LnczLm9yZy8xOTk4L01hdGgvTWF0aE1MXCIsc3ZnOlwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIn07XG5mdW5jdGlvbiBUZShhKXtzd2l0Y2goYSl7Y2FzZSBcInN2Z1wiOnJldHVyblwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIjtjYXNlIFwibWF0aFwiOnJldHVyblwiaHR0cDovL3d3dy53My5vcmcvMTk5OC9NYXRoL01hdGhNTFwiO2RlZmF1bHQ6cmV0dXJuXCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sXCJ9fWZ1bmN0aW9uIFVlKGEsYil7cmV0dXJuIG51bGw9PWF8fFwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbFwiPT09YT9UZShiKTpcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCI9PT1hJiZcImZvcmVpZ25PYmplY3RcIj09PWI/XCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sXCI6YX1cbnZhciBWZT12b2lkIDAsV2U9ZnVuY3Rpb24oYSl7cmV0dXJuXCJ1bmRlZmluZWRcIiE9PXR5cGVvZiBNU0FwcCYmTVNBcHAuZXhlY1Vuc2FmZUxvY2FsRnVuY3Rpb24/ZnVuY3Rpb24oYixjLGQsZSl7TVNBcHAuZXhlY1Vuc2FmZUxvY2FsRnVuY3Rpb24oZnVuY3Rpb24oKXtyZXR1cm4gYShiLGMsZCxlKX0pfTphfShmdW5jdGlvbihhLGIpe2lmKGEubmFtZXNwYWNlVVJJIT09U2Uuc3ZnfHxcImlubmVySFRNTFwiaW4gYSlhLmlubmVySFRNTD1iO2Vsc2V7VmU9VmV8fGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7VmUuaW5uZXJIVE1MPVwiPHN2Zz5cIitiK1wiPC9zdmc+XCI7Zm9yKGI9VmUuZmlyc3RDaGlsZDthLmZpcnN0Q2hpbGQ7KWEucmVtb3ZlQ2hpbGQoYS5maXJzdENoaWxkKTtmb3IoO2IuZmlyc3RDaGlsZDspYS5hcHBlbmRDaGlsZChiLmZpcnN0Q2hpbGQpfX0pO1xuZnVuY3Rpb24gWGUoYSxiKXtpZihiKXt2YXIgYz1hLmZpcnN0Q2hpbGQ7aWYoYyYmYz09PWEubGFzdENoaWxkJiYzPT09Yy5ub2RlVHlwZSl7Yy5ub2RlVmFsdWU9YjtyZXR1cm59fWEudGV4dENvbnRlbnQ9Yn1cbnZhciBZZT17YW5pbWF0aW9uSXRlcmF0aW9uQ291bnQ6ITAsYm9yZGVySW1hZ2VPdXRzZXQ6ITAsYm9yZGVySW1hZ2VTbGljZTohMCxib3JkZXJJbWFnZVdpZHRoOiEwLGJveEZsZXg6ITAsYm94RmxleEdyb3VwOiEwLGJveE9yZGluYWxHcm91cDohMCxjb2x1bW5Db3VudDohMCxjb2x1bW5zOiEwLGZsZXg6ITAsZmxleEdyb3c6ITAsZmxleFBvc2l0aXZlOiEwLGZsZXhTaHJpbms6ITAsZmxleE5lZ2F0aXZlOiEwLGZsZXhPcmRlcjohMCxncmlkQXJlYTohMCxncmlkUm93OiEwLGdyaWRSb3dFbmQ6ITAsZ3JpZFJvd1NwYW46ITAsZ3JpZFJvd1N0YXJ0OiEwLGdyaWRDb2x1bW46ITAsZ3JpZENvbHVtbkVuZDohMCxncmlkQ29sdW1uU3BhbjohMCxncmlkQ29sdW1uU3RhcnQ6ITAsZm9udFdlaWdodDohMCxsaW5lQ2xhbXA6ITAsbGluZUhlaWdodDohMCxvcGFjaXR5OiEwLG9yZGVyOiEwLG9ycGhhbnM6ITAsdGFiU2l6ZTohMCx3aWRvd3M6ITAsekluZGV4OiEwLHpvb206ITAsZmlsbE9wYWNpdHk6ITAsXG5mbG9vZE9wYWNpdHk6ITAsc3RvcE9wYWNpdHk6ITAsc3Ryb2tlRGFzaGFycmF5OiEwLHN0cm9rZURhc2hvZmZzZXQ6ITAsc3Ryb2tlTWl0ZXJsaW1pdDohMCxzdHJva2VPcGFjaXR5OiEwLHN0cm9rZVdpZHRoOiEwfSxaZT1bXCJXZWJraXRcIixcIm1zXCIsXCJNb3pcIixcIk9cIl07T2JqZWN0LmtleXMoWWUpLmZvckVhY2goZnVuY3Rpb24oYSl7WmUuZm9yRWFjaChmdW5jdGlvbihiKXtiPWIrYS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSthLnN1YnN0cmluZygxKTtZZVtiXT1ZZVthXX0pfSk7XG5mdW5jdGlvbiAkZShhLGIpe2E9YS5zdHlsZTtmb3IodmFyIGMgaW4gYilpZihiLmhhc093blByb3BlcnR5KGMpKXt2YXIgZD0wPT09Yy5pbmRleE9mKFwiLS1cIik7dmFyIGU9Yzt2YXIgZj1iW2NdO2U9bnVsbD09Znx8XCJib29sZWFuXCI9PT10eXBlb2YgZnx8XCJcIj09PWY/XCJcIjpkfHxcIm51bWJlclwiIT09dHlwZW9mIGZ8fDA9PT1mfHxZZS5oYXNPd25Qcm9wZXJ0eShlKSYmWWVbZV0/KFwiXCIrZikudHJpbSgpOmYrXCJweFwiO1wiZmxvYXRcIj09PWMmJihjPVwiY3NzRmxvYXRcIik7ZD9hLnNldFByb3BlcnR5KGMsZSk6YVtjXT1lfX12YXIgYWY9bih7bWVudWl0ZW06ITB9LHthcmVhOiEwLGJhc2U6ITAsYnI6ITAsY29sOiEwLGVtYmVkOiEwLGhyOiEwLGltZzohMCxpbnB1dDohMCxrZXlnZW46ITAsbGluazohMCxtZXRhOiEwLHBhcmFtOiEwLHNvdXJjZTohMCx0cmFjazohMCx3YnI6ITB9KTtcbmZ1bmN0aW9uIGJmKGEsYil7YiYmKGFmW2FdJiYobnVsbCE9Yi5jaGlsZHJlbnx8bnVsbCE9Yi5kYW5nZXJvdXNseVNldElubmVySFRNTD9yKFwiMTM3XCIsYSxcIlwiKTp2b2lkIDApLG51bGwhPWIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwmJihudWxsIT1iLmNoaWxkcmVuP3IoXCI2MFwiKTp2b2lkIDAsXCJvYmplY3RcIj09PXR5cGVvZiBiLmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MJiZcIl9faHRtbFwiaW4gYi5kYW5nZXJvdXNseVNldElubmVySFRNTD92b2lkIDA6cihcIjYxXCIpKSxudWxsIT1iLnN0eWxlJiZcIm9iamVjdFwiIT09dHlwZW9mIGIuc3R5bGU/cihcIjYyXCIsXCJcIik6dm9pZCAwKX1cbmZ1bmN0aW9uIGNmKGEsYil7aWYoLTE9PT1hLmluZGV4T2YoXCItXCIpKXJldHVyblwic3RyaW5nXCI9PT10eXBlb2YgYi5pcztzd2l0Y2goYSl7Y2FzZSBcImFubm90YXRpb24teG1sXCI6Y2FzZSBcImNvbG9yLXByb2ZpbGVcIjpjYXNlIFwiZm9udC1mYWNlXCI6Y2FzZSBcImZvbnQtZmFjZS1zcmNcIjpjYXNlIFwiZm9udC1mYWNlLXVyaVwiOmNhc2UgXCJmb250LWZhY2UtZm9ybWF0XCI6Y2FzZSBcImZvbnQtZmFjZS1uYW1lXCI6Y2FzZSBcIm1pc3NpbmctZ2x5cGhcIjpyZXR1cm4hMTtkZWZhdWx0OnJldHVybiEwfX1cbmZ1bmN0aW9uIGRmKGEsYil7YT05PT09YS5ub2RlVHlwZXx8MTE9PT1hLm5vZGVUeXBlP2E6YS5vd25lckRvY3VtZW50O3ZhciBjPWtlKGEpO2I9dmFbYl07Zm9yKHZhciBkPTA7ZDxiLmxlbmd0aDtkKyspe3ZhciBlPWJbZF07aWYoIWMuaGFzT3duUHJvcGVydHkoZSl8fCFjW2VdKXtzd2l0Y2goZSl7Y2FzZSBcInNjcm9sbFwiOmdlKFwic2Nyb2xsXCIsYSk7YnJlYWs7Y2FzZSBcImZvY3VzXCI6Y2FzZSBcImJsdXJcIjpnZShcImZvY3VzXCIsYSk7Z2UoXCJibHVyXCIsYSk7Yy5ibHVyPSEwO2MuZm9jdXM9ITA7YnJlYWs7Y2FzZSBcImNhbmNlbFwiOmNhc2UgXCJjbG9zZVwiOmZjKGUpJiZnZShlLGEpO2JyZWFrO2Nhc2UgXCJpbnZhbGlkXCI6Y2FzZSBcInN1Ym1pdFwiOmNhc2UgXCJyZXNldFwiOmJyZWFrO2RlZmF1bHQ6LTE9PT1sYi5pbmRleE9mKGUpJiZIKGUsYSl9Y1tlXT0hMH19fWZ1bmN0aW9uIGVmKCl7fXZhciBmZj1udWxsLGdmPW51bGw7XG5mdW5jdGlvbiBoZihhLGIpe3N3aXRjaChhKXtjYXNlIFwiYnV0dG9uXCI6Y2FzZSBcImlucHV0XCI6Y2FzZSBcInNlbGVjdFwiOmNhc2UgXCJ0ZXh0YXJlYVwiOnJldHVybiEhYi5hdXRvRm9jdXN9cmV0dXJuITF9ZnVuY3Rpb24gamYoYSxiKXtyZXR1cm5cInRleHRhcmVhXCI9PT1hfHxcIm9wdGlvblwiPT09YXx8XCJub3NjcmlwdFwiPT09YXx8XCJzdHJpbmdcIj09PXR5cGVvZiBiLmNoaWxkcmVufHxcIm51bWJlclwiPT09dHlwZW9mIGIuY2hpbGRyZW58fFwib2JqZWN0XCI9PT10eXBlb2YgYi5kYW5nZXJvdXNseVNldElubmVySFRNTCYmbnVsbCE9PWIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwmJm51bGwhPWIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwuX19odG1sfXZhciBrZj1zZXRUaW1lb3V0LGxmPWNsZWFyVGltZW91dDtmdW5jdGlvbiBtZihhKXtmb3IoYT1hLm5leHRTaWJsaW5nO2EmJjEhPT1hLm5vZGVUeXBlJiYzIT09YS5ub2RlVHlwZTspYT1hLm5leHRTaWJsaW5nO3JldHVybiBhfVxuZnVuY3Rpb24gbmYoYSl7Zm9yKGE9YS5maXJzdENoaWxkO2EmJjEhPT1hLm5vZGVUeXBlJiYzIT09YS5ub2RlVHlwZTspYT1hLm5leHRTaWJsaW5nO3JldHVybiBhfW5ldyBTZXQ7dmFyIG9mPVtdLHBmPS0xO2Z1bmN0aW9uIEkoYSl7MD5wZnx8KGEuY3VycmVudD1vZltwZl0sb2ZbcGZdPW51bGwscGYtLSl9ZnVuY3Rpb24gSihhLGIpe3BmKys7b2ZbcGZdPWEuY3VycmVudDthLmN1cnJlbnQ9Yn12YXIgcWY9e30sSz17Y3VycmVudDpxZn0sTD17Y3VycmVudDohMX0scmY9cWY7XG5mdW5jdGlvbiBzZihhLGIpe3ZhciBjPWEudHlwZS5jb250ZXh0VHlwZXM7aWYoIWMpcmV0dXJuIHFmO3ZhciBkPWEuc3RhdGVOb2RlO2lmKGQmJmQuX19yZWFjdEludGVybmFsTWVtb2l6ZWRVbm1hc2tlZENoaWxkQ29udGV4dD09PWIpcmV0dXJuIGQuX19yZWFjdEludGVybmFsTWVtb2l6ZWRNYXNrZWRDaGlsZENvbnRleHQ7dmFyIGU9e30sZjtmb3IoZiBpbiBjKWVbZl09YltmXTtkJiYoYT1hLnN0YXRlTm9kZSxhLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkVW5tYXNrZWRDaGlsZENvbnRleHQ9YixhLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkTWFza2VkQ2hpbGRDb250ZXh0PWUpO3JldHVybiBlfWZ1bmN0aW9uIE0oYSl7YT1hLmNoaWxkQ29udGV4dFR5cGVzO3JldHVybiBudWxsIT09YSYmdm9pZCAwIT09YX1mdW5jdGlvbiB0ZihhKXtJKEwsYSk7SShLLGEpfWZ1bmN0aW9uIHVmKGEpe0koTCxhKTtJKEssYSl9XG5mdW5jdGlvbiB2ZihhLGIsYyl7Sy5jdXJyZW50IT09cWY/cihcIjE2OFwiKTp2b2lkIDA7SihLLGIsYSk7SihMLGMsYSl9ZnVuY3Rpb24gd2YoYSxiLGMpe3ZhciBkPWEuc3RhdGVOb2RlO2E9Yi5jaGlsZENvbnRleHRUeXBlcztpZihcImZ1bmN0aW9uXCIhPT10eXBlb2YgZC5nZXRDaGlsZENvbnRleHQpcmV0dXJuIGM7ZD1kLmdldENoaWxkQ29udGV4dCgpO2Zvcih2YXIgZSBpbiBkKWUgaW4gYT92b2lkIDA6cihcIjEwOFwiLEFjKGIpfHxcIlVua25vd25cIixlKTtyZXR1cm4gbih7fSxjLGQpfWZ1bmN0aW9uIHhmKGEpe3ZhciBiPWEuc3RhdGVOb2RlO2I9YiYmYi5fX3JlYWN0SW50ZXJuYWxNZW1vaXplZE1lcmdlZENoaWxkQ29udGV4dHx8cWY7cmY9Sy5jdXJyZW50O0ooSyxiLGEpO0ooTCxMLmN1cnJlbnQsYSk7cmV0dXJuITB9XG5mdW5jdGlvbiB5ZihhLGIsYyl7dmFyIGQ9YS5zdGF0ZU5vZGU7ZD92b2lkIDA6cihcIjE2OVwiKTtjPyhiPXdmKGEsYixyZiksZC5fX3JlYWN0SW50ZXJuYWxNZW1vaXplZE1lcmdlZENoaWxkQ29udGV4dD1iLEkoTCxhKSxJKEssYSksSihLLGIsYSkpOkkoTCxhKTtKKEwsYyxhKX12YXIgemY9bnVsbCxBZj1udWxsO2Z1bmN0aW9uIEJmKGEpe3JldHVybiBmdW5jdGlvbihiKXt0cnl7cmV0dXJuIGEoYil9Y2F0Y2goYyl7fX19XG5mdW5jdGlvbiBDZihhKXtpZihcInVuZGVmaW5lZFwiPT09dHlwZW9mIF9fUkVBQ1RfREVWVE9PTFNfR0xPQkFMX0hPT0tfXylyZXR1cm4hMTt2YXIgYj1fX1JFQUNUX0RFVlRPT0xTX0dMT0JBTF9IT09LX187aWYoYi5pc0Rpc2FibGVkfHwhYi5zdXBwb3J0c0ZpYmVyKXJldHVybiEwO3RyeXt2YXIgYz1iLmluamVjdChhKTt6Zj1CZihmdW5jdGlvbihhKXtyZXR1cm4gYi5vbkNvbW1pdEZpYmVyUm9vdChjLGEpfSk7QWY9QmYoZnVuY3Rpb24oYSl7cmV0dXJuIGIub25Db21taXRGaWJlclVubW91bnQoYyxhKX0pfWNhdGNoKGQpe31yZXR1cm4hMH1cbmZ1bmN0aW9uIERmKGEsYixjLGQpe3RoaXMudGFnPWE7dGhpcy5rZXk9Yzt0aGlzLnNpYmxpbmc9dGhpcy5jaGlsZD10aGlzLnJldHVybj10aGlzLnN0YXRlTm9kZT10aGlzLnR5cGU9dGhpcy5lbGVtZW50VHlwZT1udWxsO3RoaXMuaW5kZXg9MDt0aGlzLnJlZj1udWxsO3RoaXMucGVuZGluZ1Byb3BzPWI7dGhpcy5maXJzdENvbnRleHREZXBlbmRlbmN5PXRoaXMubWVtb2l6ZWRTdGF0ZT10aGlzLnVwZGF0ZVF1ZXVlPXRoaXMubWVtb2l6ZWRQcm9wcz1udWxsO3RoaXMubW9kZT1kO3RoaXMuZWZmZWN0VGFnPTA7dGhpcy5sYXN0RWZmZWN0PXRoaXMuZmlyc3RFZmZlY3Q9dGhpcy5uZXh0RWZmZWN0PW51bGw7dGhpcy5jaGlsZEV4cGlyYXRpb25UaW1lPXRoaXMuZXhwaXJhdGlvblRpbWU9MDt0aGlzLmFsdGVybmF0ZT1udWxsfWZ1bmN0aW9uIE4oYSxiLGMsZCl7cmV0dXJuIG5ldyBEZihhLGIsYyxkKX1cbmZ1bmN0aW9uIEVmKGEpe2E9YS5wcm90b3R5cGU7cmV0dXJuISghYXx8IWEuaXNSZWFjdENvbXBvbmVudCl9ZnVuY3Rpb24gRmYoYSl7aWYoXCJmdW5jdGlvblwiPT09dHlwZW9mIGEpcmV0dXJuIEVmKGEpPzE6MDtpZih2b2lkIDAhPT1hJiZudWxsIT09YSl7YT1hLiQkdHlwZW9mO2lmKGE9PT11YylyZXR1cm4gMTE7aWYoYT09PXdjKXJldHVybiAxNH1yZXR1cm4gMn1cbmZ1bmN0aW9uIEdmKGEsYil7dmFyIGM9YS5hbHRlcm5hdGU7bnVsbD09PWM/KGM9TihhLnRhZyxiLGEua2V5LGEubW9kZSksYy5lbGVtZW50VHlwZT1hLmVsZW1lbnRUeXBlLGMudHlwZT1hLnR5cGUsYy5zdGF0ZU5vZGU9YS5zdGF0ZU5vZGUsYy5hbHRlcm5hdGU9YSxhLmFsdGVybmF0ZT1jKTooYy5wZW5kaW5nUHJvcHM9YixjLmVmZmVjdFRhZz0wLGMubmV4dEVmZmVjdD1udWxsLGMuZmlyc3RFZmZlY3Q9bnVsbCxjLmxhc3RFZmZlY3Q9bnVsbCk7Yy5jaGlsZEV4cGlyYXRpb25UaW1lPWEuY2hpbGRFeHBpcmF0aW9uVGltZTtjLmV4cGlyYXRpb25UaW1lPWEuZXhwaXJhdGlvblRpbWU7Yy5jaGlsZD1hLmNoaWxkO2MubWVtb2l6ZWRQcm9wcz1hLm1lbW9pemVkUHJvcHM7Yy5tZW1vaXplZFN0YXRlPWEubWVtb2l6ZWRTdGF0ZTtjLnVwZGF0ZVF1ZXVlPWEudXBkYXRlUXVldWU7Yy5maXJzdENvbnRleHREZXBlbmRlbmN5PWEuZmlyc3RDb250ZXh0RGVwZW5kZW5jeTtjLnNpYmxpbmc9YS5zaWJsaW5nO1xuYy5pbmRleD1hLmluZGV4O2MucmVmPWEucmVmO3JldHVybiBjfVxuZnVuY3Rpb24gSGYoYSxiLGMsZCxlLGYpe3ZhciBnPTI7ZD1hO2lmKFwiZnVuY3Rpb25cIj09PXR5cGVvZiBhKUVmKGEpJiYoZz0xKTtlbHNlIGlmKFwic3RyaW5nXCI9PT10eXBlb2YgYSlnPTU7ZWxzZSBhOnN3aXRjaChhKXtjYXNlIG9jOnJldHVybiBJZihjLmNoaWxkcmVuLGUsZixiKTtjYXNlIHRjOnJldHVybiBKZihjLGV8MyxmLGIpO2Nhc2UgcGM6cmV0dXJuIEpmKGMsZXwyLGYsYik7Y2FzZSBxYzpyZXR1cm4gYT1OKDEyLGMsYixlfDQpLGEuZWxlbWVudFR5cGU9cWMsYS50eXBlPXFjLGEuZXhwaXJhdGlvblRpbWU9ZixhO2Nhc2UgdmM6cmV0dXJuIGE9TigxMyxjLGIsZSksYS5lbGVtZW50VHlwZT12YyxhLnR5cGU9dmMsYS5leHBpcmF0aW9uVGltZT1mLGE7ZGVmYXVsdDppZihcIm9iamVjdFwiPT09dHlwZW9mIGEmJm51bGwhPT1hKXN3aXRjaChhLiQkdHlwZW9mKXtjYXNlIHJjOmc9MTA7YnJlYWsgYTtjYXNlIHNjOmc9OTticmVhayBhO2Nhc2UgdWM6Zz0xMTticmVhayBhO2Nhc2Ugd2M6Zz1cbjE0O2JyZWFrIGE7Y2FzZSB4YzpnPTE2O2Q9bnVsbDticmVhayBhfXIoXCIxMzBcIixudWxsPT1hP2E6dHlwZW9mIGEsXCJcIil9Yj1OKGcsYyxiLGUpO2IuZWxlbWVudFR5cGU9YTtiLnR5cGU9ZDtiLmV4cGlyYXRpb25UaW1lPWY7cmV0dXJuIGJ9ZnVuY3Rpb24gSWYoYSxiLGMsZCl7YT1OKDcsYSxkLGIpO2EuZXhwaXJhdGlvblRpbWU9YztyZXR1cm4gYX1mdW5jdGlvbiBKZihhLGIsYyxkKXthPU4oOCxhLGQsYik7Yj0wPT09KGImMSk/cGM6dGM7YS5lbGVtZW50VHlwZT1iO2EudHlwZT1iO2EuZXhwaXJhdGlvblRpbWU9YztyZXR1cm4gYX1mdW5jdGlvbiBLZihhLGIsYyl7YT1OKDYsYSxudWxsLGIpO2EuZXhwaXJhdGlvblRpbWU9YztyZXR1cm4gYX1cbmZ1bmN0aW9uIExmKGEsYixjKXtiPU4oNCxudWxsIT09YS5jaGlsZHJlbj9hLmNoaWxkcmVuOltdLGEua2V5LGIpO2IuZXhwaXJhdGlvblRpbWU9YztiLnN0YXRlTm9kZT17Y29udGFpbmVySW5mbzphLmNvbnRhaW5lckluZm8scGVuZGluZ0NoaWxkcmVuOm51bGwsaW1wbGVtZW50YXRpb246YS5pbXBsZW1lbnRhdGlvbn07cmV0dXJuIGJ9ZnVuY3Rpb24gTWYoYSxiKXthLmRpZEVycm9yPSExO3ZhciBjPWEuZWFybGllc3RQZW5kaW5nVGltZTswPT09Yz9hLmVhcmxpZXN0UGVuZGluZ1RpbWU9YS5sYXRlc3RQZW5kaW5nVGltZT1iOmM+Yj9hLmVhcmxpZXN0UGVuZGluZ1RpbWU9YjphLmxhdGVzdFBlbmRpbmdUaW1lPGImJihhLmxhdGVzdFBlbmRpbmdUaW1lPWIpO05mKGIsYSl9XG5mdW5jdGlvbiBPZihhLGIpe2EuZGlkRXJyb3I9ITE7dmFyIGM9YS5sYXRlc3RQaW5nZWRUaW1lOzAhPT1jJiZjPD1iJiYoYS5sYXRlc3RQaW5nZWRUaW1lPTApO2M9YS5lYXJsaWVzdFBlbmRpbmdUaW1lO3ZhciBkPWEubGF0ZXN0UGVuZGluZ1RpbWU7Yz09PWI/YS5lYXJsaWVzdFBlbmRpbmdUaW1lPWQ9PT1iP2EubGF0ZXN0UGVuZGluZ1RpbWU9MDpkOmQ9PT1iJiYoYS5sYXRlc3RQZW5kaW5nVGltZT1jKTtjPWEuZWFybGllc3RTdXNwZW5kZWRUaW1lO2Q9YS5sYXRlc3RTdXNwZW5kZWRUaW1lOzA9PT1jP2EuZWFybGllc3RTdXNwZW5kZWRUaW1lPWEubGF0ZXN0U3VzcGVuZGVkVGltZT1iOmM+Yj9hLmVhcmxpZXN0U3VzcGVuZGVkVGltZT1iOmQ8YiYmKGEubGF0ZXN0U3VzcGVuZGVkVGltZT1iKTtOZihiLGEpfVxuZnVuY3Rpb24gUGYoYSxiKXt2YXIgYz1hLmVhcmxpZXN0UGVuZGluZ1RpbWU7YT1hLmVhcmxpZXN0U3VzcGVuZGVkVGltZTtpZigwPT09Ynx8MCE9PWMmJmM8YiliPWM7aWYoMD09PWJ8fDAhPT1hJiZhPGIpYj1hO3JldHVybiBifWZ1bmN0aW9uIE5mKGEsYil7dmFyIGM9Yi5lYXJsaWVzdFN1c3BlbmRlZFRpbWUsZD1iLmxhdGVzdFN1c3BlbmRlZFRpbWUsZT1iLmVhcmxpZXN0UGVuZGluZ1RpbWUsZj1iLmxhdGVzdFBpbmdlZFRpbWU7ZT0wIT09ZT9lOmY7MD09PWUmJigwPT09YXx8ZD5hKSYmKGU9ZCk7YT1lOzAhPT1hJiYwIT09YyYmYzxhJiYoYT1jKTtiLm5leHRFeHBpcmF0aW9uVGltZVRvV29ya09uPWU7Yi5leHBpcmF0aW9uVGltZT1hfXZhciBRZj0hMTtcbmZ1bmN0aW9uIFJmKGEpe3JldHVybntiYXNlU3RhdGU6YSxmaXJzdFVwZGF0ZTpudWxsLGxhc3RVcGRhdGU6bnVsbCxmaXJzdENhcHR1cmVkVXBkYXRlOm51bGwsbGFzdENhcHR1cmVkVXBkYXRlOm51bGwsZmlyc3RFZmZlY3Q6bnVsbCxsYXN0RWZmZWN0Om51bGwsZmlyc3RDYXB0dXJlZEVmZmVjdDpudWxsLGxhc3RDYXB0dXJlZEVmZmVjdDpudWxsfX1mdW5jdGlvbiBTZihhKXtyZXR1cm57YmFzZVN0YXRlOmEuYmFzZVN0YXRlLGZpcnN0VXBkYXRlOmEuZmlyc3RVcGRhdGUsbGFzdFVwZGF0ZTphLmxhc3RVcGRhdGUsZmlyc3RDYXB0dXJlZFVwZGF0ZTpudWxsLGxhc3RDYXB0dXJlZFVwZGF0ZTpudWxsLGZpcnN0RWZmZWN0Om51bGwsbGFzdEVmZmVjdDpudWxsLGZpcnN0Q2FwdHVyZWRFZmZlY3Q6bnVsbCxsYXN0Q2FwdHVyZWRFZmZlY3Q6bnVsbH19XG5mdW5jdGlvbiBUZihhKXtyZXR1cm57ZXhwaXJhdGlvblRpbWU6YSx0YWc6MCxwYXlsb2FkOm51bGwsY2FsbGJhY2s6bnVsbCxuZXh0Om51bGwsbmV4dEVmZmVjdDpudWxsfX1mdW5jdGlvbiBVZihhLGIpe251bGw9PT1hLmxhc3RVcGRhdGU/YS5maXJzdFVwZGF0ZT1hLmxhc3RVcGRhdGU9YjooYS5sYXN0VXBkYXRlLm5leHQ9YixhLmxhc3RVcGRhdGU9Yil9XG5mdW5jdGlvbiBWZihhLGIpe3ZhciBjPWEuYWx0ZXJuYXRlO2lmKG51bGw9PT1jKXt2YXIgZD1hLnVwZGF0ZVF1ZXVlO3ZhciBlPW51bGw7bnVsbD09PWQmJihkPWEudXBkYXRlUXVldWU9UmYoYS5tZW1vaXplZFN0YXRlKSl9ZWxzZSBkPWEudXBkYXRlUXVldWUsZT1jLnVwZGF0ZVF1ZXVlLG51bGw9PT1kP251bGw9PT1lPyhkPWEudXBkYXRlUXVldWU9UmYoYS5tZW1vaXplZFN0YXRlKSxlPWMudXBkYXRlUXVldWU9UmYoYy5tZW1vaXplZFN0YXRlKSk6ZD1hLnVwZGF0ZVF1ZXVlPVNmKGUpOm51bGw9PT1lJiYoZT1jLnVwZGF0ZVF1ZXVlPVNmKGQpKTtudWxsPT09ZXx8ZD09PWU/VWYoZCxiKTpudWxsPT09ZC5sYXN0VXBkYXRlfHxudWxsPT09ZS5sYXN0VXBkYXRlPyhVZihkLGIpLFVmKGUsYikpOihVZihkLGIpLGUubGFzdFVwZGF0ZT1iKX1cbmZ1bmN0aW9uIFdmKGEsYil7dmFyIGM9YS51cGRhdGVRdWV1ZTtjPW51bGw9PT1jP2EudXBkYXRlUXVldWU9UmYoYS5tZW1vaXplZFN0YXRlKTpYZihhLGMpO251bGw9PT1jLmxhc3RDYXB0dXJlZFVwZGF0ZT9jLmZpcnN0Q2FwdHVyZWRVcGRhdGU9Yy5sYXN0Q2FwdHVyZWRVcGRhdGU9YjooYy5sYXN0Q2FwdHVyZWRVcGRhdGUubmV4dD1iLGMubGFzdENhcHR1cmVkVXBkYXRlPWIpfWZ1bmN0aW9uIFhmKGEsYil7dmFyIGM9YS5hbHRlcm5hdGU7bnVsbCE9PWMmJmI9PT1jLnVwZGF0ZVF1ZXVlJiYoYj1hLnVwZGF0ZVF1ZXVlPVNmKGIpKTtyZXR1cm4gYn1cbmZ1bmN0aW9uIFlmKGEsYixjLGQsZSxmKXtzd2l0Y2goYy50YWcpe2Nhc2UgMTpyZXR1cm4gYT1jLnBheWxvYWQsXCJmdW5jdGlvblwiPT09dHlwZW9mIGE/YS5jYWxsKGYsZCxlKTphO2Nhc2UgMzphLmVmZmVjdFRhZz1hLmVmZmVjdFRhZyYtMTAyNXw2NDtjYXNlIDA6YT1jLnBheWxvYWQ7ZT1cImZ1bmN0aW9uXCI9PT10eXBlb2YgYT9hLmNhbGwoZixkLGUpOmE7aWYobnVsbD09PWV8fHZvaWQgMD09PWUpYnJlYWs7cmV0dXJuIG4oe30sZCxlKTtjYXNlIDI6UWY9ITB9cmV0dXJuIGR9XG5mdW5jdGlvbiBaZihhLGIsYyxkLGUpe1FmPSExO2I9WGYoYSxiKTtmb3IodmFyIGY9Yi5iYXNlU3RhdGUsZz1udWxsLGg9MCxrPWIuZmlyc3RVcGRhdGUsbD1mO251bGwhPT1rOyl7dmFyIG09ay5leHBpcmF0aW9uVGltZTtpZihtPmUpe2lmKG51bGw9PT1nJiYoZz1rLGY9bCksMD09PWh8fGg+bSloPW19ZWxzZSBsPVlmKGEsYixrLGwsYyxkKSxudWxsIT09ay5jYWxsYmFjayYmKGEuZWZmZWN0VGFnfD0zMixrLm5leHRFZmZlY3Q9bnVsbCxudWxsPT09Yi5sYXN0RWZmZWN0P2IuZmlyc3RFZmZlY3Q9Yi5sYXN0RWZmZWN0PWs6KGIubGFzdEVmZmVjdC5uZXh0RWZmZWN0PWssYi5sYXN0RWZmZWN0PWspKTtrPWsubmV4dH1tPW51bGw7Zm9yKGs9Yi5maXJzdENhcHR1cmVkVXBkYXRlO251bGwhPT1rOyl7dmFyIHA9ay5leHBpcmF0aW9uVGltZTtpZihwPmUpe2lmKG51bGw9PT1tJiYobT1rLG51bGw9PT1nJiYoZj1sKSksMD09PWh8fGg+cCloPXB9ZWxzZSBsPVlmKGEsYixrLGwsYyxkKSxcbm51bGwhPT1rLmNhbGxiYWNrJiYoYS5lZmZlY3RUYWd8PTMyLGsubmV4dEVmZmVjdD1udWxsLG51bGw9PT1iLmxhc3RDYXB0dXJlZEVmZmVjdD9iLmZpcnN0Q2FwdHVyZWRFZmZlY3Q9Yi5sYXN0Q2FwdHVyZWRFZmZlY3Q9azooYi5sYXN0Q2FwdHVyZWRFZmZlY3QubmV4dEVmZmVjdD1rLGIubGFzdENhcHR1cmVkRWZmZWN0PWspKTtrPWsubmV4dH1udWxsPT09ZyYmKGIubGFzdFVwZGF0ZT1udWxsKTtudWxsPT09bT9iLmxhc3RDYXB0dXJlZFVwZGF0ZT1udWxsOmEuZWZmZWN0VGFnfD0zMjtudWxsPT09ZyYmbnVsbD09PW0mJihmPWwpO2IuYmFzZVN0YXRlPWY7Yi5maXJzdFVwZGF0ZT1nO2IuZmlyc3RDYXB0dXJlZFVwZGF0ZT1tO2EuZXhwaXJhdGlvblRpbWU9aDthLm1lbW9pemVkU3RhdGU9bH1cbmZ1bmN0aW9uICRmKGEsYixjKXtudWxsIT09Yi5maXJzdENhcHR1cmVkVXBkYXRlJiYobnVsbCE9PWIubGFzdFVwZGF0ZSYmKGIubGFzdFVwZGF0ZS5uZXh0PWIuZmlyc3RDYXB0dXJlZFVwZGF0ZSxiLmxhc3RVcGRhdGU9Yi5sYXN0Q2FwdHVyZWRVcGRhdGUpLGIuZmlyc3RDYXB0dXJlZFVwZGF0ZT1iLmxhc3RDYXB0dXJlZFVwZGF0ZT1udWxsKTthZyhiLmZpcnN0RWZmZWN0LGMpO2IuZmlyc3RFZmZlY3Q9Yi5sYXN0RWZmZWN0PW51bGw7YWcoYi5maXJzdENhcHR1cmVkRWZmZWN0LGMpO2IuZmlyc3RDYXB0dXJlZEVmZmVjdD1iLmxhc3RDYXB0dXJlZEVmZmVjdD1udWxsfWZ1bmN0aW9uIGFnKGEsYil7Zm9yKDtudWxsIT09YTspe3ZhciBjPWEuY2FsbGJhY2s7aWYobnVsbCE9PWMpe2EuY2FsbGJhY2s9bnVsbDt2YXIgZD1iO1wiZnVuY3Rpb25cIiE9PXR5cGVvZiBjP3IoXCIxOTFcIixjKTp2b2lkIDA7Yy5jYWxsKGQpfWE9YS5uZXh0RWZmZWN0fX1cbmZ1bmN0aW9uIGJnKGEsYil7cmV0dXJue3ZhbHVlOmEsc291cmNlOmIsc3RhY2s6QmMoYil9fXZhciBjZz17Y3VycmVudDpudWxsfSxkZz1udWxsLGVnPW51bGwsZmc9bnVsbDtmdW5jdGlvbiBnZyhhLGIpe3ZhciBjPWEudHlwZS5fY29udGV4dDtKKGNnLGMuX2N1cnJlbnRWYWx1ZSxhKTtjLl9jdXJyZW50VmFsdWU9Yn1mdW5jdGlvbiBoZyhhKXt2YXIgYj1jZy5jdXJyZW50O0koY2csYSk7YS50eXBlLl9jb250ZXh0Ll9jdXJyZW50VmFsdWU9Yn1mdW5jdGlvbiBpZyhhKXtkZz1hO2ZnPWVnPW51bGw7YS5maXJzdENvbnRleHREZXBlbmRlbmN5PW51bGx9XG5mdW5jdGlvbiBqZyhhLGIpe2lmKGZnIT09YSYmITEhPT1iJiYwIT09Yil7aWYoXCJudW1iZXJcIiE9PXR5cGVvZiBifHwxMDczNzQxODIzPT09YilmZz1hLGI9MTA3Mzc0MTgyMztiPXtjb250ZXh0OmEsb2JzZXJ2ZWRCaXRzOmIsbmV4dDpudWxsfTtudWxsPT09ZWc/KG51bGw9PT1kZz9yKFwiMjkzXCIpOnZvaWQgMCxkZy5maXJzdENvbnRleHREZXBlbmRlbmN5PWVnPWIpOmVnPWVnLm5leHQ9Yn1yZXR1cm4gYS5fY3VycmVudFZhbHVlfXZhciBrZz17fSxPPXtjdXJyZW50OmtnfSxsZz17Y3VycmVudDprZ30sbWc9e2N1cnJlbnQ6a2d9O2Z1bmN0aW9uIG5nKGEpe2E9PT1rZz9yKFwiMTc0XCIpOnZvaWQgMDtyZXR1cm4gYX1cbmZ1bmN0aW9uIG9nKGEsYil7SihtZyxiLGEpO0oobGcsYSxhKTtKKE8sa2csYSk7dmFyIGM9Yi5ub2RlVHlwZTtzd2l0Y2goYyl7Y2FzZSA5OmNhc2UgMTE6Yj0oYj1iLmRvY3VtZW50RWxlbWVudCk/Yi5uYW1lc3BhY2VVUkk6VWUobnVsbCxcIlwiKTticmVhaztkZWZhdWx0OmM9OD09PWM/Yi5wYXJlbnROb2RlOmIsYj1jLm5hbWVzcGFjZVVSSXx8bnVsbCxjPWMudGFnTmFtZSxiPVVlKGIsYyl9SShPLGEpO0ooTyxiLGEpfWZ1bmN0aW9uIHBnKGEpe0koTyxhKTtJKGxnLGEpO0kobWcsYSl9ZnVuY3Rpb24gcWcoYSl7bmcobWcuY3VycmVudCk7dmFyIGI9bmcoTy5jdXJyZW50KTt2YXIgYz1VZShiLGEudHlwZSk7YiE9PWMmJihKKGxnLGEsYSksSihPLGMsYSkpfWZ1bmN0aW9uIHJnKGEpe2xnLmN1cnJlbnQ9PT1hJiYoSShPLGEpLEkobGcsYSkpfXZhciBzZz1rYy5SZWFjdEN1cnJlbnRPd25lcix0Zz0obmV3IGFhLkNvbXBvbmVudCkucmVmcztcbmZ1bmN0aW9uIHVnKGEsYixjLGQpe2I9YS5tZW1vaXplZFN0YXRlO2M9YyhkLGIpO2M9bnVsbD09PWN8fHZvaWQgMD09PWM/YjpuKHt9LGIsYyk7YS5tZW1vaXplZFN0YXRlPWM7ZD1hLnVwZGF0ZVF1ZXVlO251bGwhPT1kJiYwPT09YS5leHBpcmF0aW9uVGltZSYmKGQuYmFzZVN0YXRlPWMpfVxudmFyIHlnPXtpc01vdW50ZWQ6ZnVuY3Rpb24oYSl7cmV0dXJuKGE9YS5fcmVhY3RJbnRlcm5hbEZpYmVyKT8yPT09R2QoYSk6ITF9LGVucXVldWVTZXRTdGF0ZTpmdW5jdGlvbihhLGIsYyl7YT1hLl9yZWFjdEludGVybmFsRmliZXI7dmFyIGQ9dmcoKTtkPXdnKGQsYSk7dmFyIGU9VGYoZCk7ZS5wYXlsb2FkPWI7dm9pZCAwIT09YyYmbnVsbCE9PWMmJihlLmNhbGxiYWNrPWMpO1ZmKGEsZSk7eGcoYSxkKX0sZW5xdWV1ZVJlcGxhY2VTdGF0ZTpmdW5jdGlvbihhLGIsYyl7YT1hLl9yZWFjdEludGVybmFsRmliZXI7dmFyIGQ9dmcoKTtkPXdnKGQsYSk7dmFyIGU9VGYoZCk7ZS50YWc9MTtlLnBheWxvYWQ9Yjt2b2lkIDAhPT1jJiZudWxsIT09YyYmKGUuY2FsbGJhY2s9Yyk7VmYoYSxlKTt4ZyhhLGQpfSxlbnF1ZXVlRm9yY2VVcGRhdGU6ZnVuY3Rpb24oYSxiKXthPWEuX3JlYWN0SW50ZXJuYWxGaWJlcjt2YXIgYz12ZygpO2M9d2coYyxhKTt2YXIgZD1UZihjKTtkLnRhZz0yO3ZvaWQgMCE9PVxuYiYmbnVsbCE9PWImJihkLmNhbGxiYWNrPWIpO1ZmKGEsZCk7eGcoYSxjKX19O2Z1bmN0aW9uIHpnKGEsYixjLGQsZSxmLGcpe2E9YS5zdGF0ZU5vZGU7cmV0dXJuXCJmdW5jdGlvblwiPT09dHlwZW9mIGEuc2hvdWxkQ29tcG9uZW50VXBkYXRlP2Euc2hvdWxkQ29tcG9uZW50VXBkYXRlKGQsZixnKTpiLnByb3RvdHlwZSYmYi5wcm90b3R5cGUuaXNQdXJlUmVhY3RDb21wb25lbnQ/IUZkKGMsZCl8fCFGZChlLGYpOiEwfVxuZnVuY3Rpb24gQWcoYSxiLGMpe3ZhciBkPSExLGU9cWY7dmFyIGY9Yi5jb250ZXh0VHlwZTtcIm9iamVjdFwiPT09dHlwZW9mIGYmJm51bGwhPT1mP2Y9c2cuY3VycmVudERpc3BhdGNoZXIucmVhZENvbnRleHQoZik6KGU9TShiKT9yZjpLLmN1cnJlbnQsZD1iLmNvbnRleHRUeXBlcyxmPShkPW51bGwhPT1kJiZ2b2lkIDAhPT1kKT9zZihhLGUpOnFmKTtiPW5ldyBiKGMsZik7YS5tZW1vaXplZFN0YXRlPW51bGwhPT1iLnN0YXRlJiZ2b2lkIDAhPT1iLnN0YXRlP2Iuc3RhdGU6bnVsbDtiLnVwZGF0ZXI9eWc7YS5zdGF0ZU5vZGU9YjtiLl9yZWFjdEludGVybmFsRmliZXI9YTtkJiYoYT1hLnN0YXRlTm9kZSxhLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkVW5tYXNrZWRDaGlsZENvbnRleHQ9ZSxhLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkTWFza2VkQ2hpbGRDb250ZXh0PWYpO3JldHVybiBifVxuZnVuY3Rpb24gQmcoYSxiLGMsZCl7YT1iLnN0YXRlO1wiZnVuY3Rpb25cIj09PXR5cGVvZiBiLmNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMmJmIuY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhjLGQpO1wiZnVuY3Rpb25cIj09PXR5cGVvZiBiLlVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzJiZiLlVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKGMsZCk7Yi5zdGF0ZSE9PWEmJnlnLmVucXVldWVSZXBsYWNlU3RhdGUoYixiLnN0YXRlLG51bGwpfVxuZnVuY3Rpb24gQ2coYSxiLGMsZCl7dmFyIGU9YS5zdGF0ZU5vZGU7ZS5wcm9wcz1jO2Uuc3RhdGU9YS5tZW1vaXplZFN0YXRlO2UucmVmcz10Zzt2YXIgZj1iLmNvbnRleHRUeXBlO1wib2JqZWN0XCI9PT10eXBlb2YgZiYmbnVsbCE9PWY/ZS5jb250ZXh0PXNnLmN1cnJlbnREaXNwYXRjaGVyLnJlYWRDb250ZXh0KGYpOihmPU0oYik/cmY6Sy5jdXJyZW50LGUuY29udGV4dD1zZihhLGYpKTtmPWEudXBkYXRlUXVldWU7bnVsbCE9PWYmJihaZihhLGYsYyxlLGQpLGUuc3RhdGU9YS5tZW1vaXplZFN0YXRlKTtmPWIuZ2V0RGVyaXZlZFN0YXRlRnJvbVByb3BzO1wiZnVuY3Rpb25cIj09PXR5cGVvZiBmJiYodWcoYSxiLGYsYyksZS5zdGF0ZT1hLm1lbW9pemVkU3RhdGUpO1wiZnVuY3Rpb25cIj09PXR5cGVvZiBiLmdldERlcml2ZWRTdGF0ZUZyb21Qcm9wc3x8XCJmdW5jdGlvblwiPT09dHlwZW9mIGUuZ2V0U25hcHNob3RCZWZvcmVVcGRhdGV8fFwiZnVuY3Rpb25cIiE9PXR5cGVvZiBlLlVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQmJlxuXCJmdW5jdGlvblwiIT09dHlwZW9mIGUuY29tcG9uZW50V2lsbE1vdW50fHwoYj1lLnN0YXRlLFwiZnVuY3Rpb25cIj09PXR5cGVvZiBlLmNvbXBvbmVudFdpbGxNb3VudCYmZS5jb21wb25lbnRXaWxsTW91bnQoKSxcImZ1bmN0aW9uXCI9PT10eXBlb2YgZS5VTlNBRkVfY29tcG9uZW50V2lsbE1vdW50JiZlLlVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQoKSxiIT09ZS5zdGF0ZSYmeWcuZW5xdWV1ZVJlcGxhY2VTdGF0ZShlLGUuc3RhdGUsbnVsbCksZj1hLnVwZGF0ZVF1ZXVlLG51bGwhPT1mJiYoWmYoYSxmLGMsZSxkKSxlLnN0YXRlPWEubWVtb2l6ZWRTdGF0ZSkpO1wiZnVuY3Rpb25cIj09PXR5cGVvZiBlLmNvbXBvbmVudERpZE1vdW50JiYoYS5lZmZlY3RUYWd8PTQpfXZhciBEZz1BcnJheS5pc0FycmF5O1xuZnVuY3Rpb24gRWcoYSxiLGMpe2E9Yy5yZWY7aWYobnVsbCE9PWEmJlwiZnVuY3Rpb25cIiE9PXR5cGVvZiBhJiZcIm9iamVjdFwiIT09dHlwZW9mIGEpe2lmKGMuX293bmVyKXtjPWMuX293bmVyO3ZhciBkPXZvaWQgMDtjJiYoMSE9PWMudGFnP3IoXCIyODlcIik6dm9pZCAwLGQ9Yy5zdGF0ZU5vZGUpO2Q/dm9pZCAwOnIoXCIxNDdcIixhKTt2YXIgZT1cIlwiK2E7aWYobnVsbCE9PWImJm51bGwhPT1iLnJlZiYmXCJmdW5jdGlvblwiPT09dHlwZW9mIGIucmVmJiZiLnJlZi5fc3RyaW5nUmVmPT09ZSlyZXR1cm4gYi5yZWY7Yj1mdW5jdGlvbihhKXt2YXIgYj1kLnJlZnM7Yj09PXRnJiYoYj1kLnJlZnM9e30pO251bGw9PT1hP2RlbGV0ZSBiW2VdOmJbZV09YX07Yi5fc3RyaW5nUmVmPWU7cmV0dXJuIGJ9XCJzdHJpbmdcIiE9PXR5cGVvZiBhP3IoXCIyODRcIik6dm9pZCAwO2MuX293bmVyP3ZvaWQgMDpyKFwiMjkwXCIsYSl9cmV0dXJuIGF9XG5mdW5jdGlvbiBGZyhhLGIpe1widGV4dGFyZWFcIiE9PWEudHlwZSYmcihcIjMxXCIsXCJbb2JqZWN0IE9iamVjdF1cIj09PU9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChiKT9cIm9iamVjdCB3aXRoIGtleXMge1wiK09iamVjdC5rZXlzKGIpLmpvaW4oXCIsIFwiKStcIn1cIjpiLFwiXCIpfVxuZnVuY3Rpb24gR2coYSl7ZnVuY3Rpb24gYihiLGMpe2lmKGEpe3ZhciBkPWIubGFzdEVmZmVjdDtudWxsIT09ZD8oZC5uZXh0RWZmZWN0PWMsYi5sYXN0RWZmZWN0PWMpOmIuZmlyc3RFZmZlY3Q9Yi5sYXN0RWZmZWN0PWM7Yy5uZXh0RWZmZWN0PW51bGw7Yy5lZmZlY3RUYWc9OH19ZnVuY3Rpb24gYyhjLGQpe2lmKCFhKXJldHVybiBudWxsO2Zvcig7bnVsbCE9PWQ7KWIoYyxkKSxkPWQuc2libGluZztyZXR1cm4gbnVsbH1mdW5jdGlvbiBkKGEsYil7Zm9yKGE9bmV3IE1hcDtudWxsIT09YjspbnVsbCE9PWIua2V5P2Euc2V0KGIua2V5LGIpOmEuc2V0KGIuaW5kZXgsYiksYj1iLnNpYmxpbmc7cmV0dXJuIGF9ZnVuY3Rpb24gZShhLGIsYyl7YT1HZihhLGIsYyk7YS5pbmRleD0wO2Euc2libGluZz1udWxsO3JldHVybiBhfWZ1bmN0aW9uIGYoYixjLGQpe2IuaW5kZXg9ZDtpZighYSlyZXR1cm4gYztkPWIuYWx0ZXJuYXRlO2lmKG51bGwhPT1kKXJldHVybiBkPWQuaW5kZXgsZDxjPyhiLmVmZmVjdFRhZz1cbjIsYyk6ZDtiLmVmZmVjdFRhZz0yO3JldHVybiBjfWZ1bmN0aW9uIGcoYil7YSYmbnVsbD09PWIuYWx0ZXJuYXRlJiYoYi5lZmZlY3RUYWc9Mik7cmV0dXJuIGJ9ZnVuY3Rpb24gaChhLGIsYyxkKXtpZihudWxsPT09Ynx8NiE9PWIudGFnKXJldHVybiBiPUtmKGMsYS5tb2RlLGQpLGIucmV0dXJuPWEsYjtiPWUoYixjLGQpO2IucmV0dXJuPWE7cmV0dXJuIGJ9ZnVuY3Rpb24gayhhLGIsYyxkKXtpZihudWxsIT09YiYmYi5lbGVtZW50VHlwZT09PWMudHlwZSlyZXR1cm4gZD1lKGIsYy5wcm9wcyxkKSxkLnJlZj1FZyhhLGIsYyksZC5yZXR1cm49YSxkO2Q9SGYoYy50eXBlLGMua2V5LGMucHJvcHMsbnVsbCxhLm1vZGUsZCk7ZC5yZWY9RWcoYSxiLGMpO2QucmV0dXJuPWE7cmV0dXJuIGR9ZnVuY3Rpb24gbChhLGIsYyxkKXtpZihudWxsPT09Ynx8NCE9PWIudGFnfHxiLnN0YXRlTm9kZS5jb250YWluZXJJbmZvIT09Yy5jb250YWluZXJJbmZvfHxiLnN0YXRlTm9kZS5pbXBsZW1lbnRhdGlvbiE9PVxuYy5pbXBsZW1lbnRhdGlvbilyZXR1cm4gYj1MZihjLGEubW9kZSxkKSxiLnJldHVybj1hLGI7Yj1lKGIsYy5jaGlsZHJlbnx8W10sZCk7Yi5yZXR1cm49YTtyZXR1cm4gYn1mdW5jdGlvbiBtKGEsYixjLGQsZil7aWYobnVsbD09PWJ8fDchPT1iLnRhZylyZXR1cm4gYj1JZihjLGEubW9kZSxkLGYpLGIucmV0dXJuPWEsYjtiPWUoYixjLGQpO2IucmV0dXJuPWE7cmV0dXJuIGJ9ZnVuY3Rpb24gcChhLGIsYyl7aWYoXCJzdHJpbmdcIj09PXR5cGVvZiBifHxcIm51bWJlclwiPT09dHlwZW9mIGIpcmV0dXJuIGI9S2YoXCJcIitiLGEubW9kZSxjKSxiLnJldHVybj1hLGI7aWYoXCJvYmplY3RcIj09PXR5cGVvZiBiJiZudWxsIT09Yil7c3dpdGNoKGIuJCR0eXBlb2Ype2Nhc2UgbWM6cmV0dXJuIGM9SGYoYi50eXBlLGIua2V5LGIucHJvcHMsbnVsbCxhLm1vZGUsYyksYy5yZWY9RWcoYSxudWxsLGIpLGMucmV0dXJuPWEsYztjYXNlIG5jOnJldHVybiBiPUxmKGIsYS5tb2RlLGMpLGIucmV0dXJuPWEsYn1pZihEZyhiKXx8XG56YyhiKSlyZXR1cm4gYj1JZihiLGEubW9kZSxjLG51bGwpLGIucmV0dXJuPWEsYjtGZyhhLGIpfXJldHVybiBudWxsfWZ1bmN0aW9uIHYoYSxiLGMsZCl7dmFyIGU9bnVsbCE9PWI/Yi5rZXk6bnVsbDtpZihcInN0cmluZ1wiPT09dHlwZW9mIGN8fFwibnVtYmVyXCI9PT10eXBlb2YgYylyZXR1cm4gbnVsbCE9PWU/bnVsbDpoKGEsYixcIlwiK2MsZCk7aWYoXCJvYmplY3RcIj09PXR5cGVvZiBjJiZudWxsIT09Yyl7c3dpdGNoKGMuJCR0eXBlb2Ype2Nhc2UgbWM6cmV0dXJuIGMua2V5PT09ZT9jLnR5cGU9PT1vYz9tKGEsYixjLnByb3BzLmNoaWxkcmVuLGQsZSk6ayhhLGIsYyxkKTpudWxsO2Nhc2UgbmM6cmV0dXJuIGMua2V5PT09ZT9sKGEsYixjLGQpOm51bGx9aWYoRGcoYyl8fHpjKGMpKXJldHVybiBudWxsIT09ZT9udWxsOm0oYSxiLGMsZCxudWxsKTtGZyhhLGMpfXJldHVybiBudWxsfWZ1bmN0aW9uIEIoYSxiLGMsZCxlKXtpZihcInN0cmluZ1wiPT09dHlwZW9mIGR8fFwibnVtYmVyXCI9PT10eXBlb2YgZClyZXR1cm4gYT1cbmEuZ2V0KGMpfHxudWxsLGgoYixhLFwiXCIrZCxlKTtpZihcIm9iamVjdFwiPT09dHlwZW9mIGQmJm51bGwhPT1kKXtzd2l0Y2goZC4kJHR5cGVvZil7Y2FzZSBtYzpyZXR1cm4gYT1hLmdldChudWxsPT09ZC5rZXk/YzpkLmtleSl8fG51bGwsZC50eXBlPT09b2M/bShiLGEsZC5wcm9wcy5jaGlsZHJlbixlLGQua2V5KTprKGIsYSxkLGUpO2Nhc2UgbmM6cmV0dXJuIGE9YS5nZXQobnVsbD09PWQua2V5P2M6ZC5rZXkpfHxudWxsLGwoYixhLGQsZSl9aWYoRGcoZCl8fHpjKGQpKXJldHVybiBhPWEuZ2V0KGMpfHxudWxsLG0oYixhLGQsZSxudWxsKTtGZyhiLGQpfXJldHVybiBudWxsfWZ1bmN0aW9uIHcoZSxnLGgsayl7Zm9yKHZhciBsPW51bGwsbT1udWxsLHE9Zyx1PWc9MCxBPW51bGw7bnVsbCE9PXEmJnU8aC5sZW5ndGg7dSsrKXtxLmluZGV4PnU/KEE9cSxxPW51bGwpOkE9cS5zaWJsaW5nO3ZhciB0PXYoZSxxLGhbdV0sayk7aWYobnVsbD09PXQpe251bGw9PT1xJiYocT1BKTticmVha31hJiZcbnEmJm51bGw9PT10LmFsdGVybmF0ZSYmYihlLHEpO2c9Zih0LGcsdSk7bnVsbD09PW0/bD10Om0uc2libGluZz10O209dDtxPUF9aWYodT09PWgubGVuZ3RoKXJldHVybiBjKGUscSksbDtpZihudWxsPT09cSl7Zm9yKDt1PGgubGVuZ3RoO3UrKylpZihxPXAoZSxoW3VdLGspKWc9ZihxLGcsdSksbnVsbD09PW0/bD1xOm0uc2libGluZz1xLG09cTtyZXR1cm4gbH1mb3IocT1kKGUscSk7dTxoLmxlbmd0aDt1KyspaWYoQT1CKHEsZSx1LGhbdV0saykpYSYmbnVsbCE9PUEuYWx0ZXJuYXRlJiZxLmRlbGV0ZShudWxsPT09QS5rZXk/dTpBLmtleSksZz1mKEEsZyx1KSxudWxsPT09bT9sPUE6bS5zaWJsaW5nPUEsbT1BO2EmJnEuZm9yRWFjaChmdW5jdGlvbihhKXtyZXR1cm4gYihlLGEpfSk7cmV0dXJuIGx9ZnVuY3Rpb24gQyhlLGcsaCxrKXt2YXIgbD16YyhoKTtcImZ1bmN0aW9uXCIhPT10eXBlb2YgbD9yKFwiMTUwXCIpOnZvaWQgMDtoPWwuY2FsbChoKTtudWxsPT1oP3IoXCIxNTFcIik6dm9pZCAwO1xuZm9yKHZhciBtPWw9bnVsbCxxPWcsdT1nPTAsQT1udWxsLHQ9aC5uZXh0KCk7bnVsbCE9PXEmJiF0LmRvbmU7dSsrLHQ9aC5uZXh0KCkpe3EuaW5kZXg+dT8oQT1xLHE9bnVsbCk6QT1xLnNpYmxpbmc7dmFyIHc9dihlLHEsdC52YWx1ZSxrKTtpZihudWxsPT09dyl7cXx8KHE9QSk7YnJlYWt9YSYmcSYmbnVsbD09PXcuYWx0ZXJuYXRlJiZiKGUscSk7Zz1mKHcsZyx1KTtudWxsPT09bT9sPXc6bS5zaWJsaW5nPXc7bT13O3E9QX1pZih0LmRvbmUpcmV0dXJuIGMoZSxxKSxsO2lmKG51bGw9PT1xKXtmb3IoOyF0LmRvbmU7dSsrLHQ9aC5uZXh0KCkpdD1wKGUsdC52YWx1ZSxrKSxudWxsIT09dCYmKGc9Zih0LGcsdSksbnVsbD09PW0/bD10Om0uc2libGluZz10LG09dCk7cmV0dXJuIGx9Zm9yKHE9ZChlLHEpOyF0LmRvbmU7dSsrLHQ9aC5uZXh0KCkpdD1CKHEsZSx1LHQudmFsdWUsayksbnVsbCE9PXQmJihhJiZudWxsIT09dC5hbHRlcm5hdGUmJnEuZGVsZXRlKG51bGw9PT10LmtleT91OlxudC5rZXkpLGc9Zih0LGcsdSksbnVsbD09PW0/bD10Om0uc2libGluZz10LG09dCk7YSYmcS5mb3JFYWNoKGZ1bmN0aW9uKGEpe3JldHVybiBiKGUsYSl9KTtyZXR1cm4gbH1yZXR1cm4gZnVuY3Rpb24oYSxkLGYsaCl7dmFyIGs9XCJvYmplY3RcIj09PXR5cGVvZiBmJiZudWxsIT09ZiYmZi50eXBlPT09b2MmJm51bGw9PT1mLmtleTtrJiYoZj1mLnByb3BzLmNoaWxkcmVuKTt2YXIgbD1cIm9iamVjdFwiPT09dHlwZW9mIGYmJm51bGwhPT1mO2lmKGwpc3dpdGNoKGYuJCR0eXBlb2Ype2Nhc2UgbWM6YTp7bD1mLmtleTtmb3Ioaz1kO251bGwhPT1rOyl7aWYoay5rZXk9PT1sKWlmKDc9PT1rLnRhZz9mLnR5cGU9PT1vYzprLmVsZW1lbnRUeXBlPT09Zi50eXBlKXtjKGEsay5zaWJsaW5nKTtkPWUoayxmLnR5cGU9PT1vYz9mLnByb3BzLmNoaWxkcmVuOmYucHJvcHMsaCk7ZC5yZWY9RWcoYSxrLGYpO2QucmV0dXJuPWE7YT1kO2JyZWFrIGF9ZWxzZXtjKGEsayk7YnJlYWt9ZWxzZSBiKGEsayk7az1cbmsuc2libGluZ31mLnR5cGU9PT1vYz8oZD1JZihmLnByb3BzLmNoaWxkcmVuLGEubW9kZSxoLGYua2V5KSxkLnJldHVybj1hLGE9ZCk6KGg9SGYoZi50eXBlLGYua2V5LGYucHJvcHMsbnVsbCxhLm1vZGUsaCksaC5yZWY9RWcoYSxkLGYpLGgucmV0dXJuPWEsYT1oKX1yZXR1cm4gZyhhKTtjYXNlIG5jOmE6e2ZvcihrPWYua2V5O251bGwhPT1kOyl7aWYoZC5rZXk9PT1rKWlmKDQ9PT1kLnRhZyYmZC5zdGF0ZU5vZGUuY29udGFpbmVySW5mbz09PWYuY29udGFpbmVySW5mbyYmZC5zdGF0ZU5vZGUuaW1wbGVtZW50YXRpb249PT1mLmltcGxlbWVudGF0aW9uKXtjKGEsZC5zaWJsaW5nKTtkPWUoZCxmLmNoaWxkcmVufHxbXSxoKTtkLnJldHVybj1hO2E9ZDticmVhayBhfWVsc2V7YyhhLGQpO2JyZWFrfWVsc2UgYihhLGQpO2Q9ZC5zaWJsaW5nfWQ9TGYoZixhLm1vZGUsaCk7ZC5yZXR1cm49YTthPWR9cmV0dXJuIGcoYSl9aWYoXCJzdHJpbmdcIj09PXR5cGVvZiBmfHxcIm51bWJlclwiPT09dHlwZW9mIGYpcmV0dXJuIGY9XG5cIlwiK2YsbnVsbCE9PWQmJjY9PT1kLnRhZz8oYyhhLGQuc2libGluZyksZD1lKGQsZixoKSxkLnJldHVybj1hLGE9ZCk6KGMoYSxkKSxkPUtmKGYsYS5tb2RlLGgpLGQucmV0dXJuPWEsYT1kKSxnKGEpO2lmKERnKGYpKXJldHVybiB3KGEsZCxmLGgpO2lmKHpjKGYpKXJldHVybiBDKGEsZCxmLGgpO2wmJkZnKGEsZik7aWYoXCJ1bmRlZmluZWRcIj09PXR5cGVvZiBmJiYhaylzd2l0Y2goYS50YWcpe2Nhc2UgMTpjYXNlIDA6aD1hLnR5cGUscihcIjE1MlwiLGguZGlzcGxheU5hbWV8fGgubmFtZXx8XCJDb21wb25lbnRcIil9cmV0dXJuIGMoYSxkKX19dmFyIEhnPUdnKCEwKSxJZz1HZyghMSksSmc9bnVsbCxLZz1udWxsLExnPSExO1xuZnVuY3Rpb24gTWcoYSxiKXt2YXIgYz1OKDUsbnVsbCxudWxsLDApO2MuZWxlbWVudFR5cGU9XCJERUxFVEVEXCI7Yy50eXBlPVwiREVMRVRFRFwiO2Muc3RhdGVOb2RlPWI7Yy5yZXR1cm49YTtjLmVmZmVjdFRhZz04O251bGwhPT1hLmxhc3RFZmZlY3Q/KGEubGFzdEVmZmVjdC5uZXh0RWZmZWN0PWMsYS5sYXN0RWZmZWN0PWMpOmEuZmlyc3RFZmZlY3Q9YS5sYXN0RWZmZWN0PWN9ZnVuY3Rpb24gTmcoYSxiKXtzd2l0Y2goYS50YWcpe2Nhc2UgNTp2YXIgYz1hLnR5cGU7Yj0xIT09Yi5ub2RlVHlwZXx8Yy50b0xvd2VyQ2FzZSgpIT09Yi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpP251bGw6YjtyZXR1cm4gbnVsbCE9PWI/KGEuc3RhdGVOb2RlPWIsITApOiExO2Nhc2UgNjpyZXR1cm4gYj1cIlwiPT09YS5wZW5kaW5nUHJvcHN8fDMhPT1iLm5vZGVUeXBlP251bGw6YixudWxsIT09Yj8oYS5zdGF0ZU5vZGU9YiwhMCk6ITE7ZGVmYXVsdDpyZXR1cm4hMX19XG5mdW5jdGlvbiBPZyhhKXtpZihMZyl7dmFyIGI9S2c7aWYoYil7dmFyIGM9YjtpZighTmcoYSxiKSl7Yj1tZihjKTtpZighYnx8IU5nKGEsYikpe2EuZWZmZWN0VGFnfD0yO0xnPSExO0pnPWE7cmV0dXJufU1nKEpnLGMpfUpnPWE7S2c9bmYoYil9ZWxzZSBhLmVmZmVjdFRhZ3w9MixMZz0hMSxKZz1hfX1mdW5jdGlvbiBQZyhhKXtmb3IoYT1hLnJldHVybjtudWxsIT09YSYmNSE9PWEudGFnJiYzIT09YS50YWc7KWE9YS5yZXR1cm47Smc9YX1mdW5jdGlvbiBRZyhhKXtpZihhIT09SmcpcmV0dXJuITE7aWYoIUxnKXJldHVybiBQZyhhKSxMZz0hMCwhMTt2YXIgYj1hLnR5cGU7aWYoNSE9PWEudGFnfHxcImhlYWRcIiE9PWImJlwiYm9keVwiIT09YiYmIWpmKGIsYS5tZW1vaXplZFByb3BzKSlmb3IoYj1LZztiOylNZyhhLGIpLGI9bWYoYik7UGcoYSk7S2c9Smc/bWYoYS5zdGF0ZU5vZGUpOm51bGw7cmV0dXJuITB9ZnVuY3Rpb24gUmcoKXtLZz1KZz1udWxsO0xnPSExfVxuZnVuY3Rpb24gU2coYSl7dmFyIGI9YS5fcmVzdWx0O3N3aXRjaChhLl9zdGF0dXMpe2Nhc2UgMTpyZXR1cm4gYjtjYXNlIDI6dGhyb3cgYjtjYXNlIDA6dGhyb3cgYjtkZWZhdWx0OnRocm93IGEuX3N0YXR1cz0wLGI9YS5fY3RvcixiPWIoKSxiLnRoZW4oZnVuY3Rpb24oYil7MD09PWEuX3N0YXR1cyYmKGI9Yi5kZWZhdWx0LGEuX3N0YXR1cz0xLGEuX3Jlc3VsdD1iKX0sZnVuY3Rpb24oYil7MD09PWEuX3N0YXR1cyYmKGEuX3N0YXR1cz0yLGEuX3Jlc3VsdD1iKX0pLGEuX3Jlc3VsdD1iLGI7fX12YXIgVGc9a2MuUmVhY3RDdXJyZW50T3duZXI7ZnVuY3Rpb24gUChhLGIsYyxkKXtiLmNoaWxkPW51bGw9PT1hP0lnKGIsbnVsbCxjLGQpOkhnKGIsYS5jaGlsZCxjLGQpfVxuZnVuY3Rpb24gVWcoYSxiLGMsZCxlKXtjPWMucmVuZGVyO3ZhciBmPWIucmVmO2lmKCFMLmN1cnJlbnQmJmIubWVtb2l6ZWRQcm9wcz09PWQmJmY9PT0obnVsbCE9PWE/YS5yZWY6bnVsbCkpcmV0dXJuIFZnKGEsYixlKTtkPWMoZCxmKTtQKGEsYixkLGUpO3JldHVybiBiLmNoaWxkfVxuZnVuY3Rpb24gV2coYSxiLGMsZCxlLGYpe2lmKG51bGw9PT1hKXt2YXIgZz1jLnR5cGU7aWYoXCJmdW5jdGlvblwiPT09dHlwZW9mIGcmJiFFZihnKSYmdm9pZCAwPT09Zy5kZWZhdWx0UHJvcHMmJm51bGw9PT1jLmNvbXBhcmUpcmV0dXJuIGIudGFnPTE1LGIudHlwZT1nLFhnKGEsYixnLGQsZSxmKTthPUhmKGMudHlwZSxudWxsLGQsbnVsbCxiLm1vZGUsZik7YS5yZWY9Yi5yZWY7YS5yZXR1cm49YjtyZXR1cm4gYi5jaGlsZD1hfWc9YS5jaGlsZDtpZigwPT09ZXx8ZT5mKWlmKGU9Zy5tZW1vaXplZFByb3BzLGM9Yy5jb21wYXJlLGM9bnVsbCE9PWM/YzpGZCxjKGUsZCkmJmEucmVmPT09Yi5yZWYpcmV0dXJuIFZnKGEsYixmKTthPUdmKGcsZCxmKTthLnJlZj1iLnJlZjthLnJldHVybj1iO3JldHVybiBiLmNoaWxkPWF9XG5mdW5jdGlvbiBYZyhhLGIsYyxkLGUsZil7cmV0dXJuIG51bGwhPT1hJiYoMD09PWV8fGU+ZikmJkZkKGEubWVtb2l6ZWRQcm9wcyxkKSYmYS5yZWY9PT1iLnJlZj9WZyhhLGIsZik6WWcoYSxiLGMsZCxmKX1mdW5jdGlvbiBaZyhhLGIpe3ZhciBjPWIucmVmO2lmKG51bGw9PT1hJiZudWxsIT09Y3x8bnVsbCE9PWEmJmEucmVmIT09YyliLmVmZmVjdFRhZ3w9MTI4fWZ1bmN0aW9uIFlnKGEsYixjLGQsZSl7dmFyIGY9TShjKT9yZjpLLmN1cnJlbnQ7Zj1zZihiLGYpO2lnKGIsZSk7Yz1jKGQsZik7Yi5lZmZlY3RUYWd8PTE7UChhLGIsYyxlKTtyZXR1cm4gYi5jaGlsZH1cbmZ1bmN0aW9uICRnKGEsYixjLGQsZSl7aWYoTShjKSl7dmFyIGY9ITA7eGYoYil9ZWxzZSBmPSExO2lnKGIsZSk7aWYobnVsbD09PWIuc3RhdGVOb2RlKW51bGwhPT1hJiYoYS5hbHRlcm5hdGU9bnVsbCxiLmFsdGVybmF0ZT1udWxsLGIuZWZmZWN0VGFnfD0yKSxBZyhiLGMsZCxlKSxDZyhiLGMsZCxlKSxkPSEwO2Vsc2UgaWYobnVsbD09PWEpe3ZhciBnPWIuc3RhdGVOb2RlLGg9Yi5tZW1vaXplZFByb3BzO2cucHJvcHM9aDt2YXIgaz1nLmNvbnRleHQsbD1jLmNvbnRleHRUeXBlO1wib2JqZWN0XCI9PT10eXBlb2YgbCYmbnVsbCE9PWw/bD1zZy5jdXJyZW50RGlzcGF0Y2hlci5yZWFkQ29udGV4dChsKToobD1NKGMpP3JmOksuY3VycmVudCxsPXNmKGIsbCkpO3ZhciBtPWMuZ2V0RGVyaXZlZFN0YXRlRnJvbVByb3BzLHA9XCJmdW5jdGlvblwiPT09dHlwZW9mIG18fFwiZnVuY3Rpb25cIj09PXR5cGVvZiBnLmdldFNuYXBzaG90QmVmb3JlVXBkYXRlO3B8fFwiZnVuY3Rpb25cIiE9PXR5cGVvZiBnLlVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzJiZcblwiZnVuY3Rpb25cIiE9PXR5cGVvZiBnLmNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHN8fChoIT09ZHx8ayE9PWwpJiZCZyhiLGcsZCxsKTtRZj0hMTt2YXIgdj1iLm1lbW9pemVkU3RhdGU7az1nLnN0YXRlPXY7dmFyIEI9Yi51cGRhdGVRdWV1ZTtudWxsIT09QiYmKFpmKGIsQixkLGcsZSksaz1iLm1lbW9pemVkU3RhdGUpO2ghPT1kfHx2IT09a3x8TC5jdXJyZW50fHxRZj8oXCJmdW5jdGlvblwiPT09dHlwZW9mIG0mJih1ZyhiLGMsbSxkKSxrPWIubWVtb2l6ZWRTdGF0ZSksKGg9UWZ8fHpnKGIsYyxoLGQsdixrLGwpKT8ocHx8XCJmdW5jdGlvblwiIT09dHlwZW9mIGcuVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudCYmXCJmdW5jdGlvblwiIT09dHlwZW9mIGcuY29tcG9uZW50V2lsbE1vdW50fHwoXCJmdW5jdGlvblwiPT09dHlwZW9mIGcuY29tcG9uZW50V2lsbE1vdW50JiZnLmNvbXBvbmVudFdpbGxNb3VudCgpLFwiZnVuY3Rpb25cIj09PXR5cGVvZiBnLlVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQmJlxuZy5VTlNBRkVfY29tcG9uZW50V2lsbE1vdW50KCkpLFwiZnVuY3Rpb25cIj09PXR5cGVvZiBnLmNvbXBvbmVudERpZE1vdW50JiYoYi5lZmZlY3RUYWd8PTQpKTooXCJmdW5jdGlvblwiPT09dHlwZW9mIGcuY29tcG9uZW50RGlkTW91bnQmJihiLmVmZmVjdFRhZ3w9NCksYi5tZW1vaXplZFByb3BzPWQsYi5tZW1vaXplZFN0YXRlPWspLGcucHJvcHM9ZCxnLnN0YXRlPWssZy5jb250ZXh0PWwsZD1oKTooXCJmdW5jdGlvblwiPT09dHlwZW9mIGcuY29tcG9uZW50RGlkTW91bnQmJihiLmVmZmVjdFRhZ3w9NCksZD0hMSl9ZWxzZSBnPWIuc3RhdGVOb2RlLGg9Yi5tZW1vaXplZFByb3BzLGcucHJvcHM9aCxrPWcuY29udGV4dCxsPWMuY29udGV4dFR5cGUsXCJvYmplY3RcIj09PXR5cGVvZiBsJiZudWxsIT09bD9sPXNnLmN1cnJlbnREaXNwYXRjaGVyLnJlYWRDb250ZXh0KGwpOihsPU0oYyk/cmY6Sy5jdXJyZW50LGw9c2YoYixsKSksbT1jLmdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcywocD1cImZ1bmN0aW9uXCI9PT1cbnR5cGVvZiBtfHxcImZ1bmN0aW9uXCI9PT10eXBlb2YgZy5nZXRTbmFwc2hvdEJlZm9yZVVwZGF0ZSl8fFwiZnVuY3Rpb25cIiE9PXR5cGVvZiBnLlVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzJiZcImZ1bmN0aW9uXCIhPT10eXBlb2YgZy5jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzfHwoaCE9PWR8fGshPT1sKSYmQmcoYixnLGQsbCksUWY9ITEsaz1iLm1lbW9pemVkU3RhdGUsdj1nLnN0YXRlPWssQj1iLnVwZGF0ZVF1ZXVlLG51bGwhPT1CJiYoWmYoYixCLGQsZyxlKSx2PWIubWVtb2l6ZWRTdGF0ZSksaCE9PWR8fGshPT12fHxMLmN1cnJlbnR8fFFmPyhcImZ1bmN0aW9uXCI9PT10eXBlb2YgbSYmKHVnKGIsYyxtLGQpLHY9Yi5tZW1vaXplZFN0YXRlKSwobT1RZnx8emcoYixjLGgsZCxrLHYsbCkpPyhwfHxcImZ1bmN0aW9uXCIhPT10eXBlb2YgZy5VTlNBRkVfY29tcG9uZW50V2lsbFVwZGF0ZSYmXCJmdW5jdGlvblwiIT09dHlwZW9mIGcuY29tcG9uZW50V2lsbFVwZGF0ZXx8KFwiZnVuY3Rpb25cIj09PVxudHlwZW9mIGcuY29tcG9uZW50V2lsbFVwZGF0ZSYmZy5jb21wb25lbnRXaWxsVXBkYXRlKGQsdixsKSxcImZ1bmN0aW9uXCI9PT10eXBlb2YgZy5VTlNBRkVfY29tcG9uZW50V2lsbFVwZGF0ZSYmZy5VTlNBRkVfY29tcG9uZW50V2lsbFVwZGF0ZShkLHYsbCkpLFwiZnVuY3Rpb25cIj09PXR5cGVvZiBnLmNvbXBvbmVudERpZFVwZGF0ZSYmKGIuZWZmZWN0VGFnfD00KSxcImZ1bmN0aW9uXCI9PT10eXBlb2YgZy5nZXRTbmFwc2hvdEJlZm9yZVVwZGF0ZSYmKGIuZWZmZWN0VGFnfD0yNTYpKTooXCJmdW5jdGlvblwiIT09dHlwZW9mIGcuY29tcG9uZW50RGlkVXBkYXRlfHxoPT09YS5tZW1vaXplZFByb3BzJiZrPT09YS5tZW1vaXplZFN0YXRlfHwoYi5lZmZlY3RUYWd8PTQpLFwiZnVuY3Rpb25cIiE9PXR5cGVvZiBnLmdldFNuYXBzaG90QmVmb3JlVXBkYXRlfHxoPT09YS5tZW1vaXplZFByb3BzJiZrPT09YS5tZW1vaXplZFN0YXRlfHwoYi5lZmZlY3RUYWd8PTI1NiksYi5tZW1vaXplZFByb3BzPWQsYi5tZW1vaXplZFN0YXRlPVxudiksZy5wcm9wcz1kLGcuc3RhdGU9dixnLmNvbnRleHQ9bCxkPW0pOihcImZ1bmN0aW9uXCIhPT10eXBlb2YgZy5jb21wb25lbnREaWRVcGRhdGV8fGg9PT1hLm1lbW9pemVkUHJvcHMmJms9PT1hLm1lbW9pemVkU3RhdGV8fChiLmVmZmVjdFRhZ3w9NCksXCJmdW5jdGlvblwiIT09dHlwZW9mIGcuZ2V0U25hcHNob3RCZWZvcmVVcGRhdGV8fGg9PT1hLm1lbW9pemVkUHJvcHMmJms9PT1hLm1lbW9pemVkU3RhdGV8fChiLmVmZmVjdFRhZ3w9MjU2KSxkPSExKTtyZXR1cm4gYWgoYSxiLGMsZCxmLGUpfVxuZnVuY3Rpb24gYWgoYSxiLGMsZCxlLGYpe1pnKGEsYik7dmFyIGc9MCE9PShiLmVmZmVjdFRhZyY2NCk7aWYoIWQmJiFnKXJldHVybiBlJiZ5ZihiLGMsITEpLFZnKGEsYixmKTtkPWIuc3RhdGVOb2RlO1RnLmN1cnJlbnQ9Yjt2YXIgaD1nJiZcImZ1bmN0aW9uXCIhPT10eXBlb2YgYy5nZXREZXJpdmVkU3RhdGVGcm9tRXJyb3I/bnVsbDpkLnJlbmRlcigpO2IuZWZmZWN0VGFnfD0xO251bGwhPT1hJiZnPyhiLmNoaWxkPUhnKGIsYS5jaGlsZCxudWxsLGYpLGIuY2hpbGQ9SGcoYixudWxsLGgsZikpOlAoYSxiLGgsZik7Yi5tZW1vaXplZFN0YXRlPWQuc3RhdGU7ZSYmeWYoYixjLCEwKTtyZXR1cm4gYi5jaGlsZH1mdW5jdGlvbiBiaChhKXt2YXIgYj1hLnN0YXRlTm9kZTtiLnBlbmRpbmdDb250ZXh0P3ZmKGEsYi5wZW5kaW5nQ29udGV4dCxiLnBlbmRpbmdDb250ZXh0IT09Yi5jb250ZXh0KTpiLmNvbnRleHQmJnZmKGEsYi5jb250ZXh0LCExKTtvZyhhLGIuY29udGFpbmVySW5mbyl9XG5mdW5jdGlvbiBjaChhLGIpe2lmKGEmJmEuZGVmYXVsdFByb3BzKXtiPW4oe30sYik7YT1hLmRlZmF1bHRQcm9wcztmb3IodmFyIGMgaW4gYSl2b2lkIDA9PT1iW2NdJiYoYltjXT1hW2NdKX1yZXR1cm4gYn1cbmZ1bmN0aW9uIGRoKGEsYixjKXt2YXIgZD1iLm1vZGUsZT1iLnBlbmRpbmdQcm9wcyxmPWIubWVtb2l6ZWRTdGF0ZTtudWxsIT09ZiYmKGYuYWxyZWFkeUNhcHR1cmVkP251bGwhPT1hJiZmPT09YS5tZW1vaXplZFN0YXRlP2Y9e2FscmVhZHlDYXB0dXJlZDohMCxkaWRUaW1lb3V0OiEwLHRpbWVkT3V0QXQ6Zi50aW1lZE91dEF0fTooZi5hbHJlYWR5Q2FwdHVyZWQ9ITAsZi5kaWRUaW1lb3V0PSEwKTpmPW51bGwpO3ZhciBnPW51bGwhPT1mJiZmLmRpZFRpbWVvdXQ7aWYobnVsbD09PWEpZz8oZz1lLmZhbGxiYWNrLGU9SWYobnVsbCxkLDAsbnVsbCksZD1JZihnLGQsYyxudWxsKSxlLnNpYmxpbmc9ZCxjPWUsYy5yZXR1cm49ZC5yZXR1cm49Yik6Yz1kPUlnKGIsbnVsbCxlLmNoaWxkcmVuLGMpO2Vsc2V7dmFyIGg9YS5tZW1vaXplZFN0YXRlO251bGwhPT1oJiZoLmRpZFRpbWVvdXQ/KGQ9YS5jaGlsZCxhPWQuc2libGluZyxnPyhjPWUuZmFsbGJhY2ssZD1HZihkLGQucGVuZGluZ1Byb3BzLFxuMCksZC5lZmZlY3RUYWd8PTIsZT1kLnNpYmxpbmc9R2YoYSxjLGEuZXhwaXJhdGlvblRpbWUpLGUuZWZmZWN0VGFnfD0yLGM9ZCxkLmNoaWxkRXhwaXJhdGlvblRpbWU9MCxkPWUsYy5yZXR1cm49ZC5yZXR1cm49Yik6KGc9YS5jaGlsZCxkPUhnKGIsZC5jaGlsZCxlLmNoaWxkcmVuLGMpLEhnKGIsZyxudWxsLGMpLGM9ZCkpOihhPWEuY2hpbGQsZz8oZz1lLmZhbGxiYWNrLGU9SWYobnVsbCxkLDAsbnVsbCksZS5lZmZlY3RUYWd8PTIsZS5jaGlsZD1hLGEucmV0dXJuPWUsZD1lLnNpYmxpbmc9SWYoZyxkLGMsbnVsbCksZC5lZmZlY3RUYWd8PTIsYz1lLGUuY2hpbGRFeHBpcmF0aW9uVGltZT0wLGMucmV0dXJuPWQucmV0dXJuPWIpOmQ9Yz1IZyhiLGEsZS5jaGlsZHJlbixjKSl9Yi5tZW1vaXplZFN0YXRlPWY7Yi5jaGlsZD1jO3JldHVybiBkfVxuZnVuY3Rpb24gVmcoYSxiLGMpe251bGwhPT1hJiYoYi5maXJzdENvbnRleHREZXBlbmRlbmN5PWEuZmlyc3RDb250ZXh0RGVwZW5kZW5jeSk7dmFyIGQ9Yi5jaGlsZEV4cGlyYXRpb25UaW1lO2lmKDA9PT1kfHxkPmMpcmV0dXJuIG51bGw7bnVsbCE9PWEmJmIuY2hpbGQhPT1hLmNoaWxkP3IoXCIxNTNcIik6dm9pZCAwO2lmKG51bGwhPT1iLmNoaWxkKXthPWIuY2hpbGQ7Yz1HZihhLGEucGVuZGluZ1Byb3BzLGEuZXhwaXJhdGlvblRpbWUpO2IuY2hpbGQ9Yztmb3IoYy5yZXR1cm49YjtudWxsIT09YS5zaWJsaW5nOylhPWEuc2libGluZyxjPWMuc2libGluZz1HZihhLGEucGVuZGluZ1Byb3BzLGEuZXhwaXJhdGlvblRpbWUpLGMucmV0dXJuPWI7Yy5zaWJsaW5nPW51bGx9cmV0dXJuIGIuY2hpbGR9XG5mdW5jdGlvbiBlaChhLGIsYyl7dmFyIGQ9Yi5leHBpcmF0aW9uVGltZTtpZihudWxsIT09YSYmYS5tZW1vaXplZFByb3BzPT09Yi5wZW5kaW5nUHJvcHMmJiFMLmN1cnJlbnQmJigwPT09ZHx8ZD5jKSl7c3dpdGNoKGIudGFnKXtjYXNlIDM6YmgoYik7UmcoKTticmVhaztjYXNlIDU6cWcoYik7YnJlYWs7Y2FzZSAxOk0oYi50eXBlKSYmeGYoYik7YnJlYWs7Y2FzZSA0Om9nKGIsYi5zdGF0ZU5vZGUuY29udGFpbmVySW5mbyk7YnJlYWs7Y2FzZSAxMDpnZyhiLGIubWVtb2l6ZWRQcm9wcy52YWx1ZSk7YnJlYWs7Y2FzZSAxMzppZihkPWIubWVtb2l6ZWRTdGF0ZSxudWxsIT09ZCYmZC5kaWRUaW1lb3V0KXtkPWIuY2hpbGQuY2hpbGRFeHBpcmF0aW9uVGltZTtpZigwIT09ZCYmZDw9YylyZXR1cm4gZGgoYSxiLGMpO2I9VmcoYSxiLGMpO3JldHVybiBudWxsIT09Yj9iLnNpYmxpbmc6bnVsbH19cmV0dXJuIFZnKGEsYixjKX1iLmV4cGlyYXRpb25UaW1lPTA7c3dpdGNoKGIudGFnKXtjYXNlIDI6ZD1cbmIuZWxlbWVudFR5cGU7bnVsbCE9PWEmJihhLmFsdGVybmF0ZT1udWxsLGIuYWx0ZXJuYXRlPW51bGwsYi5lZmZlY3RUYWd8PTIpO2E9Yi5wZW5kaW5nUHJvcHM7dmFyIGU9c2YoYixLLmN1cnJlbnQpO2lnKGIsYyk7ZT1kKGEsZSk7Yi5lZmZlY3RUYWd8PTE7aWYoXCJvYmplY3RcIj09PXR5cGVvZiBlJiZudWxsIT09ZSYmXCJmdW5jdGlvblwiPT09dHlwZW9mIGUucmVuZGVyJiZ2b2lkIDA9PT1lLiQkdHlwZW9mKXtiLnRhZz0xO2lmKE0oZCkpe3ZhciBmPSEwO3hmKGIpfWVsc2UgZj0hMTtiLm1lbW9pemVkU3RhdGU9bnVsbCE9PWUuc3RhdGUmJnZvaWQgMCE9PWUuc3RhdGU/ZS5zdGF0ZTpudWxsO3ZhciBnPWQuZ2V0RGVyaXZlZFN0YXRlRnJvbVByb3BzO1wiZnVuY3Rpb25cIj09PXR5cGVvZiBnJiZ1ZyhiLGQsZyxhKTtlLnVwZGF0ZXI9eWc7Yi5zdGF0ZU5vZGU9ZTtlLl9yZWFjdEludGVybmFsRmliZXI9YjtDZyhiLGQsYSxjKTtiPWFoKG51bGwsYixkLCEwLGYsYyl9ZWxzZSBiLnRhZz0wLFxuUChudWxsLGIsZSxjKSxiPWIuY2hpbGQ7cmV0dXJuIGI7Y2FzZSAxNjplPWIuZWxlbWVudFR5cGU7bnVsbCE9PWEmJihhLmFsdGVybmF0ZT1udWxsLGIuYWx0ZXJuYXRlPW51bGwsYi5lZmZlY3RUYWd8PTIpO2Y9Yi5wZW5kaW5nUHJvcHM7YT1TZyhlKTtiLnR5cGU9YTtlPWIudGFnPUZmKGEpO2Y9Y2goYSxmKTtnPXZvaWQgMDtzd2l0Y2goZSl7Y2FzZSAwOmc9WWcobnVsbCxiLGEsZixjKTticmVhaztjYXNlIDE6Zz0kZyhudWxsLGIsYSxmLGMpO2JyZWFrO2Nhc2UgMTE6Zz1VZyhudWxsLGIsYSxmLGMpO2JyZWFrO2Nhc2UgMTQ6Zz1XZyhudWxsLGIsYSxjaChhLnR5cGUsZiksZCxjKTticmVhaztkZWZhdWx0OnIoXCIyODNcIixhKX1yZXR1cm4gZztjYXNlIDA6cmV0dXJuIGQ9Yi50eXBlLGU9Yi5wZW5kaW5nUHJvcHMsZT1iLmVsZW1lbnRUeXBlPT09ZD9lOmNoKGQsZSksWWcoYSxiLGQsZSxjKTtjYXNlIDE6cmV0dXJuIGQ9Yi50eXBlLGU9Yi5wZW5kaW5nUHJvcHMsZT1iLmVsZW1lbnRUeXBlPT09XG5kP2U6Y2goZCxlKSwkZyhhLGIsZCxlLGMpO2Nhc2UgMzpiaChiKTtkPWIudXBkYXRlUXVldWU7bnVsbD09PWQ/cihcIjI4MlwiKTp2b2lkIDA7ZT1iLm1lbW9pemVkU3RhdGU7ZT1udWxsIT09ZT9lLmVsZW1lbnQ6bnVsbDtaZihiLGQsYi5wZW5kaW5nUHJvcHMsbnVsbCxjKTtkPWIubWVtb2l6ZWRTdGF0ZS5lbGVtZW50O2lmKGQ9PT1lKVJnKCksYj1WZyhhLGIsYyk7ZWxzZXtlPWIuc3RhdGVOb2RlO2lmKGU9KG51bGw9PT1hfHxudWxsPT09YS5jaGlsZCkmJmUuaHlkcmF0ZSlLZz1uZihiLnN0YXRlTm9kZS5jb250YWluZXJJbmZvKSxKZz1iLGU9TGc9ITA7ZT8oYi5lZmZlY3RUYWd8PTIsYi5jaGlsZD1JZyhiLG51bGwsZCxjKSk6KFAoYSxiLGQsYyksUmcoKSk7Yj1iLmNoaWxkfXJldHVybiBiO2Nhc2UgNTpyZXR1cm4gcWcoYiksbnVsbD09PWEmJk9nKGIpLGQ9Yi50eXBlLGU9Yi5wZW5kaW5nUHJvcHMsZj1udWxsIT09YT9hLm1lbW9pemVkUHJvcHM6bnVsbCxnPWUuY2hpbGRyZW4samYoZCxcbmUpP2c9bnVsbDpudWxsIT09ZiYmamYoZCxmKSYmKGIuZWZmZWN0VGFnfD0xNiksWmcoYSxiKSwxMDczNzQxODIzIT09YyYmYi5tb2RlJjEmJmUuaGlkZGVuPyhiLmV4cGlyYXRpb25UaW1lPTEwNzM3NDE4MjMsYj1udWxsKTooUChhLGIsZyxjKSxiPWIuY2hpbGQpLGI7Y2FzZSA2OnJldHVybiBudWxsPT09YSYmT2coYiksbnVsbDtjYXNlIDEzOnJldHVybiBkaChhLGIsYyk7Y2FzZSA0OnJldHVybiBvZyhiLGIuc3RhdGVOb2RlLmNvbnRhaW5lckluZm8pLGQ9Yi5wZW5kaW5nUHJvcHMsbnVsbD09PWE/Yi5jaGlsZD1IZyhiLG51bGwsZCxjKTpQKGEsYixkLGMpLGIuY2hpbGQ7Y2FzZSAxMTpyZXR1cm4gZD1iLnR5cGUsZT1iLnBlbmRpbmdQcm9wcyxlPWIuZWxlbWVudFR5cGU9PT1kP2U6Y2goZCxlKSxVZyhhLGIsZCxlLGMpO2Nhc2UgNzpyZXR1cm4gUChhLGIsYi5wZW5kaW5nUHJvcHMsYyksYi5jaGlsZDtjYXNlIDg6cmV0dXJuIFAoYSxiLGIucGVuZGluZ1Byb3BzLmNoaWxkcmVuLFxuYyksYi5jaGlsZDtjYXNlIDEyOnJldHVybiBQKGEsYixiLnBlbmRpbmdQcm9wcy5jaGlsZHJlbixjKSxiLmNoaWxkO2Nhc2UgMTA6YTp7ZD1iLnR5cGUuX2NvbnRleHQ7ZT1iLnBlbmRpbmdQcm9wcztnPWIubWVtb2l6ZWRQcm9wcztmPWUudmFsdWU7Z2coYixmKTtpZihudWxsIT09Zyl7dmFyIGg9Zy52YWx1ZTtmPWg9PT1mJiYoMCE9PWh8fDEvaD09PTEvZil8fGghPT1oJiZmIT09Zj8wOihcImZ1bmN0aW9uXCI9PT10eXBlb2YgZC5fY2FsY3VsYXRlQ2hhbmdlZEJpdHM/ZC5fY2FsY3VsYXRlQ2hhbmdlZEJpdHMoaCxmKToxMDczNzQxODIzKXwwO2lmKDA9PT1mKXtpZihnLmNoaWxkcmVuPT09ZS5jaGlsZHJlbiYmIUwuY3VycmVudCl7Yj1WZyhhLGIsYyk7YnJlYWsgYX19ZWxzZSBmb3IoZz1iLmNoaWxkLG51bGwhPT1nJiYoZy5yZXR1cm49Yik7bnVsbCE9PWc7KXtoPWcuZmlyc3RDb250ZXh0RGVwZW5kZW5jeTtpZihudWxsIT09aCl7ZG97aWYoaC5jb250ZXh0PT09ZCYmMCE9PShoLm9ic2VydmVkQml0cyZcbmYpKXtpZigxPT09Zy50YWcpe3ZhciBrPVRmKGMpO2sudGFnPTI7VmYoZyxrKX1pZigwPT09Zy5leHBpcmF0aW9uVGltZXx8Zy5leHBpcmF0aW9uVGltZT5jKWcuZXhwaXJhdGlvblRpbWU9YztrPWcuYWx0ZXJuYXRlO251bGwhPT1rJiYoMD09PWsuZXhwaXJhdGlvblRpbWV8fGsuZXhwaXJhdGlvblRpbWU+YykmJihrLmV4cGlyYXRpb25UaW1lPWMpO2Zvcih2YXIgbD1nLnJldHVybjtudWxsIT09bDspe2s9bC5hbHRlcm5hdGU7aWYoMD09PWwuY2hpbGRFeHBpcmF0aW9uVGltZXx8bC5jaGlsZEV4cGlyYXRpb25UaW1lPmMpbC5jaGlsZEV4cGlyYXRpb25UaW1lPWMsbnVsbCE9PWsmJigwPT09ay5jaGlsZEV4cGlyYXRpb25UaW1lfHxrLmNoaWxkRXhwaXJhdGlvblRpbWU+YykmJihrLmNoaWxkRXhwaXJhdGlvblRpbWU9Yyk7ZWxzZSBpZihudWxsIT09ayYmKDA9PT1rLmNoaWxkRXhwaXJhdGlvblRpbWV8fGsuY2hpbGRFeHBpcmF0aW9uVGltZT5jKSlrLmNoaWxkRXhwaXJhdGlvblRpbWU9XG5jO2Vsc2UgYnJlYWs7bD1sLnJldHVybn19az1nLmNoaWxkO2g9aC5uZXh0fXdoaWxlKG51bGwhPT1oKX1lbHNlIGs9MTA9PT1nLnRhZz9nLnR5cGU9PT1iLnR5cGU/bnVsbDpnLmNoaWxkOmcuY2hpbGQ7aWYobnVsbCE9PWspay5yZXR1cm49ZztlbHNlIGZvcihrPWc7bnVsbCE9PWs7KXtpZihrPT09Yil7az1udWxsO2JyZWFrfWc9ay5zaWJsaW5nO2lmKG51bGwhPT1nKXtnLnJldHVybj1rLnJldHVybjtrPWc7YnJlYWt9az1rLnJldHVybn1nPWt9fVAoYSxiLGUuY2hpbGRyZW4sYyk7Yj1iLmNoaWxkfXJldHVybiBiO2Nhc2UgOTpyZXR1cm4gZT1iLnR5cGUsZj1iLnBlbmRpbmdQcm9wcyxkPWYuY2hpbGRyZW4saWcoYixjKSxlPWpnKGUsZi51bnN0YWJsZV9vYnNlcnZlZEJpdHMpLGQ9ZChlKSxiLmVmZmVjdFRhZ3w9MSxQKGEsYixkLGMpLGIuY2hpbGQ7Y2FzZSAxNDpyZXR1cm4gZT1iLnR5cGUsZj1jaChlLnR5cGUsYi5wZW5kaW5nUHJvcHMpLFdnKGEsYixlLGYsZCxjKTtjYXNlIDE1OnJldHVybiBYZyhhLFxuYixiLnR5cGUsYi5wZW5kaW5nUHJvcHMsZCxjKTtjYXNlIDE3OnJldHVybiBkPWIudHlwZSxlPWIucGVuZGluZ1Byb3BzLGU9Yi5lbGVtZW50VHlwZT09PWQ/ZTpjaChkLGUpLG51bGwhPT1hJiYoYS5hbHRlcm5hdGU9bnVsbCxiLmFsdGVybmF0ZT1udWxsLGIuZWZmZWN0VGFnfD0yKSxiLnRhZz0xLE0oZCk/KGE9ITAseGYoYikpOmE9ITEsaWcoYixjKSxBZyhiLGQsZSxjKSxDZyhiLGQsZSxjKSxhaChudWxsLGIsZCwhMCxhLGMpO2RlZmF1bHQ6cihcIjE1NlwiKX19ZnVuY3Rpb24gemgoYSl7YS5lZmZlY3RUYWd8PTR9dmFyIEFoPXZvaWQgMCxCaD12b2lkIDAsQ2g9dm9pZCAwLERoPXZvaWQgMDtcbkFoPWZ1bmN0aW9uKGEsYil7Zm9yKHZhciBjPWIuY2hpbGQ7bnVsbCE9PWM7KXtpZig1PT09Yy50YWd8fDY9PT1jLnRhZylhLmFwcGVuZENoaWxkKGMuc3RhdGVOb2RlKTtlbHNlIGlmKDQhPT1jLnRhZyYmbnVsbCE9PWMuY2hpbGQpe2MuY2hpbGQucmV0dXJuPWM7Yz1jLmNoaWxkO2NvbnRpbnVlfWlmKGM9PT1iKWJyZWFrO2Zvcig7bnVsbD09PWMuc2libGluZzspe2lmKG51bGw9PT1jLnJldHVybnx8Yy5yZXR1cm49PT1iKXJldHVybjtjPWMucmV0dXJufWMuc2libGluZy5yZXR1cm49Yy5yZXR1cm47Yz1jLnNpYmxpbmd9fTtCaD1mdW5jdGlvbigpe307XG5DaD1mdW5jdGlvbihhLGIsYyxkLGUpe3ZhciBmPWEubWVtb2l6ZWRQcm9wcztpZihmIT09ZCl7dmFyIGc9Yi5zdGF0ZU5vZGU7bmcoTy5jdXJyZW50KTthPW51bGw7c3dpdGNoKGMpe2Nhc2UgXCJpbnB1dFwiOmY9UWMoZyxmKTtkPVFjKGcsZCk7YT1bXTticmVhaztjYXNlIFwib3B0aW9uXCI6Zj1NZShnLGYpO2Q9TWUoZyxkKTthPVtdO2JyZWFrO2Nhc2UgXCJzZWxlY3RcIjpmPW4oe30sZix7dmFsdWU6dm9pZCAwfSk7ZD1uKHt9LGQse3ZhbHVlOnZvaWQgMH0pO2E9W107YnJlYWs7Y2FzZSBcInRleHRhcmVhXCI6Zj1PZShnLGYpO2Q9T2UoZyxkKTthPVtdO2JyZWFrO2RlZmF1bHQ6XCJmdW5jdGlvblwiIT09dHlwZW9mIGYub25DbGljayYmXCJmdW5jdGlvblwiPT09dHlwZW9mIGQub25DbGljayYmKGcub25jbGljaz1lZil9YmYoYyxkKTtnPWM9dm9pZCAwO3ZhciBoPW51bGw7Zm9yKGMgaW4gZilpZighZC5oYXNPd25Qcm9wZXJ0eShjKSYmZi5oYXNPd25Qcm9wZXJ0eShjKSYmbnVsbCE9ZltjXSlpZihcInN0eWxlXCI9PT1cbmMpe3ZhciBrPWZbY107Zm9yKGcgaW4gaylrLmhhc093blByb3BlcnR5KGcpJiYoaHx8KGg9e30pLGhbZ109XCJcIil9ZWxzZVwiZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUxcIiE9PWMmJlwiY2hpbGRyZW5cIiE9PWMmJlwic3VwcHJlc3NDb250ZW50RWRpdGFibGVXYXJuaW5nXCIhPT1jJiZcInN1cHByZXNzSHlkcmF0aW9uV2FybmluZ1wiIT09YyYmXCJhdXRvRm9jdXNcIiE9PWMmJih1YS5oYXNPd25Qcm9wZXJ0eShjKT9hfHwoYT1bXSk6KGE9YXx8W10pLnB1c2goYyxudWxsKSk7Zm9yKGMgaW4gZCl7dmFyIGw9ZFtjXTtrPW51bGwhPWY/ZltjXTp2b2lkIDA7aWYoZC5oYXNPd25Qcm9wZXJ0eShjKSYmbCE9PWsmJihudWxsIT1sfHxudWxsIT1rKSlpZihcInN0eWxlXCI9PT1jKWlmKGspe2ZvcihnIGluIGspIWsuaGFzT3duUHJvcGVydHkoZyl8fGwmJmwuaGFzT3duUHJvcGVydHkoZyl8fChofHwoaD17fSksaFtnXT1cIlwiKTtmb3IoZyBpbiBsKWwuaGFzT3duUHJvcGVydHkoZykmJmtbZ10hPT1sW2ddJiYoaHx8XG4oaD17fSksaFtnXT1sW2ddKX1lbHNlIGh8fChhfHwoYT1bXSksYS5wdXNoKGMsaCkpLGg9bDtlbHNlXCJkYW5nZXJvdXNseVNldElubmVySFRNTFwiPT09Yz8obD1sP2wuX19odG1sOnZvaWQgMCxrPWs/ay5fX2h0bWw6dm9pZCAwLG51bGwhPWwmJmshPT1sJiYoYT1hfHxbXSkucHVzaChjLFwiXCIrbCkpOlwiY2hpbGRyZW5cIj09PWM/az09PWx8fFwic3RyaW5nXCIhPT10eXBlb2YgbCYmXCJudW1iZXJcIiE9PXR5cGVvZiBsfHwoYT1hfHxbXSkucHVzaChjLFwiXCIrbCk6XCJzdXBwcmVzc0NvbnRlbnRFZGl0YWJsZVdhcm5pbmdcIiE9PWMmJlwic3VwcHJlc3NIeWRyYXRpb25XYXJuaW5nXCIhPT1jJiYodWEuaGFzT3duUHJvcGVydHkoYyk/KG51bGwhPWwmJmRmKGUsYyksYXx8az09PWx8fChhPVtdKSk6KGE9YXx8W10pLnB1c2goYyxsKSl9aCYmKGE9YXx8W10pLnB1c2goXCJzdHlsZVwiLGgpO2U9YTsoYi51cGRhdGVRdWV1ZT1lKSYmemgoYil9fTtEaD1mdW5jdGlvbihhLGIsYyxkKXtjIT09ZCYmemgoYil9O1xuZnVuY3Rpb24gRWgoYSxiKXt2YXIgYz1iLnNvdXJjZSxkPWIuc3RhY2s7bnVsbD09PWQmJm51bGwhPT1jJiYoZD1CYyhjKSk7bnVsbCE9PWMmJkFjKGMudHlwZSk7Yj1iLnZhbHVlO251bGwhPT1hJiYxPT09YS50YWcmJkFjKGEudHlwZSk7dHJ5e2NvbnNvbGUuZXJyb3IoYil9Y2F0Y2goZSl7c2V0VGltZW91dChmdW5jdGlvbigpe3Rocm93IGU7fSl9fWZ1bmN0aW9uIEZoKGEpe3ZhciBiPWEucmVmO2lmKG51bGwhPT1iKWlmKFwiZnVuY3Rpb25cIj09PXR5cGVvZiBiKXRyeXtiKG51bGwpfWNhdGNoKGMpe0doKGEsYyl9ZWxzZSBiLmN1cnJlbnQ9bnVsbH1cbmZ1bmN0aW9uIEhoKGEpe1wiZnVuY3Rpb25cIj09PXR5cGVvZiBBZiYmQWYoYSk7c3dpdGNoKGEudGFnKXtjYXNlIDE6RmgoYSk7dmFyIGI9YS5zdGF0ZU5vZGU7aWYoXCJmdW5jdGlvblwiPT09dHlwZW9mIGIuY29tcG9uZW50V2lsbFVubW91bnQpdHJ5e2IucHJvcHM9YS5tZW1vaXplZFByb3BzLGIuc3RhdGU9YS5tZW1vaXplZFN0YXRlLGIuY29tcG9uZW50V2lsbFVubW91bnQoKX1jYXRjaChjKXtHaChhLGMpfWJyZWFrO2Nhc2UgNTpGaChhKTticmVhaztjYXNlIDQ6SWgoYSl9fWZ1bmN0aW9uIEpoKGEpe3JldHVybiA1PT09YS50YWd8fDM9PT1hLnRhZ3x8ND09PWEudGFnfVxuZnVuY3Rpb24gS2goYSl7YTp7Zm9yKHZhciBiPWEucmV0dXJuO251bGwhPT1iOyl7aWYoSmgoYikpe3ZhciBjPWI7YnJlYWsgYX1iPWIucmV0dXJufXIoXCIxNjBcIik7Yz12b2lkIDB9dmFyIGQ9Yj12b2lkIDA7c3dpdGNoKGMudGFnKXtjYXNlIDU6Yj1jLnN0YXRlTm9kZTtkPSExO2JyZWFrO2Nhc2UgMzpiPWMuc3RhdGVOb2RlLmNvbnRhaW5lckluZm87ZD0hMDticmVhaztjYXNlIDQ6Yj1jLnN0YXRlTm9kZS5jb250YWluZXJJbmZvO2Q9ITA7YnJlYWs7ZGVmYXVsdDpyKFwiMTYxXCIpfWMuZWZmZWN0VGFnJjE2JiYoWGUoYixcIlwiKSxjLmVmZmVjdFRhZyY9LTE3KTthOmI6Zm9yKGM9YTs7KXtmb3IoO251bGw9PT1jLnNpYmxpbmc7KXtpZihudWxsPT09Yy5yZXR1cm58fEpoKGMucmV0dXJuKSl7Yz1udWxsO2JyZWFrIGF9Yz1jLnJldHVybn1jLnNpYmxpbmcucmV0dXJuPWMucmV0dXJuO2ZvcihjPWMuc2libGluZzs1IT09Yy50YWcmJjYhPT1jLnRhZzspe2lmKGMuZWZmZWN0VGFnJjIpY29udGludWUgYjtcbmlmKG51bGw9PT1jLmNoaWxkfHw0PT09Yy50YWcpY29udGludWUgYjtlbHNlIGMuY2hpbGQucmV0dXJuPWMsYz1jLmNoaWxkfWlmKCEoYy5lZmZlY3RUYWcmMikpe2M9Yy5zdGF0ZU5vZGU7YnJlYWsgYX19Zm9yKHZhciBlPWE7Oyl7aWYoNT09PWUudGFnfHw2PT09ZS50YWcpaWYoYylpZihkKXt2YXIgZj1iLGc9ZS5zdGF0ZU5vZGUsaD1jOzg9PT1mLm5vZGVUeXBlP2YucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZyxoKTpmLmluc2VydEJlZm9yZShnLGgpfWVsc2UgYi5pbnNlcnRCZWZvcmUoZS5zdGF0ZU5vZGUsYyk7ZWxzZSBkPyhnPWIsaD1lLnN0YXRlTm9kZSw4PT09Zy5ub2RlVHlwZT8oZj1nLnBhcmVudE5vZGUsZi5pbnNlcnRCZWZvcmUoaCxnKSk6KGY9ZyxmLmFwcGVuZENoaWxkKGgpKSxnPWcuX3JlYWN0Um9vdENvbnRhaW5lcixudWxsIT09ZyYmdm9pZCAwIT09Z3x8bnVsbCE9PWYub25jbGlja3x8KGYub25jbGljaz1lZikpOmIuYXBwZW5kQ2hpbGQoZS5zdGF0ZU5vZGUpO1xuZWxzZSBpZig0IT09ZS50YWcmJm51bGwhPT1lLmNoaWxkKXtlLmNoaWxkLnJldHVybj1lO2U9ZS5jaGlsZDtjb250aW51ZX1pZihlPT09YSlicmVhaztmb3IoO251bGw9PT1lLnNpYmxpbmc7KXtpZihudWxsPT09ZS5yZXR1cm58fGUucmV0dXJuPT09YSlyZXR1cm47ZT1lLnJldHVybn1lLnNpYmxpbmcucmV0dXJuPWUucmV0dXJuO2U9ZS5zaWJsaW5nfX1cbmZ1bmN0aW9uIEloKGEpe2Zvcih2YXIgYj1hLGM9ITEsZD12b2lkIDAsZT12b2lkIDA7Oyl7aWYoIWMpe2M9Yi5yZXR1cm47YTpmb3IoOzspe251bGw9PT1jP3IoXCIxNjBcIik6dm9pZCAwO3N3aXRjaChjLnRhZyl7Y2FzZSA1OmQ9Yy5zdGF0ZU5vZGU7ZT0hMTticmVhayBhO2Nhc2UgMzpkPWMuc3RhdGVOb2RlLmNvbnRhaW5lckluZm87ZT0hMDticmVhayBhO2Nhc2UgNDpkPWMuc3RhdGVOb2RlLmNvbnRhaW5lckluZm87ZT0hMDticmVhayBhfWM9Yy5yZXR1cm59Yz0hMH1pZig1PT09Yi50YWd8fDY9PT1iLnRhZyl7YTpmb3IodmFyIGY9YixnPWY7OylpZihIaChnKSxudWxsIT09Zy5jaGlsZCYmNCE9PWcudGFnKWcuY2hpbGQucmV0dXJuPWcsZz1nLmNoaWxkO2Vsc2V7aWYoZz09PWYpYnJlYWs7Zm9yKDtudWxsPT09Zy5zaWJsaW5nOyl7aWYobnVsbD09PWcucmV0dXJufHxnLnJldHVybj09PWYpYnJlYWsgYTtnPWcucmV0dXJufWcuc2libGluZy5yZXR1cm49Zy5yZXR1cm47Zz1nLnNpYmxpbmd9ZT9cbihmPWQsZz1iLnN0YXRlTm9kZSw4PT09Zi5ub2RlVHlwZT9mLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZyk6Zi5yZW1vdmVDaGlsZChnKSk6ZC5yZW1vdmVDaGlsZChiLnN0YXRlTm9kZSl9ZWxzZSBpZig0PT09Yi50YWc/KGQ9Yi5zdGF0ZU5vZGUuY29udGFpbmVySW5mbyxlPSEwKTpIaChiKSxudWxsIT09Yi5jaGlsZCl7Yi5jaGlsZC5yZXR1cm49YjtiPWIuY2hpbGQ7Y29udGludWV9aWYoYj09PWEpYnJlYWs7Zm9yKDtudWxsPT09Yi5zaWJsaW5nOyl7aWYobnVsbD09PWIucmV0dXJufHxiLnJldHVybj09PWEpcmV0dXJuO2I9Yi5yZXR1cm47ND09PWIudGFnJiYoYz0hMSl9Yi5zaWJsaW5nLnJldHVybj1iLnJldHVybjtiPWIuc2libGluZ319XG5mdW5jdGlvbiBMaChhLGIpe3N3aXRjaChiLnRhZyl7Y2FzZSAxOmJyZWFrO2Nhc2UgNTp2YXIgYz1iLnN0YXRlTm9kZTtpZihudWxsIT1jKXt2YXIgZD1iLm1lbW9pemVkUHJvcHMsZT1udWxsIT09YT9hLm1lbW9pemVkUHJvcHM6ZDthPWIudHlwZTt2YXIgZj1iLnVwZGF0ZVF1ZXVlO2IudXBkYXRlUXVldWU9bnVsbDtpZihudWxsIT09Zil7Y1tNYV09ZDtcImlucHV0XCI9PT1hJiZcInJhZGlvXCI9PT1kLnR5cGUmJm51bGwhPWQubmFtZSYmU2MoYyxkKTtjZihhLGUpO2I9Y2YoYSxkKTtmb3IoZT0wO2U8Zi5sZW5ndGg7ZSs9Mil7dmFyIGc9ZltlXSxoPWZbZSsxXTtcInN0eWxlXCI9PT1nPyRlKGMsaCk6XCJkYW5nZXJvdXNseVNldElubmVySFRNTFwiPT09Zz9XZShjLGgpOlwiY2hpbGRyZW5cIj09PWc/WGUoYyxoKTpPYyhjLGcsaCxiKX1zd2l0Y2goYSl7Y2FzZSBcImlucHV0XCI6VGMoYyxkKTticmVhaztjYXNlIFwidGV4dGFyZWFcIjpRZShjLGQpO2JyZWFrO2Nhc2UgXCJzZWxlY3RcIjphPWMuX3dyYXBwZXJTdGF0ZS53YXNNdWx0aXBsZSxcbmMuX3dyYXBwZXJTdGF0ZS53YXNNdWx0aXBsZT0hIWQubXVsdGlwbGUsZj1kLnZhbHVlLG51bGwhPWY/TmUoYywhIWQubXVsdGlwbGUsZiwhMSk6YSE9PSEhZC5tdWx0aXBsZSYmKG51bGwhPWQuZGVmYXVsdFZhbHVlP05lKGMsISFkLm11bHRpcGxlLGQuZGVmYXVsdFZhbHVlLCEwKTpOZShjLCEhZC5tdWx0aXBsZSxkLm11bHRpcGxlP1tdOlwiXCIsITEpKX19fWJyZWFrO2Nhc2UgNjpudWxsPT09Yi5zdGF0ZU5vZGU/cihcIjE2MlwiKTp2b2lkIDA7Yi5zdGF0ZU5vZGUubm9kZVZhbHVlPWIubWVtb2l6ZWRQcm9wczticmVhaztjYXNlIDM6YnJlYWs7Y2FzZSAxMjpicmVhaztjYXNlIDEzOmJyZWFrO2Nhc2UgMTc6YnJlYWs7ZGVmYXVsdDpyKFwiMTYzXCIpfX1mdW5jdGlvbiBNaChhLGIsYyl7Yz1UZihjKTtjLnRhZz0zO2MucGF5bG9hZD17ZWxlbWVudDpudWxsfTt2YXIgZD1iLnZhbHVlO2MuY2FsbGJhY2s9ZnVuY3Rpb24oKXtOaChkKTtFaChhLGIpfTtyZXR1cm4gY31cbmZ1bmN0aW9uIE9oKGEsYixjKXtjPVRmKGMpO2MudGFnPTM7dmFyIGQ9YS50eXBlLmdldERlcml2ZWRTdGF0ZUZyb21FcnJvcjtpZihcImZ1bmN0aW9uXCI9PT10eXBlb2YgZCl7dmFyIGU9Yi52YWx1ZTtjLnBheWxvYWQ9ZnVuY3Rpb24oKXtyZXR1cm4gZChlKX19dmFyIGY9YS5zdGF0ZU5vZGU7bnVsbCE9PWYmJlwiZnVuY3Rpb25cIj09PXR5cGVvZiBmLmNvbXBvbmVudERpZENhdGNoJiYoYy5jYWxsYmFjaz1mdW5jdGlvbigpe1wiZnVuY3Rpb25cIiE9PXR5cGVvZiBkJiYobnVsbD09PVBoP1BoPW5ldyBTZXQoW3RoaXNdKTpQaC5hZGQodGhpcykpO3ZhciBjPWIudmFsdWUsZT1iLnN0YWNrO0VoKGEsYik7dGhpcy5jb21wb25lbnREaWRDYXRjaChjLHtjb21wb25lbnRTdGFjazpudWxsIT09ZT9lOlwiXCJ9KX0pO3JldHVybiBjfVxuZnVuY3Rpb24gUWgoYSl7c3dpdGNoKGEudGFnKXtjYXNlIDE6TShhLnR5cGUpJiZ0ZihhKTt2YXIgYj1hLmVmZmVjdFRhZztyZXR1cm4gYiYxMDI0PyhhLmVmZmVjdFRhZz1iJi0xMDI1fDY0LGEpOm51bGw7Y2FzZSAzOnJldHVybiBwZyhhKSx1ZihhKSxiPWEuZWZmZWN0VGFnLDAhPT0oYiY2NCk/cihcIjI4NVwiKTp2b2lkIDAsYS5lZmZlY3RUYWc9YiYtMTAyNXw2NCxhO2Nhc2UgNTpyZXR1cm4gcmcoYSksbnVsbDtjYXNlIDEzOmI9YS5lZmZlY3RUYWc7aWYoYiYxMDI0KXthLmVmZmVjdFRhZz1iJi0xMDI1fDY0O2I9YS5hbHRlcm5hdGU7Yj1udWxsIT09Yj9iLm1lbW9pemVkU3RhdGU6bnVsbDt2YXIgYz1hLm1lbW9pemVkU3RhdGU7bnVsbD09PWM/Yz17YWxyZWFkeUNhcHR1cmVkOiEwLGRpZFRpbWVvdXQ6ITEsdGltZWRPdXRBdDowfTpiPT09Yz9jPXthbHJlYWR5Q2FwdHVyZWQ6ITAsZGlkVGltZW91dDpjLmRpZFRpbWVvdXQsdGltZWRPdXRBdDpjLnRpbWVkT3V0QXR9OmMuYWxyZWFkeUNhcHR1cmVkPVxuITA7YS5tZW1vaXplZFN0YXRlPWM7cmV0dXJuIGF9cmV0dXJuIG51bGw7Y2FzZSA0OnJldHVybiBwZyhhKSxudWxsO2Nhc2UgMTA6cmV0dXJuIGhnKGEpLG51bGw7ZGVmYXVsdDpyZXR1cm4gbnVsbH19dmFyIFJoPXtyZWFkQ29udGV4dDpqZ30sU2g9a2MuUmVhY3RDdXJyZW50T3duZXIsVGg9MCxVaD0wLFZoPSExLFE9bnVsbCxSPW51bGwsUz0wLFdoPS0xLFhoPSExLFQ9bnVsbCxZaD0hMSxQaD1udWxsO2Z1bmN0aW9uIFpoKCl7aWYobnVsbCE9PVEpZm9yKHZhciBhPVEucmV0dXJuO251bGwhPT1hOyl7dmFyIGI9YTtzd2l0Y2goYi50YWcpe2Nhc2UgMTp2YXIgYz1iLnR5cGUuY2hpbGRDb250ZXh0VHlwZXM7bnVsbCE9PWMmJnZvaWQgMCE9PWMmJnRmKGIpO2JyZWFrO2Nhc2UgMzpwZyhiKTt1ZihiKTticmVhaztjYXNlIDU6cmcoYik7YnJlYWs7Y2FzZSA0OnBnKGIpO2JyZWFrO2Nhc2UgMTA6aGcoYil9YT1hLnJldHVybn1SPW51bGw7Uz0wO1doPS0xO1hoPSExO1E9bnVsbH1cbmZ1bmN0aW9uICRoKGEpe2Zvcig7Oyl7dmFyIGI9YS5hbHRlcm5hdGUsYz1hLnJldHVybixkPWEuc2libGluZztpZigwPT09KGEuZWZmZWN0VGFnJjUxMikpe3ZhciBlPWI7Yj1hO3ZhciBmPWIucGVuZGluZ1Byb3BzO3N3aXRjaChiLnRhZyl7Y2FzZSAyOmJyZWFrO2Nhc2UgMTY6YnJlYWs7Y2FzZSAxNTpjYXNlIDA6YnJlYWs7Y2FzZSAxOk0oYi50eXBlKSYmdGYoYik7YnJlYWs7Y2FzZSAzOnBnKGIpO3VmKGIpO2Y9Yi5zdGF0ZU5vZGU7Zi5wZW5kaW5nQ29udGV4dCYmKGYuY29udGV4dD1mLnBlbmRpbmdDb250ZXh0LGYucGVuZGluZ0NvbnRleHQ9bnVsbCk7aWYobnVsbD09PWV8fG51bGw9PT1lLmNoaWxkKVFnKGIpLGIuZWZmZWN0VGFnJj0tMztCaChiKTticmVhaztjYXNlIDU6cmcoYik7dmFyIGc9bmcobWcuY3VycmVudCksaD1iLnR5cGU7aWYobnVsbCE9PWUmJm51bGwhPWIuc3RhdGVOb2RlKUNoKGUsYixoLGYsZyksZS5yZWYhPT1iLnJlZiYmKGIuZWZmZWN0VGFnfD0xMjgpO1xuZWxzZSBpZihmKXt2YXIgaz1uZyhPLmN1cnJlbnQpO2lmKFFnKGIpKXtmPWI7ZT1mLnN0YXRlTm9kZTt2YXIgbD1mLnR5cGUsbT1mLm1lbW9pemVkUHJvcHMscD1nO2VbTGFdPWY7ZVtNYV09bTtoPXZvaWQgMDtnPWw7c3dpdGNoKGcpe2Nhc2UgXCJpZnJhbWVcIjpjYXNlIFwib2JqZWN0XCI6SChcImxvYWRcIixlKTticmVhaztjYXNlIFwidmlkZW9cIjpjYXNlIFwiYXVkaW9cIjpmb3IobD0wO2w8bGIubGVuZ3RoO2wrKylIKGxiW2xdLGUpO2JyZWFrO2Nhc2UgXCJzb3VyY2VcIjpIKFwiZXJyb3JcIixlKTticmVhaztjYXNlIFwiaW1nXCI6Y2FzZSBcImltYWdlXCI6Y2FzZSBcImxpbmtcIjpIKFwiZXJyb3JcIixlKTtIKFwibG9hZFwiLGUpO2JyZWFrO2Nhc2UgXCJmb3JtXCI6SChcInJlc2V0XCIsZSk7SChcInN1Ym1pdFwiLGUpO2JyZWFrO2Nhc2UgXCJkZXRhaWxzXCI6SChcInRvZ2dsZVwiLGUpO2JyZWFrO2Nhc2UgXCJpbnB1dFwiOlJjKGUsbSk7SChcImludmFsaWRcIixlKTtkZihwLFwib25DaGFuZ2VcIik7YnJlYWs7Y2FzZSBcInNlbGVjdFwiOmUuX3dyYXBwZXJTdGF0ZT1cbnt3YXNNdWx0aXBsZTohIW0ubXVsdGlwbGV9O0goXCJpbnZhbGlkXCIsZSk7ZGYocCxcIm9uQ2hhbmdlXCIpO2JyZWFrO2Nhc2UgXCJ0ZXh0YXJlYVwiOlBlKGUsbSksSChcImludmFsaWRcIixlKSxkZihwLFwib25DaGFuZ2VcIil9YmYoZyxtKTtsPW51bGw7Zm9yKGggaW4gbSltLmhhc093blByb3BlcnR5KGgpJiYoaz1tW2hdLFwiY2hpbGRyZW5cIj09PWg/XCJzdHJpbmdcIj09PXR5cGVvZiBrP2UudGV4dENvbnRlbnQhPT1rJiYobD1bXCJjaGlsZHJlblwiLGtdKTpcIm51bWJlclwiPT09dHlwZW9mIGsmJmUudGV4dENvbnRlbnQhPT1cIlwiK2smJihsPVtcImNoaWxkcmVuXCIsXCJcIitrXSk6dWEuaGFzT3duUHJvcGVydHkoaCkmJm51bGwhPWsmJmRmKHAsaCkpO3N3aXRjaChnKXtjYXNlIFwiaW5wdXRcIjppYyhlKTtiZChlLG0sITApO2JyZWFrO2Nhc2UgXCJ0ZXh0YXJlYVwiOmljKGUpO1JlKGUsbSk7YnJlYWs7Y2FzZSBcInNlbGVjdFwiOmNhc2UgXCJvcHRpb25cIjpicmVhaztkZWZhdWx0OlwiZnVuY3Rpb25cIj09PXR5cGVvZiBtLm9uQ2xpY2smJlxuKGUub25jbGljaz1lZil9aD1sO2YudXBkYXRlUXVldWU9aDtmPW51bGwhPT1oPyEwOiExO2YmJnpoKGIpfWVsc2V7bT1iO2U9aDtwPWY7bD05PT09Zy5ub2RlVHlwZT9nOmcub3duZXJEb2N1bWVudDtrPT09U2UuaHRtbCYmKGs9VGUoZSkpO2s9PT1TZS5odG1sP1wic2NyaXB0XCI9PT1lPyhlPWwuY3JlYXRlRWxlbWVudChcImRpdlwiKSxlLmlubmVySFRNTD1cIjxzY3JpcHQ+XFx4M2Mvc2NyaXB0PlwiLGw9ZS5yZW1vdmVDaGlsZChlLmZpcnN0Q2hpbGQpKTpcInN0cmluZ1wiPT09dHlwZW9mIHAuaXM/bD1sLmNyZWF0ZUVsZW1lbnQoZSx7aXM6cC5pc30pOihsPWwuY3JlYXRlRWxlbWVudChlKSxcInNlbGVjdFwiPT09ZSYmcC5tdWx0aXBsZSYmKGwubXVsdGlwbGU9ITApKTpsPWwuY3JlYXRlRWxlbWVudE5TKGssZSk7ZT1sO2VbTGFdPW07ZVtNYV09ZjtBaChlLGIsITEsITEpO3A9ZTtsPWg7bT1mO3ZhciB2PWcsQj1jZihsLG0pO3N3aXRjaChsKXtjYXNlIFwiaWZyYW1lXCI6Y2FzZSBcIm9iamVjdFwiOkgoXCJsb2FkXCIsXG5wKTtnPW07YnJlYWs7Y2FzZSBcInZpZGVvXCI6Y2FzZSBcImF1ZGlvXCI6Zm9yKGc9MDtnPGxiLmxlbmd0aDtnKyspSChsYltnXSxwKTtnPW07YnJlYWs7Y2FzZSBcInNvdXJjZVwiOkgoXCJlcnJvclwiLHApO2c9bTticmVhaztjYXNlIFwiaW1nXCI6Y2FzZSBcImltYWdlXCI6Y2FzZSBcImxpbmtcIjpIKFwiZXJyb3JcIixwKTtIKFwibG9hZFwiLHApO2c9bTticmVhaztjYXNlIFwiZm9ybVwiOkgoXCJyZXNldFwiLHApO0goXCJzdWJtaXRcIixwKTtnPW07YnJlYWs7Y2FzZSBcImRldGFpbHNcIjpIKFwidG9nZ2xlXCIscCk7Zz1tO2JyZWFrO2Nhc2UgXCJpbnB1dFwiOlJjKHAsbSk7Zz1RYyhwLG0pO0goXCJpbnZhbGlkXCIscCk7ZGYodixcIm9uQ2hhbmdlXCIpO2JyZWFrO2Nhc2UgXCJvcHRpb25cIjpnPU1lKHAsbSk7YnJlYWs7Y2FzZSBcInNlbGVjdFwiOnAuX3dyYXBwZXJTdGF0ZT17d2FzTXVsdGlwbGU6ISFtLm11bHRpcGxlfTtnPW4oe30sbSx7dmFsdWU6dm9pZCAwfSk7SChcImludmFsaWRcIixwKTtkZih2LFwib25DaGFuZ2VcIik7YnJlYWs7Y2FzZSBcInRleHRhcmVhXCI6UGUocCxcbm0pO2c9T2UocCxtKTtIKFwiaW52YWxpZFwiLHApO2RmKHYsXCJvbkNoYW5nZVwiKTticmVhaztkZWZhdWx0Omc9bX1iZihsLGcpO2s9dm9pZCAwO3ZhciB3PWwsQz1wLHU9Zztmb3IoayBpbiB1KWlmKHUuaGFzT3duUHJvcGVydHkoaykpe3ZhciBxPXVba107XCJzdHlsZVwiPT09az8kZShDLHEpOlwiZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUxcIj09PWs/KHE9cT9xLl9faHRtbDp2b2lkIDAsbnVsbCE9cSYmV2UoQyxxKSk6XCJjaGlsZHJlblwiPT09az9cInN0cmluZ1wiPT09dHlwZW9mIHE/KFwidGV4dGFyZWFcIiE9PXd8fFwiXCIhPT1xKSYmWGUoQyxxKTpcIm51bWJlclwiPT09dHlwZW9mIHEmJlhlKEMsXCJcIitxKTpcInN1cHByZXNzQ29udGVudEVkaXRhYmxlV2FybmluZ1wiIT09ayYmXCJzdXBwcmVzc0h5ZHJhdGlvbldhcm5pbmdcIiE9PWsmJlwiYXV0b0ZvY3VzXCIhPT1rJiYodWEuaGFzT3duUHJvcGVydHkoayk/bnVsbCE9cSYmZGYodixrKTpudWxsIT1xJiZPYyhDLGsscSxCKSl9c3dpdGNoKGwpe2Nhc2UgXCJpbnB1dFwiOmljKHApO1xuYmQocCxtLCExKTticmVhaztjYXNlIFwidGV4dGFyZWFcIjppYyhwKTtSZShwLG0pO2JyZWFrO2Nhc2UgXCJvcHRpb25cIjpudWxsIT1tLnZhbHVlJiZwLnNldEF0dHJpYnV0ZShcInZhbHVlXCIsXCJcIitQYyhtLnZhbHVlKSk7YnJlYWs7Y2FzZSBcInNlbGVjdFwiOmc9cDtnLm11bHRpcGxlPSEhbS5tdWx0aXBsZTtwPW0udmFsdWU7bnVsbCE9cD9OZShnLCEhbS5tdWx0aXBsZSxwLCExKTpudWxsIT1tLmRlZmF1bHRWYWx1ZSYmTmUoZywhIW0ubXVsdGlwbGUsbS5kZWZhdWx0VmFsdWUsITApO2JyZWFrO2RlZmF1bHQ6XCJmdW5jdGlvblwiPT09dHlwZW9mIGcub25DbGljayYmKHAub25jbGljaz1lZil9KGY9aGYoaCxmKSkmJnpoKGIpO2Iuc3RhdGVOb2RlPWV9bnVsbCE9PWIucmVmJiYoYi5lZmZlY3RUYWd8PTEyOCl9ZWxzZSBudWxsPT09Yi5zdGF0ZU5vZGU/cihcIjE2NlwiKTp2b2lkIDA7YnJlYWs7Y2FzZSA2OmUmJm51bGwhPWIuc3RhdGVOb2RlP0RoKGUsYixlLm1lbW9pemVkUHJvcHMsZik6KFwic3RyaW5nXCIhPT1cbnR5cGVvZiBmJiYobnVsbD09PWIuc3RhdGVOb2RlP3IoXCIxNjZcIik6dm9pZCAwKSxlPW5nKG1nLmN1cnJlbnQpLG5nKE8uY3VycmVudCksUWcoYik/KGY9YixoPWYuc3RhdGVOb2RlLGU9Zi5tZW1vaXplZFByb3BzLGhbTGFdPWYsKGY9aC5ub2RlVmFsdWUhPT1lKSYmemgoYikpOihoPWIsZj0oOT09PWUubm9kZVR5cGU/ZTplLm93bmVyRG9jdW1lbnQpLmNyZWF0ZVRleHROb2RlKGYpLGZbTGFdPWIsaC5zdGF0ZU5vZGU9ZikpO2JyZWFrO2Nhc2UgMTE6YnJlYWs7Y2FzZSAxMzpmPWIubWVtb2l6ZWRTdGF0ZTtoPW51bGwhPT1lP2UubWVtb2l6ZWRTdGF0ZTpudWxsOyhudWxsIT09ZiYmZi5kaWRUaW1lb3V0KSE9PShudWxsIT09aCYmaC5kaWRUaW1lb3V0KSYmKGIuZWZmZWN0VGFnfD00KTticmVhaztjYXNlIDc6YnJlYWs7Y2FzZSA4OmJyZWFrO2Nhc2UgMTI6YnJlYWs7Y2FzZSA0OnBnKGIpO0JoKGIpO2JyZWFrO2Nhc2UgMTA6aGcoYik7YnJlYWs7Y2FzZSA5OmJyZWFrO2Nhc2UgMTQ6YnJlYWs7XG5jYXNlIDE3Ok0oYi50eXBlKSYmdGYoYik7YnJlYWs7ZGVmYXVsdDpyKFwiMTU2XCIpfVE9bnVsbDtiPWE7aWYoMTA3Mzc0MTgyMz09PVN8fDEwNzM3NDE4MjMhPT1iLmNoaWxkRXhwaXJhdGlvblRpbWUpe2Y9MDtmb3IoaD1iLmNoaWxkO251bGwhPT1oOyl7ZT1oLmV4cGlyYXRpb25UaW1lO2c9aC5jaGlsZEV4cGlyYXRpb25UaW1lO2lmKDA9PT1mfHwwIT09ZSYmZTxmKWY9ZTtpZigwPT09Znx8MCE9PWcmJmc8ZilmPWc7aD1oLnNpYmxpbmd9Yi5jaGlsZEV4cGlyYXRpb25UaW1lPWZ9bnVsbCE9PWMmJjA9PT0oYy5lZmZlY3RUYWcmNTEyKSYmKG51bGw9PT1jLmZpcnN0RWZmZWN0JiYoYy5maXJzdEVmZmVjdD1hLmZpcnN0RWZmZWN0KSxudWxsIT09YS5sYXN0RWZmZWN0JiYobnVsbCE9PWMubGFzdEVmZmVjdCYmKGMubGFzdEVmZmVjdC5uZXh0RWZmZWN0PWEuZmlyc3RFZmZlY3QpLGMubGFzdEVmZmVjdD1hLmxhc3RFZmZlY3QpLDE8YS5lZmZlY3RUYWcmJihudWxsIT09Yy5sYXN0RWZmZWN0P1xuYy5sYXN0RWZmZWN0Lm5leHRFZmZlY3Q9YTpjLmZpcnN0RWZmZWN0PWEsYy5sYXN0RWZmZWN0PWEpKX1lbHNle2E9UWgoYSxTKTtpZihudWxsIT09YSlyZXR1cm4gYS5lZmZlY3RUYWcmPTUxMSxhO251bGwhPT1jJiYoYy5maXJzdEVmZmVjdD1jLmxhc3RFZmZlY3Q9bnVsbCxjLmVmZmVjdFRhZ3w9NTEyKX1pZihudWxsIT09ZClyZXR1cm4gZDtpZihudWxsIT09YylhPWM7ZWxzZSBicmVha31yZXR1cm4gbnVsbH1mdW5jdGlvbiBhaShhKXt2YXIgYj1laChhLmFsdGVybmF0ZSxhLFMpO2EubWVtb2l6ZWRQcm9wcz1hLnBlbmRpbmdQcm9wcztudWxsPT09YiYmKGI9JGgoYSkpO1NoLmN1cnJlbnQ9bnVsbDtyZXR1cm4gYn1cbmZ1bmN0aW9uIGJpKGEsYixjKXtWaD9yKFwiMjQzXCIpOnZvaWQgMDtWaD0hMDtTaC5jdXJyZW50RGlzcGF0Y2hlcj1SaDt2YXIgZD1hLm5leHRFeHBpcmF0aW9uVGltZVRvV29ya09uO2lmKGQhPT1TfHxhIT09Unx8bnVsbD09PVEpWmgoKSxSPWEsUz1kLFE9R2YoUi5jdXJyZW50LG51bGwsUyksYS5wZW5kaW5nQ29tbWl0RXhwaXJhdGlvblRpbWU9MDt2YXIgZT0hMTtkb3t0cnl7aWYoYilmb3IoO251bGwhPT1RJiYhY2koKTspUT1haShRKTtlbHNlIGZvcig7bnVsbCE9PVE7KVE9YWkoUSl9Y2F0Y2goQyl7aWYobnVsbD09PVEpZT0hMCxOaChDKTtlbHNle251bGw9PT1RP3IoXCIyNzFcIik6dm9pZCAwO3ZhciBmPVEsZz1mLnJldHVybjtpZihudWxsPT09ZyllPSEwLE5oKEMpO2Vsc2V7YTp7dmFyIGg9YSxrPWcsbD1mLG09QztnPVM7bC5lZmZlY3RUYWd8PTUxMjtsLmZpcnN0RWZmZWN0PWwubGFzdEVmZmVjdD1udWxsO2lmKG51bGwhPT1tJiZcIm9iamVjdFwiPT09dHlwZW9mIG0mJlwiZnVuY3Rpb25cIj09PVxudHlwZW9mIG0udGhlbil7dmFyIHA9bTttPWs7dmFyIHY9LTEsQj0tMTtkb3tpZigxMz09PW0udGFnKXt2YXIgdz1tLmFsdGVybmF0ZTtpZihudWxsIT09dyYmKHc9dy5tZW1vaXplZFN0YXRlLG51bGwhPT13JiZ3LmRpZFRpbWVvdXQpKXtCPTEwKih3LnRpbWVkT3V0QXQtMik7YnJlYWt9dz1tLnBlbmRpbmdQcm9wcy5tYXhEdXJhdGlvbjtpZihcIm51bWJlclwiPT09dHlwZW9mIHcpaWYoMD49dyl2PTA7ZWxzZSBpZigtMT09PXZ8fHc8dil2PXd9bT1tLnJldHVybn13aGlsZShudWxsIT09bSk7bT1rO2Rve2lmKHc9MTM9PT1tLnRhZyl2b2lkIDA9PT1tLm1lbW9pemVkUHJvcHMuZmFsbGJhY2s/dz0hMToodz1tLm1lbW9pemVkU3RhdGUsdz1udWxsPT09d3x8IXcuZGlkVGltZW91dCk7aWYodyl7az1kaS5iaW5kKG51bGwsaCxtLGwsMD09PShtLm1vZGUmMSk/MTpnKTtwLnRoZW4oayxrKTtpZigwPT09KG0ubW9kZSYxKSl7bS5lZmZlY3RUYWd8PTMyO1AobC5hbHRlcm5hdGUsbCxudWxsLGcpO1xubC5lZmZlY3RUYWcmPS01MTM7MT09PWwudGFnJiYobC5lZmZlY3RUYWcmPS00MjEsbnVsbD09PWwuYWx0ZXJuYXRlJiYobC50YWc9MTcpKTticmVhayBhfS0xPT09dj9oPTEwNzM3NDE4MjM6KC0xPT09QiYmKEI9MTAqKFBmKGgsZyktMiktNUUzKSxoPUIrdik7MDw9aCYmV2g8aCYmKFdoPWgpO20uZWZmZWN0VGFnfD0xMDI0O20uZXhwaXJhdGlvblRpbWU9ZzticmVhayBhfW09bS5yZXR1cm59d2hpbGUobnVsbCE9PW0pO209RXJyb3IoXCJBbiB1cGRhdGUgd2FzIHN1c3BlbmRlZCwgYnV0IG5vIHBsYWNlaG9sZGVyIFVJIHdhcyBwcm92aWRlZC5cIil9WGg9ITA7bT1iZyhtLGwpO2g9aztkb3tzd2l0Y2goaC50YWcpe2Nhc2UgMzpsPW07aC5lZmZlY3RUYWd8PTEwMjQ7aC5leHBpcmF0aW9uVGltZT1nO2c9TWgoaCxsLGcpO1dmKGgsZyk7YnJlYWsgYTtjYXNlIDE6aWYobD1tLGs9aC50eXBlLHA9aC5zdGF0ZU5vZGUsMD09PShoLmVmZmVjdFRhZyY2NCkmJihcImZ1bmN0aW9uXCI9PT10eXBlb2Ygay5nZXREZXJpdmVkU3RhdGVGcm9tRXJyb3J8fFxubnVsbCE9PXAmJlwiZnVuY3Rpb25cIj09PXR5cGVvZiBwLmNvbXBvbmVudERpZENhdGNoJiYobnVsbD09PVBofHwhUGguaGFzKHApKSkpe2guZWZmZWN0VGFnfD0xMDI0O2guZXhwaXJhdGlvblRpbWU9ZztnPU9oKGgsbCxnKTtXZihoLGcpO2JyZWFrIGF9fWg9aC5yZXR1cm59d2hpbGUobnVsbCE9PWgpfVE9JGgoZik7Y29udGludWV9fX1icmVha313aGlsZSgxKTtWaD0hMTtmZz1lZz1kZz1TaC5jdXJyZW50RGlzcGF0Y2hlcj1udWxsO2lmKGUpUj1udWxsLGEuZmluaXNoZWRXb3JrPW51bGw7ZWxzZSBpZihudWxsIT09USlhLmZpbmlzaGVkV29yaz1udWxsO2Vsc2V7Yj1hLmN1cnJlbnQuYWx0ZXJuYXRlO251bGw9PT1iP3IoXCIyODFcIik6dm9pZCAwO1I9bnVsbDtpZihYaCl7ZT1hLmxhdGVzdFBlbmRpbmdUaW1lO2Y9YS5sYXRlc3RTdXNwZW5kZWRUaW1lO2c9YS5sYXRlc3RQaW5nZWRUaW1lO2lmKDAhPT1lJiZlPmR8fDAhPT1mJiZmPmR8fDAhPT1nJiZnPmQpe09mKGEsZCk7ZWkoYSxiLFxuZCxhLmV4cGlyYXRpb25UaW1lLC0xKTtyZXR1cm59aWYoIWEuZGlkRXJyb3ImJiFjKXthLmRpZEVycm9yPSEwO2Q9YS5uZXh0RXhwaXJhdGlvblRpbWVUb1dvcmtPbj1kO2M9YS5leHBpcmF0aW9uVGltZT0xO2VpKGEsYixkLGMsLTEpO3JldHVybn19Y3x8LTE9PT1XaD8oYS5wZW5kaW5nQ29tbWl0RXhwaXJhdGlvblRpbWU9ZCxhLmZpbmlzaGVkV29yaz1iKTooT2YoYSxkKSxjPTEwKihQZihhLGQpLTIpLGM8V2gmJihXaD1jKSxjPTEwKih2ZygpLTIpLGM9V2gtYyxlaShhLGIsZCxhLmV4cGlyYXRpb25UaW1lLDA+Yz8wOmMpKX19XG5mdW5jdGlvbiBHaChhLGIpe3ZhciBjO2E6e1ZoJiYhWWg/cihcIjI2M1wiKTp2b2lkIDA7Zm9yKGM9YS5yZXR1cm47bnVsbCE9PWM7KXtzd2l0Y2goYy50YWcpe2Nhc2UgMTp2YXIgZD1jLnN0YXRlTm9kZTtpZihcImZ1bmN0aW9uXCI9PT10eXBlb2YgYy50eXBlLmdldERlcml2ZWRTdGF0ZUZyb21FcnJvcnx8XCJmdW5jdGlvblwiPT09dHlwZW9mIGQuY29tcG9uZW50RGlkQ2F0Y2gmJihudWxsPT09UGh8fCFQaC5oYXMoZCkpKXthPWJnKGIsYSk7YT1PaChjLGEsMSk7VmYoYyxhKTt4ZyhjLDEpO2M9dm9pZCAwO2JyZWFrIGF9YnJlYWs7Y2FzZSAzOmE9YmcoYixhKTthPU1oKGMsYSwxKTtWZihjLGEpO3hnKGMsMSk7Yz12b2lkIDA7YnJlYWsgYX1jPWMucmV0dXJufTM9PT1hLnRhZyYmKGM9YmcoYixhKSxjPU1oKGEsYywxKSxWZihhLGMpLHhnKGEsMSkpO2M9dm9pZCAwfXJldHVybiBjfVxuZnVuY3Rpb24gd2coYSxiKXswIT09VWg/YT1VaDpWaD9hPVloPzE6UzpiLm1vZGUmMT8oYT1maT8yKzEwKigoKGEtMisxNSkvMTB8MCkrMSk6MisyNSooKChhLTIrNTAwKS8yNXwwKSsxKSxudWxsIT09UiYmYT09PVMmJihhKz0xKSk6YT0xO2ZpJiZhPmdpJiYoZ2k9YSk7cmV0dXJuIGF9XG5mdW5jdGlvbiBkaShhLGIsYyxkKXt2YXIgZT1hLmVhcmxpZXN0U3VzcGVuZGVkVGltZTt2YXIgZj1hLmxhdGVzdFN1c3BlbmRlZFRpbWU7aWYoMCE9PWUmJmQ+PWUmJmQ8PWYpe2Y9ZT1kO2EuZGlkRXJyb3I9ITE7dmFyIGc9YS5sYXRlc3RQaW5nZWRUaW1lO2lmKDA9PT1nfHxnPGYpYS5sYXRlc3RQaW5nZWRUaW1lPWY7TmYoZixhKX1lbHNlIGU9dmcoKSxlPXdnKGUsYiksTWYoYSxlKTswIT09KGIubW9kZSYxKSYmYT09PVImJlM9PT1kJiYoUj1udWxsKTtoaShiLGUpOzA9PT0oYi5tb2RlJjEpJiYoaGkoYyxlKSwxPT09Yy50YWcmJm51bGwhPT1jLnN0YXRlTm9kZSYmKGI9VGYoZSksYi50YWc9MixWZihjLGIpKSk7Yz1hLmV4cGlyYXRpb25UaW1lOzAhPT1jJiZpaShhLGMpfVxuZnVuY3Rpb24gaGkoYSxiKXtpZigwPT09YS5leHBpcmF0aW9uVGltZXx8YS5leHBpcmF0aW9uVGltZT5iKWEuZXhwaXJhdGlvblRpbWU9Yjt2YXIgYz1hLmFsdGVybmF0ZTtudWxsIT09YyYmKDA9PT1jLmV4cGlyYXRpb25UaW1lfHxjLmV4cGlyYXRpb25UaW1lPmIpJiYoYy5leHBpcmF0aW9uVGltZT1iKTt2YXIgZD1hLnJldHVybixlPW51bGw7aWYobnVsbD09PWQmJjM9PT1hLnRhZyllPWEuc3RhdGVOb2RlO2Vsc2UgZm9yKDtudWxsIT09ZDspe2M9ZC5hbHRlcm5hdGU7aWYoMD09PWQuY2hpbGRFeHBpcmF0aW9uVGltZXx8ZC5jaGlsZEV4cGlyYXRpb25UaW1lPmIpZC5jaGlsZEV4cGlyYXRpb25UaW1lPWI7bnVsbCE9PWMmJigwPT09Yy5jaGlsZEV4cGlyYXRpb25UaW1lfHxjLmNoaWxkRXhwaXJhdGlvblRpbWU+YikmJihjLmNoaWxkRXhwaXJhdGlvblRpbWU9Yik7aWYobnVsbD09PWQucmV0dXJuJiYzPT09ZC50YWcpe2U9ZC5zdGF0ZU5vZGU7YnJlYWt9ZD1kLnJldHVybn1yZXR1cm4gbnVsbD09PVxuZT9udWxsOmV9ZnVuY3Rpb24geGcoYSxiKXthPWhpKGEsYik7bnVsbCE9PWEmJighVmgmJjAhPT1TJiZiPFMmJlpoKCksTWYoYSxiKSxWaCYmIVloJiZSPT09YXx8aWkoYSxhLmV4cGlyYXRpb25UaW1lKSxqaT5raSYmKGppPTAscihcIjE4NVwiKSkpfWZ1bmN0aW9uIGxpKGEsYixjLGQsZSl7dmFyIGY9VWg7VWg9MTt0cnl7cmV0dXJuIGEoYixjLGQsZSl9ZmluYWxseXtVaD1mfX12YXIgVT1udWxsLFY9bnVsbCxtaT0wLG5pPXZvaWQgMCxXPSExLFg9bnVsbCxZPTAsZ2k9MCxvaT0hMSxwaT0hMSxxaT1udWxsLHJpPW51bGwsWj0hMSxzaT0hMSxmaT0hMSx0aT1udWxsLHVpPWRhLnVuc3RhYmxlX25vdygpLHZpPSh1aS8xMHwwKSsyLHdpPXZpLGtpPTUwLGppPTAseGk9bnVsbCx5aT0xO2Z1bmN0aW9uIHppKCl7dmk9KChkYS51bnN0YWJsZV9ub3coKS11aSkvMTB8MCkrMn1cbmZ1bmN0aW9uIEFpKGEsYil7aWYoMCE9PW1pKXtpZihiPm1pKXJldHVybjtudWxsIT09bmkmJmRhLnVuc3RhYmxlX2NhbmNlbENhbGxiYWNrKG5pKX1taT1iO2E9ZGEudW5zdGFibGVfbm93KCktdWk7bmk9ZGEudW5zdGFibGVfc2NoZWR1bGVDYWxsYmFjayhCaSx7dGltZW91dDoxMCooYi0yKS1hfSl9ZnVuY3Rpb24gZWkoYSxiLGMsZCxlKXthLmV4cGlyYXRpb25UaW1lPWQ7MCE9PWV8fGNpKCk/MDxlJiYoYS50aW1lb3V0SGFuZGxlPWtmKENpLmJpbmQobnVsbCxhLGIsYyksZSkpOihhLnBlbmRpbmdDb21taXRFeHBpcmF0aW9uVGltZT1jLGEuZmluaXNoZWRXb3JrPWIpfWZ1bmN0aW9uIENpKGEsYixjKXthLnBlbmRpbmdDb21taXRFeHBpcmF0aW9uVGltZT1jO2EuZmluaXNoZWRXb3JrPWI7emkoKTt3aT12aTtEaShhLGMpfWZ1bmN0aW9uIHZnKCl7aWYoVylyZXR1cm4gd2k7RWkoKTtpZigwPT09WXx8MTA3Mzc0MTgyMz09PVkpemkoKSx3aT12aTtyZXR1cm4gd2l9XG5mdW5jdGlvbiBpaShhLGIpe2lmKG51bGw9PT1hLm5leHRTY2hlZHVsZWRSb290KWEuZXhwaXJhdGlvblRpbWU9YixudWxsPT09Vj8oVT1WPWEsYS5uZXh0U2NoZWR1bGVkUm9vdD1hKTooVj1WLm5leHRTY2hlZHVsZWRSb290PWEsVi5uZXh0U2NoZWR1bGVkUm9vdD1VKTtlbHNle3ZhciBjPWEuZXhwaXJhdGlvblRpbWU7aWYoMD09PWN8fGI8YylhLmV4cGlyYXRpb25UaW1lPWJ9V3x8KFo/c2kmJihYPWEsWT0xLEZpKGEsMSwhMCkpOjE9PT1iP0dpKDEsbnVsbCk6QWkoYSxiKSl9XG5mdW5jdGlvbiBFaSgpe3ZhciBhPTAsYj1udWxsO2lmKG51bGwhPT1WKWZvcih2YXIgYz1WLGQ9VTtudWxsIT09ZDspe3ZhciBlPWQuZXhwaXJhdGlvblRpbWU7aWYoMD09PWUpe251bGw9PT1jfHxudWxsPT09Vj9yKFwiMjQ0XCIpOnZvaWQgMDtpZihkPT09ZC5uZXh0U2NoZWR1bGVkUm9vdCl7VT1WPWQubmV4dFNjaGVkdWxlZFJvb3Q9bnVsbDticmVha31lbHNlIGlmKGQ9PT1VKVU9ZT1kLm5leHRTY2hlZHVsZWRSb290LFYubmV4dFNjaGVkdWxlZFJvb3Q9ZSxkLm5leHRTY2hlZHVsZWRSb290PW51bGw7ZWxzZSBpZihkPT09Vil7Vj1jO1YubmV4dFNjaGVkdWxlZFJvb3Q9VTtkLm5leHRTY2hlZHVsZWRSb290PW51bGw7YnJlYWt9ZWxzZSBjLm5leHRTY2hlZHVsZWRSb290PWQubmV4dFNjaGVkdWxlZFJvb3QsZC5uZXh0U2NoZWR1bGVkUm9vdD1udWxsO2Q9Yy5uZXh0U2NoZWR1bGVkUm9vdH1lbHNle2lmKDA9PT1hfHxlPGEpYT1lLGI9ZDtpZihkPT09VilicmVhaztpZigxPT09YSlicmVhaztcbmM9ZDtkPWQubmV4dFNjaGVkdWxlZFJvb3R9fVg9YjtZPWF9ZnVuY3Rpb24gQmkoYSl7aWYoYS5kaWRUaW1lb3V0JiZudWxsIT09VSl7emkoKTt2YXIgYj1VO2Rve3ZhciBjPWIuZXhwaXJhdGlvblRpbWU7MCE9PWMmJnZpPj1jJiYoYi5uZXh0RXhwaXJhdGlvblRpbWVUb1dvcmtPbj12aSk7Yj1iLm5leHRTY2hlZHVsZWRSb290fXdoaWxlKGIhPT1VKX1HaSgwLGEpfVxuZnVuY3Rpb24gR2koYSxiKXtyaT1iO0VpKCk7aWYobnVsbCE9PXJpKWZvcih6aSgpLHdpPXZpO251bGwhPT1YJiYwIT09WSYmKDA9PT1hfHxhPj1ZKSYmKCFvaXx8dmk+PVkpOylGaShYLFksdmk+PVkpLEVpKCksemkoKSx3aT12aTtlbHNlIGZvcig7bnVsbCE9PVgmJjAhPT1ZJiYoMD09PWF8fGE+PVkpOylGaShYLFksITApLEVpKCk7bnVsbCE9PXJpJiYobWk9MCxuaT1udWxsKTswIT09WSYmQWkoWCxZKTtyaT1udWxsO29pPSExO2ppPTA7eGk9bnVsbDtpZihudWxsIT09dGkpZm9yKGE9dGksdGk9bnVsbCxiPTA7YjxhLmxlbmd0aDtiKyspe3ZhciBjPWFbYl07dHJ5e2MuX29uQ29tcGxldGUoKX1jYXRjaChkKXtwaXx8KHBpPSEwLHFpPWQpfX1pZihwaSl0aHJvdyBhPXFpLHFpPW51bGwscGk9ITEsYTt9ZnVuY3Rpb24gRGkoYSxiKXtXP3IoXCIyNTNcIik6dm9pZCAwO1g9YTtZPWI7RmkoYSxiLCEwKTtHaSgxLG51bGwpfVxuZnVuY3Rpb24gRmkoYSxiLGMpe1c/cihcIjI0NVwiKTp2b2lkIDA7Vz0hMDtpZihudWxsPT09cml8fGMpe3ZhciBkPWEuZmluaXNoZWRXb3JrO251bGwhPT1kP0hpKGEsZCxiKTooYS5maW5pc2hlZFdvcms9bnVsbCxkPWEudGltZW91dEhhbmRsZSwtMSE9PWQmJihhLnRpbWVvdXRIYW5kbGU9LTEsbGYoZCkpLGJpKGEsITEsYyksZD1hLmZpbmlzaGVkV29yayxudWxsIT09ZCYmSGkoYSxkLGIpKX1lbHNlIGQ9YS5maW5pc2hlZFdvcmssbnVsbCE9PWQ/SGkoYSxkLGIpOihhLmZpbmlzaGVkV29yaz1udWxsLGQ9YS50aW1lb3V0SGFuZGxlLC0xIT09ZCYmKGEudGltZW91dEhhbmRsZT0tMSxsZihkKSksYmkoYSwhMCxjKSxkPWEuZmluaXNoZWRXb3JrLG51bGwhPT1kJiYoY2koKT9hLmZpbmlzaGVkV29yaz1kOkhpKGEsZCxiKSkpO1c9ITF9XG5mdW5jdGlvbiBIaShhLGIsYyl7dmFyIGQ9YS5maXJzdEJhdGNoO2lmKG51bGwhPT1kJiZkLl9leHBpcmF0aW9uVGltZTw9YyYmKG51bGw9PT10aT90aT1bZF06dGkucHVzaChkKSxkLl9kZWZlcikpe2EuZmluaXNoZWRXb3JrPWI7YS5leHBpcmF0aW9uVGltZT0wO3JldHVybn1hLmZpbmlzaGVkV29yaz1udWxsO2E9PT14aT9qaSsrOih4aT1hLGppPTApO1loPVZoPSEwO2EuY3VycmVudD09PWI/cihcIjE3N1wiKTp2b2lkIDA7dmFyIGU9YS5wZW5kaW5nQ29tbWl0RXhwaXJhdGlvblRpbWU7MD09PWU/cihcIjI2MVwiKTp2b2lkIDA7YS5wZW5kaW5nQ29tbWl0RXhwaXJhdGlvblRpbWU9MDt2YXIgZj1iLmV4cGlyYXRpb25UaW1lLGc9Yi5jaGlsZEV4cGlyYXRpb25UaW1lLGg9MD09PWZ8fDAhPT1nJiZnPGY/ZzpmO2EuZGlkRXJyb3I9ITE7aWYoMD09PWgpYS5lYXJsaWVzdFBlbmRpbmdUaW1lPTAsYS5sYXRlc3RQZW5kaW5nVGltZT0wLGEuZWFybGllc3RTdXNwZW5kZWRUaW1lPTAsYS5sYXRlc3RTdXNwZW5kZWRUaW1lPVxuMCxhLmxhdGVzdFBpbmdlZFRpbWU9MDtlbHNle3ZhciBrPWEubGF0ZXN0UGVuZGluZ1RpbWU7MCE9PWsmJihrPGg/YS5lYXJsaWVzdFBlbmRpbmdUaW1lPWEubGF0ZXN0UGVuZGluZ1RpbWU9MDphLmVhcmxpZXN0UGVuZGluZ1RpbWU8aCYmKGEuZWFybGllc3RQZW5kaW5nVGltZT1hLmxhdGVzdFBlbmRpbmdUaW1lKSk7dmFyIGw9YS5lYXJsaWVzdFN1c3BlbmRlZFRpbWU7MD09PWw/TWYoYSxoKTpoPmEubGF0ZXN0U3VzcGVuZGVkVGltZT8oYS5lYXJsaWVzdFN1c3BlbmRlZFRpbWU9MCxhLmxhdGVzdFN1c3BlbmRlZFRpbWU9MCxhLmxhdGVzdFBpbmdlZFRpbWU9MCxNZihhLGgpKTpoPGwmJk1mKGEsaCl9TmYoMCxhKTtTaC5jdXJyZW50PW51bGw7aWYoMTxiLmVmZmVjdFRhZylpZihudWxsIT09Yi5sYXN0RWZmZWN0KXtiLmxhc3RFZmZlY3QubmV4dEVmZmVjdD1iO3ZhciBtPWIuZmlyc3RFZmZlY3R9ZWxzZSBtPWI7ZWxzZSBtPWIuZmlyc3RFZmZlY3Q7ZmY9Y2U7dmFyIHA9cGUoKTtpZihxZShwKSl7aWYoXCJzZWxlY3Rpb25TdGFydFwiaW5cbnApdmFyIHY9e3N0YXJ0OnAuc2VsZWN0aW9uU3RhcnQsZW5kOnAuc2VsZWN0aW9uRW5kfTtlbHNlIGE6e3ZhciBCPXAub3duZXJEb2N1bWVudCx3PUImJkIuZGVmYXVsdFZpZXd8fHdpbmRvdyxDPXcuZ2V0U2VsZWN0aW9uJiZ3LmdldFNlbGVjdGlvbigpO2lmKEMmJjAhPT1DLnJhbmdlQ291bnQpe3ZhciB1PUMuYW5jaG9yTm9kZSxxPUMuYW5jaG9yT2Zmc2V0LEE9Qy5mb2N1c05vZGUsZmU9Qy5mb2N1c09mZnNldDt0cnl7dS5ub2RlVHlwZSxBLm5vZGVUeXBlfWNhdGNoKGRiKXt2PW51bGw7YnJlYWsgYX12YXIgSWI9MCxKYz0tMSxLYz0tMSxOaT0wLE9pPTAsdD1wLEpiPW51bGw7Yjpmb3IoOzspe2Zvcih2YXIgTGM7Oyl7dCE9PXV8fDAhPT1xJiYzIT09dC5ub2RlVHlwZXx8KEpjPUliK3EpO3QhPT1BfHwwIT09ZmUmJjMhPT10Lm5vZGVUeXBlfHwoS2M9SWIrZmUpOzM9PT10Lm5vZGVUeXBlJiYoSWIrPXQubm9kZVZhbHVlLmxlbmd0aCk7aWYobnVsbD09PShMYz10LmZpcnN0Q2hpbGQpKWJyZWFrO1xuSmI9dDt0PUxjfWZvcig7Oyl7aWYodD09PXApYnJlYWsgYjtKYj09PXUmJisrTmk9PT1xJiYoSmM9SWIpO0piPT09QSYmKytPaT09PWZlJiYoS2M9SWIpO2lmKG51bGwhPT0oTGM9dC5uZXh0U2libGluZykpYnJlYWs7dD1KYjtKYj10LnBhcmVudE5vZGV9dD1MY312PS0xPT09SmN8fC0xPT09S2M/bnVsbDp7c3RhcnQ6SmMsZW5kOktjfX1lbHNlIHY9bnVsbH12YXIgZmg9dnx8e3N0YXJ0OjAsZW5kOjB9fWVsc2UgZmg9bnVsbDtnZj17Zm9jdXNlZEVsZW06cCxzZWxlY3Rpb25SYW5nZTpmaH07Y2U9ITE7Zm9yKFQ9bTtudWxsIT09VDspe3ZhciBnaD0hMSxoaD12b2lkIDA7dHJ5e2Zvcig7bnVsbCE9PVQ7KXtpZihULmVmZmVjdFRhZyYyNTYpe3ZhciB2ZT1ULmFsdGVybmF0ZTthOnt2YXIgUWI9VDtzd2l0Y2goUWIudGFnKXtjYXNlIDE6aWYoUWIuZWZmZWN0VGFnJjI1NiYmbnVsbCE9PXZlKXt2YXIgWmk9dmUubWVtb2l6ZWRQcm9wcywkaT12ZS5tZW1vaXplZFN0YXRlLFZjPVFiLnN0YXRlTm9kZTtcblZjLnByb3BzPVFiLm1lbW9pemVkUHJvcHM7VmMuc3RhdGU9UWIubWVtb2l6ZWRTdGF0ZTt2YXIgYWo9VmMuZ2V0U25hcHNob3RCZWZvcmVVcGRhdGUoWmksJGkpO1ZjLl9fcmVhY3RJbnRlcm5hbFNuYXBzaG90QmVmb3JlVXBkYXRlPWFqfWJyZWFrIGE7Y2FzZSAzOmNhc2UgNTpjYXNlIDY6Y2FzZSA0OmNhc2UgMTc6YnJlYWsgYTtkZWZhdWx0OnIoXCIxNjNcIil9fX1UPVQubmV4dEVmZmVjdH19Y2F0Y2goZGIpe2doPSEwLGhoPWRifWdoJiYobnVsbD09PVQ/cihcIjE3OFwiKTp2b2lkIDAsR2goVCxoaCksbnVsbCE9PVQmJihUPVQubmV4dEVmZmVjdCkpfWZvcihUPW07bnVsbCE9PVQ7KXt2YXIgaWg9ITEsamg9dm9pZCAwO3RyeXtmb3IoO251bGwhPT1UOyl7dmFyIHdlPVQuZWZmZWN0VGFnO3dlJjE2JiZYZShULnN0YXRlTm9kZSxcIlwiKTtpZih3ZSYxMjgpe3ZhciBraD1ULmFsdGVybmF0ZTtpZihudWxsIT09a2gpe3ZhciBXYz1raC5yZWY7bnVsbCE9PVdjJiYoXCJmdW5jdGlvblwiPT09dHlwZW9mIFdjP1xuV2MobnVsbCk6V2MuY3VycmVudD1udWxsKX19c3dpdGNoKHdlJjE0KXtjYXNlIDI6S2goVCk7VC5lZmZlY3RUYWcmPS0zO2JyZWFrO2Nhc2UgNjpLaChUKTtULmVmZmVjdFRhZyY9LTM7TGgoVC5hbHRlcm5hdGUsVCk7YnJlYWs7Y2FzZSA0OkxoKFQuYWx0ZXJuYXRlLFQpO2JyZWFrO2Nhc2UgODp2YXIgbGg9VDtJaChsaCk7dmFyIFJiPWxoO1JiLnJldHVybj1udWxsO1JiLmNoaWxkPW51bGw7UmIuYWx0ZXJuYXRlJiYoUmIuYWx0ZXJuYXRlLmNoaWxkPW51bGwsUmIuYWx0ZXJuYXRlLnJldHVybj1udWxsKX1UPVQubmV4dEVmZmVjdH19Y2F0Y2goZGIpe2loPSEwLGpoPWRifWloJiYobnVsbD09PVQ/cihcIjE3OFwiKTp2b2lkIDAsR2goVCxqaCksbnVsbCE9PVQmJihUPVQubmV4dEVmZmVjdCkpfXZhciBtaD1nZixiaj1wZSgpLEU9bWguZm9jdXNlZEVsZW0sZWI9bWguc2VsZWN0aW9uUmFuZ2U7aWYoYmohPT1FJiZFJiZFLm93bmVyRG9jdW1lbnQmJm9lKEUub3duZXJEb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsXG5FKSl7aWYobnVsbCE9PWViJiZxZShFKSl7dmFyIG5oPWViLnN0YXJ0LHhlPWViLmVuZDt2b2lkIDA9PT14ZSYmKHhlPW5oKTtpZihcInNlbGVjdGlvblN0YXJ0XCJpbiBFKUUuc2VsZWN0aW9uU3RhcnQ9bmgsRS5zZWxlY3Rpb25FbmQ9TWF0aC5taW4oeGUsRS52YWx1ZS5sZW5ndGgpO2Vsc2V7dmFyIHllPUUub3duZXJEb2N1bWVudHx8ZG9jdW1lbnQsYmE9KHllJiZ5ZS5kZWZhdWx0Vmlld3x8d2luZG93KS5nZXRTZWxlY3Rpb24oKSxvaD1FLnRleHRDb250ZW50Lmxlbmd0aCxmYj1NYXRoLm1pbihlYi5zdGFydCxvaCksU2I9dm9pZCAwPT09ZWIuZW5kP2ZiOk1hdGgubWluKGViLmVuZCxvaCk7aWYoIWJhLmV4dGVuZCYmZmI+U2Ipe3ZhciBjaj1TYjtTYj1mYjtmYj1jan12YXIgVGI9bmUoRSxmYiksSmE9bmUoRSxTYik7aWYoVGImJkphJiYoMSE9PWJhLnJhbmdlQ291bnR8fGJhLmFuY2hvck5vZGUhPT1UYi5ub2RlfHxiYS5hbmNob3JPZmZzZXQhPT1UYi5vZmZzZXR8fGJhLmZvY3VzTm9kZSE9PVxuSmEubm9kZXx8YmEuZm9jdXNPZmZzZXQhPT1KYS5vZmZzZXQpKXt2YXIgWGM9eWUuY3JlYXRlUmFuZ2UoKTtYYy5zZXRTdGFydChUYi5ub2RlLFRiLm9mZnNldCk7YmEucmVtb3ZlQWxsUmFuZ2VzKCk7ZmI+U2I/KGJhLmFkZFJhbmdlKFhjKSxiYS5leHRlbmQoSmEubm9kZSxKYS5vZmZzZXQpKTooWGMuc2V0RW5kKEphLm5vZGUsSmEub2Zmc2V0KSxiYS5hZGRSYW5nZShYYykpfX19Zm9yKHZhciB6ZT1bXSxnYj1FO2diPWdiLnBhcmVudE5vZGU7KTE9PT1nYi5ub2RlVHlwZSYmemUucHVzaCh7ZWxlbWVudDpnYixsZWZ0OmdiLnNjcm9sbExlZnQsdG9wOmdiLnNjcm9sbFRvcH0pO1wiZnVuY3Rpb25cIj09PXR5cGVvZiBFLmZvY3VzJiZFLmZvY3VzKCk7Zm9yKHZhciBBZT0wO0FlPHplLmxlbmd0aDtBZSsrKXt2YXIgWWM9emVbQWVdO1ljLmVsZW1lbnQuc2Nyb2xsTGVmdD1ZYy5sZWZ0O1ljLmVsZW1lbnQuc2Nyb2xsVG9wPVljLnRvcH19Z2Y9bnVsbDtjZT0hIWZmO2ZmPW51bGw7YS5jdXJyZW50PVxuYjtmb3IoVD1tO251bGwhPT1UOyl7dmFyIHBoPSExLHFoPXZvaWQgMDt0cnl7Zm9yKHZhciBkaj1lO251bGwhPT1UOyl7dmFyIHJoPVQuZWZmZWN0VGFnO2lmKHJoJjM2KXt2YXIgWmM9dm9pZCAwLGhiPVQuYWx0ZXJuYXRlLHg9VCxzaD1kajtzd2l0Y2goeC50YWcpe2Nhc2UgMTp2YXIgY2E9eC5zdGF0ZU5vZGU7aWYoeC5lZmZlY3RUYWcmNClpZihudWxsPT09aGIpY2EucHJvcHM9eC5tZW1vaXplZFByb3BzLGNhLnN0YXRlPXgubWVtb2l6ZWRTdGF0ZSxjYS5jb21wb25lbnREaWRNb3VudCgpO2Vsc2V7dmFyIGVqPWhiLm1lbW9pemVkUHJvcHMsZmo9aGIubWVtb2l6ZWRTdGF0ZTtjYS5wcm9wcz14Lm1lbW9pemVkUHJvcHM7Y2Euc3RhdGU9eC5tZW1vaXplZFN0YXRlO2NhLmNvbXBvbmVudERpZFVwZGF0ZShlaixmaixjYS5fX3JlYWN0SW50ZXJuYWxTbmFwc2hvdEJlZm9yZVVwZGF0ZSl9dmFyIHRoPXgudXBkYXRlUXVldWU7bnVsbCE9PXRoJiYoY2EucHJvcHM9eC5tZW1vaXplZFByb3BzLFxuY2Euc3RhdGU9eC5tZW1vaXplZFN0YXRlLCRmKHgsdGgsY2Esc2gpKTticmVhaztjYXNlIDM6dmFyIHVoPXgudXBkYXRlUXVldWU7aWYobnVsbCE9PXVoKXt2YXIgQmU9bnVsbDtpZihudWxsIT09eC5jaGlsZClzd2l0Y2goeC5jaGlsZC50YWcpe2Nhc2UgNTpCZT14LmNoaWxkLnN0YXRlTm9kZTticmVhaztjYXNlIDE6QmU9eC5jaGlsZC5zdGF0ZU5vZGV9JGYoeCx1aCxCZSxzaCl9YnJlYWs7Y2FzZSA1OnZhciBnaj14LnN0YXRlTm9kZTtudWxsPT09aGImJnguZWZmZWN0VGFnJjQmJmhmKHgudHlwZSx4Lm1lbW9pemVkUHJvcHMpJiZnai5mb2N1cygpO2JyZWFrO2Nhc2UgNjpicmVhaztjYXNlIDQ6YnJlYWs7Y2FzZSAxMjpicmVhaztjYXNlIDEzOmlmKHguZWZmZWN0VGFnJjMyKXt4Lm1lbW9pemVkU3RhdGU9e2FscmVhZHlDYXB0dXJlZDohMCxkaWRUaW1lb3V0OiExLHRpbWVkT3V0QXQ6MH07eGcoeCwxKTticmVha312YXIgdmg9bnVsbCE9PWhiP2hiLm1lbW9pemVkU3RhdGU6bnVsbCxcblViPXgubWVtb2l6ZWRTdGF0ZSxoaj1udWxsIT09dmg/dmguZGlkVGltZW91dDohMSxDZT14O2lmKG51bGw9PT1VYilaYz0hMTtlbHNlIGlmKFpjPVViLmRpZFRpbWVvdXQpQ2U9eC5jaGlsZCxVYi5hbHJlYWR5Q2FwdHVyZWQ9ITEsMD09PVViLnRpbWVkT3V0QXQmJihVYi50aW1lZE91dEF0PXZnKCkpO2lmKFpjIT09aGomJm51bGwhPT1DZSlhOmZvcih2YXIgRGU9Q2Usd2g9WmMsej1EZTs7KXtpZig1PT09ei50YWcpe3ZhciBpaj16LnN0YXRlTm9kZTtpZih3aClpai5zdHlsZS5kaXNwbGF5PVwibm9uZVwiO2Vsc2V7dmFyIGpqPXouc3RhdGVOb2RlLCRjPXoubWVtb2l6ZWRQcm9wcy5zdHlsZSxraj12b2lkIDAhPT0kYyYmbnVsbCE9PSRjJiYkYy5oYXNPd25Qcm9wZXJ0eShcImRpc3BsYXlcIik/JGMuZGlzcGxheTpudWxsO2pqLnN0eWxlLmRpc3BsYXk9a2p9fWVsc2UgaWYoNj09PXoudGFnKXouc3RhdGVOb2RlLm5vZGVWYWx1ZT13aD9cIlwiOnoubWVtb2l6ZWRQcm9wcztlbHNlIGlmKG51bGwhPT1cbnouY2hpbGQpe3ouY2hpbGQucmV0dXJuPXo7ej16LmNoaWxkO2NvbnRpbnVlfWlmKHo9PT1EZSlicmVhayBhO2Zvcig7bnVsbD09PXouc2libGluZzspe2lmKG51bGw9PT16LnJldHVybnx8ei5yZXR1cm49PT1EZSlicmVhayBhO3o9ei5yZXR1cm59ei5zaWJsaW5nLnJldHVybj16LnJldHVybjt6PXouc2libGluZ31icmVhaztjYXNlIDE3OmJyZWFrO2RlZmF1bHQ6cihcIjE2M1wiKX19aWYocmgmMTI4KXt2YXIgYWQ9VC5yZWY7aWYobnVsbCE9PWFkKXt2YXIgeGg9VC5zdGF0ZU5vZGU7c3dpdGNoKFQudGFnKXtjYXNlIDU6dmFyIEVlPXhoO2JyZWFrO2RlZmF1bHQ6RWU9eGh9XCJmdW5jdGlvblwiPT09dHlwZW9mIGFkP2FkKEVlKTphZC5jdXJyZW50PUVlfX12YXIgbGo9VC5uZXh0RWZmZWN0O1QubmV4dEVmZmVjdD1udWxsO1Q9bGp9fWNhdGNoKGRiKXtwaD0hMCxxaD1kYn1waCYmKG51bGw9PT1UP3IoXCIxNzhcIik6dm9pZCAwLEdoKFQscWgpLG51bGwhPT1UJiYoVD1ULm5leHRFZmZlY3QpKX1WaD1cblloPSExO1wiZnVuY3Rpb25cIj09PXR5cGVvZiB6ZiYmemYoYi5zdGF0ZU5vZGUpO3ZhciBGZT1iLmV4cGlyYXRpb25UaW1lLEdlPWIuY2hpbGRFeHBpcmF0aW9uVGltZSx5aD0wPT09RmV8fDAhPT1HZSYmR2U8RmU/R2U6RmU7MD09PXloJiYoUGg9bnVsbCk7YS5leHBpcmF0aW9uVGltZT15aDthLmZpbmlzaGVkV29yaz1udWxsfWZ1bmN0aW9uIGNpKCl7cmV0dXJuIG9pPyEwOm51bGw9PT1yaXx8cmkudGltZVJlbWFpbmluZygpPnlpPyExOm9pPSEwfWZ1bmN0aW9uIE5oKGEpe251bGw9PT1YP3IoXCIyNDZcIik6dm9pZCAwO1guZXhwaXJhdGlvblRpbWU9MDtwaXx8KHBpPSEwLHFpPWEpfWZ1bmN0aW9uIElpKGEsYil7dmFyIGM9WjtaPSEwO3RyeXtyZXR1cm4gYShiKX1maW5hbGx5eyhaPWMpfHxXfHxHaSgxLG51bGwpfX1mdW5jdGlvbiBKaShhLGIpe2lmKFomJiFzaSl7c2k9ITA7dHJ5e3JldHVybiBhKGIpfWZpbmFsbHl7c2k9ITF9fXJldHVybiBhKGIpfVxuZnVuY3Rpb24gS2koYSxiLGMpe2lmKGZpKXJldHVybiBhKGIsYyk7Wnx8V3x8MD09PWdpfHwoR2koZ2ksbnVsbCksZ2k9MCk7dmFyIGQ9ZmksZT1aO1o9Zmk9ITA7dHJ5e3JldHVybiBhKGIsYyl9ZmluYWxseXtmaT1kLChaPWUpfHxXfHxHaSgxLG51bGwpfX1cbmZ1bmN0aW9uIExpKGEsYixjLGQsZSl7dmFyIGY9Yi5jdXJyZW50O2E6aWYoYyl7Yz1jLl9yZWFjdEludGVybmFsRmliZXI7Yjp7Mj09PUdkKGMpJiYxPT09Yy50YWc/dm9pZCAwOnIoXCIxNzBcIik7dmFyIGc9Yztkb3tzd2l0Y2goZy50YWcpe2Nhc2UgMzpnPWcuc3RhdGVOb2RlLmNvbnRleHQ7YnJlYWsgYjtjYXNlIDE6aWYoTShnLnR5cGUpKXtnPWcuc3RhdGVOb2RlLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkTWVyZ2VkQ2hpbGRDb250ZXh0O2JyZWFrIGJ9fWc9Zy5yZXR1cm59d2hpbGUobnVsbCE9PWcpO3IoXCIxNzFcIik7Zz12b2lkIDB9aWYoMT09PWMudGFnKXt2YXIgaD1jLnR5cGU7aWYoTShoKSl7Yz13ZihjLGgsZyk7YnJlYWsgYX19Yz1nfWVsc2UgYz1xZjtudWxsPT09Yi5jb250ZXh0P2IuY29udGV4dD1jOmIucGVuZGluZ0NvbnRleHQ9YztiPWU7ZT1UZihkKTtlLnBheWxvYWQ9e2VsZW1lbnQ6YX07Yj12b2lkIDA9PT1iP251bGw6YjtudWxsIT09YiYmKGUuY2FsbGJhY2s9Yik7XG5WZihmLGUpO3hnKGYsZCk7cmV0dXJuIGR9ZnVuY3Rpb24gTWkoYSxiLGMsZCl7dmFyIGU9Yi5jdXJyZW50LGY9dmcoKTtlPXdnKGYsZSk7cmV0dXJuIExpKGEsYixjLGUsZCl9ZnVuY3Rpb24gUGkoYSl7YT1hLmN1cnJlbnQ7aWYoIWEuY2hpbGQpcmV0dXJuIG51bGw7c3dpdGNoKGEuY2hpbGQudGFnKXtjYXNlIDU6cmV0dXJuIGEuY2hpbGQuc3RhdGVOb2RlO2RlZmF1bHQ6cmV0dXJuIGEuY2hpbGQuc3RhdGVOb2RlfX1mdW5jdGlvbiBRaShhLGIsYyl7dmFyIGQ9Mzxhcmd1bWVudHMubGVuZ3RoJiZ2b2lkIDAhPT1hcmd1bWVudHNbM10/YXJndW1lbnRzWzNdOm51bGw7cmV0dXJueyQkdHlwZW9mOm5jLGtleTpudWxsPT1kP251bGw6XCJcIitkLGNoaWxkcmVuOmEsY29udGFpbmVySW5mbzpiLGltcGxlbWVudGF0aW9uOmN9fVxuTmI9ZnVuY3Rpb24oYSxiLGMpe3N3aXRjaChiKXtjYXNlIFwiaW5wdXRcIjpUYyhhLGMpO2I9Yy5uYW1lO2lmKFwicmFkaW9cIj09PWMudHlwZSYmbnVsbCE9Yil7Zm9yKGM9YTtjLnBhcmVudE5vZGU7KWM9Yy5wYXJlbnROb2RlO2M9Yy5xdWVyeVNlbGVjdG9yQWxsKFwiaW5wdXRbbmFtZT1cIitKU09OLnN0cmluZ2lmeShcIlwiK2IpKyddW3R5cGU9XCJyYWRpb1wiXScpO2ZvcihiPTA7YjxjLmxlbmd0aDtiKyspe3ZhciBkPWNbYl07aWYoZCE9PWEmJmQuZm9ybT09PWEuZm9ybSl7dmFyIGU9UWEoZCk7ZT92b2lkIDA6cihcIjkwXCIpO2pjKGQpO1RjKGQsZSl9fX1icmVhaztjYXNlIFwidGV4dGFyZWFcIjpRZShhLGMpO2JyZWFrO2Nhc2UgXCJzZWxlY3RcIjpiPWMudmFsdWUsbnVsbCE9YiYmTmUoYSwhIWMubXVsdGlwbGUsYiwhMSl9fTtcbmZ1bmN0aW9uIFJpKGEpe3ZhciBiPTIrMjUqKCgodmcoKS0yKzUwMCkvMjV8MCkrMSk7Yjw9VGgmJihiPVRoKzEpO3RoaXMuX2V4cGlyYXRpb25UaW1lPVRoPWI7dGhpcy5fcm9vdD1hO3RoaXMuX2NhbGxiYWNrcz10aGlzLl9uZXh0PW51bGw7dGhpcy5faGFzQ2hpbGRyZW49dGhpcy5fZGlkQ29tcGxldGU9ITE7dGhpcy5fY2hpbGRyZW49bnVsbDt0aGlzLl9kZWZlcj0hMH1SaS5wcm90b3R5cGUucmVuZGVyPWZ1bmN0aW9uKGEpe3RoaXMuX2RlZmVyP3ZvaWQgMDpyKFwiMjUwXCIpO3RoaXMuX2hhc0NoaWxkcmVuPSEwO3RoaXMuX2NoaWxkcmVuPWE7dmFyIGI9dGhpcy5fcm9vdC5faW50ZXJuYWxSb290LGM9dGhpcy5fZXhwaXJhdGlvblRpbWUsZD1uZXcgU2k7TGkoYSxiLG51bGwsYyxkLl9vbkNvbW1pdCk7cmV0dXJuIGR9O1xuUmkucHJvdG90eXBlLnRoZW49ZnVuY3Rpb24oYSl7aWYodGhpcy5fZGlkQ29tcGxldGUpYSgpO2Vsc2V7dmFyIGI9dGhpcy5fY2FsbGJhY2tzO251bGw9PT1iJiYoYj10aGlzLl9jYWxsYmFja3M9W10pO2IucHVzaChhKX19O1xuUmkucHJvdG90eXBlLmNvbW1pdD1mdW5jdGlvbigpe3ZhciBhPXRoaXMuX3Jvb3QuX2ludGVybmFsUm9vdCxiPWEuZmlyc3RCYXRjaDt0aGlzLl9kZWZlciYmbnVsbCE9PWI/dm9pZCAwOnIoXCIyNTFcIik7aWYodGhpcy5faGFzQ2hpbGRyZW4pe3ZhciBjPXRoaXMuX2V4cGlyYXRpb25UaW1lO2lmKGIhPT10aGlzKXt0aGlzLl9oYXNDaGlsZHJlbiYmKGM9dGhpcy5fZXhwaXJhdGlvblRpbWU9Yi5fZXhwaXJhdGlvblRpbWUsdGhpcy5yZW5kZXIodGhpcy5fY2hpbGRyZW4pKTtmb3IodmFyIGQ9bnVsbCxlPWI7ZSE9PXRoaXM7KWQ9ZSxlPWUuX25leHQ7bnVsbD09PWQ/cihcIjI1MVwiKTp2b2lkIDA7ZC5fbmV4dD1lLl9uZXh0O3RoaXMuX25leHQ9YjthLmZpcnN0QmF0Y2g9dGhpc310aGlzLl9kZWZlcj0hMTtEaShhLGMpO2I9dGhpcy5fbmV4dDt0aGlzLl9uZXh0PW51bGw7Yj1hLmZpcnN0QmF0Y2g9YjtudWxsIT09YiYmYi5faGFzQ2hpbGRyZW4mJmIucmVuZGVyKGIuX2NoaWxkcmVuKX1lbHNlIHRoaXMuX25leHQ9XG5udWxsLHRoaXMuX2RlZmVyPSExfTtSaS5wcm90b3R5cGUuX29uQ29tcGxldGU9ZnVuY3Rpb24oKXtpZighdGhpcy5fZGlkQ29tcGxldGUpe3RoaXMuX2RpZENvbXBsZXRlPSEwO3ZhciBhPXRoaXMuX2NhbGxiYWNrcztpZihudWxsIT09YSlmb3IodmFyIGI9MDtiPGEubGVuZ3RoO2IrKykoMCxhW2JdKSgpfX07ZnVuY3Rpb24gU2koKXt0aGlzLl9jYWxsYmFja3M9bnVsbDt0aGlzLl9kaWRDb21taXQ9ITE7dGhpcy5fb25Db21taXQ9dGhpcy5fb25Db21taXQuYmluZCh0aGlzKX1TaS5wcm90b3R5cGUudGhlbj1mdW5jdGlvbihhKXtpZih0aGlzLl9kaWRDb21taXQpYSgpO2Vsc2V7dmFyIGI9dGhpcy5fY2FsbGJhY2tzO251bGw9PT1iJiYoYj10aGlzLl9jYWxsYmFja3M9W10pO2IucHVzaChhKX19O1xuU2kucHJvdG90eXBlLl9vbkNvbW1pdD1mdW5jdGlvbigpe2lmKCF0aGlzLl9kaWRDb21taXQpe3RoaXMuX2RpZENvbW1pdD0hMDt2YXIgYT10aGlzLl9jYWxsYmFja3M7aWYobnVsbCE9PWEpZm9yKHZhciBiPTA7YjxhLmxlbmd0aDtiKyspe3ZhciBjPWFbYl07XCJmdW5jdGlvblwiIT09dHlwZW9mIGM/cihcIjE5MVwiLGMpOnZvaWQgMDtjKCl9fX07XG5mdW5jdGlvbiBUaShhLGIsYyl7Yj1OKDMsbnVsbCxudWxsLGI/MzowKTthPXtjdXJyZW50OmIsY29udGFpbmVySW5mbzphLHBlbmRpbmdDaGlsZHJlbjpudWxsLGVhcmxpZXN0UGVuZGluZ1RpbWU6MCxsYXRlc3RQZW5kaW5nVGltZTowLGVhcmxpZXN0U3VzcGVuZGVkVGltZTowLGxhdGVzdFN1c3BlbmRlZFRpbWU6MCxsYXRlc3RQaW5nZWRUaW1lOjAsZGlkRXJyb3I6ITEscGVuZGluZ0NvbW1pdEV4cGlyYXRpb25UaW1lOjAsZmluaXNoZWRXb3JrOm51bGwsdGltZW91dEhhbmRsZTotMSxjb250ZXh0Om51bGwscGVuZGluZ0NvbnRleHQ6bnVsbCxoeWRyYXRlOmMsbmV4dEV4cGlyYXRpb25UaW1lVG9Xb3JrT246MCxleHBpcmF0aW9uVGltZTowLGZpcnN0QmF0Y2g6bnVsbCxuZXh0U2NoZWR1bGVkUm9vdDpudWxsfTt0aGlzLl9pbnRlcm5hbFJvb3Q9Yi5zdGF0ZU5vZGU9YX1cblRpLnByb3RvdHlwZS5yZW5kZXI9ZnVuY3Rpb24oYSxiKXt2YXIgYz10aGlzLl9pbnRlcm5hbFJvb3QsZD1uZXcgU2k7Yj12b2lkIDA9PT1iP251bGw6YjtudWxsIT09YiYmZC50aGVuKGIpO01pKGEsYyxudWxsLGQuX29uQ29tbWl0KTtyZXR1cm4gZH07VGkucHJvdG90eXBlLnVubW91bnQ9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5faW50ZXJuYWxSb290LGM9bmV3IFNpO2E9dm9pZCAwPT09YT9udWxsOmE7bnVsbCE9PWEmJmMudGhlbihhKTtNaShudWxsLGIsbnVsbCxjLl9vbkNvbW1pdCk7cmV0dXJuIGN9O1RpLnByb3RvdHlwZS5sZWdhY3lfcmVuZGVyU3VidHJlZUludG9Db250YWluZXI9ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPXRoaXMuX2ludGVybmFsUm9vdCxlPW5ldyBTaTtjPXZvaWQgMD09PWM/bnVsbDpjO251bGwhPT1jJiZlLnRoZW4oYyk7TWkoYixkLGEsZS5fb25Db21taXQpO3JldHVybiBlfTtcblRpLnByb3RvdHlwZS5jcmVhdGVCYXRjaD1mdW5jdGlvbigpe3ZhciBhPW5ldyBSaSh0aGlzKSxiPWEuX2V4cGlyYXRpb25UaW1lLGM9dGhpcy5faW50ZXJuYWxSb290LGQ9Yy5maXJzdEJhdGNoO2lmKG51bGw9PT1kKWMuZmlyc3RCYXRjaD1hLGEuX25leHQ9bnVsbDtlbHNle2ZvcihjPW51bGw7bnVsbCE9PWQmJmQuX2V4cGlyYXRpb25UaW1lPD1iOyljPWQsZD1kLl9uZXh0O2EuX25leHQ9ZDtudWxsIT09YyYmKGMuX25leHQ9YSl9cmV0dXJuIGF9O2Z1bmN0aW9uIFVpKGEpe3JldHVybiEoIWF8fDEhPT1hLm5vZGVUeXBlJiY5IT09YS5ub2RlVHlwZSYmMTEhPT1hLm5vZGVUeXBlJiYoOCE9PWEubm9kZVR5cGV8fFwiIHJlYWN0LW1vdW50LXBvaW50LXVuc3RhYmxlIFwiIT09YS5ub2RlVmFsdWUpKX1ZYj1JaTtaYj1LaTskYj1mdW5jdGlvbigpe1d8fDA9PT1naXx8KEdpKGdpLG51bGwpLGdpPTApfTtcbmZ1bmN0aW9uIFZpKGEsYil7Ynx8KGI9YT85PT09YS5ub2RlVHlwZT9hLmRvY3VtZW50RWxlbWVudDphLmZpcnN0Q2hpbGQ6bnVsbCxiPSEoIWJ8fDEhPT1iLm5vZGVUeXBlfHwhYi5oYXNBdHRyaWJ1dGUoXCJkYXRhLXJlYWN0cm9vdFwiKSkpO2lmKCFiKWZvcih2YXIgYztjPWEubGFzdENoaWxkOylhLnJlbW92ZUNoaWxkKGMpO3JldHVybiBuZXcgVGkoYSwhMSxiKX1cbmZ1bmN0aW9uIFdpKGEsYixjLGQsZSl7VWkoYyk/dm9pZCAwOnIoXCIyMDBcIik7dmFyIGY9Yy5fcmVhY3RSb290Q29udGFpbmVyO2lmKGYpe2lmKFwiZnVuY3Rpb25cIj09PXR5cGVvZiBlKXt2YXIgZz1lO2U9ZnVuY3Rpb24oKXt2YXIgYT1QaShmLl9pbnRlcm5hbFJvb3QpO2cuY2FsbChhKX19bnVsbCE9YT9mLmxlZ2FjeV9yZW5kZXJTdWJ0cmVlSW50b0NvbnRhaW5lcihhLGIsZSk6Zi5yZW5kZXIoYixlKX1lbHNle2Y9Yy5fcmVhY3RSb290Q29udGFpbmVyPVZpKGMsZCk7aWYoXCJmdW5jdGlvblwiPT09dHlwZW9mIGUpe3ZhciBoPWU7ZT1mdW5jdGlvbigpe3ZhciBhPVBpKGYuX2ludGVybmFsUm9vdCk7aC5jYWxsKGEpfX1KaShmdW5jdGlvbigpe251bGwhPWE/Zi5sZWdhY3lfcmVuZGVyU3VidHJlZUludG9Db250YWluZXIoYSxiLGUpOmYucmVuZGVyKGIsZSl9KX1yZXR1cm4gUGkoZi5faW50ZXJuYWxSb290KX1cbmZ1bmN0aW9uIFhpKGEsYil7dmFyIGM9Mjxhcmd1bWVudHMubGVuZ3RoJiZ2b2lkIDAhPT1hcmd1bWVudHNbMl0/YXJndW1lbnRzWzJdOm51bGw7VWkoYik/dm9pZCAwOnIoXCIyMDBcIik7cmV0dXJuIFFpKGEsYixudWxsLGMpfVxudmFyIFlpPXtjcmVhdGVQb3J0YWw6WGksZmluZERPTU5vZGU6ZnVuY3Rpb24oYSl7aWYobnVsbD09YSlyZXR1cm4gbnVsbDtpZigxPT09YS5ub2RlVHlwZSlyZXR1cm4gYTt2YXIgYj1hLl9yZWFjdEludGVybmFsRmliZXI7dm9pZCAwPT09YiYmKFwiZnVuY3Rpb25cIj09PXR5cGVvZiBhLnJlbmRlcj9yKFwiMTg4XCIpOnIoXCIyNjhcIixPYmplY3Qua2V5cyhhKSkpO2E9SmQoYik7YT1udWxsPT09YT9udWxsOmEuc3RhdGVOb2RlO3JldHVybiBhfSxoeWRyYXRlOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gV2kobnVsbCxhLGIsITAsYyl9LHJlbmRlcjpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIFdpKG51bGwsYSxiLCExLGMpfSx1bnN0YWJsZV9yZW5kZXJTdWJ0cmVlSW50b0NvbnRhaW5lcjpmdW5jdGlvbihhLGIsYyxkKXtudWxsPT1hfHx2b2lkIDA9PT1hLl9yZWFjdEludGVybmFsRmliZXI/cihcIjM4XCIpOnZvaWQgMDtyZXR1cm4gV2koYSxiLGMsITEsZCl9LHVubW91bnRDb21wb25lbnRBdE5vZGU6ZnVuY3Rpb24oYSl7VWkoYSk/XG52b2lkIDA6cihcIjQwXCIpO3JldHVybiBhLl9yZWFjdFJvb3RDb250YWluZXI/KEppKGZ1bmN0aW9uKCl7V2kobnVsbCxudWxsLGEsITEsZnVuY3Rpb24oKXthLl9yZWFjdFJvb3RDb250YWluZXI9bnVsbH0pfSksITApOiExfSx1bnN0YWJsZV9jcmVhdGVQb3J0YWw6ZnVuY3Rpb24oKXtyZXR1cm4gWGkuYXBwbHkodm9pZCAwLGFyZ3VtZW50cyl9LHVuc3RhYmxlX2JhdGNoZWRVcGRhdGVzOklpLHVuc3RhYmxlX2ludGVyYWN0aXZlVXBkYXRlczpLaSxmbHVzaFN5bmM6ZnVuY3Rpb24oYSxiKXtXP3IoXCIxODdcIik6dm9pZCAwO3ZhciBjPVo7Wj0hMDt0cnl7cmV0dXJuIGxpKGEsYil9ZmluYWxseXtaPWMsR2koMSxudWxsKX19LHVuc3RhYmxlX2ZsdXNoQ29udHJvbGxlZDpmdW5jdGlvbihhKXt2YXIgYj1aO1o9ITA7dHJ5e2xpKGEpfWZpbmFsbHl7KFo9Yil8fFd8fEdpKDEsbnVsbCl9fSxfX1NFQ1JFVF9JTlRFUk5BTFNfRE9fTk9UX1VTRV9PUl9ZT1VfV0lMTF9CRV9GSVJFRDp7RXZlbnRzOltPYSxcblBhLFFhLEdhLmluamVjdEV2ZW50UGx1Z2luc0J5TmFtZSxzYSxXYSxmdW5jdGlvbihhKXtCYShhLFZhKX0sV2IsWGIsZWUsSWFdfSx1bnN0YWJsZV9jcmVhdGVSb290OmZ1bmN0aW9uKGEsYil7VWkoYSk/dm9pZCAwOnIoXCIyNzhcIik7cmV0dXJuIG5ldyBUaShhLCEwLG51bGwhPWImJiEwPT09Yi5oeWRyYXRlKX19OyhmdW5jdGlvbihhKXt2YXIgYj1hLmZpbmRGaWJlckJ5SG9zdEluc3RhbmNlO3JldHVybiBDZihuKHt9LGEse2ZpbmRIb3N0SW5zdGFuY2VCeUZpYmVyOmZ1bmN0aW9uKGEpe2E9SmQoYSk7cmV0dXJuIG51bGw9PT1hP251bGw6YS5zdGF0ZU5vZGV9LGZpbmRGaWJlckJ5SG9zdEluc3RhbmNlOmZ1bmN0aW9uKGEpe3JldHVybiBiP2IoYSk6bnVsbH19KSl9KSh7ZmluZEZpYmVyQnlIb3N0SW5zdGFuY2U6TmEsYnVuZGxlVHlwZTowLHZlcnNpb246XCIxNi42LjBcIixyZW5kZXJlclBhY2thZ2VOYW1lOlwicmVhY3QtZG9tXCJ9KTtcbnZhciBtaj17ZGVmYXVsdDpZaX0sbmo9bWomJllpfHxtajttb2R1bGUuZXhwb3J0cz1uai5kZWZhdWx0fHxuajtcbiIsIi8qKiBAbGljZW5zZSBSZWFjdCB2MTYuNi4wXG4gKiBzY2hlZHVsZXIucHJvZHVjdGlvbi5taW4uanNcbiAqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqL1xuXG4ndXNlIHN0cmljdCc7T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsXCJfX2VzTW9kdWxlXCIse3ZhbHVlOiEwfSk7dmFyIGM9bnVsbCxmPTMsaD0tMSxrPS0xLGw9ITEsbT0hMSxuPVwib2JqZWN0XCI9PT10eXBlb2YgcGVyZm9ybWFuY2UmJlwiZnVuY3Rpb25cIj09PXR5cGVvZiBwZXJmb3JtYW5jZS5ub3cscT17dGltZVJlbWFpbmluZzpuP2Z1bmN0aW9uKCl7aWYobnVsbCE9PWMmJmMuZXhwaXJhdGlvblRpbWU8aylyZXR1cm4gMDt2YXIgYT1wKCktcGVyZm9ybWFuY2Uubm93KCk7cmV0dXJuIDA8YT9hOjB9OmZ1bmN0aW9uKCl7aWYobnVsbCE9PWMmJmMuZXhwaXJhdGlvblRpbWU8aylyZXR1cm4gMDt2YXIgYT1wKCktRGF0ZS5ub3coKTtyZXR1cm4gMDxhP2E6MH0sZGlkVGltZW91dDohMX07ZnVuY3Rpb24gcigpe2lmKCFsKXt2YXIgYT1jLmV4cGlyYXRpb25UaW1lO20/dCgpOm09ITA7dSh2LGEpfX1cbmZ1bmN0aW9uIHcoKXt2YXIgYT1jLGI9Yy5uZXh0O2lmKGM9PT1iKWM9bnVsbDtlbHNle3ZhciBkPWMucHJldmlvdXM7Yz1kLm5leHQ9YjtiLnByZXZpb3VzPWR9YS5uZXh0PWEucHJldmlvdXM9bnVsbDtkPWEuY2FsbGJhY2s7Yj1hLmV4cGlyYXRpb25UaW1lO2E9YS5wcmlvcml0eUxldmVsO3ZhciBlPWYsUj1rO2Y9YTtrPWI7dHJ5e3ZhciBnPWQocSl9ZmluYWxseXtmPWUsaz1SfWlmKFwiZnVuY3Rpb25cIj09PXR5cGVvZiBnKWlmKGc9e2NhbGxiYWNrOmcscHJpb3JpdHlMZXZlbDphLGV4cGlyYXRpb25UaW1lOmIsbmV4dDpudWxsLHByZXZpb3VzOm51bGx9LG51bGw9PT1jKWM9Zy5uZXh0PWcucHJldmlvdXM9ZztlbHNle2Q9bnVsbDthPWM7ZG97aWYoYS5leHBpcmF0aW9uVGltZT49Yil7ZD1hO2JyZWFrfWE9YS5uZXh0fXdoaWxlKGEhPT1jKTtudWxsPT09ZD9kPWM6ZD09PWMmJihjPWcscigpKTtiPWQucHJldmlvdXM7Yi5uZXh0PWQucHJldmlvdXM9ZztnLm5leHQ9ZDtnLnByZXZpb3VzPVxuYn19ZnVuY3Rpb24geCgpe2lmKC0xPT09aCYmbnVsbCE9PWMmJjE9PT1jLnByaW9yaXR5TGV2ZWwpe2w9ITA7cS5kaWRUaW1lb3V0PSEwO3RyeXtkbyB3KCk7d2hpbGUobnVsbCE9PWMmJjE9PT1jLnByaW9yaXR5TGV2ZWwpfWZpbmFsbHl7bD0hMSxudWxsIT09Yz9yKCk6bT0hMX19fWZ1bmN0aW9uIHYoYSl7bD0hMDtxLmRpZFRpbWVvdXQ9YTt0cnl7aWYoYSlmb3IoO251bGwhPT1jOyl7dmFyIGI9ZXhwb3J0cy51bnN0YWJsZV9ub3coKTtpZihjLmV4cGlyYXRpb25UaW1lPD1iKXtkbyB3KCk7d2hpbGUobnVsbCE9PWMmJmMuZXhwaXJhdGlvblRpbWU8PWIpfWVsc2UgYnJlYWt9ZWxzZSBpZihudWxsIT09Yyl7ZG8gdygpO3doaWxlKG51bGwhPT1jJiYwPHAoKS1leHBvcnRzLnVuc3RhYmxlX25vdygpKX19ZmluYWxseXtsPSExLG51bGwhPT1jP3IoKTptPSExLHgoKX19XG52YXIgeT1EYXRlLHo9XCJmdW5jdGlvblwiPT09dHlwZW9mIHNldFRpbWVvdXQ/c2V0VGltZW91dDp2b2lkIDAsQT1cImZ1bmN0aW9uXCI9PT10eXBlb2YgY2xlYXJUaW1lb3V0P2NsZWFyVGltZW91dDp2b2lkIDAsQj1cImZ1bmN0aW9uXCI9PT10eXBlb2YgcmVxdWVzdEFuaW1hdGlvbkZyYW1lP3JlcXVlc3RBbmltYXRpb25GcmFtZTp2b2lkIDAsQz1cImZ1bmN0aW9uXCI9PT10eXBlb2YgY2FuY2VsQW5pbWF0aW9uRnJhbWU/Y2FuY2VsQW5pbWF0aW9uRnJhbWU6dm9pZCAwLEQsRTtmdW5jdGlvbiBGKGEpe0Q9QihmdW5jdGlvbihiKXtBKEUpO2EoYil9KTtFPXooZnVuY3Rpb24oKXtDKEQpO2EoZXhwb3J0cy51bnN0YWJsZV9ub3coKSl9LDEwMCl9aWYobil7dmFyIEc9cGVyZm9ybWFuY2U7ZXhwb3J0cy51bnN0YWJsZV9ub3c9ZnVuY3Rpb24oKXtyZXR1cm4gRy5ub3coKX19ZWxzZSBleHBvcnRzLnVuc3RhYmxlX25vdz1mdW5jdGlvbigpe3JldHVybiB5Lm5vdygpfTt2YXIgdSx0LHA7XG5pZihcInVuZGVmaW5lZFwiIT09dHlwZW9mIHdpbmRvdyYmd2luZG93Ll9zY2hlZE1vY2spe3ZhciBIPXdpbmRvdy5fc2NoZWRNb2NrO3U9SFswXTt0PUhbMV07cD1IWzJdfWVsc2UgaWYoXCJ1bmRlZmluZWRcIj09PXR5cGVvZiB3aW5kb3d8fFwiZnVuY3Rpb25cIiE9PXR5cGVvZiB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcil7dmFyIEk9bnVsbCxKPS0xLEs9ZnVuY3Rpb24oYSxiKXtpZihudWxsIT09SSl7dmFyIGQ9STtJPW51bGw7dHJ5e0o9YixkKGEpfWZpbmFsbHl7Sj0tMX19fTt1PWZ1bmN0aW9uKGEsYil7LTEhPT1KP3NldFRpbWVvdXQodSwwLGEsYik6KEk9YSxzZXRUaW1lb3V0KEssYiwhMCxiKSxzZXRUaW1lb3V0KEssMTA3Mzc0MTgyMywhMSwxMDczNzQxODIzKSl9O3Q9ZnVuY3Rpb24oKXtJPW51bGx9O3A9ZnVuY3Rpb24oKXtyZXR1cm4gSW5maW5pdHl9O2V4cG9ydHMudW5zdGFibGVfbm93PWZ1bmN0aW9uKCl7cmV0dXJuLTE9PT1KPzA6Sn19ZWxzZXtcInVuZGVmaW5lZFwiIT09dHlwZW9mIGNvbnNvbGUmJlxuKFwiZnVuY3Rpb25cIiE9PXR5cGVvZiBCJiZjb25zb2xlLmVycm9yKFwiVGhpcyBicm93c2VyIGRvZXNuJ3Qgc3VwcG9ydCByZXF1ZXN0QW5pbWF0aW9uRnJhbWUuIE1ha2Ugc3VyZSB0aGF0IHlvdSBsb2FkIGEgcG9seWZpbGwgaW4gb2xkZXIgYnJvd3NlcnMuIGh0dHBzOi8vZmIubWUvcmVhY3QtcG9seWZpbGxzXCIpLFwiZnVuY3Rpb25cIiE9PXR5cGVvZiBDJiZjb25zb2xlLmVycm9yKFwiVGhpcyBicm93c2VyIGRvZXNuJ3Qgc3VwcG9ydCBjYW5jZWxBbmltYXRpb25GcmFtZS4gTWFrZSBzdXJlIHRoYXQgeW91IGxvYWQgYSBwb2x5ZmlsbCBpbiBvbGRlciBicm93c2Vycy4gaHR0cHM6Ly9mYi5tZS9yZWFjdC1wb2x5ZmlsbHNcIikpO3ZhciBMPW51bGwsTT0hMSxOPS0xLE89ITEsUD0hMSxRPTAsUz0zMyxUPTMzO3A9ZnVuY3Rpb24oKXtyZXR1cm4gUX07dmFyIFU9XCJfX3JlYWN0SWRsZUNhbGxiYWNrJFwiK01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIpO3dpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLFxuZnVuY3Rpb24oYSl7aWYoYS5zb3VyY2U9PT13aW5kb3cmJmEuZGF0YT09PVUpe009ITE7YT1MO3ZhciBiPU47TD1udWxsO049LTE7dmFyIGQ9ZXhwb3J0cy51bnN0YWJsZV9ub3coKSxlPSExO2lmKDA+PVEtZClpZigtMSE9PWImJmI8PWQpZT0hMDtlbHNle098fChPPSEwLEYoVikpO0w9YTtOPWI7cmV0dXJufWlmKG51bGwhPT1hKXtQPSEwO3RyeXthKGUpfWZpbmFsbHl7UD0hMX19fX0sITEpO3ZhciBWPWZ1bmN0aW9uKGEpe2lmKG51bGwhPT1MKXtGKFYpO3ZhciBiPWEtUStUO2I8VCYmUzxUPyg4PmImJihiPTgpLFQ9YjxTP1M6Yik6Uz1iO1E9YStUO018fChNPSEwLHdpbmRvdy5wb3N0TWVzc2FnZShVLFwiKlwiKSl9ZWxzZSBPPSExfTt1PWZ1bmN0aW9uKGEsYil7TD1hO049YjtQfHwwPmI/d2luZG93LnBvc3RNZXNzYWdlKFUsXCIqXCIpOk98fChPPSEwLEYoVikpfTt0PWZ1bmN0aW9uKCl7TD1udWxsO009ITE7Tj0tMX19ZXhwb3J0cy51bnN0YWJsZV9JbW1lZGlhdGVQcmlvcml0eT0xO1xuZXhwb3J0cy51bnN0YWJsZV9Vc2VyQmxvY2tpbmdQcmlvcml0eT0yO2V4cG9ydHMudW5zdGFibGVfTm9ybWFsUHJpb3JpdHk9MztleHBvcnRzLnVuc3RhYmxlX0lkbGVQcmlvcml0eT00O2V4cG9ydHMudW5zdGFibGVfcnVuV2l0aFByaW9yaXR5PWZ1bmN0aW9uKGEsYil7c3dpdGNoKGEpe2Nhc2UgMTpjYXNlIDI6Y2FzZSAzOmNhc2UgNDpicmVhaztkZWZhdWx0OmE9M312YXIgZD1mLGU9aDtmPWE7aD1leHBvcnRzLnVuc3RhYmxlX25vdygpO3RyeXtyZXR1cm4gYigpfWZpbmFsbHl7Zj1kLGg9ZSx4KCl9fTtcbmV4cG9ydHMudW5zdGFibGVfc2NoZWR1bGVDYWxsYmFjaz1mdW5jdGlvbihhLGIpe3ZhciBkPS0xIT09aD9oOmV4cG9ydHMudW5zdGFibGVfbm93KCk7aWYoXCJvYmplY3RcIj09PXR5cGVvZiBiJiZudWxsIT09YiYmXCJudW1iZXJcIj09PXR5cGVvZiBiLnRpbWVvdXQpYj1kK2IudGltZW91dDtlbHNlIHN3aXRjaChmKXtjYXNlIDE6Yj1kKy0xO2JyZWFrO2Nhc2UgMjpiPWQrMjUwO2JyZWFrO2Nhc2UgNDpiPWQrMTA3Mzc0MTgyMzticmVhaztkZWZhdWx0OmI9ZCs1RTN9YT17Y2FsbGJhY2s6YSxwcmlvcml0eUxldmVsOmYsZXhwaXJhdGlvblRpbWU6YixuZXh0Om51bGwscHJldmlvdXM6bnVsbH07aWYobnVsbD09PWMpYz1hLm5leHQ9YS5wcmV2aW91cz1hLHIoKTtlbHNle2Q9bnVsbDt2YXIgZT1jO2Rve2lmKGUuZXhwaXJhdGlvblRpbWU+Yil7ZD1lO2JyZWFrfWU9ZS5uZXh0fXdoaWxlKGUhPT1jKTtudWxsPT09ZD9kPWM6ZD09PWMmJihjPWEscigpKTtiPWQucHJldmlvdXM7Yi5uZXh0PWQucHJldmlvdXM9XG5hO2EubmV4dD1kO2EucHJldmlvdXM9Yn1yZXR1cm4gYX07ZXhwb3J0cy51bnN0YWJsZV9jYW5jZWxDYWxsYmFjaz1mdW5jdGlvbihhKXt2YXIgYj1hLm5leHQ7aWYobnVsbCE9PWIpe2lmKGI9PT1hKWM9bnVsbDtlbHNle2E9PT1jJiYoYz1iKTt2YXIgZD1hLnByZXZpb3VzO2QubmV4dD1iO2IucHJldmlvdXM9ZH1hLm5leHQ9YS5wcmV2aW91cz1udWxsfX07ZXhwb3J0cy51bnN0YWJsZV93cmFwQ2FsbGJhY2s9ZnVuY3Rpb24oYSl7dmFyIGI9ZjtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgZD1mLGU9aDtmPWI7aD1leHBvcnRzLnVuc3RhYmxlX25vdygpO3RyeXtyZXR1cm4gYS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9ZmluYWxseXtmPWQsaD1lLHgoKX19fTtleHBvcnRzLnVuc3RhYmxlX2dldEN1cnJlbnRQcmlvcml0eUxldmVsPWZ1bmN0aW9uKCl7cmV0dXJuIGZ9O1xuIl0sIm1hcHBpbmdzIjoiQUFDQTs7Ozs7QUNPQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUM2QkE7Ozs7Ozs7O0FDNUJBOzs7Ozs7OztBQ0dBOzs7Ozs7OztBQ0hBIiwic291cmNlUm9vdCI6IiJ9